19Mar15  --siggy

this was an exersize to create a linux based print spooler the can be accessed via windows (samba).

install:
	firefox
	Desktop (groupinstall)
	612  17Mar15-13:40:57  yum -y install samba4-winbind.x86_64 samba4-winbind-clients.x86_64 samba4-winbind-krb5-locator.x86_64 samba4-client.x86_64 samba4-swat.x86_64 

[root@lalprt1 cups]# rpm -qa | grep samba
samba4-swat-4.0.0-66.el6_6.rc4.x86_64
samba4-winbind-clients-4.0.0-66.el6_6.rc4.x86_64
samba4-winbind-4.0.0-66.el6_6.rc4.x86_64
samba4-client-4.0.0-66.el6_6.rc4.x86_64
samba4-common-4.0.0-66.el6_6.rc4.x86_64
samba4-winbind-krb5-locator-4.0.0-66.el6_6.rc4.x86_64
samba4-4.0.0-66.el6_6.rc4.x86_64
samba4-libs-4.0.0-66.el6_6.rc4.x86_64

	715  17Mar15-15:56:58  yum -y install cups

[root@lalprt1 cups]# rpm -qa | grep cups
cups-1.4.2-67.el6.x86_64
cups-libs-1.4.2-67.el6.x86_64

	716  17Mar15-15:57:21  yum -y install foomatic

[root@lalprt1 cups]# rpm -qa | grep foom
foomatic-db-filesystem-4.0-7.20091126.el6.noarch
foomatic-db-4.0-7.20091126.el6.noarch
foomatic-db-ppds-4.0-7.20091126.el6.noarch
foomatic-4.0.4-3.el6.x86_64

	750  18Mar15-09:37:04  yum -y install emacs # this one is for me :^D

edit the following files and restart the associated services

/etc/cups/printers.conf
/etc/printcap
/etc/samba/smb.conf

&&&&&


http://kb.eclipseinc.com/kb/how-do-i-manage-linux-print-queues/

	lpc status
	lpstat -p
	cupsenable <printer name>
	cupsdisable <printer name>

https://www.samba.org/samba/docs/using_samba/ch10.html

http://www.penguintutor.com/linux/printing-reference

[root@lalprt1 cups]# cat /etc/cups/printers.conf
# Printer configuration file for CUPS v1.4.2
# Written by cupsd on 2015-03-19 13:27
# DO NOT EDIT THIS FILE WHEN CUPSD IS RUNNING
<Printer laispc01>
Info HP LaserJet 4350
MakeModel HP Color LaserJet 4500 Foomatic/Postscript
DeviceURI socket://10.130.14.46:9100
State Idle
StateTime 1426786678
Type 8388612
Accepting Yes
Shared Yes
JobSheets none none
QuotaPeriod 0
PageLimit 0
KLimit 0
OpPolicy default
ErrorPolicy stop-printer
Attribute marker-colors none,none
Attribute marker-levels 26,29
Attribute marker-names Black Cartridge HP Q5942X,Maintenance Kit HP 110V-Q5421A, 220V-Q5422A
Attribute marker-types tonerCartridge,fuser
Attribute marker-change-time 1426786678
</Printer>

((()))

[root@lalprt1 ~]# cat /etc/cups/printers.conf-with-LACLCC 
# Printer configuration file for CUPS v1.4.2
# Written by cupsd on 2015-03-19 11:29
# DO NOT EDIT THIS FILE WHEN CUPSD IS RUNNING
<Printer LACLCC1>
Info LACLCC1
Location Encino
MakeModel HP LaserJet 4100 Foomatic/Postscript
DeviceURI socket://10.130.14.61:9100
State Idle
StateTime 1426635774
Type 8400916
Filter application/vnd.cups-raw 0 -
Filter application/vnd.cups-postscript 100 foomatic-rip
Filter application/vnd.cups-pdf 0 foomatic-rip
Filter application/vnd.cups-command 0 commandtops
Accepting Yes
Shared Yes
JobSheets none none
QuotaPeriod 0
PageLimit 0
KLimit 0
OpPolicy default
ErrorPolicy stop-printer
Attribute marker-colors \#000000,none
Attribute marker-levels 52,48
Attribute marker-names Black Cartridge HP CC364X,Maintenance Kit HP 110V-CB388A, 220V-CB389A
Attribute marker-types tonerCartridge,fuser
Attribute marker-change-time 1426635774
</Printer>
<Printer LACLCC2>
Info LACLCC2
Location Encino
MakeModel HP LaserJet 4100 Foomatic/Postscript
DeviceURI socket://10.130.14.62:9100
State Idle
StateTime 1426633392
Type 8400916
Filter application/vnd.cups-raw 0 -
Filter application/vnd.cups-postscript 100 foomatic-rip
Filter application/vnd.cups-pdf 0 foomatic-rip
Filter application/vnd.cups-command 0 commandtops
Accepting Yes
Shared Yes
JobSheets none none
QuotaPeriod 0
PageLimit 0
KLimit 0
OpPolicy default
ErrorPolicy stop-printer
</Printer>
<Printer laispc01>
Info HP LaserJet 4350
MakeModel HP Color LaserJet 4500 Foomatic/Postscript
DeviceURI socket://10.130.14.46:9100
State Idle
StateTime 1426786678
Type 8388612
Accepting Yes
Shared Yes
JobSheets none none
QuotaPeriod 0
PageLimit 0
KLimit 0
OpPolicy default
ErrorPolicy stop-printer
Attribute marker-colors none,none
Attribute marker-levels 26,29
Attribute marker-names Black Cartridge HP Q5942X,Maintenance Kit HP 110V-Q5421A, 220V-Q5422A
Attribute marker-types tonerCartridge,fuser
Attribute marker-change-time 1426786678
</Printer>


*****

[root@lalprt1 cups]# vim /etc/samba/smb.conf

...

#============================ Share Definitions ==============================

;       [homes]
;       comment = Home Directories
;       browseable = no
;       writable = yes
;       valid users = %S
;       valid users = MYDOMAIN\%S

[printers]
        comment = All Printers
        path = /var/spool/samba
        browseable = yes
        guest ok = yes
        writable = yes
        printable = yes
        print command = /usr/bin/lpr -P%p -r %s
        printer = laispc01
        printing = cups

[print$]
        comment = Printer Drivers
        path = /var/lib/samba/printers
        browseable = yes
        read only = yes
        guest ok = yes

*****

[root@lalprt1 cups]# cat /etc/printcap
# This file was automatically generated by cupsd(8) from the
# /etc/cups/printers.conf file.  All changes to this file
# will be lost.
LACLCC1|LACLCC1:rm=lalprt1.ri-net.com:rp=LACLCC1:
LACLCC2|LACLCC2:rm=lalprt1.ri-net.com:rp=LACLCC2:
laispc01|laispc01:rm=lalprt1.ri-net.com:rp=laispc01

[root@lalprt1 cups]# service cups stop
Stopping cups:                                             [  OK  ]

[root@lalprt1 cups]# vim /etc/printcap

[root@lalprt1 cups]# cat /etc/printcap
# This file was automatically generated by cupsd(8) from the
# /etc/cups/printers.conf file.  All changes to this file
# will be lost.
laispc01|laispc01:rm=lalprt1.ri-net.com:rp=laispc01

*****
[root@lalprt1 cups]# cat cupsd.conf
MaxLogSize 10m
LogLevel debug
SystemGroup sys root
# Allow remote access
Port 631
Listen /var/run/cups/cups.sock
# Enable printer sharing and shared printers.
Browsing On
BrowseOrder allow,deny
BrowseAllow all
BrowseRemoteProtocols CUPS
BrowseAddress @LOCAL
BrowseLocalProtocols CUPS dnssd
DefaultAuthType Basic								#Default
DefaultEncryption IfRequested							#added by me
<Location />
  # Allow shared printing and remote administration...
  Order allow,deny
  Allow all
</Location>
<Location /admin>
  # Allow remote administration...
  Order allow,deny
  Allow all
</Location>
<Location /admin/conf>
  AuthType Default
  Require user @SYSTEM
  # Allow remote access to the configuration files...
  Order allow,deny
  Allow all
</Location>
<Policy default>
  <Limit Send-Document Send-URI Hold-Job Release-Job Restart-Job Purge-Jobs Set-Job-Attributes Create-Job-Subscription Renew-Subscription Cancel-Subscription Get-Notifications Reprocess-Job Cancel-Current-Job Suspend-Current-Job Resume-Job CUPS-Move-Job CUPS-Get-Document>
    Require user @OWNER @SYSTEM
    Order deny,allow
  </Limit>
  <Limit CUPS-Add-Modify-Printer CUPS-Delete-Printer CUPS-Add-Modify-Class CUPS-Delete-Class CUPS-Set-Default CUPS-Get-Devices>
    AuthType Default
    Require user @SYSTEM
    Order deny,allow
  </Limit>
  <Limit Pause-Printer Resume-Printer Enable-Printer Disable-Printer Pause-Printer-After-Current-Job Hold-New-Jobs Release-Held-New-Jobs Deactivate-Printer Activate-Printer Restart-Printer Shutdown-Printer Startup-Printer Promote-Job Schedule-Job-After CUPS-Accept-Jobs CUPS-Reject-Jobs>
    AuthType Default
    Require user @SYSTEM
    Order deny,allow
  </Limit>
  <Limit CUPS-Authenticate-Job>
    Require user @OWNER @SYSTEM
    Order deny,allow
  </Limit>
  <Limit All>
    Order deny,allow
  </Limit>
</Policy>
<Policy authenticated>
  <Limit Create-Job Print-Job Print-URI>
  AuthType Default
  Order deny,allow
</Limit>
  <Limit Send-Document Send-URI Hold-Job Release-Job Restart-Job Purge-Jobs Set-Job-Attributes Create-Job-Subscription Renew-Subscription Cancel-Subscription Get-Notifications Reprocess-Job Cancel-Current-Job Suspend-Current-Job Resume-Job CUPS-Move-Job CUPS-Get-Document>
AuthType Default
Require user @OWNER @SYSTEM
Order deny,allow
  </Limit>
  <Limit CUPS-Add-Modify-Printer CUPS-Delete-Printer CUPS-Add-Modify-Class CUPS-Delete-Class CUPS-Set-Default>
  AuthType Default
  Require user @SYSTEM
  Order deny,allow
    </Limit>
  <Limit Pause-Printer Resume-Printer Enable-Printer Disable-Printer Pause-Printer-After-Current-Job Hold-New-Jobs Release-Held-New-Jobs Deactivate-Printer Activate-Printer Restart-Printer Shutdown-Printer Startup-Printer Promote-Job Schedule-Job-After CUPS-Accept-Jobs CUPS-Reject-Jobs>
    AuthType Default
    Require user @SYSTEM
    Order deny,allow
      </Limit>
  <Limit Cancel-Job CUPS-Authenticate-Job>
      AuthType Default
      Require user @OWNER @SYSTEM
      Order deny,allow
        </Limit>
  <Limit All>
        Order deny,allow
          </Limit>
</Policy>
            BrowseWebIF Yes

*****
