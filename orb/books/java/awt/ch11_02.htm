<HTML><HEAD><TITLE>[Chapter 11] 11.2 Scrolling An Image</TITLE><META NAME="author" CONTENT="John Zukowski"><META NAME="date" CONTENT="Thu Jul 31 14:48:07 1997"><META NAME="form" CONTENT="html"><META NAME="metadata" CONTENT="dublincore.0.1"><META NAME="objecttype" CONTENT="book part"><META NAME="otheragent" CONTENT="gmat dbtohtml"><META NAME="publisher" CONTENT="O'Reilly &amp; Associates, Inc."><META NAME="source" CONTENT="SGML"><META NAME="subject" CONTENT="Java AWT"><META NAME="title" CONTENT="Java AWT"><META HTTP-EQUIV="Content-Script-Type" CONTENT="text/javascript"></HEAD><BODY BGCOLOR="#FFFFFF"><DIV CLASS=htmlnav><H1><a href='index.htm'><IMG SRC="gifs/smbanner.gif"     ALT="Java AWT" border=0></a></H1><table width=515 border=0 cellpadding=0 cellspacing=0><tr><td width=172 align=left valign=top><A HREF="ch11_01.htm"><IMG SRC="gifs/txtpreva.gif" ALT="Previous" border=0></A></td><td width=171 align=center valign=top><B><FONT FACE="ARIEL,HELVETICA,HELV,SANSERIF" SIZE="-1">Chapter 11<br>Scrolling</FONT></B></TD><td width=172 align=right valign=top><A HREF="ch11_03.htm"><IMG SRC="gifs/txtnexta.gif" ALT="Next" border=0></A></td></tr></table>&nbsp;<hr align=left width=515></DIV><DIV CLASS=sect1><h2 CLASS=sect1><A CLASS="TITLE" NAME="JAWT-CH-11-SECT-2">11.2 Scrolling An Image</A></h2><P CLASS=para><A NAME="CH11.IMAGE1"></A><A NAME="CH11.IMAGE2"></A><A HREF="ch11_02.htm#JAWT-CH-11-EX-1">Example 11.1</A> is a Java application that displays any image in the current directory in a viewing area. The viewing area scrolls to accommodate larger images; the user can use the scrollbars or keypad keys to scroll the image. In Java 1.1, it is trivial to implement this example with a <tt CLASS=literal>ScrollPane</tt>; however, if you're using 1.0, you don't have this luxury. Even if you're using 1.1, this example shows a lot about how to use scrollbars. <P CLASS=para>Our application uses a <tt CLASS=literal>Dialog</tt> to select which file to display; a <tt CLASS=literal>FilenameFilter</tt> limits the list to image files. We use a menu to let the user request a file list or exit the program. After the user picks a file, the application loads it into the display area. <A HREF="ch11_02.htm#JAWT-CH-11-FIG-3">Figure 11.3</A> shows the main scrolling window. <DIV CLASS=figure><h4 CLASS=figure><A CLASS="TITLE" NAME="JAWT-CH-11-FIG-3">Figure 11.3: Scrolling an image</A></h4><p><img align=middle src="./figs/jawt1104.gif" alt="[Graphic: Figure 11-3]" width=184 height=255 border=0></DIV><P CLASS=para>The code for the scrolling image consists of a <tt CLASS=literal>ScrollingImage</tt> class, plus several helper classes. It places everything into the file <I CLASS=emphasis>ScrollingImage.java</I> for compilation. <DIV CLASS=example><h4 CLASS=example><A CLASS="TITLE" NAME="JAWT-CH-11-EX-1">Example 11.1: Source Code for Scrolling an Image</A></h4><DIV CLASS=screen><P><PRE>import java.awt.*;import java.io.FilenameFilter;import java.io.File;</PRE></DIV></DIV><P CLASS=para>The first class contains the <tt CLASS=literal>FilenameFilter</tt> used to select relevant filenames: that is, files that are likely to contain GIF, JPEG, or XBM images. If the filename has an appropriate ending, the <tt CLASS=literal>accept()</tt> method returns <tt CLASS=literal>true</tt>; otherwise, it returns <tt CLASS=literal>false</tt>. <DIV CLASS=screen><P><PRE>// True for files ending in jpeg/jpg/gif/xbmclass ImageFileFilter implements FilenameFilter {    public boolean accept (File dir, String name) {        String tempname = name.toLowerCase();        return (tempname.endsWith ("jpg") || tempname.endsWith ("jpeg") ||                tempname.endsWith ("gif") || tempname.endsWith ("xbm"));    }}</PRE></DIV><P CLASS=para>The <tt CLASS=literal>ImageListDialog</tt> class displays a list of files from which the user can select. Instead of using <tt CLASS=literal>FileDialog</tt>, we created a customized <tt CLASS=literal>List</tt> to prevent the user from roaming around the entire hard drive; choices are limited to appropriate files in the current directory. When the user selects an entry (by double-clicking), the image is then displayed in the scrolling area. <DIV CLASS=screen><P><PRE>class ImageListDialog extends Dialog {    private String name = null;    private String entries[];    private List list;    ImageListDialog (Frame f) {        super (f, "Image List", true);        File dir = new File (System.getProperty("user.dir"));        entries = dir.list (new ImageFileFilter());        list = new List (10, false);        for (int i=0;i&lt;entries.length;i++) {            list.addItem (entries[i]);        }        add ("Center", list);        pack();    }    public String getName () {        return name;    }    public boolean action (Event e, Object o) {        name = (String)e.arg;        ((ScrollingImage)getParent()).processImage();        dispose();        return true;    }}</PRE></DIV><P CLASS=para>The code in this class is straightforward. The constructor reads the current directory from the system property list, uses the <tt CLASS=literal>list()</tt> method of the <tt CLASS=literal>File</tt> class to create a list of files that match our filename filter, and then creates a <tt CLASS=literal>List</tt> object that lists these files. <tt CLASS=literal>getName()</tt> returns the name of the selected file. <tt CLASS=literal>action()</tt> is called when the user selects a file; it sets the name of the selected file from the <tt CLASS=literal>arg</tt> field of the <tt CLASS=literal>Event</tt> and then calls the <tt CLASS=literal>processImage()</tt> method of its parent container. The parent container of our <tt CLASS=literal>ImageListDialog</tt> is the <tt CLASS=literal>ScrollingImage</tt> class we are defining; its <tt CLASS=literal>processImage()</tt> method displays a scrollable image. <P CLASS=para>The next class, <tt CLASS=literal>ImageCanvas</tt>, is the <tt CLASS=literal>Canvas</tt> that the image is drawn onto. We use a separate <tt CLASS=literal>Canvas</tt> rather than drawing directly onto the <tt CLASS=literal>Frame</tt> so that the scrollbars do not overlap the edges of the image. You will notice that the <tt CLASS=literal>paint()</tt> method uses negative <tt CLASS=literal>x</tt> and <tt CLASS=literal>y</tt> values. This starts the drawing outside the <tt CLASS=literal>Canvas</tt> area; as a result, the <tt CLASS=literal>Canvas</tt> displays only part of the image. This is how we do the actual scrolling. (<tt CLASS=literal>xPos</tt>, <tt CLASS=literal>yPos</tt>) are the values given to us from the scrollbars; by positioning the image at (<tt CLASS=literal>-xPos</tt>, -<tt CLASS=literal>yPos</tt>), we ensure that the point (<tt CLASS=literal>xPos</tt>, <tt CLASS=literal>yPos</tt>) appears in the upper left corner of the canvas. <DIV CLASS=screen><P><PRE>class ImageCanvas extends Canvas {    Image image;    int xPos, yPos;    public void redraw (int xPos, int yPos, Image image) {        this.xPos = xPos;        this.yPos = yPos;        this.image = image;        repaint();    }    public void paint (Graphics g) {        if (image != null)            g.drawImage (image, -xPos, -yPos, this);    }}</PRE></DIV><P CLASS=para><tt CLASS=literal>ScrollingImage</tt> provides the framework for the rest of the program. It provides a menu to bring up the <tt CLASS=literal>Dialog</tt> to choose the file, the scrollbars to scroll the scrolling canvas, and the image canvas area. This class also implements event handling methods to capture the scrollbar events, paging keys, and menu events. <DIV CLASS=screen><P><PRE>public class ScrollingImage extends Frame {    static Scrollbar horizontal, vertical;    ImageCanvas center;    int xPos, yPos;    Image image;    ImageListDialog ild;    ScrollingImage () {        super ("Image Viewer");        add ("Center", center = new ImageCanvas ());        add ("South",  horizontal = new Scrollbar (Scrollbar.HORIZONTAL));        add ("East", vertical = new Scrollbar (Scrollbar.VERTICAL));        Menu m = new Menu ("File", true);        m.add ("Open");        m.add ("Close");        m.add ("-");        m.add ("Quit");        MenuBar mb = new MenuBar();        mb.add (m);        setMenuBar (mb);        resize (400, 300);    }    public static void main (String args[]) {        ScrollingImage si = new ScrollingImage ();        si.show();    }    public boolean handleEvent (Event e) {         if (e.id == Event.WINDOW_DESTROY) {            System.exit(0);        } else if (e.target instanceof Scrollbar) {            if (e.target == horizontal) {                xPos = ((Integer)e.arg).intValue();            } else if (e.target == vertical) {                yPos = ((Integer)e.arg).intValue();            }            center.redraw (xPos, yPos, image);        }        return super.handleEvent (e);    }</PRE></DIV><P CLASS=para>This <tt CLASS=literal>handleEvent()</tt> method kills the program if the user used the windowing system to exit from it (<tt CLASS=literal>WINDOW_DESTROY</tt>). More to the point, if a <tt CLASS=literal>Scrollbar</tt> generated the event, <tt CLASS=literal>handleEvent()</tt> figures out if it was the horizontal or vertical scrollbar, saves its value as the <tt CLASS=literal>x</tt> or <tt CLASS=literal>y</tt> position, and redraws the image in the new location. Finally, it calls <tt CLASS=literal>super.handleEvent()</tt>; as we will see in the following code, other events that we care about (key events and menu events) we don't want to handle here--we would rather handle them normally, in <tt CLASS=literal>action()</tt> and <tt CLASS=literal>keyDown()</tt> methods. <DIV CLASS=screen><P><PRE>    public void processImage () {        image = getToolkit().getImage (ild.getName());        MediaTracker tracker = new MediaTracker (this);        tracker.addImage (image, 0);        try {            tracker.waitForAll();        } catch (InterruptedException ie) {        }        xPos = 0;        yPos = 0;        int imageHeight = image.getHeight (this);        int imageWidth = image.getWidth (this);        vertical.setValues (0, 5, 0, imageHeight);        horizontal.setValues (0, 5, 0, imageWidth);        center.redraw (xPos, yPos, image);    }</PRE></DIV><P CLASS=para><tt CLASS=literal>processImage()</tt> reads the image's filename, calls <tt CLASS=literal>getImage()</tt>, and sets up a <tt CLASS=literal>MediaTracker</tt> to wait for the image to load. Once the image has loaded, it reads the height and width, and uses these to set the maximum values for the vertical and horizontal scrollbars by calling <tt CLASS=literal>setValues()</tt>. The scrollbars' minimum and initial values are both 0. The size of the scrollbar "handle" is set to 5, rather than trying to indicate the visible portion of the image. <DIV CLASS=screen><P><PRE>    public boolean action (Event e, Object o) {        if (e.target instanceof MenuItem) {            if ("Open".equals (o)) {                // If showing already, do not show again                if ((ild == null) || (!ild.isShowing())) {                    ild = new ImageListDialog (this);                    ild.show();                }            } else if ("Close".equals(o)) {                image = null;                center.redraw (xPos, yPos, image);            } else if ("Quit".equals(o)) {                System.exit(0);            }            return true;        }        return false;    }</PRE></DIV><P CLASS=para><tt CLASS=literal>action()</tt> handles menu events. If the user selected Open, it displays the dialog box that selects a file. Close redraws the canvas with a null image; Quit exits the program. If any of these events occurred, <tt CLASS=literal>action()</tt> returns <tt CLASS=literal>true</tt>, indicating that the event was fully handled. If any other event occurred, <tt CLASS=literal>action()</tt> returns <tt CLASS=literal>false</tt>, so that the system will deliver the event to any other methods that might be interested in it. <DIV CLASS=screen><P><PRE>    public boolean keyDown (Event e, int key) {        if (e.id == Event.KEY_ACTION) {            Scrollbar target = null;            switch (key) {                case Event.HOME:                    target = vertical;                    vertical.setValue(vertical.getMinimum());                    break;                case Event.END:                    target = vertical;                    vertical.setValue(vertical.getMaximum());                    break;                case Event.PGUP:                    target = vertical;                    vertical.setValue(vertical.getValue()                             - vertical.getPageIncrement());                    break;                case Event.PGDN:                    target = vertical;                    vertical.setValue(vertical.getValue()                             + vertical.getPageIncrement());                    break;                case Event.UP:                    target = vertical;                    vertical.setValue(vertical.getValue()                             - vertical.getLineIncrement());                    break;                case Event.DOWN:                    target = vertical;                    vertical.setValue(vertical.getValue()                             + vertical.getLineIncrement());                    break;                case Event.LEFT:                    target = horizontal;                    if (e.controlDown())                        horizontal.setValue(horizontal.getValue() -                            horizontal.getPageIncrement());                    else                        horizontal.setValue(horizontal.getValue() -                            horizontal.getLineIncrement());                    break;                case Event.RIGHT:                    target = horizontal;                    if (e.controlDown())                        horizontal.setValue(horizontal.getValue() +                            horizontal.getPageIncrement());                    else                        horizontal.setValue(horizontal.getValue() +                            horizontal.getLineIncrement());                    break;                default:                    return false;            }            Integer value = new Integer (target.getValue());            postEvent (new Event ((Object)target,                       Event.SCROLL_ABSOLUTE, (Object)value));            return true;        }        return false;    }}</PRE></DIV><P CLASS=para><tt CLASS=literal>keyDown()</tt> isn't really necessary, but it adds a nice extension to our scrollbars: in addition to using the mouse, the user can scroll with the arrow keys. Pressing an arrow key generates a <tt CLASS=literal>KEY_ACTION</tt> event. If we have one of these events, we check what kind of key it was, then compute a new scrollbar value, then call <tt CLASS=literal>setValue()</tt> to set the appropriate scrollbar to this value. For example, if the user presses the page up key, we read the page increment, add it to the current value of the vertical scrollbar, and then set the vertical scrollbar accordingly. (Note that this works even though nondefault page and line increments aren't implemented correctly.) The one trick here is that we have to get the rest of the program to realize that the scrollbar values have changed. To do so, we create a new <tt CLASS=literal>SCROLL_ABSOLUTE</tt> event, and call <tt CLASS=literal>postEvent()</tt> to deliver it. </DIV><DIV CLASS=htmlnav><P><HR align=left width=515><table width=515 border=0 cellpadding=0 cellspacing=0><tr><td width=172 align=left valign=top><A HREF="ch11_01.htm"><IMG SRC="gifs/txtpreva.gif" ALT="Previous" border=0></A></td><td width=171 align=center valign=top><a href="index.htm"><img src='gifs/txthome.gif' border=0 alt='Home'></a></td><td width=172 align=right valign=top><A HREF="ch11_03.htm"><IMG SRC="gifs/txtnexta.gif" ALT="Next" border=0></A></td></tr><tr><td width=172 align=left valign=top>Scrollbar</td><td width=171 align=center valign=top><a href="index/idx_a.htm"><img src='gifs/index.gif' alt='Book Index' border=0></a></td><td width=172 align=right valign=top>The Adjustable Interface</td></tr></table><hr align=left width=515><IMG SRC="gifs/smnavbar.gif" USEMAP="#map" BORDER=0> <MAP NAME="map"> <AREA SHAPE=RECT COORDS="0,0,108,15" HREF="../javanut/index.htm"alt="Java in a Nutshell"> <AREA SHAPE=RECT COORDS="109,0,200,15" HREF="../langref/index.htm" alt="Java Language Reference"> <AREA SHAPE=RECT COORDS="203,0,290,15" HREF="../awt/index.htm" alt="Java AWT"> <AREA SHAPE=RECT COORDS="291,0,419,15" HREF="../fclass/index.htm" alt="Java Fundamental Classes"> <AREA SHAPE=RECT COORDS="421,0,514,15" HREF="../exp/index.htm" alt="Exploring Java"> </MAP></DIV></BODY></HTML>