<HTML><HEAD><TITLE>[Chapter 15] 15.2 The Peer Interfaces</TITLE><META NAME="author" CONTENT="John Zukowski"><META NAME="date" CONTENT="Thu Jul 31 14:55:43 1997"><META NAME="form" CONTENT="html"><META NAME="metadata" CONTENT="dublincore.0.1"><META NAME="objecttype" CONTENT="book part"><META NAME="otheragent" CONTENT="gmat dbtohtml"><META NAME="publisher" CONTENT="O'Reilly &amp; Associates, Inc."><META NAME="source" CONTENT="SGML"><META NAME="subject" CONTENT="Java AWT"><META NAME="title" CONTENT="Java AWT"><META HTTP-EQUIV="Content-Script-Type" CONTENT="text/javascript"></HEAD><BODY BGCOLOR="#FFFFFF"><DIV CLASS=htmlnav><H1><a href='index.htm'><IMG SRC="gifs/smbanner.gif"     ALT="Java AWT" border=0></a></H1><table width=515 border=0 cellpadding=0 cellspacing=0><tr><td width=172 align=left valign=top><A HREF="ch15_01.htm"><IMG SRC="gifs/txtpreva.gif" ALT="Previous" border=0></A></td><td width=171 align=center valign=top><B><FONT FACE="ARIEL,HELVETICA,HELV,SANSERIF" SIZE="-1">Chapter 15<br>Toolkit and Peers</FONT></B></TD><td width=172 align=right valign=top><A HREF="ch16_01.htm"><IMG SRC="gifs/txtnexta.gif" ALT="Next" border=0></A></td></tr></table>&nbsp;<hr align=left width=515></DIV><DIV CLASS=sect1><h2 CLASS=sect1><A CLASS="TITLE" NAME="JAWT-CH-15-SECT-2">15.2 The Peer Interfaces</A></h2><P CLASS=para><A NAME="CH15.PEER"></A>Each GUI component that AWT provides has a <I CLASS=emphasis>peer</I>. The peer is the implementation of that component in the native environment. For example, the <tt CLASS=literal>Choice</tt> component in AWT corresponds to some native object that lets the user select one or more items from a list. As a Java developer, you need to worry only about the interface of the <tt CLASS=literal>Choice</tt> object; when someone runs your program, the <tt CLASS=literal>Choice</tt> object is mapped to an appropriate native object, which is the <tt CLASS=literal>Choice</tt> peer, that "does the right thing." You don't really care what the peer is or how it's implemented; in fact, the peer may look (and to some extent, behave) differently on each platform. <P CLASS=para>The glue that allows an AWT component and its peer to work together is called a <I CLASS=emphasis>peer interface</I>. A peer interface is simply an interface that defines the methods that the peer is required to support. These interfaces are collected in the package <tt CLASS=literal>java.awt.peer</tt>. For example, this package contains the <tt CLASS=literal>ButtonPeer</tt> interface, which contains the single method <tt CLASS=literal>setLabel()</tt>. This means that the native object used to implement a <tt CLASS=literal>Button</tt> must contain a method called <tt CLASS=literal>setLabel()</tt> in order for AWT to use it as a button peer. (It's not quite that simple; since a button is also a <tt CLASS=literal>Component</tt>, the button's peer must also implement the <tt CLASS=literal>ComponentPeer</tt> interface, which is much more complicated.) <P CLASS=para>With one exception, there is a one-to-one correspondence between <tt CLASS=literal>Component</tt> classes and peer interfaces: a <tt CLASS=literal>Window</tt> has a <tt CLASS=literal>WindowPeer</tt>, a <tt CLASS=literal>Checkbox</tt> has a <tt CLASS=literal>CheckboxPeer</tt>, and so on. The one exception is a new peer interface that appears in Java 1.1: the <tt CLASS=literal>LightweightPeer</tt>, which doesn't have a corresponding component. The <tt CLASS=literal>LightweightPeer</tt> is used by components that exist purely in Java, don't have a native peer, and are displayed and managed by another container. <tt CLASS=literal>LightweightPeer</tt> makes it easier to create new components or containers that can behave like other components, but don't subclass <tt CLASS=literal>Canvas</tt> or <tt CLASS=literal>Panel</tt> and don't correspond to anything in the native environment. The best usage I can think of is to subclass <tt CLASS=literal>Container</tt> to create a lightweight <tt CLASS=literal>Panel</tt>. If you are only using a <tt CLASS=literal>Panel</tt> to manage layout, there is no need for a peer to be created to process events. This should result in substantial resource savings where multiple panels need to be created just to help with layout. The following code is all you need to create a <tt CLASS=literal>LightWeightPanel</tt>:<DIV CLASS=screen><P><PRE>import java.awt.*;public class LightWeightPanel extends Container {}</PRE></DIV><P CLASS=para>There also tends to be a one-to-one relationship between the peer methods and the methods of the Java component. That is, each method in the peer interface corresponds to a method of the component. However, although a peer must implement each method in its peer interface, it doesn't necessarily have to do anything in that method. It's entirely possible for a platform to have a native button object that doesn't let you set the label. In this case, the button peer would implement the <tt CLASS=literal>setLabel()</tt> method required by the <tt CLASS=literal>ButtonPeer</tt> interface, but it wouldn't do anything. Of course, the component may also have many methods that don't correspond to the peer methods. Methods that don't correspond to anything in the peer are handled entirely within Java. <P CLASS=para>The <tt CLASS=literal>ComponentPeer</tt> interface is the parent of all non-menu objects in the peer package. The <tt CLASS=literal>MenuComponentPeer</tt> is the parent of all menu objects. The trees mirror the regular object hierarchies. <A HREF="ch15_02.htm#JAWT-CH-15-FIG-1">Figure 15.1</A> shows the object hierarchy diagram. <DIV CLASS=figure><h4 CLASS=figure><A CLASS="TITLE" NAME="JAWT-CH-15-FIG-1">Figure 15.1: java.awt.peer object hierarchy</A></h4><p><img align=middle src="./figs/jawt1502.gif" alt="[Graphic: Figure 15-1]" width=332 height=155 border=0></DIV><P CLASS=para>Creating a Java component (e.g., <tt CLASS=literal>Button b = new Button (`Foo`)</tt>) does not create the peer. An object's peer is created when the object's <tt CLASS=literal>addNotify()</tt> method is called. This is usually when the component's container is added to the screen. The call to a component's <tt CLASS=literal>addNotify()</tt> method in turn calls the appropriate <tt CLASS=literal>createxxxx()</tt> method of the <tt CLASS=literal>Toolkit</tt> (for a Button, <tt CLASS=literal>createButton()</tt>). <A HREF="ch15_02.htm#JAWT-CH-15-FIG-2">Figure 15.2</A> shows the process. <DIV CLASS=figure><h4 CLASS=figure><A CLASS="TITLE" NAME="JAWT-CH-15-FIG-2">Figure 15.2: Creating a Button peer</A></h4><p><img align=middle src="./figs/jawt1503.gif" alt="[Graphic: Figure 15-2]" width=464 height=457 border=0></DIV><P CLASS=para>When you remove a component from a container by calling <tt CLASS=literal>remove()</tt>, the container calls the component's <tt CLASS=literal>removeNotify()</tt> method. This usually results in a call to the peer's <tt CLASS=literal>dispose()</tt> method. Depending on the particular component, <tt CLASS=literal>removeNotify()</tt> may be overridden to perform additional work. Removing a <tt CLASS=literal>Component</tt> from a <tt CLASS=literal>Container</tt> does not destroy the <tt CLASS=literal>Component</tt>. The next time the method <tt CLASS=literal>addNotify()</tt> is called, the component must be recreated by the peer, with its previous characteristics. For instance, when a <tt CLASS=literal>TextField</tt> is removed, the current text, plus the start and stop points for the current selection, are saved. These will be restored if you add the text field to its container again. For some components, like a <tt CLASS=literal>Label</tt>, there is no need to retain any additional information. <P CLASS=para>A component's peer needs to exist only when the user is interacting with it. If you are developing resource-intensive programs, you might want to consider drawing the components manually when they do not have the focus and using the peer only when they actually have input focus. This technique can save a considerable amount of memory resources but requires extra work on your part as a developer and goes beyond the scope of this book. The <tt CLASS=literal>LightweightPeer</tt> interface appears to be designed to make this process easier: you could create a dummy button that doesn't do anything and uses the <tt CLASS=literal>LightweightPeer</tt>. Whenever the mouse enters the button's space, you could quickly remove the dummy button and add a real button. <P CLASS=para>The peer interfaces are listed in their entirety in the reference section. We won't list them here, primarily because you don't need to worry about them unless you're porting Java to a new platform. Each method in a peer interface corresponds exactly to the similarly named method in the matching component. <tt CLASS=literal>LightweightPeer</tt> is the only exception, because it doesn't have a matching component, but that's easy to take care of: as you'd expect, <tt CLASS=literal>LightweightPeer</tt> doesn't define any methods. (Of course, a peer that implements <tt CLASS=literal>LightweightPeer</tt> would still need to implement the methods inherited from <tt CLASS=literal>ComponentPeer</tt>, but those are inherited when you subclass <tt CLASS=literal>Component</tt>.) </DIV><DIV CLASS=htmlnav><P><HR align=left width=515><table width=515 border=0 cellpadding=0 cellspacing=0><tr><td width=172 align=left valign=top><A HREF="ch15_01.htm"><IMG SRC="gifs/txtpreva.gif" ALT="Previous" border=0></A></td><td width=171 align=center valign=top><a href="index.htm"><img src='gifs/txthome.gif' border=0 alt='Home'></a></td><td width=172 align=right valign=top><A HREF="ch16_01.htm"><IMG SRC="gifs/txtnexta.gif" ALT="Next" border=0></A></td></tr><tr><td width=172 align=left valign=top>Toolkit</td><td width=171 align=center valign=top><a href="index/idx_a.htm"><img src='gifs/index.gif' alt='Book Index' border=0></a></td><td width=172 align=right valign=top>Data Transfer</td></tr></table><hr align=left width=515><IMG SRC="gifs/smnavbar.gif" USEMAP="#map" BORDER=0> <MAP NAME="map"> <AREA SHAPE=RECT COORDS="0,0,108,15" HREF="../javanut/index.htm"alt="Java in a Nutshell"> <AREA SHAPE=RECT COORDS="109,0,200,15" HREF="../langref/index.htm" alt="Java Language Reference"> <AREA SHAPE=RECT COORDS="203,0,290,15" HREF="../awt/index.htm" alt="Java AWT"> <AREA SHAPE=RECT COORDS="291,0,419,15" HREF="../fclass/index.htm" alt="Java Fundamental Classes"> <AREA SHAPE=RECT COORDS="421,0,514,15" HREF="../exp/index.htm" alt="Exploring Java"> </MAP></DIV></BODY></HTML>