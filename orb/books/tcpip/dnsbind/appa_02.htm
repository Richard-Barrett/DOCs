<HTML><HEAD><TITLE>[Appendix A] A.2 DNS Message</TITLE><METANAME="DC.title"CONTENT="DNS &amp; BIND"><METANAME="DC.creator"CONTENT="Cricket Liu &amp; Paul Albitz"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:45:18Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-512-2"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="appa_01.htm"TITLE="A. DNS Message Format and Resource Records"><LINKREL="prev"HREF="appa_01.htm"TITLE="A.1 Master File Format"><LINKREL="next"HREF="appa_03.htm"TITLE="A.3 Header Section Format"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="DNS &amp; BIND"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="DNS &amp; BIND"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/dsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appa_01.htm"TITLE="A.1 Master File Format"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: A.1 Master File Format"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Appendix A<BR>DNS Message Format and ResourceRecords</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appa_03.htm"TITLE="A.3 Header Section Format"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: A.3 Header Section Format"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-18604">A.2 DNS Message</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-A-MESSAGES-FORMAT-OF"></A><ACLASS="indexterm"NAME="DNS3-IDX-A-PACKETS-MESSAGE-FORMAT"></A><ACLASS="indexterm"NAME="DNS3-IDX-A-FORMAT-PACKET-MESSAGE"></A>In order to write programs that parseDNS packets, you need to understand the message format. DNS queriesand responses are most often contained within UDP packets. Eachmessage is fully contained within a UDP packet. If the query and responseare sent over TCP, then they are prefixed with a two-byte valueindicating the length of the query or response, excluding the two-bytelength. The format and content of the DNS packet are as follows.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-18616">A.2.1 Format</A></H3><PCLASS="para">(From RFC 1035, page 25)</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-18620"></A>Allcommunications inside of the domain protocol are carried in a singleformat called a message. The top level format of message is divided into5 sections (some of which are empty in certain cases) shown below:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">    +---------------------+    |        Header       |    +---------------------+    |       Question      | the question for the name server    +---------------------+    |        Answer       | RRs answering the question    +---------------------+    |      Authority      | RRs pointing toward an authority    +---------------------+    |      Additional     | RRs holding additional information    +---------------------+</PRE></BLOCKQUOTE><PCLASS="para">The header section is always present. The headerincludes fields that specify which of the remaining sections arepresent, and also specify whether the message is a query or a response,a standard query or some other opcode, etc.</P><PCLASS="para">The namesof the sections after the header are derived from their use in standardqueries. The question section contains fields that describe a questionto a name server. These fields are a query type (QTYPE), a queryclass (QCLASS), and a query domain name (QNAME). The last threesections have the same format: a possibly empty list of concatenatedresource records (RRs). The answer section contains RRs that answerthe question; the authority section contains RRs that point towardan authoritative name server; the additional records section containsRRs which relate to the query, but are not strictly answers forthe question.</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appa_01.htm"TITLE="A.1 Master File Format"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: A.1 Master File Format"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="DNS &amp; BIND"><IMGSRC="../gifs/txthome.gif"ALT="DNS &amp; BIND"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appa_03.htm"TITLE="A.3 Header Section Format"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: A.3 Header Section Format"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">A.1 Master File Format</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">A.3 Header Section Format</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>