<HTML><HEAD><TITLE>[Chapter 2] 2.7 Caching</TITLE><METANAME="DC.title"CONTENT="DNS &amp; BIND"><METANAME="DC.creator"CONTENT="Cricket Liu &amp; Paul Albitz"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:24:15Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-512-2"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch02_01.htm"TITLE="2. How Does DNS Work?"><LINKREL="prev"HREF="ch02_06.htm"TITLE="2.6 Resolution"><LINKREL="next"HREF="ch03_01.htm"TITLE="3. Where Do I Start?"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="DNS &amp; BIND"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="DNS &amp; BIND"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/dsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_06.htm"TITLE="2.6 Resolution"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.6 Resolution"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 2<BR>How Does <SPANCLASS="acronym">DNS</SPAN> Work?</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch03_01.htm"TITLE="3. Where Do I Start?"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 3. Where Do I Start?"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="DNS3-CHP-2-CACHING">2.7 Caching</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-2-RESOLUTION-CACHING-AND"></A><ACLASS="indexterm"NAME="DNS3-IDX-2-QUERIES-CACHING-AND"></A><ACLASS="indexterm"NAME="DNS3-IDX-2-CACHING"></A><ACLASS="indexterm"NAME="DNS3-IDX-2-PERFORMANCE-CACHING"></A><ACLASS="indexterm"NAME="DNS3-IDX-2-RECURSIVE-RESOLUTION-CACHING-AND"></A><ACLASS="indexterm"NAME="AUTOID-1720"></A>The whole resolution process may seem awfully convoluted andcumbersome to someone accustomed to simple searches through the hosttable. Actually, it's usually quite fast. One of the features thatspeeds it up considerably is <ICLASS="firstterm">caching</I>.</P><PCLASS="para">A name server processing a recursive query may have to send outquite a few queries to find an answer. However, it discovers a lot ofinformation about the domain name space as it does so. Each time it'sreferred to another list of name servers, it learns that those nameservers are authoritative for some zone, and it learns the addressesof those servers. And, at the end of the resolution process, when itfinally finds the data the original querier sought, it can store thatdata for future reference, too. With version 4.9 and all version 8<SPANCLASS="acronym">BIND</SPAN>s, name servers even implement<ACLASS="indexterm"NAME="DNS3-IDX-2-NEGATIVE-CACHING"></A><ICLASS="firstterm">negative caching</I>: if an authoritative nameserver responds to a query with an answer that says the domain name ordata type in the query doesn't exist, the local name server willtemporarily cache that information, too. Name servers cache all ofthis data to help speed up successive queries. The next time aresolver queries the name server for data about a domain name the nameserver knows something about, the process is shortened quite abit. The name server may have cached the answer, positive or negative,in which case it simply returns the answer to the resolver. Even if itdoesn't have the answer cached, it may have learned the identities ofthe name servers that are authoritative for the zone the domain nameis in and be able to query them directly.</P><PCLASS="para">For example, say our name server has already looked up theaddress of <ICLASS="systemitem.sitename">eecs.berkeley.edu</I>.In the process, it cached the names and addresses of the <ICLASS="systemitem.sitename">eecs.berkeley.edu</I> and <ICLASS="systemitem.sitename">berkeley.edu</I> name servers (plus<ICLASS="systemitem.sitename">eecs.berkeley.edu</I>'s<SPANCLASS="acronym">IP</SPAN> address).  Now if a resolver were to query ourname server for the address of <ICLASS="systemitem.sitename">baobab.cs.berkeley.edu</I>, our name servercould skip querying the root name servers. Recognizing that<ICLASS="systemitem.sitename">berkeley.edu</I> is the closestancestor of <ICLASS="systemitem.sitename">baobab.cs.berkeley.edu</I> that it knowsabout, our name server would start by querying a <ICLASS="systemitem.sitename">berkeley.edu</I> name server, as shown in<ACLASS="xref"HREF="ch02_07.htm#DNS3-CHP-2-FIG-16"TITLE="Resolving baobab.cs.berkeley.edu">Figure 2.16</A>. On the other hand, if our nameserver had discovered that there was no address for <ICLASS="systemitem.sitename">eecs.berkeley.edu</I>, the next time itreceived a query for the address, it could simply have respondedappropriately from its cache.</P><H4CLASS="figure"><ACLASS="title"NAME="DNS3-CHP-2-FIG-16">Figure 2.16: Resolving baobab.cs.berkeley.edu</A></H4><IMGCLASS="graphic"SRC="figs/dns3_0216.gif"ALT="Figure 2.16"><PCLASS="para">In addition to speeding up resolution, caching prevents us fromhaving to query the root name servers again. This means that we're notas dependent on the roots, and they won't suffer as much from all ourqueries.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-1745">2.7.1 Time to Live</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-1748"></A><ACLASS="indexterm"NAME="AUTOID-1750"></A><ACLASS="indexterm"NAME="AUTOID-1752"></A><ACLASS="indexterm"NAME="AUTOID-1754"></A>Name servers can't cache data forever, of course. If they did, changesto that data on the authoritative name servers would never reach therest of the network. Remote name servers would just continue to usecached data. Consequently, the administrator of the zone that containsthe data decides on a <ICLASS="firstterm">time to live</I>, or<ICLASS="firstterm"><SPANCLASS="acronym">TTL</SPAN></I>, for the data. The timeto live is the amount of time that any name server is allowed to cachethe data. After the time to live expires, the name server must discardthe cached data and get new data from the authoritative nameservers. This also applies to negatively cached data; a name servermust time out a negative answer after a period, too, in case new datahas been added on the authoritative name servers. However, the time tolive for negatively cached data isn't tunable by the domainadministrator; it's hardcoded to ten minutes.</P><PCLASS="para">Deciding on a time to live for your data is essentially decidingon a trade-off between performance and consistency. A small<SPANCLASS="acronym">TTL</SPAN> will help ensure that data about your domain isconsistent across the network, because remote name servers will timeit out more quickly and be forced to query your authoritative nameservers more often for new data.  On the other hand, this willincrease the load on your name servers and lengthen resolution timefor information in your domain, on the average.</P><PCLASS="para">A large <SPANCLASS="acronym">TTL</SPAN> will shorten the average time ittakes to resolve information in your domain because the data can becached longer. The drawback is that your information will beinconsistent for a longer time if you make changes to your data onyour name servers.<ACLASS="indexterm"NAME="AUTOID-1764"></A><ACLASS="indexterm"NAME="AUTOID-1765"></A><ACLASS="indexterm"NAME="AUTOID-1766"></A><ACLASS="indexterm"NAME="AUTOID-1767"></A><ACLASS="indexterm"NAME="AUTOID-1768"></A><ACLASS="indexterm"NAME="AUTOID-1769"></A></P><PCLASS="para">Enough of this theory&nbsp;- I'll bet you're antsy to get on withthis. There's some homework necessary before you can set up yourdomain and your name servers, though, and we'll assign it in the nextchapter.<ACLASS="indexterm"NAME="AUTOID-1771"></A><ACLASS="indexterm"NAME="AUTOID-1773"></A><ACLASS="indexterm"NAME="AUTOID-1775"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_06.htm"TITLE="2.6 Resolution"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.6 Resolution"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="DNS &amp; BIND"><IMGSRC="../gifs/txthome.gif"ALT="DNS &amp; BIND"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch03_01.htm"TITLE="3. Where Do I Start?"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 3. Where Do I Start?"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">2.6 Resolution</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">3. Where Do I Start?</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>