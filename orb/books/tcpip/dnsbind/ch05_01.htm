<HTML><HEAD><TITLE>[Chapter 5] DNS and Electronic Mail</TITLE><METANAME="DC.title"CONTENT="DNS &amp; BIND"><METANAME="DC.creator"CONTENT="Cricket Liu &amp; Paul Albitz"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:28:21Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-512-2"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="index.htm"TITLE="DNS &amp; BIND"><LINKREL="prev"HREF="ch04_10.htm"TITLE="4.10 What Next?"><LINKREL="next"HREF="ch05_02.htm"TITLE="5.2 What's a Mail Exchanger, Again?"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="DNS &amp; BIND"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="DNS &amp; BIND"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/dsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch04_10.htm"TITLE="4.10 What Next?"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 4.10 What Next?"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 5</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_02.htm"TITLE="5.2 What's a Mail Exchanger, Again?"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.2 What's a Mail Exchanger, Again?"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="DNS3-CHP-5">5. <SPANCLASS="acronym">DNS</SPAN> and Electronic Mail</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#AUTOID-4100"TITLE="5.1 MX Records"><SPANCLASS="acronym">MX</SPAN> Records</A><BR><ACLASS="sect1"HREF="ch05_02.htm"TITLE="5.2 What's a Mail Exchanger, Again?">What's a Mail Exchanger, Again?</A><BR><ACLASS="sect1"HREF="ch05_03.htm"TITLE="5.3 The MX Algorithm">The <SPANCLASS="acronym">MX</SPAN> Algorithm</A></P><P></P></DIV><DIVCLASS="epigraph"><PCLASS="para"ALIGN="right"><I>And here Alice began to get rather sleepy, and went on sayingto herself, in a dreamy sort of way, <SPANCLASS="quote">"Do cats eat bats? Do catseat bats?"</SPAN> and sometimes <SPANCLASS="quote">"Do bats eat cats?"</SPAN> for,you see, as she couldn't answer either question, it didn't much matterwhich way she put it.</I></P></DIV><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-5-ELECTRONIC-MAIL"></A>I'll bet you're drowsy too, after that looong chapter. Thankfully,this next chapter discusses a topic that will probably be veryinteresting to you system administrators and postmasters: how<SPANCLASS="acronym">DNS</SPAN> impacts electronic mail. And even if it isn'tinteresting to you, at least it's shorter than the lastchapter.</P><PCLASS="para">One of the advantages of the Domain Name System over host tablesis its support of advanced mail routing. When mailers only hadthe <ICLASS="filename">HOSTS.TXT</I> file (and its derivative,<ICLASS="filename">/etc/hosts</I>) to work with, the best they could dowas to attempt delivery to a host's <SPANCLASS="acronym">IP</SPAN> address. Ifthat failed, they could either defer delivery of the message and tryagain later, or bounce the message back to the sender.</P><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN> offers a mechanism for specifying backuphosts for mail delivery. The mechanism also allows hosts to assumemail handling responsibilities for other hosts. This lets disklesshosts that don't run mailers, for example, have mail addressed to themprocessed by their server. Together, these features giveadministrators much more flexibility in configuring electronic mail ontheir network.</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-4100">5.1 <SPANCLASS="acronym">MX</SPAN> Records</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4104"></A><ACLASS="indexterm"NAME="DNS3-IDX-5-MX-RECORDS"></A><ACLASS="indexterm"NAME="DNS3-IDX-5-ELECTRONIC-MAIL-MX-RECORDS"></A><SPANCLASS="acronym">DNS</SPAN> uses a single type of resource record toimplement enhanced mail routing, the<ICLASS="wordasword"><SPANCLASS="acronym">MX</SPAN></I> record. Originally,this functionality was split between two records, the<ICLASS="wordasword"><SPANCLASS="acronym">MD</SPAN></I> (mail destination) and<ICLASS="wordasword"><SPANCLASS="acronym">MF</SPAN></I> (mail forwarder)records.  <SPANCLASS="acronym">MD</SPAN> specified the final destination towhich a message addressed to a given domain name should bedelivered. <SPANCLASS="acronym">MF</SPAN> specified a host that would forwardmail on to the eventual destination, should that destination beunreachable.</P><PCLASS="para">Early experience with <SPANCLASS="acronym">DNS</SPAN> on the Internetshowed that separating the functionality didn't work very well.  Amailer needed both the <SPANCLASS="acronym">MD</SPAN> and <SPANCLASS="acronym">MF</SPAN>records attached to a domain name (if both existed) to decide where tosend the mail&nbsp;- one or the other alone wouldn't do. But anexplicit lookup of one type or another (either <SPANCLASS="acronym">MD</SPAN>or <SPANCLASS="acronym">MF</SPAN>) would cause a name server to cache just thatrecord type. So mailers either had to do two queries, one for<SPANCLASS="acronym">MD</SPAN> and one for <SPANCLASS="acronym">MF</SPAN> data, or theycould no longer accept cached answers. This meant that the overhead ofrunning mail was higher than that of running other services, and waseventually deemed unacceptable.</P><PCLASS="para">The two records were integrated into a single record type,<SPANCLASS="acronym">MX</SPAN>, to solve this problem. Now a mailer just neededall the <SPANCLASS="acronym">MX</SPAN> records for a particular domain namedestination to make a mail routing decision. Using cached<SPANCLASS="acronym">MX</SPAN> records was fine, as long as the<SPANCLASS="acronym">TTL</SPAN>s matched.</P><PCLASS="para"><SPANCLASS="acronym">MX</SPAN> records specify a<ACLASS="indexterm"NAME="AUTOID-4137"></A><ACLASS="indexterm"NAME="AUTOID-4139"></A><ACLASS="indexterm"NAME="AUTOID-4142"></A><ACLASS="indexterm"NAME="AUTOID-4145"></A><ICLASS="firstterm">mail exchanger</I> for a domain name: a host thatwill <EMCLASS="emphasis">either</EM> process <EMCLASS="emphasis">or</EM>forward mail for the domain name (through a firewall, forexample). <SPANCLASS="quote">"Processing"</SPAN> the mail means either deliveringit to the individual it's addressed to, or gatewaying it to anothermail transport, like<SPANCLASS="acronym">UUCP</SPAN>. <SPANCLASS="quote">"Forwarding"</SPAN> means sending it toits final destination or to another mail exchanger<SPANCLASS="quote">"closer"</SPAN> to the destination via <SPANCLASS="acronym">SMTP</SPAN>,the Internet's Simple Mail Transfer Protocol. Sometimes forwarding themail involves queuing it for some amount of time, too.</P><PCLASS="para">In order to prevent mail routing loops, the<SPANCLASS="acronym">MX</SPAN> record has an extra parameter, besides thedomain name of the mail exchanger: a<ACLASS="indexterm"NAME="AUTOID-4158"></A>preference value. The preference value is an unsigned 16-bit number(between 0 and 65535) that indicates the mail exchanger'spriority. For example, the <SPANCLASS="acronym">MX</SPAN> record:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">peets.mpk.ca.us.    IN    MX    10 relay.hp.com.</PRE></BLOCKQUOTE><PCLASS="para">specifies that <ICLASS="systemitem.sitename">relay.hp.com</I> is a mail exchanger for<ICLASS="systemitem.sitename">peets.mpk.ca.us</I> at preferencevalue 10.</P><PCLASS="para">Taken together, the preference values of a host's mailexchangers determine the order in which a mailer should use them. Thepreference value itself isn't important, only its relationship to thevalues of other mail exchangers: is it higher or lower than the valuesof this host's other mail exchangers? Unless there are other recordsinvolved:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">plange.puntacana.dr.  IN  MX  1 listo.puntacana.dr.plange.puntacana.dr.  IN  MX  2 hep.puntacana.dr.</PRE></BLOCKQUOTE><PCLASS="para">does exactly the same thing as:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">plange.puntacana.dr.  IN  MX  50  listo.puntacana.dr.plange.puntacana.dr.  IN  MX  100 hep.puntacana.dr.</PRE></BLOCKQUOTE><PCLASS="para">Mailers should attempt delivery to the mail exchangers with the<EMCLASS="emphasis">lowest</EM> preference values first. This seems alittle counterintuitive at first&nbsp;- the <EMCLASS="emphasis">most</EM>preferred mail exchanger has the <EMCLASS="emphasis">lowest</EM>preference value.  But since the preference value is an unsignedquantity, this lets you specify a <SPANCLASS="quote">"best"</SPAN> mail exchangerat preference value 0.</P><PCLASS="para">If delivery to the most preferred mail exchanger(s) fails,mailers should attempt delivery to less preferred mail exchangers(those with <EMCLASS="emphasis">higher</EM> preference values), in orderof increasing preference value. That is, mailers should try morepreferred mail exchangers before they try less preferred mailexchangers.  More than one mail exchanger may share the samepreference value, too. This gives the mailer its choice of which tosend to first.[1] The mailer should try all the mail exchangers at a givenpreference value before proceeding to the next higher value,though.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] The newest version of <KBDCLASS="command">sendmail</KBD>, version 8,will actually choose randomly among mail exchangers at the samepreference.</P></BLOCKQUOTE><PCLASS="para">For example, the <SPANCLASS="acronym">MX</SPAN> records for <ICLASS="systemitem.sitename">ora.com</I> might be:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">ora.com.    IN    MX    0 ora.ora.com.ora.com.    IN    MX    10 ruby.ora.com.ora.com.    IN    MX    10 opal.ora.com.</PRE></BLOCKQUOTE><PCLASS="para">Interpreted together, these <SPANCLASS="acronym">MX</SPAN> recordsinstruct mailers to attempt delivery to <ICLASS="systemitem.sitename">ora.com</I> by sending to:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para"><ICLASS="systemitem.sitename">ora.ora.com</I>first</P></LI><LICLASS="listitem"><PCLASS="para">Either <ICLASS="systemitem.sitename">ruby.ora.com</I> or<ICLASS="systemitem.sitename">opal.ora.com</I> next, andfinally</P></LI><LICLASS="listitem"><PCLASS="para">The remaining preference 10 mail exchanger (the one not used in2)</P></LI></OL><PCLASS="para">Of course, once the mailer successfully delivers the mail to oneof <ICLASS="systemitem.sitename">ora.com</I>'s mail exchangers,it can stop. A mailer successfully delivering <ICLASS="systemitem.sitename">ora.com</I> mail to <ICLASS="systemitem.sitename">ora.ora.com</I> doesn't need to try<ICLASS="systemitem.sitename">ruby</I> or <ICLASS="systemitem.sitename">opal</I>.</P><PCLASS="para">What if a host doesn't have any <SPANCLASS="acronym">MX</SPAN> records?Will a mailer simply not deliver mail to that host? Actually, you cancompile recent versions of<ACLASS="indexterm"NAME="AUTOID-4204"></A><KBDCLASS="command">sendmail</KBD> to do just that. Most vendors, however,have compiled their <KBDCLASS="command">sendmail</KBD>s to be more forgiving:if no <SPANCLASS="acronym">MX</SPAN> records exist, they'll at least attemptdelivery to the host's address. <KBDCLASS="command">sendmail</KBD> version 8,compiled <SPANCLASS="quote">"out of the box,"</SPAN> will try the address of a maildestination without <SPANCLASS="acronym">MX</SPAN> records. Check your vendor'sdocumentation if you're not sure which variety your<KBDCLASS="command">sendmail</KBD> is.</P><PCLASS="para">Even though nearly all mailers will deliver mail to a host withjust an address, and no <SPANCLASS="acronym">MX</SPAN> records, it's still agood idea to have at least one <SPANCLASS="acronym">MX</SPAN> record for eachhost. <KBDCLASS="command">sendmail</KBD> will request <SPANCLASS="acronym">MX</SPAN>records for a host each time it needs to deliver mail.  If the hostdoesn't have any <SPANCLASS="acronym">MX</SPAN> records, a nameserver&nbsp;- usually one of your authoritative nameservers&nbsp;- still ends up answering that query. If you simply add an<SPANCLASS="acronym">MX</SPAN> record for the host pointing to itself,<KBDCLASS="command">sendmail</KBD> will have its first query answered, andthe mailer's local name server will cache the <SPANCLASS="acronym">MX</SPAN>record for future use.<ACLASS="indexterm"NAME="AUTOID-4222"></A><ACLASS="indexterm"NAME="AUTOID-4223"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch04_10.htm"TITLE="4.10 What Next?"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 4.10 What Next?"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="DNS &amp; BIND"><IMGSRC="../gifs/txthome.gif"ALT="DNS &amp; BIND"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_02.htm"TITLE="5.2 What's a Mail Exchanger, Again?"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.2 What's a Mail Exchanger, Again?"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">4.10 What Next?</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">5.2 What's a Mail Exchanger, Again?</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>