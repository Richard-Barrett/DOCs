<HTML><HEAD><TITLE>[Chapter 7] Maintaining BIND</TITLE><METANAME="DC.title"CONTENT="DNS &amp; BIND"><METANAME="DC.creator"CONTENT="Cricket Liu &amp; Paul Albitz"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:30:00Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-512-2"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="index.htm"TITLE="DNS &amp; BIND"><LINKREL="prev"HREF="ch06_04.htm"TITLE="6.4 Vendor-Specific Options"><LINKREL="next"HREF="ch07_02.htm"TITLE="7.2 Updating db Files"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="DNS &amp; BIND"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="DNS &amp; BIND"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/dsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_04.htm"TITLE="6.4 Vendor-Specific Options"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 6.4 Vendor-Specific Options"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 7</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 Updating db Files"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.2 Updating db Files"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="DNS3-CHP-7">7. Maintaining <SPANCLASS="acronym">BIND</SPAN></A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#AUTOID-6296"TITLE="7.1 BIND Name Server Signals"><SPANCLASS="acronym">BIND</SPAN> Name Server Signals</A><BR><ACLASS="sect1"HREF="ch07_02.htm"TITLE="7.2 Updating db Files">Updating db Files</A><BR><ACLASS="sect1"HREF="ch07_03.htm"TITLE="7.3 Organizing Your Files">Organizing Your Files</A><BR><ACLASS="sect1"HREF="ch07_04.htm"TITLE="7.4 Changing BIND 8 System File Locations">Changing <SPANCLASS="acronym">BIND</SPAN> 8 System FileLocations</A><BR><ACLASS="sect1"HREF="ch07_05.htm"TITLE="7.5 BIND 8 Logging"><SPANCLASS="acronym">BIND</SPAN> 8 Logging</A><BR><ACLASS="sect1"HREF="ch07_06.htm"TITLE="7.6 Keeping Everything Running Smoothly">Keeping Everything Running Smoothly</A></P><P></P></DIV><DIVCLASS="epigraph"><PCLASS="para"ALIGN="right"><I><SPANCLASS="quote">"Well, in our country,"</SPAN> said Alice, still panting alittle, <SPANCLASS="quote">"you'd generally get to somewhere else&nbsp;- if you ranvery fast for a long time as we've been doing."</SPAN></I></P><PCLASS="para"ALIGN="right"><I><SPANCLASS="quote">"A slow sort of country!"</SPAN> said theQueen. <SPANCLASS="quote">"Now, here, you see, it takes all the running you can do,to keep in the same place. If you want to get somewhere else, you mustrun at least twice as fast as that!"</SPAN></I></P></DIV><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-7-NAME-SERVERS-MAINTAINING"></A><ACLASS="indexterm"NAME="DNS3-IDX-7-ADMINISTRATION-NAME-SERVER-MAINTENANCE"></A><ACLASS="indexterm"NAME="DNS3-IDX-7-BIND-BERKELEY-INTERNET-NAME-DOMAIN-NAME-SERVER-MAINTAINENCE"></A><ACLASS="indexterm"NAME="AUTOID-6288"></A>This chapter discusses a number of related topics pertaining to nameserver maintenance. We'll talk about sending signals to name servers,modifying the db files, and keeping <ICLASS="filename">db.cache</I> upto date. We'll list common syslog error messages and explain thestatistics <SPANCLASS="acronym">BIND</SPAN> keeps.</P><PCLASS="para">This chapter doesn't cover troubleshooting problems. Maintenanceinvolves keeping your data current and watching over your name serversas they operate. Troubleshooting involves putting outfires&nbsp;- those little <SPANCLASS="acronym">DNS</SPAN> emergencies that flareup periodically. Firefighting is covered in <ACLASS="xref"HREF="ch13_01.htm"TITLE="Troubleshooting DNS and BIND">Chapter 13, <CITECLASS="chapter">Troubleshooting <SPANCLASS="acronym">DNS</SPAN> and<SPANCLASS="acronym">BIND</SPAN></CITE></A>.</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-6296">7.1 <SPANCLASS="acronym">BIND</SPAN> Name Server Signals</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-7-SIGNALS"></A><ACLASS="indexterm"NAME="DNS3-IDX-7-NAMED-DAEMON-SIGNALS"></A><ACLASS="indexterm"NAME="DNS3-IDX-7-BIND-BERKELEY-INTERNET-NAME-DOMAIN-NAME-SERVER-SIGNALS"></A><ACLASS="indexterm"NAME="DNS3-IDX-7-NAME-SERVERS-SIGNALS"></A>In day-to-day operation, the <SPANCLASS="acronym">BIND</SPAN> name server,<KBDCLASS="command">named</KBD>, is manipulated with signals. We'll use themin this chapter and in other chapters. Here's a list of the signalsyou can send to a name server and a short description of the actioneach signal causes. Each of these signals will be discussed in moredetail elsewhere in this book. (On some systems, the files listedbelow will be found in <ICLASS="filename">/var/tmp</I> instead of<ICLASS="filename">/usr/tmp</I>.)</P><DLCLASS="variablelist"><DTCLASS="term"><ACLASS="indexterm"NAME="AUTOID-6318"></A><SPANCLASS="acronym">HUP</SPAN></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-6324"></A><ACLASS="indexterm"NAME="AUTOID-6327"></A><ACLASS="indexterm"NAME="AUTOID-6329"></A>Reload the name server. Send this signal to a primary master nameserver after modifying its configuration file or one of its databasefiles.  Send this signal to a 4.9 or later slave name server to causeit to update its slave zones if they are not current.</P></DD><DTCLASS="term"><ACLASS="indexterm"NAME="AUTOID-6333"></A><SPANCLASS="acronym">INT</SPAN></DT><DDCLASS="listitem"><PCLASS="para">Dump a copy of the name server's internal database to<ICLASS="filename">named_dump.db</I> in <ICLASS="filename">/usr/tmp</I>(version 4) or in the name server's current directory (version8).</P></DD><DTCLASS="term"><ACLASS="indexterm"NAME="AUTOID-6343"></A><SPANCLASS="acronym">ABRT</SPAN> (version 4)</DT><DDCLASS="listitem"><PCLASS="para">Append the name server's statistics to<ICLASS="filename">/usr/tmp/named.stats</I>.  This signal may be called<SPANCLASS="acronym">IOT</SPAN> on your system.</P></DD><DTCLASS="term"><ACLASS="indexterm"NAME="AUTOID-6353"></A><SPANCLASS="acronym">ILL</SPAN> (version 8)</DT><DDCLASS="listitem"><PCLASS="para">Append the name server's statistics to<ICLASS="filename">named.stats</I> in the name server's currentdirectory.</P></DD><DTCLASS="term"><ACLASS="indexterm"NAME="AUTOID-6361"></A><SPANCLASS="acronym">USR</SPAN>1</DT><DDCLASS="listitem"><PCLASS="para">Append debugging information to <ICLASS="filename">named.run</I>in <ICLASS="filename">/usr/tmp</I> (version 4) or in the name server'scurrent directory (version 8).  Each subsequent<SPANCLASS="acronym">USR</SPAN>1 signal increases the amount of detail in thedebugging information. For information on what is logged at eachlevel, see <ACLASS="xref"HREF="ch12_01.htm"TITLE="Reading BIND Debugging Output">Chapter 12, <CITECLASS="chapter">Reading <SPANCLASS="acronym">BIND</SPAN> Debugging Output</CITE></A>.</P></DD><DTCLASS="term"><SPANCLASS="acronym">USR</SPAN>2</DT><DDCLASS="listitem"><PCLASS="para">Turn off debugging.</P></DD><DTCLASS="term"><ACLASS="indexterm"NAME="AUTOID-6379"></A><SPANCLASS="acronym">WINCH</SPAN></DT><DDCLASS="listitem"><PCLASS="para">Toggle logging all queries with syslog. Logging takes place atpriority <SPANCLASS="acronym">LOG_INFO</SPAN>. <KBDCLASS="command">named</KBD> must becompiled with <SPANCLASS="acronym">QRYLOG</SPAN> defined (it is defined bydefault). This feature did not exist in version 4.8.3.</P></DD><DTCLASS="term"><ACLASS="indexterm"NAME="AUTOID-6390"></A><SPANCLASS="acronym">TERM</SPAN> (version 8)</DT><DDCLASS="listitem"><PCLASS="para">Exit and save dynamic zones to files.</P></DD></DL><PCLASS="para">The 4.9 and later distributions provide a handy shell script forsending these signals, called<ACLASS="indexterm"NAME="AUTOID-6396"></A><ACLASS="indexterm"NAME="AUTOID-6398"></A><KBDCLASS="command">ndc</KBD>. Check out the manpage for the command syntaxor just run <KBDCLASS="command">ndc</KBD> without any options and it willdisplay a usage message. Be careful not to use a<SPANCLASS="acronym">BIND</SPAN> 4 version of <KBDCLASS="command">ndc</KBD> with a<SPANCLASS="acronym">BIND</SPAN> 8 name server since the signal to send forstatistics has changed. If you don't have <KBDCLASS="command">ndc</KBD>,you'll have to send the signals manually.  Read on.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-6410"></A><ACLASS="indexterm"NAME="AUTOID-6413"></A><ACLASS="indexterm"NAME="AUTOID-6415"></A>To send a name server a signal, you must first find the name server'sprocess <SPANCLASS="acronym">ID</SPAN>. The <SPANCLASS="acronym">BIND</SPAN> name serverleaves its process <SPANCLASS="acronym">ID</SPAN> in a disk file, making iteasier to chase the critter down&nbsp;- you don't have to use<KBDCLASS="command">ps</KBD>. The most common place for the process<SPANCLASS="acronym">ID</SPAN> to be left is<ICLASS="filename">/etc/named.pid</I>. On some systems, the process<SPANCLASS="acronym">ID</SPAN> is in<ICLASS="filename">/var/run/named.pid</I>. Check the<KBDCLASS="command">named</KBD> manual page to see which directory<ICLASS="filename">named.pid</I> is in on your system. Since the nameserver process <SPANCLASS="acronym">ID</SPAN> is in a file, sending a<SPANCLASS="acronym">HUP</SPAN> signal can be as simple as:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>kill -HUP `cat /etc/named.pid`</B></CODE></PRE></BLOCKQUOTE><PCLASS="para">If you can't find the process <SPANCLASS="acronym">ID</SPAN> in a file,you can always find the process <SPANCLASS="acronym">ID</SPAN> with<ACLASS="indexterm"NAME="AUTOID-6435"></A><KBDCLASS="command">ps</KBD>. On a <SPANCLASS="acronym">BSD</SPAN>-based systemuse:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>ps -ax | grep named</B></CODE></PRE></BLOCKQUOTE><PCLASS="para">On a <SPANCLASS="acronym">SYS</SPAN> V-based system use:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>ps -ef | grep named</B></CODE></PRE></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-6446"></A><ACLASS="indexterm"NAME="AUTOID-6449"></A><ACLASS="indexterm"NAME="AUTOID-6452"></A>However, you may find more than one name server running if you use<KBDCLASS="command">ps</KBD>, since name servers spawn children to performzone transfers. During a zone transfer, the name server pulling thezone data starts a child process, and the name server providing thezone data may start a child process.  We'll digress a little here andexplain why child processes are used.</P><PCLASS="para">A slave name server starts a child process to perform a zonetransfer. This allows the slave name server to keep answering querieswhile the zone data is being transferred from the master server to thelocal disk by the child process. Once the zone is on the local disk,the slave name server reads in the new data. Using a child process todo the zone transfer fixed a problem with pre-4.8.3 versions of<SPANCLASS="acronym">BIND</SPAN>, in which slave name servers wouldn't answerqueries during a zone transfer. This could be a real nuisance on nameservers that loaded lots of zones or large zones: they'd go silent forlong periods of time.</P><PCLASS="para">A version 8 primary master name server does <EMCLASS="emphasis">not</EM> spawn a childprocess to provide a zone to a slave name server.  Instead, theprimary master server transfers the zone at the same time it isanswering queries.  If the primary master server loads a new copy ofthe zone from a disk file while a zone transfer is in progress, itwill abort the zone transfer in progress and load the new zone fromthe disk file.  The slave server will have to attempt the zonetransfer again after the primary master has completed loading the newzone.</P><PCLASS="para">A version 4 primary master name server starts a child process toprovide a zone to a slave name server.  This creates extra load on thehost running the primary master server, especially if the zones arevery large or many zone transfers are active at one time.</P><PCLASS="para">If the <KBDCLASS="command">ps</KBD> output shows multiple name servers,you should be able to tell easily which name server process is theparent and which processes are children. A child name server startedby a slave server to pull a copy of a zone is called<ACLASS="indexterm"NAME="AUTOID-6463"></A><KBDCLASS="command">named-xfer</KBD> instead of<KBDCLASS="command">named</KBD>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">root  548 547  0 22:03:17 ?     0:00 named-xfer -z movie.edu      -f /usr/tmp/NsTmp0 -s 0 -P 53 192.249.249.3</PRE></BLOCKQUOTE><PCLASS="para">A child name server started by a master name server changes itscommand-line options to indicate which slave server it is providingthe zone to:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">root 1137 1122 6 22:03:18 ?     0:00 /etc/named -zone XFR     to [192.249.249.1]</PRE></BLOCKQUOTE><PCLASS="para">You may encounter a version of <KBDCLASS="command">named</KBD> thatdoesn't change its command line, but you can still figure out therelationship between multiple <KBDCLASS="command">named</KBD> processes byexamining their process <SPANCLASS="acronym">ID</SPAN>s and parent process<SPANCLASS="acronym">ID</SPAN>s. All the child processes will have the parentname server's process <SPANCLASS="acronym">ID</SPAN> as their parent process<SPANCLASS="acronym">ID</SPAN>. This may seem like stating the obvious, butonly send signals to the <EMCLASS="emphasis">parent</EM> name serverprocess.  The child processes will go away after the zone transferscomplete.<ACLASS="indexterm"NAME="AUTOID-6478"></A><ACLASS="indexterm"NAME="AUTOID-6479"></A><ACLASS="indexterm"NAME="AUTOID-6480"></A><ACLASS="indexterm"NAME="AUTOID-6481"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_04.htm"TITLE="6.4 Vendor-Specific Options"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 6.4 Vendor-Specific Options"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="DNS &amp; BIND"><IMGSRC="../gifs/txthome.gif"ALT="DNS &amp; BIND"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 Updating db Files"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.2 Updating db Files"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">6.4 Vendor-Specific Options</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">7.2 Updating db Files</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>