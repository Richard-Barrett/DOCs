<HTML><HEAD><TITLE>[Chapter 7] 7.6 Keeping Everything Running Smoothly</TITLE><METANAME="DC.title"CONTENT="DNS &amp; BIND"><METANAME="DC.creator"CONTENT="Cricket Liu &amp; Paul Albitz"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:31:48Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-512-2"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch07_01.htm"TITLE="7. Maintaining BIND"><LINKREL="prev"HREF="ch07_05.htm"TITLE="7.5 BIND 8 Logging"><LINKREL="next"HREF="ch08_01.htm"TITLE="8. Growing Your Domain"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="DNS &amp; BIND"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="DNS &amp; BIND"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/dsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_05.htm"TITLE="7.5 BIND 8 Logging"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.5 BIND 8 Logging"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 7<BR>Maintaining <SPANCLASS="acronym">BIND</SPAN></FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch08_01.htm"TITLE="8. Growing Your Domain"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8. Growing Your Domain"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-7430">7.6 Keeping Everything Running Smoothly</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-7-PERFORMANCE-MONITORING-NAME-SERVERS"></A><ACLASS="indexterm"NAME="AUTOID-7436"></A><ACLASS="indexterm"NAME="AUTOID-7439"></A>A<ACLASS="indexterm"NAME="DNS3-IDX-7-NAME-SERVERS-MAINTAINING-MONITORING-NAME-SERVERS"></A><ACLASS="indexterm"NAME="DNS3-IDX-7-ADMINISTRATION-NAME-SERVER-MAINTENANCE-MONITORING-NAME-SERVERS"></A><ACLASS="indexterm"NAME="DNS3-IDX-7-BIND-BERKELEY-INTERNET-NAME-DOMAIN-NAME-SERVER-MAINTAINENCE-MONITORING-NAME-SERVERS"></A><ACLASS="indexterm"NAME="DNS3-IDX-7-MONITORING-NAME-SERVERS"></A>significant part of maintenance is being aware when something has gonewrong, before it becomes a real problem. If you catch a problem early,chances are it'll be that much easier to fix. As the old adage says,an ounce of prevention is worth a pound of cure.</P><PCLASS="para">This isn't quite troubleshooting&nbsp;- we'll devote an entirechapter to troubleshooting later&nbsp;- think of it as<SPANCLASS="quote">"pre-troubleshooting."</SPAN> Troubleshooting (the pound ofcure) is what you have to do if you ignore maintenance, after yourproblem has developed complications, and you need to identify theproblem by its symptoms.</P><PCLASS="para">The next two sections deal with preventative maintenance:looking periodically at the <KBDCLASS="command">syslog</KBD> file and at the<SPANCLASS="acronym">BIND</SPAN> name server statistics to see whether anyproblems are developing.  Consider this a name server's medicalcheckup.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-7461">7.6.1 Common Syslog Messages</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-7-SYSLOG-MESSAGES"></A><ACLASS="indexterm"NAME="DNS3-IDX-7-NAMED-DAEMON-SYSLOG-MESSAGES"></A><ACLASS="indexterm"NAME="DNS3-IDX-7-ERRORS-COMMON-SYSLOG-MESSAGES"></A>There are a large number of syslog messages <KBDCLASS="command">named</KBD>can emit. In practice, you'll only see a few of them. We'll cover themost common syslog messages here, excluding reports of syntax errorsin <SPANCLASS="acronym">DNS</SPAN> database files.</P><PCLASS="para">Every time you start <KBDCLASS="command">named</KBD>, it sends out thismessage at priority <SPANCLASS="acronym">LOG_NOTICE</SPAN>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan 10 20:48:32 terminator named[3221]: starting.  named 8.1.2</PRE></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7479"></A>This message logs the fact that <KBDCLASS="command">named</KBD> started atthis time, and tells you the version of <SPANCLASS="acronym">BIND</SPAN> you'rerunning. This is, of course, nothing to be concerned about. It<EMCLASS="emphasis">is</EM> a good place to look if you're not sure whatversion of <SPANCLASS="acronym">BIND</SPAN> your operating system supports.(Older versions of <SPANCLASS="acronym">BIND</SPAN> used<SPANCLASS="quote">"restarted"</SPAN> instead of <SPANCLASS="quote">"starting."</SPAN>)</P><PCLASS="para">Every time you send the name server a <SPANCLASS="acronym">HUP</SPAN>signal, it sends out this message at priority<SPANCLASS="acronym">LOG_NOTICE</SPAN>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan 10 20:50:16 terminator named[3221]: reloading nameserver<ACLASS="indexterm"NAME="AUTOID-7492"></A></PRE></BLOCKQUOTE><PCLASS="para">The <SPANCLASS="quote">"reloading"</SPAN> message just tells you that<KBDCLASS="command">named</KBD> reloaded its database (as a result of a<SPANCLASS="acronym">HUP</SPAN> signal) at this time. Again, this is nothing tobe concerned about. This message will most likely be of interest whenyou are tracking down how long a bad resource record has been in yourname server data or how long a whole zone has been missing because ofa mistake during an update.</P><PCLASS="para">Another message you may see shortly after your name serverstarts is:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan 10 20:50:20 terminator named[3221]: cannot set resource limits on                this system<ACLASS="indexterm"NAME="AUTOID-7500"></A></PRE></BLOCKQUOTE><PCLASS="para">This means that your name server thinks your operating systemdoes not support the <ICLASS="function">getrlimit()</I> and<ICLASS="function">setrlimit()</I> system calls, which are used when youtry to define <ICLASS="parameter">coresize</I>, <ICLASS="parameter">datasize</I>, <ICLASS="parameter">stacksize</I> or <ICLASS="parameter">files</I> on a<SPANCLASS="acronym">BIND</SPAN> 8 name server.  It doesn't matter whetheryou're actually using any of these substatements in your configurationfile; <SPANCLASS="acronym">BIND</SPAN> will print the message anyway.  Ifyou're not <EMCLASS="emphasis">using</EM> these substatements, ignore the message.  If you are,and you think your operating system does support<ICLASS="function">getrlimit()</I> and <ICLASS="function">setrlimit()</I>,you'll have to recompile <SPANCLASS="acronym">BIND</SPAN> with<ICLASS="parameter">HAVE_GETRUSAGE</I> defined.  This message in logged atpriority <SPANCLASS="acronym">LOG_INFO</SPAN>.</P><PCLASS="para">If you run your name server on a host with many networkinterfaces, especially virtual network interfaces, you may see thismessage soon after startup, or even after your name server has runwell for a while:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan 10 20:50:31 terminator named[3221]: fcntl(dfd, F_DUPFD, 20): Too                many open files<ACLASS="indexterm"NAME="AUTOID-7519"></A><ACLASS="indexterm"NAME="AUTOID-7521"></A>Jan 10 20:50:31 terminator named[3221]: fcntl(sfd, F_DUPFD, 20): Too                many open files</PRE></BLOCKQUOTE><PCLASS="para">This means that <SPANCLASS="acronym">BIND</SPAN> has run out of<ACLASS="indexterm"NAME="AUTOID-7525"></A>file descriptors.  <SPANCLASS="acronym">BIND</SPAN> uses a fair number of filedescriptors: two for each network interface it's listening on (one for<SPANCLASS="acronym">UDP</SPAN> and one for <SPANCLASS="acronym">TCP</SPAN>), and onefor opening zone data files.  If that's more than the limit youroperating system places on processes, <SPANCLASS="acronym">BIND</SPAN> won't beable to get any more file descriptors and you'll see this message.The priority will depend on which part of <SPANCLASS="acronym">BIND</SPAN>fails to get the file descriptor: the more critical the subsystem, thehigher the priority.</P><PCLASS="para">The next step is to either get <SPANCLASS="acronym">BIND</SPAN> to usefewer file descriptors, or to raise the limit the operating systemplaces on the number of file descriptors <SPANCLASS="acronym">BIND</SPAN> canuse:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">If you don't need <SPANCLASS="acronym">BIND</SPAN> listening on all ofyour network interfaces (particularly the virtual ones), use the<ICLASS="function">listen-on</I> substatement to configure <SPANCLASS="acronym">BIND</SPAN> to listenonly on those interfaces it needs to.  See <ACLASS="xref"HREF="ch10_01.htm"TITLE="Advanced Features and Security">Chapter 10</A> for details on the syntax of <ICLASS="function">listen-on</I>.</P></LI><LICLASS="listitem"><PCLASS="para">If your operating system supports <ICLASS="function">getrlimit()</I> and <ICLASS="function">setrlimit()</I>(see above), configure your name server to use a larger number offiles with the <ICLASS="function">files</I> substatement.  See <ACLASS="xref"HREF="ch10_01.htm"TITLE="Advanced Features and Security">Chapter 10</A>for details on using the <ICLASS="function">files</I> substatement.</P></LI><LICLASS="listitem"><PCLASS="para">If your operating system places too restrictive a limit on openfiles, raise that limit before you start <KBDCLASS="command">named</KBD> withthe <KBDCLASS="command">ulimit</KBD> command.</P></LI></UL><PCLASS="para">Every time a <SPANCLASS="acronym">BIND</SPAN> 8 name server loads a zone,it sends out a message at priority <SPANCLASS="acronym">LOG_INFO</SPAN>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan 10 21:49:50 terminator named[3221]: master zone &quot;movie.edu&quot; (IN)                loaded(serial 1996011000)<ACLASS="indexterm"NAME="AUTOID-7558"></A><ACLASS="indexterm"NAME="AUTOID-7560"></A></PRE></BLOCKQUOTE><PCLASS="para">(<SPANCLASS="acronym">BIND</SPAN> 4.9 name servers call it a<SPANCLASS="quote">"primary zone"</SPAN> instead of a <SPANCLASS="quote">"master zone."</SPAN>)This tells you when the name server loaded the zone, the class (inthis case, <SPANCLASS="acronym">IN</SPAN>) of the zone, and the serial numberin the zone's <SPANCLASS="acronym">SOA</SPAN> record.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7569"></A><ACLASS="indexterm"NAME="AUTOID-7571"></A><ACLASS="indexterm"NAME="AUTOID-7573"></A><ACLASS="indexterm"NAME="AUTOID-7575"></A>About every hour, a <SPANCLASS="acronym">BIND</SPAN> 8 name server will send amessage at priority <SPANCLASS="acronym">LOG_INFO</SPAN> that snapshots thecurrent statistics:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Feb 18 14:09:02 terminator named[3565]: USAGE 824681342 824600158                CPU=13.01u/3.26s CHILDCPU=9.99u/12.71sFeb 18 14:09:02 terminator named[3565]: NSTATS 824681342 824600158                A=4 PTR=2Feb 18 14:09:02 terminator named[3565]: XSTATS 824681342 824600158                RQ=6 RR=2 RIQ=0 RNXD=0 RFwdQ=0 RFwdR=0 RDupQ=0 RDupR=0                RFail=0 RFErr=0 RErr=0 RTCP=0 RAXFR=0 RLame=0 Ropts=0                SSysQ=2 SAns=6 SFwdQ=0 SFwdR=0 SDupQ=5 SFail=0 SFErr=0                SErr=0 RNotNsQ=6 SNaAns=2 SNXD=1</PRE></BLOCKQUOTE><PCLASS="para">(This feature was also present in <SPANCLASS="acronym">BIND</SPAN> 4.9through 4.9.3, then turned off in the 4.9.4 server.) The first twonumbers for each message are time. If you subtract the second numberfrom the first number, you'll find out how many seconds your serverhas been running.  (You'd think the name server could do that foryou.) The <CODECLASS="literal">CPU</CODE> entry tells you how much time yourserver has spent in user mode (13.01 seconds) and system mode (3.26seconds). Then it tells you the same statistic for childprocesses. The <CODECLASS="literal">NSTATS</CODE> message lists the query typesyour server has received and the counts for each. The<CODECLASS="literal">XSTATS</CODE> message lists additional statistics.  Thestatistics under <CODECLASS="literal">NSTATS</CODE> and<CODECLASS="literal">XSTATS</CODE> are explained in more detail later in thischapter.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7588"></A><ACLASS="indexterm"NAME="AUTOID-7591"></A><ACLASS="indexterm"NAME="AUTOID-7593"></A>If <SPANCLASS="acronym">BIND</SPAN> version 4.9.4 or later finds a name thatdoesn't conform to <SPANCLASS="acronym">RFC</SPAN> 952, it logs a syslogerror:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jul 24 20:56:26 terminator named[1496]: owner name &quot;ID_4.movie.edu IN&quot;                                      (primary) is invalid - rejecting</PRE></BLOCKQUOTE><PCLASS="para">This message is logged at level<SPANCLASS="acronym">LOG_NOTICE</SPAN>. See <ACLASS="xref"HREF="ch04_01.htm"TITLE="Setting Up BIND">Chapter 4</A> for thehost naming rules.</P><PCLASS="para">Another syslog message, sent at priority<SPANCLASS="acronym">LOG_INFO</SPAN>, is a warning message about the zone data:<ACLASS="indexterm"NAME="AUTOID-7603"></A><ACLASS="indexterm"NAME="AUTOID-7606"></A></P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan 10 20:48:38 terminator named[3221]: terminator2 has CNAME                and other data (invalid)</PRE></BLOCKQUOTE><PCLASS="para">This message means that there's a problem with your zone data.For example, you may have entries like these:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">terminator2  IN  CNAME t2terminator2  IN  MX    10 t2t2           IN  A     192.249.249.10t2           IN  MX    10 t2</PRE></BLOCKQUOTE><PCLASS="para">The <SPANCLASS="acronym">MX</SPAN> record for <ICLASS="systemitem.sitename">terminator2</I> is incorrect, and would causethe message given above. <ICLASS="systemitem.sitename">terminator2</I> is an alias for <ICLASS="systemitem.sitename">t2</I>, which is the canonical name.  Asdescribed earlier, when <SPANCLASS="acronym">DNS</SPAN> looks up a name andfinds a <SPANCLASS="acronym">CNAME</SPAN>, it replaces the original name withthe canonical name, and then tries looking up the canonicalname. Thus, when the server looks up the <SPANCLASS="acronym">MX</SPAN> datafor <ICLASS="systemitem.sitename">terminator2</I>, it finds a<SPANCLASS="acronym">CNAME</SPAN> record and then looks up the<SPANCLASS="acronym">MX</SPAN> record for <ICLASS="systemitem.sitename">t2</I>.  Since the server follows the<SPANCLASS="acronym">CNAME</SPAN> record for <ICLASS="systemitem.sitename">terminator2</I>, it will never use the<SPANCLASS="acronym">MX</SPAN> record for <ICLASS="systemitem.sitename">terminator2</I>; in fact, this record isillegal. In other words, all resource records for a host have to usethe <EMCLASS="emphasis">canonical name</EM>; it's an error to usean alias in place of the canonical name.</P><PCLASS="para">The following message indicates that a slave was unable to reachany master server when it tried to do a zone transfer:<ACLASS="indexterm"NAME="AUTOID-7629"></A><ACLASS="indexterm"NAME="AUTOID-7632"></A><ACLASS="indexterm"NAME="AUTOID-7634"></A></P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan 10 20:52:42 wormhole named[2813]: zoneref: Masters for                secondary zone &quot;movie.edu&quot; unreachable</PRE></BLOCKQUOTE><PCLASS="para">This message is sent at priority <SPANCLASS="acronym">LOG_NOTICE</SPAN>,and is only sent the first time the zone transfer fails. When the zonetransfer finally succeeds, a 4.9 or later server will tell you thatthe zone transferred by issuing another syslog message. Older serversdon't tell you when the zone transferred. When this message firstappears, you don't need to take any immediate action. The name serverwill continue to attempt to transfer the zone, according to the retryperiod in the <SPANCLASS="acronym">SOA</SPAN> record. After a few days (or halfthe expire time), you might check that the server was able to transferthe zone. On<ACLASS="indexterm"NAME="AUTOID-7640"></A><ACLASS="indexterm"NAME="AUTOID-7643"></A>servers that don't issue the syslog message when the zone transfers,you can verify that the zone transferred by checking the timestamp onthe backup file. When a zone transfer succeeds, a new backup file iscreated. When a zone is found to be up to date, the backup file is<EMCLASS="emphasis">touched</EM> (ˆ la the <SPANCLASS="acronym">UNIX</SPAN><ACLASS="indexterm"NAME="AUTOID-7648"></A><KBDCLASS="command">touch</KBD> command). In both cases, the timestamp on thebackup file is updated, so go to the slave and give the command<KBDCLASS="command">ls -l /usr/local/named/db.*</KBD>. This will tell youwhen the slave last synchronized each zone with the master server.We'll cover how to troubleshoot slaves failing to transfer zones in<ACLASS="xref"HREF="ch13_01.htm"TITLE="Troubleshooting DNS and BIND">Chapter 13</A>.</P><PCLASS="para">If you are watching the syslog messages on your 4.9 or latermaster server, you'll see a <SPANCLASS="acronym">LOG_INFO</SPAN> syslog messagewhen the slave does pick up the new zone data or when a tool, like<KBDCLASS="command">nslookup</KBD>, transfers a zone:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mar  7 07:30:04 terminator named[3977]: approved AXFR from                           [192.249.249.1].2253 for &quot;movie.edu&quot;</PRE></BLOCKQUOTE><PCLASS="para">If you are using the version 4 <KBDCLASS="command">xfrnets</KBD>configuration file statement or version 8<KBDCLASS="command">allow-transfer</KBD> option statement (explained in <ACLASS="xref"HREF="ch10_01.htm"TITLE="Advanced Features and Security">Chapter 10</A>) to limit which servers can load zones, you maysee this message saying <KBDCLASS="command">unapproved</KBD> instead of<KBDCLASS="command">approved</KBD>.</P><PCLASS="para">This syslog message is seen only if you capture<SPANCLASS="acronym">LOG_INFO</SPAN> syslog messages:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan 10 20:52:42 wormhole named[2813]: Malformed response<ACLASS="indexterm"NAME="AUTOID-7666"></A>                from 192.1.1.1</PRE></BLOCKQUOTE><PCLASS="para">Most often, this message means that some bug in a name servercaused it to send an erroneous response packet. The error probablyoccurred on the remote name server (192.1.1.1) rather than the localserver (<ICLASS="systemitem.sitename">wormhole</I>). Diagnosingthis kind of error involves capturing the response packet in a networktrace and decoding it. Decoding <SPANCLASS="acronym">DNS</SPAN> packetsmanually is beyond the scope of this book, so we won't go into muchdetail. You see this type of error when the response packet says ithas several answers in the answer section (like four address resourcerecords), and yet the answer section only contains a singleanswer. The only course of action is to notify the hostmaster (orroot) of the offending host via email (assuming you can get the nameof the host by looking up the address). You would also see thismessage if the underlying network altered (damaged) the<ACLASS="indexterm"NAME="AUTOID-7671"></A><SPANCLASS="acronym">UDP</SPAN> response packets in some way. Checksumming of<SPANCLASS="acronym">UDP</SPAN> packets is optional, so this error might not becaught at a lower level.</P><PCLASS="para"><KBDCLASS="command">named</KBD> logs this message when you try to sneakinto your zone file data that belongs in another zone:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jun 13 08:02:03 terminator named[2657]: db.movie:28: data &quot;foo.bar.edu&quot;<ACLASS="indexterm"NAME="AUTOID-7679"></A>                           outside zone &quot;movie.edu&quot; (ignored)</PRE></BLOCKQUOTE><PCLASS="para">For instance, if we tried to use this zone data:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">robocop       IN A  192.249.249.2terminator    IN A  192.249.249.3; Add this entry to the name server's cachefoo.bar.edu.  IN A  10.0.7.13</PRE></BLOCKQUOTE><PCLASS="para">we'd be adding data for the <ICLASS="systemitem.sitename">bar.edu</I> zone into our <ICLASS="systemitem.sitename">movie.edu</I> zone file. A 4.8.3 vintage nameserver would blindly add <ICLASS="systemitem.sitename">foo.bar.edu</I> to its cache. It wouldn'tcheck that all the data in the <ICLASS="filename">db.movie</I> file wasin the <ICLASS="systemitem.sitename">movie.edu</I> zone. Youcan't fool a name server newer than 4.9, though. This<KBDCLASS="command">syslog</KBD> message is logged at priority<SPANCLASS="acronym">LOG_INFO</SPAN>.</P><PCLASS="para">Earlier in the book we said that you can't use a<ACLASS="indexterm"NAME="AUTOID-7692"></A><ACLASS="indexterm"NAME="AUTOID-7695"></A><SPANCLASS="acronym">CNAME</SPAN> in the data portion of a resourcerecord. <SPANCLASS="acronym">BIND</SPAN> versions 4.9 and later will catch thismisuse:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jun 13 08:21:04 terminator named[2699]: &quot;movie.edu IN NS&quot; points to a                                        CNAME (dh.movie.edu)</PRE></BLOCKQUOTE><PCLASS="para">Here is an example of the guilty resource records:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">@                      NS       terminator.movie.edu.                       NS       dh.movie.edu.terminator.movie.edu.  IN A     192.249.249.3diehard.movie.edu.     IN A     192.249.249.4dh                     IN CNAME diehard</PRE></BLOCKQUOTE><PCLASS="para">The second <SPANCLASS="acronym">NS</SPAN> record should have listed<ICLASS="systemitem.sitename">diehard.movie.edu</I> instead of<ICLASS="systemitem.sitename">dh.movie.edu</I>. This syslogmessage won't show up immediately when you start your nameserver.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> You'll only see the syslog message when the offending data islooked up. This syslog message is logged by a 4.9.3 or<SPANCLASS="acronym">BIND</SPAN> 8 server at priority<SPANCLASS="acronym">LOG_INFO</SPAN>, and by a 4.9.4 to 4.9.7 server atpriority <SPANCLASS="acronym">LOG_DEBUG</SPAN>.</P></BLOCKQUOTE><PCLASS="para">This message indicates that your name server may be guardingitself against one type of network attack:<ACLASS="indexterm"NAME="AUTOID-7714"></A><ACLASS="indexterm"NAME="AUTOID-7717"></A></P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jun 11 11:40:54 terminator named[131]: Response from unexpected source                                       ([204.138.114.3].53)</PRE></BLOCKQUOTE><PCLASS="para">Your name server sent a query to a remote name server, and aresponse came, but it wasn't from any of the addresses your nameserver had listed for the remote name server. The potential securitybreach is this: an intruder causes your name server to query a remotename server, and at the same time the intruder sends responses(pretending the responses are from the remote name server) that theintruder hopes your name server will add to its cache. Perhaps hesends along a false <SPANCLASS="acronym">PTR</SPAN> record, pointing the<SPANCLASS="acronym">IP</SPAN> address of one of his hosts to the domain nameof a host you trust.  Once the false <SPANCLASS="acronym">PTR</SPAN> record isin your cache, the intruder uses one of the <SPANCLASS="acronym">BSD</SPAN><SPANCLASS="quote">"r"</SPAN> commands (e.g., <KBDCLASS="command">rlogin</KBD>) to gainaccess to your system.</P><PCLASS="para">Less paranoid admins will realize that this situation can alsohappen if the parent name server only knows about one of the<SPANCLASS="acronym">IP</SPAN> addresses of a multihomed name server host. Theparent tells your name server the one <SPANCLASS="acronym">IP</SPAN> address itknows about, and when your server queries the remote name server, theremote name server responds from the other <SPANCLASS="acronym">IP</SPAN>address. This shouldn't happen if <SPANCLASS="acronym">BIND</SPAN> is runningon the remote name server host, because <SPANCLASS="acronym">BIND</SPAN> makesevery attempt to use the same <SPANCLASS="acronym">IP</SPAN> address in theresponse as the query was sent to. This syslog message is logged atpriority <SPANCLASS="acronym">LOG_INFO</SPAN>.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7736"></A><ACLASS="indexterm"NAME="AUTOID-7739"></A><ACLASS="indexterm"NAME="AUTOID-7741"></A><ACLASS="indexterm"NAME="AUTOID-7744"></A>Here's an interesting syslog message:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jun 10 07:57:28 terminator named[131]: No root nameservers for                class 226</PRE></BLOCKQUOTE><PCLASS="para">The only classes defined to date are: class 1, Internet(<SPANCLASS="acronym">IN</SPAN>); class 3, Chaos (<SPANCLASS="acronym">CH</SPAN>);and class 4, Hesiod (<SPANCLASS="acronym">HS</SPAN>). Where does class 226come from? That's exactly the point your name server is making withthis syslog message. Something is wrong in the world because there isno class 226. What can you do about it? Nothing, really. This messagedoesn't give you enough information&nbsp;- you don't know who the queryis from or what the query was for. Then again, if the class field iscorrupted, the query name may be garbage too. The actual cause of theproblem could be a broken remote name server or resolver, or it couldbe a corrupted <SPANCLASS="acronym">UDP</SPAN> datagram. This syslog message islogged at priority <SPANCLASS="acronym">LOG_INFO</SPAN>.</P><PCLASS="para">This message might happen if you are backing up some other zone:<ACLASS="indexterm"NAME="AUTOID-7756"></A><ACLASS="indexterm"NAME="AUTOID-7759"></A></P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jun  7 20:14:26 wormhole named[29618]: Zone &quot;253.253.192.in-addr.arpa&quot;                (class 1) SOA serial# (3345) rcvd from [192.249.249.10]                is &lt; ours (563319491)</PRE></BLOCKQUOTE><PCLASS="para">Ah, the pesky admin for <ICLASS="systemitem.sitename">253.253.192.in-addr.arpa</I> changed theserial number format and neglected to tell you about it. Some thanksyou get for running a slave for this zone, huh? Drop the admin a noteto see if this change was intentional or just a typo. If the changewas intentional, or you don't want to contact the admin, then you haveto deal with it locally&nbsp;- kill your slave, remove the backup copyof this zone, and restart your server. This procedure removes allknowledge your slave had of the old <SPANCLASS="acronym">SOA</SPAN> serialnumber, at which point it is quite happy with the new serialnumber. This syslog message is logged at priority<SPANCLASS="acronym">LOG_NOTICE</SPAN>.</P><PCLASS="para">By the way, if that pesky admin was running a<SPANCLASS="acronym">BIND</SPAN> 8 name server, then he must have missed (orignored) a message his server logged, telling him that he'd rolled thezone's serial number back:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jun 7 19:35:14 terminator named[3221]: WARNING: new serial number &lt; old              (zp-&gt;z_serial &lt; serial)</PRE></BLOCKQUOTE><PCLASS="para">This message is logged at <SPANCLASS="acronym">LOG_NOTICE</SPAN>.</P><PCLASS="para">You might want to remind him of the wisdom of checking syslogafter making any changes to the name server.</P><PCLASS="para">This message will undoubtedly become familiar to you:<ACLASS="indexterm"NAME="AUTOID-7774"></A><ACLASS="indexterm"NAME="AUTOID-7776"></A></P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Aug 21 00:59:06 jade named[12620]: Lame server on 'foo.movie.edu'         (in 'MOVIE.EDU'?): [10.0.7.125].53 'NS.HOLLYWOOD.LA.CA.US':         learnt (A=10.47.3.62,NS=10.47.3.62)</PRE></BLOCKQUOTE><PCLASS="para"><SPANCLASS="quote">"Aye, Captain, she's sucking mud!"</SPAN> There's some mudout there in the Internet waters in the form of bad delegations. Aparent name server is delegating a subdomain to a child name server,and the child name server is not authoritative for the subdomain. Inthis case, the <ICLASS="systemitem.sitename">edu</I> nameserver is delegating <ICLASS="systemitem.sitename">movie.edu</I> to 10.0.7.125, and the nameserver on this host is not authoritative for <ICLASS="systemitem.sitename">movie.edu</I>. Unless you know the admin for<ICLASS="systemitem.sitename">movie.edu</I>, there's probablynothing for you to do about this. The syslog message is logged by a4.9.3 server at priority <SPANCLASS="acronym">LOG_WARNING</SPAN>, by a 4.9.4 to4.9.7 server at priority <SPANCLASS="acronym">LOG_DEBUG</SPAN>, and by a<SPANCLASS="acronym">BIND</SPAN> 8 server at<SPANCLASS="acronym">LOG_INFO</SPAN>.</P><PCLASS="para">If your version 4.9 or later name server's configuration filehas:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">options query-log<ACLASS="indexterm"NAME="AUTOID-7792"></A><ACLASS="indexterm"NAME="AUTOID-7794"></A><ACLASS="indexterm"NAME="AUTOID-7797"></A><ACLASS="indexterm"NAME="AUTOID-7800"></A></PRE></BLOCKQUOTE><PCLASS="para">or your version 8 configuration file has:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">logging { category queries { default_syslog; }; };</PRE></BLOCKQUOTE><PCLASS="para">you will get a <SPANCLASS="acronym">LOG_INFO</SPAN> syslog message forevery query your name server receives:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Feb 20 21:43:25 terminator named[3830]:            XX /192.253.253.2/carrie.movie.edu/AFeb 20 21:43:32 terminator named[3830]:            XX /192.253.253.2/4.253.253.192.in-addr.arpa/PTR</PRE></BLOCKQUOTE><PCLASS="para">These messages include the <SPANCLASS="acronym">IP</SPAN> address of thehost that made the query and the query. Make sure you have lots ofdisk space if you log all the queries to a busy name server. (On arunning server, you can toggle query logging on and off with the<ACLASS="indexterm"NAME="AUTOID-7810"></A><SPANCLASS="acronym">WINCH</SPAN> signal.)</P><PCLASS="para">Starting with version 8.1.2, you might see this set of syslogmessages:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">May 19 11:06:08 named[21160]: bind(dfd=20, [10.0.0.1].53):                Address already in useMay 19 11:06:08 named[21160]: deleting interface [10.0.0.1].53May 19 11:06:08 named[21160]: bind(dfd=20, [127.0.0.1].53):                Address already in useMay 19 11:06:08 named[21160]: deleting interface [127.0.0.1].53May 19 11:06:08 named[21160]: not listening on any interfacesMay 19 11:06:08 named[21160]: Forwarding source address                is [0.0.0.0].1835May 19 11:06:08 named[21161]: Ready to answer queries.</PRE></BLOCKQUOTE><PCLASS="para">What has happened is that you had a name server running and youstarted up a second name server without killing the first one.  Unlikewhat you might expect, the second name server continues to run; itjust isn't listening on any interfaces.<ACLASS="indexterm"NAME="AUTOID-7817"></A><ACLASS="indexterm"NAME="AUTOID-7818"></A><ACLASS="indexterm"NAME="AUTOID-7819"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-7820">7.6.2 Understanding the <SPANCLASS="acronym">BIND</SPAN> Statistics</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-7-STATISTICS"></A><ACLASS="indexterm"NAME="DNS3-IDX-7-NAME-SERVERS-STATISTICS-ON"></A><ACLASS="indexterm"NAME="DNS3-IDX-7-BIND-BERKELEY-INTERNET-NAME-DOMAIN-STATISTICS"></A>Periodically, you should look over the statistics on some of your nameservers, if only to see how busy they are. We will show you an exampleof the name server statistics and discuss what each line means.<ACLASS="indexterm"NAME="DNS3-IDX-7-QUERIES-STATISTICS-ON"></A>Name servers handle many queries and responses during normaloperation, so first, we need to show you what a typical exchange mightlook like.</P><PCLASS="para">Reading the explanations for the statistics is hard without amental picture of what goes on during a lookup. To help you understandthe name server's statistics, <ACLASS="xref"HREF="ch07_06.htm#DNS3-CHP-7-FIG-2"TITLE="Example query/response exchange">Figure 7.2</A> showswhat might go on when an application tries to look up a name. Theapplication, <KBDCLASS="command">ftp</KBD>, queries a local name server. Thelocal name server had previously looked up data from this domain andknows where the remote name servers are. It queries each of the remotename servers&nbsp;- one of them twice&nbsp;- trying to find theanswer. In the meantime, the application times out and sends yetanother query, asking for the same information.</P><PCLASS="para">Keep in mind that even though a name server has sent a query toa remote name server, the remote name server may not receive the queryright away. The query might be delayed or lost by the underlyingnetwork, or perhaps the remote name server host might be busy withanother application.</P><H4CLASS="figure"><ACLASS="title"NAME="DNS3-CHP-7-FIG-2">Figure 7.2: Example query/response exchange</A></H4><IMGCLASS="graphic"SRC="figs/dns3_0702.gif"ALT="Figure 7.2"><PCLASS="para">Notice that a <SPANCLASS="acronym">BIND</SPAN> name server is able todetect duplicate queries only while it is still trying to answer theoriginal query.  The local name server detects the duplicate queryfrom the application because the local name server is still working onit. But, remote name server 1 does not detect the duplicate query fromthe local name server because it answered the previous query. Afterthe local name server receives the first response from remote nameserver 1, all other responses are discarded as duplicates. This dialogrequired the following exchanges:</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Exchange</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Number</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Application to local name server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">2 queries</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Local name server to application</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">1 response</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Local name server to remote name server1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">2 queries</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Remote name server 1 to local name server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">2 responses</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Local name server to remote name server2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">1 query</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Remote name server 2 to local name server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">1 response</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Local name server to remote name server3</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">1 query</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Remote name server 3 to local name server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">0 responses</P></TD></TR></TBODY></TABLE><PCLASS="para">These exchanges would make the following contributions to thelocal name server's statistics:</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Statistic</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Cause</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">2 queries received</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">From the application on the local host</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">1 duplicate query</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">From the application on the local host</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">1 answer sent</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">To the application on the local host</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">3 responses received</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">From remote name servers</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">2 duplicate responses</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">From remote name servers</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">2 A queries</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Queries for address information</P></TD></TR></TBODY></TABLE><PCLASS="para">In our example, the local name server received queries only froman application, yet it sent queries to remote name servers.  Normally,the local name server would also receive queries from remote nameservers (that is, in addition to asking remote servers for informationit needs to know, the local server would also be asked by remoteservers for information they need to know), but we didn't show anyremote queries, for the sake of simplicity.</P><PCLASS="para">Now that you've seen a typical exchange between applications andname servers, and the statistics it generated, let's go over a moreextensive example of the statistics. To get the statistics from yourname server, send the version 4 name server an<ACLASS="indexterm"NAME="AUTOID-7937"></A><SPANCLASS="acronym">ABRT</SPAN> signal (on many systems, called<SPANCLASS="acronym">IOT</SPAN>):</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>kill -ABRT `cat /etc/named.pid`</B></CODE></PRE></BLOCKQUOTE><PCLASS="para">Or send a version 8 name server an <SPANCLASS="acronym">ILL</SPAN> signalinstead of <SPANCLASS="acronym">ABRT</SPAN>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>kill -ILL `cat /etc/named.pid`</B></CODE></PRE></BLOCKQUOTE><PCLASS="para">(The process <SPANCLASS="acronym">ID</SPAN> is stored in<ICLASS="filename">/var/run/named.pid</I> on an <SPANCLASS="acronym">SVR</SPAN>4filesystem.) Wait a few seconds and look at the file<ACLASS="indexterm"NAME="AUTOID-7953"></A><ICLASS="filename">/usr/tmp/named.stats</I> (or<ICLASS="filename">/var/tmp/named.stats</I>). A version 8 name serverleaves the file <ICLASS="filename">named.stats</I> in its currentdirectory (<ICLASS="filename">/usr/local/named</I> in most of ourexamples).  If the statistics are not dumped to this file, your servermay not have been compiled with <SPANCLASS="acronym">STATS</SPAN> defined and,thus, may not be collecting statistics. Following are the statisticsfrom one of Paul Vixie's name servers. These statistics came from a4.9.3 name server. An 8.1.2 name server has all of the same items asbelow except <SPANCLASS="acronym">RN</SPAN>otNsQ and the items are arranged ina different order.  If your name server is newer than 8.1.2, thestatistics may not look at all like those shown here&nbsp;- the<SPANCLASS="acronym">BIND</SPAN> statistics may be replaced with the<SPANCLASS="acronym">DNS</SPAN> server and resolver <SPANCLASS="acronym">MIB</SPAN>extensions defined in <SPANCLASS="acronym">RFC</SPAN> 1611 and<SPANCLASS="acronym">RFC</SPAN> 1612.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">+++ Statistics Dump +++ (800708260) Wed May 17 03:57:40 1995746683    time since boot (secs)392768    time since reset (secs)14        Unknown query types268459    A queries3044      NS queries5680      CNAME queries11364     SOA queries1008934   PTR queries44        HINFO queries680367    MX queries2369      TXT queries40        NSAP queries27        AXFR queries8336      ANY queries++ Name Server Statistics ++(Legend)      RQ    RR    RIQ   RNXD    RFwdQ      RFwdR RDupQ RDupR RFail   RFErr      RErr  RTCP  RAXFR RLame   ROpts      SSysQ SAns  SFwdQ SFwdR   SDupQ      SFail SFErr SErr  RNotNsQ SNaAns      SNXD(Global)   1992938 112600 0 19144 63462 60527 194 347 3420 0  5 2235 27 35289 0   14886 1927930 63462 60527 107169  10025 119 0 1785426 805592  35863[15.255.72.20]   485 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 485 0 0 0  0 0 0 0 485  0[15.255.152.2]   441 137 0 1 2 108 0 0 0 0  0 0 0 0 0  13 439 85 7 84  0 0 0 0 431  0[15.255.152.4]   770 89 0 1 4  69 0 0 0 0  0 0 0 0 0  14 766 68 5 7  0 0 0 0 755  0...  &lt;<BCLASS="emphasis.bold">lots of entries deleted</B>&gt;</PRE></BLOCKQUOTE><PCLASS="para">Let's look at these statistics one line at a time:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">746683    time since boot (secs)</PRE></BLOCKQUOTE><PCLASS="para">This is how long the local name server has been running. Toconvert to days, divide by 86400 (60x60x24, the number of seconds in aday). This server has been running for about 8.5 days.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">392768    time since reset (secs)</PRE></BLOCKQUOTE><PCLASS="para">This is how long the local name server has run since the last<ACLASS="indexterm"NAME="AUTOID-7973"></A><SPANCLASS="acronym">HUP</SPAN> signal&nbsp;- i.e., the last time it loaded itsdatabase. You'll probably see this number differ from the time sinceboot only if the server is a primary master name server for somezone. Name servers that are slaves for a zone automatically pick upnew data with zone transfers and are not usually sent<SPANCLASS="acronym">HUP</SPAN> signals. Since <EMCLASS="emphasis">this</EM> serverhas been reset, it is probably a primary master name server for somezone.<ACLASS="indexterm"NAME="AUTOID-7979"></A></P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">14        Unknown query types</PRE></BLOCKQUOTE><PCLASS="para">This name server received 14 queries for data of a type the nameserver didn't recognize. Either someone is experimenting with newtypes, or there is a defective implementation somewhere.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">268459    A queries<ACLASS="indexterm"NAME="AUTOID-7984"></A><ACLASS="indexterm"NAME="AUTOID-7987"></A></PRE></BLOCKQUOTE><PCLASS="para">There have been 268459 address lookups. Address queries arenormally the most common type of query.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">3044      NS queries<ACLASS="indexterm"NAME="AUTOID-7992"></A><ACLASS="indexterm"NAME="AUTOID-7996"></A></PRE></BLOCKQUOTE><PCLASS="para">There have been 3044 name server queries. Internally, nameservers generate <SPANCLASS="acronym">NS</SPAN> queries when they are trying tolook up servers for the root domain. Externally, applications like<KBDCLASS="command">dig</KBD> or <KBDCLASS="command">nslookup</KBD> can also be usedto look up <SPANCLASS="acronym">NS</SPAN> records.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">5680      CNAME queries<ACLASS="indexterm"NAME="AUTOID-8006"></A></PRE></BLOCKQUOTE><PCLASS="para">Some versions of <KBDCLASS="command">sendmail</KBD> make<SPANCLASS="acronym">CNAME</SPAN> queries in order to canonicalize a mailaddress (replace an alias with the canonical name). Other versions of<ACLASS="indexterm"NAME="AUTOID-8013"></A><KBDCLASS="command">sendmail</KBD> use <SPANCLASS="acronym">ANY</SPAN> queries instead(we'll get to those shortly). Otherwise, the <SPANCLASS="acronym">CNAME</SPAN>lookups are most likely from <KBDCLASS="command">dig</KBD> or<KBDCLASS="command">nslookup</KBD>.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">11364     SOA queries<ACLASS="indexterm"NAME="AUTOID-8021"></A></PRE></BLOCKQUOTE><PCLASS="para"><SPANCLASS="acronym">SOA</SPAN> queries are made by slave name servers tocheck if their zone data are current. If the data are not current, an<SPANCLASS="acronym">AXFR</SPAN> query follows to cause the zonetransfer. Since this set of statistics does show<ACLASS="indexterm"NAME="AUTOID-8028"></A><SPANCLASS="acronym">AXFR</SPAN> queries, we can conclude that slave nameservers load zone data from this server.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">1008934   PTR queries<ACLASS="indexterm"NAME="AUTOID-8033"></A></PRE></BLOCKQUOTE><PCLASS="para">The pointer queries map addresses to names. Many kinds ofsoftware look up <SPANCLASS="acronym">IP</SPAN> addresses:<KBDCLASS="command">inetd</KBD>, <KBDCLASS="command">rlogind</KBD>,<KBDCLASS="command">rshd</KBD>, network management software, and networktracing software.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">44        HINFO queries<ACLASS="indexterm"NAME="AUTOID-8043"></A></PRE></BLOCKQUOTE><PCLASS="para">The host-information queries are most likely from someoneinteractively looking up <SPANCLASS="acronym">HINFO</SPAN> records.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">680367    MX queries<ACLASS="indexterm"NAME="AUTOID-8050"></A></PRE></BLOCKQUOTE><PCLASS="para">Mail exchanger queries are made by mailers like<KBDCLASS="command">sendmail</KBD> as part of the normal electronic maildelivery process.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">2369      TXT queries<ACLASS="indexterm"NAME="AUTOID-8057"></A></PRE></BLOCKQUOTE><PCLASS="para">Some application must be making text queries for this number tobe this large. It might be a tool like <KBDCLASS="command">Harvest</KBD>,which is an information search and retrieval technology developed atthe University of Colorado.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">40        NSAP queries<ACLASS="indexterm"NAME="AUTOID-8064"></A></PRE></BLOCKQUOTE><PCLASS="para">This is a relatively new data type used to map domain names to<SPANCLASS="acronym">OSI</SPAN> Network Service Access Point addresses.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">27        AXFR queries</PRE></BLOCKQUOTE><PCLASS="para">An <SPANCLASS="acronym">AXFR</SPAN> query is made by a slave name serverto cause a zone transfer.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">8336      ANY queries<ACLASS="indexterm"NAME="AUTOID-8073"></A></PRE></BLOCKQUOTE><PCLASS="para"><SPANCLASS="acronym">ANY</SPAN> queries request data of any type for aname. This query type is used most often by<KBDCLASS="command">sendmail</KBD>. Since <KBDCLASS="command">sendmail</KBD> looksup <SPANCLASS="acronym">CNAME</SPAN>, <SPANCLASS="acronym">MX</SPAN>, and addressrecords for a mail destination, it will make a query for<SPANCLASS="acronym">ANY</SPAN> data type so that all the resource records arecached right away at the local name server.<ACLASS="indexterm"NAME="AUTOID-8083"></A></P><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-7-HOSTS-STATISTICS-FOR"></A>The rest of the statistics are kept on a per-host basis. If youlook over the list of hosts your name server has exchanged packetswith, you'll find out just how garrulous your name serveris&nbsp;- you'll see hundreds or even thousands of hosts in thelist. While the size of the list is impressive, the statisticsthemselves are only somewhat interesting. We will explain<EMCLASS="emphasis">all</EM> of the statistics, even the ones with zerocounts, although you'll probably only find a handful of the statisticsuseful. To make the statistics easier to read, you'll need a tool toexpand the statistics because the output format is rather compact. Wewrote a tool, called<ACLASS="indexterm"NAME="AUTOID-8089"></A><KBDCLASS="command">bstat</KBD>, to do just this. Here's what its outputlooks like:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">hpcvsop.cv.hp.com        485 queries received        485 responses sent to this name server        485 queries answered from our cacherelay.hp.com        441 queries received        137 responses received          1 negative response received          2 queries for data not in our cache or authoritative data        108 responses from this name server passed to the querier         13 system queries sent to this name server        439 responses sent to this name server         85 queries sent to this name server          7 responses from other name servers sent to this name server         84 duplicate queries sent to this name server        431 queries answered from our cachehp.com        770 queries received         89 responses received          1 negative response received          4 queries for data not in our cache or authoritative data         69 responses from this name server passed to the querier         14 system queries sent to this name server        766 responses sent to this name server         68 queries sent to this name server          5 responses from other name servers sent to this name server          7 duplicate queries sent to this name server        755 queries answered from our cache</PRE></BLOCKQUOTE><PCLASS="para">In the raw statistics (not the <KBDCLASS="command">bstat</KBD> output),each host <SPANCLASS="acronym">IP</SPAN> address is followed by a table ofcounts. The column heading for this table is the cryptic legend at thebeginning. The legend is broken into several lines, but the hoststatistics are all on a single line. In the following section, we'llexplain briefly what each column means as we look at the statisticsfor one of the hosts this server conversed with&nbsp;- 15.255.152.2(<ICLASS="systemitem.sitename">relay.hp.com</I>). For the sakeof our explanation, we'll first show you the column heading from thelegend (e.g., <SPANCLASS="acronym">RQ</SPAN>) followed by the count for thiscolumn for <ICLASS="systemitem.sitename">relay</I>.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8100"></A>RQ 441</PRE></BLOCKQUOTE><PCLASS="para"><SPANCLASS="acronym">RQ</SPAN> is the count of queries received from<ICLASS="systemitem.sitename">relay</I>.  These queries weremade because <ICLASS="systemitem.sitename">relay</I> neededinformation about a domain served by this name server.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8108"></A>RR 137</PRE></BLOCKQUOTE><PCLASS="para"><SPANCLASS="acronym">RR</SPAN> is the count of responses received from<ICLASS="systemitem.sitename">relay</I>.  These are responsesto queries made from this name server.  Don't try to correlate thisnumber to <SPANCLASS="acronym">RQ</SPAN>, because they are not related.<SPANCLASS="acronym">RQ</SPAN> counts questions <EMCLASS="emphasis">asked</EM> by<ICLASS="systemitem.sitename">relay</I>;<SPANCLASS="acronym">RR</SPAN> counts <EMCLASS="emphasis">answers</EM> <ICLASS="systemitem.sitename">relay</I> gave to this name server (becausethis name server <EMCLASS="emphasis">asked</EM> <ICLASS="systemitem.sitename">relay</I> for information).</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8124"></A>RIQ 0</PRE></BLOCKQUOTE><PCLASS="para"><SPANCLASS="acronym">RIQ</SPAN> is the count of inverse queries receivedfrom <ICLASS="systemitem.sitename">relay</I>.  Inverse querieswere originally intended to map addresses to names, but that functionis now handled by <SPANCLASS="acronym">PTR</SPAN> records. Older versions of<KBDCLASS="command">nslookup</KBD> use an inverse query on startup, so youmay see a nonzero <SPANCLASS="acronym">RIQ</SPAN> count.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8134"></A>RNXD 1</PRE></BLOCKQUOTE><PCLASS="para"><SPANCLASS="acronym">RNXD</SPAN> is the count of <SPANCLASS="quote">"no suchdomain"</SPAN> answers received from <ICLASS="systemitem.sitename">relay</I>.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8142"></A>RFwdQ 2</PRE></BLOCKQUOTE><PCLASS="para">RFwdQ is the count of queries received (<SPANCLASS="acronym">RQ</SPAN>)from <ICLASS="systemitem.sitename">relay</I> that neededfurther processing before they could be answered. This count is muchhigher for hosts that configure their resolver (with<ICLASS="filename">resolv.conf</I>) to send all queries to yourname server.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">RFwdR 108</PRE></BLOCKQUOTE><PCLASS="para">RFwdR is the count of responses received (<SPANCLASS="acronym">RR</SPAN>)from <ICLASS="systemitem.sitename">relay</I> that answered theoriginal query and were passed back to the application that made thequery.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8153"></A>RDupQ 0</PRE></BLOCKQUOTE><PCLASS="para">RDupQ is the count of duplicate queries from <ICLASS="systemitem.sitename">relay</I>.  You'll only see duplicates whenthe resolver is configured (with<ICLASS="filename">resolv.conf</I>) to query this nameserver.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">RDupR 0</PRE></BLOCKQUOTE><PCLASS="para">RDupR is the count of duplicate responses from <ICLASS="systemitem.sitename">relay</I>.  A response is a duplicate whenthe name server can no longer find the original query in its list ofpending queries that caused the response.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8162"></A>RFail 0</PRE></BLOCKQUOTE><PCLASS="para">RFail is the count of<ACLASS="indexterm"NAME="AUTOID-8165"></A><ACLASS="indexterm"NAME="AUTOID-8168"></A><SPANCLASS="acronym">SERVFAIL</SPAN> responses from <ICLASS="systemitem.sitename">relay</I>. A <SPANCLASS="acronym">SERVFAIL</SPAN>response indicates some sort of server failure. Server failureresponses often occur because the remote server read a db file andfound a syntax error.  Any queries for data in that zone (the one fromthe erroneous db file) will result in a server failure answer from theremote name server. This is probably the most common badresponse. Server failure responses also occur when the remote nameserver tries to allocate more memory and can't, or when the remotename server's zone data expire.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8175"></A>RFErr 0</PRE></BLOCKQUOTE><PCLASS="para">RFErr is the count of<ACLASS="indexterm"NAME="AUTOID-8178"></A><SPANCLASS="acronym">FORMERR</SPAN> responses from <ICLASS="systemitem.sitename">relay</I>. <SPANCLASS="acronym">FORMERR</SPAN> meansthat the remote name server said the local name server's query had aformat error.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8185"></A>RErr  0</PRE></BLOCKQUOTE><PCLASS="para">RErr is the count of errors that weren't either<SPANCLASS="acronym">SERVFAIL</SPAN> or <SPANCLASS="acronym">FORMERR</SPAN>.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8191"></A>RTCP  0</PRE></BLOCKQUOTE><PCLASS="para"><SPANCLASS="acronym">RTCP</SPAN> is the count of queries received on<SPANCLASS="acronym">TCP</SPAN> connections from <ICLASS="systemitem.sitename">relay</I>.  (Most queries use<SPANCLASS="acronym">UDP</SPAN>.)</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8200"></A>RAXFR 0</PRE></BLOCKQUOTE><PCLASS="para"><SPANCLASS="acronym">RAXFR</SPAN> is the count of zone transfersinitiated. The 0 count indicates that <ICLASS="systemitem.sitename">relay</I> is not a slave for any zones servedby this name server.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8207"></A>RLame 0</PRE></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8210"></A><ACLASS="indexterm"NAME="AUTOID-8213"></A>RLame is the count of lame delegations received. If this count is not0, it means that some zone is delegated to the name server at this<SPANCLASS="acronym">IP</SPAN> address, and the name server is notauthoritative for the zone.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8217"></A>ROpts 0</PRE></BLOCKQUOTE><PCLASS="para">ROpts is the count of packets received with<SPANCLASS="acronym">IP</SPAN> options.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8222"></A>SSysQ 13</PRE></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8225"></A><ACLASS="indexterm"NAME="AUTOID-8228"></A>SSysQ is the count of system queries sent to <ICLASS="systemitem.sitename">relay</I>.  System queries are queries<EMCLASS="emphasis">initiated</EM> by the local name server. Most systemqueries will go to root name servers, because system queries are usedto keep up-to-date on who the root name servers are. But systemqueries are also used to find out the address of a name server if theaddress record timed out before the name server record did. Since<ICLASS="systemitem.sitename">relay</I> is not a root nameserver, these queries must have been sent for the latterreason.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8235"></A>SAns  439</PRE></BLOCKQUOTE><PCLASS="para">SAns is the count of answers sent to <ICLASS="systemitem.sitename">relay</I>.  This name server answered 439 outof the 441 (<SPANCLASS="acronym">RQ</SPAN>) queries <ICLASS="systemitem.sitename">relay</I> sent to it. I wonder what happenedto the 2 queries it didn't answer...</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8242"></A>SFwdQ 85</PRE></BLOCKQUOTE><PCLASS="para">SFwdQ is the count of queries that were sent (forwarded) to<ICLASS="systemitem.sitename">relay</I> when the answer was notin this name server's zone data or cache.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">SFwdR 7</PRE></BLOCKQUOTE><PCLASS="para">SFwdR is the count of responses from some name server that weresent (forwarded) to <ICLASS="systemitem.sitename">relay</I>.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8250"></A>SDupQ 84</PRE></BLOCKQUOTE><PCLASS="para">SDupQ is the count of the<ACLASS="indexterm"NAME="AUTOID-8253"></A>duplicate queries sent to <ICLASS="systemitem.sitename">relay</I>. It's not as bad as it looks,though. The duplicate count is incremented if the query was sent toany other name server first. So, <ICLASS="systemitem.sitename">relay</I> might have answered all the queriesit received the first time it received them, and the query stillcounted as a duplicate because it was sent to some other name serverbefore <ICLASS="systemitem.sitename">relay</I>.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8259"></A>SFail 0</PRE></BLOCKQUOTE><PCLASS="para">SFail is the count of <SPANCLASS="acronym">SERVFAIL</SPAN> responses sentto <ICLASS="systemitem.sitename">relay</I>.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8265"></A>SFErr 0</PRE></BLOCKQUOTE><PCLASS="para">SFErr is the count of<ACLASS="indexterm"NAME="AUTOID-8268"></A><SPANCLASS="acronym">FORMERR</SPAN> responses sent to <ICLASS="systemitem.sitename">relay</I>.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8274"></A>SErr  0</PRE></BLOCKQUOTE><PCLASS="para">SErr is the count of<ACLASS="indexterm"NAME="AUTOID-8277"></A><ICLASS="function">sendto()</I> system calls that failed whenthe destination was <ICLASS="systemitem.sitename">relay</I>.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8282"></A>RNotNsQ 0</PRE></BLOCKQUOTE><PCLASS="para">RNotNsQ is the count of queries received that were not from port53, the name server port. Prior to version 8, all name server querieswould come from port 53.  Any queries from ports other than 53 camefrom a resolver. Now, name servers will query from ports other than53, which makes this statistic useless since you can no longerdistinguish resolver queries from name server queries.  Hence, version8 dropped RNotNsQ from its statistics.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8286"></A>SNaAns 431</PRE></BLOCKQUOTE><PCLASS="para">SNaAns is the count of nonauthoritative answers sent to<ICLASS="systemitem.sitename">relay</I>.  Out of the 439answers (SAns) sent to <ICLASS="systemitem.sitename">relay</I>,431 were from cached data.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-8292"></A>SNXD  0</PRE></BLOCKQUOTE><PCLASS="para"><SPANCLASS="acronym">SNXD</SPAN> is the count of <SPANCLASS="quote">"no suchdomain"</SPAN> answers sent to <ICLASS="systemitem.sitename">relay</I>.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8300"></A>Is this name server <SPANCLASS="quote">"healthy"</SPAN>?  How do you know what<SPANCLASS="quote">"healthy"</SPAN> operation is? From this one snapshot, we reallycouldn't say if the name server is healthy. You have to watch thestatistics generated by your server over a period of time to get afeel for what sorts of numbers are normal for your configuration.These numbers will vary markedly among servers, depending on the mixof applications generating lookups, the type of server (primary,slave, caching-only), and the level in the domain tree it isserving.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8306"></A>One thing to watch for in the statistics is how many queries persecond your server receives. Take the number of queries received (fromthe <SPANCLASS="quote">"Global"</SPAN> statistics) and divide by the number ofseconds the name server has been running. This server received 1992938queries in 746683 seconds, or approximately 2.7 queries persecond&nbsp;- a pretty busy server.  If the number you come up with foryour server seems out of line, look at which hosts are making all thequeries and decide if it makes sense for them to be making all thosequeries. At some point you may decide that you need more servers tohandle the load; we cover that situation in the<ACLASS="indexterm"NAME="AUTOID-8310"></A><ACLASS="indexterm"NAME="AUTOID-8311"></A><ACLASS="indexterm"NAME="AUTOID-8312"></A><ACLASS="indexterm"NAME="AUTOID-8313"></A>next<ACLASS="indexterm"NAME="AUTOID-8314"></A><ACLASS="indexterm"NAME="AUTOID-8315"></A><ACLASS="indexterm"NAME="AUTOID-8316"></A><ACLASS="indexterm"NAME="AUTOID-8317"></A><ACLASS="indexterm"NAME="AUTOID-8318"></A>chapter.<ACLASS="indexterm"NAME="AUTOID-8319"></A><ACLASS="indexterm"NAME="AUTOID-8320"></A><ACLASS="indexterm"NAME="AUTOID-8321"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_05.htm"TITLE="7.5 BIND 8 Logging"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.5 BIND 8 Logging"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="DNS &amp; BIND"><IMGSRC="../gifs/txthome.gif"ALT="DNS &amp; BIND"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch08_01.htm"TITLE="8. Growing Your Domain"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8. Growing Your Domain"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">7.5 BIND 8 Logging</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8. Growing Your Domain</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>