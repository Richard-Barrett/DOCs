<HTML><HEAD><TITLE>[Chapter 8] Growing Your Domain</TITLE><METANAME="DC.title"CONTENT="DNS &amp; BIND"><METANAME="DC.creator"CONTENT="Cricket Liu &amp; Paul Albitz"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:32:56Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-512-2"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="index.htm"TITLE="DNS &amp; BIND"><LINKREL="prev"HREF="ch07_06.htm"TITLE="7.6 Keeping Everything Running Smoothly"><LINKREL="next"HREF="ch08_02.htm"TITLE="8.2 Adding More Name Servers"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="DNS &amp; BIND"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="DNS &amp; BIND"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/dsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_06.htm"TITLE="7.6 Keeping Everything Running Smoothly"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.6 Keeping Everything Running Smoothly"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_02.htm"TITLE="8.2 Adding More Name Servers"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.2 Adding More Name Servers"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="DNS3-CHP-8">8. Growing Your Domain</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#AUTOID-8334"TITLE="8.1 How Many Name Servers?">How Many Name Servers?</A><BR><ACLASS="sect1"HREF="ch08_02.htm"TITLE="8.2 Adding More Name Servers">Adding More Name Servers</A><BR><ACLASS="sect1"HREF="ch08_03.htm"TITLE="8.3 Registering Name Servers">Registering Name Servers</A><BR><ACLASS="sect1"HREF="ch08_04.htm"TITLE="8.4 Changing TTLs">Changing <SPANCLASS="acronym">TTL</SPAN>s</A><BR><ACLASS="sect1"HREF="ch08_05.htm"TITLE="8.5 Planning for Disasters">Planning for Disasters</A><BR><ACLASS="sect1"HREF="ch08_06.htm"TITLE="8.6 Coping with Disaster">Coping with Disaster</A></P><P></P></DIV><DIVCLASS="epigraph"><PCLASS="para"ALIGN="right"><I><SPANCLASS="quote">"What size do you want to be?"</SPAN> it asked.</I></P><PCLASS="para"ALIGN="right"><I><SPANCLASS="quote">"Oh, I'm not particular as to size,"</SPAN> Alice hastilyreplied; <SPANCLASS="quote">"only one doesn't like changing so often, youknow..."</SPAN></I></P><PCLASS="para"ALIGN="right"><I><SPANCLASS="quote">"Are you content now?"</SPAN> said the Caterpillar.</I></P><PCLASS="para"ALIGN="right"><I><SPANCLASS="quote">"Well, I should like to be a little larger, sir, if you wouldn't mind...."</SPAN></I></P></DIV><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-8334">8.1 How Many Name Servers?</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-8-NAME-SERVERS-CHOOSING-HOW-MANY"></A>We set up two name servers in <ACLASS="xref"HREF="ch04_01.htm"TITLE="Setting Up BIND">Chapter 4, <CITECLASS="chapter">Setting Up <SPANCLASS="acronym">BIND</SPAN></CITE></A>. Two serversare as few as you'll ever want to run. Depending on the size of yournetwork, you may need to run many more than just two servers.  It isnot uncommon to run from five to seven servers, with one of themoff-site. How many name servers are enough? You'll have to decide thatbased on your network. Here are some guidelines to help out:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Have at least one name server available directly on each networkor subnet you have. This removes routers as a point of failure. Makethe most of any multihomed hosts you may have, since they're (bydefinition) attached to more than one network.</P></LI><LICLASS="listitem"><PCLASS="para">If you have a file server and some diskless nodes, run a nameserver on the file server to serve this group of machines.</P></LI><LICLASS="listitem"><PCLASS="para">Run name servers near, but not necessarily on, largetime-sharing machines. The users and their processes probably generatea lot of queries, and, as administrators, you will work harder to keepa multiuser host up. But balance their needs against the risk ofrunning a name server&nbsp;- a security-critical server&nbsp;- on asystem that lots of people have access to.</P></LI><LICLASS="listitem"><PCLASS="para">Run one name server<ACLASS="indexterm"NAME="AUTOID-8350"></A>off-site. This makes your data available when your network isn't. Youmight argue that it's useless to look up an address when you can'treach the host. Then again, the off-site name server may be availableif your network is reachable, but your other name servers are down. Ifyou have a close relationship with an organization on theInternet&nbsp;- say another university or a business partner&nbsp;- theymay consent to run a slave for you.</P></LI></UL><PCLASS="para"><ACLASS="xref"HREF="ch08_01.htm#DNS3-CHP-8-FIG-1"TITLE="Sample network topology">Figure 8.1</A> shows a sample topology and abrief analysis to show you how this might work.</P><H4CLASS="figure"><ACLASS="title"NAME="DNS3-CHP-8-FIG-1">Figure 8.1: Sample network topology</A></H4><IMGCLASS="graphic"SRC="figs/dns3_0801.gif"ALT="Figure 8.1"><PCLASS="para">Notice that if you follow our guidelines, there are still anumber of places you could choose to run a name server. Host<ICLASS="systemitem.sitename">d</I>, the file server for hosts<ICLASS="systemitem.sitename">a</I>, <ICLASS="systemitem.sitename">b</I>, <ICLASS="systemitem.sitename">c</I>, and <ICLASS="systemitem.sitename">e</I>, could run a name server. Host<ICLASS="systemitem.sitename">g</I>, a big, multiuser host, isanother good candidate. But probably the best choice is host<ICLASS="systemitem.sitename">f</I>, the smaller host withinterfaces on both networks. You'll only need to run one name server,instead of two, and it'll run on a closely-watched host. If you wantmore than one name server on either network, you can also run one on<ICLASS="systemitem.sitename">d</I> or <ICLASS="systemitem.sitename">g</I>.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-8367">8.1.1 Where Do I Put My Name Servers?</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-8-NAME-SERVERS-WHERE-TO-RUN"></A>In addition to giving you a rough idea of how many name serversyou'll need, these criteria should also help you decide<EMCLASS="emphasis">where</EM> to run name servers (e.g., on file servers,multihomed hosts). But there are other important considerations whenchoosing the right host.</P><PCLASS="para">Other factors to keep in mind are the host's connectivity, thesoftware it runs (<SPANCLASS="acronym">BIND</SPAN> and otherwise), andmaintaining the homogeneity of your name servers:</P><DLCLASS="variablelist"><DTCLASS="term">Connectivity</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8381"></A>It's important that name servers be well connected. Having a nameserver running on the fastest, most reliable host on your networkwon't do you any good if the host is mired in some backwater subnet ofyour network behind a slow, flaky serial line. Try to find a hostclose to your link to the Internet (if you have one), or find awell-connected Internet host to act as a slave for your zone. And onyour own network, try to run name servers near the hubs of yournetwork.</P><PCLASS="para">It's doubly important that your primary master name server bewell connected. The primary needs good connectivity to all the slavesthat update from it, for reliable zone transfers.  And, like any nameserver, it'll benefit from fast, reliable networking.</P></DD><DTCLASS="term">Software</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8388"></A>Another factor to consider in choosing a host for a name server is thesoftware the host runs. Software-wise, the best candidate for a nameserver is a host running a vendor-supported version of<SPANCLASS="acronym">BIND</SPAN> 8.1.2 or 4.9.7 and a robust implementation of<SPANCLASS="acronym">TCP</SPAN>/<SPANCLASS="acronym">IP</SPAN> (preferably based on 4.3or 4.4 <SPANCLASS="acronym">BSD</SPAN> <SPANCLASS="acronym">UNIX</SPAN>'snetworking&nbsp;- we're Berkeley snobs). You can compile your own 8.1.2<SPANCLASS="acronym">BIND</SPAN> from the sources&nbsp;- it's not hard, and thelatest versions are very reliable&nbsp;- but you'll probably have atough time getting your vendor to support it. If you don't absolutelyneed a feature of <SPANCLASS="acronym">BIND</SPAN> 8.1.2, you may be able toget away with running your vendor's port of older<SPANCLASS="acronym">BIND</SPAN> code, like 4.9.4, which will give you thebenefit of your vendor's support, for what that's worth.</P></DD><DTCLASS="term">Homogeneity</DT><DDCLASS="listitem"><PCLASS="para">One last thing to take into account is the<ACLASS="indexterm"NAME="AUTOID-8402"></A>homogeneity of your name servers. As much as you might believe in<SPANCLASS="quote">"open systems,"</SPAN> hopping between different versions of<SPANCLASS="acronym">UNIX</SPAN> can be frustrating and confusing. Avoidrunning name servers on lots of different platforms, if you can. Youcan waste a lot of time porting your scripts (or ours!) from oneoperating system to another, or looking for the location of<KBDCLASS="command">nslookup</KBD> or <ICLASS="filename">named.conf</I> onthree different <SPANCLASS="acronym">UNIX</SPAN>es. Moreover, differentvendors' versions of <SPANCLASS="acronym">UNIX</SPAN> tend to support differentversions of <SPANCLASS="acronym">BIND</SPAN>, which can cause all sorts offrustration. If you need <SPANCLASS="acronym">BIND</SPAN> 8.1.2's securityfeatures on all your name servers, for example, choose a platform thatsupports 8.1.2 for all your name servers.</P></DD><DTCLASS="term">Security</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8416"></A>Since you would undoubtedly prefer that hackers not commandeer yourname server to assist them in attacking your own hosts or othernetworks across the Internet, it's important to run your name serveron a secure host. Don't run a name server on a big, multiuser systemwhose users you can't trust. If you have certain computers that arededicated to hosting network services, but don't permit generallogins, those are good candidates for running name servers. If youonly have one or a few really secure hosts, consider running theprimary master name server on one of those, since its compromise wouldbe more significant than the compromise of the slaves.</P></DD></DL><PCLASS="para">Though these are really secondary considerations&nbsp;- it's moreimportant to have a name server on a given subnet than to have itrunning on the perfect host&nbsp;- do keep these criteria in mind whenmaking a choice.<ACLASS="indexterm"NAME="AUTOID-8419"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-8420">8.1.2 Capacity Planning</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-8-PERFORMANCE-CAPACITY-PLANNING"></A><ACLASS="indexterm"NAME="DNS3-IDX-8-CAPACITY-PLANNING"></A><ACLASS="indexterm"NAME="DNS3-IDX-8-ADMINISTRATION-CAPACITY-PLANNING"></A><ACLASS="indexterm"NAME="DNS3-IDX-8-NAME-SERVERS-CAPACITY-OF"></A>If you have heavily populated networks, or users who do a lot ofname-server-intensive work, you may find you need more name serversthan we've recommended to handle the load. Or our recommendations maybe fine for a little while, but as people add hosts to your nets orinstall new name-server-intensive programs, you may find your nameservers bogged down by queries.</P><PCLASS="para">Just which tasks are <SPANCLASS="quote">"name-server-intensive"</SPAN>?Surfing the web can be name-server-intensive.  Sending electronicmail, especially to large mailing lists, can bename-server-intensive. Programs that make lots of remote procedurecalls to different hosts can be name-server-intensive. Even runningcertain graphical user environments can tax your name server. XWindow-based user environments query the name server to check accesslists (among other things).</P><PCLASS="para">The astute (and precocious) among you may be asking, <SPANCLASS="quote">"Buthow do I know when my name servers are overloaded?  What do I lookfor?"</SPAN> An excellent question!</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8439"></A>Memory utilization is probably the most important aspect of a nameserver's operation to monitor. <KBDCLASS="command">named</KBD> can get verylarge on a name server that is authoritative for many zones. If<KBDCLASS="command">named</KBD>'s size, plus the size of the otherprocesses you run, exceeds your real memory, your host may swapfuriously (&quot;thrash&quot;) and not get anything done. Even if your host hasmore than enough memory to run all its processes, large name serversare slow to start and slow to spawn new <KBDCLASS="command">named</KBD>processes (e.g., to handle zone transfers).  Another problem: since<KBDCLASS="command">named</KBD> creates new <KBDCLASS="command">named</KBD>processes to handle zone transfers, it's quite possible to have morethan one <KBDCLASS="command">named</KBD> process running at onetime&nbsp;- one answering queries, and one or more servicing zonetransfers. If your master name server already consumes five or tenmegabytes of memory, count on two or three times that amount beingused occasionally.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8448"></A><ACLASS="indexterm"NAME="AUTOID-8452"></A><ACLASS="indexterm"NAME="AUTOID-8456"></A>Another criterion you can use to measure the load on your name serveris the load the name server process places on the host's<SPANCLASS="acronym">CPU</SPAN>. Correctly configured name servers don't usemuch <SPANCLASS="acronym">CPU</SPAN> time, so high <SPANCLASS="acronym">CPU</SPAN> usageis often symptomatic of a configuration error. Programs like<KBDCLASS="command">top</KBD> can help you characterize your name server'saverage <SPANCLASS="acronym">CPU</SPAN> utilization.  Unfortunately, there areno absolute rules when it comes to acceptable <SPANCLASS="acronym">CPU</SPAN>utilization. We offer a rough rule of thumb, though: 5% average<SPANCLASS="acronym">CPU</SPAN> utilization is probably acceptable; 10% is abit high, unless the host is dedicated to providing nameservice.[1]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] <KBDCLASS="command">top</KBD> is a very handy program, written by BillLeFebvre, that gives you a continuous report of which processes aresucking up the most <SPANCLASS="acronym">CPU</SPAN> time on your host. The mostrecent version of <KBDCLASS="command">top</KBD> is available via anonymous<KBDCLASS="command">ftp</KBD> from <ACLASS="systemitem.ftpserver"HREF="ftp://eecs.nwu.edu">eecs.nwu.edu</A> as <ACLASS="systemitem.url"HREF="ftp://eecs.nwu.edu/pub/top/top-3.4.tar.Z">/pub/top/top-3.4.tar.Z</A>.</P></BLOCKQUOTE><PCLASS="para">To get an idea of what normal figures are, here's what<ACLASS="indexterm"NAME="AUTOID-8475"></A><KBDCLASS="command">top</KBD> might show for a relatively quiet nameserver:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">last pid: 14299; load averages: 0.11, 0.12, 0.12       18:19:0868 processes: 64 sleeping, 3 running, 1 stoppedCpu states: 11.3% usr, 0.0% nice, 15.3% sys, 73.4% idle, 0.0% intr, 0.0% kerMemory: Real: 8208K/13168K act/tot Virtual: 16432K/30736K act/tot Free: 4224K  PID USERNAME PRI NICE   SIZE   RES STATE  TIME   WCPU    CPU COMMAND   89 root       1    0  2968K 2652K sleep  5:01  0.00%  0.00% named</PRE></BLOCKQUOTE><PCLASS="para">Okay, that's <EMCLASS="emphasis">really</EM> quiet. Here's what<KBDCLASS="command">top</KBD> shows on a busy (though not overloaded) nameserver:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">load averages: 0.30, 0.46, 0.44                  system: relay 16:12:2039 processes: 38 sleeping, 1 waitingCpu states: 4.4% user, 0.0% nice, 5.4% system, 90.2% idle, 0.0% unk5, 0.0% unk6, 0.0% unk7, 0.0% unk8Memory: 31126K (28606K) real, 33090K (28812K) virtual, 54344K free Screen #1/3   PID USERNAME PRI NICE  SIZE   RES   STATE   TIME  WCPU   CPU  COMMAND 21910 root       1    0  2624K  2616K sleep 146:21  0.00% 1.42% /etc/named</PRE></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8484"></A><ACLASS="indexterm"NAME="AUTOID-8486"></A>Another statistic to look at is the number of queries the name serverreceives per minute (or second, if you have a busy nameserver). Again, there are no absolutes here: an<SPANCLASS="acronym">HP</SPAN>9000 K460 can handle hundreds of queries persecond without breaking into a sweat, while a 386<SPANCLASS="acronym">PC</SPAN> might have problems with more than a few queriesa second.</P><PCLASS="para">To check the volume of queries your name server is receiving,it's easiest to look at the name server's internal statistics, whichyou can configure the server to write to <ICLASS="filename">syslog</I>at regular intervals.[2] For example, you could configure your name server to dumpstatistics every hour (actually, that's the default for<SPANCLASS="acronym">BIND</SPAN> 8 servers), and compare the number of queriesreceived between hours:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] Some older <SPANCLASS="acronym">BIND</SPAN> name servers needed coercionto dump their statistics: the <SPANCLASS="acronym">ABRT</SPAN> signal(<SPANCLASS="acronym">IOT</SPAN> on older systems).  <SPANCLASS="acronym">BIND</SPAN>4.9 name servers automatically dumped stats every hour, but 4.9.4 andlater name servers, once again, need to be coerced with<SPANCLASS="acronym">ABRT</SPAN>.</P></BLOCKQUOTE><BLOCKQUOTECLASS="screen"><PRECLASS="screen">options {        statistics-interval 60;};</PRE></BLOCKQUOTE><PCLASS="para">You should pay special attention to<ACLASS="indexterm"NAME="AUTOID-8504"></A>peak periods.  Monday morning is often busy, because many people liketo respond to mail they've received over the weekend first thing onMondays.</P><PCLASS="para">You might also want to take a sample starting just after lunch,when people are returning to their desks and getting back towork&nbsp;- all at about the same time. Of course, if your organizationis spread across several time zones, you'll have to use your own goodjudgment to determine a busy time.</P><PCLASS="para">Here's a snippet from the<ACLASS="indexterm"NAME="AUTOID-8508"></A><ICLASS="filename">syslog</I> file on a <SPANCLASS="acronym">BIND</SPAN> 8.1.2name server:[3]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] On a 4.9.4 through 4.9.7 server, you could dump stats like theseto the <ICLASS="filename">named.stats</I> file by sending<KBDCLASS="command">named</KBD> a <SPANCLASS="acronym">SIGABRT</SPAN>, then move<ICLASS="filename">named.stats</I> to another filename, wait an hour(with <KBDCLASS="command">sleep 3600</KBD>, for example), then send<SPANCLASS="acronym">SIGABRT</SPAN> again.</P></BLOCKQUOTE><BLOCKQUOTECLASS="screen"><PRECLASS="screen">   Apr 22 07:40:37 denver named[150]: NSTATS 830180437 829791665 A=131686   PTR=8554 MX=187 ANY=339Apr 22 07:40:37 denver named[150]: XSTATS 830180437 829791665 <CODECLASS="userinput"><B>RQ=140766</B></CODE>RR=4111 RIQ=0 RNXD=2045 RFwdQ=3671 RFwdR=3839 RDupQ=0 RDupR=7 RFail=0RFErr=0 RErr=0 RTCP=0 RAXFR=0 RLame=0 ROpts=0 SSysQ=285 <CODECLASS="userinput"><B>SAns=137097</B></CODE>SFwdQ=3671 SFwdR=3839 SDupQ=92 SFail=4 SFErr=0 SErr=0 RNotNsQ=140721SNaAns=7728 SNXD=55787   Apr 22 08:40:37 denver named[150]: NSTATS 830184037 829791665 A=132968   PTR=8633 MX=187 ANY=342Apr 22 08:40:37 denver named[150]: XSTATS 830184037 829791665 <CODECLASS="userinput"><B>RQ=142130</B></CODE>RR=4144 RIQ=0 RNXD=2062 RFwdQ=3698 RFwdR=3870 RDupQ=0 RDupR=7 RFail=0RFErr=0 RErr=0 RTCP=0 RAXFR=0 RLame=0 ROpts=0 SSysQ=287 <CODECLASS="userinput"><B>SAns=138434</B></CODE>SFwdQ=3698 SFwdR=3870 SDupQ=92 SFail=4 SFErr=0 SErr=0 RNotNsQ=142085SNaAns=7778 SNXD=56284</PRE></BLOCKQUOTE><PCLASS="para">The number of queries received is dumped in the<ACLASS="indexterm"NAME="AUTOID-8526"></A><KBDCLASS="command">RQ</KBD> field (in bold). To calculate the number ofqueries received in the hour, just subtract the first<KBDCLASS="command">RQ</KBD> value from the second one: 142130 - 140766= 1364.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8531"></A><ACLASS="indexterm"NAME="AUTOID-8535"></A><ACLASS="indexterm"NAME="AUTOID-8539"></A>Even if your host is fast enough to handle the number of queries itreceives, you should make sure the <SPANCLASS="acronym">DNS</SPAN> trafficisn't placing undue load on your network. On most<SPANCLASS="acronym">LAN</SPAN>s, <SPANCLASS="acronym">DNS</SPAN> traffic will be toosmall a proportion of the network's bandwidth to worry about. Overslow leased lines or dial-up connections, though,<SPANCLASS="acronym">DNS</SPAN> traffic could consume enough bandwidth to meritconcern.</P><PCLASS="para">To get a rough estimate of the volume of <SPANCLASS="acronym">DNS</SPAN>traffic on your <SPANCLASS="acronym">LAN</SPAN>, multiply the number of queriesreceived (<SPANCLASS="acronym">RQ</SPAN>) plus the number of answers sent<ACLASS="indexterm"NAME="AUTOID-8552"></A>(<SPANCLASS="acronym">SA</SPAN>ns) in an hour by 800 bits (100 bytes, a roughaverage size for a <SPANCLASS="acronym">DNS</SPAN> packet), and divide by 3600(seconds per hour) to find the bandwidth utilized. This should giveyou a feeling for how much of your network's bandwidth is beingconsumed by <SPANCLASS="acronym">DNS</SPAN> traffic.[4]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] For a nice package that automates the analysis of<SPANCLASS="acronym">BIND</SPAN>'s statistics, look for Nigel Campbell's<KBDCLASS="command">bindgraph</KBD> in the <SPANCLASS="acronym">DNS</SPAN> ResourcesDirectory's tools page, <SPANCLASS="acronym">URL</SPAN> <ACLASS="systemitem.url"HREF="http://www.dns.net/dnsrd/tools.html">http://www.dns.net/dnsrd/tools.html</A>.</P></BLOCKQUOTE><PCLASS="para">To give you an idea of what's normal, the last<ACLASS="indexterm"NAME="AUTOID-8565"></A><SPANCLASS="acronym">NSFNET</SPAN> traffic report (in April, 1995) showed that<SPANCLASS="acronym">DNS</SPAN> traffic constituted just over 5% of the totaltraffic volume (in bytes) on their backbone.  The<SPANCLASS="acronym">NSFNET</SPAN>'s figures are based upon actual trafficsampling, not calculations like ours using the name server'sstatistics.[5] If you want to get a more accurate idea of the trafficyour name server is receiving, you can always do your own trafficsampling with a <SPANCLASS="acronym">LAN</SPAN> protocol analyzer.<ACLASS="indexterm"NAME="AUTOID-8574"></A></P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[5] We're not sure how representative of the current state of theInternet these numbers are, but it's extremely difficult to wheedleequivalent numbers out of the commercial backbone providers thatsucceeded the <SPANCLASS="acronym">NSFNET</SPAN>.</P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8577"></A><ACLASS="indexterm"NAME="AUTOID-8579"></A>Once you've found that your name servers are overworked, what then?First, it's a good idea to make sure that your name servers aren'tbeing bombarded with queries by a misbehaving program. To do that,you'll need to find out where all the queries are coming from.</P><PCLASS="para">If you're running a <SPANCLASS="acronym">BIND</SPAN> 4.9 or 8.1.2 nameserver, you can find out which resolvers and name servers are queryingyour name server just by dumping the statistics. A modern server keepsstatistics on a host-by-host basis, which is really useful in trackingdown heavy users of your name server. For example, take thesestatistics:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">+++ Statistics Dump +++ (829373099) Fri Apr 12 23:24:59 1996970779    time since boot (secs)471621    time since reset (secs)0    Unknown query types185108    A queries6    NS queries69213    PTR queries669    MX queries2361    ANY queries++ Name Server Statistics ++(Legend)    RQ      RR      RIQ      RNXD      RFwdQ    RFwdR   RDupQ   RDupR    RFail     RFErr    RErr    RTCP    RAXFR    RLame     ROpts    SSysQ   SAns    SFwdQ    SFwdR     SDupQ    SFail   SFErr   SErr     RNotNsQ   SNaAns    SNXD(Global)    257357 20718 0 8509 19677  19939 1494 21 0 0  0 7 0 1 0    824 236196 19677 19939 7643  33 0 0 256064 49269  155030 [15.17.232.4]    8736 0 0 0 717  24 0 0 0 0  0 0 0 0 0  0 8019 0 717 0    0 0 0 8736 2141  5722[15.17.232.5]    115 0 0 0 8  0 21 0 0 0  0 0 0 0 0  0 86 0 1 0  0 0 0 115 0  7[15.17.232.8]    66215 0 0 0 6910  148 633 0 0 0  0 5 0 0 0  0 58671 0 6695 0    15 0 0 66215 33697  6541[15.17.232.16]    31848 0 0 0 3593  209 74 0 0 0  0 0 0 0 0  0 28185 0 3563 0    0 0 0 31848 8695  15359[15.17.232.20]    272 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 272 0 0 0  0 0 0 272 7  0[15.17.232.21]    316 0 0 0 52  14 3 0 0 0  0 0 0 0 0  0 261 0 51 0  0 0 0 316 30  30[15.17.232.24]    853 0 0 0 65  1 3 0 0 0  0 2 0 0 0  0 783 0 64 0  0 0 0 853 125  337[15.17.232.33]    624 0 0 0 47  1 0 0 0 0  0 0 0 0 0  0 577 0 47 0  0 0 0 624 2  217[15.17.232.94]    127640 0 0 0 1751  14 449 0 0 0  0 0 0 0 0  0 125440 0 1602 0    0 0 0 127640 106  124661[15.17.232.95]    846 0 0 0 38  1 0 0 0 0  0 0 0 0 0  0 809 0 37 0  0 0 0 846 79  81-- Name Server Statistics ----- Statistics Dump --- (829373099) Fri Apr 12 23:24:59 1996</PRE></BLOCKQUOTE><PCLASS="para">Each host is broken out, after the <KBDCLASS="command">Global</KBD>entry, by <SPANCLASS="acronym">IP</SPAN> address, in brackets. Looking at thelegend, you can see that the first field in each record is<SPANCLASS="acronym">RQ</SPAN>, or queries received. That gives us a very goodreason to go look at the hosts 15.17.232.8, 15.17.232.16, and15.17.232.94, which appear to be responsible for about 88% of ourqueries.</P><PCLASS="para">If you're running an older name server, the only way to find outwhich resolvers and name servers are sending all those darned queriesis to turn on name server<ACLASS="indexterm"NAME="AUTOID-8590"></A>debugging.  (We'll cover this in depth in <ACLASS="xref"HREF="ch12_01.htm"TITLE="Reading BIND Debugging Output">Chapter 12, <CITECLASS="chapter">Reading <SPANCLASS="acronym">BIND</SPAN> Debugging Output</CITE></A>.) All you're really interested in is the source<SPANCLASS="acronym">IP</SPAN> addresses of the queries your name server isreceiving. When poring over the debugging output, look for hostssending repeated queries, especially for the same or similarinformation. That may indicate a misconfigured or buggy programrunning on the host, or a foreign name server pelting your name serverwith queries.</P><PCLASS="para">If all the queries appear to be legitimate, add a new nameserver. Don't put the name server just anywhere, though; use theinformation from the debugging output to help you decide where best torun one. In cases where <SPANCLASS="acronym">DNS</SPAN> traffic is gobbling upyour Ethernet, it won't help to choose a host at random and create aname server there. You need to consider which hosts are sending allthe queries, then figure out how to best provide them nameservice. Here are some hints to help you decide:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Look for queries from resolvers on hosts that share the samefile server. You could run a name server on the file server.</P></LI><LICLASS="listitem"><PCLASS="para">Look for queries from resolvers on large, multiuser hosts. Youcould run a name server there.</P></LI><LICLASS="listitem"><PCLASS="para">Look for queries from resolvers on another subnet.  Thoseresolvers should be configured to query a name server on their localsubnet. If there isn't one on that subnet, create one.</P></LI><LICLASS="listitem"><PCLASS="para">Look for queries from resolvers on the same bridged segment(assuming you use bridging). If you run a name server on the bridgedsegment, the traffic won't need to be bridged to the rest of thenetwork.</P></LI><LICLASS="listitem"><PCLASS="para">Look for queries from hosts connected to each other via another,lightly loaded network. You could run a name server on the other<ACLASS="indexterm"NAME="AUTOID-8607"></A><ACLASS="indexterm"NAME="AUTOID-8608"></A><ACLASS="indexterm"NAME="AUTOID-8609"></A><ACLASS="indexterm"NAME="AUTOID-8610"></A>network.<ACLASS="indexterm"NAME="AUTOID-8611"></A></P></LI></UL></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_06.htm"TITLE="7.6 Keeping Everything Running Smoothly"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.6 Keeping Everything Running Smoothly"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="DNS &amp; BIND"><IMGSRC="../gifs/txthome.gif"ALT="DNS &amp; BIND"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_02.htm"TITLE="8.2 Adding More Name Servers"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.2 Adding More Name Servers"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">7.6 Keeping Everything Running Smoothly</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.2 Adding More Name Servers</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>