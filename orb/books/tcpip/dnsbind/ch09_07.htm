<HTML><HEAD><TITLE>[Chapter 9] 9.7 Managing the Transition to Subdomains</TITLE><METANAME="DC.title"CONTENT="DNS &amp; BIND"><METANAME="DC.creator"CONTENT="Cricket Liu &amp; Paul Albitz"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:35:26Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-512-2"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch09_01.htm"TITLE="9. Parenting"><LINKREL="prev"HREF="ch09_06.htm"TITLE="9.6 Good Parenting"><LINKREL="next"HREF="ch09_08.htm"TITLE="9.8 The Life of a Parent"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="DNS &amp; BIND"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="DNS &amp; BIND"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/dsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_06.htm"TITLE="9.6 Good Parenting"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.6 Good Parenting"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 9<BR>Parenting</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_08.htm"TITLE="9.8 The Life of a Parent"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.8 The Life of a Parent"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-10135">9.7 Managing the Transition to Subdomains</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="DNS3-IDX-9-PARENTING-MANAGING-TRANSITION-TO-SUBDOMAINS"></A><ACLASS="indexterm"NAME="DNS3-IDX-9-DOMAINS-PARENTING-MANAGING-TRANSITION-TO-SUBDOMAINS"></A>We won't lie to you&nbsp;- the <ICLASS="systemitem.sitename">fx.movie.edu</I> example we showed you wasunrealistic for several reasons. The main one is the magicalappearance of the special effects lab's hosts. In the real world, thelab would have started out with a few hosts, probably in the<ICLASS="systemitem.sitename">movie.edu</I> zone. After agenerous endowment, an <SPANCLASS="acronym">NSF</SPAN> grant, or a corporategift, they might expand the lab a little and buy a few morecomputers. Sooner or later, the lab would have enough hosts to warrantthe creation of a new subdomain. By that point, however, many of theoriginal hosts would be well known by their names under <ICLASS="systemitem.sitename">movie.edu</I>.</P><PCLASS="para">We briefly touched on using<ACLASS="indexterm"NAME="AUTOID-10150"></A><SPANCLASS="acronym">CNAME</SPAN> records under the parent domain (in our<ICLASS="systemitem.sitename">plan9.movie.edu</I> example) tohelp people adjust to a host's change of domain. But what happens whenyou move a whole network or subnet into a new subdomain?</P><PCLASS="para">The strategy we recommend uses <SPANCLASS="acronym">CNAME</SPAN> recordsin much the same way, but on a larger scale. Using a tool like<KBDCLASS="command">h2n</KBD>, you can create <SPANCLASS="acronym">CNAME</SPAN>s forhosts <ICLASS="foreignphrase">en masse</I>. This allows users tocontinue using the old domain names for any of the hosts that havemoved. When they <KBDCLASS="command">telnet</KBD> or <KBDCLASS="command">ftp</KBD>(or whatever) to those hosts, however, the command will report thatthey're connected to a host in <ICLASS="systemitem.sitename">fx.movie.edu</I>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>telnet plan9 </B></CODE>Trying...Connected to plan9.fx.movie.edu.Escape character is '^]'.HP-UX plan9.fx.movie.edu A.09.05 C 9000/735 (ttyu1)login:</PRE></BLOCKQUOTE><PCLASS="para">Some users, of course, don't notice subtle changes like this, soyou should also do some public relations work and notify folks of thechange.</P><PCLASS="para">On <ICLASS="systemitem.sitename">fx.movie.edu</I> hostsrunning old versions of <KBDCLASS="command">sendmail</KBD>, we may also needto configure mail to accept mail addressed to the new domainnames. Modern versions of <KBDCLASS="command">sendmail</KBD> canonicalize thehost names in addresses in message headers using a name server beforesending the messages. This will turn a <ICLASS="systemitem.sitename">movie.edu</I> alias into a canonical name in<ICLASS="systemitem.sitename">fx.movie.edu</I>. If, however,the <KBDCLASS="command">sendmail</KBD> on the receiving end is older andhardcodes the local host's domain name, we'd have to change the nameto the new domain name by hand. This usually requires a simple changeto class <EMCLASS="emphasis">w</EM> or fileclass <EMCLASS="emphasis">w</EM> in <ICLASS="filename">sendmail.cf</I>; see thesection <SPANCLASS="quote">"The <SPANCLASS="acronym">MX</SPAN> Algorithm"</SPAN> in <ACLASS="xref"HREF="ch05_01.htm"TITLE="DNS and Electronic Mail">Chapter 5, <CITECLASS="chapter"><SPANCLASS="acronym">DNS</SPAN> and Electronic Mail</CITE></A>.</P><PCLASS="para">How do you create all these aliases? You simply need to tell<KBDCLASS="command">h2n</KBD> to create the<ACLASS="indexterm"NAME="AUTOID-10181"></A>aliases for hosts on the <ICLASS="systemitem.sitename">fx.movie.edu</I> networks (192.253.254 and192.254.20), and indicate (in the <ICLASS="filename">/etc/hosts</I>file) what the new domain names for the hosts are. For example, usingthe <ICLASS="systemitem.sitename">fx.movie.edu</I> host table,we could easily generate the aliases under <ICLASS="systemitem.sitename">movie.edu</I> for all the hosts in<ICLASS="systemitem.sitename">fx.movie.edu</I>.</P><PCLASS="para">Partial contents of file <ICLASS="filename">/etc/hosts</I>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">192.253.254.1 movie-gw.movie.edu movie-gw# fx primary192.253.254.2 bladerunner.fx.movie.edu bladerunner br# fx secondary192.253.254.3 outland.fx.movie.edu outland192.253.254.4 starwars.fx.movie.edu starwars192.253.254.5 empire.fx.movie.edu empire192.253.254.6 jedi.fx.movie.edu jedi192.254.20.3  alien.fx.movie.edu alien</PRE></BLOCKQUOTE><PCLASS="para"><KBDCLASS="command">h2n</KBD>'s <ICLASS="option">-c</I> option takes azone's domain name as an argument. When <KBDCLASS="command">h2n</KBD> findsany hosts in that zone on networks it's building data for, it'llcreate aliases for them in the current zone (specified with<ICLASS="option">-d</I>).  So by running:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>h2n -d movie.edu -n 192.253.254 -n 192.254.20</B></CODE> \<CODECLASS="userinput"><B>-c fx.movie.edu -f <CODECLASS="replaceable"><I>options</I></CODE></B></CODE></PRE></BLOCKQUOTE><PCLASS="para">(where <CODECLASS="replaceable"><I>options</I></CODE> contains othercommand-line options for building data from other <ICLASS="systemitem.sitename">movie.edu</I> networks), we could createaliases under <ICLASS="systemitem.sitename">movie.edu</I> forall <ICLASS="systemitem.sitename">fx.movie.edu</I>hosts.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-10206">9.7.1 Removing Parent Aliases</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10209"></A><ACLASS="indexterm"NAME="AUTOID-10212"></A>Although parent-level aliases are useful for minimizing the impact ofmoving your hosts, they're also a crutch of sorts. Like a crutch,they'll restrict your freedom. They'll clutter up your parent namespace, when one of your motivations for implementing a subdomain mayhave been making the parent zone smaller. And they'll prevent you fromusing the names of hosts in the subdomain as names for hosts in theparent zone.</P><PCLASS="para">After a grace period&nbsp;- which should be well advertised tousers&nbsp;- you should remove all the aliases, with the possibleexception of aliases for extremely well-known Internet hosts. Duringthe grace period, users can adjust to the new domain names, and modifyscripts, <ICLASS="filename">.rhosts</I> files, and the like. But don'tget suckered into leaving all those aliases in the parent zone; theydefeat part of the purpose of the <SPANCLASS="acronym">DNS</SPAN>, because theyprevent you and your subdomain administrator from naming hostsautonomously.</P><PCLASS="para">You might want to leave <SPANCLASS="acronym">CNAME</SPAN> records forwell-known Internet hosts or central network resources intact, becauseof the potential impact of a loss of connectivity. On the other hand,rather than moving the well-known host or central resource into asubdomain at all, it might be better to leave it at the parent zonelevel.</P><PCLASS="para"><KBDCLASS="command">h2n</KBD> gives you an easy way to delete thealiases you created so simply with the <ICLASS="option">-c</I> option,even if the records for the subdomain's hosts are mixed in the hosttable or on the same network as hosts in other zones. The<ICLASS="option">-e</I> option takes a zone's domain name as an argument,and tells <KBDCLASS="command">h2n</KBD> to exclude (hence<ICLASS="option">-e</I>) all records containing that domain name onnetworks it would otherwise create data for. This command line, forexample, would delete all the <SPANCLASS="acronym">CNAME</SPAN> records for<ICLASS="systemitem.sitename">fx.movie.edu</I> hosts createdearlier, while still creating an A record for <ICLASS="systemitem.sitename">movie-gw</I> (which is on the 192.253.254network):</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>h2n -d movie.edu -n 192.253.254 -n 192.254.20</B></CODE> \<CODECLASS="userinput"><B>-e fx.movie.edu -f <CODECLASS="replaceable"><I>options</I></CODE></B></CODE></PRE></BLOCKQUOTE><ACLASS="indexterm"NAME="AUTOID-10233"></A><ACLASS="indexterm"NAME="AUTOID-10234"></A></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_06.htm"TITLE="9.6 Good Parenting"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.6 Good Parenting"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="DNS &amp; BIND"><IMGSRC="../gifs/txthome.gif"ALT="DNS &amp; BIND"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_08.htm"TITLE="9.8 The Life of a Parent"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.8 The Life of a Parent"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">9.6 Good Parenting</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">9.8 The Life of a Parent</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>