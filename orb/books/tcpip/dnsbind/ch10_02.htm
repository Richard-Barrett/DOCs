<HTML><HEAD><TITLE>[Chapter 10] 10.2 DNS NOTIFY (Zone Change Notification)</TITLE><METANAME="DC.title"CONTENT="DNS &amp; BIND"><METANAME="DC.creator"CONTENT="Cricket Liu &amp; Paul Albitz"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:35:41Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-512-2"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch10_01.htm"TITLE="10. Advanced Features and Security"><LINKREL="prev"HREF="ch10_01.htm"TITLE="10.1 Address Match Lists and ACLs"><LINKREL="next"HREF="ch10_03.htm"TITLE="10.3 DNS Dynamic Update"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="DNS &amp; BIND"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="DNS &amp; BIND"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/dsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_01.htm"TITLE="10.1 Address Match Lists and ACLs"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.1 Address Match Lists and ACLs"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 10<BR>Advanced Features and Security</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_03.htm"TITLE="10.3 DNS Dynamic Update"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.3 DNS Dynamic Update"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-10322">10.2 <SPANCLASS="acronym">DNS</SPAN> <SPANCLASS="acronym">NOTIFY</SPAN> (Zone ChangeNotification)</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH10.ZONECHANGE1"></A><ACLASS="indexterm"NAME="CH10.ZONECHANGE2"></A><ACLASS="indexterm"NAME="CH10.ZONECHANGE3"></A><ACLASS="indexterm"NAME="CH10.ZONECHANGE4"></A><ACLASS="indexterm"NAME="CH10.ZONECHANGE5"></A><ACLASS="indexterm"NAME="CH10.ZONECHANGE5A"></A>Traditionally, <SPANCLASS="acronym">BIND</SPAN> slaves have used apolling scheme to determine when they need a zone transfer.  The<ACLASS="indexterm"NAME="AUTOID-10344"></A>polling interval is called the <ICLASS="firstterm">refresh time</I>.  Other parameters in thezone's <SPANCLASS="acronym">SOA</SPAN> record govern other aspects of thepolling mechanism.</P><PCLASS="para">Wouldn't it be nice if the primary master name server could <EMCLASS="emphasis">tell</EM>its slave servers when the information in a zone changed?  After all,the primary master name server <EMCLASS="emphasis">knows</EM> the data has changed: Someonesignaled it with a <SPANCLASS="acronym">SIGHUP</SPAN>, and it checked the <KBDCLASS="command">mtime</KBD>(the <SPANCLASS="acronym">UNIX</SPAN> file modification time) of all of itszone data files to determine which had been changed.  The primary'snotification could come soon after the actual modification, instead ofwaiting for the refresh interval to expire.</P><PCLASS="para"><SPANCLASS="acronym">RFC</SPAN> 1996 proposed a mechanism that wouldallow primary master servers to notify their slaves of changes to azone's data.  <SPANCLASS="acronym">BIND</SPAN> 8 implements this scheme, called<SPANCLASS="acronym">DNS</SPAN> <SPANCLASS="acronym">NOTIFY</SPAN> for short.</P><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN> <SPANCLASS="acronym">NOTIFY</SPAN> works likethis: when a primary master name server notices a change to data in azone, it sends a special request to all of the slave servers for thatzone.  It determines which servers are the slaves for the zone bylooking at the list of <SPANCLASS="acronym">NS</SPAN> records in the zone andtaking out the one that points to the name server listed in the firstrecord-specific field in the zone's <SPANCLASS="acronym">SOA</SPAN> record aswell as the local host.</P><PCLASS="para"><ACLASS="indexterm"NAME="CH10.NOTIFY"></A>The special <SPANCLASS="acronym">NOTIFY</SPAN> request is identified byits opcode in the query header.  The opcode for most queries is<SPANCLASS="acronym">QUERY</SPAN>.  <SPANCLASS="acronym">NOTIFY</SPAN> messages have aspecial opcode, <SPANCLASS="acronym">NOTIFY</SPAN> (duh).  Other than that, therequest looks very much like a query for the <SPANCLASS="acronym">SOA</SPAN>record for the zone: it specifies the zone's domain name, class, and atype of <SPANCLASS="acronym">SOA</SPAN>.  The authoritative answer bit is alsoset.</P><PCLASS="para">When a slave receives a <SPANCLASS="acronym">NOTIFY</SPAN> request for azone from one of its configured master name servers, it responds witha <SPANCLASS="acronym">NOTIFY</SPAN> response.  The response tells the masterthat the slave received the <SPANCLASS="acronym">NOTIFY</SPAN> request, so thatit can stop sending it <SPANCLASS="acronym">NOTIFY</SPAN> messages for thezone.  Then the slave proceeds just as if the refresh timer hadexpired: it queries the master server for the <SPANCLASS="acronym">SOA</SPAN>record for the zone that the master claimed has changed.  If theserial number is higher, the slave transfers the zone.</P><PCLASS="para">Why doesn't the slave simply take the master's word that thezone has changed?  It's possible that a miscreant could forge<SPANCLASS="acronym">NOTIFY</SPAN> requests to our slaves, causing lots ofunnecessary zone transfers, amounting to a denial of service attackagainst our master server.</P><PCLASS="para">If the slave actually transfers the zone, <SPANCLASS="acronym">RFC</SPAN>1996 says that it should issue its own <SPANCLASS="acronym">NOTIFY</SPAN>requests to the other authoritative name servers for the zone.  Theidea is that the primary master may not be able to notify all of theslave servers for the zone itself, since it's possible some slavescan't communicate directly with the primary master and use anotherslave as their master.  However, <SPANCLASS="acronym">BIND</SPAN> 8 doesn'timplement this, and <SPANCLASS="acronym">BIND</SPAN> 8 slaves don't send<SPANCLASS="acronym">NOTIFY</SPAN> messages unless explicitly configuredto.</P><PCLASS="para">Here's how that works in practice.  On our network, <ICLASS="systemitem.sitename">terminator.movie.edu</I> is the primarymaster for <ICLASS="systemitem.sitename">movie.edu</I>, and<ICLASS="systemitem.sitename">wormhole.movie.edu</I> and<ICLASS="systemitem.sitename">zardoz.movie.edu</I> areslaves, as shown in <ACLASS="xref"HREF="ch10_02.htm#DNS3-CHP-10-FIG-1"TITLE="movie.edu zone transfers">Figure 10.1</A>.</P><H4CLASS="figure"><ACLASS="title"NAME="DNS3-CHP-10-FIG-1">Figure 10.1: movie.edu zone transfers</A></H4><IMGCLASS="graphic"SRC="figs/dns3_1001.gif"ALT="Figure 10.1"><PCLASS="para">When we update <ICLASS="systemitem.sitename">movie.edu</I> on <ICLASS="systemitem.sitename">terminator</I>, <ICLASS="systemitem.sitename">terminator</I> sends<SPANCLASS="acronym">NOTIFY</SPAN> messages to <ICLASS="systemitem.sitename">wormhole</I> and <ICLASS="systemitem.sitename">zardoz</I>.  Both slaves check to see whether<ICLASS="systemitem.sitename">movie.edu</I>'s serial number hasincremented, and when they find it has, perform a zonetransfer.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10405"></A>Let's also look at a more complicated zone transfer scheme.Here, <ICLASS="systemitem.sitename">a</I> is the primary mastername server for the zone, and <ICLASS="systemitem.sitename">b</I>'s master server, but <ICLASS="systemitem.sitename">b</I> is <ICLASS="systemitem.sitename">c</I>'s master server.  Moreover, <ICLASS="systemitem.sitename">b</I> has two network interfaces, as shown in<ACLASS="xref"HREF="ch10_02.htm#DNS3-CHP-10-FIG-2"TITLE="Complex zone transfer example">Figure 10.2</A>.</P><H4CLASS="figure"><ACLASS="title"NAME="DNS3-CHP-10-FIG-2">Figure 10.2: Complex zone transfer example</A></H4><IMGCLASS="graphic"SRC="figs/dns3_1002.gif"ALT="Figure 10.2"><PCLASS="para">In this scenario, <ICLASS="systemitem.sitename">a</I>notifies both <ICLASS="systemitem.sitename">b</I> and<ICLASS="systemitem.sitename">c</I> after the zone is updated.<ICLASS="systemitem.sitename">b</I> checks to see whether thezone's serial number has incremented and initiates a zone transfer.However, <ICLASS="systemitem.sitename">c</I> ignores<ICLASS="systemitem.sitename">a</I>'s <SPANCLASS="acronym">NOTIFY</SPAN>message, because <ICLASS="systemitem.sitename">a</I> is not<ICLASS="systemitem.sitename">c</I>'s configured master nameserver (<ICLASS="systemitem.sitename">b</I> is).  If<ICLASS="systemitem.sitename">b</I> is explicitly configured tonotify <ICLASS="systemitem.sitename">c</I>, then after<ICLASS="systemitem.sitename">b</I>'s zone transfer completes,it sends <ICLASS="systemitem.sitename">c</I> a<SPANCLASS="acronym">NOTIFY</SPAN> message, which prompts <ICLASS="systemitem.sitename">c</I> to check the serial number <ICLASS="systemitem.sitename">b</I> holds for the zone.</P><PCLASS="para">Note also that if there's any possibility that <ICLASS="systemitem.sitename">c</I> will receive a<SPANCLASS="acronym">NOTIFY</SPAN> message from <ICLASS="systemitem.sitename">b</I>'s other network interface, <ICLASS="systemitem.sitename">c</I> must be configured with both networkinterfaces' addresses in the zone's <ICLASS="function">masters</I> substatement, or else<ICLASS="systemitem.sitename">c</I> will ignore<SPANCLASS="acronym">NOTIFY</SPAN> messages from the unknown interface.</P><PCLASS="para"><SPANCLASS="acronym">BIND</SPAN> 4 slave name servers, and other nameservers that don't support <SPANCLASS="acronym">NOTIFY</SPAN>, will respondwith a Not Implemented (<SPANCLASS="acronym">NOTIMP</SPAN>) error.  Note thatMicrosoft's Windows <SPANCLASS="acronym">NT</SPAN> <SPANCLASS="acronym">DNS</SPAN>Server <EMCLASS="emphasis">does</EM> support <SPANCLASS="acronym">DNS</SPAN><SPANCLASS="acronym">NOTIFY</SPAN>.</P><PCLASS="para">In <SPANCLASS="acronym">BIND</SPAN> 8, <SPANCLASS="acronym">DNS</SPAN><SPANCLASS="acronym">NOTIFY</SPAN> is on by default, but you can turn<SPANCLASS="acronym">NOTIFY</SPAN> off globally with the substatement:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">options {                notify no;};</PRE></BLOCKQUOTE><PCLASS="para">You can also turn <SPANCLASS="acronym">NOTIFY</SPAN> on or off for aparticular zone.  For example, say you know that all of the slaveservers for your <ICLASS="systemitem.sitename">acmebw.com</I>zone are running <SPANCLASS="acronym">BIND</SPAN> 4, and therefore don'tunderstand <SPANCLASS="acronym">NOTIFY</SPAN> requests.  The <ICLASS="function">zone</I>statement:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">zone &quot;acmebw.com&quot; {                type master;                file &quot;db.acmebw&quot;;                notify no;};</PRE></BLOCKQUOTE><PCLASS="para">avoids sending useless <SPANCLASS="acronym">NOTIFY</SPAN> messages to theslaves for <ICLASS="systemitem.sitename">acmebw.com</I>.  Azone-specific <SPANCLASS="acronym">NOTIFY</SPAN> setting overrides any globalsetting for that zone.  Unfortunately, the current version of<SPANCLASS="acronym">BIND</SPAN> doesn't allow you to turn off<SPANCLASS="acronym">NOTIFY</SPAN> on a server-by-server basis.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10472"></A><SPANCLASS="acronym">BIND</SPAN> 8 even has a provision for addingservers to your <SPANCLASS="quote">"<SPANCLASS="acronym">NOTIFY</SPAN> list"</SPAN> besidesthose in your zone's <SPANCLASS="acronym">NS</SPAN> records.  For example, youmay have one or more unregistered slave servers (described in <ACLASS="xref"HREF="ch08_01.htm"TITLE="Growing Your Domain">Chapter 8, <CITECLASS="chapter">Growing Your Domain</CITE></A>) that you'd still like to pick up zone changesquickly.  Or the server you're configuring may be a slave for thezone, but is the master server for another slave, and needs to send<SPANCLASS="acronym">NOTIFY</SPAN> messages to it.</P><PCLASS="para">To add a server to your <SPANCLASS="acronym">NOTIFY</SPAN>list, use the <ICLASS="function">also-notify</I> substatement of the <ICLASS="function">zone</I> statement:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">zone &quot;acmebw.com&quot; {                type master;                file &quot;db.acmebw.com&quot;;                notify yes;                also-notify 15.255.152.4;};</PRE></BLOCKQUOTE><ACLASS="indexterm"NAME="AUTOID-10486"></A><ACLASS="indexterm"NAME="AUTOID-10487"></A><ACLASS="indexterm"NAME="AUTOID-10488"></A><ACLASS="indexterm"NAME="AUTOID-10489"></A><ACLASS="indexterm"NAME="AUTOID-10490"></A><ACLASS="indexterm"NAME="AUTOID-10491"></A><ACLASS="indexterm"NAME="AUTOID-10492"></A></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_01.htm"TITLE="10.1 Address Match Lists and ACLs"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.1 Address Match Lists and ACLs"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="DNS &amp; BIND"><IMGSRC="../gifs/txthome.gif"ALT="DNS &amp; BIND"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_03.htm"TITLE="10.3 DNS Dynamic Update"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.3 DNS Dynamic Update"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">10.1 Address Match Lists and ACLs</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">10.3 DNS Dynamic Update</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>