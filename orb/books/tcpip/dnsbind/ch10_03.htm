<HTML><HEAD><TITLE>[Chapter 10] 10.3 DNS Dynamic Update</TITLE><METANAME="DC.title"CONTENT="DNS &amp; BIND"><METANAME="DC.creator"CONTENT="Cricket Liu &amp; Paul Albitz"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:35:54Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-512-2"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch10_01.htm"TITLE="10. Advanced Features and Security"><LINKREL="prev"HREF="ch10_02.htm"TITLE="10.2 DNS NOTIFY (Zone Change Notification)"><LINKREL="next"HREF="ch10_04.htm"TITLE="10.4 System Tuning"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="DNS &amp; BIND"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="DNS &amp; BIND"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/dsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_02.htm"TITLE="10.2 DNS NOTIFY (Zone Change Notification)"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.2 DNS NOTIFY (Zone Change Notification)"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 10<BR>Advanced Features and Security</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_04.htm"TITLE="10.4 System Tuning"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.4 System Tuning"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-10493">10.3 <SPANCLASS="acronym">DNS</SPAN> Dynamic Update</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH10.UPDATE1"></A><ACLASS="indexterm"NAME="CH10.UPDATE2"></A><ACLASS="indexterm"NAME="CH10.UPDATE3"></A><SPANCLASS="acronym">BIND</SPAN> 8 also supports the dynamic updatefacility described in <SPANCLASS="acronym">RFC</SPAN> 2136.  This permitsauthorized updaters to add and delete resource records from a zone forwhich the server is authoritative.  An updater can find theauthoritative name servers for a zone by retrieving the zone's<SPANCLASS="acronym">NS</SPAN> records.  If the server receiving an authorizedupdate message is not the primary master for the zone, it will forwardthe update <SPANCLASS="quote">"upstream"</SPAN> to its master server(s).  If they,in turn, are slaves for the zone, they will also forward the updateupstream.</P><PCLASS="para">Dynamic update permits more than the simple addition anddeletion of records.  Updaters can add or delete individual resourcerecords, delete <SPANCLASS="acronym">RR</SPAN>sets (a set of resource recordswith the same domain name, class and type, such as all Internetaddresses for <ICLASS="systemitem.sitename">www.acmebw.com</I>), or even delete allrecords associated with a given name.  An update can also stipulatethat certain prerequisite records exist or not exist in the zonebefore the update takes effect.  For example, an update can add theaddress record:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">dakota.west.acmebw.com.          in      a       192.168.1.4</PRE></BLOCKQUOTE><PCLASS="para">only if the name <ICLASS="systemitem.sitename">dakota.west.acmebw.com</I> isn't currentlybeing used, or only if <ICLASS="systemitem.sitename">dakota.west.acmebw.com</I> currently has noaddress records.</P><PCLASS="para">For the most part, dynamic update functionality is used byprograms like <SPANCLASS="acronym">DHCP</SPAN> servers that assign<SPANCLASS="acronym">IP</SPAN> addresses automatically to computers, and thenneed to register the resulting name-to-address and address-to-namemappings.  These programs use the <ICLASS="function">ns_update()</I>routine to create update messages and send them to an authoritativeserver for the zone that contains the domain name.</P><PCLASS="para">However, it is possible to create updates manually with the<ACLASS="indexterm"NAME="CH10.NSUPDATE"></A>command-line program <KBDCLASS="command">nsupdate</KBD>, which is part of thestandard <SPANCLASS="acronym">BIND</SPAN> distribution.<KBDCLASS="command">nsupdate</KBD> reads one-line commands that it thentranslates into an update message.  Commands can be specified onstandard input (the default) or in a file, whose name must be given asan argument to <KBDCLASS="command">nsupdate</KBD>.  Commands not separated bya blank line are incorporated into the same update message.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10528"></A>The commands <KBDCLASS="command">nsupdate</KBD> understands are:</P><DLCLASS="variablelist"><DTCLASS="term"><CODECLASS="literal">prereq yxrrset <CODECLASS="replaceable"><I>domain name</I></CODE> <CODECLASS="replaceable"><I>type</I></CODE> [<CODECLASS="replaceable"><I>rdata</I></CODE>]</CODE></DT><DDCLASS="listitem"><PCLASS="para">Makes the existence of an <SPANCLASS="acronym">RR</SPAN>set of type<CODECLASS="replaceable"><I>type</I></CODE> owned by <CODECLASS="replaceable"><I>domain name</I></CODE> a prerequisite to performing theupdate</P></DD><DTCLASS="term"><CODECLASS="literal">prereq nxrrset</CODE></DT><DDCLASS="listitem"><PCLASS="para">Makes the non-existence of an <SPANCLASS="acronym">RR</SPAN>set of type<CODECLASS="replaceable"><I>type</I></CODE> owned by <CODECLASS="replaceable"><I>domain name</I></CODE> a prerequisite to performing theupdate specified in successive <KBDCLASS="command">update</KBD> commands</P></DD><DTCLASS="term"><CODECLASS="literal">prereq yxdomain <CODECLASS="replaceable"><I>domain name</I></CODE></CODE></DT><DDCLASS="listitem"><PCLASS="para">Makes the existence of the domain name specified a prerequisiteto performing the update</P></DD><DTCLASS="term"><CODECLASS="literal">prereq nxdomain</CODE></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10563"></A>Makes the non-existence of the domain name specified aprerequisite to performing the update</P></DD><DTCLASS="term"><CODECLASS="literal">update delete <CODECLASS="replaceable"><I>domain name</I></CODE> [<CODECLASS="replaceable"><I>type</I></CODE>] [<CODECLASS="replaceable"><I>rdata</I></CODE>]</CODE></DT><DDCLASS="listitem"><PCLASS="para">Deletes the domain name specified or, if <CODECLASS="replaceable"><I>type</I></CODE> is alsospecified, deletes the <SPANCLASS="acronym">RR</SPAN>set specified or, if<CODECLASS="replaceable"><I>rdata</I></CODE> is also specified, deletes the record matching <CODECLASS="replaceable"><I>domainname</I></CODE>, <CODECLASS="replaceable"><I>type</I></CODE>, and <CODECLASS="replaceable"><I>rdata</I></CODE></P></DD><DTCLASS="term"><CODECLASS="literal">update add <CODECLASS="replaceable"><I>domain name</I></CODE> <CODECLASS="replaceable"><I>ttl</I></CODE> [<CODECLASS="replaceable"><I>class</I></CODE>] <CODECLASS="replaceable"><I>type</I></CODE> <CODECLASS="replaceable"><I>rdata</I></CODE></CODE></DT><DDCLASS="listitem"><PCLASS="para">Adds the record specified to the zone.  Note that the<SPANCLASS="acronym">TTL</SPAN>, in addition to the type andresource-record-specific data, must be included, but the class isoptional, and defaults to <SPANCLASS="acronym">IN</SPAN></P></DD></DL><PCLASS="para">So, for example, the command:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nsupdate</B></CODE>&gt; <CODECLASS="userinput"><B>prereq nxdomain dakota.west.acmebw.com.</B></CODE>&gt; <CODECLASS="userinput"><B>update add dakota.west.acmebw.com. 333 in a 192.168.0.4</B></CODE>&gt;</PRE></BLOCKQUOTE><PCLASS="para">tells the server to add an address for <ICLASS="systemitem.sitename">dakota.west.acmebw.com</I> only if the domainname does not already exist.  Note that the last blank line is<KBDCLASS="command">nsupdate</KBD>'s cue to send the update.</P><PCLASS="para">The command:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nsupdate</B></CODE>&gt; <CODECLASS="userinput"><B>prereq yxrrset dakota.west.acmebw.com. in mx</B></CODE>&gt; <CODECLASS="userinput"><B>update delete dakota.west.acmebw.com. in mx</B></CODE>&gt; <CODECLASS="userinput"><B>update add dakota.west.acmebw.com. in mx 10 dakota.west.acmebw.com.</B></CODE>&gt; <CODECLASS="userinput"><B>update add dakota.west.acmebw.com. in mx 50 store-forward.mindspring.com.</B></CODE>&gt;</PRE></BLOCKQUOTE><PCLASS="para">checks to see whether <ICLASS="systemitem.sitename">dakota.west.acmebw.com</I> already has<SPANCLASS="acronym">MX</SPAN> records, and if it does, deletes them and addstwo in their place.<ACLASS="indexterm"NAME="AUTOID-10609"></A></P><PCLASS="para">Given the fearsome control that dynamic updates obviously givean updater over a zone, you clearly need to restrict them, if you usethem at all.  By default, <SPANCLASS="acronym">BIND</SPAN> 8 servers don'tallow dynamic updates to authoritative zones.  In order to use them,<ACLASS="indexterm"NAME="AUTOID-10612"></A>you add an <ICLASS="function">allow-update</I> substatement to the <ICLASS="function">zone</I> statement for thezone that you'd like to allow updates to.</P><PCLASS="para"><ICLASS="function">allow-update</I> takes an address match list as an argument.  Theaddress or addresses matched by the list are the only addresses thatare allowed to send your server updates to that zone.  It's prudent tomake this access list as restrictive as possible:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">zone &quot;acmebw.com&quot; {                type master;                file &quot;db.acmebw&quot;;                allow-update { 192.168.0.1; };};</PRE></BLOCKQUOTE><ACLASS="indexterm"NAME="AUTOID-10619"></A><ACLASS="indexterm"NAME="AUTOID-10620"></A><ACLASS="indexterm"NAME="AUTOID-10621"></A></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_02.htm"TITLE="10.2 DNS NOTIFY (Zone Change Notification)"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.2 DNS NOTIFY (Zone Change Notification)"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="DNS &amp; BIND"><IMGSRC="../gifs/txthome.gif"ALT="DNS &amp; BIND"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_04.htm"TITLE="10.4 System Tuning"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.4 System Tuning"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">10.2 DNS NOTIFY (Zone Change Notification)</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">10.4 System Tuning</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>