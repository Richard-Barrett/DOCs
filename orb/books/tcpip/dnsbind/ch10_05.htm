<HTML><HEAD><TITLE>[Chapter 10] 10.5 Name Server Address Sorting</TITLE><METANAME="DC.title"CONTENT="DNS &amp; BIND"><METANAME="DC.creator"CONTENT="Cricket Liu &amp; Paul Albitz"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:36:14Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-512-2"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch10_01.htm"TITLE="10. Advanced Features and Security"><LINKREL="prev"HREF="ch10_04.htm"TITLE="10.4 System Tuning"><LINKREL="next"HREF="ch10_06.htm"TITLE="10.6 Preferring Name Servers on Certain Networks"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="DNS &amp; BIND"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="DNS &amp; BIND"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/dsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_04.htm"TITLE="10.4 System Tuning"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.4 System Tuning"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 10<BR>Advanced Features and Security</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_06.htm"TITLE="10.6 Preferring Name Servers on Certain Networks"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.6 Preferring Name Servers on Certain Networks"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-10943">10.5 Name Server Address Sorting</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH10.SORTING1"></A><ACLASS="indexterm"NAME="CH10.SORTING2"></A><ACLASS="indexterm"NAME="AUTOID-10951"></A>When you are contacting a host that has multiple network interfaces,using a particular interface may give you better performance. If the<ACLASS="indexterm"NAME="CH10.MULTIHOMED1"></A><ACLASS="indexterm"NAME="CH10.MULTIHOMED2"></A>multihomed host is local and shares a network with your host, one ofthe multihomed host's addresses is <SPANCLASS="quote">"closer."</SPAN> If themultihomed host is remote, you <EMCLASS="emphasis">may</EM> see betterperformance by using one of the interfaces instead of another, butoften it doesn't matter much which address is used. In days past, net10 (the former <SPANCLASS="acronym">ARPA</SPAN>net <SPANCLASS="quote">"backbone"</SPAN>) wasalways closer than any other remote address. The Internet has improveddrastically since those days, so you won't often see a markedimprovement by preferring one network over another for remotemultihomed hosts, but we'll cover that case anyway.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10965"></A>Before we get into address sorting by a name server, you shouldfirst look at whether address sorting by the resolver better suitsyour needs. (See the section called <SPANCLASS="quote">"The sortlistDirective"</SPAN> in <ACLASS="xref"HREF="ch06_01.htm"TITLE="Configuring Hosts">Chapter 6, <CITECLASS="chapter">Configuring Hosts</CITE></A>.) Since your resolverand name server may be on different networks, it often makes moresense for the resolver to sort addresses optimally for itshost. Address sorting at the name server works fairly well, but itwon't be optimal for every resolver it services.  Resolver addresssorting was added at 4.9. If your resolver (not your name server) isolder than 4.9, you are out of luck. You'll have to make do withaddress sorting at the name server, which was introduced in4.8.3.</P><PCLASS="para">We should also mention that address sorting is not supported in<SPANCLASS="acronym">BIND</SPAN> 8.  For <SPANCLASS="acronym">BIND</SPAN> 8, thedevelopers removed address sorting because they believed that it hadno place in the server.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-10973">10.5.1 Local Multihomed Hosts</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10976"></A>Let's deal with the local multihomed host first. Suppose you have asource host (i.e., a host that keeps your master sources) on twonetworks, cleverly called network A and network B, and this host uses<SPANCLASS="acronym">NFS</SPAN> to export filesystems to hosts on bothnetworks. Hosts on network A will experience better performance ifthey use the source host's interface to network A. Likewise, hosts onnetwork B would benefit from using the source host's interface tonetwork B for the address of the <SPANCLASS="acronym">NFS</SPAN> mount.</P><PCLASS="para">In <ACLASS="xref"HREF="ch04_01.htm"TITLE="Setting Up BIND">Chapter 4, <CITECLASS="chapter">Setting Up <SPANCLASS="acronym">BIND</SPAN></CITE></A>, we mentioned that<SPANCLASS="acronym">BIND</SPAN> returns all the addresses for a multihomedhost. There was no guarantee of the order in which a<SPANCLASS="acronym">DNS</SPAN> server would return the addresses, so weassigned aliases (<ICLASS="systemitem.sitename">wh249</I> and<ICLASS="systemitem.sitename">wh253</I> for <ICLASS="systemitem.sitename">wormhole</I>) to the individualinterfaces. If one interface was preferable, you (or morerealistically, a <SPANCLASS="acronym">DNS</SPAN> client) could use anappropriate alias to get the correct address. You<EMCLASS="emphasis">can</EM> use aliases to choose the<SPANCLASS="quote">"closer"</SPAN> interface (e.g., for setting up<SPANCLASS="acronym">NFS</SPAN> mounts), but because of address sorting, theyare not always necessary.</P><PCLASS="para"><SPANCLASS="acronym">BIND</SPAN> 4 servers, by default, sort addresses ifone condition holds: if the host that sent the query to the nameserver <EMCLASS="emphasis">shares</EM> a network with the name server host(e.g., both are on network A), then <SPANCLASS="acronym">BIND</SPAN> sorts theaddresses in the response. How does <SPANCLASS="acronym">BIND</SPAN> know whenit shares a network with the querier? It knows because when<SPANCLASS="acronym">BIND</SPAN> starts up, it finds out all the interfaceaddresses of the host it is running on. <SPANCLASS="acronym">BIND</SPAN>extracts the network numbers from these addresses to create thedefault sort list. When a query is received, <SPANCLASS="acronym">BIND</SPAN>checks if the sender's address is on a network in the default sortlist. If it is, then the query is local and <SPANCLASS="acronym">BIND</SPAN>sorts the addresses in the response.</P><PCLASS="para">In <ACLASS="xref"HREF="ch10_05.htm#DNS3-CHP-10-FIG-3"TITLE="Communicating with a local multihomed host">Figure 10.3</A>, assume that there is a<SPANCLASS="acronym">BIND</SPAN> 4 name server on <ICLASS="systemitem.sitename">notorious</I>. The name server's default sortlist would contain network A and network B.  When <ICLASS="systemitem.sitename">spellbound</I> sends a query to <ICLASS="systemitem.sitename">notorious</I> looking up the addresses of<ICLASS="systemitem.sitename">notorious</I>, it will get ananswer back with <ICLASS="systemitem.sitename">notorious</I>'snetwork A address first.  That's because <ICLASS="systemitem.sitename">notorious</I> and <ICLASS="systemitem.sitename">spellbound</I> share network A. When<ICLASS="systemitem.sitename">charade</I> looks up theaddresses of <ICLASS="systemitem.sitename">notorious</I>, itwill get an answer back with <ICLASS="systemitem.sitename">notorious</I>'s network B address first. Bothhosts are on network B. In both of these cases, the name server sortsthe addresses in the response because the hosts share a network withthe name server host. The sorted address list has the<SPANCLASS="quote">"closer"</SPAN> interface first (see <ACLASS="xref"HREF="ch10_05.htm#DNS3-CHP-10-FIG-3"TITLE="Communicating with a local multihomed host">Figure 10.3</A>).</P><H4CLASS="figure"><ACLASS="title"NAME="DNS3-CHP-10-FIG-3">Figure 10.3: Communicating with a local multihomed host</A></H4><IMGCLASS="graphic"SRC="figs/dns3_1003.gif"ALT="Figure 10.3"><PCLASS="para">Let's change the situation slightly. Suppose the name server isrunning on <ICLASS="systemitem.sitename">gaslight</I>. When<ICLASS="systemitem.sitename">spellbound</I> queries<ICLASS="systemitem.sitename">gaslight</I> for <ICLASS="systemitem.sitename">notorious</I>'s address, <ICLASS="systemitem.sitename">spellbound</I> will see the same response asin the last case because <ICLASS="systemitem.sitename">spellbound</I> and <ICLASS="systemitem.sitename">gaslight</I> share network A, which meansthat the name server will sort the response.  However, <ICLASS="systemitem.sitename">charade</I> may see a differently-orderedresponse, since it does not share a network with <ICLASS="systemitem.sitename">gaslight</I>.  The closer address for<ICLASS="systemitem.sitename">notorious</I> may still be firstin the response to <ICLASS="systemitem.sitename">charade</I>,but only because of luck, not name server address sorting. In thiscase, you'd have to run an additional name server on network B for<ICLASS="systemitem.sitename">charade</I> to benefit from<SPANCLASS="acronym">BIND</SPAN> 4's default address sorting.</P><PCLASS="para">As you can see, you benefit by running a name server on eachnetwork; not only is your name server available if your router goesdown, it also sorts addresses of multihomed hosts. Because the nameserver sorts addresses, you do not need to specify aliases for<SPANCLASS="acronym">NFS</SPAN> mounts or network logins to get the bestresponse.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-11035">10.5.2 Remote Multihomed Hosts</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-11038"></A>Suppose that your site often contacts a particular remote site or a<SPANCLASS="quote">"distant"</SPAN> local site, and that you get better performanceby favoring addresses on one of the remote site's networks. Forinstance, the <ICLASS="systemitem.sitename">movie.edu</I>domain has networks 192.249.249 and 192.253.253. Let's add aconnection to net 10 (the old <SPANCLASS="acronym">ARPA</SPAN>net). The remotehost being contacted has two network connections, one to network 10and one to network 26.  This host does not route to network 26, butfor special reasons it has a network 26 connection. Since the routerto network 26 is always overloaded, you'll get better performance byusing the remote host's net 10 address. <ACLASS="xref"HREF="ch10_05.htm#DNS3-CHP-10-FIG-4"TITLE="Communicating with a remote multihomed host">Figure 10.4</A> shows this situation.</P><H4CLASS="figure"><ACLASS="title"NAME="DNS3-CHP-10-FIG-4">Figure 10.4: Communicating with a remote multihomed host</A></H4><IMGCLASS="graphic"SRC="figs/dns3_1004.gif"ALT="Figure 10.4"><PCLASS="para">If a user on <ICLASS="systemitem.sitename">terminator</I>is contacting <ICLASS="systemitem.sitename">reanimator</I>,it's preferable to use the network 10 address, because access through<ICLASS="systemitem.sitename">gateway B</I> to the network 26address will be slower than the direct route. Unfortunately, the nameserver running on <ICLASS="systemitem.sitename">terminator</I>will not <EMCLASS="emphasis">intentionally</EM> place network address 10first in the list when it looks up the addresses for <ICLASS="systemitem.sitename">reanimator</I>; the only network that<ICLASS="systemitem.sitename">terminator</I> is attached to is192.249.249, and so it doesn't know that network 10 is<SPANCLASS="quote">"closer"</SPAN> than network 26. This is where the<ACLASS="indexterm"NAME="AUTOID-11056"></A><ACLASS="indexterm"NAME="AUTOID-11058"></A><ACLASS="indexterm"NAME="AUTOID-11060"></A><ICLASS="structfield">sortlist</I> boot file entry comes intoplay. To indicate a preference for network 10 addresses, add thefollowing line to <ICLASS="filename">named.boot</I>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">sortlist 10.0.0.0</PRE></BLOCKQUOTE><PCLASS="para">The <ICLASS="structfield">sortlist</I> entries are<EMCLASS="emphasis">appended</EM> to the default sort list. With this<ICLASS="structfield">sortlist</I> entry, the sort list on<ICLASS="systemitem.sitename">terminator</I> now containsnetworks 192.249.249 and 10. Now, when a user on <ICLASS="systemitem.sitename">terminator</I> queries the name server on<ICLASS="systemitem.sitename">terminator</I>, and the nameserver sorts the response because the query is local, the name serverwill check for addresses on the 192.249.249 network and place themfirst in the response. If there are no addresses on network192.249.249, it will check for network 10 addresses and place themfirst in the response. This solves the problem we describedearlier&nbsp;- when <ICLASS="systemitem.sitename">reanimator</I>is looked up, its network 10 address will be placed first in theresponse.</P><ACLASS="indexterm"NAME="AUTOID-11074"></A><ACLASS="indexterm"NAME="AUTOID-11075"></A></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-11076">10.5.3 Address Sorting on Subnetted Networks</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-11079"></A><ACLASS="indexterm"NAME="AUTOID-11081"></A>Subnetted networks change address sorting only slightly. When the nameserver creates its default sort list, it adds both the subnet numberand the network number to the list. Like before, when the query islocal and the name server sorts the response, the common subnetaddress will be placed first. Unfortunately, not everything isperfect&nbsp;- you can't add <ICLASS="structfield">sortlist</I>entries for other subnets of your network. Here's why: the name serverassumes all the <ICLASS="structfield">sortlist</I> entries arenetwork numbers (not subnet numbers), and your network number isalready on the sort list. Since your network number is already on thelist, the subnet <ICLASS="structfield">sortlist</I> entry isdiscarded.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-11087">10.5.4 Multiple Sortlist Entries</A></H3><PCLASS="para">One last thing&nbsp;- if you want to add more than one<ICLASS="structfield">sortlist</I> entry, you must specify them allon the same line, like this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">sortlist 10.0.0.0 26.0.0.0<ACLASS="indexterm"NAME="AUTOID-11092"></A><ACLASS="indexterm"NAME="AUTOID-11095"></A></PRE></BLOCKQUOTE></DIV><ACLASS="indexterm"NAME="AUTOID-11097"></A><ACLASS="indexterm"NAME="AUTOID-11098"></A></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_04.htm"TITLE="10.4 System Tuning"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.4 System Tuning"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="DNS &amp; BIND"><IMGSRC="../gifs/txthome.gif"ALT="DNS &amp; BIND"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_06.htm"TITLE="10.6 Preferring Name Servers on Certain Networks"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.6 Preferring Name Servers on Certain Networks"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">10.4 System Tuning</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">10.6 Preferring Name Servers on Certain Networks</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>