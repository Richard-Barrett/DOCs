<HTML><HEAD><TITLE>[Chapter 13] 13.3 Potential Problem List</TITLE><METANAME="DC.title"CONTENT="DNS &amp; BIND"><METANAME="DC.creator"CONTENT="Cricket Liu &amp; Paul Albitz"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:39:08Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-512-2"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch13_01.htm"TITLE="13. Troubleshooting DNS and BIND"><LINKREL="prev"HREF="ch13_02.htm"TITLE="13.2 Troubleshooting Tools and Techniques"><LINKREL="next"HREF="ch13_04.htm"TITLE="13.4 Transition Problems"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="DNS &amp; BIND"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="DNS &amp; BIND"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/dsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch13_02.htm"TITLE="13.2 Troubleshooting Tools and Techniques"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 13.2 Troubleshooting Tools and Techniques"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 13<BR>Troubleshooting <SPANCLASS="acronym">DNS</SPAN> and<SPANCLASS="acronym">BIND</SPAN></FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch13_04.htm"TITLE="13.4 Transition Problems"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 13.4 Transition Problems"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-13652">13.3 Potential Problem List</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH13.PROBLEMS"></A>Nowthat we've given you a nice set of tools, let's talk about how youcan use them to diagnose real problems. There are some problemsthat are easy to recognize and correct. We should cover these asa matter of course&nbsp;- they're some of the most common problems becausethey're caused by some of the most common mistakes. Here are thecontestants, in no particular order. We call 'em our <SPANCLASS="quote">"Unlucky Thirteen."</SPAN></P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-13659">13.3.1 1. Forgot to Increment Serial Number</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="CH13.SERIAL"></A><ACLASS="indexterm"NAME="AUTOID-13665"></A>The main symptomof this problem is that slave name servers don't pick up any changesyou make to the zone's db file on the primary. The slaves thinkthe zone data hasn't changed, since the serial number is still the same.</P><PCLASS="para">How do you check whether or not you remembered to incrementthe serial number? Unfortunately, that's not so easy. If you don'tremember what the old serial number was, and your serial numbergives you no indication of when it was updated, there's no directway to tell whether it's changed.[1] When you signal theprimary, it will load the updated zone file regardless of whether you'vechanged the serial number. It will check the file's timestamp,see that it's been modified since it last loaded the data, and readthe file. About the best you can do is to use <KBDCLASS="command">nslookup</KBD> tocompare the data returned by the primary and by a slave. If they returndifferent data, you probably forgot to increment the serial number.If you can remember a recent change you made, you can look for thatdata. If you can't remember a recent change, you could try transferringthe zone from a primary and from a slave, sorting the results, andusing <KBDCLASS="command">diff</KBD> to compare them.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1]  On the other hand,if you encode the date into the serial number, as many people do(e.g., 1998010500 is the first rev of data on January 5, 1998),you may be able to tell at a glance whether you updated the serial numberwhen you made the change.</P></BLOCKQUOTE><PCLASS="para">Thegood news is that, although determining whether the zone was transferredis tricky, making sure the zone is transferred is simple. Just incrementthe serial number on the primary's copy of the db file and signalthe primary to reload. The slaves should pick up the new data within theirrefresh interval, or sooner if they use <SPANCLASS="acronym">NOTIFY</SPAN>. If you want to makesure the slaves can transfer the new data, you can execute <KBDCLASS="command">named-xfer</KBD> byhand (on the slaves, naturally):</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>/etc/named-xfer -z movie.edu -f db.movie -s 0 terminator</B></CODE># <CODECLASS="userinput"><B>echo $?</B></CODE></PRE></BLOCKQUOTE><PCLASS="para">If <KBDCLASS="command">named-xfer</KBD> returns 1, the zone wastransferred successfully. Other return values indicate that no zonewas transferred, either because of an error or because the slavethought the zone was up-to-date. (See <ACLASS="xref"HREF="ch13_02.htm#USE-NAMED-XFER"TITLE="How to Use named-xfer">Section 13.2.1, "How to Use named-xfer</A>,&quot;earlier in this chapter, for more details.)</P><PCLASS="para">There's another variation on the <SPANCLASS="quote">"forgot to increment theserial number"</SPAN> line. We see it in environments where administratorsuse tools like <KBDCLASS="command">h2n</KBD> to create db files fromthe host table. With scripts like<ACLASS="indexterm"NAME="AUTOID-13685"></A><KBDCLASS="command">h2n</KBD>, it's temptingly easy to delete old dbfiles and create new ones from scratch. Some administrators do thisoccasionally because they mistakenly believe that data in the olddb files can creep into the new ones. The problem with deletingthe db files is that, without the old db file to read for the currentserial number, <KBDCLASS="command">h2n</KBD> starts over at serial number1. If your primary's serial number rolls all the way back to 1 from598 or what-have-you, the slaves (versions 4.8.3 and earlier) don'tcomplain; they just figure they're all caught up and don't needzone transfers. A 4.9 or later slave server, however, is ever watchful, andwill emit a syslog error message warning you that something mightbe wrong:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jun  7 20:14:26 wormhole named[29618]: Zone &quot;movie.edu&quot;                (class 1) <SPANCLASS="acronym">SOA</SPAN> serial# (1) rcvd from [192.249.249.3]                is &lt; ours (112)</PRE></BLOCKQUOTE><PCLASS="para">So if the serial number on the primary looks suspiciously low,check the serial number on the slaves, too, and compare them:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nslookup</B></CODE>Default Server:  terminator.movie.eduAddress:  192.249.249.3&gt; <CODECLASS="userinput"><B>set q=soa</B></CODE>&gt; <CODECLASS="userinput"><B>movie.edu.</B></CODE>Server:  terminator.movie.eduAddress:  192.249.249.3movie.edu        origin = terminator.movie.edu        mail addr = al.robocop.movie.edu        serial = 1        refresh = 10800 (3 hours)        retry   = 3600 (1 hour)        expire  = 604800 (7 days)        minimum ttl = 86400 (1 day)&gt; <CODECLASS="userinput"><B>server wormhole.movie.edu.</B></CODE>Default Server:  wormhole.movie.eduAddresses:  192.249.249.1, 192.253.253.1&gt; <CODECLASS="userinput"><B>movie.edu.</B></CODE>Server:  wormhole.movie.eduAddresses:  192.249.249.1, 192.253.253.1movie.edu        origin = terminator.movie.edu        mail addr = al.robocop.movie.edu        serial = 112        refresh = 10800 (3 hours)        retry   = 3600 (1 hour)        expire  = 604800 (7 days)        minimum ttl = 86400 (1 day)</PRE></BLOCKQUOTE><PCLASS="para"><ICLASS="systemitem.sitename">wormhole</I>, as a <ICLASS="systemitem.sitename">movie.edu</I> slave,should never have a larger serial number than the primary master,so clearly something's amiss.</P><PCLASS="para">This problem is reallyeasy to spot, by the way, with the tool we'll write in <ACLASS="xref"HREF="ch14_01.htm"TITLE="Programming with the Resolver and Name Server Library Routines">Chapter 14, <CITECLASS="chapter">Programming with the Resolver and Name Server LibraryRoutines</CITE></A>, coming up next.</P><ACLASS="indexterm"NAME="AUTOID-13703"></A></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-13704">13.3.2 2. Forgot to Signal Primary Master Server</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13707"></A><ACLASS="indexterm"NAME="AUTOID-13710"></A>Occasionally, you may forget tosignal your primary master name server after making a change tothe conf file or to the db file. The name server won't know to loadthe new data&nbsp;- it doesn't automatically check the timestamp of thefile and notice that it changed. Consequently, any changes you've madewon't be reflected in the name server's data: new zones won't beloaded, and new records won't percolate out to the slaves.</P><PCLASS="para">Tocheck when you last signaled the name server to reload, scan the <KBDCLASS="command">syslog</KBD> outputfor the last entry like this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mar  8 17:22:08 terminator named[22317]: reloading nameserver<ACLASS="indexterm"NAME="AUTOID-13716"></A></PRE></BLOCKQUOTE><PCLASS="para">This is the last time you sent a <SPANCLASS="acronym">HUP</SPAN> signal to thename server. If you killed and then restarted the name server, you'llsee an entry like this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mar  8 17:22:08 terminator named[22317]: restarted<ACLASS="indexterm"NAME="AUTOID-13721"></A></PRE></BLOCKQUOTE><PCLASS="para">or, on a 4.9 name server:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mar  8 17:22:08 terminator named[22317]: starting</PRE></BLOCKQUOTE><PCLASS="para">If the time of the restart doesn't correlate withthe time you made the last change, signal the name server to reloadits data again. And check that you incremented the serial numberson db files you changed, too.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-13726">13.3.3 3. Slave Server Can't Load Zone Data</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="CH13.LOADZONE1"></A><ACLASS="indexterm"NAME="CH13.LOADZONE2"></A>If a slave name server can't getthe current serial number for a zone from its master name server,it'll log a message like the following via <KBDCLASS="command">syslog</KBD>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan  6 11:55:25 wormhole named[544]: Err/<SPANCLASS="acronym">TO</SPAN> getting serial# for &quot;movie.edu&quot;</PRE></BLOCKQUOTE><PCLASS="para">On a <SPANCLASS="acronym">BIND</SPAN> 4 name server, that looks like this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mar  3 8:19:34 wormhole named[22261]: zoneref: Masters for secondary       zone movie.edu unreachable</PRE></BLOCKQUOTE><PCLASS="para">If you let this problem fester, the slave will expirethe zone:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mar  8 17:12:43 wormhole named[22261]: secondary zone       &quot;movie.edu&quot; expired</PRE></BLOCKQUOTE><PCLASS="para">Once the zone has expired, you'll start getting<ACLASS="indexterm"NAME="AUTOID-13744"></A><SPANCLASS="acronym">SERVFAIL</SPAN> errors when you query the nameserver for data in the zone:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nslookup robocop wormhole.movie.edu.</B></CODE>Server:  wormhole.movie.eduAddresses:  192.249.249.1, 192.253.253.1*** wormhole.movie.edu can't find robocop.movie.edu: Server failed</PRE></BLOCKQUOTE><PCLASS="para">There are three leading causes of this problem: aloss in<ACLASS="indexterm"NAME="AUTOID-13750"></A>connectivityto the master server due to network failure, an incorrect <SPANCLASS="acronym">IP</SPAN> addressfor the master server in the conf file, and a syntax error in thezone data file on the master server. First check the conf file'sentry for the zone and see what <SPANCLASS="acronym">IP</SPAN> address the slave is attemptingto load from:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">zone &quot;movie.edu&quot; {                type slave;                file &quot;db.movie&quot;;                masters { 192.249.249.3; };};</PRE></BLOCKQUOTE><PCLASS="para">On a <SPANCLASS="acronym">BIND</SPAN> 4 server, the directive would look like this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">secondary        movie.edu        192.249.249.3        db.movie</PRE></BLOCKQUOTE><PCLASS="para">Make sure that's really the <SPANCLASS="acronym">IP</SPAN> address of the mastername server. If it is, check connectivity to that <SPANCLASS="acronym">IP</SPAN> address:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>ping 192.249.249.3 -n 10</B></CODE><SPANCLASS="acronym">PING</SPAN> 192.249.249.3: 64 byte packets----192.249.249.3 <SPANCLASS="acronym">PING</SPAN> Statistics----10 packets transmitted, 0 packets received, 100% packet loss</PRE></BLOCKQUOTE><PCLASS="para">If the master server isn't reachable, make sure thatthe server's host is really running (e.g., is powered on, etc.), orlook for a network problem. If the server is reachable, make sure <KBDCLASS="command">named</KBD> isrunning on the host, and that you can manually transfer the zone:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>named-xfer -z movie.edu -f /tmp/db.movie -s 0 192.249.249.3</B></CODE># <CODECLASS="userinput"><B>echo $?</B></CODE>2</PRE></BLOCKQUOTE><PCLASS="para">A return code of 2 means that an error occurred.Check to see if there is a <KBDCLASS="command">syslog</KBD> message.In this case there was a message:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan  6 14:56:07 zardoz named-xfer[695]: record too short from [192.249.249.3], zone movie.edu</PRE></BLOCKQUOTE><PCLASS="para">At first glance, this error looks like a truncationproblem. The real problem is easier to see if you use <KBDCLASS="command">nslookup</KBD>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nslookup - terminator.movie.edu</B></CODE>Default Server:  terminator.movie.eduAddress:  192.249.249.3&gt; <CODECLASS="userinput"><B>ls movie.edu</B></CODE>                  <ICLASS="lineannotation">--This attempts a zone transfer</I>[terminator.movie.edu]*** Can't list domain movie.edu: Query refused</PRE></BLOCKQUOTE><PCLASS="para">What has happened here is that <KBDCLASS="command">named</KBD> isrefusing to allow you to transfer its zone data. The remote serverhas secured its zone data with the <EMCLASS="emphasis">allow-transfer</EM> substatement,the <ICLASS="structfield">secure_zone</I> resource record, or <ICLASS="structfield">xfrnets</I> bootfile directive.</P><PCLASS="para">If the master server is responding asnot authoritative for the zone, you'll see a message like this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan  6 11:58:36 zardoz named[544]: Err/<SPANCLASS="acronym">TO</SPAN> getting serial# for &quot;movie.edu&quot;Jan  6 11:58:36 zardoz named-xfer[793]: [192.249.249.3] not authoritative for     movie.edu, <SPANCLASS="acronym">SOA</SPAN> query got rcode 0, aa 0, ancount 0, aucount 0</PRE></BLOCKQUOTE><PCLASS="para">If this is the correct master server, the server<EMCLASS="emphasis">should</EM> be authoritative for the zone.  This probably indicates that themaster had a problem loading the zone, usually because of a syntaxerror in the zone data file.  Contact the administrator of the masterserver and have him check his syslog output for indications of asyntax error (see problem 5, later in this chapter).</P><ACLASS="indexterm"NAME="AUTOID-13790"></A><ACLASS="indexterm"NAME="AUTOID-13791"></A></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-13792">13.3.4 4. Added Name to Database File, but Forgot to Add <SPANCLASS="acronym">PTR</SPAN>Record</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13796"></A><ACLASS="indexterm"NAME="AUTOID-13799"></A><ACLASS="indexterm"NAME="AUTOID-13802"></A><ACLASS="indexterm"NAME="AUTOID-13805"></A><ACLASS="indexterm"NAME="AUTOID-13808"></A>Becausethe mappings from host names to <SPANCLASS="acronym">IP</SPAN> addresses are disjointed fromthe mappings from <SPANCLASS="acronym">IP</SPAN> addresses to host names in <SPANCLASS="acronym">DNS</SPAN>, it's easy toforget to add a <SPANCLASS="acronym">PTR</SPAN> record for a new host. Adding the A record isintuitive, but many people who are used to host tables assume thatadding an address record takes care of the reverse mapping, too.That's not true&nbsp;- you need to add a <SPANCLASS="acronym">PTR</SPAN> record for the host to theappropriate <ICLASS="systemitem.sitename">in-addr.arpa</I> domain.</P><PCLASS="para">Forgettingto add the <SPANCLASS="acronym">PTR</SPAN> record for a host usually causes that host to failauthentication checks. For example, users on the host won't be ableto <KBDCLASS="command">rlogin</KBD> to other hosts without specifyinga password, and <KBDCLASS="command">rsh</KBD> or <KBDCLASS="command">rcp</KBD> toother hosts simply won't work. The servers these commands talk toneed to be able to map the connection's <SPANCLASS="acronym">IP</SPAN> address to a domain nameto check <ICLASS="filename">.rhosts</I> and <ICLASS="filename">hosts.equiv</I>.These users' connections will cause entries like this to be <KBDCLASS="command">syslog</KBD>ged:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Aug 15 17:32:36 terminator inetd[23194]: login/tcp:       Connection from unknown (192.249.249.23)</PRE></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13828"></A>Also, many large <KBDCLASS="command">ftp</KBD> archives,including <ICLASS="systemitem.sitename">ftp.uu.net</I>, refuse anonymous <KBDCLASS="command">ftp</KBD> accessto hosts whose <SPANCLASS="acronym">IP</SPAN> addresses don't map back to domain names. <ICLASS="systemitem.sitename">ftp.uu.net</I>'s <KBDCLASS="command">ftp</KBD> serveremits a message that reads, in part:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">530- Sorry, we're unable to map your <SPANCLASS="acronym">IP</SPAN> address 140.186.66.1 to a hostname530- in the <SPANCLASS="acronym">DNS</SPAN>.  This is probably because your nameserver does not have a530- <SPANCLASS="acronym">PTR</SPAN> record for your address in its tables, or because your reverse530- nameservers are not registered.  We refuse service to hosts whose530- names we cannot resolve.</PRE></BLOCKQUOTE><PCLASS="para">That makes the reason you can't use anonymous <KBDCLASS="command">ftp</KBD> prettyevident. Other <KBDCLASS="command">ftp</KBD> sites, however, don't botherprinting informative messages; they simply deny service.</P><PCLASS="para"><KBDCLASS="command">nslookup</KBD> ishandy for checking whether you've forgotten the <SPANCLASS="acronym">PTR</SPAN> record or not:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nslookup</B></CODE>Default Server:  terminator.movie.eduAddress:  192.249.249.3&gt; <CODECLASS="userinput"><B>beetlejuice</B></CODE>      <ICLASS="lineannotation">--Check for a hostname-to-address mapping</I>Server:  terminator.movie.eduAddress:  192.249.249.3Name:    beetlejuice.movie.eduAddress:  192.249.249.23&gt; <CODECLASS="userinput"><B>192.249.249.23</B></CODE>  <ICLASS="lineannotation">--Now check for a corresponding address-to-hostname mapping</I>Server:  terminator.movie.eduAddress:  192.249.249.3*** terminator.movie.edu can't find 192.249.249.23: Non-existent domain</PRE></BLOCKQUOTE><PCLASS="para">On the primary for <ICLASS="systemitem.sitename">249.249.192.in-addr.arpa</I>,a quick check of the <ICLASS="filename">db.192.249.249</I> file willtell you if the <SPANCLASS="acronym">PTR</SPAN> record hasn't been added to the db file yet,or if the name server hasn't been signaled to load the file. Ifthe name server having trouble is a slave for the zone, check thatthe serial number was incremented on the primary and that the slavehas had enough time to load the zone.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-13856">13.3.5 5. Syntax Error in the Conf File or <SPANCLASS="acronym">DNS</SPAN> Database File</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="CH13.SYNTAX1"></A><ACLASS="indexterm"NAME="CH13.SYNTAX2"></A><ACLASS="indexterm"NAME="CH13.SYNTAX3"></A><ACLASS="indexterm"NAME="CH13.SYNTAX4"></A>Syntax errors in the conf file andin zone database files are also relatively common (more or less,depending on the experience of the administrator). Generally, anerror in the conf file will cause the name server to fail to loadone or more zones. Some typos in the <ICLASS="structfield">options</I> statementwill cause the name server to fail to start at all, and to log anerror like this via <KBDCLASS="command">syslog</KBD>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan  6 11:59:29 terminator named[544]: can't change directory to /var/name: No     such file or directory</PRE></BLOCKQUOTE><PCLASS="para">Note that you won't see an error message when youtry to start <KBDCLASS="command">named</KBD> on the command line, but <KBDCLASS="command">named</KBD> won'tstay running for long.</P><PCLASS="para">If the syntax error is in a lessimportant line in the boot file&nbsp;- say, in <ICLASS="structfield">zone</I> statement&nbsp;- onlythat zone will be affected. Usually, the name server will not beable to load the zone at all (say, you misspell <SPANCLASS="quote">"master"</SPAN> or thename of the data file, or you forget to put quotes around the file nameor domain name). This would produce <KBDCLASS="command">syslog</KBD> outputlike:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan  6 12:01:36 terminator named[841]: /etc/named.conf:10: syntax error near     'movie.edu'</PRE></BLOCKQUOTE><PCLASS="para">If a db file contains a syntax error, yet the nameserver succeeds in loading the zone, it will either answer as <SPANCLASS="quote">"non-authoritative"</SPAN>for <EMCLASS="emphasis">all</EM> data in the zone or will return a <SPANCLASS="acronym">SERVFAIL</SPAN>error for lookups in the zone:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nslookup carrie</B></CODE>Server:  terminator.movie.eduAddress:  192.249.249.3Non-authoritative answer:Name:    carrie.movie.eduAddress:  192.253.253.4</PRE></BLOCKQUOTE><PCLASS="para">Here's the <KBDCLASS="command">syslog</KBD> message producedby the syntax error that caused this problem:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan  6 15:07:46 huskymo named[693]: db.movie:11: Priority error     (postmanrings2x.movie.edu.)Jan  6 15:07:46 huskymo named[693]: master zone &quot;movie.edu&quot; (<SPANCLASS="acronym">IN</SPAN>) rejected due     to errors (serial 1997010600)Jan  6 15:07:46 huskymo named[693]: slave zone &quot;movie.edu&quot; (<SPANCLASS="acronym">IN</SPAN>) removed</PRE></BLOCKQUOTE><PCLASS="para">If you looked in the db file for the problem, you'dfind this record:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">postmanrings2x     IN     MX     postmanrings2x.movie.edu.</PRE></BLOCKQUOTE><PCLASS="para">The <SPANCLASS="acronym">MX</SPAN> record is missing the preference field, whichcauses the error.</P><PCLASS="para">Note that unless you correlate thelack of authority (when you expect the name server to be authoritative)with a problem, or scan your <KBDCLASS="command">syslog</KBD> file assiduously,you might never notice the syntax error!</P><PCLASS="para">Starting with <SPANCLASS="acronym">BIND</SPAN>4.9.4, an <SPANCLASS="quote">"invalid"</SPAN> host name can be a syntax error:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Jan  6 12:04:10 terminator named[841]: owner name &quot;<SPANCLASS="acronym">ID</SPAN>_4.movie.edu&quot; <SPANCLASS="acronym">IN</SPAN> (primary)     is invalid - rejectingJan  6 12:04:10 terminator named[841]: db.movie:11: owner name errorJan  6 12:04:10 terminator named[841]: db.movie:11: Database error (a)Jan  6 12:04:10 terminator named[841]: master zone &quot;movie.edu&quot; (<SPANCLASS="acronym">IN</SPAN>) rejected     due to errors (serial 1997010600)</PRE></BLOCKQUOTE><ACLASS="indexterm"NAME="AUTOID-13906"></A><ACLASS="indexterm"NAME="AUTOID-13907"></A><ACLASS="indexterm"NAME="AUTOID-13908"></A><ACLASS="indexterm"NAME="AUTOID-13909"></A></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-13910">13.3.6 6. Missing Dot at the End of a Name in a <SPANCLASS="acronym">DNS</SPAN> DatabaseFile</A></H3><PCLASS="para">It's <EMCLASS="emphasis">very</EM> easy to leave off<ACLASS="indexterm"NAME="AUTOID-13915"></A><ACLASS="indexterm"NAME="AUTOID-13918"></A><ACLASS="indexterm"NAME="AUTOID-13920"></A><ACLASS="indexterm"NAME="AUTOID-13923"></A>trailingdots when editing a db file. Since the rules for when to use themchange so often (<EMCLASS="emphasis">don't</EM> use them in the bootfile, <EMCLASS="emphasis">don't</EM> use them in <ICLASS="filename">resolv.conf</I>,<EMCLASS="emphasis">do</EM> use them in db files to override $<SPANCLASS="acronym">ORIGIN</SPAN>...),it's hard to keep them straight. These resource records:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">zorba         IN     MX     10 zelig.movie.edumovie.edu     IN     NS     terminator.movie.edu</PRE></BLOCKQUOTE><PCLASS="para">really don't look that odd to the untrained eye,but they probably don't do what they're intended to. In the <ICLASS="filename">db.movie</I> file,they'd be equivalent to:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">zorba.movie.edu.        IN    MX    10 zelig.movie.edu.movie.edu.movie.edu.movie.edu.    IN    NS    terminator.movie.edu.movie.edu.</PRE></BLOCKQUOTE><PCLASS="para">unless the origin were explicitly changed.</P><PCLASS="para">Ifyou omit a trailing dot after a domain name in the resource record'sdata (as opposed to leaving off a trailing dot in the resource record's <ICLASS="filename">name</I>), youusually end up with wacky <SPANCLASS="acronym">NS</SPAN> or <SPANCLASS="acronym">MX</SPAN> records:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nslookup -type=mx zorba.movie.edu.</B></CODE>Server:  terminator.movie.eduAddress:  192.249.249.3zorba.movie.edu      preference = 10, mail exchanger                     = zelig.movie.edu.movie.eduzorba.movie.edu      preference = 50, mail exchanger                     = postmanrings2x.movie.edu.movie.edu</PRE></BLOCKQUOTE><PCLASS="para">The cause of this should be fairly clear from the <KBDCLASS="command">nslookup</KBD> output.But if you forget the trailing dot on the domain name field in arecord (as in the <ICLASS="systemitem.sitename">movie.edu</I> <SPANCLASS="acronym">NS</SPAN> record above),spotting your mistake might not be as easy. If you try to look upthe record with <KBDCLASS="command">nslookup</KBD>, you won't find itunder the name you thought you used. Dumping your name server'sdatabase may help you root it out:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$<SPANCLASS="acronym">ORIGIN</SPAN> edu.movie.edu.movie    <SPANCLASS="acronym">IN</SPAN>    <SPANCLASS="acronym">NS</SPAN>    terminator.movie.edu.movie.edu.</PRE></BLOCKQUOTE><PCLASS="para">The <CODECLASS="literal">$ORIGIN</CODE> line looks odd enough to stand out.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-13953">13.3.7 7. Missing Cache Data</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13956"></A><ACLASS="indexterm"NAME="AUTOID-13959"></A>If, for some reason, you forget to installa cache file on your host, or if you accidentally delete it, yourname server will be unable to resolve names outside of its authoritativedata. This behavior is easy to recognize using <KBDCLASS="command">nslookup</KBD>,but be careful to use full, dot-terminated domain names, or elsethe search list may cause misleading failures.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nslookup</B></CODE>Default Server:  terminator.movie.eduAddress:  192.249.249.3&gt; <CODECLASS="userinput"><B>ftp.uu.net.</B></CODE>    <ICLASS="lineannotation">&nbsp;- A lookup of a name outside your name server's authoritative data</I>                                        <ICLASS="lineannotation">&nbsp;- causes a SERVFAIL error...</I>Server:  terminator.movie.eduAddress:  192.249.249.3*** terminator.movie.edu can't find ftp.uu.net.: Server failed&#13;</PRE></BLOCKQUOTE><PCLASS="para">A lookup of a name in your name server's authoritativedata returns a response:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>wormhole.movie.edu.</B></CODE>Server:  terminator.movie.eduAddress:  192.249.249.3Name:    wormhole.movie.eduAddresses:  192.249.249.1, 192.253.253.1&gt; <CODECLASS="userinput"><B>^D</B></CODE></PRE></BLOCKQUOTE><PCLASS="para">To confirm your suspicion that the cache data aremissing, check the <EMCLASS="emphasis">syslog</EM> output for an errorlike this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"> Jan  6 15:10:22 terminator named[764]: No root nameservers for class <SPANCLASS="acronym">IN</SPAN></PRE></BLOCKQUOTE><PCLASS="para">Class 1, you'll remember, is the <SPANCLASS="acronym">IN</SPAN>, or Internet,class. This error indicates that because no cache data were available,no root name servers were found.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-13978">13.3.8 8. Loss of Network Connectivity</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="CH13.CONNECT1"></A><ACLASS="indexterm"NAME="CH13.CONNECT2"></A><ACLASS="indexterm"NAME="AUTOID-13987"></A>Thoughthe Internet is more reliable today than it was back in the wildand woolly days of the <SPANCLASS="acronym">ARPANET</SPAN>, network outages are still relativelycommon. Without <SPANCLASS="quote">"lifting the hood"</SPAN> and poking around in debuggingoutput, these failures usually look like poor performance:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nslookup nisc.sri.com.</B></CODE>Server:  terminator.movie.eduAddress:  192.249.249.3*** Request to terminator.movie.edu timed out ***</PRE></BLOCKQUOTE><PCLASS="para">If you turn on name server debugging, though, you'llsee that your name server, anyway, is healthy. It receivedthe query from the resolver, sent the necessary queries, and waitedpatiently for a response. It just didn't getone. Here's what the debugging output might look like:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Debug turned <SPANCLASS="acronym">ON</SPAN>, Level 1</PRE></BLOCKQUOTE><PCLASS="para">Here <KBDCLASS="command">nslookup</KBD> sends the first query to ourlocal name server, for the <SPANCLASS="acronym">IP</SPAN> address of<ICLASS="systemitem.sitename">nisc.sri.com</I>. You can tellit's not another name server because the query is received from a portother than 53, the name server's port. Notice that the query isforwarded to another name server, and when no answer is received, itis resent to a different name server:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">datagram from [192.249.249.3].1051, fd 5, len 30req: nlookup(nisc.sri.com) id 18470 type=1 class=1req: missed 'nisc.sri.com' as 'com' (cname=0)forw: forw -&gt; [198.41.0.4].53 ds=7 nsid=58732 id=18470 0ms retry 4 secresend(addr=1 n=0) -&gt; [128.9.0.107].53 ds=7 nsid=58732 id=18470 0ms</PRE></BLOCKQUOTE><PCLASS="para">Now <KBDCLASS="command">nslookup</KBD> is getting impatient, and it queriesour local name server again. Notice that it uses the same port. Thelocal name server ignores the duplicate query and tries forwarding thequery two more times:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">datagram from [192.249.249.3].1051, fd 5, len 30req: nlookup(nisc.sri.com) id 18470 type=1 class=1req: missed 'nisc.sri.com' as 'com' (cname=0)resend(addr=2 n=0) -&gt; [192.33.4.12].53 ds=7 nsid=58732 id=18470 0msresend(addr=3 n=0) -&gt; [128.8.10.90].53 ds=7 nsid=58732 id=18470 0ms</PRE></BLOCKQUOTE><PCLASS="para"><KBDCLASS="command">nslookup</KBD> queries the local name server again, and the name server fires off more queries:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">datagram from [192.249.249.3].1051, fd 5, len 30req: nlookup(nisc.sri.com) id 18470 type=1 class=1req: missed 'nisc.sri.com' as 'com' (cname=0)resend(addr=4 n=0) -&gt; [192.203.230.10].53 ds=7 nsid=58732 id=18470 0msresend(addr=0 n=1) -&gt; [198.41.0.4].53 ds=7 nsid=58732 id=18470 0msresend(addr=1 n=1) -&gt; [128.9.0.107].53 ds=7 nsid=58732 id=18470 0msresend(addr=2 n=1) -&gt; [192.33.4.12].53 ds=7 nsid=58732 id=18470 0msresend(addr=3 n=1) -&gt; [128.8.10.90].53 ds=7 nsid=58732 id=18470 0msresend(addr=4 n=1) -&gt; [192.203.230.10].53 ds=7 nsid=58732 id=18470 0msresend(addr=0 n=2) -&gt; [198.41.0.4].53 ds=7 nsid=58732 id=18470 0msDebug turned OFF</PRE></BLOCKQUOTE><PCLASS="para">From the debugging output, you can extract a listof the <SPANCLASS="acronym">IP</SPAN> addresses of the name servers that your name server triedto query, and then check your connectivity to them. Odds are, <EMCLASS="emphasis">ping</EM> won'thave much better luck than your name server did:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>ping 198.41.0.4 -n 10</B></CODE> <ICLASS="lineannotation">--ping first name server queried</I><SPANCLASS="acronym">PING</SPAN> 198.41.0.4: 64 byte packets----198.41.0.4 <SPANCLASS="acronym">PING</SPAN> Statistics----10 packets transmitted, 0 packets received, 100% packet loss% <CODECLASS="userinput"><B>ping 128.9.0.107 -n 10</B></CODE> <ICLASS="lineannotation">--ping second name server queried</I><SPANCLASS="acronym">PING</SPAN> 128.9.0.107: 64 byte packets----128.9.0.107 <SPANCLASS="acronym">PING</SPAN> Statistics----10 packets transmitted, 0 packets received, 100% packet loss</PRE></BLOCKQUOTE><PCLASS="para">If it does, you should check that the remote name servers arereally running. You might also check whether your Internet firewall isinadvertently blocking your name server's queries. If you've upgradedto <SPANCLASS="acronym">BIND</SPAN> 8 recently, see <ACLASS="xref"HREF="ch15_04.htm#GOTCHA-FIREWALLS"TITLE="A Gotcha with BIND 8 and Packet Filtering Firewalls">the sidebar "A Gotcha with <SPANCLASS="acronym">BIND</SPAN> 8 and Packet FilteringFirewalls"</A>, and see if it applies to you.</P><PCLASS="para">If <EMCLASS="emphasis">ping</EM> can't getthrough, either, all that's left to do is to locate the break inthe network. Utilities like <EMCLASS="emphasis">traceroute</EM> and <EMCLASS="emphasis">ping</EM>'srecord route option can be very helpful in determining whether theproblem is on your network, the destination network, or somewherein the middle.</P><PCLASS="para">You should also use your own common sensewhen tracking down the break. In this trace, for example, the remotename servers your name server tried to query are all root name servers.(You might have had their <SPANCLASS="acronym">PTR</SPAN> records cached somewhere, so you couldfind out their domain names.) Now it's not very likely that eachroot's local network went down, nor is it likely that the Internet'scommercial backbone networks collapsed entirely. Occam's razor saysthat the simplest condition that could cause this behavior&nbsp;- namely,the loss of <EMCLASS="emphasis">your</EM> network's link to the Internet&nbsp;- isthe most likely cause.</P><ACLASS="indexterm"NAME="AUTOID-14030"></A><ACLASS="indexterm"NAME="AUTOID-14031"></A></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-14032">13.3.9 9. Missing Subdomain Delegation</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14035"></A><ACLASS="indexterm"NAME="AUTOID-14038"></A><ACLASS="indexterm"NAME="CH13.SUBDOMAIN1"></A><ACLASS="indexterm"NAME="CH13.SUBDOMAIN2"></A><ACLASS="indexterm"NAME="CH13.SUBDOMAIN3"></A><ACLASS="indexterm"NAME="CH13.SUBDOMAIN4"></A>Eventhough the Inter<SPANCLASS="acronym">NIC</SPAN> does its best to process your requests as quicklyas possible, it may take a day or two for your domain's delegationto appear in the root name servers. If the Inter<SPANCLASS="acronym">NIC</SPAN> doesn't manageyour parent domain, your mileage may vary. Some parents are quickand responsible, others are slow and inconsistent. Just like inreal life, though, you're stuck with them.[2]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] Until the <SPANCLASS="acronym">GTLD</SPAN> Memorandum of Understanding is adopted,that is.  See <ACLASS="systemitem.url"HREF="http://www.gtld-mou.org/">http://www.gtld-mou.org/</A>.</P></BLOCKQUOTE><PCLASS="para">Untilyour delegation data appear in your parent domain's name servers,your name servers will be able to look up data in the Internet domainname space, but no one else on the Internet (outside of your domain)will know how to look up data in <EMCLASS="emphasis">your</EM> name space.</P><PCLASS="para">That means that even though you can send mail outside of yourdomain, the recipients won't be able to reply to it. Furthermore,no one will be able to <EMCLASS="emphasis">telnet</EM> to, <EMCLASS="emphasis">ftp</EM> to,or even <EMCLASS="emphasis">ping</EM> your hosts by name.</P><PCLASS="para">Rememberthat this applies equally to any <EMCLASS="emphasis">in-addr.arpa</EM> subdomainsyou may run.  Until the parent delegates those subdomains to yourservers, name servers on the Internet won't be able to reverse mapaddresses on your networks.</P><PCLASS="para">To determine whether or not your zone's delegation has made it into yourparent zone's name servers, query a parent name server for the <SPANCLASS="acronym">NS</SPAN>records for your zone. If the parent name server has the data, anyname server on the Internet can find it:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nslookup</B></CODE>Default Server:  terminator.movie.eduAddress:  192.249.249.3&gt; <CODECLASS="userinput"><B>server a.root-servers.net.</B></CODE> <ICLASS="lineannotation">--Query a root name server</I>Default Server:  a.root-servers.netAddress:  198.41.0.4&gt; <CODECLASS="userinput"><B>set norecurse</B></CODE>             <ICLASS="lineannotation">&nbsp;- Instruct the server to answer out of its own data</I>&gt; <CODECLASS="userinput"><B>set type=ns</B></CODE>               <ICLASS="lineannotation">&nbsp;- and to look for NS records</I>&gt; <CODECLASS="userinput"><B>249.249.192.in-addr.arpa.</B></CODE> <ICLASS="lineannotation">&nbsp;- for 249.249.192.in-addr.arpa</I>Server:  a.root-servers.netAddress:  198.41.0.4*** a.root-servers.net can't find 249.249.192.in-addr.arpa.: Non-existent domain</PRE></BLOCKQUOTE><PCLASS="para">Here, the delegation clearly hasn't been added yet.You can either wait patiently, or if an unreasonable amount of timehas passed since you requested delegation from your parent, contactyour parent and ask what's up.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-14079">13.3.10 10. Incorrect Subdomain Delegation</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14082"></A><ACLASS="indexterm"NAME="AUTOID-14085"></A>Incorrect subdomain delegationis another familiar problem on the Internet. Keeping delegationup to date requires human intervention&nbsp;- informing your parent zone'sadministrator of changes to your set of authoritative name servers.Consequently, delegation information often becomes inaccurate as administratorsmake changes without letting their parents know. Far too many administratorsbelieve that setting up delegation is a one-shot deal: they lettheir parents know which name servers are authoritative once, whenthey set up their zone, and then they never talk to them again.They don't even call on Mother's Day.</P><PCLASS="para">An administratormay add a new name server, decommission another, and change the<SPANCLASS="acronym">IP</SPAN> address of a third, all without telling the parent zone's administrator.Gradually, the number of name servers correctly delegated to bythe parent zone dwindles. In the best case, this leads to long resolutiontimes, as querying name servers struggle to find an authoritativename server for the zone. If the delegation information becomesbadly out of date, and the last authoritative name server host isbrought down for maintenance, the information within the zone willbe inaccessible.</P><PCLASS="para">If you suspect bad delegation from yourparent to your zone, from your zone to one of your children, orfrom a remote zone to one of its children, you can check with <EMCLASS="emphasis">nslookup</EM>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nslookup</B></CODE>Default Server:  terminator.movie.eduAddress:  192.249.249.3&gt; <CODECLASS="userinput"><B>server a.root-servers.net.</B></CODE>     <ICLASS="lineannotation">&nbsp;- Set server to the parent name server you suspect</I>                                                        <ICLASS="lineannotation">has bad delegation</I>Default Server:  a.root-servers.netAddress:  198.41.0.4&gt; <CODECLASS="userinput"><B>set type=ns</B></CODE>                    <ICLASS="lineannotation">&nbsp;- Look for NS records</I>&gt; <CODECLASS="userinput"><B>hp.com.</B></CODE>                        <ICLASS="lineannotation">&nbsp;- for the zone in question</I>Server:  a.root-servers.netAddress:  198.41.0.4Non-authoritative answer:hp.com          nameserver = <SPANCLASS="acronym">RELAY</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>hp.com          nameserver = <SPANCLASS="acronym">HPLABS</SPAN>.<SPANCLASS="acronym">HPL</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>hp.com          nameserver = <SPANCLASS="acronym">NNSC</SPAN>.<SPANCLASS="acronym">NSF</SPAN>.<SPANCLASS="acronym">NET</SPAN>hp.com          nameserver = <SPANCLASS="acronym">HPSDLO</SPAN>.<SPANCLASS="acronym">SDD</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>Authoritative answers can be found from:hp.com          nameserver = <SPANCLASS="acronym">RELAY</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>hp.com          nameserver = <SPANCLASS="acronym">HPLABS</SPAN>.<SPANCLASS="acronym">HPL</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>hp.com          nameserver = <SPANCLASS="acronym">NNSC</SPAN>.<SPANCLASS="acronym">NSF</SPAN>.<SPANCLASS="acronym">NET</SPAN>hp.com          nameserver = <SPANCLASS="acronym">HPSDLO</SPAN>.<SPANCLASS="acronym">SDD</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN><SPANCLASS="acronym">RELAY</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>    internet address = 15.255.152.2<SPANCLASS="acronym">HPLABS</SPAN>.<SPANCLASS="acronym">HPL</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>       internet address = 15.255.176.47<SPANCLASS="acronym">NNSC</SPAN>.<SPANCLASS="acronym">NSF</SPAN>.<SPANCLASS="acronym">NET</SPAN>    internet address = 128.89.1.178<SPANCLASS="acronym">HPSDLO</SPAN>.<SPANCLASS="acronym">SDD</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>       internet address = 15.255.160.64<SPANCLASS="acronym">HPSDLO</SPAN>.<SPANCLASS="acronym">SDD</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>       internet address = 15.26.112.11</PRE></BLOCKQUOTE><PCLASS="para">Let's say you suspect that the delegation to <ICLASS="systemitem.sitename">hpsdlo.sdd.hp.com</I> is incorrect. You nowquery <ICLASS="systemitem.sitename">hpsdlo</I> for data in the<ICLASS="systemitem.sitename">hp.com</I> zone and check theanswer:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>server hpsdlo.sdd.hp.com.</B></CODE>Default Server:  hpsdlo.sdd.hp.comAddresses:  15.255.160.64, 15.26.112.11&gt; <CODECLASS="userinput"><B>set norecurse</B></CODE>&gt; <CODECLASS="userinput"><B>set type=soa</B></CODE>&gt; <CODECLASS="userinput"><B>hp.com.</B></CODE>Server:  hpsdlo.sdd.hp.comAddresses:  15.255.160.64, 15.26.112.11Non-authoritative answer:hp.com        origin = relay.hp.com        mail addr = hostmaster.hp.com        serial = 1001462        refresh = 21600 (6 hours)        retry   = 3600 (1 hour)        expire  = 604800 (7 days)        minimum ttl = 86400 (1 day)Authoritative answers can be found from:hp.com          nameserver = <SPANCLASS="acronym">RELAY</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>hp.com          nameserver = <SPANCLASS="acronym">HPLABS</SPAN>.<SPANCLASS="acronym">HPL</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>hp.com          nameserver = <SPANCLASS="acronym">NNSC</SPAN>.<SPANCLASS="acronym">NSF</SPAN>.<SPANCLASS="acronym">NET</SPAN><SPANCLASS="acronym">RELAY</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>    internet address = 15.255.152.2<SPANCLASS="acronym">HPLABS</SPAN>.<SPANCLASS="acronym">HPL</SPAN>.<SPANCLASS="acronym">HP</SPAN>.<SPANCLASS="acronym">COM</SPAN>       internet address = 15.255.176.47<SPANCLASS="acronym">NNSC</SPAN>.<SPANCLASS="acronym">NSF</SPAN>.<SPANCLASS="acronym">NET</SPAN>    internet address = 128.89.1.178</PRE></BLOCKQUOTE><PCLASS="para">If <EMCLASS="emphasis">hpsdlo</EM> really were authoritative, itwould have responded with an authoritative answer. The administratorof the <EMCLASS="emphasis">hp.com</EM> zone can tell you whether <EMCLASS="emphasis">hpsdlo</EM> shouldbe an authoritative name server for <EMCLASS="emphasis">hp.com</EM>,so that's who you should contact.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14182"></A>Another commonsymptom of this is a <SPANCLASS="quote">"lame server"</SPAN> error message:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Oct 1 04:43:38 terminator named[146]: Lame server on '40.234.23.210.in-addr.arpa' (in '210.in-addr.arpa'?): [198.41.0.5].53 '<SPANCLASS="acronym">RS</SPAN>0.<SPANCLASS="acronym">INTERNIC</SPAN>.<SPANCLASS="acronym">NET</SPAN>': learnt(A=198.41.0.21,<SPANCLASS="acronym">NS</SPAN>=128.63.2.53)</PRE></BLOCKQUOTE><PCLASS="para">Here's how to read that: your name server was referredby the name server at 128.63.2.53 to the name server at 198.41.0.5for a name in the domain <ICLASS="systemitem.sitename">210.in-addr.arpa</I>specifically <ICLASS="systemitem.sitename">40.234.23.210.in-addr.arpa</I>.  The server at 198.41.0.5'sresponse indicated that it wasn't, in fact, authoritative for <ICLASS="systemitem.sitename">210.in-addr.arpa</I>,and therefore either the delegation that 128.63.2.53 gave you iswrong or the server at 198.41.0.5 is misconfigured.</P><ACLASS="indexterm"NAME="AUTOID-14194"></A><ACLASS="indexterm"NAME="AUTOID-14195"></A><ACLASS="indexterm"NAME="AUTOID-14196"></A><ACLASS="indexterm"NAME="AUTOID-14197"></A></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-14198">13.3.11 11. Syntax Error in resolv.conf</A></H3><PCLASS="para">Despitethe<ACLASS="indexterm"NAME="AUTOID-14201"></A><ACLASS="indexterm"NAME="AUTOID-14204"></A><ACLASS="indexterm"NAME="AUTOID-14207"></A><EMCLASS="emphasis">resolv.conf</EM> file'ssimple syntax, people do occasionally make mistakes when editingit. And, unfortunately, lines with syntax errors in <EMCLASS="emphasis">resolv.conf</EM> aresilently ignored by the resolver. The result is usually that some partof your intended configuration doesn't take effect: either yourdomain or search list isn't set correctly, or the resolver won'tquery one of the name servers you configured it to query. Commandsthat rely on the search list won't work, your resolver won'tquery the right name server(s), or it won't query a name serverat all.</P><PCLASS="para">The easiest way to check whether your <ICLASS="filename">resolv.conf</I>file is having the intended effect is to run <KBDCLASS="command">nslookup</KBD>. <KBDCLASS="command">nslookup</KBD>will kindly report the default domain and search list it derives from<ICLASS="filename">resolv.conf</I>, plus the name server it's querying, when you type <CODECLASS="literal">setall</CODE>, as we showed you in <ACLASS="xref"HREF="ch11_01.htm"TITLE="nslookup">Chapter 11, <CITECLASS="chapter">nslookup</CITE></A>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nslookup</B></CODE>Default Server:  terminator.movie.eduAddress:  192.249.249.3&gt; <CODECLASS="userinput"><B>set all</B></CODE>Default Server:  terminator.movie.eduAddress:  192.249.249.3Set options:  nodebug         defname          search         recurse  nod2            novc             noignoretc     port=53  querytype=A     class=<SPANCLASS="acronym">IN</SPAN>         timeout=5      retry=4  root=ns.nic.ddn.mil.  domain=movie.edu  srchlist=movie.edu&gt;</PRE></BLOCKQUOTE><PCLASS="para">Check that the output of<ACLASS="indexterm"NAME="AUTOID-14224"></A><EMCLASS="emphasis">set all</EM> iswhat you expect, given your <EMCLASS="emphasis">resolv.conf</EM> file.For example, if you'd set search <ICLASS="systemitem.sitename">fx.movie.edu</I> <ICLASS="systemitem.sitename">movie.edu</I> in <EMCLASS="emphasis">resolv.conf</EM>,you'd expect to see:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">domain=fx.movie.edusrchlist=fx.movie.edu/movie.edu</PRE></BLOCKQUOTE><PCLASS="para">in the output. If you don't see what you're expecting,look carefully at <EMCLASS="emphasis">resolv.conf</EM>. If you don'tsee anything obvious, look for nonprinting characters (with <EMCLASS="emphasis">vi</EM>'s <EMCLASS="emphasis">setlist</EM> command, for example). Watch out for trailing spaces, especially;a trailing space after the domain name will set the default domainto include a space. No real domain names actually end with spaces,so all of your non-dot-terminated lookups will fail.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-14236">13.3.12 12. Default Domain Not Set</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14239"></A><ACLASS="indexterm"NAME="AUTOID-14242"></A>Failingto set your default domain is another old standby gaffe. You canset it implicitly, by setting your <EMCLASS="emphasis">hostname</EM> toyour host's fully qualified domain name, or explicitly, in <EMCLASS="emphasis">resolv.conf</EM>.The characteristics of an unset default domain are straightforward:folks who use single-label names (or abbreviated domain names) incommands get no joy:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>telnet br</B></CODE>br: No address associated with name% <CODECLASS="userinput"><B>telnet br.fx</B></CODE>br.fx: No address associated with name% <CODECLASS="userinput"><B>telnet br.fx.movie.edu</B></CODE>Trying...Connected to bladerunner.fx.movie.edu.Escape character is '^]'.<SPANCLASS="acronym">HP-UX</SPAN> bladerunner.fx.movie.edu A.08.07 A 9000/730 (ttys1)login:</PRE></BLOCKQUOTE><PCLASS="para">You can use <EMCLASS="emphasis">nslookup</EM> to checkthis one, much as you do when you suspect a syntax error in <EMCLASS="emphasis">resolv.conf</EM>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nslookup</B></CODE>Default Server:  terminator.movie.eduAddress:  192.249.249.3&gt; <CODECLASS="userinput"><B>set all</B></CODE>Default Server:  terminator.movie.eduAddress:  192.249.249.3Set options:  nodebug         defname         search          recurse  nod2            novc            noignoretc      port=53  querytype=A     class=<SPANCLASS="acronym">IN</SPAN>        timeout=5       retry=4  root=ns.nic.ddn.mil.  domain=  srchlist=</PRE></BLOCKQUOTE><PCLASS="para">Notice that neither the local domain nor the search listis set. You can also track this down by enabling debugging on thename server. (This, of course, requires access to the name server,which may not be running on the host the problem's affecting.) Here'show the debugging output might look after trying those <EMCLASS="emphasis">telnet</EM> commands:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Debug turned <SPANCLASS="acronym">ON</SPAN>, Level 1datagram from [192.249.249.3].1057, fd 5, len 20req: nlookup(br) id 27974 type=1 class=1req: missed 'br' as '' (cname=0)forw: forw -&gt; [198.41.0.4].53 ds=7 nsid=61691 id=27974 0ms retry 4 secdatagram from [198.41.0.4].53, fd 5, len 20ncache: dname br, type 1, class 1send_msg -&gt; [192.249.249.3].1057 (<SPANCLASS="acronym">UDP</SPAN> 5) id=27974datagram from [192.249.249.3].1059, fd 5, len 23req: nlookup(br.fx) id 27975 type=1 class=1req: missed 'br.fx' as '' (cname=0)forw: forw -&gt; [128.9.0.107].53 ds=7 nsid=61692 id=27975 0ms retry 4 secdatagram from [128.9.0.107].53, fd 5, len 23ncache: dname br.fx, type 1, class 1send_msg -&gt; [192.249.249.3].1059 (<SPANCLASS="acronym">UDP</SPAN> 5) id=27975datagram from [192.249.249.3].1060, fd 5, len 33req: nlookup(br.fx.movie.edu) id 27976 type=1 class=1req: found 'br.fx.movie.edu' as 'br.fx.movie.edu' (cname=0)req: nlookup(bladerunner.fx.movie.edu) id 27976 type=1 class=1req: found 'bladerunner.fx.movie.edu' as 'bladerunner.fx.movie.edu'     (cname=1)ns_req: answer -&gt; [192.249.249.3].1060 fd=5 id=27976 size=183 LocalDebug turned OFF</PRE></BLOCKQUOTE><PCLASS="para">Contrast this with the debugging output produced by theapplication of the search list in <ACLASS="xref"HREF="ch12_01.htm"TITLE="Reading BIND Debugging Output">Chapter 12</A>. Theonly names looked up here are exactly what the user typed, with nodomains appended at all. Clearly the search list isn't beingapplied.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-14267">13.3.13 13. Response from Unexpected Source</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14270"></A>Oneproblem we've seen increasingly often in the <SPANCLASS="acronym">DNS</SPAN> newsgroups is the<SPANCLASS="quote">"response from unexpected source."</SPAN>  This was once called a Martianresponse:  it's a response that comes from an <SPANCLASS="acronym">IP</SPAN> address other thanthe one your server sent a query to.  When a <SPANCLASS="acronym">BIND</SPAN> name server sendsa query to a remote server, <SPANCLASS="acronym">BIND</SPAN> conscientiously makes sure thatanswers come only from the <SPANCLASS="acronym">IP</SPAN> addresses on that server.  This helpsminimize the possibility of accepting spoofed responses.  <SPANCLASS="acronym">BIND</SPAN>is equally demanding of itself:  a <SPANCLASS="acronym">BIND</SPAN> server makes every effortto reply via the same network interface that it received a queryon.</P><PCLASS="para">Here's the error message you'd see upon receivinga possibly unsolicited response:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mar  8 17:21:04 terminator named[235]: Response from unexpected source ([205.199.4.131].53)</PRE></BLOCKQUOTE><PCLASS="para">This can mean one of two things: either someoneis trying to spoof your name server, or&nbsp;- more likely&nbsp;- you sent a queryto an older <SPANCLASS="acronym">BIND</SPAN> server or a different make of name server that'snot as assiduous about replying from the same interface it receivesqueries on.</P></DIV><ACLASS="indexterm"NAME="AUTOID-14285"></A></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch13_02.htm"TITLE="13.2 Troubleshooting Tools and Techniques"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 13.2 Troubleshooting Tools and Techniques"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="DNS &amp; BIND"><IMGSRC="../gifs/txthome.gif"ALT="DNS &amp; BIND"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch13_04.htm"TITLE="13.4 Transition Problems"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 13.4 Transition Problems"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">13.2 Troubleshooting Tools and Techniques</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">13.4 Transition Problems</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>