<HTML><HEAD><TITLE>[Chapter 13] 13.5 Interoperability and Version Problems</TITLE><METANAME="DC.title"CONTENT="DNS &amp; BIND"><METANAME="DC.creator"CONTENT="Cricket Liu &amp; Paul Albitz"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:40:17Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-512-2"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch13_01.htm"TITLE="13. Troubleshooting DNS and BIND"><LINKREL="prev"HREF="ch13_04.htm"TITLE="13.4 Transition Problems"><LINKREL="next"HREF="ch13_06.htm"TITLE="13.6 Problem Symptoms"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="DNS &amp; BIND"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="DNS &amp; BIND"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/dsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch13_04.htm"TITLE="13.4 Transition Problems"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 13.4 Transition Problems"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 13<BR>Troubleshooting <SPANCLASS="acronym">DNS</SPAN> and<SPANCLASS="acronym">BIND</SPAN></FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch13_06.htm"TITLE="13.6 Problem Symptoms"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 13.6 Problem Symptoms"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-14352">13.5 Interoperability and Version Problems</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH13.OPERABILITY4"></A><ACLASS="indexterm"NAME="CH13.OPERABILITY3"></A><ACLASS="indexterm"NAME="CH13.OPERABILITY"></A><ACLASS="indexterm"NAME="CH13.OPERABILITY2"></A>With the move to <SPANCLASS="acronym">BIND</SPAN> 8 and the introduction of MicrosoftWindows <SPANCLASS="acronym">DNS</SPAN> Server, more interoperability problems are cropping upbetween name servers.  There are also a handful of problems thatare unique to one version or another of <SPANCLASS="acronym">BIND</SPAN> or the underlying operatingsystem.  Many of these are easy to spot and correct, and we wouldbe remiss if we didn't cover them.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-14370">13.5.1 Zone Transfer Fails Because of Proprietary <SPANCLASS="acronym">WINS</SPAN> Record</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14374"></A><ACLASS="indexterm"NAME="AUTOID-14377"></A><ACLASS="indexterm"NAME="AUTOID-14379"></A>When a Microsoft Windows <SPANCLASS="acronym">DNS</SPAN> Server is configured to consulta <SPANCLASS="acronym">WINS</SPAN> server for names it can't find in a given zone, it insertsa special record into the zone data file.  The record looks likethis:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">@               <SPANCLASS="acronym">IN</SPAN>      <SPANCLASS="acronym">WINS</SPAN>            &amp;<CODECLASS="replaceable"><I><SPANCLASS="acronym">IP</SPAN> address of <SPANCLASS="acronym">WINS</SPAN> server</I></CODE></PRE></BLOCKQUOTE><PCLASS="para">Unfortunately, <SPANCLASS="acronym">WINS</SPAN> is not a standard record typein the <SPANCLASS="acronym">IN</SPAN> class.  Consequently, if there are <SPANCLASS="acronym">BIND</SPAN> slaves that transferthis zone, they'll choke on the <SPANCLASS="acronym">WINS</SPAN> record and refuse to load thezone:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">May 23 15:58:43 terminator named-xfer[386]: &quot;fx.movie.edu <SPANCLASS="acronym">IN</SPAN> 65281&quot; - unknown type (65281)</PRE></BLOCKQUOTE><PCLASS="para">The workaround for this is to configure the Microsoft<SPANCLASS="acronym">DNS</SPAN> Server to filter out the proprietary record before transferringthe zone.  You do this by selecting the zone in the left-hand sideof the <SPANCLASS="acronym">DNS</SPAN> Manager screen, right clicking on it and selecting Properties. Click on the <SPANCLASS="acronym">WINS</SPAN> Lookup tab in the resulting Zone Properties window, shown in <ACLASS="xref"HREF="ch13_05.htm#DNS3-CHP-13-FIG-1"TITLE="Settings only affect local server checkbox">Figure 13.1</A>.</P><H4CLASS="figure"><ACLASS="title"NAME="DNS3-CHP-13-FIG-1">Figure 13.1: <SPANCLASS="quote">"Settings only affect local server"</SPAN> checkbox</A></H4><IMGCLASS="graphic"SRC="figs/dns3_1301.gif"ALT="Figure 13.1"><PCLASS="para">Checking <SPANCLASS="quote">"Settings only affect local server"</SPAN>will filter out the <SPANCLASS="acronym">WINS</SPAN> record for that zone.  However, any Microsoft<SPANCLASS="acronym">DNS</SPAN> Server slaves won't see the record, even though they could useit.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-14409">13.5.2 Name Server Reports <SPANCLASS="quote">"No NS Record for SOA MNAME"</SPAN></A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14413"></A><ACLASS="indexterm"NAME="AUTOID-14415"></A><ACLASS="indexterm"NAME="AUTOID-14418"></A>You'll only see this error on <SPANCLASS="acronym">BIND</SPAN> 8.1 servers:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">May 8 03:44:38 terminator named[11680]: no NS RR for SOA MNAME &quot;movie.edu&quot; in     zone &quot;movie.edu&quot;</PRE></BLOCKQUOTE><PCLASS="para">The 8.1 server was a real stickler about the firstfield in the <SPANCLASS="acronym">SOA</SPAN> record.  Remember that one?  In <ACLASS="xref"HREF="ch04_01.htm"TITLE="Setting Up BIND">Chapter 4, <CITECLASS="chapter">Setting Up <SPANCLASS="acronym">BIND</SPAN></CITE></A>, we saidthat it was, by convention, the domain name of the primary mastername server for the zone.  <SPANCLASS="acronym">BIND</SPAN> 8.1 assumes it is, and checks fora corresponding <SPANCLASS="acronym">NS</SPAN> record pointing the zone's domain name to the serverin that field.  If there's no such <SPANCLASS="acronym">NS</SPAN> record, <SPANCLASS="acronym">BIND</SPAN> emits that errormessage.  It will also prevent <SPANCLASS="acronym">NOTIFY</SPAN> messages from working correctly. The solution is either to change your <SPANCLASS="acronym">MNAME</SPAN> field to the domainname of a name server listed in an <SPANCLASS="acronym">NS</SPAN> record or upgrade to a newerversion of <SPANCLASS="acronym">BIND</SPAN> 8.  The check was removed at <SPANCLASS="acronym">BIND</SPAN> 8.1.1.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-14435">13.5.3 Name Server Reports <SPANCLASS="quote">"Too Many Open Files"</SPAN></A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14439"></A><ACLASS="indexterm"NAME="AUTOID-14441"></A>On hosts with many <SPANCLASS="acronym">IP</SPAN> addresses, or a low limit on the maximum numberof files a user can open, <SPANCLASS="acronym">BIND</SPAN> will report:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Dec 12 11:52:06 terminator named[7770]: socket(<SPANCLASS="acronym">SOCK_RAW</SPAN>): Too many open files</PRE></BLOCKQUOTE><PCLASS="para">and die.</P><PCLASS="para">Since <SPANCLASS="acronym">BIND</SPAN> tries to <KBDCLASS="command">bind()</KBD> toand listen on every network interface on the host, it may run outof file descriptors.  This is especially common on hosts that use lotsof virtual interfaces, often in support of web hosting.  The twopossible solutions are:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Configure <SPANCLASS="acronym">BIND</SPAN> to listen on only oneor a few of the host's network interfaces using the <KBDCLASS="command">listen-on</KBD> substatement. If <ICLASS="systemitem.sitename">terminator</I> is the host we're having this problem with:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">options {                listen-on { 192.249.249.3; };};</PRE></BLOCKQUOTE><PCLASS="para">will tell <KBDCLASS="command">named</KBD> on <ICLASS="systemitem.sitename">terminator</I> to <KBDCLASS="command">bind()</KBD> only to the<SPANCLASS="acronym">IP</SPAN> address 192.249.249.3.</P></LI><LICLASS="listitem"><PCLASS="para">Reconfigure your operating system to allow a processto open more file descriptors concurrently.</P></LI></UL></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-14465">13.5.4 Resolver Reports <SPANCLASS="quote">"Looked for PTR, Found CNAME"</SPAN></A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14469"></A><ACLASS="indexterm"NAME="AUTOID-14472"></A><ACLASS="indexterm"NAME="AUTOID-14475"></A><ACLASS="indexterm"NAME="AUTOID-14478"></A>This is another problem related to <SPANCLASS="acronym">BIND</SPAN>'s strictness.  Onsome lookups, the resolver will log:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Sep 24 10:40:11 terminator syslog: gethostby*.getanswer: asked for     &quot;37.103.74.204.in-addr.arpa <SPANCLASS="acronym">IN</SPAN> <SPANCLASS="acronym">PTR</SPAN>&quot;, got type &quot;<SPANCLASS="acronym">CNAME</SPAN>&quot;Sep 24 10:40:11 terminator syslog: gethostby*.getanswer: asked for     &quot;37.103.74.204.in-addr.arpa&quot;, got &quot;37.32/27.103.74.204.in-addr.arpa&quot;</PRE></BLOCKQUOTE><PCLASS="para">What happened here is that the resolver asked thename server to reverse map the <SPANCLASS="acronym">IP</SPAN> address 204.74.103.37 to a domain name. The server did, but in the process found that <ICLASS="systemitem.sitename">37.103.74.204.in-addr.arpa</I>was actually an alias for <ICLASS="systemitem.sitename">37.32/27.103.74.204.in-addr.arpa</I>.  That'salmost certainly because the folks who run <ICLASS="systemitem.sitename">103.74.204.in-addr.arpa</I>are using the scheme we described in <ACLASS="xref"HREF="ch09_01.htm"TITLE="Parenting">Chapter 9, <CITECLASS="chapter">Parenting</CITE></A>, to delegate partof their name space.  The <SPANCLASS="acronym">BIND</SPAN> 4.9.3-<SPANCLASS="acronym">BETA</SPAN> resolver, however, doesn'tunderstand that, and flags it as an error, thinking it didn't getthe domain name or the type it was after.</P><PCLASS="para">The only solutionto this problem is to upgrade to a newer version of the <SPANCLASS="acronym">BIND</SPAN> resolver.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-14495">13.5.5 Name Server Startup Fails Because <SPANCLASS="acronym">UDP</SPAN> Checksums Disabled</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14499"></A><ACLASS="indexterm"NAME="AUTOID-14502"></A><ACLASS="indexterm"NAME="AUTOID-14504"></A>On some hosts running Sun<SPANCLASS="acronym">OS</SPAN> 4.1.X, you'll see this error:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Sep 24 10:40:11 terminator named[7770]: ns_udp checksums <SPANCLASS="acronym">NOT</SPAN> turned on: exiting</PRE></BLOCKQUOTE><PCLASS="para"><KBDCLASS="command">named</KBD> checked to make sure <SPANCLASS="acronym">UDP</SPAN> checksumming was onon this system, and it wasn't, so <KBDCLASS="command">named</KBD> exited.  <KBDCLASS="command">named</KBD> is so insistenton <SPANCLASS="acronym">UDP</SPAN> checksumming being on for good reason: it makes copioususe of <SPANCLASS="acronym">UDP</SPAN>, and needs those <SPANCLASS="acronym">UDP</SPAN> datagrams to arrive unmolested.</P><PCLASS="para">The solution to this problem is to enable <SPANCLASS="acronym">UDP</SPAN> checksums onyour system.  The <SPANCLASS="acronym">BIND</SPAN> distribution has documentation on that in<ICLASS="filename">shres/sunos/INSTALL</I> and <ICLASS="filename">shres/sunos/ISSUES</I> (in the <SPANCLASS="acronym">BIND</SPAN> 4 distribution)or <ICLASS="filename">src/port/sunos/shres/ISSUES</I> (in the <SPANCLASS="acronym">BIND</SPAN> 8 distribution).</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-14526">13.5.6 Sun<SPANCLASS="acronym">OS</SPAN> Resolver Is Configured, but Host Doesn't Use<SPANCLASS="acronym">DNS</SPAN></A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14531"></A>The last of these problems is implementation-specific. Some administrators on Sun<SPANCLASS="acronym">OS</SPAN> 4 hosts configure their resolverswith <ICLASS="filename">resolv.conf</I> and naively assume that <KBDCLASS="command">ping</KBD>, <KBDCLASS="command">telnet</KBD>, and theirbrethren should work right away.  However, in <ACLASS="xref"HREF="ch07_01.htm"TITLE="Maintaining BIND">Chapter 7, <CITECLASS="chapter">Maintaining <SPANCLASS="acronym">BIND</SPAN></CITE></A>, we discussedhow Sun<SPANCLASS="acronym">OS</SPAN> 4 implements the resolver (in <KBDCLASS="command">ypserv</KBD>, if you recall). If the host isn't running <SPANCLASS="acronym">NIS</SPAN>, configuring the resolver won't doit.  The administrator will either have to set up at least an empty <ICLASS="filename">hosts</I>map or replace the resolver routines.  For details on both of theseoptions, see <ACLASS="xref"HREF="ch07_01.htm"TITLE="Maintaining BIND">Chapter 7</A>.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-14543">13.5.7 Other Name Servers Don't Cache Your Negative Answers</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14546"></A><ACLASS="indexterm"NAME="AUTOID-14548"></A>You'd need a keen eye to notice this problem, and you'd alsohave to have turned off an important <SPANCLASS="acronym">BIND</SPAN> 8 feature to have causedthe problem.  If you're running a <SPANCLASS="acronym">BIND</SPAN> 8 name server and other resolversand servers seem to ignore your server's cached negative responses,you just might have turned off <ICLASS="function">auth-nxdomain</I>.<ACLASS="indexterm"NAME="AUTOID-14554"></A><ACLASS="indexterm"NAME="AUTOID-14556"></A></P><PCLASS="para"><ICLASS="function">auth-nxdomain</I>is an options substatement that tells the <SPANCLASS="acronym">BIND</SPAN> 8 server to flag cachednegative responses as authoritative, even though they're not.  Thatis, if your name server has cached the fact that <ICLASS="systemitem.sitename">titanic.movie.edu</I> doesnot exist from the authoritative <ICLASS="systemitem.sitename">movie.edu</I> name servers, <ICLASS="function">auth-nxdomain</I>tells your server to pass along that cached response to resolversand servers that query it as though it were the authoritative nameserver for <ICLASS="systemitem.sitename">movie.edu</I>.</P><PCLASS="para">The reason this is necessary isbecause some name servers check to make sure that negative responses,like <SPANCLASS="acronym">NXDOMAIN</SPAN> and no records with a <SPANCLASS="acronym">NOERROR</SPAN> return code, are markedauthoritative.  In the days before negative caching, negative responseshad to be authoritative, so this was a sensible sanity check.  Withthe advent of negative caching, however, a negative response maycome from the cache.  To make sure that older servers don't ignoresuch answers, though, or consider them errors, <SPANCLASS="acronym">BIND</SPAN> 8 lets youfalsely flag those responses as authoritative.  In fact, that'sthe default behavior, so you shouldn't see remote queriers ignoringyour server's negative responses unless you turn off <ICLASS="function">auth-nxdomain</I>.</P></DIV><ACLASS="indexterm"NAME="AUTOID-14571"></A><ACLASS="indexterm"NAME="AUTOID-14572"></A><ACLASS="indexterm"NAME="AUTOID-14573"></A><ACLASS="indexterm"NAME="AUTOID-14574"></A></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch13_04.htm"TITLE="13.4 Transition Problems"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 13.4 Transition Problems"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="DNS &amp; BIND"><IMGSRC="../gifs/txthome.gif"ALT="DNS &amp; BIND"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch13_06.htm"TITLE="13.6 Problem Symptoms"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 13.6 Problem Symptoms"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">13.4 Transition Problems</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">13.6 Problem Symptoms</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>