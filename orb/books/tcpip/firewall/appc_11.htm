<HTML><HEAD><TITLE>[Appendix C] C.11 The Routing Table</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:31:00Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="appc_01.htm"TITLE="C. TCP/IP Fundamentals"><LINKREL="prev"HREF="appc_10.htm"TITLE="C.10 Internet Routing Architecture"><LINKREL="next"HREF="appc_12.htm"TITLE="C.12 Protocols, Ports, and Sockets"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appc_10.htm"TITLE="C.10 Internet Routing Architecture"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: C.10 Internet Routing Architecture"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Appendix C<BR><SPANCLASS="acronym">TCP/IP</SPAN> Fundamentals</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appc_12.htm"TITLE="C.12 Protocols, Ports, and Sockets"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: C.12 Protocols, Ports, and Sockets"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="FIRE-C-S1-11">C.11 The Routing Table</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CRT"></A>Gateways route data between networks but all network devices, hostsas well as gateways, must make routing decisions. For most hosts, therouting decisions are simple:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">If the destination host is on the local network, the data isdelivered to the destination host.</P></LI><LICLASS="listitem"><PCLASS="para">If the destination host is on a remote network, the data is forwardedto a local gateway.</P></LI></UL><PCLASS="para">Because routing is network oriented, <SPANCLASS="acronym">IP</SPAN> makesrouting decisions based on the network portion of the address. The<SPANCLASS="acronym">IP</SPAN> module determines the network part of thedestination's <SPANCLASS="acronym">IP</SPAN> address by checking the high-orderbits of the address to determine the address class. The address classdetermines the portion of the address <SPANCLASS="acronym">IP</SPAN> usesto identify the network. If the destination network is the localnetwork, the local subnet mask is applied to the destination address.</P><PCLASS="para">After determining the destination network, the <SPANCLASS="acronym">IP</SPAN>module looks up the network in the local <EMCLASS="emphasis">routingtable</EM>.[6] Packets are routed toward their destination as directed bythe routing table. The routing table may be built by the systemadministrator or by routing protocols, but the end result is the same;<SPANCLASS="acronym">IP</SPAN> routing decisions are simple table look-ups.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[6] This table is also called the <EMCLASS="emphasis">forwarding table</EM>.</P></BLOCKQUOTE><PCLASS="para">On a <SPANCLASS="acronym">UNIX</SPAN> system, you can display the routingtable's contents with the <EMCLASS="emphasis">netstat -nr</EM> command.The <EMCLASS="emphasis">-r</EM> option tells <EMCLASS="emphasis">netstat</EM>to display the routing table, and the <EMCLASS="emphasis">-n</EM> optiontells <EMCLASS="emphasis">netstat</EM> to display the table in numeric form. It's useful todisplay the routing table in numeric form because the destination ofmost routes is a network, and networks are usually referred to bynetwork numbers.</P><PCLASS="para">The <EMCLASS="emphasis">netstat</EM> command displays a routing tablecontaining the following fields:</P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">Destination</EM></DT><DDCLASS="listitem"><PCLASS="para">The destination network (or host)</P></DD><DTCLASS="term"><EMCLASS="emphasis">Gateway</EM></DT><DDCLASS="listitem"><PCLASS="para">The gateway to use to reach the specified destination.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Flags</EM></DT><DDCLASS="listitem"><PCLASS="para">The flags describe certain characteristics of this route. Thepossible flag values are:<DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">U:</EM></DT><DDCLASS="listitem"><PCLASS="para">Indicates that the route is up and operational.</P></DD><DTCLASS="term"><EMCLASS="emphasis">H:</EM></DT><DDCLASS="listitem"><PCLASS="para">Indicates this is a route to a specific host (most routes are tonetworks).</P></DD><DTCLASS="term"><EMCLASS="emphasis">G:</EM></DT><DDCLASS="listitem"><PCLASS="para">Means the route uses a gateway. The system's network interfacesprovide routes to directly connected networks. All other routes useremote gateways. Directly connected networks do not have the G flagset; all other routes do.</P></DD><DTCLASS="term"><EMCLASS="emphasis">D:</EM></DT><DDCLASS="listitem"><PCLASS="para">Means that this route was added because of an <SPANCLASS="acronym">ICMP</SPAN>redirect. When a system learns of a route via an<SPANCLASS="acronym">ICMP</SPAN> redirect, it adds the route to its routingtable, so that additional packets bound for that destination will notneed to be redirected. The system uses the D flag to mark theseroutes.</P></DD></DL></P></DD><DTCLASS="term"><EMCLASS="emphasis">Refcnt</EM></DT><DDCLASS="listitem"><PCLASS="para">Shows the number of times the route has been referenced toestablish a connection.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Use</EM></DT><DDCLASS="listitem"><PCLASS="para">Shows the number of packets transmitted via this route.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Interface</EM></DT><DDCLASS="listitem"><PCLASS="para">The name of the network interface.[7]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[7] The network interface is the network access hardware and software that<SPANCLASS="acronym">IP</SPAN> uses to communicate with the physical network.</P></BLOCKQUOTE></DD></DL><PCLASS="para">The two fields important for our current discussion are thedestination and gateway fields. The following is a sample routingtable:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">peanut% netstat -nrRouting tablesDestination Gateway       Flags Refcnt       Use  Interface 127.0.0.1  127.0.0.1       UH      1         298         lo0 default     128.66.12.1    UG      2       50360         le0 128.66.12.0 128.66.12.2    U      40      111379         le0 128.66.2.0  128.66.12.3    UG      4        1179         le0 128.66.1.0  128.66.12.3    UG     10        1113         le0128.66.3.0  128.66.12.3    UG      2        1379         le0128.66.4.0  128.66.12.3    UG      4        1119         le0</PRE></BLOCKQUOTE><PCLASS="para">The first table entry is the <EMCLASS="emphasis">loopback route</EM> forthe local host. This is the loopback address mentioned earlier as areserved network number. Because every system uses the loopback routeto send datagrams to itself, this entry is in every host's routingtable. The H flag is set because it is a route to a specific host(127.0.0.1), not a route to an entire network (127.0.0.0). </P><PCLASS="para">Another unique entry in the routing table is the entry with the word&quot;default&quot; in the destination field. This entry is for the<EMCLASS="emphasis">default route</EM>, and the gateway specified in thisentry is the<EMCLASS="emphasis"> default gateway</EM>. The default gatewayis used whenever there is no specific route in the table for adestination network address. For example, this routing table has noentry for network 192.178.16.0. If <SPANCLASS="acronym">IP</SPAN> receives anydatagrams addressed to this network, it will send the datagram via thedefault gateway 128.66.12.1.</P><PCLASS="para">You can tell from the sample routing table display that this host(<EMCLASS="emphasis">peanut</EM>) is directly connected to network128.66.12.0. The routing table entry for that network does not specifyan external gateway; i.e., the routing table entry for 128.66.12.0does not have the G flag set. Therefore, <EMCLASS="emphasis">peanut</EM>must be directly connected to that network.</P><PCLASS="para">All of the gateways that appear in a routing table are on networksdirectly connected to the local system. In the sample shown above thismeans that, regardless of the destination address, the gatewayaddresses all begin with 128.66.12. This is the only network to which<EMCLASS="emphasis">peanut</EM> is directly attached, and therefore it isthe only network to which <EMCLASS="emphasis">peanut</EM> can directlydeliver data. The gateways that <EMCLASS="emphasis">peanut</EM> uses toreach the rest of the Internet must be on<EMCLASS="emphasis">peanut</EM>'s subnet.</P><PCLASS="para"><ACLASS="xref"HREF="appc_11.htm#FIRE-C-FIG-16"TITLE="Table-based routing">Figure 13.20</A> shows how routing works on ourimaginary network. The <SPANCLASS="acronym">IP</SPAN> layer of each host andgateway is replaced by a small piece of a routing table, showingdestination networks and the gateways used to reach thosedestinations. When the source host (128.66.12.2) sends data to thedestination host (128.66.1.2), it first determines that 128.66.1.2 isthe local network's class B address and applies the subnetmask. (Network 128.66.0.0 is subnetted using the mask 255.255.255.0;this could also be written as 128.66.0.0/24.) After applying thesubnet mask, <SPANCLASS="acronym">IP</SPAN> knows that the destination'snetwork address is 128.66.1.0. The routing table in the source hostshows that data bound for 128.66.1.0 should be sent to gateway128.66.12.3. Gateway 128.66.12.3 makes direct delivery thorough its128.66.1.5 interface. Examining the routing tables shows that allsystems list only gateways on networks they are directly connectedto. Note that 128.66.12.1 is the default gateway for both 128.66.12.2and 128.66.12.3. But because 128.66.1.2 cannot reach network128.66.12.0 directly, it has a different default route.</P><H4CLASS="figure"><ACLASS="title"NAME="FIRE-C-FIG-16">Figure 13.20: Table-based routing</A></H4><IMGCLASS="graphic"SRC="figs/firec16.gif"ALT="Figure 13.20"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24465"></A>A routing table does not contain end-to-end routes. A route only pointsto the next gateway, called the <EMCLASS="emphasis">next hop,</EM> along thepath to the destination network. The host relies on the local gateway todeliver the data, and the gateway relies on other gateways. As adatagram moves from one gateway to another, it should eventually reachone that is directly connected to its destination network. It is thislast gateway that finally delivers the data to the destination host.<ACLASS="indexterm"NAME="AUTOID-24468"></A></P></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appc_10.htm"TITLE="C.10 Internet Routing Architecture"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: C.10 Internet Routing Architecture"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appc_12.htm"TITLE="C.12 Protocols, Ports, and Sockets"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: C.12 Protocols, Ports, and Sockets"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">C.10 Internet Routing Architecture</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">C.12 Protocols, Ports, and Sockets</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>