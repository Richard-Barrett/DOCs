<HTML><HEAD><TITLE>[Chapter 5] 5.3 Choosing a Machine</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:14:09Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch05_01.htm"TITLE="5. Bastion Hosts"><LINKREL="prev"HREF="ch05_02.htm"TITLE="5.2 Special Kinds of Bastion Hosts"><LINKREL="next"HREF="ch05_04.htm"TITLE="5.4 Choosing a Physical Location"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_02.htm"TITLE="5.2 Special Kinds of Bastion Hosts"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.2 Special Kinds of Bastion Hosts"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 5<BR>Bastion Hosts</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_04.htm"TITLE="5.4 Choosing a Physical Location"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.4 Choosing a Physical Location"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-2507">5.3 Choosing a Machine</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH05MACHCHOOS"></A>The first step in building a bastion host is to decide what kind ofmachine to use. You want reliability (if the bastion host goes down,you lose most of the benefit of your Internet connection),supportability, and configurability. This section looks at whichoperating system you should run, how fast the bastion host needs to be,and what hardware configuration should be supported.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-2513">5.3.1 What Operating System?</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="CH05OPSYSCHOOS"></A>The bastion host should be something you're familiar with. You'regoing to end up customizing the machine and the operating systemextensively; this is not the time to learn your way around acompletely new system. Because a fully configured bastion host is avery restricted environment, you'll want to be able to do developmentfor it on another machine, and it helps a great deal to be able toexchange its peripherals with other machines you own. (This is partlya hardware issue, but it doesn't do you any good to be able to plugyour <SPANCLASS="acronym">UNIX</SPAN>-formatted <SPANCLASS="acronym">SCSI</SPAN> diskinto a Macintosh <SPANCLASS="acronym">SCSI</SPAN> chain: the hardwareinteroperates, but the data isn't readable.)</P><PCLASS="para">You need a machine that reliably offers the range of Internet servicesyou wish to provide your users, with multiple connectionssimultaneously active. If your site is completely made up of<SPANCLASS="acronym">MS-DOS</SPAN>, Windows, or Macintosh systems, you may findyourself needing some other platform (perhaps <SPANCLASS="acronym">UNIX</SPAN>,perhaps Windows <SPANCLASS="acronym">NT</SPAN>, perhaps something else) to useas your bastion host. You may not be able to provide or access allthe services you desire through your native platform, because therelevant tools (proxy servers, packet filtering systems, or evenregular servers for basic services such as <SPANCLASS="acronym">SMTP</SPAN> and<SPANCLASS="acronym">DNS</SPAN>) may not be available for that platform.</P><PCLASS="para"><ACLASS="indexterm"NAME="CH05UNIX"></A><SPANCLASS="acronym">UNIX</SPAN> is the operating system that has been mostpopular in offering Internet services, and tools are widely availableto make bastion hosts on <SPANCLASS="acronym">UNIX</SPAN> systems. If youalready have <SPANCLASS="acronym">UNIX</SPAN> machines, you should seriouslyconsider <SPANCLASS="acronym">UNIX</SPAN> for your bastion host. If you have nosuitable platforms for a bastion host and need to learn a newoperating system anyway, we recommend you try <SPANCLASS="acronym">UNIX</SPAN>,because that's where you'll find the largest and most extensive set oftools for building bastion hosts.</P><PCLASS="para">If all of your existing multiuser, <SPANCLASS="acronym">IP</SPAN>-capable machinesare something other than <SPANCLASS="acronym">UNIX</SPAN> machines (such as<SPANCLASS="acronym">VMS</SPAN> systems, for example), you have a hard decisionto make. You can probably use a machine you are familiar with as abastion host and get the advantages of familiarity andinterchangeability. On the other hand, solid and extensive tools forbuilding bastion hosts are not likely to be available to you, andyou're going to have to improvise. You might gain some security throughobscurity (don't count on it; your operating system probably isn't asobscure as you think), but you may lose as much or more if you don'thave the history that <SPANCLASS="acronym">UNIX</SPAN>-based bastion hostsoffer. With <SPANCLASS="acronym">UNIX</SPAN>, you have the advantage oflearning through other people's mistakes as well as your own.</P><PCLASS="para">Most of this chapter assumes that you will be using some kind of<SPANCLASS="acronym">UNIX</SPAN> machine as your bastion host; this chapter ismore <SPANCLASS="acronym">UNIX</SPAN>-centric than any other part of thisbook. This is because most bastion hosts <EMCLASS="emphasis">are</EM><SPANCLASS="acronym">UNIX</SPAN> machines, and some of the details areextremely operating system dependent. The principles will be the sameif you choose to use another operating system, but the details willvary considerably.</P><PCLASS="para">If you have a <SPANCLASS="acronym">UNIX</SPAN> machine, which version of<SPANCLASS="acronym">UNIX</SPAN> should you choose? Again, you want to balancewhat you're familiar with against which tools are available for whichversions. If your site already uses one version of<SPANCLASS="acronym">UNIX</SPAN>, you will most likely use that version. Ifyour site has some familiarity with several versions of<SPANCLASS="acronym">UNIX</SPAN>, and the relevant tools (discussed throughoutthis chapter) are available for all of them, use the<EMCLASS="emphasis">least</EM> popular one that you still like. Doing somaximizes your happiness and minimizes the likelihood that attackershave precompiled ways of attacking your bastion host. If you have no<SPANCLASS="acronym">UNIX</SPAN> familiarity, choose any version you like,provided that it is in reasonably widespread use (you don't want&quot;Joe's <SPANCLASS="acronym">UNIX</SPAN>, special today $9.95&quot;). Asa rule of thumb, if your chosen version of <SPANCLASS="acronym">UNIX</SPAN> hasa user's group associated with it, it's probably well-known enough torely on.</P><PCLASS="para">Although <SPANCLASS="acronym">UNIX</SPAN> vendors differ vastly in theiropenness about security issues, the difference in the actual securitybetween different versions of <SPANCLASS="acronym">UNIX</SPAN> is muchsmaller. Don't assume that the publicity given to security holesreflects the number of security holes; it's a more accurate reflectionof the popularity of the operating system and the willingness of avendor to admit and fix security problems. Ironically, the operatingsystems with the most worrisome tales may be themost secure ones, because they're the ones getting fixed.</P><DIVCLASS="sidebar"><H4CLASS="sidebar"><ACLASS="title"NAME="AUTOID-2559">Useful <SPANCLASS="acronym">UNIX</SPAN> Capabilities</A></H4><PCLASS="para">Every operating system has certain special capabilities or featuresthat can be useful in building a bastion host. We can't describe allthese capabilities for all systems, but we'll tell you about a fewspecial features of <SPANCLASS="acronym">UNIX</SPAN> because it's a commonbastion host platform.<DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">setuid/setgid</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2570"></A><ACLASS="indexterm"NAME="AUTOID-2572"></A>Every <SPANCLASS="acronym">UNIX</SPAN> userhas a numeric user identification (<EMCLASS="emphasis">uid</EM>) inaddition to his or her login name, and belongs to one or more groups ofusers, also identified by numbers (<EMCLASS="emphasis">gid</EM>s). The<SPANCLASS="acronym">UNIX</SPAN> kernel uses the <EMCLASS="emphasis">uid</EM> andthe various <EMCLASS="emphasis">gid</EM>s of a particular user todetermine what files that user has access to. Normally,<SPANCLASS="acronym">UNIX</SPAN> programs run with the file access permissionsof the user who executes the program. The <EMCLASS="emphasis">setuid</EM>capability allows a program to be installed so that it always runswith the permissions of the owner of the program, regardless of whichuser is running the program. The <EMCLASS="emphasis">setgid</EM>capability is similar; it allows the program to temporarily (whilerunning the program) grant membership in a group to users who are notnormally members of that group.</P></DD><DTCLASS="term"><EMCLASS="emphasis">chroot</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2588"></A>The <EMCLASS="emphasis">chroot</EM> mechanismallows a program to irreversibly change its view of the filesystem bychanging the program's idea of where the root of the filesystemis. Once a program <EMCLASS="emphasis">chroot</EM>s to a particular pieceof the filesystem, that piece becomes the whole filesystem as far asthe program is concerned; the rest of the filesystem ceases to exist,from the program's point of view.</P></DD></DL></P><PCLASS="para">Environmental modifications, such as those made by<EMCLASS="emphasis">setuid/setgid</EM> and <EMCLASS="emphasis">chroot,</EM>are inherited by any subsidiary processes a program starts. A commonway of restricting what the programs on a bastion host can do is torun the programs under &quot;wrapper&quot; programs; the wrapperprograms do whatever <EMCLASS="emphasis">setuid/setgid</EM>,<EMCLASS="emphasis">chroot</EM>, or other environmental change work isnecessary, and then start the realprogram. <EMCLASS="emphasis">chrootuid</EM> is a wrapper program for thispurpose; <ACLASS="xref"HREF="appb_01.htm"TITLE="Tools">Appendix B, <CITECLASS="appendix">Tools</CITE></A> gives information on how to getit.<ACLASS="indexterm"NAME="AUTOID-2599"></A></P></DIV><ACLASS="indexterm"NAME="AUTOID-2600"></A></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-2601">5.3.2 How Fast a Machine?</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2604"></A><ACLASS="indexterm"NAME="AUTOID-2607"></A><ACLASS="indexterm"NAME="AUTOID-2609"></A><ACLASS="indexterm"NAME="AUTOID-2611"></A><ACLASS="indexterm"NAME="AUTOID-2614"></A>The bastion host doesn't have to be a fast machine; in fact, it'sbetter not being especially powerful. There are several good reasons,besides cost, to make your bastion host as powerful as it needs to beto do its job, but no more so. It doesn't take much horsepower toprovide the services required of the bastion host.</P><PCLASS="para">Many people use machines in the 2- to 5-<SPANCLASS="acronym">MIPS</SPAN> range(for example, Sun-3, Micro<SPANCLASS="acronym">VAX</SPAN> II, or 80386-based<SPANCLASS="acronym">UNIX</SPAN> platforms) as their bastion hosts. This isplenty of power for an average site. The bastion host really doesn'thave much work to do. What it needs to do is mostly limited by thespeed of your connection to the outside world, not by the<SPANCLASS="acronym">CPU</SPAN> speed of the bastion host itself. It justdoesn't take that much of a processor to handle mail,<SPANCLASS="acronym">DNS</SPAN>, <SPANCLASS="acronym">FTP</SPAN>, and proxy services fora 56 Kb/s or even a T-1(1.544 Mb/s) line. You may need more power if youare running programs that do compression/decompression (e.g.,<SPANCLASS="acronym">NNTP</SPAN> servers) or searches (e.g., full-featured<SPANCLASS="acronym">WWW</SPAN> servers), or if you're providing proxy servicesfor dozens of users simultaneously.</P><PCLASS="para">You may also need more power to support requests from the Internet ifyour site becomes wildly popular (e.g., if you createsomething that everybody and their mothers want to access, like TheGreat American Web Page or a popular and well-stocked anonymous<SPANCLASS="acronym">FTP</SPAN> site).[1] At that point, you might also want to start using multiplebastion hosts, as we describe in <ACLASS="xref"HREF="ch04_01.htm"TITLE="Firewall Design">Chapter 4</A>. A largecompany with multiple Internet connections and popular services mayneed to use multiple bastion hosts <EMCLASS="emphasis">and</EM> large,powerful machines. (Fortunately, most companies in that position arealso computer manufacturers and buy computers wholesale.)</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] If you find yourself (or want to find yourself) in such a position,see <CITECLASS="citetitle">Managing Internet Information Services</CITE> byCricket Liu, et al (O'Reilly &amp; Associates, 1994). This bookcontains lots of helpful information and advice.</P></BLOCKQUOTE><PCLASS="para">There are several reasons not to oversize the bastion host:<ACLASS="indexterm"NAME="AUTOID-2634"></A></P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2640"></A>A slower machine is a less inviting target. There's no prestige forsomebody who brags, &quot;Hey, I broke into a Sun 3/60!&quot; orsome other slow (to an attacker, at least) machine. There is far moreprestige involved in breaking into the latest, greatest hardware.Don't make your bastion host something with high prestige value (aCray, for example, would be a poor choice of a bastion host...).</P></LI><LICLASS="listitem"><PCLASS="para">If compromised, a slower machine is less useful for attacking internalsystems or other sites. It takes longer to compile code; it's not veryhelpful for running dictionary or brute-force password attacks againstother machines; and so on. All of these factors make the machine lessappealing to potential attackers, and that's your goal.</P></LI><LICLASS="listitem"><PCLASS="para">A slower machine is less attractive for insiders tocompromise. A fast machine that's spending most of its time waiting fora slow network connection is effectively wasted, and the pressure fromyour own users to use the extra power for other things (for example, asa compilation server, rendering server, or database server) can beconsiderable. You can't maintain the security of a bastion host whileusing it for other purposes. Extra capacity on the bastion host is anaccident waiting to happen.</P></LI></UL></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-2647">5.3.3 What Hardware Configuration?</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2650"></A><ACLASS="indexterm"NAME="AUTOID-2653"></A><ACLASS="indexterm"NAME="AUTOID-2656"></A><ACLASS="indexterm"NAME="AUTOID-2658"></A><ACLASS="indexterm"NAME="AUTOID-2662"></A>You want a reliable hardware configuration, so you should select abase machine and peripherals that aren't the newest thing on themarket. (There's a reason people call it the &quot;bleedingedge&quot; as well as the &quot;leading edge.&quot;) You also wantthe configuration to be supportable, so don't choose something so oldyou can't find replacement parts for it. The middle range from yourfavorite manufacturer is probably about right.</P><PCLASS="para">While you don't need sheer <SPANCLASS="acronym">CPU</SPAN> power, you do need amachine that keeps track of a number of connectionssimultaneously. This is memory-intensive, so you'll want a largeamount of memory and probably a large amount of swap space aswell. Caching proxies also need a large amount of free disk space touse for the caches.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2669"></A><ACLASS="indexterm"NAME="AUTOID-2671"></A>Here are some suggestions about tape and disk needs:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">The bastion host can't reasonably use another host's tape drivefor backups, as we'll discuss later in this chapter, so it needs itsown tape drive of a size suitable to back itself up. </P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2678"></A>A <SPANCLASS="acronym">CD-ROM</SPAN> drive also comes in handy for operatingsystem installation and possibly for keeping checksums on (or forcomparing your current files to the original files on the<SPANCLASS="acronym">CD-ROM</SPAN>). You may only need the<SPANCLASS="acronym">CD-ROM</SPAN> drive initially when you first install andconfigure the machine, so an external drive that you&quot;borrow&quot; from another machine temporarily may besufficient.</P></LI><LICLASS="listitem"><PCLASS="para">You should be able to easily add another disktemporarily to the configuration for maintenance work.</P></LI><LICLASS="listitem"><PCLASS="para">The boot disk should remove easily and attach toanother machine&nbsp;- again, for maintenance work. </P></LI></UL><PCLASS="para">Both of the disk considerations mentioned suggest the bastion hostshould use the same type of disks as your other machines. For example,it should not be the only machine at your site running<SPANCLASS="acronym">IPI</SPAN> disks.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2690"></A><ACLASS="indexterm"NAME="AUTOID-2692"></A>The bastion host doesn't need interesting graphics, and shouldn't havethem. This is a network services host; nobody needs to see it. Attacha dumb terminal (the dumber the better) to be the console. Havinggraphics will only encourage people to use the machine for otherpurposes and might encourage you to install support programs (like theX Window System and its derivatives) that are insecure.</P></DIV><ACLASS="indexterm"NAME="AUTOID-2695"></A></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_02.htm"TITLE="5.2 Special Kinds of Bastion Hosts"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.2 Special Kinds of Bastion Hosts"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_04.htm"TITLE="5.4 Choosing a Physical Location"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.4 Choosing a Physical Location"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">5.2 Special Kinds of Bastion Hosts</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">5.4 Choosing a Physical Location</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>