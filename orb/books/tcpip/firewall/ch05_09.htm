<HTML><HEAD><TITLE>[Chapter 5] 5.9 Operating the Bastion Host </TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:15:21Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch05_01.htm"TITLE="5. Bastion Hosts"><LINKREL="prev"HREF="ch05_08.htm"TITLE="5.8 Building a Bastion Host"><LINKREL="next"HREF="ch05_10.htm"TITLE="5.10 Protecting the Machine and Backups"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_08.htm"TITLE="5.8 Building a Bastion Host"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.8 Building a Bastion Host"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 5<BR>Bastion Hosts</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_10.htm"TITLE="5.10 Protecting the Machine and Backups"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.10 Protecting the Machine and Backups"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="AUTOID-3891">5.9 Operating the Bastion Host </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH05BASTHOSTOP"></A>Once you put the bastion host into production, your job has only justbegun. You'll need to keep a close watch on the operations of thebastion host. <ACLASS="xref"HREF="ch12_01.htm"TITLE="Maintaining Firewalls">Chapter 12</A> provides more informationon how to do this; this section discusses specific concerns forbastion hosts.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-3898">5.9.1 Learn What the Normal Usage Profile Is</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3901"></A><ACLASS="indexterm"NAME="AUTOID-3903"></A>If you're going to monitor the bastion host, looking for abnormalitiesthat might indicate break-ins or other types of system compromise, youwill need to first develop an understanding of what the&quot;normal&quot; usage profile of the bastion host is. Ask thesequestions, and others like them:<ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">How many jobs tend to be running at any one time?</P></LI><LICLASS="listitem"><PCLASS="para">How much CPU time do these jobs consume relative to each other?</P></LI><LICLASS="listitem"><PCLASS="para">What is the typical load at different times throughout the day?</P></LI></UL></P><PCLASS="para">Your goal is to develop an almost intuitive grasp of what your systemnormally runs like, so you'll be able to recognize&nbsp;- andinvestigate&nbsp;- anomalous activity very quickly.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="AUTOID-3914">5.9.2 Consider Writing Software to Automate Monitoring</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3917"></A><ACLASS="indexterm"NAME="AUTOID-3920"></A><ACLASS="indexterm"NAME="AUTOID-3923"></A><ACLASS="indexterm"NAME="AUTOID-3926"></A>Doing a thorough job of system monitoring is tough. Although the logsproduced by your system provide lots of useful information, it's easyto get overwhelmed by the sheer volume of logging data. The importantinformation may often be buried. Too often, the logs end up being usedonly <EMCLASS="emphasis">after </EM>a break-in, when, in fact, they couldbe used to detect&nbsp;- and thus perhaps stop&nbsp;- a break-in while it isoccurring.</P><PCLASS="para">Because each operating system and site is different, each bastion hostis configured differently, and each site has different ideas aboutwhat the response of a monitoring system should be. For example, somewant email; some want the output fed to an existing<SPANCLASS="acronym">SNMP</SPAN>-based management system, some want the systemsto trip the pagers of the system administrators, and so on. Monitoringtends to be very site- and host-specific in the details. However,there are some useful tools out there that you should be able toconfigure and adapt for your own use.  The <SPANCLASS="acronym">SWATCH</SPAN>(Simple <SPANCLASS="acronym">WATCH</SPAN>er) package is a good example.<ACLASS="indexterm"NAME="AUTOID-3933"></A><ACLASS="indexterm"NAME="AUTOID-3935"></A></P><PCLASS="para"><SPANCLASS="acronym">SWATCH</SPAN>, developed by Stephen E. Hansen and E. ToddAtkins, automates the monitoring of <SPANCLASS="acronym">UNIX</SPAN>systems. <SPANCLASS="acronym">SWATCH</SPAN> enhances the standard<EMCLASS="emphasis">syslog</EM> facility in various ways. (See thediscussion of <EMCLASS="emphasis">syslog</EM> in &quot;Setting Up SystemLogs&quot; earlier in this chapter.) It sifts through the logs asthey're created by <EMCLASS="emphasis">syslog</EM>, and takes certainactions when certain types of log messages are found, e.g., soundingan alert when repeated unsuccessful login attempts are made to thesame account, or a &quot;file system full&quot; message is encountered.<SPANCLASS="acronym">SWATCH</SPAN> also includes modifications for a number ofdaemons to make their logging more useful; these include<EMCLASS="emphasis">fingerd</EM>, <EMCLASS="emphasis">ftpd</EM>,<EMCLASS="emphasis">ruserok</EM>, <EMCLASS="emphasis">rshd</EM>, and<EMCLASS="emphasis">login. </EM> For example, <EMCLASS="emphasis">login</EM>has been modified so that it allows only three login atempts; itreports to syslog on any &quot;Incomplete Login Attempt&quot;, &quot;Repeated LoginAttempt&quot;, and &quot;Root Login Refused&quot; events; and it includes the accountnames attempted and the originating host. <SPANCLASS="acronym">SWATCH</SPAN>can also watch files other than ones generated by<EMCLASS="emphasis">syslog</EM>. <ACLASS="xref"HREF="appb_01.htm"TITLE="Tools">Appendix B</A> gives you informationon where to get <SPANCLASS="acronym">SWATCH</SPAN>.[4] </P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] The 1993 and 1994 <SPANCLASS="acronym">USENIX</SPAN>/<SPANCLASS="acronym">SAGE LISA</SPAN> conferences (see <ACLASS="xref"HREF="appa_01.htm"TITLE="Resources">Appendix A</A> forinformation about <SPANCLASS="acronym">USENIX</SPAN>, <SPANCLASS="acronym">SAGE</SPAN>,and the <SPANCLASS="acronym">LISA</SPAN> conferences) have produced a number ofpapers on other automated monitoring tools that were originallyintended for system administration use, but that might be adapted touse in monitoring system security.</P></BLOCKQUOTE><PCLASS="para"><SPANCLASS="acronym">SWATCH</SPAN> is written in Perl, which is anunfortunately powerful tool to have sitting on a bastion host; itprovides almost everything an intruder could get through having acompiler except the ability to build new kernels. You will probablywant to run <SPANCLASS="acronym">SWATCH</SPAN> on the machine that the bastionhost is logging to, rather than on the bastion host itself.<ACLASS="indexterm"NAME="AUTOID-3967"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_08.htm"TITLE="5.8 Building a Bastion Host"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.8 Building a Bastion Host"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_10.htm"TITLE="5.10 Protecting the Machine and Backups"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.10 Protecting the Machine and Backups"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">5.8 Building a Bastion Host</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">5.10 Protecting the Machine and Backups</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>