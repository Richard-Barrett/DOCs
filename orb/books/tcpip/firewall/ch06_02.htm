<HTML><HEAD><TITLE>[Chapter 6] 6.2 Configuring a Packet Filtering Router</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:16:10Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch06_01.htm"TITLE="6. Packet Filtering"><LINKREL="prev"HREF="ch06_01.htm"TITLE="6.1 Why Packet Filtering?"><LINKREL="next"HREF="ch06_03.htm"TITLE="6.3 What Does a Packet Look Like?"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_01.htm"TITLE="6.1 Why Packet Filtering?"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 6.1 Why Packet Filtering?"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 6<BR>Packet Filtering</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_03.htm"TITLE="6.3 What Does a Packet Look Like?"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 6.3 What Does a Packet Look Like?"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="FIRE-06-S1-2">6.2 Configuring a Packet FilteringRouter</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH06PACKFILTCONF"></A><ACLASS="indexterm"NAME="CH06SCREENROUTCONF"></A><ACLASS="indexterm"NAME="CH06CONFPACKFILT"></A>To configure a packet filtering router, you first need to decide whatservices you want to allow or deny, and then you need to translateyour decisions into rules about packets. In reality, you probablydon't care about the details of packets at all. What you want is toget your work done. For example, you want to receive mail from theInternet, and whether that's managed by packets or by Murphy's ghostis irrelevant to you. The router, on the other hand, cares only aboutpackets, and only about very limited parts of them. In constructingthe rules for your routers, you have to translate the generalstatement &quot;Receive mail from the Internet&quot; into adescription of the particular kinds of packets you want the router toallow to pass.</P><PCLASS="para">The following sections outline the general concepts you need to keepin mind when translating decisions about services into rules aboutpackets. The specific details for each service are described in <ACLASS="xref"HREF="ch08_01.htm"TITLE="Configuring Internet Services">Chapter 8</A>.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-06-S2-3">6.2.1 Protocols Are UsuallyBidirectional</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4215"></A><ACLASS="indexterm"NAME="AUTOID-4218"></A>Protocols are usually bidirectional; they almost always involve oneside sending an inquiry or a command, and the other side sending aresponse of some kind. When you're planning your packet filteringrules, you need to remember that packets go both ways. For example, itdoesn't do any good to allow outbound Telnet packets that carry yourkeystrokes to a remote host, if you don't also allow the incomingpackets for that connection that carry the screen display back to you.</P><PCLASS="para">Conversely, it also won't do you any good to block only half aconnection. Many attacks can be carried out if attackers can getpackets into your network, even if the attackers can't get anyresponses back. This is possible because the responses may bepredictable enough to allow attackers to carry on their side of theconversation without having to actually see the responses at all. Ifthe responses are predictable, an attacker doesn't need to seethem. They won't be able to extract any information directly if theydon't see the responses, but they may be able to do something thatgives them the data indirectly. For example, even if they can't seeyour <EMCLASS="emphasis">/etc/passwd</EM> file directly, they can probablyissue a command to mail themselves a copy.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-06-S2-4">6.2.2 Be Careful of `Inbound'Versus `Outbound' Semantics</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4225"></A><ACLASS="indexterm"NAME="AUTOID-4228"></A><ACLASS="indexterm"NAME="AUTOID-4231"></A>When you're planning your packet filtering strategy, you need to becareful in your discussions of &quot;inbound&quot; versus&quot;outbound.&quot; You need to carefully distinguish betweeninbound and outbound <EMCLASS="emphasis">packets,</EM> and inbound andoutbound <EMCLASS="emphasis">services</EM>. An outbound service (e.g., theTelnet service mentioned above) involves both outbound packets (yourkeystrokes) and inbound packets (the responses to be displayed on yourscreen). Although most people habitually think in terms of<EMCLASS="emphasis">services</EM>, you need to make sure you think interms of <EMCLASS="emphasis">packets</EM> when you're dealing with packetfiltering. When you talk to others about filtering, be sure tocommunicate clearly whether you're talking about inbound versusoutbound packets, or inbound versus outbound services.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-06-S2-5">6.2.3 Default Permit Versus Default Deny</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4241"></A><ACLASS="indexterm"NAME="AUTOID-4243"></A><ACLASS="indexterm"NAME="AUTOID-4245"></A><ACLASS="indexterm"NAME="AUTOID-4248"></A>In <ACLASS="xref"HREF="ch03_01.htm"TITLE="Security Strategies">Chapter 3</A>, we distingushed between the twostances you can choose in putting together your security policy: thedefault deny stance (that which is not expressly permitted isprohibited) and the default permit stance (that which is notexplicitly prohibited is permitted). From a security point of view, itis far safer to take the attitude that things should be denied bydefault. Your packet filtering rules should reflect this stance. Aswe discussed earlier, start from a position of denying everything andthen set rules that allow only protocols that you need, that youunderstand the security implications of, and that you feel that youcan provide safely enough (according to your own particular definitionof &quot;safely enough&quot;) for your purposes</P><PCLASS="para">The default deny stance is much safer and more effective than thedefault permit stance, which involves permitting everything by defaultand trying to block those things that you know are problems. Thereality is that with such an approach, you'll never know aboutall the problems, and thus you'll never be able todo a complete job.</P><PCLASS="para">In practical terms, the default deny stance means that your filteringrules should be a small list of specific things that you allow, perhapswith a few very specific things you deny scattered throughout to makethe logic come out right, followed by a default deny that coverseverything else. We'll explain in detail how these rules work later inthis chapter.<ACLASS="indexterm"NAME="AUTOID-4254"></A><ACLASS="indexterm"NAME="AUTOID-4255"></A><ACLASS="indexterm"NAME="AUTOID-4256"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_01.htm"TITLE="6.1 Why Packet Filtering?"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 6.1 Why Packet Filtering?"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_03.htm"TITLE="6.3 What Does a Packet Look Like?"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 6.3 What Does a Packet Look Like?"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">6.1 Why Packet Filtering?</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">6.3 What Does a Packet Look Like?</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>