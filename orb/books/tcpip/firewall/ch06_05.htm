<HTML><HEAD><TITLE>[Chapter 6] 6.5 Conventions for Packet Filtering Rules</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:17:10Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch06_01.htm"TITLE="6. Packet Filtering"><LINKREL="prev"HREF="ch06_04.htm"TITLE="6.4 What Does the Router Do with Packets?"><LINKREL="next"HREF="ch06_06.htm"TITLE="6.6 Filtering by Address"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_04.htm"TITLE="6.4 What Does the Router Do with Packets?"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 6.4 What Does the Router Do with Packets?"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 6<BR>Packet Filtering</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_06.htm"TITLE="6.6 Filtering by Address"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 6.6 Filtering by Address"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="FIRE-06-S1-5">6.5 Conventions for Packet FilteringRules</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH06PFRULES"></A><ACLASS="indexterm"NAME="CH06SRRULES"></A>The rest of this chapter and <ACLASS="xref"HREF="ch08_01.htm"TITLE="Configuring Internet Services">Chapter 8</A> show thekinds of rules you can specify for your packet filtering router inorder to control what packets can and cannot flow to and from yournetwork. There are a few things you need to know about these rules.</P><PCLASS="para"><ACLASS="indexterm"NAME="CH06ADDACC"></A><ACLASS="indexterm"NAME="CH06SRACCADD"></A>To avoid confusion, the example rules are specified with abstractdescriptions, rather than with real addresses, as much as possible.Instead of using real source and destination addresses (e.g.,172.16.51.50), we use &quot;Internal&quot; or &quot;External&quot;to identify which networks we're talking about. Actual packetfiltering systems usually require you to specify address rangesexplicitly; the syntax varies from router to router.</P><PCLASS="para">In all of our packet filtering examples, the assumption is that, foreach packet, the router goes through the rules in order until it findsone that matches, and then it takes the action specified by that rule.We assume an implicit default &quot;deny&quot; if no rules apply,although it's a good idea to specify an explicit default (and wegenerally do).</P><PCLASS="para">The syntax used in our filtering examples specifies the number of bitssignificant for comparison to other address after a slash character(/). Thus, 10.0.0.0/8 matches any address that starts with 10; it'sequivalent to 10.0.0.0 with a <SPANCLASS="acronym">UNIX</SPAN> netmask of255.0.0.0, or 10.0.0.0 with a Cisco wildcard mask of 0.255.255.255, or(if it were a filename) 10.*.*.*.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5163"></A><ACLASS="indexterm"NAME="AUTOID-5165"></A><ACLASS="indexterm"NAME="AUTOID-5167"></A><ACLASS="indexterm"NAME="AUTOID-5169"></A>Although we try to be as specific as possible in these examples, it'simpossible to tell you precisely what you have to specify for yourparticular packet filtering product. The exact mechanism forspecifying packet filtering rules varies widely from product toproduct. Some products (such as the <EMCLASS="emphasis">screend</EM>package) allow you to specify a single set of rules that are appliedto all packets routed by the system. Others (such as the TelebitNetBlazer) allow you to specify rules for particular interfaces. Stillothers (such as the Livingston and Cisco products) allow you tospecify sets of rules and then apply sets by name to particularinterfaces (so that you might define one set of rules that is sharedby a number of different interfaces, for example, and put the rulesthat are unique to a given interface into a different set).</P><DIVCLASS="sidebar"><H4CLASS="sidebar"><ACLASS="title"NAME="AUTOID-5172">Packet Filtering Tips and Tricks</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5175"></A>Here are a couple of tips and tricks that can help you deal withpacket filtering rules more effectively and make them more secure.</P><PCLASS="para"><EMCLASS="emphasis">Edit your filtering rules offline</EM></P><PCLASS="para">The filter editing tools on most systems are usually pretty minimal. Also, it's not always clear how new rules will interact with existingrule sets. In particular, it's often difficult to delete rules, or toadd new rules in the middle of an existing rule set. </P><PCLASS="para">You might find it more convenient to keep your filters in a text fileon one of your <SPANCLASS="acronym">UNIX</SPAN> or <SPANCLASS="acronym">PC</SPAN>systems, so that you can edit them there with the tools you'refamiliar with, and then load the file on the filtering system as if itcontained commands you were typing at the console. Different systemssupport various ways of doing this. For example, on Cisco products,you can use <SPANCLASS="acronym">TFTP</SPAN> to obtain command files from aserver. (Be careful of where you enable a <SPANCLASS="acronym">TFTP</SPAN>server, though. See the discussion of <SPANCLASS="acronym">TFTP</SPAN> in <ACLASS="xref"HREF="ch08_01.htm"TITLE="Configuring Internet Services">Chapter 8</A> and think about using something like<SPANCLASS="acronym">TCP</SPAN> Wrapper to control what hosts can activate that<SPANCLASS="acronym">TFTP</SPAN> server). On Livingston products, there is aprogram available from Livingston called<EMCLASS="emphasis">pmcommand</EM> that downloads commands to the box. Onother products, there are other mechanisms.</P><PCLASS="para">An added advantage of keeping the filters elsewhere as a file is thatyou can keep comments in the file (stripping them out of the copy sentto the router, if necessary). Most filtering systems discard anycomments in the commands they're given; if you later go look at theactive filters on the system, you'll find that the comments aren'tretained.</P><PCLASS="para"><EMCLASS="emphasis">Reload rule sets from scratch each time</EM></P><PCLASS="para">The first thing the file should do is clear all the old rules, so thateach time you load the file you're rebuilding the rule set fromscratch; that way, you don't have to worry about how the new ruleswill interact with the old. Next, specify the rules you want toestablish, followed by whatever commands are necessary to apply thoserules to the appropriate interfaces.</P><PCLASS="para"><EMCLASS="emphasis">Always use <SPANCLASS="acronym">IP</SPAN> addresses, neverhostnames</EM></P><PCLASS="para">Always specify hosts and networks in filtering rules by<SPANCLASS="acronym">IP</SPAN> address, never by hostname or by network name(if your filtering product even supports that). If you specifyfiltering rules by hostname, your filtering could be subverted ifsomeone accidentally or intentionally corrupts the name-to-addresstranslation (e.g., by feeding false data to your<SPANCLASS="acronym">DNS</SPAN> server).</P></DIV><PCLASS="para">Here's a simple example to illustrate the differences. We chose thesethree systems because they represent somewhat different ways ofspecifying filters, not because of any particular preference for them;in general, other systems are similar to these. For example, Cisco'sproducts are similar to Livingston's products in that you create setsof rules, then apply those rules to packets going in a particulardirection through a particular interface. They are different indetails of their syntax, such as in how you specify host addresses andbitmasks.</P><PCLASS="para">Let's say that you want to allow all <SPANCLASS="acronym">IP</SPAN> trafficbetween a trusted external host (host 172.16.51.50) and hostson your internal network (Class C net 192.168.10.0). In our examples,we would show this case as follows:<TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">ACK</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Rule</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direction</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source Address</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Destination Address</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Set</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Action</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">A</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Inbound</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Trusted external host</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Internal</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Permit</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">B</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Outbound</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Internal</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Trusted external host</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Permit</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">C</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Either</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Deny</TD></TR></TBODY></TABLE></P><PCLASS="para">With <EMCLASS="emphasis">screend</EM>, you would specify:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">between host 172.16.51.50 and net 192.168.10 accept ;between host any and host any reject ;</PRE></BLOCKQUOTE><PCLASS="para">With a Telebit NetBlazer, you also have to specify which interface therule is to be applied to, and whether the rule applies to incoming oroutgoing packets on that interface. For an external interface named&quot;syn0&quot;, your rules would be:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">permit 172.16.51.50/32 192.168.10/24 syn0 indeny 0.0.0.0/0 0.0.0.0/0 syn0 inpermit 192.168.10/24 172.16.51.50/32 syn0 outdeny 0.0.0.0/0 0.0.0.0/0 syn0 out</PRE></BLOCKQUOTE><PCLASS="para">On a Livingston PortMaster or <SPANCLASS="acronym">IRX</SPAN>, you wouldspecify rules as a set and then apply the relevant set to the rightdirection on the right interface. If your external interface is named&quot;s1&quot;, your rules would look something like this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">add filter s1.inset filter s1.in 1 permit 172.16.51.50/32 192.168.10.0/24set filter s1.in 2 deny 0.0.0.0/0 0.0.0.0/0set s1 ifilter s1.inadd filter s1.outset filter s1.out 1 permit 192.168.10.0/24 172.16.51.50/32set filter s1.out 2 deny 0.0.0.0/0 0.0.0.0/0set s1 ofilter s1.out</PRE></BLOCKQUOTE><PCLASS="para">On a Cisco router, you also specify rules as sets, and apply therelevant sets to the right direction on the right interface. If yourexternal interface is named &quot;serial1&quot;, your rules wouldlook like this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">access-list 101 permit ip 172.16.51.50 0.0.0.0 192.168.10.0 0.0.0.255access-list 101 deny ip 0.0.0.0 255.255.255.255 0.0.0.0 255.255.255.255interface serial 1access-group 101 inaccess-list 102 permit ip 192.168.10.0 0.0.0.255 172.16.51.50 0.0.0.0access-list 102 deny ip 0.0.0.0 255.255.255.255 0.0.0.0 255.255.255.255interface serial 1access-group 102 out&#13;</PRE></BLOCKQUOTE><PCLASS="para"></P><PCLASS="para">For detailed information on the syntax of a particular package orproduct, consult the documentation for that package orproduct. Once you understand the syntax for the particular system youare using, you shouldn't have too much difficulty translating from ourtables to that system's syntax.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> Watch out for implicit defaults. Different filtering systems havedifferent default actions they take if a packet doesn't match any ofthe filtering rules specified. Some systems deny all such packets.Other systems make the default the opposite of the last rule; that is,if the last rule was a &quot;permit,&quot; the system default is to&quot;deny,&quot; and if the last rule was a &quot;deny,&quot; thedefault is to &quot;permit.&quot; In any case, it's a good idea toput an explicit default rule at the end of your list of packetfiltering rules, so you don't have to worry about (or even remember)which implicit default your system is going to use.</P></BLOCKQUOTE><ACLASS="indexterm"NAME="AUTOID-5265"></A><ACLASS="indexterm"NAME="AUTOID-5266"></A></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_04.htm"TITLE="6.4 What Does the Router Do with Packets?"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 6.4 What Does the Router Do with Packets?"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_06.htm"TITLE="6.6 Filtering by Address"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 6.6 Filtering by Address"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">6.4 What Does the Router Do with Packets?</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">6.6 Filtering by Address</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>