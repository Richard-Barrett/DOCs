<HTML><HEAD><TITLE>[Chapter 6] 6.6 Filtering by Address</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:17:21Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch06_01.htm"TITLE="6. Packet Filtering"><LINKREL="prev"HREF="ch06_05.htm"TITLE="6.5 Conventions for Packet Filtering Rules"><LINKREL="next"HREF="ch06_07.htm"TITLE="6.7 Filtering by Service"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_05.htm"TITLE="6.5 Conventions for Packet Filtering Rules"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 6.5 Conventions for Packet Filtering Rules"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 6<BR>Packet Filtering</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_07.htm"TITLE="6.7 Filtering by Service"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 6.7 Filtering by Service"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="FIRE-06-S1-6">6.6 Filtering by Address</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH06ADDFILT"></A><ACLASS="indexterm"NAME="CH06PFADD"></A>The simplest, although not the most common, form of packet filtering isfiltering by address. Filtering in this way lets you restrict the flowof packets based on the source and/or destination addresses of thepackets, without having to consider what protocols are involved. Suchfiltering can be used to allow certain external hosts to talk to certaininternal hosts, for example, or to prevent an attacker from injectingforged packets (packets handcrafted so they appear to come fromsomewhere other than their true source) into your network.</P><PCLASS="para">For example, let's say that you want to block incoming packets withforged source addresses; you would specify this rule: </P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Rule</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direction</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source Address</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Destination Address</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Action</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">A</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Inbound</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Internal</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Deny</TD></TR></TBODY></TABLE><PCLASS="para">Note that Direction is relative to your internalnetwork. In the router between your internal network and theInternet, you could apply an inbound rule either toincoming packets on the Internet interface or to outgoing packets onthe internal interface; either way, you will achieve the same resultsfor the protected hosts. The difference is in what the router itselfsees. If you filter outgoing packets, the router is not protectingitself.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-06-S2-15">6.6.1 Risks of Filtering by SourceAddress</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="CH06SOURCE"></A>It's not necessarily safe to trust source addresses because sourceaddresses can be forged. Unless you use some kind of cryptographicauthentication between you and the host you want to talk to, you won'tknow if you're really talking to that host, or to some other machinethat is pretending to be that host. The filters we've discussed abovewill help you if an external host is claiming to be an internal host,but they won't do anything about an external host claiming to be adifferent external host.</P><PCLASS="para">There are two kinds of attacks that rely on forgery: <EMCLASS="emphasis">sourceaddress</EM> and <EMCLASS="emphasis">man in the middle</EM>.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5304"></A><ACLASS="indexterm"NAME="AUTOID-5307"></A>In a basic <EMCLASS="emphasis">source address</EM> forgery attack(shown in <ACLASS="xref"HREF="ch06_01.htm#FIRE-06-FIG-1"TITLE="Source address forgery">Figure 6.1</A>), anattacker sends you packets that claim to be from someone you trust insome way, hoping to get you to take some action based on that trust,without expecting to get any packets back from you. If the attackerdoesn't care about getting packets back from you, he doesn't need to beon the path between you and whoever he is pretending to be; he can beanywhere. </P><PCLASS="para">In fact, your responses will go to whomever the attacker ispretending to be, not to the attacker. However,if the attacker can predict your responses, he doesn'tneed to see them. Many (if not most) protocolsare predictable enough for a skilled attacker to be successful atthis. There are plenty of attacks that can be carried out without theattacker needing to see the results directly. For example, suppose anattacker issues a command to your system that causes it to email yourpassword file to him; if your system is going to send the attacker thepassword file in the mail, there is no need for him to see it duringthe attack itself.</P><PCLASS="para">In many circumstances&nbsp;- particularly those involving<SPANCLASS="acronym">TCP</SPAN> connections&nbsp;- the real machine (that theattacker is pretending to be) will react to your packets (packets thatare attempting to carry on a conversation it knows nothing about) bytrying to reset the bogus connection. Obviously, the attacker doesn'twant this to happen. He has to ensure the attack completes before thereal machine gets the packets you're sending, or before you get thereset packets from the real machine. There are a number of ways toensure this&nbsp;- for example:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Carrying out the attack while the real machine is down</P></LI><LICLASS="listitem"><PCLASS="para">Crashing the real machine so the attack can be carried out</P></LI><LICLASS="listitem"><PCLASS="para">Flooding the real machine while the attack is carried out</P></LI><LICLASS="listitem"><PCLASS="para">Confusing the routing between the real machine and the target </P></LI><LICLASS="listitem"><PCLASS="para">Using an attack where only the first response packet is required,so that the reset doesn't matter</P></LI></UL><PCLASS="para">Attacks of this kind used to be considered a theoretical problem withlittle real-world effect, but they are now common enough to beconsidered a serious threat. (In general, it's not a good idea todismiss theoretical attacks completely, because they eventually becomeactual attacks. This kind of attack was known as a theoreticalpossibility for many years before it actually occurred, and yet manypeople didn't bother to protect against it. )</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5328"></A><ACLASS="indexterm"NAME="AUTOID-5330"></A>The <EMCLASS="emphasis">man in the middle</EM> forgery attack depends onbeing able to carry out a complete conversation while claiming to bethe trusted host. In order to do this, the attacking machine needs tobe able to not only send you packets, but also intercept the packetsyou reply with. To do this, the attacker needs to do one of thefollowing:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Insinuate his attacking machine into the path between you and the realmachine. This is easiest to do near the ends of the path, and mostdifficult to do somewhere in the middle, because given the nature ofmodern <SPANCLASS="acronym">IP</SPAN> networks, the path through &quot;themiddle&quot; can change at any second.</P></LI><LICLASS="listitem"><PCLASS="para">Alter the path between the machines so it leads through hisattacking machine. This may be very easy or very difficult, dependingon the network topology and routing system used by your network, theremote network, and the Internet service providers between thosenetworks.</P></LI></UL><PCLASS="para">Although this kind of attack is called&quot;man in the middle,&quot; it's relatively rare for it toactually be carried out in the middle, external to the sites at eachend, because nobody but a network provider is in a position to carryit out in that way, and network providers are rarely compromised tothat extent. (People who compromise network providers tend to beworking on quantity. Packet sniffing will give them many hostsrapidly, but man in the middle attacks give them only one site at atime.) These attacks tend to be problems only if one of the involvedsites has hostile users who have physical access to the network (forexample, this might be the case if one site is a university.)</P><PCLASS="para">So, who <EMCLASS="emphasis">can</EM> you trust? At the extreme, nobody,unless you trust the machines involved at both endsand the path between them. If you trust themachines but not the path, you can use encryption to give you a secureconnection over an insecure path. Unfortunately, as we discuss in<ACLASS="xref"HREF="ch10_01.htm"TITLE="Authentication and Inbound Services">Chapter 10, <CITECLASS="chapter">Authentication and InboundServices</CITE></A>, thereare no widespread and commonly available tools to do that yet, buta number of sites are experimenting with ad hoc solutions, andcommercial solutions are beginning to appear. <ACLASS="indexterm"NAME="AUTOID-5344"></A><ACLASS="indexterm"NAME="AUTOID-5345"></A><ACLASS="indexterm"NAME="AUTOID-5346"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_05.htm"TITLE="6.5 Conventions for Packet Filtering Rules"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 6.5 Conventions for Packet Filtering Rules"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_07.htm"TITLE="6.7 Filtering by Service"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 6.7 Filtering by Service"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">6.5 Conventions for Packet Filtering Rules</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">6.7 Filtering by Service</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>