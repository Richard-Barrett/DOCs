<HTML><HEAD><TITLE>[Chapter 7] Proxy Systems</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:18:49Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part02.htm"TITLE="II. Building Firewalls"><LINKREL="prev"HREF="ch06_10.htm"TITLE="6.10 Putting It All Together"><LINKREL="next"HREF="ch07_02.htm"TITLE="7.2 How Proxying Works"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_10.htm"TITLE="6.10 Putting It All Together"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 6.10 Putting It All Together"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 7</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 How Proxying Works"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.2 How Proxying Works"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="FIRE-07-CHP">7. Proxy Systems</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="SECT1"HREF="#FIRE-07-S1-1"TITLE="7.1 Why Proxying?">Why Proxying?</A><BR><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 How Proxying Works">How Proxying Works</A><BR><ACLASS="SECT1"HREF="ch07_03.htm"TITLE="7.3 Proxy Server Terminology ">Proxy Server Terminology </A><BR><ACLASS="SECT1"HREF="ch07_04.htm"TITLE="7.4 Using Proxying with Internet Services">Using Proxying with InternetServices</A><BR><ACLASS="SECT1"HREF="ch07_05.htm"TITLE="7.5 Proxying Without a Proxy Server">Proxying Without a Proxy Server</A><BR><ACLASS="SECT1"HREF="ch07_06.htm"TITLE="7.6 Using SOCKS for Proxying">Using <SPANCLASS="acronym">SOCKS</SPAN> forProxying</A><BR><ACLASS="SECT1"HREF="ch07_07.htm"TITLE="7.7 Using the TIS Internet Firewall Toolkit for Proxying">Using the <SPANCLASS="acronym">TIS</SPAN>Internet Firewall Toolkit for Proxying</A><BR><ACLASS="SECT1"HREF="ch07_08.htm"TITLE="7.8 What If You Can't Proxy?">What If You Can't Proxy?</A></P><P></P></DIV><PCLASS="para"><ACLASS="indexterm"NAME="CH07PS"></A><ACLASS="indexterm"NAME="AUTOID-7076"></A>Proxying provides Internet access to a single host, or a verysmall number of hosts, while appearing to provide access to all of yourhosts. The hosts that have access act as proxies for the machines thatdon't, doing what these machines want done. </P><PCLASS="para">A proxy server for a particular protocol or set of protocols runs on adual-homed host or a bastion host: some host that the user can talkto, which can, in turn, talk to the outside world. The user's clientprogram talks to this proxy server instead of directly to the&quot;real&quot; server out on the Internet. The proxy serverevaluates requests from the client and decides which to pass on andwhich to disregard. If a request is approved, the proxy server talksto the real server on behalf of the client (thus the term&quot;proxy&quot;), and proceeds to relay requests from the client tothe real server, and to relay the real server's answers back to theclient. </P><PCLASS="para">As far as the user is concerned, talking to the proxy server is justlike talking directly to the real server. As far as the real server isconcerned, it's talking to a user on the host that is running the proxyserver; it doesn't know that the user is really somewhere else.</P><PCLASS="para">Proxying doesn't require any special hardware, although it does requirespecial software for most services.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> <ACLASS="indexterm"NAME="AUTOID-7084"></A>Proxy systems are effective only when they are used in conjunctionwith some method of restricting <SPANCLASS="acronym">IP</SPAN>-level trafficbetween the clients and the real servers, such as a screening routeror a dual-homed host that doesn't route packets. If there is<SPANCLASS="acronym">IP</SPAN>-level connectivity between the clients and thereal servers, the clients can bypass the proxy system (and presumablyso can someone from the outside).</P></BLOCKQUOTE><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="FIRE-07-S1-1">7.1 Why Proxying?</A></H2><PCLASS="para">There's no point in connecting to the Internet if your users can'taccess it. On the other hand, there's no safety in connecting to theInternet if there's free access between it and every host at your site.Some compromise has to be applied. </P><PCLASS="para">The most obvious compromise is to provide a single host withInternet access for all your users. However, this isn't a satisfactory solution because these hosts aren't transparent to users. Users who want to access networkservices can't do so directly. They have to log in tothe dual-homed host, do all their work from there, and then somehowtransfer the results of their work back to their own workstations. Atbest, this multiple-step process annoys users by forcing them to domultiple transfers and work without the customizations they'reaccustomed to.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7094"></A><ACLASS="indexterm"NAME="AUTOID-7097"></A>The problem is worse at sites with multiple operating systems; if yournative system is a Macintosh, and the dual-homed host is a<SPANCLASS="acronym">UNIX</SPAN> system, the <SPANCLASS="acronym">UNIX</SPAN> systemwill probably be completely foreign to you. You'll be limited tousing whatever tools are available on the dual-homed host, and thesetools may be completely unlike (and may seem inferior to) the toolsyou use on your own system.</P><PCLASS="para">Dual-homed hosts configured without proxies therefore tend toannoy their users and significantly reduce the benefit people get fromthe Internet connection. Worse, they usually don't provide adequate security; it's almost impossible to adequately secure amachine with many users, particularly when those users areexplicitly trying to get to the external universe. You can'teffectively limit the available tools, because your users canalways transfer tools from internal machines that are the same type.For example, on a dual-homed host you can't guarantee that all filetransfers will be logged because people can use their own file transferagents that don't do logging.</P><PCLASS="para">Proxy systems avoid user frustration and the insecurities of adual-homed host. They deal with user frustration by automating theinteraction with the dual-homed host. Instead of requiring users todeal directly with the dual-homed host, proxy systems allow allinteraction to take place behind the scenes. The user has the illusionhe is dealing directly (or almost directly) with the server on theInternet that he really wants to access, with a minimum of directinteraction with the dual-homed host. <ACLASS="xref"HREF="ch07_01.htm#FIRE-07-FIG-1"TITLE="Proxies&nbsp;- reality and illusion">Figure 7.1</A>illustrates the difference between reality and illusion with proxysystems.</P><H4CLASS="figure"><ACLASS="title"NAME="FIRE-07-FIG-1">Figure 7.1: Proxies&nbsp;- reality and illusion</A></H4><IMGCLASS="graphic"SRC="figs/fire0701.gif"ALT="Figure 7.1"><PCLASS="para">Proxy systems deal with the insecurity problems by avoiding user logins on thedual-homed host and by forcing connections through controlledsoftware. Because the proxy software works without requiring userlogins, the host it runs on is safe from the randomness of having multiplelogins. It's also impossible for anybody to installuncontrolled software to reach the Internet; the proxy acts as a controlpoint.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-07-S2-1">7.1.1 Advantages of Proxying</A></H3><PCLASS="para">There are a number of advantages to using proxy services.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="AUTOID-7112">7.1.1.1 Proxy services allow users to access Internet services`directly'</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7115"></A>With the dual-homed host approach, a user needs to log into thehost before using any Internet services. This is often inconvenient,and some users become so frustrated that they look for ways around thefirewall. With proxy services, users think they're interactingdirectly with Internet services.</P><PCLASS="para">Of course, there's more going on behind the scenes but it's usuallytransparent to users. While proxy services allow users to accessInternet services from their own systems, they do so without allowingpackets to pass directly between the user's system and the Internet. The path is indirect, either through a dual-homed host, or through abastion host and screening router combination.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="AUTOID-7119">7.1.1.2 Proxy services are good at logging</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7122"></A>Because proxy servers understand the underlying protocol, they allowlogging to be performed in a particularly effective way. For example,instead of logging all of the data transferred, an <SPANCLASS="acronym">FTP</SPAN> proxy serverlogs only the commands issued and the server responses received;this results in a much smaller and more useful log.</P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-07-S2-2">7.1.2 Disadvantages of Proxying</A></H3><PCLASS="para">There are also some disadvantages to using proxy services.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="AUTOID-7129">7.1.2.1 Proxy services lag behind nonproxied services</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7132"></A><ACLASS="indexterm"NAME="AUTOID-7135"></A><ACLASS="indexterm"NAME="AUTOID-7139"></A><ACLASS="indexterm"NAME="AUTOID-7142"></A>Although proxy software is widely available for the older and simplerservices like <SPANCLASS="acronym">FTP</SPAN> and Telnet, proven software for newer or less widelyused services is harder to find. There's usually a distinct lagbetween the introduction of a service and the availability of proxyingservers for it; the length of the lag depends primarily on how well theservice is designed for proxying. This makes it difficult for a site tooffer new services immediately as they become available. Until suitableproxy software is available, a system that needs new services may haveto be placed outside the firewall, opening up potential security holes.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="AUTOID-7146">7.1.2.2 Proxy services may require different servers for eachservice</A></H4><PCLASS="para">You may need a different proxy server for each protocol, because theproxy server has to understand the protocol in order to determine whatto allow and disallow, and in order to masquerade as a client to thereal server and as the real server to the proxy client. Collecting,installing, and configuring all these various servers can be a lot ofwork.</P><PCLASS="para">Products and packages differ greatly in the ease with which they can beconfigured, but making things easier in one place can make itharder in others. For example, servers that are particularly easy toconfigure are usually limited in flexibility; they're easy to configurebecause they make certain assumptions about how they're going to beused, which may or may not be correct or appropriate for your site.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="AUTOID-7150">7.1.2.3 Proxy services usually require modifications to clients,procedures, or both</A></H4><PCLASS="para">Except for a few services designed for proxying, proxy servers requiremodifications to clients and/or procedures. Either kind of modificationhas drawbacks; people can't always use the readily available tools withtheir normal instructions. </P><PCLASS="para">Because of these modifications, proxied applications don't workas well as nonproxied applications. They tend to bendprotocol specifications, and some clients and servers are less flexiblethan others. </P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="AUTOID-7154">7.1.2.4 Proxy services aren't workable for some services</A></H4><PCLASS="para">&#13;Proxying relies on the ability to insert the proxy serverbetween the client and the real server; that requires relativelystraightforward interaction between the two. A service like<EMCLASS="emphasis">talk</EM> that has complicated and messy interactionsmay never be possible to proxy (see the discussion of<EMCLASS="emphasis">talk</EM> in <ACLASS="xref"HREF="ch08_01.htm"TITLE="Configuring Internet Services">Chapter 8, <CITECLASS="chapter">Configuring Internet Services</CITE></A>).</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="AUTOID-7160">7.1.2.5 Proxy services don't protect you from all protocolweaknesses</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7163"></A>As a security solution, proxying relies on the ability to determinewhich operations in a protocol are safe. Not all protocols provideeasy ways to do this. The X Window System protocol, for example,provides a large number of unsafe operations, and it's difficult tomake it work while removing the unsafeoperations. <SPANCLASS="acronym">HTTP</SPAN> is designed to operate effectivelywith proxy servers, but it's also designed to be readily extensible,and it achieves that goal by passing data that's going to beexecuted. It's impossible for a proxy server to protect you from thedata; it would have to understand the data being passed and determinewhether it was dangerous or not.</P></DIV></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_10.htm"TITLE="6.10 Putting It All Together"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 6.10 Putting It All Together"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 How Proxying Works"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.2 How Proxying Works"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">6.10 Putting It All Together</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">7.2 How Proxying Works</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>