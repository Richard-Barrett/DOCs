<HTML><HEAD><TITLE>[Chapter 7] 7.2 How Proxying Works</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:18:53Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch07_01.htm"TITLE="7. Proxy Systems"><LINKREL="prev"HREF="ch07_01.htm"TITLE="7.1 Why Proxying?"><LINKREL="next"HREF="ch07_03.htm"TITLE="7.3 Proxy Server Terminology "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_01.htm"TITLE="7.1 Why Proxying?"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.1 Why Proxying?"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 7<BR>Proxy Systems</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_03.htm"TITLE="7.3 Proxy Server Terminology "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.3 Proxy Server Terminology "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="FIRE-07-S1-2">7.2 How Proxying Works</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH07SOFTPROX"></A><ACLASS="indexterm"NAME="CH07PSSOFT"></A>The details of how proxying works differ from service to service. Someservices provide proxying easily or automatically; for those services,you set up proxying by making configuration changes to normal servers.For most services, however, proxying requires appropriate proxy serversoftware on the server side. On the client side, it needs one of thefollowing:</P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">Custom client software</EM></DT><DDCLASS="listitem"><PCLASS="para">With this approach, the software must know how to contact the proxyserver instead of the real server when a user makes a request (forexample, for <SPANCLASS="acronym">FTP</SPAN> or Telnet), and how to tell theproxy server what real server to connect.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Custom user procedures </EM></DT><DDCLASS="listitem"><PCLASS="para">With this approach, the user uses standard client software to talk tothe proxy server and tells it to connect to the real server, instead ofto the real server directly.</P></DD></DL><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-07-S2-3">7.2.1 Using Custom Client Software forProxying</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7191"></A><ACLASS="indexterm"NAME="AUTOID-7194"></A>The first approach is to use custom client software for proxying. Thereare a few problems associated with this approach.</P><PCLASS="para">Appropriate custom client software is often available only for certainplatforms. If it's not available for one of your platforms, your usersare pretty much out of luck. For example, the <EMCLASS="emphasis">Igateway</EM>package from Sun (written by Jim Thompson) is a proxy package for<SPANCLASS="acronym">FTP</SPAN> and <SPANCLASS="acronym">TELNET</SPAN>, but you can onlyuse it on Sun machines because it provides only precompiled Sunbinaries. If you're going to use proxy software, you obviously need tochoose software that's available for the needed platforms. </P><PCLASS="para">Even if software is available for your platforms, it may not besoftware your users want. For example, on the Macintosh, there aredozens of <SPANCLASS="acronym">FTP</SPAN> client programs. Some of them havereally impressive graphical user interfaces. Others have other usefulfeatures; for example, <EMCLASS="emphasis">anarchie</EM> is a program thatcombines an Archie client and an <SPANCLASS="acronym">FTP</SPAN> client into asingle program, so that you can search for a file with Archie and thenretrieve it with <SPANCLASS="acronym">FTP</SPAN>, all with a single consistentuser interface. You're out of luck if the particular client you wantto use, for whatever reason, doesn't support your particular proxyserver mechanism. In some cases, you may be able to modify clients tosupport your proxy server, but doing so requires that you have thesource code for the client, as well as the tools and the ability torecompile it. Few client programs come with support for any form ofproxying.</P><PCLASS="para">The happy exception to this rule is <SPANCLASS="acronym">WWW</SPAN> clientprograms, like Mosaic. Many of these programs support proxies ofvarious sorts (typically <SPANCLASS="acronym">SOCKS</SPAN> and the<SPANCLASS="acronym">CERN</SPAN> <SPANCLASS="acronym">HTTP</SPAN> daemon). Most ofthese programs are fairly new, and were thus written after firewallsand proxy systems had become common on the Internet; recognizing theenvironment they would be working in, their authors chose to supportproxying by design, right from the start.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7212"></A>Using client changes for proxying does not make proxying completelytransparent to users. Most sites will use the unchanged clients forinternal connections and the modified ones only to make externalconnections; users need to remember to use the modified program inorder to make external connections. Following procedures they'vebecome accustomed to using elsewhere, or procedures that are writtenin books, may leave them mystified at apparently intermittent resultsas internal connections succeed and external ones fail. (Using themodified clients internally will work, but it introduces unneccessarydependencies on the proxy server, which is why most sites avoid it.)</P><PCLASS="para">In addition to having to choose the right program, users may findthemselves doing extra configuration, because the proxy client needsto know how to contact the proxy server. This shouldn't represent amajor burden, but it provides an extra place for things to go wrong.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-07-S2-4">7.2.2 Using Custom User Procedures forProxying</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7219"></A><ACLASS="indexterm"NAME="AUTOID-7222"></A>With the custom procedure approach, the proxy servers are designed towork with standard client software; however, they require the users ofthe software to follow custom procedures. The user tells the client toconnect to the proxy server and then tells the proxy server which host toconnect to. Because few protocols are designed to pass this kind ofinformation, the user needs to remember not only what the name of theproxy server is, but also what special means are used to pass the nameof the other host.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7225"></A><ACLASS="indexterm"NAME="AUTOID-7228"></A>How does this work? You need to teach your users specific proceduresto follow for each protocol. Let's look at <SPANCLASS="acronym">FTP</SPAN>.Suppose a user wants to retrieve a file from an anonymous<SPANCLASS="acronym">FTP</SPAN> server (e.g.,<EMCLASS="emphasis">ftp.greatcircle.com</EM>). Here's what the user does:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">Using any <SPANCLASS="acronym">FTP</SPAN> client, the user connects to yourproxy server (which is probably running on the bastion host&nbsp;- thegateway to the Internet) instead of directly to the anonymous<SPANCLASS="acronym">FTP</SPAN> server.</P></LI><LICLASS="listitem"><PCLASS="para">At the user name prompt, in addition to specifying the name he wantsto use, the user also specifies the name of the real server he wantsto connect to. If he wants to access the anonymous<SPANCLASS="acronym">FTP</SPAN> server on<EMCLASS="emphasis">ftp.greatcircle.com</EM>, for example, then instead ofsimply typing &quot;anonymous&quot; at the prompt generated by the proxy server,he'll type &quot;anonymous@ftp.greatcircle.com&quot;.</P></LI></OL><PCLASS="para">For a more complete example, see the discussion of the<SPANCLASS="acronym">TIS</SPAN> Internet Firewall Toolkit later in this section.</P><PCLASS="para">Just as using custom software requires some modification of userprocedures, using custom procedures places limitations on which clientsyou can use. Some clients try to do anonymous <SPANCLASS="acronym">FTP</SPAN>automatically; they won't know how to go through the proxy server. Some clients may interfere in simpler ways, e.g., by providing a graphical user interface that doesn't allow you type a user name long enough to hold the username and the hostname. </P><PCLASS="para">The main problem with using custom procedures, however, is that youhave to teach them to your users. If you have a small user base andone that is technically adept, this may not be a problem. However, ifyou have 10,000 users spread across four continents, it's going to bea problem. On the one side, you have arrayed hundreds of books,thousands of magazine articles, and tens of thousands of Usenet newspostings, not to mention whatever previous training or experience theusers might have had, all of which attempt to teach users the standardway to use basic Internet services like <SPANCLASS="acronym">FTP</SPAN>. Onthe other side is your tiny voice, telling them how to use a procedurethat is at odds with all the other information they're getting. Ontop of that, your users will have to remember the name of your gatewayand the details of how to use it. In any organization of a reasonablesize, this approach can't be relied upon.<ACLASS="indexterm"NAME="AUTOID-7249"></A><ACLASS="indexterm"NAME="AUTOID-7250"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_01.htm"TITLE="7.1 Why Proxying?"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.1 Why Proxying?"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_03.htm"TITLE="7.3 Proxy Server Terminology "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.3 Proxy Server Terminology "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">7.1 Why Proxying?</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">7.3 Proxy Server Terminology </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>