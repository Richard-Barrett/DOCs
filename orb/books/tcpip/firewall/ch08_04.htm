<HTML><HEAD><TITLE>[Chapter 8] 8.4 Remote Command Execution</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:22:56Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch08_01.htm"TITLE="8. Configuring Internet Services"><LINKREL="prev"HREF="ch08_03.htm"TITLE="8.3 Terminal Access (Telnet)"><LINKREL="next"HREF="ch08_05.htm"TITLE="8.5 Network News Transfer Protocol (NNTP)"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_03.htm"TITLE="8.3 Terminal Access (Telnet)"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.3 Terminal Access (Telnet)"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8<BR>Configuring Internet Services</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_05.htm"TITLE="8.5 Network News Transfer Protocol (NNTP)"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.5 Network News Transfer Protocol (NNTP)"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="FIRE-08-S1-4">8.4 Remote Command Execution</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH08REMOTE"></A>A variety of protocols exist primarily to allow users to executecommands on remote systems. This section describes the<SPANCLASS="acronym">BSD</SPAN> &quot;r&quot; commands,<EMCLASS="emphasis">rexec</EM> and <EMCLASS="emphasis">rex</EM>.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-11">8.4.1 <SPANCLASS="acronym">BSD</SPAN>`r' Commands</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="CH08CONFR"></A><ACLASS="indexterm"NAME="CH08R"></A><ACLASS="indexterm"NAME="CH08BSD"></A>The <SPANCLASS="acronym">BSD</SPAN> &quot;r&quot; commands(<EMCLASS="emphasis">rsh</EM>, <EMCLASS="emphasis">rlogin</EM>,<EMCLASS="emphasis">rcp</EM>, <EMCLASS="emphasis">rdump</EM>,<EMCLASS="emphasis">rrestore</EM>, and <EMCLASS="emphasis">rdist</EM>) aredesigned to provide convenient remote access (access withoutpasswords) to services such as remote command execution(<EMCLASS="emphasis">rsh</EM>), remote login(<EMCLASS="emphasis">rlogin</EM>), and remote file copying(<EMCLASS="emphasis">rcp</EM> and <EMCLASS="emphasis">rdist</EM>).</P><PCLASS="para">These programs are extremely useful, but as we discussbelow, they are safe to use only in an environment in which all of themachines are more or less trusted to play by the rules. While it maybe appropriate to use these services within a <SPANCLASS="acronym">LAN</SPAN>,it's almost never appropriate to use them across the Internet. It'sjust too easy for someone to convince these services that they're OKand that the service should perform what's requested.</P><PCLASS="para">Proxying can be used to allow some of these commands safely,particularly outbound. </P><PCLASS="para">The difficulty with these commands is that they use address-basedauthentication. The server looks at the source address of the requestand decides whether or not it trusts the remote host to tell it whothe user is (this is controlled by the<EMCLASS="emphasis">/etc/hosts.equiv</EM> file on <SPANCLASS="acronym">UNIX</SPAN>systems).</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10005"></A>If the host is not in <EMCLASS="emphasis">/etc/hosts.equiv,</EM> it canstill be granted access if it is in the <EMCLASS="emphasis">.rhosts</EM>file in the home directory of the user who is asking for the service.(In fact, if the requester is running as root, only<EMCLASS="emphasis">/.rhosts</EM> is consulted; <EMCLASS="emphasis">/etc/hosts.equiv</EM> applies only to normal users.) The security can be furtherweakened by users adding to their <EMCLASS="emphasis">.rhosts</EM> files;these files specify which additional remote machines and users shouldbe trusted. In some implementations, it is possible to disablechecking of <EMCLASS="emphasis">.rhosts</EM> files with command-linearguments to the servers.</P><PCLASS="para">If either of the following is true:<ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">The account the user is coming from, on the host he is coming from,is listed in the <EMCLASS="emphasis">.rhosts</EM> file for the account heis trying to access on the server.</P></LI><LICLASS="listitem"><PCLASS="para">The account name is the same onboth ends and the hostname is listed in <EMCLASS="emphasis">.rhosts</EM> or <EMCLASS="emphasis">/etc/hosts.equiv</EM>.</P></LI></UL>then the authorization for theaccount he is trying to access is applied. That is, if the account isverified on the server, the user is authorized.</P><PCLASS="para">An attacker who convinces one of these servers that he is comingfrom a &quot;trusted&quot; machine can essentially get complete andunrestricted access to your system. He can convince the server byimpersonating a trusted machine and using its <SPANCLASS="acronym">IP</SPAN>address, by confusing <SPANCLASS="acronym">DNS</SPAN> so that<SPANCLASS="acronym">DNS</SPAN> thinks that the attacker's<SPANCLASS="acronym">IP</SPAN> address maps to a trusted machine's name, or byany of a number of other methods.</P><PCLASS="para">If the trusted host check described above fails (that is, if the useris not coming from a trusted host), most of these services simply denythe client's request and disconnect. The <EMCLASS="emphasis">rlogind</EM>server, however, will prompt the client for a password if the trustedhost check fails. The password entered is sent in the clear over thenet, just as with Telnet, so you have to worry about attackerscapturing passwords from <EMCLASS="emphasis">rlogin</EM> sessions, as they can from Telnet sessions. See <ACLASS="xref"HREF="ch10_01.htm"TITLE="Authentication and Inbound Services">Chapter 10</A> for adiscussion of ways to address password sniffing attacks.</P><PCLASS="para">On some systems, it is possible to disable the trusted host checkswith a command line argument to the servers; even if your serverdoesn't provide a convenient switch to disable the checks, if you have(or can get) source code for the servers, it's usually a relativelysimple fix. However, without the trusted host mechanism, the<EMCLASS="emphasis">rshd</EM> server is completely pointless, because itprovides no way to prompt for a password or anything like that if thetrusted host check fails. The <EMCLASS="emphasis">rlogind</EM> server isstill somewhat useful without the trusted host check, because it canask for a password, but it's not much more useful than Telnet.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-26">8.4.1.1 Packet filtering characteristics ofthe <SPANCLASS="acronym">BSD</SPAN> `r' commands</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10038"></A>The &quot;r&quot; commands are <SPANCLASS="acronym">TCP</SPAN>-based services. For theserver, they use well-known port 513 (<EMCLASS="emphasis">rlogin</EM>) or514 (<EMCLASS="emphasis">rsh</EM>, <EMCLASS="emphasis">rcp</EM>,<EMCLASS="emphasis">rdump</EM>, <EMCLASS="emphasis">rrestore</EM>, and<EMCLASS="emphasis">rdist</EM>; these are just different clientsfor the same server). They are somewhat unusual in that they userandom ports <EMCLASS="emphasis">below</EM> 1024 for the client end.</P><PCLASS="para">Using ports below 1024 for the client end is an attempt at a securityscheme that allows password-less access to these services as long asthe requests come from a trusted host and user, asdiscussed above. The idea is that, if the request comes from a portbelow 1024 on the client end, then the request must be<SPANCLASS="acronym">OK</SPAN> with root on the client machine;if it were not, the client never could have gotten the port below 1024to use for the request.</P><PCLASS="para">Further, some of the clients of the server on port 514(<EMCLASS="emphasis">rsh</EM>, for example) use a second<SPANCLASS="acronym">TCP</SPAN> connection for error reporting. This second<SPANCLASS="acronym">TCP</SPAN> connection is opened from a random port below1024 on the server to a random port below 1024 on the client; that is,an outgoing <EMCLASS="emphasis">rsh</EM> command involves an incoming<SPANCLASS="acronym">TCP</SPAN> connection for the error channel.</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direc-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Pro-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">ACK</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tion</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tocol</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Set</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Notes</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">513</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[14]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming <EMCLASS="emphasis">rlogin</EM>, client to server</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">513</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming <EMCLASS="emphasis">rlogin</EM>, server to client</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">513</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[14]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing <EMCLASS="emphasis">rlogin</EM>, client to server</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">513</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing <EMCLASS="emphasis">rlogin</EM>, server to client</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">514</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[14]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming <EMCLASS="emphasis">rsh/rcp/rdump/rrestore/rdist</EM>, client to server</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">514</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming <EMCLASS="emphasis">rsh/rcp/rdump/rrestore/rdist</EM>, server to client</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming <EMCLASS="emphasis">rsh</EM>, error channel, client to server</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[14]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming <EMCLASS="emphasis">rsh</EM>, error channel, server to client</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">514</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[14]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing <EMCLASS="emphasis">rsh/rcp/rdump/rrestore/rdist</EM>, client to server</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">514</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing <EMCLASS="emphasis">rsh/rcp/rdump/rrestore/rdist</EM>, server to client</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing <EMCLASS="emphasis">rsh</EM>, error channel, client to server</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[14]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing <EMCLASS="emphasis">rsh</EM>, error channel, server to client</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[14] <SPANCLASS="acronym">ACK</SPAN> is not set on the first packet of this type(establishing connection) but will be set on the rest.</P></BLOCKQUOTE></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-27">8.4.1.2 Proxying characteristics of the<SPANCLASS="acronym">BSD</SPAN> `r' commands</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10328"></A>The only one of these commands that's widely used across the Internetis <EMCLASS="emphasis">rlogin</EM>. The <SPANCLASS="acronym">TIS FWTK</SPAN>provides a proxy <EMCLASS="emphasis">rlogin</EM> server that uses modifieduser procedures to provide outbound <EMCLASS="emphasis">rlogin.</EM></P><PCLASS="para">The other commands rely completely on address-based authentication,and don't allow the user to specify a password at all. They're used soseldom across the Internet that proxies for them are not widelyavailable. All of them allow the user to specify enough data that'spassed to the server that it would be possible to writemodified-procedures proxies for them. Modifying the <EMCLASS="emphasis">rcmd()</EM> and related functions in the standard <SPANCLASS="acronym">UNIX</SPAN> libraryallow you to create clients that use a generic proxy server.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-28">8.4.1.3 Summary of the <SPANCLASS="acronym">BSD</SPAN>`r' command recommendations</A></H4><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Don't allow any of the &quot;r&quot; commands across your firewallexcept outbound by proxy; they're unsafe. Use alternative protocolssuch as Telnet, <SPANCLASS="acronym">FTP</SPAN>, and so on that can be mademore secure.</P></LI><LICLASS="listitem"><PCLASS="para">There is no way to safely provide outgoing <EMCLASS="emphasis">rsh</EM>service, because to do so you would have to allow incoming<SPANCLASS="acronym">TCP</SPAN> connections to random ports below 1024 for theerror channels.</P></LI><LICLASS="listitem"><PCLASS="para"> If you absolutely have to allow them, make sure thatthe trusted host mechanisms are strictly controlled (preferably bydisabling that code in the server, which may require modifying thesource code). </P></LI><LICLASS="listitem"><PCLASS="para">Beware disclosure of reusable passwords when using<EMCLASS="emphasis">rlogin</EM>, just as when using Telnet.</P></LI></UL><ACLASS="indexterm"NAME="AUTOID-10355"></A><ACLASS="indexterm"NAME="AUTOID-10356"></A><ACLASS="indexterm"NAME="AUTOID-10357"></A></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-12">8.4.2 rexec</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10361"></A><EMCLASS="emphasis">rexec</EM> is a widely run but rarely usedserver. It's rarely used because it has few standard clients; the onlyutility commonly shipped with <SPANCLASS="acronym">UNIX</SPAN> systems thatwe're aware of that uses <EMCLASS="emphasis">rexec</EM> is the<EMCLASS="emphasis">inst</EM> software installation tool that's part ofthe Silicon Graphics <SPANCLASS="acronym">IRIX</SPAN> operating system, forremote software installations. It is unclear to us why it is widelyrun, but almost every <SPANCLASS="acronym">UNIX</SPAN> system ships with<EMCLASS="emphasis">rexecd</EM> enabled in<EMCLASS="emphasis">/etc/inetd.conf</EM>, apparently just in case somebodyshould be moved to write a local client for it.</P><PCLASS="para"><EMCLASS="emphasis">rexec</EM> is usually lumped in with the<SPANCLASS="acronym">BSD</SPAN> &quot;r&quot; commands, but is actuallyslightly more secure than the others. Rather than providingsource-address authentication, it always requires the user to providea user name and password. Unfortunately, it passes these across thenetwork in the clear, so it has no security advantage over Telnet, forexample.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-29">8.4.2.1 Packet filtering characteristics ofrexec</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10377"></A><EMCLASS="emphasis">rexec</EM> is a <SPANCLASS="acronym">TCP</SPAN>-basedservice. The server uses port 512. The client uses a random port below1024 (see the previous explanation for the <SPANCLASS="acronym">BSD</SPAN>&quot;r&quot; commands).&#13;</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direc-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Pro-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">ACK</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tion</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tocol</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Set</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Notes</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">512</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[15]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming <EMCLASS="emphasis">rexec</EM>, client to server</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">512</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming <EMCLASS="emphasis">rexec</EM>, server to client</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">512</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[15]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing <EMCLASS="emphasis">rexec</EM>, client to server</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">512</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing <EMCLASS="emphasis">rexec</EM>, server to client</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[15] <SPANCLASS="acronym">ACK</SPAN> is not set on the first packet of this type (establishingconnection) but will be set on the rest.</P></BLOCKQUOTE></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-30">8.4.2.2 Proxying characteristics ofrexec</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10497"></A>Because there are no widely available clients of<EMCLASS="emphasis">rexec</EM>, there are no widely available proxies forit. If you had a client that did use <EMCLASS="emphasis">rexec</EM>, itwould not be terribly difficult to modify it to use a generic proxylike <SPANCLASS="acronym">SOCKS</SPAN>. If the <EMCLASS="emphasis">rexec</EM>clients on a given machine were always accessing the same server, youcould also use a generic proxy server like the<EMCLASS="emphasis">plug-gw</EM> program in the <SPANCLASS="acronym">TIS FWTK</SPAN>. It would be somewhat trickier, but by no meansimpossible, to write a dedicated proxy server that would use modifieduser procedures.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-31">8.4.2.3 Summary of rexecrecommendations</A></H4><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para"><EMCLASS="emphasis">rexec</EM> is pointless; disable it. </P></LI></UL></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-13">8.4.3 rex</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10516"></A><EMCLASS="emphasis">rex</EM> is an <SPANCLASS="acronym">RPC</SPAN>-based servicefor remote command execution. For an understanding of the problems<SPANCLASS="acronym">RCP</SPAN>-based services pose for firewalls, see thediscussion of <SPANCLASS="acronym">RPC</SPAN>-based services in <ACLASS="xref"HREF="ch06_01.htm"TITLE="Packet Filtering">Chapter 6</A>. There are worse problems with <EMCLASS="emphasis">rex</EM>, however; inparticular, it places all of its security checks in the client (whichis a program named <EMCLASS="emphasis">on</EM>), and anyone can use amodified client that bypasses these checks.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-32">8.4.3.1 Packet filtering characteristics ofrex</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10528"></A><EMCLASS="emphasis">rex</EM> is an <SPANCLASS="acronym">RPC</SPAN>-basedservice. As described in the section on <SPANCLASS="acronym">RPC</SPAN> in<ACLASS="xref"HREF="ch06_01.htm"TITLE="Packet Filtering">Chapter 6</A>, it's very difficult to handle<SPANCLASS="acronym">RPC</SPAN>-based services with a packet filtering system,because the servers usually don't use predictable port numbers. Whilethe port numbers to be used are too unpredictable for a packetfiltering system to cope with, they're not so unpredictable that anattacker can't find them. (If nothing else, the attacker could trysending <EMCLASS="emphasis">rex</EM> requests to all ports, to see whichrespond as they would expect a <EMCLASS="emphasis">rex</EM> server to.)</P><PCLASS="para"><EMCLASS="emphasis">rex</EM> is provided over <SPANCLASS="acronym">TCP</SPAN>. Likeother <SPANCLASS="acronym">RPC</SPAN>-based services, however, there's nopredicting what port number the server is going to use. Clientsgenerally use port numbers above 1023.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-33">8.4.3.2 Proxying characteristics of rex</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10546"></A><SPANCLASS="acronym">RPC</SPAN>-based protocols are almost as unpleasant toproxy as they are to allow with packet filtering; they cannot beadequately handled with generic proxies. A dedicated <EMCLASS="emphasis">rex</EM> proxy serverwould be possible, but we do not know of one.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-34">8.4.3.3 Summary of rex recommendations </A></H4><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para"> Don't allow <EMCLASS="emphasis">rex</EM> across your firewall; better yet,don't allow it at all, because it's completely insecure even within a<SPANCLASS="acronym">LAN</SPAN> environment. </P></LI></UL></DIV></DIV><ACLASS="indexterm"NAME="AUTOID-10559"></A></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_03.htm"TITLE="8.3 Terminal Access (Telnet)"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.3 Terminal Access (Telnet)"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_05.htm"TITLE="8.5 Network News Transfer Protocol (NNTP)"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.5 Network News Transfer Protocol (NNTP)"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.3 Terminal Access (Telnet)</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.5 Network News Transfer Protocol (NNTP)</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>