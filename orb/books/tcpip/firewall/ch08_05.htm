<HTML><HEAD><TITLE>[Chapter 8] 8.5 Network News Transfer Protocol (NNTP)</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:23:30Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch08_01.htm"TITLE="8. Configuring Internet Services"><LINKREL="prev"HREF="ch08_04.htm"TITLE="8.4 Remote Command Execution"><LINKREL="next"HREF="ch08_06.htm"TITLE="8.6 World Wide Web (WWW) and HTTP"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_04.htm"TITLE="8.4 Remote Command Execution"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.4 Remote Command Execution"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8<BR>Configuring Internet Services</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_06.htm"TITLE="8.6 World Wide Web (WWW) and HTTP"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.6 World Wide Web (WWW) and HTTP"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="FIRE-08-S1-5">8.5 Network News Transfer Protocol(<SPANCLASS="acronym">NNTP</SPAN>)</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10564"></A><ACLASS="indexterm"NAME="AUTOID-10567"></A><ACLASS="indexterm"NAME="CH08NNTP"></A><ACLASS="indexterm"NAME="CH08CONFNNTP"></A><SPANCLASS="acronym">NNTP</SPAN> is the service generally used to transferUsenet news across the Internet (as we mentionedabove, <SPANCLASS="acronym">UUCP</SPAN> over <SPANCLASS="acronym">TCP</SPAN> issometimes used for this purpose). A news server is the place whereUsenet news flows into and out of yourorganization, and which your users access (via news clients) to readand post news. There are a number of news servers available, includingB-News, C-News, and <SPANCLASS="acronym">INN</SPAN>, and they generally speak<SPANCLASS="acronym">NNTP</SPAN> among themselves so they can transfer newsbetween sites. In addition, many news clients use<SPANCLASS="acronym">NNTP</SPAN> to access news servers for users reading news.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-14">8.5.1 Packet Filtering Characteristics of<SPANCLASS="acronym">NNTP</SPAN></A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10586"></A><SPANCLASS="acronym">NNTP</SPAN> is a <SPANCLASS="acronym">TCP</SPAN>-basedservice. <SPANCLASS="acronym">NNTP</SPAN> servers use port119. <SPANCLASS="acronym">NNTP</SPAN> clients (including servers transferringnews to other servers) use ports above 1023. </P><PCLASS="para"><ACLASS="xref"HREF="ch08_05.htm#FIRE-08-FIG-9"TITLE="NNTP via packet filtering">Figure 8.9</A> shows <SPANCLASS="acronym">NNTP</SPAN> viapacket filtering.</P><H4CLASS="figure"><ACLASS="title"NAME="FIRE-08-FIG-9">Figure 8.9: <SPANCLASS="acronym">NNTP</SPAN> via packet filtering</A></H4><IMGCLASS="graphic"SRC="figs/fire0809.gif"ALT="Figure 8.9"><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direc-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Pro-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">ACK</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tion</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tocol</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Set</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Notes</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[16]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming news</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming news responses</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[16]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing news</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing news responses</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[17]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">NewsServer</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[16]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Newsreader client reading news</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[17]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">News</P><PCLASS="para">Server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Server sending articles to newsreader client</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[16] <SPANCLASS="acronym">ACK</SPAN> is not set on the first packet of this type(establishing connection) but will be set on the rest.</P><PCLASS="para">[17] Both ends are internal in most cases. </P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-15">8.5.2 Proxying Characteristics of<SPANCLASS="acronym">NNTP</SPAN></A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10752"></A><SPANCLASS="acronym">NNTP</SPAN> is a store-and-forward protocol, capable ofdoing its own proxying. It is also easy to proxy as a straightforwardsingle-connection protocol. The <SPANCLASS="acronym">TIS FWTK</SPAN> provides ageneric proxy, <EMCLASS="emphasis">plug-gw</EM>, which is frequently usedwith <SPANCLASS="acronym">NNTP</SPAN> as well as modified user procedures (the<SPANCLASS="acronym">NNTP</SPAN> connection is directed to the proxy server,which redirects the connection based on the client address). It wouldbe easy to modify clients to use a generic modified-client proxy like<SPANCLASS="acronym">SOCKS</SPAN>.</P><PCLASS="para"><ACLASS="xref"HREF="ch08_05.htm#FIRE-08-FIG-10"TITLE="NNTP via proxy services">Figure 8.10</A> shows <SPANCLASS="acronym">NNTP</SPAN> viaproxy services.</P><H4CLASS="figure"><ACLASS="title"NAME="FIRE-08-FIG-10">Figure 8.10: <SPANCLASS="acronym">NNTP</SPAN> via proxy services</A></H4><IMGCLASS="graphic"SRC="figs/fire0810.gif"ALT="Figure 8.10"></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-16">8.5.3 Dangerous Ways to Set up<SPANCLASS="acronym">NNTP</SPAN> in a Firewall Environment</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10773"></A><ACLASS="indexterm"NAME="AUTOID-10776"></A>It may seem obvious that the bastion host should be your site's Usenetnews server. However, there are some subtle problems that can becaused by such a configuration.</P><PCLASS="para">First, it is advisable to dedicate a machine to news service; news hasa tendency to absorb all available disk space and processing time, anddoes not coexist well with critical services. If you use a bastionhost for news, you will probably need to have multiple bastion hosts,which is not in itself a bad thing, but does raise maintenanceoverhead. It may not be worth it to you to have multiple bastion hostsjust so you can provide news service on one of them.</P><PCLASS="para">Second, if your news server is your bastion host, you can't have anyprivate or proprietary newsgroups for internal discussions. Youwouldn't want those newsgroups to be exposed ifthe bastion host gets broken into, or if some outsider manages toconnect to your <SPANCLASS="acronym">NNTP</SPAN> server and convinces it toshow him your newsgroups.</P><PCLASS="para">Third, if your bastion host is your news server, you will have tochoose one of four approaches to letting your users read news; each ofthese approaches, described in the sections below, has its ownproblems.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-35">8.5.3.1 Letting users log into the bastionhost to read news</A></H4><PCLASS="para">The most straightforward approach is to let users log into the bastionhost and run a newsreader. This involves giving many users accounts onthe bastion host, and will seriously compromise the bastion host'ssecurity. (See the discussions concerning user accounts on bastion hostsin <ACLASS="xref"HREF="ch05_01.htm"TITLE="Bastion Hosts">Chapter 5, <CITECLASS="chapter">Bastion Hosts</CITE></A>.)</P><PCLASS="para">This approach may not be very popular with the users, either, becauseit will require them all to use whichever <SPANCLASS="acronym">UNIX</SPAN>newsreaders are available on the bastion host.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-36">8.5.3.2 Using only <SPANCLASS="acronym">NNTP</SPAN>clients to read news</A></H4><PCLASS="para">The second and somewhat safer approach is to make your users use only<SPANCLASS="acronym">NNTP</SPAN> clients to read news from the bastion host.The main problem with this approach is that it requires your users touse <SPANCLASS="acronym">NNTP</SPAN>-capable newsreaders. While many, perhapseven most, newsreaders are <SPANCLASS="acronym">NNTP</SPAN>-capable, there aresome that are still in common usage (such as certain versions of<EMCLASS="emphasis">nn</EM>) that are not<SPANCLASS="acronym">NNTP</SPAN>-capable. Depending on the<SPANCLASS="acronym">NNTP</SPAN> server you are using, it may be impossible toget popular newsreader features like article threading through<SPANCLASS="acronym">NNTP</SPAN>. You may have difficulty finding a server thathas all the features you want for both transferring news and servingnewsreaders.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-37">8.5.3.3 Exporting news to clients via<SPANCLASS="acronym">NFS</SPAN></A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10804"></A><ACLASS="indexterm"NAME="AUTOID-10807"></A>The third approach you could take to making your bastion host be yournews server is to export the news to clients via<SPANCLASS="acronym">NFS</SPAN>. This approach solves one of the problemswe've identified: it allows you to usenon-<SPANCLASS="acronym">NNTP</SPAN>-capable newsreaders. However, it doesn'tsolve the other major problem, that of not being able to support anyprivate or proprietary newsgroups for fear of exposure. If your userscan use <SPANCLASS="acronym">NFS</SPAN> to access your news server, chances arethat an attacker can too, because the security of<SPANCLASS="acronym">NFS</SPAN> is so weak. You're much better off disabling<SPANCLASS="acronym">NFS</SPAN> altogether on your bastion host (see thesection on <SPANCLASS="acronym">NFS</SPAN> later in this chapter and <ACLASS="xref"HREF="ch05_01.htm"TITLE="Bastion Hosts">Chapter 5</A> for further discussion of this point).</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-38">8.5.3.4 Relaying news through your bastionhost to an internal news server</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10819"></A>The fourth approach is to simply relay news through your bastion host,and make some internal system your &quot;real&quot; news server. Themost obvious way to do this is to set up a news server on the bastionhost that simply relays news to and from the internal news server. </P><PCLASS="para">The problem with this approach is that it requires a lot ofmaintenance. It takes a fair amount of ongoing attention to keep a newssystem functioning; ideally, you'd like to be able to set your bastionhost up and leave it alone, maintenance free. Also, tightly couplednews systems like these are very susceptible to cascading problems.A problem on one causes news to stop flowing, stopping things up on theother system and causing problems there; when you fix the first problem,the other system floods the first, and the whole process starts over.However, if you have experienced news administrators and a large amountof disk space, you may find this approach acceptable, and it can be setup to allow for private newsgroups.</P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-17">8.5.4 Good Ways to Set up<SPANCLASS="acronym">NNTP</SPAN> in a Firewall Environment</A></H3><PCLASS="para">One of the key differences between <SPANCLASS="acronym">NNTP</SPAN> and otherprotocols, such as <SPANCLASS="acronym">SMTP</SPAN>, is in how they areused. You might get <SPANCLASS="acronym">SMTP</SPAN> connections from all overthe world, as folks from everywhere send electronic mail to yoursite. On the other hand, you'll only get legitimate<SPANCLASS="acronym">NNTP</SPAN> connections from your news feed site (orsites).</P><PCLASS="para">The most convenient and reliable way to deal with news on a firewall isusually to arrange for the news to flow directly between your feedsite(s) and your internal news server. This can be arranged eitherthrough packet filtering, or through a proxy system on the bastion host,as we describe in the following sections.</P><PCLASS="para"><ACLASS="indexterm"NAME="CH08PACKFILTNNTP"></A><ACLASS="indexterm"NAME="CH08PROXNNTP"></A>If you set up <SPANCLASS="acronym">NNTP</SPAN> using either packet filtering ora proxy server, you'll greatly reduce your vulnerability toattacks via <SPANCLASS="acronym">NNTP</SPAN>. With <SPANCLASS="acronym">NNTP</SPAN>configured as we describe here, both of the following conditions would haveto hold true in order for you to be attacked via <SPANCLASS="acronym">NNTP</SPAN>: </P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Your <SPANCLASS="acronym">NNTP</SPAN> server would have to have some bug orconfiguration error that could be exploited.</P></LI><LICLASS="listitem"><PCLASS="para">The attack would have to come from (or appear to come from) one ofyour feed sites, because the feed sites are the only sites that areallowed to open <SPANCLASS="acronym">NNTP</SPAN> connections to your server.</P></LI></UL><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN> is a relatively simple protocol. There havebeen no known attacks that use <SPANCLASS="acronym">NNTP</SPAN> itself. Therehas been one known data-driven attack on <SPANCLASS="acronym">UNIX</SPAN> newssystems, which relied on the willingness of some news server softwareto create newsgroups automatically. It was possible to specifynewsgroup names with semicolons (;) in them, so that when the news serverwent to create the group it also executed commands contained after thesemicolon in the malformed group name. Because the control messageswere malformed, they weren't recognized and propagated by all servers,and many sites were immune anyway because they didn't automaticallycreate newsgroups. This bug is fixed in current releases of variousnews server software packages, but it highlights the importance ofstaying up to date, as we describe in <ACLASS="xref"HREF="ch12_01.htm"TITLE="Maintaining Firewalls">Chapter 12, <CITECLASS="chapter">Maintaining Firewalls</CITE></A>.</P><PCLASS="para">You may want to disable automated group creation in any case; it's amaintenance hassle to keep up with valid requests, but users can findit seriously annoying to deal with the side effects of automated groupcreation when somebody decides that it's amusing to send a fewthousand creation requests overnight, most of them obscene.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-18">8.5.5 Using Packet Filtering with<SPANCLASS="acronym">NNTP</SPAN></A></H3><PCLASS="para">If you've set up a packet filtering system between the internal newsserver and your news feed site, you can arrange to pass<SPANCLASS="acronym">NNTP</SPAN> between them. Set up the packet filteringsystem to allow the following, as shown in the table below:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Incoming <SPANCLASS="acronym">NNTP</SPAN> connections, so that you can receivenews: that is, <SPANCLASS="acronym">TCP</SPAN> packets from ports above 1023 onthe remote system to port 119 on your news server, and<SPANCLASS="acronym">TCP</SPAN> packets with the <SPANCLASS="acronym">ACK</SPAN> bit setfrom port 119 on your news server to ports above 1023 on the remotesystem. (Rules A and B)</P></LI><LICLASS="listitem"><PCLASS="para">Outgoing <SPANCLASS="acronym">NNTP</SPAN> connections, so that you can sendnews: that is, <SPANCLASS="acronym">TCP</SPAN> packets from ports above 1023 onyour news server to port 119 on the remote system, and<SPANCLASS="acronym">TCP</SPAN> packets with the <SPANCLASS="acronym">ACK</SPAN> bit setfrom port 119 on the remote system to ports above 1023 on your newsserver (Rules C and D).</P></LI></UL><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direc-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Pro-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">ACK</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Rule</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tion</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tocol</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Set</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Action</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">A</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Service Provider</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Your Server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">B</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Your Server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Service Provider</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">C</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Your Server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Service Provider</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">D</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Service Provider</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Your Server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR></TBODY></TABLE><ACLASS="indexterm"NAME="AUTOID-10987"></A><ACLASS="indexterm"NAME="AUTOID-10988"></A></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-19">8.5.6 Summary of <SPANCLASS="acronym">NNTP</SPAN>Recommendations</A></H3><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Don't use a bastion host as a news server.</P></LI><LICLASS="listitem"><PCLASS="para">Don't allow automated group creation.</P></LI><LICLASS="listitem"><PCLASS="para">Allow external <SPANCLASS="acronym">NNTP</SPAN> connections only from the sitesyou exchange news with.&#13;</P></LI><LICLASS="listitem"><PCLASS="para">Use packet filtering or proxying to connect trusted external<SPANCLASS="acronym">NNTP</SPAN> servers to an internal news server, and viceversa.</P></LI></UL></DIV><ACLASS="indexterm"NAME="AUTOID-11003"></A><ACLASS="indexterm"NAME="AUTOID-11004"></A></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_04.htm"TITLE="8.4 Remote Command Execution"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.4 Remote Command Execution"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_06.htm"TITLE="8.6 World Wide Web (WWW) and HTTP"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.6 World Wide Web (WWW) and HTTP"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.4 Remote Command Execution</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.6 World Wide Web (WWW) and HTTP</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>