<HTML><HEAD><TITLE>[Chapter 8] 8.12 Network Management Services</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:25:49Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch08_01.htm"TITLE="8. Configuring Internet Services"><LINKREL="prev"HREF="ch08_11.htm"TITLE="8.11 syslog"><LINKREL="next"HREF="ch08_13.htm"TITLE="8.13 Network Time Protocol (NTP)"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_11.htm"TITLE="8.11 syslog"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.11 syslog"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8<BR>Configuring Internet Services</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_13.htm"TITLE="8.13 Network Time Protocol (NTP)"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.13 Network Time Protocol (NTP)"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="FIRE-08-S1-12">8.12 Network Management Services</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH08NMS"></A><ACLASS="indexterm"NAME="CH08CONFNMS"></A><ACLASS="indexterm"NAME="AUTOID-14658"></A>This section describes a number of protocols that are used by peopleand programs to manage and maintain networks: <SPANCLASS="acronym">SNMP</SPAN>,<SPANCLASS="acronym">RIP</SPAN>, and <SPANCLASS="acronym">ICMP</SPAN>&nbsp;- and, whereappropriate, the tools, such as <EMCLASS="emphasis">ping</EM> and<EMCLASS="emphasis">traceroute</EM>, that use them.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-42">8.12.1 Simple Network ManagementProtocol (<SPANCLASS="acronym">SNMP</SPAN>)</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="CH08SNMP"></A><ACLASS="indexterm"NAME="CH08CONFSNMP"></A><SPANCLASS="acronym">SNMP</SPAN> is a standardized remote monitoring andmanagement mechanism for network devices like hubs, routers, andbridges, as well as servers and workstations. The theory is that any<SPANCLASS="acronym">SNMP</SPAN>-capable management station should be able tomonitor and control any <SPANCLASS="acronym">SNMP</SPAN>-capable networkdevice.</P><PCLASS="para">Normally, <SPANCLASS="acronym">SNMP</SPAN> management stations act as clients,contacting <SPANCLASS="acronym">SNMP</SPAN> servers in the various networkdevices to request information or to issue commands. Sometimes,network devices act as <SPANCLASS="acronym">SNMP</SPAN> clients to contactspecial <SPANCLASS="acronym">SNMP</SPAN> servers (known as<EMCLASS="emphasis">trap</EM> servers) on management stations to reportcritical information that can't wait until the next time themanagement station polls the device. <SPANCLASS="acronym">SNMP</SPAN> trapservers are separate from regular <SPANCLASS="acronym">SNMP</SPAN> servers sothat a given machine can run both&nbsp;- that is, both an<SPANCLASS="acronym">SNMP</SPAN> server (and thus be manageable via<SPANCLASS="acronym">SNMP</SPAN>) and an <SPANCLASS="acronym">SNMP</SPAN> trap server(and thus be a management station and receive traps from otherdevices).</P><PCLASS="para">In general, you don't want someone from the outside to beable to manage your network via <SPANCLASS="acronym">SNMP</SPAN>. Therefore,you shouldn't allow <SPANCLASS="acronym">SNMP</SPAN> to cross yourfirewall, and you should carefully configure (or disable)<SPANCLASS="acronym">SNMP</SPAN> on your systems that are outside your firewallso that attackers can't use it to change that configuration.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14695"></A><SPANCLASS="acronym">SNMP</SPAN> does support some rudimentary security; wheninformation is requested, the requester needs to specify a&quot;community&quot; that it'sin. Different communitiescan be shown different information, and a reusable password can berequired for certain communities. At its best, this is quite primitivesecurity; anybody who's doing packet sniffing can easily discover acommunity name and password. </P><PCLASS="para">Not all <SPANCLASS="acronym">SNMP</SPAN> devicessupport even this much. Fortunately, the most insecure<SPANCLASS="acronym">SNMP</SPAN> features (for example, allowing<SPANCLASS="acronym">SNMP</SPAN> clients to set parameters) are also the mostcomplex to implement, and therefore the least oftenimplemented. <SPANCLASS="acronym">SNMP</SPAN> servers that don't implementpasswords probably implement only straightforward queries. That maystill give away information that you'd prefer not be madepublic, e.g., the addresses you're communicating with andpresumably trust, or the precise amount of extra traffic you'd have togenerate to bring down a gateway.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-75">8.12.1.1 Packet filtering characteristics of<SPANCLASS="acronym">SNMP</SPAN></A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14708"></A><SPANCLASS="acronym">SNMP</SPAN> is a <SPANCLASS="acronym">UDP</SPAN>-basedservice. <SPANCLASS="acronym">SNMP</SPAN> servers (in network devices) listenon both <SPANCLASS="acronym">TCP</SPAN> and <SPANCLASS="acronym">UDP</SPAN> port161. <SPANCLASS="acronym">SNMP</SPAN> trap servers (in management stations)listen on both <SPANCLASS="acronym">TCP</SPAN> and <SPANCLASS="acronym">UDP</SPAN> port162. <SPANCLASS="acronym">SNMP</SPAN> clients generally use ports above 1023 totalk to both regular and trap servers.</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direc-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Pro-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">ACK</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tion</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tocol</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Set</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Notes</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">161</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[43]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">External management station (client) contacting internal <SPANCLASS="acronym">SNMP</SPAN> networkdevice (server)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">161</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[43]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">SNMP</SPAN> network device (server) replying to external managementstation (client)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">161</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[44]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">External management station (client) contacting internal <SPANCLASS="acronym">SNMP</SPAN> networkdevice (server)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">161</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">SNMP</SPAN> network device (server) replying to external managementstation (client)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">161</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[43]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal management station (client) contacting external <SPANCLASS="acronym">SNMP</SPAN> networkdevice (server)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">161</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[43]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">External <SPANCLASS="acronym">SNMP</SPAN> network device (server) responding to internal managementstation (client)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">161</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[44]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal management station (client) contacting external <SPANCLASS="acronym">SNMP</SPAN> networkdevice (server)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">161</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">External <SPANCLASS="acronym">SNMP</SPAN> network device (server) responding to internal managementstation (client)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">162</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[43]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">External network device (client) contacting internal <SPANCLASS="acronym">SNMP</SPAN> managementstation (trap server)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">162</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[43]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">SNMP</SPAN> management station (trap server) replying to externalnetwork device (client)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">162</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[44]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">External network device (client) contacting internal <SPANCLASS="acronym">SNMP</SPAN> managementstation (trap server)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">162</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">SNMP</SPAN> management station (trap server) replying to externalnetwork device (client)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">162</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[43]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal network device (client) contacting external <SPANCLASS="acronym">SNMP</SPAN> managementstation (trap server)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">162</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[43]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">External <SPANCLASS="acronym">SNMP</SPAN> management station (trap server) responding to internalnetwork device (client)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">162</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[44]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal network device (client) contacting external <SPANCLASS="acronym">SNMP</SPAN> managementstation (trap server)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">162</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">External <SPANCLASS="acronym">SNMP</SPAN> management station (trap server) responding to internalnetwork device (client)</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[43] <SPANCLASS="acronym">UDP</SPAN> packets do not have <SPANCLASS="acronym">ACK</SPAN> bits.</P><PCLASS="para">[44] <SPANCLASS="acronym">ACK</SPAN> will not be set on the first packet of thistype (establishing connection) but will be set on the rest.</P></BLOCKQUOTE></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-76">8.12.1.2 Proxying characteristics of <SPANCLASS="acronym">SNMP</SPAN></A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15076"></A><SPANCLASS="acronym">SNMP</SPAN> is not commonly used across the Internet, soproxies for it are not widely available. Although it is astraightforward single-connection protocol, it's often implemented indevices (like dedicated routers) for which source code and compilersare not readily available, making it almost impossible to use with amodified-client proxy system like <SPANCLASS="acronym">SOCKS</SPAN>. Itshouldn't be too difficult to make it work with modified-procedureproxy systems.<ACLASS="indexterm"NAME="AUTOID-15082"></A><ACLASS="indexterm"NAME="AUTOID-15083"></A></P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-43">8.12.2 Routing Information Protocol(<SPANCLASS="acronym">RIP</SPAN>)</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15088"></A><ACLASS="indexterm"NAME="AUTOID-15091"></A><ACLASS="indexterm"NAME="AUTOID-15094"></A><ACLASS="indexterm"NAME="AUTOID-15098"></A><SPANCLASS="acronym">RIP</SPAN> is the oldest routing protocol on theInternet. In fact, it predates <SPANCLASS="acronym">IP</SPAN>; it was takenalmost verbatim from the older Xerox Network Services(<SPANCLASS="acronym">XNS</SPAN>) system. It is also still the most commonlyused routing protocol on local area <SPANCLASS="acronym">IP</SPAN>networks. Routers (including general-purpose machines with multipleinterfaces, that can act as routers) use <SPANCLASS="acronym">RIP</SPAN> toperiodically broadcast which networks they know how to reach, and howfar away those networks are. By listening to these broadcasts, arouter or host can determine what networks are reachable and choosethe best (shortest) path to each. <SPANCLASS="acronym">RIP</SPAN> serversgenerally just broadcast this information every 30 seconds or so foranyone interested to hear, but a <SPANCLASS="acronym">RIP</SPAN> client canrequest a special update from a <SPANCLASS="acronym">RIP</SPAN> server, whichwill cause the server to reply directly to the client with theinformation requested.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-77">8.12.2.1 Packet filtering characteristics of<SPANCLASS="acronym">RIP</SPAN></A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15114"></A><SPANCLASS="acronym">RIP</SPAN> is a <SPANCLASS="acronym">UDP</SPAN>-basedservice. <SPANCLASS="acronym">RIP</SPAN> servers listen on port 520 forbroadcasts from other servers and requests fromclients. <SPANCLASS="acronym">RIP</SPAN> servers generally send theirbroadcasts from port 520. <SPANCLASS="acronym">RIP</SPAN> clients generally useports above 1023.</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direc-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Pro-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">ACK</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tion</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tocol</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Set</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Notes</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">520</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[45]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">External client request to internal server</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">520</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[45]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal server response to external client</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">520</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[45]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal client request to external server</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">520</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[45]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">External server response to internal client</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Broadcast</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">520</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">520</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[45]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">External server broadcasting to internal servers</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Broadcast</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">520</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">520</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[45]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal server broadcasting to external servers</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[45] <SPANCLASS="acronym">UDP</SPAN> packets do not have <SPANCLASS="acronym">ACK</SPAN> bits.</P></BLOCKQUOTE></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-78">8.12.2.2 Proxying characteristics of<SPANCLASS="acronym">RIP</SPAN></A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15274"></A>Because <SPANCLASS="acronym">RIP</SPAN> allows a host to developrouting tables that are specific to where that host is in the network,it doesn't make any sense to proxy <SPANCLASS="acronym">RIP</SPAN> to anotherhost elsewhere in the network.</P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-45">8.12.3 ping</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="CH08PING"></A><ACLASS="indexterm"NAME="AUTOID-15286"></A><ACLASS="indexterm"NAME="AUTOID-15290"></A><ACLASS="indexterm"NAME="CH08CONFPING"></A>The <EMCLASS="emphasis">ping</EM> program checks network connectivity. The<EMCLASS="emphasis">ping</EM> application generates an<SPANCLASS="acronym">ICMP</SPAN> &quot;echo request&quot; packet. Thedestination system responds with an <SPANCLASS="acronym">ICMP</SPAN>&quot;echo response&quot; packet. <SPANCLASS="acronym">ICMP</SPAN> istypically implemented in the kernel, so it's the kernel that generatesthe &quot;echo response&quot; packet; there is no separateserver for <SPANCLASS="acronym">ICMP</SPAN> on most systems. (On some machines,the echo response is actually generated in the network interfaceitself, not in the operating system, and the machine need not even befully running to respond to <EMCLASS="emphasis">ping</EM>.) <EMCLASS="emphasis">ping</EM> is not the only program that uses <SPANCLASS="acronym">ICMP</SPAN>echo; others include <EMCLASS="emphasis">spray</EM> and almost anydedicated network management tool.</P><PCLASS="para"><EMCLASS="emphasis">ping</EM> is a useful network trouble-shootingtool, and it is reasonably safe. You'll probably want to allow<EMCLASS="emphasis">ping</EM> outbound from at least the machines yournetwork operations staff uses and inbound from at least the networkoperations center machines of your network service provider.</P><PCLASS="para">Because of where it is implemented, it is almost impossible to disablereplies to <EMCLASS="emphasis">ping</EM> on individual hosts; packetfiltering is the only way to control it.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15313"></A><ACLASS="indexterm"NAME="AUTOID-15316"></A>There are two dangers in allowing <SPANCLASS="acronym">ICMP</SPAN>echo:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">It can be used for a denial of service attack: that is, to flood yournetwork. Although any protocol you accept can be used in this way,<SPANCLASS="acronym">ICMP</SPAN> echo is particularly tempting, because thereare commonly available programs designed for network testing(including some versions of <EMCLASS="emphasis">ping</EM>) that letyou flood networks with simple command line options.</P></LI><LICLASS="listitem"><PCLASS="para">Anybody who can send <SPANCLASS="acronym">ICMP</SPAN> echo requests to andreceive <SPANCLASS="acronym">ICMP</SPAN> echo responses from your network candiscover how many machines you have, and what network addressesthey're at; this increases the efficiency of any furtherattacks. That's why you want to limit requests to machines that have alegitimate reason to be probing your network.</P></LI></UL><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-79">8.12.3.1 Packet filtering characteristics ofping</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15333"></A>Many packet filtering systems let you filter <SPANCLASS="acronym">ICMP</SPAN>packets in much the same way as <SPANCLASS="acronym">TCP</SPAN> or<SPANCLASS="acronym">UDP</SPAN> packets: by specifying the<SPANCLASS="acronym">ICMP</SPAN> message type code instead of the<SPANCLASS="acronym">TCP</SPAN> or <SPANCLASS="acronym">UDP</SPAN> source or destinationport number. If your packet filtering system has this capability, itsdocumentation should include a list of the <SPANCLASS="acronym">ICMP</SPAN>numeric codes or keywords that the packet filtering systemunderstands.</P><PCLASS="para">To allow the <EMCLASS="emphasis">ping</EM> program to operate outbound(i.e., <EMCLASS="emphasis">ping</EM>'ing remote hosts), you'll have toallow <SPANCLASS="acronym">ICMP</SPAN> echo request packets outbound and<SPANCLASS="acronym">ICMP</SPAN> echo response packets inbound. To allowinbound <EMCLASS="emphasis">ping</EM> (i.e., a remote host<EMCLASS="emphasis">ping</EM>'ing a local host), you'll have to allow<SPANCLASS="acronym">ICMP</SPAN> echo request packets inbound and<SPANCLASS="acronym">ICMP</SPAN> echo response packets outbound.</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direc-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Pro-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Message</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tion</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tocol</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Type[46] </TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Notes</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">ICMP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">8</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming <EMCLASS="emphasis">ping</EM></P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">ICMP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">0</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Response to incoming <EMCLASS="emphasis">ping</EM></P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">ICMP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">8</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing <EMCLASS="emphasis">ping</EM></P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">ICMP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">0</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Response to outgoing <EMCLASS="emphasis">ping</EM></P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[46] <SPANCLASS="acronym">ICMP</SPAN> messages do not have source or destinationport numbers; they have a single <SPANCLASS="acronym">ICMP</SPAN> message typefield instead. <SPANCLASS="acronym">ICMP</SPAN> packets also do not have<SPANCLASS="acronym">ACK</SPAN> bits.</P></BLOCKQUOTE></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-80">8.12.3.2 Proxying characteristics of ping</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15446"></A>Because <EMCLASS="emphasis">ping</EM> is neither<SPANCLASS="acronym">TCP</SPAN> nor <SPANCLASS="acronym">UDP</SPAN>-based, it won'twork with any widely available generic proxy server formodified-client proxying. Because <EMCLASS="emphasis">ping</EM> transmitsno user-supplied data to the destination host, modified-procedureproxying for <EMCLASS="emphasis">ping</EM> is notpossible. Modified-procedure proxying also relies on the ability of the proxy server to intercept the request before the machine it'srunning on generates a reply, which is difficult with<EMCLASS="emphasis">ping</EM>. In a pure proxying environment,<EMCLASS="emphasis">ping</EM> will have to be provided by letting usersconnect to the proxying host and run <EMCLASS="emphasis">ping</EM> fromthere, as discussed in <ACLASS="xref"HREF="ch07_01.htm"TITLE="Proxy Systems">Chapter 7</A>.<ACLASS="indexterm"NAME="AUTOID-15459"></A><ACLASS="indexterm"NAME="AUTOID-15460"></A></P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-44">8.12.4 traceroute</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="CH08TRACEROUTE"></A><ACLASS="indexterm"NAME="CH08CONFTRACE"></A><ACLASS="indexterm"NAME="AUTOID-15470"></A><ACLASS="indexterm"NAME="AUTOID-15473"></A><EMCLASS="emphasis">traceroute</EM> is an application that shows you theroute that packets take to a particular <SPANCLASS="acronym">IP</SPAN>destination. Because no system typically knows the full path to thedestination (merely the next step towards the destination), this is aneat trick.[47]<EMCLASS="emphasis">traceroute</EM> works by carefully constructingspecial <SPANCLASS="acronym">UDP</SPAN> packets. The destination address of thepackets is the remote host; the destination port is an unused (or sowe hope, as we'll discuss below) <SPANCLASS="acronym">UDP</SPAN> port on theremote host. The really special thing about the packets, though, isthat the &quot;time to live&quot; (<SPANCLASS="acronym">TTL</SPAN>) fieldsare set very low (starting at 1), so that the packets will be rejectedby intermediate routers as if they were looping in the network. Bylooking at where the rejections (<SPANCLASS="acronym">ICMP</SPAN> &quot;timeto live exceeded&quot; messages) come from,<EMCLASS="emphasis">traceroute</EM> can determine who the intermediaterouters are.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[47] <EMCLASS="emphasis">traceroute</EM> is, fundamentally, a &quot;coolhack.&quot;</P></BLOCKQUOTE><PCLASS="para"><EMCLASS="emphasis">TTL</EM> is an <SPANCLASS="acronym">IP</SPAN> header thatnormally isn't of interest from a firewall point of view. The name issomewhat misleading; it might be more intuitively called &quot;hopsto live.&quot; When a packet is first created, its<SPANCLASS="acronym">TTL</SPAN> field is set to some value (typically 16, 30,or 255). Every router that handles the packet along its journeydecrements the <SPANCLASS="acronym">TTL</SPAN> field by 1. If the<SPANCLASS="acronym">TTL</SPAN> field ever reaches 0, the packet is assumed tobe in some sort of a loop; it is encapsulated within an<SPANCLASS="acronym">ICMP</SPAN> &quot;time to live exceeded&quot; message, and is returnedto the source address.</P><PCLASS="para">Thus, the first router that handles the first of<EMCLASS="emphasis">traceroute</EM>'s specially constructed packets (whichhas a <SPANCLASS="acronym">TTL</SPAN> of 1) will decrement the<SPANCLASS="acronym">TTL</SPAN> field, see that it's 0, and return an<SPANCLASS="acronym">ICMP</SPAN> &quot;time to live exceeded&quot; message, telling<EMCLASS="emphasis">traceroute</EM> the <SPANCLASS="acronym">IP</SPAN> address ofthe first router (the source of the <SPANCLASS="acronym">ICMP</SPAN> message).</P><PCLASS="para"><EMCLASS="emphasis">traceroute</EM> then constructs another<SPANCLASS="acronym">UDP</SPAN> packet, this time with a <SPANCLASS="acronym">TTL</SPAN>of 2, and sends it out. This packet gets to the second router before<SPANCLASS="acronym">TTL</SPAN> gets decremented to 0, and<EMCLASS="emphasis">traceroute</EM> knows that the router that returns the<SPANCLASS="acronym">ICMP</SPAN> &quot;time to live exceeded&quot; for thatpacket is the second router along the path to thedestination. <EMCLASS="emphasis">traceroute</EM> then constructs a<SPANCLASS="acronym">UDP</SPAN> packet with a <SPANCLASS="acronym">TTL</SPAN> of 3, then4, and so on, to determine the path to the destination.</P><PCLASS="para"><EMCLASS="emphasis">traceroute</EM> knows it's finished when it getsback an <SPANCLASS="acronym">ICMP</SPAN> &quot;service unavailable&quot;message, rather than an <SPANCLASS="acronym">ICMP</SPAN> &quot;time to liveexceeded&quot; message from some intermediate router.</P><PCLASS="para">Most versions of <EMCLASS="emphasis">traceroute</EM> will also note anddisplay relevant <SPANCLASS="acronym">ICMP</SPAN> &quot;hostunreachable&quot;, &quot;network unreachable&quot;, and other<SPANCLASS="acronym">ICMP</SPAN> messages received.</P><PCLASS="para">If <EMCLASS="emphasis">traceroute</EM> can't reach the destination host(or can't get anything back from it), it eventually times out.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-81">8.12.4.1 Packet filtering characteristics oftraceroute</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15526"></A>To allow <EMCLASS="emphasis">traceroute</EM> outbound through your packetfilters (i.e., someone running <EMCLASS="emphasis">traceroute</EM> fromthe inside, to an external destination), you have to allow theconstructed <SPANCLASS="acronym">UDP</SPAN> packets outbound, and the relevant<SPANCLASS="acronym">ICMP</SPAN> packets (particularly &quot;time to liveexceeded&quot; and &quot;service unavailable&quot; back inbound.</P><PCLASS="para">To allow <EMCLASS="emphasis">traceroute</EM> inbound, you have to allowthe constructed <SPANCLASS="acronym">UDP</SPAN> packets inbound, and therelevant <SPANCLASS="acronym">ICMP</SPAN> messages back outbound. You may wishto limit this capability to the machines used by the networkoperations center of your network service provider, in order to keep atight reign on the <SPANCLASS="acronym">UDP</SPAN> packets allowed through yourfirewall. Doing so protects <SPANCLASS="acronym">RPC</SPAN>-based services like<SPANCLASS="acronym">NFS</SPAN> and <SPANCLASS="acronym">NIS/YP</SPAN>) and keepsattackers from using <EMCLASS="emphasis">traceroute</EM> to discover whichaddresses at your site are actually assigned to hosts.</P><PCLASS="para">Some versions of <EMCLASS="emphasis">traceroute</EM> can be told (via acommand line or a compile-time option) which range of<SPANCLASS="acronym">UDP</SPAN> ports to use for the destination. You may needto establish a convention for your site of what port(s) willbe allowed through the packet filters for use by<EMCLASS="emphasis">traceroute</EM>. You don't want to allow any morelatitude in your packet filters for <EMCLASS="emphasis">traceroute</EM>than absolutely necessary (particularly for incoming<EMCLASS="emphasis">traceroute</EM>). Because<EMCLASS="emphasis">traceroute</EM> is <SPANCLASS="acronym">UDP</SPAN>-based, anattacker could potentially take advantage of the<SPANCLASS="acronym">UDP</SPAN>-based rules in your packet filtering that arethere to allow <EMCLASS="emphasis">traceroute</EM> in order to attackother <SPANCLASS="acronym">UDP</SPAN>-based services like<SPANCLASS="acronym">NFS</SPAN> and <SPANCLASS="acronym">NIS/YP</SPAN>.</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direc-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Pro-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Message</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tion</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tocol</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port[48]</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port[48]</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Type[48]</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Notes</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[49]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[49]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[48]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing <EMCLASS="emphasis">traceroute</EM> probe</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">ICMP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[48]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[48]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">11</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming &quot;<SPANCLASS="acronym">TTL</SPAN> exceeded&quot;</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">ICMP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[48]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[48]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">3</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming &quot;service unavailable&quot;</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[49]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[49]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[48]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming <EMCLASS="emphasis">traceroute</EM> probe</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">ICMP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[48]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[48]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">11</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing &quot;<SPANCLASS="acronym">TTL</SPAN> exceeded&quot;</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">ICMP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[48]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[48]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">3</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing &quot;service unavailable&quot;</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[48] <SPANCLASS="acronym">UDP</SPAN> packets have source and destination ports;<SPANCLASS="acronym">ICMP</SPAN> packets have only message typefields. Neither <SPANCLASS="acronym">UDP</SPAN> nor <SPANCLASS="acronym">ICMP</SPAN>packets have <SPANCLASS="acronym">ACK</SPAN> bits.</P><PCLASS="para">[49] <EMCLASS="emphasis">traceroute</EM> probe packet <SPANCLASS="acronym">UDP</SPAN>source/destination ports vary by implementation, invocation, and/orcommand-line arguments. They are generally &gt;32768, but that's aboutthe only generalization you can make about them. Specificimplementations (particularly in routers and onnon-<SPANCLASS="acronym">UNIX</SPAN> platforms) may vary. Destination ports, inparticular, are usually in the range 33434 through 33523.(Why this isthe case is somewhat complicated, and you should read the comments inthe <SPANCLASS="acronym">UNIX</SPAN> <EMCLASS="emphasis">traceroute</EM> sourcecode if you're perversely curious.)</P></BLOCKQUOTE></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-82">8.12.4.2 Proxying characteristics oftraceroute</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15730"></A>Like <EMCLASS="emphasis">ping, traceroute</EM> could easily be supportedby an <SPANCLASS="acronym">ICMP</SPAN>-knowledgeable modified-client proxyserver. Unfortunately, no such proxy server is widelyavailable. Modified-procedure proxying is not possible with<EMCLASS="emphasis">traceroute</EM>.<ACLASS="indexterm"NAME="AUTOID-15737"></A><ACLASS="indexterm"NAME="AUTOID-15738"></A></P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-92">8.12.5 Other <SPANCLASS="acronym">ICMP</SPAN> Packets</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15743"></A><ACLASS="indexterm"NAME="AUTOID-15746"></A>There are a number of <SPANCLASS="acronym">ICMP</SPAN> message types that areused for network management that don't have programs associated withthem. These are automatically generated and interpreted by variousprograms and network devices.</P><PCLASS="para">What to do with <SPANCLASS="acronym">ICMP</SPAN> messages depends on themessage, and the direction it's going in. We've already talked about&quot;echo request&quot;, &quot;echo reply&quot;,&quot;destination unreachable&quot;, &quot;serviceunavailable&quot; (actually a special type of &quot;destinationunreachable&quot;), and &quot;time to live exceeded&quot;messages. The other <SPANCLASS="acronym">ICMP</SPAN> message types youprobably want to allow, both inbound and outbound, are &quot;sourcequench&quot; (used by a receiver to tell a sender to &quot;slowdown,&quot; because it's sending data too fast) and &quot;parameterproblem&quot; (which is sort of a catch-all code to return when thereis a problem with packet headers that can't be reported any otherway).</P><PCLASS="para">Many other <SPANCLASS="acronym">ICMP</SPAN> message types have the potential tochange local information on your hosts (for example,&quot;redirect&quot; causes changes to a host's routing tables), soyou probably don't want to allow such messages inbound through yourpacket filters.</P><PCLASS="para">In general, you only want to allow <SPANCLASS="acronym">ICMP</SPAN> outboundwhen it has the chance of doing you some good. Both &quot;sourcequench&quot; and &quot;parameter problem&quot; are used to get thesending host to be nicer to you, and are worth allowing outbound. Anyof the <SPANCLASS="acronym">ICMP</SPAN> types that indicates that theconnection can't be made (&quot;destination unavailable&quot;,&quot;network unavailable&quot;, &quot;service unavailable&quot;,&quot;destination adminstratively unavailable&quot;, or&quot;network administratively unavailable&quot;, for example) willhelp an attacker probe your network without giving you much benefit,and you may want to block these outbound.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-08-S3-83">8.12.5.1 Packet filtering characteristics of<SPANCLASS="acronym">ICMP</SPAN></A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15762"></A>As we've said earlier, <SPANCLASS="acronym">ICMP</SPAN> packets do not havesource or destination port numbers, but have a single<SPANCLASS="acronym">ICMP</SPAN> message type field instead. Many packetfiltering systems will let you filter <SPANCLASS="acronym">ICMP</SPAN> packetsbased on that field in the same way they allow you to filter<SPANCLASS="acronym">TCP</SPAN> or <SPANCLASS="acronym">UDP</SPAN> packets based on thesource and destination port number fields. Here are some common<SPANCLASS="acronym">ICMP</SPAN> message types, and how you should handle them (whether you should allow them through your firewall, orblock them).</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Message</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Type[50] </TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Description</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">0</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Echo reply (reply to <EMCLASS="emphasis">ping</EM>; see <EMCLASS="emphasis">ping</EM> section above).</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">3</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Destination unreachable (see <EMCLASS="emphasis">traceroute</EM> sectionabove). May indicate host unreachable, network unreachable, portunreachable, or other.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">4</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Source quench (somebody telling destination &quot;slow down; you'retalking too fast&quot;); should probably be allowed.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">5</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Redirect (somebody telling destination to change a route); is supposedto be ignored by your systems unless it comes from a directly connectedrouter, but should probably be blocked anyway. In particular, make surethe routers that are part of your firewall ignore it.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">8</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Echo request (generated by <EMCLASS="emphasis">ping</EM>; see <EMCLASS="emphasis">ping</EM> section above); shouldprobably be allowed.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">11</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Time exceeded (packet appears to be looping); should probably beallowed.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">12</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"> Parameter problem (problem with a packet header); shouldprobably be allowed.</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[50] <SPANCLASS="acronym">ICMP</SPAN> messages do not have source or destinationport numbers; they have a single <SPANCLASS="acronym">ICMP</SPAN> message typefield instead. <SPANCLASS="acronym">ICMP</SPAN> packets also do not have<SPANCLASS="acronym">ACK</SPAN> bits.</P></BLOCKQUOTE></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-48">8.12.6 Summary of Network ManagementRecommendations</A></H3><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Do not allow <SPANCLASS="acronym">SNMP</SPAN> across your firewall from theInternet. (This may require special <SPANCLASS="acronym">SNMP</SPAN>configurations on your packet filtering routers, which are probablythemselves <SPANCLASS="acronym">SNMP</SPAN>-capable devices.)</P></LI><LICLASS="listitem"><PCLASS="para">Do not allow routing protocols (<SPANCLASS="acronym">RIP</SPAN> or otherwise)across your firewall to or from the Internet. Routing on the firewallis generally very simple and accomplished best with static routes.Simply configure the firewall to direct packets bound for internalsource addresses to an internal router and to direct all otherpackets to your Internet connection.</P></LI><LICLASS="listitem"><PCLASS="para">Allow <SPANCLASS="acronym">ICMP</SPAN> echo requests outbound, but limitincoming <SPANCLASS="acronym">ICMP</SPAN> echo requests to those coming frommachines with a legitimate need to probe your network (such as yournetwork service provider's network operations center). Allow<SPANCLASS="acronym">ICMP</SPAN> echo responses either way.</P></LI><LICLASS="listitem"><PCLASS="para">Allow <EMCLASS="emphasis">traceroute</EM> outbound, but limit incoming<EMCLASS="emphasis">traceroute</EM> requests to those coming from machineswith a legitimate need to probe your network, and limit the port rangeused. </P></LI><LICLASS="listitem"><PCLASS="para">Allow only safe <SPANCLASS="acronym">ICMP</SPAN> message types, as described above.</P></LI></UL><ACLASS="indexterm"NAME="AUTOID-15846"></A><ACLASS="indexterm"NAME="AUTOID-15847"></A></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_11.htm"TITLE="8.11 syslog"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.11 syslog"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_13.htm"TITLE="8.13 Network Time Protocol (NTP)"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.13 Network Time Protocol (NTP)"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.11 syslog</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.13 Network Time Protocol (NTP)</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>