<HTML><HEAD><TITLE>[Chapter 8] 8.17 Printing Protocols (lpr and lp)</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:27:11Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch08_01.htm"TITLE="8. Configuring Internet Services"><LINKREL="prev"HREF="ch08_16.htm"TITLE="8.16 X11 Window System"><LINKREL="next"HREF="ch08_18.htm"TITLE="8.18 Analyzing Other Protocols"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_16.htm"TITLE="8.16 X11 Window System"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.16 X11 Window System"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8<BR>Configuring Internet Services</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_18.htm"TITLE="8.18 Analyzing Other Protocols"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.18 Analyzing Other Protocols"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="FIRE-08-S1-17">8.17 Printing Protocols (lpr and lp)</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH08PRINT"></A><ACLASS="indexterm"NAME="CH08CONFPRINT"></A><ACLASS="indexterm"NAME="CH08LPR"></A><ACLASS="indexterm"NAME="CH08LP"></A>The <SPANCLASS="acronym">BSD</SPAN> <EMCLASS="emphasis">lpr</EM> printing system isvery similar to the <SPANCLASS="acronym">BSD</SPAN> &quot;r&quot; commandsdiscussed earlier in this chapter (<EMCLASS="emphasis">rsh</EM>,<EMCLASS="emphasis">rlogin</EM>, <EMCLASS="emphasis">rcp</EM>,<EMCLASS="emphasis">rdump</EM>, <EMCLASS="emphasis">rdist</EM>). Unlike the&quot;r&quot; commands, <EMCLASS="emphasis">lpr</EM> authorizes hosts,not individual users, and it will accept jobs from hosts in<EMCLASS="emphasis">/etc/printers.equiv</EM> as well as<EMCLASS="emphasis">/etc/hosts.equiv</EM>.</P><PCLASS="para">The System V <EMCLASS="emphasis">lp</EM> printing system doesn't reallyhave a remote printing component. When it does remote printing, itusually does it by handing the job off to a <SPANCLASS="acronym">BSD</SPAN><EMCLASS="emphasis">lpr</EM> printing system, or by using the<SPANCLASS="acronym">BSD</SPAN> <EMCLASS="emphasis">rsh</EM> command (which isoften called <EMCLASS="emphasis">remsh</EM> on System V systems, becausesuch systems have another program called <EMCLASS="emphasis">rsh</EM>that does something else entirely).</P><PCLASS="para">Given the deficiencies of both <EMCLASS="emphasis">lp</EM> and<EMCLASS="emphasis">lpr</EM>, many <SPANCLASS="acronym">UNIX</SPAN> vendorsimplement their own solutions to remote printing. Other platforms maysupport <EMCLASS="emphasis">lp</EM>, <EMCLASS="emphasis">lpr</EM>, a separateprotocol, or some combination. Because it has its own protocol, whichis somewhat easier to implement than <EMCLASS="emphasis">rsh</EM>,<EMCLASS="emphasis">lpr</EM> is more popular than <EMCLASS="emphasis">lp</EM>on non-<SPANCLASS="acronym">UNIX</SPAN> systems, but many of them have theirown protocols. Some printers are network devices in their own right,sometimes speaking <EMCLASS="emphasis">lp</EM> or <EMCLASS="emphasis">lpr</EM>directly, and sometimes (particularly older printers) speaking aprotocol developed by the printer manufacturer.</P><PCLASS="para">For the most part, the wide variety of other network printingprotocols that are out there share a common feature; they're no moresecure than <EMCLASS="emphasis">lpr</EM>. Most of them are not even assecure as <EMCLASS="emphasis">lpr</EM> (if you can reach the system with aprint request in the right protocol, it will print it). Because modernPostScript printers can be intelligent Ethernet devices with their owndisks, it is theoretically possible for a rogue print job to turn oneinto a network sniffing device. In practice, this is a baroquelycomplex approach; attackers aren't very likely to succeed at it. However, more mundane denial of serviceattacks on printers are eminently possible, and in fact have beenknown to happen.</P><PCLASS="para">Some are merely annoying, such as simply printing page after page ofgarbage (or, better yet, something offensive to the victim or theircoworkers) until the printer runs out of paper. Unfortunately, thenastiest of them are enabled by a security feature in PostScript.PostScript was designed to protect certain dangerous commands byrequiring a password before they were executed. This password isstored in an <SPANCLASS="acronym">EEPROM</SPAN> chip on the printer, and isfactory-set to &quot;0&quot; on every brand of PostScriptprinter. It's always the same because it <EMCLASS="emphasis">must</EM>always be the same. Some of the commands that the PostScript designersconsidered dangerous are routinely used by standard PostScriptdrivers, and if you change the password, those drivers will no longerwork. Because, in order to reset it, you need either the old passwordor a <SPANCLASS="acronym">ROM</SPAN> burner, a program that uses the well-known&quot;0&quot; password to reset the password to something unknowncan make printers effectively unusable until new<SPANCLASS="acronym">EEPROM</SPAN>s are sent from the factory. (Some printerswill run without the <SPANCLASS="acronym">EEPROM</SPAN>, with an effectivepassword of 0.) Removing or replacing the <SPANCLASS="acronym">EEPROM</SPAN>resets not only the password, but also the printer<SPANCLASS="acronym">ID</SPAN> and the page count; if you have fonts licensedto the printer, they will have to be relicensed. Since the last waveof such attacks, licensing of fonts to individual printers has becomeuncommon.</P><PCLASS="para">The intelligence and vulnerability of PostScript devices makes itimportant to protect your printers from Internet access. Make sure youhave blocked any remote printing protocols your machines and printersuse. You will need to check every printer type and every machine typeseparately.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-60">8.17.1 Packet Filtering Characteristics oflpr</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-16628"></A><EMCLASS="emphasis">lpr</EM> is <SPANCLASS="acronym">TCP</SPAN>-based. Servers useport 515. Clients use random ports below 1024,just like the <SPANCLASS="acronym">BSD</SPAN> &quot;r&quot; commands, asdiscussed above.</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direc-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Pro-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">ACK</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tion</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Addr.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tocol</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Set</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Notes</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">515</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[53]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming <EMCLASS="emphasis">lpr</EM>, client to server</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">515</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Incoming <EMCLASS="emphasis">lpr</EM>, server to client</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">515</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[53]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing <EMCLASS="emphasis">lpr</EM>, client to server</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ext</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">int</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">515</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;1024</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Outgoing <EMCLASS="emphasis">lpr</EM>, server to client</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[53] <SPANCLASS="acronym">ACK</SPAN> is not set on the first packet of this type(establishing connection) but will be set on the rest.</P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-61">8.17.2 Proxying Characteristics of lpr</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-16748"></A><EMCLASS="emphasis">lpr</EM> is a store-and-forward protocol, capable ofbeing configured to do its own proxying. You can simply run a standard<EMCLASS="emphasis">lpr</EM> configuration on your proxy server andconfigure it to drive whatever printers you like or pass jobs toanother server. This does not provide security improvements overdirect <EMCLASS="emphasis">lpr</EM>, but it will let it cross anonrouting host.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-62">8.17.3 Packet Filtering and ProxyingCharacteristics of lp</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-16758"></A><ACLASS="indexterm"NAME="AUTOID-16762"></A><EMCLASS="emphasis">lp</EM> itself provides no remote printing support. Ithandles printing across the network by using either<EMCLASS="emphasis">rsh</EM>, which is covered above with the other<SPANCLASS="acronym">BSD</SPAN> &quot;r&quot; commands, or<EMCLASS="emphasis">lpr</EM>. To determine what your printer configurationis using, configure a remote printer and read its interface file(which is usually stored in<EMCLASS="emphasis">/usr/spool/lp/interfaces/printername</EM>). Somevendors may also provide novel remote printing systems for use with<EMCLASS="emphasis">lp</EM>; you will need to consult your vendordocumentation.<ACLASS="indexterm"NAME="AUTOID-16772"></A><ACLASS="indexterm"NAME="AUTOID-16773"></A><ACLASS="indexterm"NAME="AUTOID-16774"></A><ACLASS="indexterm"NAME="AUTOID-16775"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-08-S2-63">8.17.4 Summary Recommendations for PrintingProtocols</A></H3><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Do not permit printing protocols across your firewall.</P></LI></UL></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_16.htm"TITLE="8.16 X11 Window System"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.16 X11 Window System"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_18.htm"TITLE="8.18 Analyzing Other Protocols"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.18 Analyzing Other Protocols"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.16 X11 Window System</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.18 Analyzing Other Protocols</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>