<HTML><HEAD><TITLE>[Chapter 9] Two Sample Firewalls</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:27:28Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part02.htm"TITLE="II. Building Firewalls"><LINKREL="prev"HREF="ch08_18.htm"TITLE="8.18 Analyzing Other Protocols"><LINKREL="next"HREF="ch09_02.htm"TITLE="9.2 Screened Host Architecture"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_18.htm"TITLE="8.18 Analyzing Other Protocols"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.18 Analyzing Other Protocols"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 9</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_02.htm"TITLE="9.2 Screened Host Architecture"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.2 Screened Host Architecture"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="FIRE-09-CHP">9. Two Sample Firewalls</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="SECT1"HREF="#FIRE-09-S1-1"TITLE="9.1 Screened Subnet Architecture">Screened Subnet Architecture</A><BR><ACLASS="SECT1"HREF="ch09_02.htm"TITLE="9.2 Screened Host Architecture">Screened Host Architecture</A></P><P></P></DIV><PCLASS="para"><ACLASS="indexterm"NAME="CH09FWS"></A>In this chapter, we describe two sample configurations for basicfirewalls. Almost any real firewall is going to be more complex thanthose described in this chapter, but this presentation should give yousome idea of the tasks involved in building a firewall and how thevarious pieces fit together.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> We want to emphasize that these examples are just that: examples. Youshouldn't blindly implement one of these examples, without first takingthe time to understand your own needs, your environment, andthe implications and complications of the services you want yourfirewall to provide. </P></BLOCKQUOTE><PCLASS="para">The services that we're going to provide through these samplefirewalls are just the basics: terminal access, file transfer,electronic mail, Usenet news, the World Wide Web,and <SPANCLASS="acronym">DNS</SPAN>. See <ACLASS="xref"HREF="ch08_01.htm"TITLE="Configuring Internet Services">Chapter 8, <CITECLASS="chapter">Configuring Internet Services</CITE></A> for afull discussion of these and other services.</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="FIRE-09-S1-1">9.1 Screened Subnet Architecture</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH09SSA"></A><ACLASS="indexterm"NAME="CH09SSA2"></A>The screened subnet architecture, described in <ACLASS="xref"HREF="ch04_01.htm"TITLE="Firewall Design">Chapter 4, <CITECLASS="chapter">Firewall Design</CITE></A> and shown in <ACLASS="xref"HREF="ch09_01.htm#FIRE-09-FIG-1"TITLE="Screened subnet architecture ">Figure 9.1</A>,is probably the most common do-it-yourself firewall architecture. Thisarchitecture provides good security (including multiple layers ofredundancy) at what most sites feel is a reasonable cost.</P><H4CLASS="figure"><ACLASS="title"NAME="FIRE-09-FIG-1">Figure 9.1: Screened subnet architecture </A></H4><IMGCLASS="graphic"SRC="figs/fire0901.gif"ALT="Figure 9.1"><PCLASS="para">There are two-router and single-router variations of the screened subnetarchitecture. Basically, you can use either a pair of two-interfacerouters or a single three-interface router. The single-router screenedsubnet architecture works about as well as the two-router screenedsubnet architecture, and is often somewhat cheaper. However, you need touse a router that can handle both inbound andoutbound packet filtering on each interface. (See the discussion of thispoint in <ACLASS="xref"HREF="ch06_01.htm"TITLE="Packet Filtering">Chapter 6, <CITECLASS="chapter">Packet Filtering</CITE></A>.) We're going to use a two-routerarchitecture as our example in this section because it is conceptuallysimpler.</P><PCLASS="para">The components of this type of firewall include the following:<ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Perimeter network</P></LI><LICLASS="listitem"><PCLASS="para">Exterior router</P></LI><LICLASS="listitem"><PCLASS="para">Interior router</P></LI><LICLASS="listitem"><PCLASS="para">Bastion host</P></LI></UL></P><PCLASS="para">Let's review briefly the purposes of these various components, presentedoriginally in <ACLASS="xref"HREF="ch04_01.htm"TITLE="Firewall Design">Chapter 4</A>. </P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">Perimeter network</EM></DT><DDCLASS="listitem"><PCLASS="para">Isolates your bastion host from your internal network, so asecurity breach on the bastion host won't immediately affect yourinternal network. </P></DD><DTCLASS="term"><EMCLASS="emphasis">Exterior router</EM></DT><DDCLASS="listitem"><PCLASS="para">Connects your site to the outside world. If possible, the exteriorrouter also provides at least some protection for the bastion host,interior router, and internal network. (This isn't always possible,because some sites use exterior routers that are managed by theirnetwork service providers and are therefore beyond the site'scontrol.)  </P></DD><DTCLASS="term"><EMCLASS="emphasis">Interior router</EM></DT><DDCLASS="listitem"><PCLASS="para">Protects the internal network from the world and from thesite's own bastion host. </P></DD><DTCLASS="term"><EMCLASS="emphasis">Bastion host</EM></DT><DDCLASS="listitem"><PCLASS="para">Serves as the site's main point of contact with theoutside world. (It should be set up according to the guidelines in<ACLASS="xref"HREF="ch05_01.htm"TITLE="Bastion Hosts">Chapter 5, <CITECLASS="chapter">Bastion Hosts</CITE></A>.)</P></DD></DL><PCLASS="para">In addition to the machines that make up the firewall itself, assumethere are machines on the internal network (internal hosts) thatfulfill the following roles. (Note that any given internal machinemight fill any, or even all, of these roles.)<ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Mail server</P></LI><LICLASS="listitem"><PCLASS="para">Usenet news server</P></LI><LICLASS="listitem"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN> server</P></LI><LICLASS="listitem"><PCLASS="para">Client for various Internet services</P></LI></UL></P><PCLASS="para">Each of these internal services is provided directly (via packetfiltering) or indirectly (via proxy servers running on the bastionhost).</P><PCLASS="para">We're going to assume (at least for the purposes of this example) thatinternal users in our system are trusted not to actively try tocircumvent the firewall, and that there is no particular need to monitoror log their Internet activities.</P><PCLASS="para">We're also going to assume that you are using properly assigned androuted <SPANCLASS="acronym">IP</SPAN> addresses (that is, addresses assigned toyour site, and properly routed and advertised to the rest of theInternet by your service provider) for your internal and perimeternetworks. If you aren't, you have no choice but to use proxies,because you can't allow packets with those unassigned<SPANCLASS="acronym">IP</SPAN> addresses out onto the Internet; even if youdid, replies would have no way to come back to you.</P><PCLASS="para">Finally, we're going to assume you're using separate networknumbers for your perimeter net and internal net, so that you can detectforged packets easily. (See the discussion in &quot;Risks of Filteringby Source Address&quot; in <ACLASS="xref"HREF="ch06_01.htm"TITLE="Packet Filtering">Chapter 6</A>.)</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-09-S2-1">9.1.1 Service Configuration</A></H3><PCLASS="para">Given the architecture we've just described, how do we provide the basicInternet services?</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-1">9.1.1.1 Telnet</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-16890"></A><ACLASS="indexterm"NAME="AUTOID-16894"></A>Outgoing Telnet could be provided through packet filtering or throughproxies. Which approach should we use?</P><PCLASS="para">Proxying will require either modified clients or modified userprocedures; either one will be tedious to implement for somebody.Proxying would allow us to restrict or monitor Telnet usage by user byforcing our users to authenticate to a proxy server before completingtheir requests. However, remember that we have decided to assumeinternal users are trustworthy, so there is no need forauthentication.  Proxying would be necessary if we were usingunassigned or unadvertised <SPANCLASS="acronym">IP</SPAN> addresses internally,but that's not the case here, either. Because we have trustworthyusers and proper <SPANCLASS="acronym">IP</SPAN> addresses, proxying for Telnetdoesn't provide any advantage over packet filtering, and it's moredifficult to set up and maintain. Therefore, for this example we'regoing to provide outgoing Telnet via packet filtering.</P><PCLASS="para">Incoming Telnet is considerably more difficult to provide safely andconveniently. If it were necessary, incoming Telnet could be provided onthe bastion host using extra authentication. However, for a site thatis looking for a simple configuration, the reasonable thing to do is todisallow incoming Telnet altogether. That's what we'll do for thisexample.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-2">9.1.1.2 <SPANCLASS="acronym">FTP</SPAN></A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-16906"></A><ACLASS="indexterm"NAME="AUTOID-16910"></A>Unlike Telnet, <SPANCLASS="acronym">FTP</SPAN> doesn't lend itself to a purepacket filtering solution. Because normal mode <SPANCLASS="acronym">FTP</SPAN>requires an incoming connection to an arbitrary port over 1023, tryingto allow it without doing anything else gives attackers access toall kinds of services running on our internal systems. That leaves ustwo choices:<ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Support passive mode via packet filtering</P></LI><LICLASS="listitem"><PCLASS="para">Support normal mode via proxies</P></LI></UL></P><PCLASS="para">In either case, the standard <SPANCLASS="acronym">FTP</SPAN> clients shippedwith <SPANCLASS="acronym">UNIX</SPAN> operating systems, and most of thepopular, publicly available clients for personal computers, won't workthe normal way. If we use the <SPANCLASS="acronym">TIS FWTK</SPAN><EMCLASS="emphasis">ftp-gw</EM> proxy gateway (described in <ACLASS="xref"HREF="ch07_01.htm"TITLE="Proxy Systems">Chapter 7, <CITECLASS="chapter">Proxy Systems</CITE></A>), we can use unmodified clients, but at thecost of teaching the users to follow special procedures. Somepopular <SPANCLASS="acronym">FTP</SPAN> clients&nbsp;- the ones built in to Webbrowsers like Netscape Navigator or Mosaic&nbsp;- douse passive mode without being modified, but then again, not allservers support it well.</P><PCLASS="para">A reasonable compromise would be to use packet filtering andproxies, using a proxying gateway like <EMCLASS="emphasis">ftp-gw</EM>from the <SPANCLASS="acronym">TIS FWTK</SPAN> that doesn't require modificationof the clients. Clients that support passive mode will work via thepacket filters. On platforms where we can easily replace the providedclients, we can provide passive mode clients; on platforms where wecan't easily replace the clients, we can modify user procedures.</P><PCLASS="para">As we've said, if we wanted to monitor <SPANCLASS="acronym">FTP</SPAN> usage,or if we were using an unassigned or unrouted network number, we'dhave to do exclusively proxying, but that's not the case here. We alsomight want to use proxying exclusively if we decided to hide<SPANCLASS="acronym">DNS</SPAN> data&nbsp;- it would save us the trouble of fakingdata for double-reverse lookups&nbsp;- but hiding <SPANCLASS="acronym">DNS</SPAN>data is more trouble than it's worth. In a situation where proxying isused exclusively, we'd have to reconsider which proxy server touse. Requiring users to modify their procedures makes sense here,because there are no other options. The balance might come outdifferently if everybody were proxying.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-16936"></A><ACLASS="indexterm"NAME="AUTOID-16938"></A>Be aware that in order to use the <SPANCLASS="acronym">TIS FWTK</SPAN><EMCLASS="emphasis">ftp-gw</EM> proxy server on your bastion host, yourpacket filtering will have to allow <SPANCLASS="acronym">TCP</SPAN> connectionsfrom ports above 1023 on your bastion host to ports above 1023 oninternal hosts, and from port 20 on external hosts to ports above 1023on your bastion host, for <SPANCLASS="acronym">FTP</SPAN> data channels. (Seethe discussion of <SPANCLASS="acronym">FTP</SPAN> in <ACLASS="xref"HREF="ch08_01.htm"TITLE="Configuring Internet Services">Chapter 8</A>.) This means that someone who breaks in to thebastion host could easily connect to any server on any internal hostthat uses a <SPANCLASS="acronym">TCP</SPAN> port above 1023 (for example, anX11 server on port 6000). Further, any servers that are using suchports (that is, <SPANCLASS="acronym">TCP</SPAN> ports above 1023) on thebastion host itself are also vulnerable. For this reason, if you allowthese <SPANCLASS="acronym">FTP</SPAN> data connections at all for proxying, youprobably want to explicitly block access to internal systems to<SPANCLASS="acronym">TCP</SPAN> ports above 1023 where you know, or have goodcause to suspect, that servers might be listening. At the very least,such ports probably include 6000 through around 6003 (assuming four orfewer real or virtual X11 servers per machine; see the discussion ofX11 in <ACLASS="xref"HREF="ch08_01.htm"TITLE="Configuring Internet Services">Chapter 8</A>).</P><PCLASS="para">Keep in mind, however, that blocking specific ports, rather thanblocking all ports by default and then allowing specific ports, isgenerally a dangerous strategy. It's hard to develop andmaintain a complete list of ports that need to be blocked at your site. It would be better to block everything by default and then allowonly specific ports, but you can't do that with standard (nonpassive)<SPANCLASS="acronym">FTP</SPAN>, because of the way it works.</P><PCLASS="para">Allowing passive-mode <SPANCLASS="acronym">FTP</SPAN> with packet filtering isa fairly liberal approach, because it allows pretty much anyconnection to go through as long as it is initiated by the inside. Thenumber of servers above port 1023 is very large. This has someadvantages (it lets users access nonstandard <SPANCLASS="acronym">HTTP</SPAN>servers, for example), but it may also allow users to access all kindsof services that are unsafe. In allowing it, we're assuming that ourusers are not only well-intentioned, they're also capable of tellingthe difference between a safe and an unsafe connection, or at leastavoiding the temptation to do unexpected things.</P><PCLASS="para">Because we've denied incoming Telnet, it makes sense to deny incominguser <SPANCLASS="acronym">FTP</SPAN> as well. Both services requireapproximately the same security measures, and making one of themavailable would make configuring the other trivial.</P><PCLASS="para">Incoming anonymous <SPANCLASS="acronym">FTP</SPAN> is a different matter, andwe'll provide it.  Because we're not a major Internet serviceprovider, and because we're using the <SPANCLASS="acronym">TIS FWTK</SPAN>already anyway, we can go for security over features and use the<SPANCLASS="acronym">TIS FWTK</SPAN> anonymous <SPANCLASS="acronym">FTP</SPAN>server. If we were going to provide major anonymous<SPANCLASS="acronym">FTP</SPAN>, we'd probably want to use the morefeature-filled <EMCLASS="emphasis">wuarchive</EM> <SPANCLASS="acronym">FTP</SPAN>server (see <ACLASS="xref"HREF="ch08_01.htm"TITLE="Configuring Internet Services">Chapter 8</A> for a description of itscapabilities), and run it on a machine that was not the main bastionhost but that was still a bastion host on the perimeter network.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-3">9.1.1.3 <SPANCLASS="acronym">SMTP</SPAN></A></H4><PCLASS="para"><ACLASS="indexterm"NAME="CH09SMTPCONF"></A><ACLASS="indexterm"NAME="CH09CONFSMTP"></A>There aren't many options for <SPANCLASS="acronym">SMTP</SPAN> inany configuration. We want all external <SPANCLASS="acronym">SMTP</SPAN>connections to go to a single machine with a secured<SPANCLASS="acronym">SMTP</SPAN> server, and we don't trust random internalmachines to have safe <SPANCLASS="acronym">SMTP</SPAN> servers. That means we'll put a secured <SPANCLASS="acronym">SMTP</SPAN> server on the bastionhost and use <SPANCLASS="acronym">DNS MX</SPAN> records to direct all incomingmail to the bastion host, which will then pass all the incoming mailto a single internal secured <SPANCLASS="acronym">SMTP</SPAN> server.</P><PCLASS="para">What other options do we have? We could put a secure<SPANCLASS="acronym">SMTP</SPAN> server on the internal mail server and directincoming mail to it, but if that <SPANCLASS="acronym">SMTP</SPAN> server werecompromised, the entire internal net would then be at risk.Alternatively, we could have the bastion host send mail directly tomachines on the internal network, but once again, we'd be increasingour vulnerability if the <SPANCLASS="acronym">SMTP</SPAN> server on the bastionhost were compromised.  The compromised bastion host would be speakingto untrustworthy internal <SPANCLASS="acronym">SMTP</SPAN> servers, andcompromise of the internal net would quickly follow.  If the bastionhost can speak only to the internal mail server, that narrows thepossible attacks it can make; the internal mail server can run asecured <SPANCLASS="acronym">SMTP</SPAN> server. Furthermore, by making thischoice, messy maintenance tasks are transferred from thesecurity-critical bastion host to the less vulnerable internal mailserver.</P><PCLASS="para">How about outgoing mail? It would probably be safe to allow internalmachines to send mail directly to the outside world, but doing socreates a maintenance headache. (You have to watch the mailconfiguration on all the internal machines.) Besides, doing this opensanother direct connection between the internal and external networks.There aren't any known ways for an <SPANCLASS="acronym">SMTP</SPAN>server to attack an <SPANCLASS="acronym">SMTP</SPAN> client, but strangerthings have happened.</P><PCLASS="para">Allowing internal machines to send mail directly to the outside worlddoesn't seem to bring much advantage either. The only difference itmakes is that we'd be able to send mail (but not receive it) when thebastion host is down. </P><PCLASS="para">No matter what decision we make, we'll have to configure our mailclients. (Unlike <SPANCLASS="acronym">FTP</SPAN> and Telnet,<SPANCLASS="acronym">SMTP</SPAN> does not work as installed without modifyingconfiguration files.) In addition, the work to direct the mail to aserver is less than the work to correctly send it to the externaluniverse.</P><PCLASS="para">The only real question is whether to direct the outgoing mail from theinternal machines to the internal mail server or to the bastion host.Directing it to the internal mail server has the same advantagesfor incoming mail, but the advantages are much smaller. Sendingoutgoing mail presents little risk to start with, so reducing therisk isn't worth much. Sending outgoing mail also doesn't involveconfigurations that change often enough to make it worrisome to maintainthe bastion host. On the other hand, the cost of going through theinternal mail server&nbsp;- in complexity, possible points of failure, anddelay&nbsp;- is just as high for outgoing mail as for incoming mail. It nolonger looks like an attractive bargain, so we'll direct the outgoingmail to the bastion host without using the internal mail server as anintermediary.</P><PCLASS="para">We'll set up <SPANCLASS="acronym">SMTP</SPAN>, as outlined in <ACLASS="xref"HREF="ch08_01.htm"TITLE="Configuring Internet Services">Chapter 8</A>, with the bastion host acting as a middleman forincoming and outgoing mail. Here's what to do:<ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Publish <SPANCLASS="acronym">DNS MX</SPAN> records that direct incoming mail forthe site to the bastion host.</P></LI><LICLASS="listitem"><PCLASS="para">Configure internal machines to send all outgoing mail to thebastion host.</P></LI><LICLASS="listitem"><PCLASS="para">Configure the bastion host to send all incoming mail to a singleinternal mail server and to send outgoing mail directly to destinationmachines.</P></LI></UL></P><PCLASS="para">For this example, we're going to assume there is a single internalmail server for incoming mail, and that internal machines send theiroutgoing mail directly to the bastion host (rather than indirectly viathe mail server).<ACLASS="indexterm"NAME="AUTOID-17013"></A><ACLASS="indexterm"NAME="AUTOID-17014"></A></P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-4">9.1.1.4 <SPANCLASS="acronym">NNTP</SPAN></A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-17019"></A><ACLASS="indexterm"NAME="AUTOID-17023"></A>As we've discussed in <ACLASS="xref"HREF="ch08_01.htm"TITLE="Configuring Internet Services">Chapter 8</A>, the most practicalway to set up <SPANCLASS="acronym">NNTP</SPAN> across a firewall is to allowyour <SPANCLASS="acronym">NNTP</SPAN> service provider(s) to talk directly toyour internal Usenet news host, and vice versa. We'd need anoverwhelming reason to do something else, and it's hard to imagineone.  Even if we didn't have an existing internal news host, buildingone isn't any harder than building a news server on the bastion host,and it's safer by a vast margin. News servers fail with drearyregularity; while the problems usually aren't security-related, youstill don't want to install anything high-maintenance on a bastionhost.</P><PCLASS="para">For this example, we're going to assume a single external<SPANCLASS="acronym">NNTP</SPAN> newsfeed.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-5">9.1.1.5 <SPANCLASS="acronym">HTTP</SPAN></A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-17036"></A><ACLASS="indexterm"NAME="AUTOID-17040"></A>As with the other services, for <SPANCLASS="acronym">HTTP</SPAN> we can useeither packet filtering or proxy servers to provide service tointernal clients. Packet filtering will allow our users to access<SPANCLASS="acronym">HTTP</SPAN> servers only on standard ports; proxying willallow them to reach all <SPANCLASS="acronym">HTTP</SPAN> servers. Whichapproach should we take?</P><PCLASS="para">For Telnet and <SPANCLASS="acronym">FTP</SPAN>, the major drawback of proxyingwas that it required special clients; for <SPANCLASS="acronym">HTTP</SPAN>,though, standard browsers support <SPANCLASS="acronym">HTTP</SPAN>proxying. Proxying will increase configuration overhead, but thatprice seems fair for the increased abilities it offers. On the otherhand, we've already decided to allow internal hosts to create outgoingconnections to any port at or above 1024 in order to allow passive-mode<SPANCLASS="acronym">FTP</SPAN> directly from internal hosts to externalhosts. That will allow access to almost any <SPANCLASS="acronym">HTTP</SPAN>server (any one using a port at or above 1024, anyway). Using purepacket filtering would lose us only <SPANCLASS="acronym">HTTP</SPAN> servers atnonstandard ports below 1024, and those ports are all supposed to bereserved anyway.</P><PCLASS="para">If we use the <SPANCLASS="acronym">CERN HTTP</SPAN> server as our proxy server,the server can also cache Web pages. Doing so can significantlyimprove performance for all of the following:<DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">HTTP</SPAN> clients</EM></DT><DDCLASS="listitem"><PCLASS="para">They obtain pages from thecache over the internal network, rather than from the original serverover our Internet connection, which is probably much slower.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Non-<SPANCLASS="acronym">HTTP</SPAN> clients</EM></DT><DDCLASS="listitem"><PCLASS="para">The <SPANCLASS="acronym">HTTP</SPAN> clients won't be using so much of thebandwidth of our Internet connection.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">HTTP</SPAN> servers at other sites</EM></DT><DDCLASS="listitem"><PCLASS="para">They will only get one request from our site for a given page, ratherthan multiple requests.</P></DD></DL></P><PCLASS="para">The <SPANCLASS="acronym">CERN</SPAN> server will also allow us to provide<SPANCLASS="acronym">HTTP</SPAN> service to external sites, so we'll takeadvantage of that to publish our site's own public<SPANCLASS="acronym">WWW</SPAN> pages.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-17081"></A><ACLASS="indexterm"NAME="AUTOID-17085"></A><SPANCLASS="acronym">HTTP</SPAN> proxying is also trivial to add once you haveother things proxied via <SPANCLASS="acronym">SOCKS</SPAN> or<SPANCLASS="acronym">TIS FWTK</SPAN>. If we had <SPANCLASS="acronym">SOCKS</SPAN>running, it would be very tempting to simply proxy through it, because<SPANCLASS="acronym">SOCKS</SPAN> is one of the systems that many of the browserssupport. All of the proxy servers we've already decided to run arepart of the <SPANCLASS="acronym">TIS FWTK</SPAN>, however, and we'd have toinstall <SPANCLASS="acronym">SOCKS</SPAN> just for <SPANCLASS="acronym">HTTP</SPAN> ifwe wanted to use it. If we used the <SPANCLASS="acronym">TIS FWTK HTTP</SPAN>proxy, we'd have to get the users to modify <SPANCLASS="acronym">URL</SPAN>sthey use.  In this case, the proxy servers wouldn't be able to cut andpaste out of their electronic mail when people tell them about coolnew things.  Neither <SPANCLASS="acronym">SOCKS</SPAN> nor <SPANCLASS="acronym">TIS FWTK</SPAN> makes an attractive option in this situation.</P><PCLASS="para">However, both proxying (through the <SPANCLASS="acronym">CERN</SPAN> server)and packet filtering appear to be attractive and reasonablechoices. Proxying would definitely be preferable if we weren't alreadyproviding passive-mode <SPANCLASS="acronym">FTP</SPAN> directly (which givesour users the ability to talk to servers on any <SPANCLASS="acronym">TCP</SPAN>port above 1023). On the other hand, packet filtering would definitelybe preferable if we wanted to use clients that didn't come withbuilt-in support for proxying, or if we wanted not to provide an<SPANCLASS="acronym">HTTP</SPAN> server and had no other services beingproxied.</P><PCLASS="para">For this example, we're going to assume that we're providing<SPANCLASS="acronym">HTTP</SPAN> service to internal clients via a<SPANCLASS="acronym">CERN</SPAN> proxy server running on the bastion host, andthat we're using the same server to publish our public<SPANCLASS="acronym">WWW</SPAN> pages to the world.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-6">9.1.1.6 <SPANCLASS="acronym">DNS</SPAN></A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-17114"></A><ACLASS="indexterm"NAME="AUTOID-17118"></A>As discussed in <ACLASS="xref"HREF="ch08_01.htm"TITLE="Configuring Internet Services">Chapter 8</A>, <SPANCLASS="acronym">DNS</SPAN>across a firewall is best provided with a pair of servers: one on thebastion host, the other on an internal host. Like<SPANCLASS="acronym">NNTP</SPAN>, <SPANCLASS="acronym">DNS</SPAN> presents a situationin which the number of rational solutions is clearly limited. We needto decide whether to use separate internal and external servers to doinformation hiding, or whether we should allow the external world tosee all of our host data.  By deciding to allow direct passive-mode<SPANCLASS="acronym">FTP</SPAN>, we've already made that decisionindirectly. Direct passive-mode <SPANCLASS="acronym">FTP</SPAN> would requireintricate <SPANCLASS="acronym">DNS</SPAN> setup to support information hidingand still provide valid data for the internal hosts that are<SPANCLASS="acronym">FTP</SPAN> clients.</P><PCLASS="para">For this example, we're going to assume the<SPANCLASS="acronym">DNS</SPAN> server on the bastion host is a secondaryserver for our domain, and the primary server is on an internalhost. We're not going to do any <SPANCLASS="acronym">DNS</SPAN> informationhiding.</P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-09-S2-2">9.1.2 Packet Filtering Rules</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="CH09PFEXAMPLERULES"></A>Based on the configuration decisions we've made in the previoussections, let's look at the packet filtering rules necessary tosupport this configuration. We assume an &quot;ideal&quot; router(as discussed in &quot;Choosing a Packet Filtering Router&quot; in<ACLASS="xref"HREF="ch06_01.htm"TITLE="Packet Filtering">Chapter 6</A>). If our router were less than ideal interms of capabilities, we'd need to modify these rulesaccordingly, probably at the cost of security. We might have torethink several crucial decisions entirely.  For example, if wecouldn't filter on the <SPANCLASS="acronym">ACK</SPAN> bit, direct outboundpassive-mode <SPANCLASS="acronym">FTP</SPAN> would no longer be acceptablysafe, and a lot of our other decisions have used that as a majorfactor. (See <ACLASS="xref"HREF="ch06_01.htm"TITLE="Packet Filtering">Chapter 6</A> for a full discussion ofpacket filtering capabilities, and the implications of not havingparticular capabilities.)</P><PCLASS="para">In the packet filtering rules presented below, we assume that thefiltering system: <ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Can distinguish between incoming and outgoing packets</P></LI><LICLASS="listitem"><PCLASS="para">Can filter on source address, destination address, packet type(<SPANCLASS="acronym">TCP</SPAN> or <SPANCLASS="acronym">UDP</SPAN>), source port, anddestination port</P></LI><LICLASS="listitem"><PCLASS="para">Can filter on whether or not the <SPANCLASS="acronym">ACK</SPAN> bit is set (for<SPANCLASS="acronym">TCP</SPAN> packets)</P></LI><LICLASS="listitem"><PCLASS="para">Applies rules in the order listed</P></LI></UL></P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-7">9.1.2.1 Interior Router</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="CH09IRCONF"></A><ACLASS="indexterm"NAME="CH09CONFIR"></A>The purpose of the interior router is to protect the internal networkfrom the Internet and from your own bastion host. The interior routerneeds the following rules to support the outlined configuration. Explanations of each rule follow the table.</P><PCLASS="para"></P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direc-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Pro-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><SPANCLASS="acronym">ACK</SPAN></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Rule</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tion</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Address</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Address</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tocol</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Set</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Action</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Spoof</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">In</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Internal</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Any</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Deny</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Telnet-1</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">23</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Telnet-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">23</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">21</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">21</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-3</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-4</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-5</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">21</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-6</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">21</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-7</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">6000-6003</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Deny</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-8</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-9</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">SMTP</SPAN>-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">25</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">SMTP</SPAN>-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">25</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">SMTP</SPAN>-3</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">SMTP</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">25</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">SMTP</SPAN>-4</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">SMTP</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">25</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN>-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">NNTP</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN> feed server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN>-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN> feed server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">NNTP</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN>-3</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN> feed server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">NNTP</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN>-4</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">NNTP</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN> feed server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">HTTP</SPAN>-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">80</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">HTTP</SPAN>-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">80</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">DNS</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[1]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">DNS</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[1]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-3</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">DNS</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-4</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">DNS</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-5</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">DNS</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-6</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">DNS</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Default-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Deny</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Default-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Deny</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] <SPANCLASS="acronym">UDP</SPAN> packets do not have ACK bits.</P></BLOCKQUOTE><PCLASS="para">Here is some additional information about each set of rules in thistable:<DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">Spoof</EM></DT><DDCLASS="listitem"><PCLASS="para">Blocks incoming packets that claim to have internal<SPANCLASS="acronym">IP</SPAN> addresses (that is, forged packets presumablysent by an attacker).</P></DD><DTCLASS="term"><EMCLASS="emphasis">Telnet-1 and Telnet-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow outgoing Telnet connections.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">FTP</SPAN>-1 and <SPANCLASS="acronym">FTP</SPAN>-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow outgoing connections to <SPANCLASS="acronym">FTP</SPAN> servers, for useby passive-mode internal clients that are interacting with thoseservers directly.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">FTP</SPAN>-3 and <SPANCLASS="acronym">FTP</SPAN>-4</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow the <SPANCLASS="acronym">FTP</SPAN> data channel connections frompassive-mode internal clients to external <SPANCLASS="acronym">FTP</SPAN>servers. Note that these rules actually allow all connections frominternal <SPANCLASS="acronym">TCP</SPAN> ports above 1023 to external<SPANCLASS="acronym">TCP</SPAN> ports above 1023. That may be more than youwant to allow, but there's no way to cover passive-mode<SPANCLASS="acronym">FTP</SPAN> with anything less broad, and connections areat least restricted to those opened from the inside.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">FTP</SPAN>-5 and <SPANCLASS="acronym">FTP</SPAN>-6</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow normal (nonpassive-mode) internal <SPANCLASS="acronym">FTP</SPAN>clients to open an <SPANCLASS="acronym">FTP</SPAN> command channel to the proxy<SPANCLASS="acronym">FTP</SPAN> server on the bastion host.  Note that theserules are actually redundant if you have rules<SPANCLASS="acronym">FTP</SPAN>-1 and <SPANCLASS="acronym">FTP</SPAN>-2 in place earlierin the list, because &quot;Bastion&quot; as a source or destination(covered by rules <SPANCLASS="acronym">FTP</SPAN>-5 and<SPANCLASS="acronym">FTP</SPAN>-6) is a subset of &quot;All&quot; (covered byrules <SPANCLASS="acronym">FTP</SPAN>-1 and <SPANCLASS="acronym">FTP</SPAN>-2). Havingthese redundant rules is going to impose a slight performance cost,but makes the rule set easier to understand. It also makes it possibleto change rules <SPANCLASS="acronym">FTP</SPAN>-1 and <SPANCLASS="acronym">FTP</SPAN>-2(e.g., if you decide you don't want to support passive-modeclients) without accidentally breaking normal-mode client access tothe proxy server.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">FTP</SPAN>-7 through <SPANCLASS="acronym">FTP</SPAN>-9</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow <SPANCLASS="acronym">FTP</SPAN> data connections from the proxy server onthe bastion host to nonpassive internal clients. The<SPANCLASS="acronym">FTP</SPAN>-7 rule prevents an attacker who has gainedaccess to the bastion host from attacking internal X11 servers via thehole created by rules <SPANCLASS="acronym">FTP</SPAN>-8 and<SPANCLASS="acronym">FTP</SPAN>-9. If you have other servers internallylistening for connections on <SPANCLASS="acronym">TCP</SPAN> ports above 1023,you should add similar rules for them. Note that trying to list thingsthat should be denied (as in rule <SPANCLASS="acronym">FTP</SPAN>-7) isgenerally a losing proposition, because your list will almost alwaysbe incomplete somehow (e.g., because you overlooked or didn'tknow about some internal service, or because the service was addedafter the filters were established). However, it's the best you can doin this situation to support normal-mode<SPANCLASS="acronym">FTP</SPAN> clients.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">SMTP</SPAN>-1 and <SPANCLASS="acronym">SMTP</SPAN>-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow outgoing mail from internal hosts to the bastion host.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">SMTP</SPAN>-3 and <SPANCLASS="acronym">SMTP</SPAN>-4</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow incoming mail from the bastion host to your internal mailserver.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">NNTP</SPAN>-1 and <SPANCLASS="acronym">NNTP</SPAN>-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow outgoing Usenet news from your news server toyour service provider's news server.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">NNTP-3</SPAN> and <SPANCLASS="acronym">NNTP-4</SPAN></EM></DT><DDCLASS="listitem"><PCLASS="para">Allow incoming Usenet news from your serviceprovider's news server to your news server.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">HTTP</SPAN>-1 and <SPANCLASS="acronym">HTTP</SPAN>-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow internal <SPANCLASS="acronym">HTTP</SPAN> clients to connect to the<SPANCLASS="acronym">HTTP</SPAN> proxy server on your bastion host.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">DNS</SPAN>-1</EM></DT><DDCLASS="listitem"><PCLASS="para">Allows <SPANCLASS="acronym">UDP</SPAN>-based <SPANCLASS="acronym">DNS</SPAN> queries andanswers from the internal <SPANCLASS="acronym">DNS</SPAN> server to the bastionhost <SPANCLASS="acronym">DNS</SPAN> server.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">DNS</SPAN>-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Allows <SPANCLASS="acronym">UDP</SPAN>-based <SPANCLASS="acronym">DNS</SPAN> queries andanswers from the bastion host <SPANCLASS="acronym">DNS</SPAN> server to theinternal <SPANCLASS="acronym">DNS</SPAN> server. </P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">DNS</SPAN>-3 and <SPANCLASS="acronym">DNS</SPAN>-4</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow <SPANCLASS="acronym">TCP</SPAN>-based <SPANCLASS="acronym">DNS</SPAN> queries fromthe bastion host <SPANCLASS="acronym">DNS</SPAN> server to the internal<SPANCLASS="acronym">DNS</SPAN> server, as well as answers to those queries. Alsoallowzone transfers in which the bastion host <SPANCLASS="acronym">DNS</SPAN> server isthe secondary server and the internal <SPANCLASS="acronym">DNS</SPAN> server isthe primary server.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">DNS</SPAN>-5 and <SPANCLASS="acronym">DNS</SPAN>-6</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow <SPANCLASS="acronym">TCP</SPAN>-based <SPANCLASS="acronym">DNS</SPAN> queries fromthe internal <SPANCLASS="acronym">DNS</SPAN> server to the bastion host<SPANCLASS="acronym">DNS</SPAN> servers, as well as answers to those queries. Alsoallowzone transfers in which the bastion host <SPANCLASS="acronym">DNS</SPAN>server is the primary server and the internal <SPANCLASS="acronym">DNS</SPAN>server is the secondary server.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Default-1 and Default-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Block all packets not specifically allowed byone of the preceding rules.</P></DD></DL></P><PCLASS="para">How you translate these abstract rules into specific rules for yourparticular filtering system depends on the syntax used by your system. Some systems allow you to enter the rules as a single table, much as weshow here in this table. Other systems require you to specify rulesfor incoming and outgoing packets in separate rule sets. Splittingthese rules between incoming and outgoing packets is not a problem,as long as you preserve the order for rules of each type; that is, aslong as all the incoming rules stay in the same order relative to eachother, and all the outgoing rules stay in the same order relative toeach other.<ACLASS="indexterm"NAME="AUTOID-17987"></A><ACLASS="indexterm"NAME="AUTOID-17988"></A></P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-8">9.1.2.2 Exterior Router</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="CH09ERCONF"></A><ACLASS="indexterm"NAME="CH09CONFER"></A>The purpose of the exterior router is twofold:<ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">To connect the perimeter net (and thus your site) to the outsideworld</P></LI><LICLASS="listitem"><PCLASS="para">To protect the perimeter net and the internal net against theoutside world </P></LI></UL></P><PCLASS="para">In many circumstances, only the former purpose is possible, because theexterior router is often provided and managed by your network serviceprovider. That provider may be unable or unwilling to set up andmaintain packet filtering rules on the exterior router (and unable orunwilling to let you do it yourself).</P><PCLASS="para">If you can set up filtering on the exterior router, it's a good idea todo so. If nothing else, this can serve as a backup to some of thefiltering on the interior router. For this example, you would need toestablish the following rules:</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Direc-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Pro-</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Source</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Dest.</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><SPANCLASS="acronym">ACK</SPAN></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Rule</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tion</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Address</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Address</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">tocol</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Port</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Set</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Action</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Spoof-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal </P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Deny</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Spoof-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Perim.</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Deny</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Telnet-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">23</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Telnet-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">23</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">21</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">21</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-3</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-4</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-5</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">21</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-6</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">21</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-7</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">20</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">6000-6003</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Deny</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-8</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">20</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-9</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">20</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-10</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In </P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">21</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-11</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">21</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-12</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">20</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-13</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">20</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-14</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">FTP</SPAN>-15</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">SMTP</SPAN>-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">25</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">SMTP</SPAN>-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">25</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">SMTP</SPAN>-3</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">25</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">SMTP</SPAN>-4</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">25</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN>-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">NNTP</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN> feed server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN>-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN> feed server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">NNTP</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN>-3</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN> feed server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">NNTP</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN>-4</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internal <SPANCLASS="acronym">NNTP</SPAN> server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">NNTP</SPAN> feed server</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">119</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">HTTP</SPAN>-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">HTTP</SPAN>-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">HTTP</SPAN>-3</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">80</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">HTTP</SPAN>-4</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">80</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[2]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[2]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-3</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[2]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-4</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">[2]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-5</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-6</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-7</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">DNS</SPAN>-8</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Bastion</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">TCP</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">53</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&gt;1023</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Yes</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permit</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Default-1</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Out</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Deny</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Default-2</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">In</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Deny</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] <SPANCLASS="acronym">UDP</SPAN> packets do not have<SPANCLASS="acronym">ACK</SPAN> bits.</P></BLOCKQUOTE><PCLASS="para">Here is some additional information about each set of rules in thistable.</P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">Spoof-1 and Spoof-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Block incoming packets that claim to have internalor perimeter net <SPANCLASS="acronym">IP</SPAN> addresses&nbsp;- that is, forgedpackets presumably sent by an attacker. Rule Spoof-1 is the same asthe Spoof rule on the interior router; rule Spoof-2 is unique to theexterior router.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Telnet-1 and Telnet-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow outgoing Telnet connections. These are identical to thecorresponding rules on the interior router (as are all rules on theexterior router that involve internal and external hosts, but nothingon the perimeter net).</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">FTP</SPAN>-1 through <SPANCLASS="acronym">FTP</SPAN>-4</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow outgoing passive-mode <SPANCLASS="acronym">FTP</SPAN> connections andare identical to the corresponding rules on the interior router.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">FTP</SPAN>-5 and <SPANCLASS="acronym">FTP</SPAN>-6</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow the <SPANCLASS="acronym">FTP</SPAN> proxy server on the bastion host toopen an <SPANCLASS="acronym">FTP</SPAN> command channel to<SPANCLASS="acronym">FTP</SPAN> servers on the Internet. Note that, unlike thecorresponding rules on the interior router, these rules are<EMCLASS="emphasis">not </EM> redundant if you have rules<SPANCLASS="acronym">FTP</SPAN>-1 and <SPANCLASS="acronym">FTP</SPAN>-2 in place earlierin the list. Why? Because &quot;Bastion&quot; as a source ordestination (covered by rules <SPANCLASS="acronym">FTP</SPAN>-5 and<SPANCLASS="acronym">FTP</SPAN>-6) is not a subset of &quot;Internal&quot;(covered by rules <SPANCLASS="acronym">FTP</SPAN>-1 and<SPANCLASS="acronym">FTP</SPAN>-2).</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">FTP</SPAN>-7 through<SPANCLASS="acronym">FTP</SPAN>-9</EM></DT><DDCLASS="listitem"><PCLASS="para"> Allow<SPANCLASS="acronym">FTP</SPAN> data connections from external<SPANCLASS="acronym">FTP</SPAN> servers to the proxy server on the bastionhost. The <SPANCLASS="acronym">FTP</SPAN>-7 rule prevents an attacker fromattacking X11 servers on the bastion host via the hole created byrules <SPANCLASS="acronym">FTP</SPAN>-8 and <SPANCLASS="acronym">FTP</SPAN>-9. If youhave other servers on the bastion host listening for connections on<SPANCLASS="acronym">TCP</SPAN> ports above 1023, you should add similar rulesfor them. Note that trying to list things that should be denied (as inrule <SPANCLASS="acronym">FTP</SPAN>-7) is a losing proposition, because yourlist will almost always be incomplete, e.g., because you overlooked ordidn't know about some service, or because the service was added afterthe filters were established.  However, it's the best you can do inthis situation, if you must support normal-mode<SPANCLASS="acronym">FTP</SPAN>.  </P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">FTP</SPAN>-10 through <SPANCLASS="acronym">FTP</SPAN>-15</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow passive- and normal-mode <SPANCLASS="acronym">FTP</SPAN> from externalclients to the anonymous <SPANCLASS="acronym">FTP</SPAN> server on the bastionhost. There are no equivalent rules on the internal router becausethere are no <SPANCLASS="acronym">FTP</SPAN> servers on the internal networkthat external clients can access.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">SMTP</SPAN>-1 and <SPANCLASS="acronym">SMTP</SPAN>-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow outgoing mail from the bastion host to the outside world.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">SMTP</SPAN>-3 and <SPANCLASS="acronym">SMTP</SPAN>-4</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow incoming mail from the outside world to the bastion host.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">NNTP</SPAN>-1 to <SPANCLASS="acronym">NNTP</SPAN>-4</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow Usenet news both ways between your Usenet newsserver and your service provider's news server. These rules are identical tothe corresponding rules on the interior router.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">HTTP</SPAN>-1 and <SPANCLASS="acronym">HTTP</SPAN>-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow the bastion host <SPANCLASS="acronym">HTTP</SPAN> proxy server to connectto the <SPANCLASS="acronym">HTTP</SPAN> servers on any machine on theInternet. Actually, these rules allow any <SPANCLASS="acronym">TCP</SPAN>client program on the bastion host using a port above 1023 to contactany server program on any host on the Internet using any port. This isdone so that the <SPANCLASS="acronym">HTTP</SPAN> proxy server can contact<SPANCLASS="acronym">HTTP</SPAN> servers on nonstandard port numbers (i.e.,other than port 80). As broad as these rules are, it's important thatthey allow only outgoing connections, by examining the<SPANCLASS="acronym">ACK</SPAN> bit.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">HTTP</SPAN>-3 and <SPANCLASS="acronym">HTTP</SPAN>-4</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow external clients to contact the bastion host<SPANCLASS="acronym">HTTP</SPAN> server. There are no equivalent rules on theinternal router because there are no <SPANCLASS="acronym">HTTP</SPAN> serverson the internal network that external clients can access.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">DNS</SPAN>-1</EM></DT><DDCLASS="listitem"><PCLASS="para">Allows <SPANCLASS="acronym">UDP</SPAN>-based <SPANCLASS="acronym">DNS</SPAN> queries andanswers from the bastion host <SPANCLASS="acronym">DNS</SPAN> server to<SPANCLASS="acronym">DNS</SPAN> servers in the outside world.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">DNS</SPAN>-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Allows <SPANCLASS="acronym">UDP</SPAN>-based<SPANCLASS="acronym">DNS</SPAN> queries and answers from Internet<SPANCLASS="acronym">DNS</SPAN> servers to the bastion host<SPANCLASS="acronym">DNS</SPAN> server. Note that rule <SPANCLASS="acronym">DNS</SPAN>-2(which allows server-to-server communication) is redundant if rule<SPANCLASS="acronym">DNS</SPAN>-3 (which allows client-to-server communication)is present.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">DNS</SPAN>-3 and <SPANCLASS="acronym">DNS</SPAN>-4</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow external <SPANCLASS="acronym">UDP</SPAN>-based <SPANCLASS="acronym">DNS</SPAN>clients to query the <SPANCLASS="acronym">DNS</SPAN> server on the bastionhost and it to answer them.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">DNS</SPAN>-5 and <SPANCLASS="acronym">DNS</SPAN>-6</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow <SPANCLASS="acronym">TCP</SPAN>-based <SPANCLASS="acronym">DNS</SPAN> queries fromthe bastion host to <SPANCLASS="acronym">DNS</SPAN> servers on the Internet, aswell as answers to those queries. Also allow zone transfers in which the bastionhost <SPANCLASS="acronym">DNS</SPAN> server is the secondary server and anexternal <SPANCLASS="acronym">DNS</SPAN> server is the primary server.</P></DD><DTCLASS="term"><EMCLASS="emphasis"><SPANCLASS="acronym">DNS</SPAN>-7 and <SPANCLASS="acronym">DNS</SPAN>-8</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow <SPANCLASS="acronym">TCP</SPAN>-based <SPANCLASS="acronym">DNS</SPAN> queries fromthe outside world to the bastion host <SPANCLASS="acronym">DNS</SPAN> server,as well as answers to those queries. Also allow zone transfers in whichthe bastion host <SPANCLASS="acronym">DNS</SPAN> server is the primary serverand an external <SPANCLASS="acronym">DNS</SPAN> server is the secondary server.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Default-1 and Default-2</EM></DT><DDCLASS="listitem"><PCLASS="para">Block all packets not specifically allowed by oneof the preceding rules, just as the corresponding rules do on theinterior router.</P></DD></DL><ACLASS="indexterm"NAME="AUTOID-19073"></A><ACLASS="indexterm"NAME="AUTOID-19074"></A><ACLASS="indexterm"NAME="AUTOID-19075"></A></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-09-S2-3">9.1.3 Other Configuration Work</A></H3><PCLASS="para">In addition to setting up the packet filtering rules, we need to dovarious other kinds of configuration work, as described below.</P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">On all of the internal machines</EM></DT><DDCLASS="listitem"><PCLASS="para">Configure electronic mail sothat it gets sent to the bastion host. We're also going to need toinstall passive mode <SPANCLASS="acronym">FTP</SPAN> clients if they're available.</P></DD><DTCLASS="term"><EMCLASS="emphasis">On the internal mail server</EM></DT><DDCLASS="listitem"><PCLASS="para">Install the <EMCLASS="emphasis">smap</EM> and<EMCLASS="emphasis">smapd</EM> programs from the <SPANCLASS="acronym">TIS FWTK</SPAN> and an up-to-date mailer release so that we have atrusted <SPANCLASS="acronym">SMTP</SPAN> server.</P></DD><DTCLASS="term"><EMCLASS="emphasis">On the internal (primary) name server</EM></DT><DDCLASS="listitem"><PCLASS="para">Put in an <SPANCLASS="acronym">MX</SPAN>record for every A record, pointing incoming mail to the bastion host;further <SPANCLASS="acronym">MX</SPAN> records may be necessary for theinternal mail server to direct the traffic internally. We also needto configure the bastion host as a recognized secondary name server,and remove any <SPANCLASS="acronym">TXT</SPAN> or <SPANCLASS="acronym">HINFO</SPAN>records we don't want the external world to see (i.e., prettymuch any records the external world could possibly make any senseof).</P></DD><DTCLASS="term"><EMCLASS="emphasis">On the bastion host</EM></DT><DDCLASS="listitem"><PCLASS="para">Do all the standard bastion host configuration(removing unused servers, adding logging, and so on), as discussed in<ACLASS="xref"HREF="ch05_01.htm"TITLE="Bastion Hosts">Chapter 5</A>. We need to install <SPANCLASS="acronym">TIS FWTK</SPAN> and configure <SPANCLASS="acronym">FTP</SPAN> proxying,<EMCLASS="emphasis">smap </EM> and <EMCLASS="emphasis">smapd,</EM> andanonymous <SPANCLASS="acronym">FTP</SPAN> service from it. We also need toinstall the <SPANCLASS="acronym">CERN HTTP</SPAN> server and configure it to doproxying, as well as to serve the <SPANCLASS="acronym">HTTP</SPAN> pages wewant to show the outside world.</P></DD></DL></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-09-S2-4">9.1.4 Analysis</A></H3><PCLASS="para">Just how good a firewall is this one we've configured? Let's considerit in relation to the strategies and principles discussed in <ACLASS="xref"HREF="ch03_01.htm"TITLE="Security Strategies">Chapter 3, <CITECLASS="chapter">Security Strategies</CITE></A>.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-9">9.1.4.1 Least privilege</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-19124"></A><ACLASS="indexterm"NAME="AUTOID-19126"></A>The principle of least privilege is that an object (a program, aperson, a router, or whatever) should have the minimum privilegesnecessary to perform its assigned task and no more. A corollary ofthis principle is that systems should be configured so they require aslittle privilege as possible. You can see this principle in action inseveral places in this setup. For example, configuring<SPANCLASS="acronym">SMTP</SPAN> so that outgoing mail goes out via the bastionhost (rather than directly to remote systems) is an application ofleast privilege, because it lets you control more tightly how internalsystems connect to external systems. (In this case, it makes itunnecessary for internal systems to talk directly to external systemsin order to provide this service.)</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-10">9.1.4.2 Defense in depth</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-19133"></A><ACLASS="indexterm"NAME="AUTOID-19135"></A>The principle of defense in depth is something else that you can see in the setup we've described. For example, internal hosts areprotected from the outside world by the exterior and interiorrouters. Similarly, the bastion host is protected against attack bothby its own careful configuration and by the exterior router.</P><PCLASS="para">Several times, we've explicitly made decisions to increase the depth ofdefense. For example, that's one of the main purposes of using aninternal mail server between the bastion host and the internal clients.The interior and exterior routers often deny the same packets. Defensein depth is almost the only reason for having the interior router denypackets that it supposedly can't receive (because they'vealready been denied by the exterior router). </P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-11">9.1.4.3 Choke point</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-19142"></A><ACLASS="indexterm"NAME="AUTOID-19144"></A>The principle of a choke point is clearly applied in our setup,because everything between internal clients and the Internet comesthrough the perimeter net. Further, much of it comes through thebastion host, via proxies. Only Telnet and <SPANCLASS="acronym">FTP</SPAN> areprovided in ways that leave them relatively open. These services couldhave been better choked by using proxies everywhere.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-12">9.1.4.4 Weakest link</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-19151"></A><ACLASS="indexterm"NAME="AUTOID-19153"></A>There is no single obvious weak link to attack in this configuration.Probably the weakest link is the bastion host, but even a completelycompromised bastion host isn't going to help an attacker when itcomes to attacking the internal systems; there just aren't that manyconnections allowed from the bastion host to internal systems. Some ofthe weakest links you can see remaining in this setup includeproxy <SPANCLASS="acronym">FTP</SPAN> and<SPANCLASS="acronym">SMTP</SPAN> from the bastion host tothe internal mail server.</P><PCLASS="para">The proxy <SPANCLASS="acronym">FTP</SPAN> setup we've described would allow anattacker who has compromised the bastion host to attack servers onports above 1023 (if there are any) on internal hosts. How can youaddress this vulnerability? Obtain and use only passive-mode<SPANCLASS="acronym">FTP</SPAN> clients internally, don't run proxy<SPANCLASS="acronym">FTP</SPAN>, and remove the rules allowing proxy<SPANCLASS="acronym">FTP</SPAN> from the filters.</P><PCLASS="para">Similarly, the <SPANCLASS="acronym">SMTP</SPAN> setup we'vedescribed would allow an attacker who has compromised the bastion hostto attack your mail server via <SPANCLASS="acronym">SMTP</SPAN>.  How can youaddress this vulnerability? Improve the security of the<SPANCLASS="acronym">SMTP</SPAN> server on your mail server, e.g., byusing an up-to-date version of Sendmail, and by using the <SPANCLASS="acronym">TIS FWTK</SPAN> <EMCLASS="emphasis">smap</EM> package.</P><PCLASS="para">You can keep playing this game of thinking &quot;If I were an attacker,what would I do?&quot;, and then addressing the problems you discoverad nauseam, or until you run out of time or money. At some point,though, you (or your management) will probably decide you've done enough(based on your own site's definition of &quot;enough&quot;).</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-13">9.1.4.5 Fail-safe stance</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-19173"></A><ACLASS="indexterm"NAME="AUTOID-19175"></A>You can see the principle of a fail-safe stance applied through thepacket filtering rules. In general, the rules specify what you're goingto allow, and deny everything else by default. This is a fail-safeapproach, because if something unanticipated comes along (a new service,for example), it won't be allowed through your firewall; unless, ofcourse, it mimics or is tunneled through some other service you doallow. The redundant router rules also provide a fail-safe againstfailure of one router or the other. If filtering accidentally ortemporarily gets turned off on one router (causing it to pass allpackets), the other still does most of the same filtering, atleast as far as the outside world is concerned.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-14">9.1.4.6 Universal participation</A></H4><PCLASS="para">If this is our site's only connection to the Internet, we haveinvoluntary universal participation; everybody has to go through thefirewall to get to the Internet. Of course, we'd be much better offwith voluntary universal participation, but that may require some usereducation about the goals of and the need for the security measureswe're adopting.</P><PCLASS="para">To some extent, we're relying on voluntary universal participation.We've granted free Telnet and <SPANCLASS="acronym">FTP</SPAN> access, and inthe process we've allowed any outbound connection to ports at or above1024 (which is plenty of rope for the users to hang uswith). <SPANCLASS="acronym">FTP</SPAN> is by no means the only service above1024, and Telnet is a perfectly good client to use to get to many ofthem.</P><PCLASS="para">In particular, we've assumed that this is your sole connection to theInternet and that internal users aren't just going to bypass thefirewall entirely by setting up their own Internet connections. All ittakes is one joker with a modem, a <SPANCLASS="acronym">PPP</SPAN> softwarepackage, and an outside phone line, and you too could have anunprotected back door into your network.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="FIRE-09-S3-15">9.1.4.7 Diversity of defense</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-19189"></A>There are opportunities in this configuration to apply the principle ofdiversity of defense, e.g., using routers from differentvendors for the interior and exterior packet filtering systems. Mostsites will probably conclude that such an approach is not worth thehassle. However, even if you use similar or identicalhardware, you still might get some diversity by having different peopledo at least the initial configuration of the different filteringsystems, and then having them cross-check each other's work.</P><PCLASS="para">Using different <SPANCLASS="acronym">SMTP</SPAN> servers on the internal mailserver and the bastion host would be a fairly major advance in thisconfiguration, because that's one of the main weak points of yoursetup. Even a less secure <SPANCLASS="acronym">SMTP</SPAN> server on theinternal mail server is arguably better than one that's going to yieldto the exact same attack that just succeeded on the bastion host. Themore vulnerable the <SPANCLASS="acronym">SMTP</SPAN> server you're using, themore important an issue this is.</P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-09-S2-5">9.1.5 Conclusions</A></H3><PCLASS="para">There are a lot of advantages offered by a scheme such as the onewe've described in the sections above. The main potentialdisadvantages we can see are cost and complexity; but we don't thinkthat the configuration we've presented is too expensive for mostsites, and we think that it presents the minimum necessary level ofcomplexity.</P><PCLASS="para">What if you really need to save some money? It would be feasible toconstruct a screened subnet architecture using a single three-interfacerouter, instead of the pair of two-interface routers we've describedabove. The solution would be a little more complex, because you'd haveto merge the two separate filtering sets described above, but doing soshouldn't be too difficult.</P><PCLASS="para">It would also be relatively easy to construct a more secureconfiguration with the same basic architecture. A less trusting sitewould force all Telnet and all <SPANCLASS="acronym">FTP</SPAN> through proxies,which would allow much better logging and remove the nagging holescreated by allowing every outbound connection to ports above 1024. Onceyou'd forced Telnet and <SPANCLASS="acronym">FTP</SPAN> through proxies, you'dalso find that <SPANCLASS="acronym">DNS</SPAN> information hiding would be bothmore practical and more reasonable. However, the price of thisincreased security would be a more complex and fragile configuration,and one that presents more annoyance to the users.</P><PCLASS="para">It would also be possible to increase the services offered withoutmajor architecture changes. For example, incoming Telnet and incominguser <SPANCLASS="acronym">FTP</SPAN> could be supported relatively easily for afew users on the bastion host or on a dedicated host on the screenednetwork. Serious anonymous <SPANCLASS="acronym">FTP</SPAN> service or<SPANCLASS="acronym">HTTP</SPAN> service could be provided by configuring extramachines on the screened network. Similarly, you could scale up thefirewall to support a second Internet connection or redundant bastionhosts to provide more reliable service or service for a much largerinternal network.<ACLASS="indexterm"NAME="AUTOID-19208"></A><ACLASS="indexterm"NAME="AUTOID-19209"></A></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_18.htm"TITLE="8.18 Analyzing Other Protocols"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.18 Analyzing Other Protocols"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_02.htm"TITLE="9.2 Screened Host Architecture"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.2 Screened Host Architecture"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.18 Analyzing Other Protocols</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">9.2 Screened Host Architecture</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>