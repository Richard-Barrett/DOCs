<HTML><HEAD><TITLE>[Chapter 12] Maintaining Firewalls</TITLE><METANAME="DC.title"CONTENT="Building Internet Firewalls"><METANAME="DC.creator"CONTENT="D. Brent Chapman &amp; Elizabeth D. Zwicky"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:29:22Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-124-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part03.htm"TITLE="III. Keeping Your Site Secure"><LINKREL="prev"HREF="ch11_04.htm"TITLE="11.4 What If You Can't Get a Security Policy?"><LINKREL="next"HREF="ch12_02.htm"TITLE="12.2 Monitoring Your System"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Building Internet Firewalls"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Building Internet Firewalls"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/fsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_04.htm"TITLE="11.4 What If You Can't Get a Security Policy?"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 11.4 What If You Can't Get a Security Policy?"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 12</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch12_02.htm"TITLE="12.2 Monitoring Your System"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 12.2 Monitoring Your System"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="FIRE-12-CHP">12. Maintaining Firewalls</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="SECT1"HREF="#FIRE-12-S1-1"TITLE="12.1 Housekeeping">Housekeeping</A><BR><ACLASS="SECT1"HREF="ch12_02.htm"TITLE="12.2 Monitoring Your System">Monitoring Your System</A><BR><ACLASS="SECT1"HREF="ch12_03.htm"TITLE="12.3 Keeping Up to Date">Keeping Up to Date</A><BR><ACLASS="SECT1"HREF="ch12_04.htm"TITLE="12.4 How Long Does It Take?">How Long Does It Take?</A><BR><ACLASS="SECT1"HREF="ch12_05.htm"TITLE="12.5 When Should You Start Over?">When Should You Start Over?</A></P><P></P></DIV><PCLASS="para"><ACLASS="indexterm"NAME="CH12FWMAIN"></A><ACLASS="indexterm"NAME="CH12MAINFW"></A>If you've done a good job of designing a firewall that fits the needs ofyour organization, maintaining that firewall should be fairlystraightforward. What does it mean to maintain a firewall? Maintenancetasks fall into three major categories: <ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Housekeeping</P></LI><LICLASS="listitem"><PCLASS="para">Monitoring your system</P></LI><LICLASS="listitem"><PCLASS="para">Keeping up to date </P></LI></UL></P><PCLASS="para">Once you've designed and built your firewall, it really shouldn't take agreat deal of effort to keep it going, especially because much of themaintenance work can be automated.</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="FIRE-12-S1-1">12.1 Housekeeping</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="CH12HOUSE"></A>Housekeeping is the eternal round of small tasks that need to be done tokeep your firewall clean and safe. There are three main tasks you'llneed to deal with again and again:<ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Backing up your firewall</P></LI><LICLASS="listitem"><PCLASS="para">Managing your accounts</P></LI><LICLASS="listitem"><PCLASS="para">Managing your disk space</P></LI></UL></P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-12-S2-1">12.1.1 Backing Up Your Firewall</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21203"></A><ACLASS="indexterm"NAME="AUTOID-21206"></A>Make sure to back up all parts of your firewall. That means notonly the general-purpose computers you may be using as bastion hosts orinternal servers, but also the routers or other special-purpose devices.Rebuilding router configurations usually isn't easy, and your securitydepends on having your routers configured correctly.</P><PCLASS="para">Put your general-purpose machines on a regular, automated backup system.Preferably, that system should produce confirmation mail when it isrunning normally and distinctly different messages when it sees errors.</P><PCLASS="para">Why not produce mail only when errors occur? If the system producesmail only on errors, you won't notice the system if it fails to run atall. (Silence is not necessarily golden, as any parent of smallchildren knows. If they aren't making noise, they're probably makingmischief.) </P><PCLASS="para">Why distinctly different messages? If the system produces even vaguelysimilar messages when it is running normally and when it fails, peoplewho are accustomed to ignoring the success messages will also ignore thefailure messages. Ideally, a separate program should check to make surethat the backups have run, and to produce messages when they haven't. </P><PCLASS="para">Special-purpose machines like routers change much less often, andprobably don't need an automated backup system. (This is fortunate,because they rarely support them.) When you do make changes, takeadvantage of any means available to record the configuration. Mostsystems write their configuration to a local floppy disk; some of themalso support <SPANCLASS="acronym">FTP</SPAN>. Write two floppy disks, clearlylabel and date them, and store one of them separate from themachine. Make these backups even if you have downloaded theconfiguration with <SPANCLASS="acronym">FTP</SPAN>; you don't want the routerto be completely dependent on another machine. If you have written theconfiguration on the router, rather than <SPANCLASS="acronym">FTP</SPAN>'ingit, make an <SPANCLASS="acronym">FTP</SPAN> copy as well as the floppydisks. Why? Sometimes it's easier to find files than to find smallphysical objects like floppy disks, and sometimes the floppy drivedies when the rest of the router still works.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> The design of backup systems is outside the scope of this book. Thisdescription, along with the section in <ACLASS="xref"HREF="ch13_01.htm"TITLE="Responding to Security Incidents">Chapter 13, <CITECLASS="chapter">Responding to Security Incidents</CITE></A>called &quot;Backing Up Your Filesystems&quot; provide only asummary. If you're uncertain about your backup system, you'll want tolook at a general system administration reference. See <ACLASS="xref"HREF="appa_01.htm"TITLE="Resources">Appendix A, <CITECLASS="appendix">Resources</CITE></A> for complete information on additionalresources.</P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-12-S2-2">12.1.2 Managing Your Accounts</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="CH12ACCT"></A><ACLASS="indexterm"NAME="CH12MGGACCT"></A>Account management&nbsp;- adding new accounts, removing old ones, agingpasswords, etc.&nbsp;- is one of the most often neglected housekeepingtasks. On firewall systems, it's absolutely crucial that new accountsbe added correctly, old accounts removed promptly, and passwordschanged appropriately. (See your own system's documentation for how todo all this.)</P><PCLASS="para">Establish a procedure for adding accounts; wherever you can, use aprogram to add them. Even though there shouldn't be many users onyour firewall systems, every one of them is a possible danger, and it'sworth the effort to ensure they're set up correctly every time.People have an unfortunate tendency to leave out steps, or to pause fora few days in the middle of a process. If that gap leaves an accountthat has no password, you're creating open invitations to intruders.</P><PCLASS="para">Make sure your account creation procedure includes dating theaccount, and that accounts are automatically reviewed every fewmonths. You don't need to automatically turn them off, but you doneed to automatically inform somebody that they've timed out. This isrelatively easy to do on a <SPANCLASS="acronym">UNIX</SPAN> system; it may beharder on other systems, particularly dedicated systems likerouters. If possible, set things up so that the accounts can bewatched by an automated system. This can be done by generating accountfiles on the <SPANCLASS="acronym">UNIX</SPAN> side and then transferring themto the other machine, or by generating the accounts on the machineitself, but automatically copying the account files to the<SPANCLASS="acronym">UNIX</SPAN> side and examining them.</P><PCLASS="para">You should also arrange to get termination notices from the appropriateauthorities whenever someone leaves your organization. Most companiesare able to send around notices for full-time employees, and mostuniversities can provide graduation notification for students. It may bemuch harder to keep track of contractors and students who drop out, soyou shouldn't rely on official notifications to tell you about everybodywho has left. You may also need to confirm notifications: for example,you may get termination notices for people who are actually convertingto contract status, or graduation notices for people who are continuingas graduate students or junior faculty. These people are going to beannoyed if you get rid of all their files (although it's probablyacceptable to temporarily disable their accounts if their status is indoubt).</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21235"></A>If your operating system supports password aging, you may want to turnit on. Use a relatively long time period&nbsp;- perhaps three to six months. If you time out passwords more frequently (e.g., every month), userswill be willing to go to great lengths to circumvent the timeout, andyou probably won't see any real gain in security. Similarly, if yourpassword aging doesn't guarantee that the user will see a notificationbefore the account becomes unusable, don't turn it on. Otherwise, youwill annoy your users, and you will run the risk of accidentally lockingout administrators who have a critical need to use the machine. </P><PCLASS="para">If password aging on your system is going to require a user to changehis password as he is logging in, you need a password program thatstrictly enforces good passwords. If you don't do this, people willchoose simple passwords in the heat of the moment, honestly intending tochange them to better ones later. All in all, you may find it moreeffective to simply send people notices on a regular basis, even thoughyou'll get less compliance that way.<ACLASS="indexterm"NAME="AUTOID-21239"></A><ACLASS="indexterm"NAME="AUTOID-21240"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="FIRE-12-S2-3">12.1.3 Managing Your Disk Space</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21244"></A>Data always expands to fill all available space, even on machinesthat have almost no users. People dump things in odd corners of the filesystem, &quot;just for now,&quot; and they build up there. This causes more problemsthan you may realize. Aside from the fact that you may want that diskspace, this random junk complicates incident response. You'll end upasking yourself: </P><BLOCKQUOTECLASS="blockquote"><PCLASS="para">Is that a program that you left lying around last time you needed toinstall a new version, or did an intruder put it in? </P><PCLASS="para">Is that truly a random data file, or does it have some deep meaning toan intruder? </P></BLOCKQUOTE><PCLASS="para">Unfortunately, there is no automatic way to find junk; human beings,particularly system administrators who can write anywhere on the disk,are too unpredictable. Another person needs to look around on aregular basis. It's particularly effective to send every new systemadministrator on a tour of the disks; they'll notice things the oldhands have become accustomed to.</P><PCLASS="para">Auditing programs like Tripwire, discussed in <ACLASS="xref"HREF="ch05_01.htm"TITLE="Bastion Hosts">Chapter 5, <CITECLASS="chapter">Bastion Hosts</CITE></A>,will tell you about new files that appear in supposedly static areas,and this information will help you keep things straight. You will stillneed to check all the areas where you intentionally allow changes, andyou should periodically go back and re-check the static areas. You willprobably get the alert while you still know why you put that file inthat place, and that knowledge may wear off over time.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21254"></A><ACLASS="indexterm"NAME="AUTOID-21257"></A>On most firewall machines, your main disk space problem will be logs.These can and should be rotated automatically, and you may want tocompress them as well; a program like <EMCLASS="emphasis">trimlog</EM>(see <ACLASS="xref"HREF="appb_01.htm"TITLE="Tools">Appendix B, <CITECLASS="appendix">Tools</CITE></A>) helps automate the process. It'simportant to stop programs or cause them to suspend logging while youare trying to truncate or move logs. If a program is trying to writeto a log file while you're trying to move or truncate it, you'reobviously going to have problems. In fact, though, you may run intodifficulties even if a program is simply holding the file open inpreparation for writing to it later, e.g., you may discover theprogram is still logging to the file you renamed.<ACLASS="indexterm"NAME="AUTOID-21262"></A></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_04.htm"TITLE="11.4 What If You Can't Get a Security Policy?"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 11.4 What If You Can't Get a Security Policy?"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Building Internet Firewalls"><IMGSRC="../gifs/txthome.gif"ALT="Building Internet Firewalls"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch12_02.htm"TITLE="12.2 Monitoring Your System"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 12.2 Monitoring Your System"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">11.4 What If You Can't Get a Security Policy?</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">12.2 Monitoring Your System</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>