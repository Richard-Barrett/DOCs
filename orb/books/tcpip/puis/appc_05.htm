<HTML><HEAD><TITLE>[Appendix C] C.5 Starting Up UNIX and Logging In</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:22:13Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="appc_01.htm"TITLE="C. UNIX Processes"><LINKREL="prev"HREF="appc_04.htm"TITLE="C.4 The kill Command"><LINKREL="next"HREF="appd_01.htm"TITLE="D. Paper Sources"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appc_04.htm"TITLE="C.4 The kill Command"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: C.4 The kill Command"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Appendix C<BR>UNIX Processes</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="APPENDIX"HREF="appd_01.htm"TITLE="D. Paper Sources"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: D. Paper Sources"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-APP-C-SECT-5">C.5 Starting Up UNIX and Logging In</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-39918"></A><ACLASS="indexterm"NAME="AUTOID-39920"></A>Mostmodern computers are equipped with a certain amount of read-onlymemory (<SPANCLASS="acronym">ROM</SPAN>) that contains the first programthat a computer runs when it is turned on. Typically, this <SPANCLASS="acronym">ROM</SPAN>will perform a small number of system diagnostic tests to ensurethat the system is operating properly, after which it will loadanother program from a disk drive or from the network. This processis called <KBDCLASS="command">bootstrapping</KBD>.</P><PCLASS="para">Although every <SPANCLASS="acronym">UNIX</SPAN> system bootstraps ina slightly different fashion, usually the <SPANCLASS="acronym">ROM</SPAN>monitor loads a small program called <KBDCLASS="command">boot</KBD> that is kept at a knownlocation on the hard disk (or on the network.) The <KBDCLASS="command">boot</KBD> programthen loads the <SPANCLASS="acronym">UNIX</SPAN> kernel into the computerand starts running it.</P><PCLASS="para">After the kernel initializes itself and determines the machine'sconfiguration, it creates a process with a <SPANCLASS="acronym">PID</SPAN>of 1 which runs the <ICLASS="filename">/etc/init</I> program.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-APP-C-SECT-5.1">C.5.1 Process #1: /etc/init</A></H3><PCLASS="para">The program <ACLASS="indexterm"NAME="AUTOID-39938"></A><ACLASS="indexterm"NAME="AUTOID-39940"></A><ICLASS="filename">/etc/init</I>finishes the task of starting up the computer system and lets userslog in.</P><PCLASS="para">Some <SPANCLASS="acronym">UNIX</SPAN> systems can be booted in a <ACLASS="indexterm"NAME="AUTOID-39946"></A>single-user mode. If <SPANCLASS="acronym">UNIX</SPAN> isbooted in single-user mode, the init program forks and runs thestandard <SPANCLASS="acronym">UNIX</SPAN> shell, <ICLASS="filename">/bin/sh,</I>on the system console. This shell, run as superuser, gives the personsitting at the console total access to the system. It also allowsnobody else access to the system; no network daemons are startedunless root chooses to start them.</P><PCLASS="para">Some systems can be set up to require a password to boot insingle-user mode, while others cannot. Many workstations&nbsp;- includingthose made by Sun Microsystems&nbsp;- allow you to set a specialuser password using the boot monitor in <SPANCLASS="acronym">ROM</SPAN>.Single-user mode is designed to allow the resurrection of a computerwith a partially corrupted filesystem; if the <ACLASS="indexterm"NAME="AUTOID-39953"></A><ACLASS="indexterm"NAME="AUTOID-39956"></A>/etc/passwdfile is deleted, the only way to rebuild it would be to bring thecomputer up in single-user mode. Unfortunately, single-user modeis also a security hole, because it allows unprivileged people toexecute privileged commands simply by typing them on the systemconsole; computers that can be brought up in single-user mode shouldhave their consoles in a place that is physically secure. On manyBerkeley-derived systems, changing the line in the <ACLASS="indexterm"NAME="AUTOID-39958"></A><ACLASS="indexterm"NAME="AUTOID-39961"></A>/etc/ttytabfile for the console so that it is not marked as &quot;secure&quot;will force the user to provide a password when booting in single-usermode.</P><PCLASS="para">Some <SPANCLASS="acronym">UNIX</SPAN> systems can also be booted ina <ACLASS="indexterm"NAME="AUTOID-39965"></A><EMCLASS="emphasis">maintenance mode</EM>. Maintenancemode is similar to single-user mode, except that the <ICLASS="filename">root</I> passwordmust first be typed on the system console.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> Do not depend on the maintenance mode to prevent peoplefrom booting your computers in single-user mode. Most computerscan be booted from <SPANCLASS="acronym">CDROMS</SPAN> or floppy disks, allowinganyone with even the most modest technical knowledge to gain superuserprivileges if they have physical access to the system.</P></BLOCKQUOTE><PCLASS="para">In normal operation, <ICLASS="filename">/etc/init</I> then executesthe shell script <ACLASS="indexterm"NAME="AUTOID-39974"></A><ACLASS="indexterm"NAME="AUTOID-39977"></A><ICLASS="filename">/etc/rc.</I>Depending on which version of <SPANCLASS="acronym">UNIX</SPAN> you are using,<ICLASS="filename">/etc/rc</I> may execute a variety of other shell scriptswhose names all begin with <ICLASS="filename">/etc/rc</I> (common varietiesinclude <ICLASS="filename">/etc/rc.network</I> and <ICLASS="filename">/etc/rc.local</I>)or which are located in the directory <ICLASS="filename">/etc/init.d</I>or <ICLASS="filename">/etc/rc?.d. </I><ACLASS="indexterm"NAME="AUTOID-39987"></A>System V systems additionally use the file<ACLASS="indexterm"NAME="AUTOID-39990"></A><ACLASS="indexterm"NAME="AUTOID-39994"></A> <ICLASS="filename">/etc/inittab</I> to control whatis done at various run levels. The <ICLASS="filename">/etc/rc</I> script(s)set up the <SPANCLASS="acronym">UNIX</SPAN> as a multi-user system, performinga variety of features, including:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Removing temporary files from the<ICLASS="filename">/tmp</I> and/or <ICLASS="filename">/usr/tmp</I>directories</P></LI><LICLASS="listitem"><PCLASS="para">Removing any lock files</P></LI><LICLASS="listitem"><PCLASS="para">Checking filesystem consistency and mounting additionalfilesystems</P></LI><LICLASS="listitem"><PCLASS="para">Turning on accounting and quota checking</P></LI><LICLASS="listitem"><PCLASS="para">Setting up the network</P></LI></UL><PCLASS="para">When <ICLASS="filename">/etc/rc</I> finishes executing, &amp;<ICLASS="filename">sol;etc/init</I>forks a new process for every enabled terminal on the system. Onolder systems, this program is called <ICLASS="filename">/etc/getty.</I>On newer systems, including <SPANCLASS="acronym">SVR4</SPAN>, it is called<ICLASS="filename">/usr/lib/saf/ttymon.</I></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-APP-C-SECT-5.2">C.5.2 Logging In</A></H3><PCLASS="para">The <ACLASS="indexterm"NAME="AUTOID-40021"></A><ACLASS="indexterm"NAME="AUTOID-40023"></A><KBDCLASS="command">getty</KBD>or <KBDCLASS="command">ttymon</KBD> program is responsible for configuring the user terminaland displaying the initial prompt. A copy of the program is runfor each port that is monitored. Whenever the process dies, <KBDCLASS="command">init</KBD>starts another one to take its place. If the <KBDCLASS="command">init</KBD> process dies,<SPANCLASS="acronym">UNIX</SPAN> halts or reboots (depending on the versionof <SPANCLASS="acronym">UNIX</SPAN> installed).</P><PCLASS="para">The <KBDCLASS="command">getty</KBD> or <KBDCLASS="command">ttymon</KBD> program displays the word <EMCLASS="emphasis">login</EM>: (or asimilar prompt) on its assigned terminal and waits for a usernameto be typed. When it gets a username, <KBDCLASS="command">getty/ttymon</KBD> <ICLASS="filename">exec'</I>sthe program <ICLASS="filename">/bin/login</I>, which asks for a passwordand validates it against the password stored in <ICLASS="filename">/etc/passwd.</I>If the password does not match, the <KBDCLASS="command">login</KBD> program asks for a newusername and password combination.</P><PCLASS="para">Some versions of <SPANCLASS="acronym">UNIX</SPAN> can be set up torequire an additional password if you're trying to loginto the computer over a modem. See the reference page for your<KBDCLASS="command">login</KBD> program for details.</P><PCLASS="para">If you do not log in within a short period of time (usually60 seconds), or if you make too many incorrect attempts, <KBDCLASS="command">login</KBD> exitsand <KBDCLASS="command">init</KBD> starts up a new <ICLASS="filename">getty/ttymon</I> program on the terminal.On some systems equipped with modems, this causes the telephoneto hang up. Again, this strategy is designed to deter an unauthorizeduser from breaking into a <SPANCLASS="acronym">UNIX</SPAN> computer by makingthe task more difficult: after trying a few passwords, a crackerattempting to break into a <SPANCLASS="acronym">UNIX</SPAN> machine is forcedto redial the telephone.</P><PCLASS="para">If the username and password match, the <KBDCLASS="command">login</KBD> program performssome accounting and initialization tasks, then changes its realand effective <SPANCLASS="acronym">UIDS</SPAN> to be those of the usernamethat has been supplied. <KBDCLASS="command">login</KBD> then <ICLASS="filename">exec's</I> your shell program,usually <ICLASS="filename">/bin/csh</I> or <ICLASS="filename">/bin/ksh.</I>The process number of that shell is the same as the original getty.<ICLASS="filename">/etc/init</I> receives a <SPANCLASS="acronym">SIGCHLD</SPAN>signal when this process dies; <ICLASS="filename">/etc/init</I> thenstarts a new <KBDCLASS="command">getty</KBD> or <KBDCLASS="command">ttymon</KBD>.</P><PCLASS="para">On Berkeley-derived systems, the file <ICLASS="filename">/etc/ttys</I>or <ICLASS="filename">/etc/ttytab</I> contains a line for each terminalthat is to have a <ICLASS="filename">getty/ttymon</I> process enabled. It alsocontains information on terminal type, if known, and an indicationif the line is &quot;secure.&quot; The root user cannotlog into a terminal that is not secure; to become the superuseron one of these lines, you must first log in as yourself, then usethe <ICLASS="filename">su </I>command. Unless your terminal linesare all in protected areas, turning off &quot;secure&quot;on all lines is a good precaution.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-APP-C-SECT-5.3">C.5.3 Running the User's Shell</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-40069"></A><ACLASS="indexterm"NAME="AUTOID-40071"></A><ACLASS="indexterm"NAME="AUTOID-40073"></A><ACLASS="indexterm"NAME="AUTOID-40075"></A><ACLASS="indexterm"NAME="AUTOID-40077"></A><ACLASS="indexterm"NAME="AUTOID-40079"></A>After you log in, <SPANCLASS="acronym">UNIX</SPAN> willstart up your shell. The shell will then read a series of start-upcommands from a variety of different files, depending on which shellyou are using and which flavor of <SPANCLASS="acronym">UNIX</SPAN> you arerunning.</P><PCLASS="para">If your shell is <ACLASS="indexterm"NAME="AUTOID-40085"></A><ACLASS="indexterm"NAME="AUTOID-40089"></A><ACLASS="indexterm"NAME="AUTOID-40093"></A><ICLASS="filename">/bin/sh</I>(the Bourne shell) or <ICLASS="filename">/bin/ksh</I> (the Korn shell),<SPANCLASS="acronym">UNIX</SPAN> will execute all of the commands storedin a special file called <ICLASS="filename">.profile</I> in your home directory. (On somesystems, <ICLASS="filename">/bin/sh</I> and <ICLASS="filename">/bin/ksh</I>will also execute the commands stored in the <ICLASS="filename">/etc/profile</I>or <ICLASS="filename">/usr/lib/profile</I> file.)</P><PCLASS="para">If your shell is <ICLASS="filename">/bin/csh</I> (the C shell),<SPANCLASS="acronym">UNIX</SPAN> will execute all of the commands storedin the <ICLASS="filename">.cshrc</I> file in your home directory. The C shell will thenexecute all of the commands stored in the <ICLASS="filename">.login</I> file in your homedirectory. When you log out, the commands in the file <ICLASS="filename">.logout</I> willbe executed.</P><PCLASS="para">Because these files are automatically run for you when youlog in, they can present a security problem: if an intruder wereto modify the files, the end result would be the same as if theintruder were typing commands at your keyboard every time you loggedin! Thus, these files should be protected so that an intruder cannotwrite to the files or replace them with other files. <ACLASS="xref"HREF="ch05_01.htm"TITLE="The UNIX Filesystem">Chapter 5, <CITECLASS="chapter">The UNIX Filesystem</CITE></A>, explains how to protect your files. <ACLASS="indexterm"NAME="AUTOID-40113"></A><ACLASS="indexterm"NAME="AUTOID-40115"></A><ACLASS="indexterm"NAME="AUTOID-40117"></A><ACLASS="indexterm"NAME="AUTOID-40120"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appc_04.htm"TITLE="C.4 The kill Command"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: C.4 The kill Command"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="APPENDIX"HREF="appd_01.htm"TITLE="D. Paper Sources"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: D. Paper Sources"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">C.4 The kill Command</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">D. Paper Sources</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>