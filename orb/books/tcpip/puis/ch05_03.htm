<HTML><HEAD><TITLE>[Chapter 5] 5.3 The umask</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:01:44Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch05_01.htm"TITLE="5. The UNIX Filesystem"><LINKREL="prev"HREF="ch05_02.htm"TITLE="5.2 Using File Permissions"><LINKREL="next"HREF="ch05_04.htm"TITLE="5.4 Using Directory Permissions"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_02.htm"TITLE="5.2 Using File Permissions"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.2 Using File Permissions"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 5<BR>The UNIX Filesystem</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_04.htm"TITLE="5.4 Using Directory Permissions"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.4 Using Directory Permissions"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-5-SECT-3">5.3 The umask</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5062"></A><ACLASS="indexterm"NAME="AUTOID-5064"></A>The<ICLASS="firstterm">umask</I> (<SPANCLASS="acronym">UNIX</SPAN> shorthandfor &quot;user file-creation mode mask&quot;) is a four-digitoctal number that <SPANCLASS="acronym">UNIX</SPAN> uses to determine thefile permission for newly created files. Every process has its ownumask, inherited from its parent process.</P><PCLASS="para">The umask specifies the permissions you do <EMCLASS="emphasis">not</EM>want given by default to newly created files and directories. umaskworks by doing a bitwise <SPANCLASS="acronym">AND</SPAN> with the bitwisecomplement of the umask. Bits that are set in the umask correspondto permissions that are <EMCLASS="emphasis">not</EM> automatically assignedto newly created files.</P><PCLASS="para">By default, most <SPANCLASS="acronym">UNIX</SPAN> versions specifyan octal mode of 666 (any user can read or write the file) whenthey create new files.[20] Likewise, new programs are createdwith a mode of 777 (any user can read, write, or execute the program).Inside the kernel, the mode specified in the <KBDCLASS="command">open</KBD> call is <EMCLASS="emphasis">masked</EM>with the value specified by the umask&nbsp;- thus its name.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[20] We don't believethere is any religious significance to this, although we do believethat making files readable and writable by everyone leads to manyevil deeds.</P></BLOCKQUOTE><PCLASS="para">Normally, you or your system administrator set the umask inyour <ICLASS="filename">.login</I>, <ICLASS="filename">.cshrc</I>, or<ICLASS="filename">.profile</I> files, or in the system <ICLASS="filename">/etc/profile</I>file. For example, you may have a line that looks like this in oneof your startup files:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># Set the user's umask umask 033</PRE></BLOCKQUOTE><PCLASS="para">When the umask is set in this manner, it should be set asone of the first commands. Anything executed prior to the umaskcommand will have its prior, possibly unsafe, value.</P><PCLASS="para">Under <ACLASS="indexterm"NAME="AUTOID-5088"></A><SPANCLASS="acronym">SVR4</SPAN>you can specify a default umask value in the <ICLASS="filename">/etc/defaults/login</I>file. This umask is then given to every user that executes the <ICLASS="filename">login</I>program. This method is a much better (and more reliable) meansof setting the value for every user than setting the umask in theshell's startup files.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-5-SECT-3.1">5.3.1 The umask Command</A></H3><PCLASS="para">An interface to the umask function is a built-in command inthe <KBDCLASS="command">sh</KBD>, <KBDCLASS="command">ksh</KBD>, and <KBDCLASS="command">csh</KBD> shell programs. (If <KBDCLASS="command">umask</KBD> were a separate program,then typing <KBDCLASS="command">umask</KBD> wouldn't change the umask value for theshell's process! See <ACLASS="xref"HREF="appc_01.htm"TITLE="UNIX Processes">Appendix C</A>if you are unsure why this scenario is so.) A <ICLASS="filename">umask ()</I> system call for programs that wish to further changetheir umask also exists.</P><PCLASS="para">The most common umask values are 022, 027, and 077. A umaskvalue of 022 lets the owner both read and write all newly createdfiles, but everybody else can only read them:</P><TABLECLASS="informaltable"><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"> 0666</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">default file-creation mode</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">(0022)</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">umask</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"> 0644</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">resultant mode</P></TD></TR></TBODY></TABLE><PCLASS="para">A umask value of 077 lets only the file's owner readall newly created files:</P><TABLECLASS="informaltable"><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"> 0666</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">default file-creation mode</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">(0077)</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">umask</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"> 0600</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">resultant mode</P></TD></TR></TBODY></TABLE><PCLASS="para">A simple way to calculate umask values is to remember thatthe number 2 in the umask turns off write permission, while 7 turnsoff read, write, and execute permission.</P><PCLASS="para">A umask value of 002 is commonly used by people who are workingon <ACLASS="indexterm"NAME="AUTOID-5144"></A>group projects.If you create a file with your umask set to 002, anyone in the file'sgroup will be able to read or modify the file. Everybody else willonly be allowed to read it:</P><TABLECLASS="informaltable"><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"> 0666</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">default file-creation mode</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">(0002)</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">umask</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"> 0664</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">resultant mode</P></TD></TR></TBODY></TABLE><PCLASS="para">If you use the Korn shell, <KBDCLASS="command"><ACLASS="indexterm"NAME="AUTOID-5167"></A>ksh</KBD>, then you can set yourumask symbolically. You do this with the same general syntax asthe <KBDCLASS="command">chmod</KBD> command. In the <KBDCLASS="command">ksh</KBD>, the following two commands wouldbe equivalent:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% umask u=rwx,g=x,o=% umask 067</PRE></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-5-SECT-3.2">5.3.2 Common umask Values</A></H3><PCLASS="para">On many <SPANCLASS="acronym">UNIX</SPAN> systems, the default umaskis 022. This is inherited from the init process, as all processesare descendants of <ACLASS="indexterm"NAME="AUTOID-5177"></A>init.[21]Some systems may be configured to use another umask value, or adifferent value may be set in the startup files.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[21] See the discussion in <ACLASS="xref"HREF="appc_01.htm"TITLE="UNIX Processes">Appendix C</A>, to learn about init's role.</P></BLOCKQUOTE><PCLASS="para">The designers of these systems chose this umask value to fostersharing, an open computing environment, and cooperation among users.Most prototype user accounts shipped with <SPANCLASS="acronym">UNIX</SPAN>operating systems specify 022 as the default umask, and many computercenters use this umask when they set up new accounts. Unfortunately,system administrators frequently do not make a point of explainingthe umask to novice users, and many users are not aware that mostof the files they create are readable by every other user on thesystem.</P><PCLASS="para">A recent trend among computing centers has been to set upnew accounts with a umask of 077, so a user's files will,by default, be unreadable by anyone else on the system unless theuser makes a conscious choice to make them readable.</P><PCLASS="para">Here are some common umask values and their effects:</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-5-TAB-10">Table 5.10: Common umask Settings</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">umask</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">User Access</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Group Access</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Other</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">0000</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">all</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">all</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">all</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">0002</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">all</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">all</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">read, execute</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">0007</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">all</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">all</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">none</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">0022</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">all</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">read, execute</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">read, execute</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">0027</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">all</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">read, execute</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">none</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">0077</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">all</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">none</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">none<ACLASS="indexterm"NAME="AUTOID-5258"></A><ACLASS="indexterm"NAME="AUTOID-5260"></A></P></TD></TR></TBODY></TABLE></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_02.htm"TITLE="5.2 Using File Permissions"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.2 Using File Permissions"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_04.htm"TITLE="5.4 Using Directory Permissions"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.4 Using Directory Permissions"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">5.2 Using File Permissions</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">5.4 Using Directory Permissions</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>