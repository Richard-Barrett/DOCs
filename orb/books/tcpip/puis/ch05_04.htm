<HTML><HEAD><TITLE>[Chapter 5] 5.4 Using Directory Permissions</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:01:53Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch05_01.htm"TITLE="5. The UNIX Filesystem"><LINKREL="prev"HREF="ch05_03.htm"TITLE="5.3 The umask"><LINKREL="next"HREF="ch05_05.htm"TITLE="5.5 SUID"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_03.htm"TITLE="5.3 The umask"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.3 The umask"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 5<BR>The UNIX Filesystem</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_05.htm"TITLE="5.5 SUID"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.5 SUID"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-5-SECT-4">5.4 Using Directory Permissions</A></H2><PCLASS="para">Unlike <ACLASS="indexterm"NAME="AUTOID-5266"></A><ACLASS="indexterm"NAME="AUTOID-5269"></A>manyother operating systems, <SPANCLASS="acronym">UNIX</SPAN> stores the contentsof directories in ordinary files. These files are similar to otherfiles, but they are specially marked so that they can only be modifiedby the operating system.</P><PCLASS="para">As with other files, directories have a full complement ofsecurity attributes: owner, group, and permission bits. But becausedirectories are interpreted in a special way by the filesystem,the permission bits have special meanings (see <ACLASS="xref"HREF="ch05_04.htm#PUIS-CHP-5-TAB-11"TITLE="Permissions for Directories">Table 5.11</A>).</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-5-TAB-11">Table 5.11: Permissions for Directories</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Contents</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permission</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Meaning</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">r</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">read</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">You can use the <ACLASS="indexterm"NAME="AUTOID-5297"></A><ACLASS="indexterm"NAME="AUTOID-5299"></A><ACLASS="indexterm"NAME="AUTOID-5301"></A><ACLASS="indexterm"NAME="AUTOID-5303"></A><ACLASS="indexterm"NAME="AUTOID-5305"></A><KBDCLASS="command">opendir()</KBD>and <KBDCLASS="command">readdir()</KBD> functions (or the<KBDCLASS="command"> ls</KBD>command) to find out which files are in the directory.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">w</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">write</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">You can add, rename, or remove entriesin that directory.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">x</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">execute</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">You can <KBDCLASS="command">stat</KBD> the contents of a directory(e.g., you can determine the owners and the lengths of the filesin the directory). You also need execute access to a directory tomake that directory your current directory or to open files insidethe directory (or in any of the directory's subdirectories).</P></TD></TR></TBODY></TABLE><PCLASS="para">If you want to prevent other users from reading the contentsof your files, you have two choices:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">You can set the permission of eachfile to 0600, so only you have read/write access.</P></LI><LICLASS="listitem"><PCLASS="para">You can put the files in a directory and set thepermission of that directory to 0700, which prevents other usersfrom accessing the files in the directory (or in any of the directory'ssubdirectories) unless there is a link to the file from somewhereelse.</P></LI></OL><PCLASS="para">Note the following:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">You must have<ACLASS="indexterm"NAME="AUTOID-5335"></A>execute access for a directory tomake it your current directory (via <KBDCLASS="command">cd</KBD> or <KBDCLASS="command">chdir</KBD>) or to change toany directory beneath (contained in) that directory.</P></LI><LICLASS="listitem"><PCLASS="para">If you do not have execute access to a directory,you cannot access the files within that directory, even if you ownthem.</P></LI><LICLASS="listitem"><PCLASS="para">If you have execute access to a directory but donot have read access, you cannot list the names of files in thedirectory (e.g., you cannot read the contents of the directory).However, if you have access to individual files, you can run programsin the directory or open files in it. Some sites use this techniqueto create <ICLASS="firstterm">secret files</I>&nbsp;- files that users can access onlyif they know the files' names.</P></LI><LICLASS="listitem"><PCLASS="para">To unlink a file from a directory, you need onlyhave write <EMCLASS="emphasis">and</EM> execute access to that directoryeven if you have no access rights to the file itself.</P></LI><LICLASS="listitem"><PCLASS="para">If you have read access to a directory but do nothave execute access, you will be able to display a short listingof the files in the directory (ls); however, you will not be ableto find out anything about the files other than their names andinode numbers (<KBDCLASS="command">ls -i</KBD>) because you can't stat the files.Remember that the directory itself only contains name and inodeinformation.</P><PCLASS="para">This processing can cause quite a bit of confusion, if youare not expecting it. For example:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <BCLASS="emphasis.bold">ls -ldF conv </B>dr------ 4 rachel      1024 Jul  6 09:42 conv/  % ls conv 3ps.prn bizcard.ps letterhead.eps retlab.eps  % <BCLASS="emphasis.bold">ls -l conv</B> conv/3ps.prn not found  conv/retlab.eps not found  conv/letterhead.eps not found  conv/bizcard.ps not found  total 0 %</PRE></BLOCKQUOTE></LI></UL><DIVCLASS="sidebar"><H4CLASS="sidebar"><ACLASS="title"NAME="AUTOID-5354">Removing Funny Files</A></H4><PCLASS="para">Oneof the <ACLASS="indexterm"NAME="AUTOID-5357"></A><ACLASS="indexterm"NAME="AUTOID-5360"></A>most commonlyasked questions by new <SPANCLASS="acronym">UNIX</SPAN> users is &quot;Howdo I delete a file whose name begins with a dash? If I type rm -foo<KBDCLASS="command">,</KBD>the rm command treats the filename as an option.&quot; Thereare two simple ways to delete such a file. The first is to use arelative pathname:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% rm ./-foo %</PRE></BLOCKQUOTE><PCLASS="para">Asecond way is to supply an empty option argument, although thisdoes not work under every version of <SPANCLASS="acronym">UNIX</SPAN>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% rm - -foo %</PRE></BLOCKQUOTE><PCLASS="para">If you have a file thathas control characters in it, you can use rm command with the -ioption and an asterisk, which gives you the option of removing eachfile in the directory&nbsp;- even the ones that you can'ttype.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% rm -i *rm: remove faq.html (y/n)? nrm: remove foo (y/n)? y%</PRE></BLOCKQUOTE><PCLASS="para">A great way todiscover files with control characters in them is to use the <ACLASS="indexterm"NAME="AUTOID-5371"></A>-q option to the <SPANCLASS="acronym">UNIX</SPAN><KBDCLASS="command">ls</KBD> command. You can, for example, alias the <KBDCLASS="command">ls</KBD> command to be <KBDCLASS="command">ls -q</KBD>. Files that have control characters in their filenames will thenappear with question marks:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% alias ls ls -q% ls f*faq.html                fmMacros                fmdictionary            fo?ofaxmenu.sea.hqx         fmMacrosLog.backup      fmfilesvisited% </PRE></BLOCKQUOTE></DIV><PCLASS="para"><ACLASS="xref"HREF="ch05_04.htm#PUIS-CHP-5-TAB-12"TITLE="Common Directory Permissions">Table 5.12</A> contains some common directorypermissions and their uses.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-5-TAB-12">Table 5.12: Common Directory Permissions</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Octal Number</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Directory</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Permission</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">0755</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">/</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Anybody can view the contents of thedirectory, but only the owner or superuser can make changes.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">1777</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">/tmp</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Any user can create a file in the directory,but a user cannot delete another user's files.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">0700</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">$<SPANCLASS="acronym">HOME</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">A user can access the contents of hishome directory, but nobody else can.<ACLASS="indexterm"NAME="AUTOID-5419"></A><ACLASS="indexterm"NAME="AUTOID-5422"></A></P></TD></TR></TBODY></TABLE></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_03.htm"TITLE="5.3 The umask"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.3 The umask"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_05.htm"TITLE="5.5 SUID"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.5 SUID"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">5.3 The umask</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">5.5 SUID</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>