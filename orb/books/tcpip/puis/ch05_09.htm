<HTML><HEAD><TITLE>[Chapter 5] 5.9 Oddities and Dubious Ideas</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:02:21Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch05_01.htm"TITLE="5. The UNIX Filesystem"><LINKREL="prev"HREF="ch05_08.htm"TITLE="5.8 chgrp: Changing a File's Group"><LINKREL="next"HREF="ch05_10.htm"TITLE="5.10 Summary"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_08.htm"TITLE="5.8 chgrp: Changing a File's Group"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.8 chgrp: Changing a File's Group"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 5<BR>The UNIX Filesystem</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_10.htm"TITLE="5.10 Summary"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.10 Summary"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-5-SECT-9">5.9 Oddities and Dubious Ideas</A></H2><PCLASS="para">In closing, we'll mention two rather unusual ideasin filesystems. This information is provided partially for completeness,in the event that one of our readers has such a system. The secondreason is to document some ideas we don't think helpedsecurity very much. We hope we don't encounter anythinglike them again any time soon.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-5-SECT-9.1">5.9.1 Dual Universes</A></H3><PCLASS="para">Throughout <ACLASS="indexterm"NAME="AUTOID-6363"></A><ACLASS="indexterm"NAME="AUTOID-6365"></A>thisbook, you will find that we often mention how the behavior of acommand or action may be different if your version of <SPANCLASS="acronym">UNIX</SPAN>is derived from <SPANCLASS="acronym">BSD</SPAN> or <SPANCLASS="acronym">AT&T</SPAN><SPANCLASS="acronym">UNIX</SPAN>. These differences are not so great as theyonce were, as <SPANCLASS="acronym">SVR4</SPAN> is the result of a mergerof the majority of these two lines into one system.</P><PCLASS="para">However, in years gone by, the two systems were separate.This presented an interesting puzzle for some vendors who wantedto cater to both markets. Thus, someone came up with the idea of<ICLASS="firstterm">universes</I>. The idea itself was fairly simple.Create a per-process &quot;switch&quot; in memory that wouldbe set to either <SPANCLASS="acronym">BSD</SPAN> or <SPANCLASS="acronym">AT&T</SPAN>.The behavior of various system calls might depend on the value ofthe switch. Furthermore, certain special directories could be setup so that the directory you'd actually see would dependon the switch setting. Thus, you could have <ICLASS="filename">/usr/bin</I>full of user programs, but it would really be <EMCLASS="emphasis">two</EM><ICLASS="filename">/usr/bin</I> directories &nbsp;-  one of <SPANCLASS="acronym">BSD</SPAN>and one of<SPANCLASS="acronym"> AT&T</SPAN>!</P><PCLASS="para">Several companies adopted variations of the universe concept,including Pyramid, Apollo, Masccomp, and Sequent. In some of thesesystems, the switch from one environment to another was almost seamless,from the user's point of view. However, the scheme hadseveral problems:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">It took more disk space for standardconfiguration. The standard system needed two copies of libraries,man pages, commands, and more.</P></LI><LICLASS="listitem"><PCLASS="para">In most environments all the users stayed in a singleuniverse. Shops were seldom heterogeneous in environment, so userspreferred to stay with a familiar interface on everything they did.</P></LI><LICLASS="listitem"><PCLASS="para">Patching and maintaining the programs took morethan twice the effort because they required that users considerinteractions between software in each universe.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-6391"></A>System administrationwas often a nightmare. You didn't necessarily know whereall your commands were; you might need to worry about configuringtwo different <SPANCLASS="acronym">UUCP</SPAN> systems; you couldn'talways tell which version of a program was spawningjobs; and so on.</P></LI></UL><PCLASS="para">Also important to all of this was the problem of security.Often, clever manipulation of interactions between programs in thetwo universes could be used to break security. Additionally, a bugdiscovered in one universe was often mirrored in the software ofthe other, but usually only one got fixed (at first).</P><PCLASS="para">Eventually, everyone supporting a dual-universe system switchedback to a single version of <SPANCLASS="acronym">UNIX</SPAN>. Nevertheless,Solaris perpetuates some of these problems. For example, Solarishas two versions of the <KBDCLASS="command">ls</KBD> command, one in <KBDCLASS="command">/usr/bin/ls</KBD>,one in <KBDCLASS="command">/usr/ucb/ls</KBD>. It also has two versionsof <KBDCLASS="command">head</KBD>, <KBDCLASS="command">more</KBD>, <KBDCLASS="command">ln</KBD>, <KBDCLASS="command">ps</KBD>, and many other commands. Thus, you need tocheck your search path carefully to know which version of a commandyou may be using.<ACLASS="indexterm"NAME="AUTOID-6405"></A><ACLASS="indexterm"NAME="AUTOID-6407"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-5-SECT-9.2">5.9.2 Context-Dependent Files</A></H3><PCLASS="para">To support diskless workstations, Hewlett-Packard developeda system called <ICLASS="firstterm"><ACLASS="indexterm"NAME="AUTOID-6413"></A><ACLASS="indexterm"NAME="AUTOID-6415"></A><ACLASS="indexterm"NAME="AUTOID-6417"></A>Context DependentFiles</I>, or <SPANCLASS="acronym">CDF</SPAN>. <SPANCLASS="acronym">CDFS</SPAN>allow for multiple configurations to reside on a single computer.The goal of <SPANCLASS="acronym">CDFS</SPAN> was to allow one master serverto maintain multiple filesystems that will be viewed differentlyby different clients. This mechanism thus allows a single serverto support a group of heterogeneous clients.</P><PCLASS="para">A <SPANCLASS="acronym">CDF</SPAN> is basically a hidden directory whosecontents are matched against the current context. HP explains itas follows:[28]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[28] From the HP man page for CDF.</P></BLOCKQUOTE><BLOCKQUOTECLASS="blockquote"><PCLASS="para">A <SPANCLASS="acronym">CDF</SPAN> is implemented as a specialkind of directory, marked by a bit in its mode (see <KBDCLASS="command">chmod</KBD>). Thename of the <SPANCLASS="acronym">CDF</SPAN> is the name of the directory;the contents of the directory are files with names that are expectedto match one part of a process context. When such a directory isencountered during a pathname search, the names of the files inthe directory are compared with each string in the process'scontext, in the order in which the strings appear in the context.The first match is taken to be the desired file. The name of thedirectory thus refers to one of the files within it, and the directoryitself is normally invisible to the user. Hence, the directory iscalled a hidden directory.</P><PCLASS="para">When a process with a context that does not match any filenamesin the hidden directory attempts to access a file by the pathnameof the hidden directory, the reference is unresolved; no file withthat pathname appears to exist...</P><PCLASS="para">A hidden directory itself can be accessed explicitly, overridingthe normal selection according to context, by appending the character`+' to the directory's filename.</P></BLOCKQUOTE><PCLASS="para">Thus, <ACLASS="indexterm"NAME="AUTOID-6435"></A>HP-UXhad directories that were invisible unless they contained a filethat matched the running processes' current context.</P><PCLASS="para"><SPANCLASS="acronym">CDFS</SPAN> are a powerful abstraction, but theywere sometimes exploited by attackers. For example, the followingsequence of commands will create a <SPANCLASS="acronym">CDF</SPAN> directory:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% mkdir ./Hidden % chmod +H ./Hidden</PRE></BLOCKQUOTE><PCLASS="para">This resulted in a directory that was normally invisible unlessthe <ACLASS="indexterm"NAME="AUTOID-6443"></A><ACLASS="indexterm"NAME="AUTOID-6446"></A><KBDCLASS="command">-H</KBD>option was used with the <KBDCLASS="command">ls</KBD> or <KBDCLASS="command">find</KBD> commands. A clever attackercould store all kinds of tools, stolen data files, and other interestingbits in such a directory. If the system administrator was not inthe habit or was not trained to use the <KBDCLASS="command">ls</KBD> command with the <KBDCLASS="command">-H</KBD>option, then the directory might go unnoticed. The cracker couldalso find an existing <SPANCLASS="acronym">CDF</SPAN> and store things inamong the other files! As long as none of the filenames matchedan existing context, they would probably never be noticed.</P><PCLASS="para">Even worse, tools the system administrator obtained for checkingthe system's overall security might not be aware of the<KBDCLASS="command">-H flag</KBD>, and not invoke it.</P><PCLASS="para">HP has dropped support for <SPANCLASS="acronym">CDFS</SPAN> and movedto the use of <SPANCLASS="acronym">NFS</SPAN> in version 10 of HP-UX, releasedin the spring of 1995. If you are not using version 10 or later,you should be sure to use the <KBDCLASS="command">-H</KBD> option on all <KBDCLASS="command">ls</KBD> and <KBDCLASS="command">find</KBD>commands!</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_08.htm"TITLE="5.8 chgrp: Changing a File's Group"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.8 chgrp: Changing a File's Group"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_10.htm"TITLE="5.10 Summary"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.10 Summary"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">5.8 chgrp: Changing a File's Group</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">5.10 Summary</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>