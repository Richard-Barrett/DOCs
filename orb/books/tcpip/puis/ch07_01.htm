<HTML><HEAD><TITLE>[Chapter 7] Backups</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:05:12Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part03.htm"TITLE="III. System Security"><LINKREL="prev"HREF="part03.htm"TITLE="III. System Security"><LINKREL="next"HREF="ch07_02.htm"TITLE="7.2 Sample Backup Strategies"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="PART"HREF="part03.htm"TITLE="III. System Security"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: III. System Security"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 7</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 Sample Backup Strategies"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.2 Sample Backup Strategies"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="PUIS-CHP-7">7. Backups</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="SECT1"HREF="#PUIS-CHP-7-SECT-1"TITLE="7.1 Make Backups!">Make Backups!</A><BR><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 Sample Backup Strategies">Sample Backup Strategies</A><BR><ACLASS="SECT1"HREF="ch07_03.htm"TITLE="7.3 Backing Up System Files">Backing Up System Files</A><BR><ACLASS="SECT1"HREF="ch07_04.htm"TITLE="7.4 Software for Backups">Software for Backups</A></P><P></P></DIV><DIVCLASS="epigraph"><PCLASS="para"ALIGN="right"><I>Those who forget the past are condemned to fulfill it.</I></P><PCLASS="para"ALIGN="right"><I>George Santayana, Life of Reason</I></P></DIV><DIVCLASS="epigraph"><PCLASS="para"ALIGN="right"><I>Those who do not archive the past are condemned to retype it!</I></P><PCLASS="para"ALIGN="right"><I>Garfinkel and Spafford,  Practical UNIX Security (first edition)</I></P></DIV><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8839"></A><ACLASS="indexterm"NAME="AUTOID-8842"></A>Whenwe were working on the first edition of <EMCLASS="emphasis">Practical UNIX Security</EM>,we tried in vain to locate a source of the quotation &quot;thosewho forget the past are condemned to repeat it.&quot; But nomatter where we searched, we couldn't find the source.What we found instead was the reference above in George Santayana'sbook, <EMCLASS="emphasis">Life of Reason</EM>. So we printed it and added our own variation.</P><PCLASS="para">What's the point? Few people take the time to verifytheir facts, be they the words of Santayana's oft-misquotedstatement, or the contents of an unlabeled backup tape. In the yearssince <EMCLASS="emphasis">Practical UNIX Security</EM> was first published, we have heardof countless instances in which people or whole organizations havehad their files lost to computer failure or vandalism. Often, thevictims are unable to restore their systems from full and competebackups. Instead, restoration is often a piecemeal and lengthy project&nbsp;- afew files from this tape, a few files from that one, and a few fromthe original <SPANCLASS="acronym">CD-ROM</SPAN> distribution.</P><PCLASS="para">Even if backup tapes exist, there are still problems. In onecase, a researcher at Digital Equipment Corporation lost a decade'sworth of personal email because of a bad block at the beginningof a 2GB <SPANCLASS="acronym">DAT</SPAN> tape. The contents of the tape hadnever been verified.</P><PCLASS="para">In another case, we know of a project group that had to manuallyrecreate a system from printouts (that is, they had to retype theentire system) because the locally written backup program was faulty.Although the staff had tested the program, they had only testedthe program with small, random files&nbsp;- and the program'sbug was that it only backed up the first 1024 bytes of each realfile. Unfortunately, this fault was not discovered until after theprogram had been in use several months.</P><PCLASS="para">Making backups and verifying them may be the most importantthings that you can do to protect your data&nbsp;- other thanreading this book, of course!</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-7-SECT-1">7.1 Make Backups!</A></H2><PCLASS="para">Bugs, accidents, natural disasters, and attacks on your systemcannot be predicted. Often, despite your best efforts, they can'tbe prevented. But if you have backups, you can compare your currentsystem and your backed-up system, and you can restore your systemto a stable state. Even if you lose your entire computer&nbsp;- tofire, for instance&nbsp;- with a good set of backups you can restorethe information after you have purchased or borrowed a replacementmachine. Insurance can cover the cost of a new <SPANCLASS="acronym">CPU</SPAN>and disk drive, but your data is something that in many cases cannever be replaced.</P><DIVCLASS="sidebar"><H4CLASS="sidebar"><ACLASS="title"NAME="AUTOID-8857">Take the Test</A></H4><PCLASS="para">Before wego on with this chapter, take some time for the following quicktest:</P><PCLASS="para">When was the last time your computer was backedup?</P><PCLASS="para">A) Yesterday or today</P><PCLASS="para">B) Within thelast week</P><PCLASS="para">C) Within the last month</P><PCLASS="para">D)My computer has never been backed up</P><PCLASS="para">E) My computeris against a wall and cannot be backed up any further</P><PCLASS="para">Ifyou answered C or D, stop reading this book right now and back upyour data. If you answered E, you should move it out from the wallto allow for proper cooling ventilation, and then retake the test.</P></DIV><PCLASS="para">Russell Brand writes:[1]&quot;To me, the user data is of paramount importance. Anythingelse is generally replaceable. You can buy more disk drives, morecomputers, more electrical power. If you lose the data, througha security incident or otherwise, it is gone.&quot;</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] Coping with the Threatof Computer Security Incidents, 1990, published on the Internet.</P></BLOCKQUOTE><PCLASS="para">Mr. Brand made this comment in a paper on <SPANCLASS="acronym">UNIX</SPAN>security several years ago; we think it summarizes the situationwell, within limits.[2] Backups are one of the mostcritical aspects of your system operation. Having backups that arevalid, complete, and up to date may make the difference betweena minor incident and a catastrophe.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] We actually think <EMCLASS="emphasis">personnel</EM>are more important than data. We've seen disaster responseplans that call for staff members to dash into burning rooms toclose tape closets or rescue tapes; these are stupid. Plans thatrequire such activity are not likely to work when needed, and aremorally indefensible.</P></BLOCKQUOTE><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-1.1">7.1.1 Why Make Backups?</A></H3><PCLASS="para">Backups are important only if you value the work that youdo on your computer. If you use your computer as a paperweight,then you don't need to make backups.</P><PCLASS="para">You also don't need to back up a computer that onlyuses read-only storage, such as a<SPANCLASS="acronym"> CD-ROM</SPAN>. A variantof this is Sun's &quot;dataless&quot; client workstations,in which the operating system is installed from a <SPANCLASS="acronym">CD-ROM</SPAN>and never modified. When configured this way, the computer'slocal hard disk is used as an accelerator and a cache, but it isnot used to store data you would want to archive. Sun specificallydesigns its operating system for these machines so that they donot need backups.</P><PCLASS="para">On the other hand, if you ever turn your computer on and occasionallymodify data on it, then you <EMCLASS="emphasis">must </EM>make a copyof that information if you want to recover it in the event of aloss.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-7-SECT-1.1.1">7.1.1.1 A taxonomy of computer failures</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8886"></A><ACLASS="indexterm"NAME="AUTOID-8889"></A><ACLASS="indexterm"NAME="AUTOID-8892"></A>Years ago, making daily backupswas a common practice because computer hardware would often failfor no obvious reason. A backup was the only protection againstdata loss.</P><PCLASS="para">Today, hardware failure is still a good reason to back upyour system. In 1990, many hard-disk companies gave their drivestwo- or three-year guarantees; many of those drives are failingnow. Even though today's state-of-the-art hard disk drivesmight come with five-year warranties, they too will fail one day!</P><PCLASS="para">Such a failure might not be years away, either. In the fallof 1993, one of the authors bought a new 1.7GB hard drive to replacea 1.0 GB unit. The files were copied from the older drive to thenewer one, and then the older unit was reformatted and given toa colleague. The next week, the 1.7GB unit failed. Luckily, therewas a backup.</P><PCLASS="para">Backups are important for a number of other reasons as well:</P><DLCLASS="variablelist"><DTCLASS="term">User error</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8902"></A><ACLASS="indexterm"NAME="AUTOID-8904"></A>Users&nbsp;- especiallynovice users&nbsp;- accidentally delete their files. A user mighttype rm * -i instead of typing rm -i*. Making periodic backups protects users from their ownmistakes, because the deleted files can be restored. Mistakes aren'tlimited to novices, either. More than one expert has accidentallyoverwritten a file by issuing an incorrect editor or compiler command,or accidentally trashed an entire directory by mistyping a wildcardto the shell.</P></DD><DTCLASS="term">System-staff error </DT><DDCLASS="listitem"><PCLASS="para">Sometimes <ACLASS="indexterm"NAME="AUTOID-8910"></A>your system staff may make a mistake. For example,a system administrator deleting old accounts might accidentallydelete an active one.</P></DD><DTCLASS="term">Hardware failure </DT><DDCLASS="listitem"><PCLASS="para">Hardware <ACLASS="indexterm"NAME="AUTOID-8917"></A>breaks,often destroying data in the process: disk crashes are not unheardof. If you have a backup, you can restore the data on a differentcomputer system.</P></DD><DTCLASS="term">Software failure </DT><DDCLASS="listitem"><PCLASS="para">Application <ACLASS="indexterm"NAME="AUTOID-8924"></A>programsoccasionally have hidden flaws that destroy data under mysteriouscircumstances.[3]If you have a backup and your application program suddenly deleteshalf of your 500 x 500-cell spreadsheet, you can telephone the vendorand provide them with the dataset that caused the program to misbehave.You can also reload your data to try a different approach (and adifferent spreadsheet!).</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] Unfortunately, more than &quot;occasionally.&quot;Quality control is not job #1 for most vendors&nbsp;- eventhe big ones. It's probably not even job # 10.This fact is why most software is sold with the tiny print disclaimersof liability and waiver of warranty. When your vendors don'thave that much confidence in their own software, you shouldn'teither. <ICLASS="foreignphrase">Caveat emptor</I>.</P></BLOCKQUOTE></DD><DTCLASS="term">Electronic break-ins and vandalism</DT><DDCLASS="listitem"><PCLASS="para">Computer <ACLASS="indexterm"NAME="AUTOID-8934"></A><ACLASS="indexterm"NAME="AUTOID-8937"></A><ACLASS="indexterm"NAME="AUTOID-8939"></A>crackerssometimes alter or delete data. Unfortunately, they seldom leavemessages telling you whether they changed any information&nbsp;- andeven if they do, you can't trust them! If you suffer abreak-in, you can compare the data on your computer after the break-inwith the data on your backup to determine if anything was changed.Items that have changed can be replaced with originals.</P></DD><DTCLASS="term">Theft </DT><DDCLASS="listitem"><PCLASS="para">Computers <ACLASS="indexterm"NAME="AUTOID-8947"></A>are expensiveand easy to sell. For this reason, small computers&nbsp;- especiallylaptops&nbsp;- are often stolen. Cash from your insurance companycan buy you a new computer, but it can't bring back yourdata. Not only should you make a backup, you should take it outof your computer and store it in a safe place, so that if the computeris stolen, at least you'll have your data.</P></DD><DTCLASS="term">Natural disaster </DT><DDCLASS="listitem"><PCLASS="para">Sometimes <ACLASS="indexterm"NAME="AUTOID-8953"></A>rainfalls and buildings are washed away. Sometimes the earth shakesand buildings are demolished. Fires are also very effective at destroyingthe places where we keep our computers. Mother Nature is inventiveand not always kind. As with theft, your insurance company can buyyou a new computer, but it can't bring back your data.</P></DD><DTCLASS="term">Other disasters </DT><DDCLASS="listitem"><PCLASS="para">Sometimes Mother Nature isn't to blame:planes crash into buildings; gas pipes leak and cause explosions;and sometimes building-maintenance people use disk-drive cabinetsas temporary saw horses (really!). We even know of one instancein which <SPANCLASS="acronym">EPA</SPAN> inspectors came into a buildingand found asbestos in the <SPANCLASS="acronym">A/C</SPAN> ducts, so theyforced everyone to leave within 10 minutes, and then sealed thebuilding for several months!</P></DD><DTCLASS="term">Archival information </DT><DDCLASS="listitem"><PCLASS="para">Backups <ACLASS="indexterm"NAME="AUTOID-8965"></A><ACLASS="indexterm"NAME="AUTOID-8968"></A><ACLASS="indexterm"NAME="AUTOID-8970"></A><ACLASS="indexterm"NAME="AUTOID-8972"></A>provide archival information that letsyou compare current versions of software and databases with olderones. This capability lets you determine what you've changed&nbsp;- intentionallyor by accident. It also provides an invaluable resource if you everneed to go back and reconstruct the history of a project, eitheras an academic exercise, or to provide evidence in a court case.<ACLASS="indexterm"NAME="AUTOID-8975"></A><ACLASS="indexterm"NAME="AUTOID-8978"></A><ACLASS="indexterm"NAME="AUTOID-8981"></A></P></DD></DL></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-1.2">7.1.2 What Should You Back Up?</A></H3><PCLASS="para">There are two schools of thought concerning computer-backupsystems:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">Back up everything that is unique toyour system, including all user files, any system databases thatyou might have modified (such as <ACLASS="indexterm"NAME="AUTOID-8989"></A><ACLASS="indexterm"NAME="AUTOID-8991"></A><ACLASS="indexterm"NAME="AUTOID-8995"></A><ACLASS="indexterm"NAME="AUTOID-8997"></A><ACLASS="indexterm"NAME="AUTOID-9000"></A><ACLASS="indexterm"NAME="AUTOID-9003"></A><ICLASS="filename">/etc/passwd</I> and <ICLASS="filename">/etc/tty)</I>,and important system directories (such as <ICLASS="filename">/bin</I> and <ICLASS="filename">/usr/bin)</I>that are especially important or that you may have modified.</P></LI><LICLASS="listitem"><PCLASS="para">Back up everything, because restoring a completesystem is easier than restoring an incomplete one, and tape is cheap.</P></LI></OL><PCLASS="para">We recommend the second school of thought. While some of theinformation you back up is already &quot;backed up&quot;on the original distribution disks or tape you used to load themonto your hard disk, distribution disks or tapes sometimes get lost.Furthermore, as your system ages, programs get installed in reserveddirectories such as <ICLASS="filename">/bin</I> and <ICLASS="filename">/usr/bin</I>,security holes get discovered and patched, and other changes occur.If you've ever tried to restore your system after a disaster,[4] you know how mucheasier the process is when everything is in the same place.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] Imagine having to reapply 75 vendor &quot;jumbo patches&quot;by hand, plus all the little security patches you got off the netand derived from this book, plus all the tweaks to optimize performance&nbsp;- foreach system you manage. Ouch!</P></BLOCKQUOTE><PCLASS="para">For this reason, we recommend that you store <EMCLASS="emphasis">everything</EM>from your system (and that means everything necessaryto reinstall the system from scratch&nbsp;- every last file) ontobackup media at regular, predefined intervals. How often you dothis depends on the speed of your backup equipment and the amountof storage space allocated for backups. You might want to do a totalbackup once a week, or you might want to do it only twice a year.</P><PCLASS="para"><EMCLASS="emphasis">But please do it!</EM></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-1.3">7.1.3 Types of Backups</A></H3><PCLASS="para">There are three basic types of backups:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">A <ACLASS="indexterm"NAME="AUTOID-9027"></A><EMCLASS="emphasis">day-zerobackup</EM></P><PCLASS="para">Makes a copy of your original system. When your system isfirst installed, before people have started to use it, back up everyfile and program on the system. Such backups can be invaluable aftera break-in.[5]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[5] We recommend that you also do such abackup immediately after you restore your system after recoveringfrom a break-in. Even if you have left a hole open and the intruderreturns, you'll save a lot of time if you are able to fixthe hole in the backup, rather than starting from scratch again.</P></BLOCKQUOTE></LI><LICLASS="listitem"><PCLASS="para">A <ACLASS="indexterm"NAME="AUTOID-9035"></A><ICLASS="firstterm">full backup</I></P><PCLASS="para">Makes a copy of every file on your computer to the backupdevice. This method is similar to a day-zero backup, except thatyou do it on a regular basis.</P></LI><LICLASS="listitem"><PCLASS="para">An <ACLASS="indexterm"NAME="AUTOID-9041"></A><ICLASS="firstterm">incremental backup</I></P><PCLASS="para">Makes a copy to the backup device of only those items in afilesystem that have been modified after a particular event (suchas application of a vendor patch) or date (such as the date of thelast full backup).</P></LI></UL><PCLASS="para">Full backups and incremental backups work together. One commonbackup strategy is:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Make a full backup on the first dayof every other week.</P></LI><LICLASS="listitem"><PCLASS="para">Make an incremental backup every evening of everythingthat has been modified since the last full backup.</P></LI></UL><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9052"></A><ACLASS="indexterm"NAME="AUTOID-9055"></A><ACLASS="indexterm"NAME="AUTOID-9058"></A><ACLASS="indexterm"NAME="AUTOID-9061"></A><ACLASS="indexterm"NAME="AUTOID-9064"></A><ACLASS="indexterm"NAME="AUTOID-9068"></A>Most <SPANCLASS="acronym">UNIX</SPAN> administratorsplan and store their backups by partition. Different partitionsusually require different backup strategies. Some partitions, likethe root filesystem and the <ICLASS="filename">/etc</I> filesystem (if it is separate),should probably be backed up whenever you make a change to them,on the theory that every change that you make to them is too importantto lose. You should use full backups with these systems, ratherthan incremental backups, because they are only usable in theirentirety.</P><PCLASS="para">On the other hand, partitions that are used for keeping userfiles are more amenable to incremental backups. Partitions thatare used solely for storing application programs really only needto be backed up when new programs are installed or when the configurationof existing programs are changed.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9076"></A><ACLASS="indexterm"NAME="AUTOID-9078"></A><ACLASS="indexterm"NAME="AUTOID-9081"></A>When you make incremental backups, use a rotatingset of backup tapes.[6]The backup you do tonightshouldn't write over the tape you used for your backuplast night. Otherwise, if your computer crashes in the middle oftonight's backup, you would lose the data on the disk,the data in tonight's backup (because it is incomplete),and the data in last night's backup (because you partiallyoverwrote it with tonight's backup). Ideally, perform anincremental backup once a night, and have a different tape for everynight of the week, as shown in</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[6] Yes, all tapes rotate. We mean that thetapes are rotated with each other according to a schedule, ratherthan being rotated around a spindle.</P></BLOCKQUOTE><H4CLASS="figure"><ACLASS="title"NAME="PUIS-CHP-7-FIG-1">Figure 7.1: An incremental backup</A></H4><IMGCLASS="graphic"SRC="figs/puis_0701.gif"ALT="Figure 7.1"><DIVCLASS="sidebar"><H4CLASS="sidebar"><ACLASS="title"NAME="AUTOID-9089">Update Your Backup Configuration!</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9092"></A>When you add newdisks or change the partitions of your existing disks, be sure toupdate your backup scripts so that the new disks are backed up!If you are using the <SPANCLASS="acronym">UNIX</SPAN> <ICLASS="filename">dump/restore</I>facility, be sure to update the <ICLASS="filename">/etc/dumpdates</I>file so that the <ICLASS="filename">dump</I> program will not think that full backups havealready been made of the new partitions.</P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-1.4">7.1.4 Guarding Against Media Failure</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9101"></A><ACLASS="indexterm"NAME="AUTOID-9104"></A><ACLASS="indexterm"NAME="AUTOID-9107"></A>Youcan use two distinct sets of backup tapes to create a <ICLASS="firstterm">tandembackup</I>. With this backup strategy, you create two completebackups (call them A and B) on successive backup occasions. Then,when you perform your first incremental backup, the A incremental,you back up all of the files that were created or modified afterthe original A backup (even if they are on the B full backup tape).The second time you perform an incremental backup, your B incremental,you write out all of the files that were created or modified sincethe B backup (even if they are on the A incremental backup.) Thissystem protects you against media failure, because every file isbacked up in two locations. It does, however, double the amountof time that you will spend performing backups.</P><PCLASS="para">Some kinds of tapes&nbsp;- in particular, 4mm or 8mm <ACLASS="indexterm"NAME="AUTOID-9111"></A><ACLASS="indexterm"NAME="AUTOID-9113"></A><ACLASS="indexterm"NAME="AUTOID-9115"></A>videotape and <ACLASS="indexterm"NAME="AUTOID-9117"></A><ACLASS="indexterm"NAME="AUTOID-9119"></A>Digital Audio Tape (<SPANCLASS="acronym">DAT</SPAN>)&nbsp;- cannotbe reused repeatedly without degrading the quality of the backup.If you use the same tape cartridge for more than a fixed numberof backups (usually, 50 or 100), you should get a new one. Be certainto see what the vendor recommends &nbsp;-  and don'tpush that limit. The few pennies you may save by using a tape beyondits useful range will not offset the cost of a major loss.</P><PCLASS="para">Try to restore a few files chosen at random from your backupseach time, to make sure that your equipment and software are functioningproperly. Stories abound about computer centers that have lost diskdrives and gone to their backup tapes, only to find them all unreadable.This scenario can occur as a result of bad tapes, improper backupprocedures, faulty software, operator error (see the sidebar below),or other problems.</P><DIVCLASS="sidebar"><H4CLASS="sidebar"><ACLASS="title"NAME="AUTOID-9123">A Classic Case of Backup Horror</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9126"></A><ACLASS="indexterm"NAME="AUTOID-9128"></A>Sometimes,the weakest link in the backup chain is the human responsible formaking the backup. Even when everything is automated and requireslittle thought, things can go badly awry. The following was presentedto one of us as a true story. The names and agency have been omittedfor obvious reasons.</P><PCLASS="para">It seems that a government agency had hired a new night operatorto do the backups of the <SPANCLASS="acronym">UNIX</SPAN> systems. The operatorindicated that she had prior computer operations experience. Evenif she hadn't, that was okay&nbsp;- little was neededin this job because the backup was largely the result of an automatedscript. All the operator had to do was log in at the terminal inthe machine room located next to the tape cabinet, start up a commandscript, and follow the directions. The large disk array would thenbe backed up with the correct options.</P><PCLASS="para">All went fine for several months, until one morning, the systemadministrator met the operator leaving. She was asked how the jobwas going. &quot;Fine,&quot; she replied. Then the systemadministrator asked if she needed some extra tapes to go with thetapes she was using every night&nbsp;- he noticed that the diskswere getting nearer to full capacity as they approached the endof the fiscal year. He was met by a blank stare and the chillingreply &quot;What tapes?&quot;</P><PCLASS="para">Further investigation revealed that the operator didn'tknow she was responsible for selecting tapes from the cabinet andmounting them. When she started the command file (using <SPANCLASS="acronym">UNIX</SPAN>dump), it would pause while mapping the sectors on disk that itneeded to write to tape. She would wait a few minutes, see no message,and assume that the backup was proceeding. She would then retireto the lounge to read.</P><PCLASS="para">Meanwhile, the tape program would, after some time, beginprompting the operator to mount a tape and press the return key.No tape was forthcoming, however, and the mandatory security softwareinstalled on the system logged out the terminal and cleared thescreen after 60 minutes of no typing. The operator would come backsome hours later and see no error messages of any kind.</P><PCLASS="para">Murphy was kind: the system did not crash in the next fewhours that it took the panicked system administrator to make a completelevel zero dump of the system. Procedures were changed, and theoperator was given more complete training.</P><PCLASS="para">How do you know if the people doing <EMCLASS="emphasis">your</EM>backups are doing them correctly?</P></DIV><PCLASS="para">At least once a year, you should attempt to restore your entiresystem completely from backups to ensure that your entire backupsystem is working properly. Starting with a different, unconfiguredcomputer, see if you can restore all of your tapes and get the newcomputer operational. Sometimes you will discover that some criticalfile is missing from your backup tapes. These practice trials arethe best times to discover a problem and fix it.</P><PCLASS="para">It's possible that your computer vendor may let youborrow or rent a computer of the appropriate configuration to letyou perform this test. The whole process should take only a fewhours, but it will do wonders for your peace of mind and will verifythat your backup procedure is working correctly (or illustrate anyproblems, if it isn't). If you have business continuationinsurance, you might even get a break on your premiums by doingthis on a regular basis!</P><PCLASS="para">A related exercise that can prove valuable is to pick a fileat random, once a week or once a month, and try to restore it. Notonly will this reveal if the backups are comprehensive, but theexercise of doing the restoration may also provide some insight.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> We have heard many stories about how the tape driveused to make the backup tapes had a speed or alignment problem.Such a problem results in the tapes being readable by the drivethat made them, but unreadable on every other tape drive in theworld! Be sure that you load your tapes on other drives when youcheck them.</P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-1.5">7.1.5 How Long Should You Keep a Backup?</A></H3><PCLASS="para">It <ACLASS="indexterm"NAME="AUTOID-9148"></A><ACLASS="indexterm"NAME="AUTOID-9151"></A><ACLASS="indexterm"NAME="AUTOID-9153"></A><ACLASS="indexterm"NAME="AUTOID-9155"></A>may take a week or a month to realize that afile has been deleted. Therefore, you should keep some backup tapesfor a week, some for a month, and some for several months.</P><PCLASS="para">Many organizations make yearly backups that they archive indefinitely.After all, tape or <SPANCLASS="acronym">CD-ROM</SPAN> is cheap, and <ICLASS="filename">rm</I> isforever. Keeping a yearly or a biannual backup &quot;forever&quot;is a small investment in the event that it should ever be neededagain.</P><PCLASS="para">You may wish to keep on your system an index or listing ofthe names of files on your backup tapes. This way, if you ever needto restore a file, you can find the right tape to use by scanningthe index, rather than reading in every single tape. Having a printedcopy of these indexes is also a good idea, especially if you keepthe online index on a system that may need to be restored!</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> If you keep your backups for a long period of time,you should be sure to migrate the data on your backups each timeyou purchase a new backup system. Otherwise, you might find yourselfstuck with a lot of tapes that can't be read by anyone,anywhere. This happened in the late 1980s to the <SPANCLASS="acronym">MIT</SPAN>Artificial Intelligence Laboratory, which had a collection of researchreports and projects from the 1970s on seven-track tape. One day,the lab started a project to put all of the old work online oncemore. The only problem was that there didn't appear tobe a working seven-track tape drive anywhere in the country thatthe lab could use to restore the data.</P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-1.6">7.1.6 Security for Backups</A></H3><PCLASS="para">Backups <ACLASS="indexterm"NAME="AUTOID-9168"></A><ACLASS="indexterm"NAME="AUTOID-9171"></A><ACLASS="indexterm"NAME="AUTOID-9174"></A><ACLASS="indexterm"NAME="AUTOID-9177"></A>pose a double problemfor computer security. On the one hand, your backup tape is yoursafety net: ideally, it should be kept far away from your computersystem so that a local disaster cannot ruin both. But on the otherhand, the backup contains a complete copy of every file on yoursystem, so the backup itself must be carefully protected.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-7-SECT-1.6.1">7.1.6.1 Physical security for backups</A></H4><PCLASS="para">If you use tape drives to make backups, be sure to take thetape out of the drive! One company in San Francisco that made backupsevery day never bothered removing the cartridge tape from theirdrive: when their computer was stolen over a long weekend by professionalthieves who went through a false ceiling in their office building,they lost everything. &quot;The lesson is that the removablestorage media is much safer when you remove it from the drive,&quot;said an employee after the incident.</P><PCLASS="para">Do not store your backup tapes in the same room as your computersystem! Any <ACLASS="indexterm"NAME="AUTOID-9184"></A>disaster thatmight damage or destroy your computers is likely to damage or destroyanything in the immediate vicinity of those computers as well. Thisrule applies to fire, flood, explosion, and building collapse.</P><PCLASS="para">You may wish to consider investment in a fireproof safe toprotect your backup tapes. However, the safe should be placed <EMCLASS="emphasis">off site</EM>, rather than right next to your computer system. While fireproofsafes do protect against fire and theft, they don't protectyour data against explosion, many kinds of water damage, and buildingcollapse.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> Be certain that any safe you use for storing backupsis actually designed for storing your form of media. One of thefireproof lockboxes from the neighborhood discount store might notbe magnetically safe for your tapes. It might be heat-resistantenough for storing paper, but not for storing magnetic tape, whichcannot withstand the same high temperatures. Also, some of the genericfire-resistant boxes for paper are designed with a liquid in thewalls that evaporates or foams when exposed to heat, to help protectpaper inside. Unfortunately, these chemicals can damage the plasticin magnetic tape or <SPANCLASS="acronym">CD-ROM</SPAN>s.</P></BLOCKQUOTE></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-7-SECT-1.6.2">7.1.6.2 Write-protect your backups</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9194"></A>After you haveremoved a backup tape from a drive, do yourself a favor and flipthe write-protect switch. A write-protected tape cannot be accidentallyerased.</P><PCLASS="para">If you are using the tape for incremental backups, you canflip the write-protect switch when you remove the tape, and thenflip it again when you reinsert the tape later. If you forget tounprotect the tape, your software will probably give you an errorand let you try again. On the other hand, having the tape write-protectedwill save your data if you accidentally put the wrong tape in thetape drive, or run a program on the wrong tape.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-7-SECT-1.6.3">7.1.6.3 Data security for backups</A></H4><PCLASS="para">File protections and passwords protect the information storedon your computer's hard disk, but anybody who has yourbackup tapes can restore your files (and read the information containedin them) on another computer. For this reason, keep your backuptapes under lock and key.</P><PCLASS="para">Several years ago, an employee at a computer magazine pocketeda 4mm cartridge backup tape that was on the desk of the system manager.When the employee got the tape home, he discovered that it containedhundreds of megabytes of personal files, articles in progress, customerand advertising lists, contracts, and detailed business plans fora new venture that the magazine's parent company was planning.The tape also included tens of thousands of dollars worth of computerapplication programs, many of which were branded with the magazine'sname and license numbers. Quite a find for an insider who is settingup a competing publication.</P><PCLASS="para">When you transfer your backup tapes from your computer tothe backup location, protect the tapes at least as well as you normallyprotect the computers themselves. Letting a messenger carry thetapes from building to building may not be appropriate if the materialon the tapes is sensitive. Getting information from a tape by bribingan underpaid courier, or by knocking him unconscious and stealingit, is usually easier and cheaper than breaching a firewall, crackingsome passwords, and avoiding detection online.</P><DIVCLASS="sidebar"><H4CLASS="sidebar"><ACLASS="title"NAME="AUTOID-9202">Another Tale of Backup Woe</A></H4><PCLASS="para">One apocryphal story we saw on the net several years ago concerneda system administrator who tried to do the right thing. Every week,he'd make a full backup of his system. He would test thebackups to be certain the tapes were readable. Then he would throwthem into the passenger seat of his car and he'd drivehome, where he would store the tapes in a fireproof safe.</P><PCLASS="para">All proceeded without incident for many months until therewas a major disaster of some sort that destroyed the computer room.Our would-be hero felt quite relieved that he had these valuablebackups in a safe place. So, after an alternate site was identified,he drove home and retrieved some of the tapes.</P><PCLASS="para">Unfortunately, the tapes contained no usable data. All thedata was lost.</P><PCLASS="para">The problem? It seems that these events occurred in the farnorth, during the winter. The administrator's car had heaterwires in the car seats, and the current passing through the wiresdegaussed the data on the tapes that he stored on the passengerseat during the long ride home.</P><PCLASS="para">Is it true? Possibly. But even if not, the lessons are soundones: test your backup tapes <EMCLASS="emphasis">after</EM> subjectingthem to whatever treatment you would expect for a tape you wouldneed to use, and exercise great care in how you store and transportthe tapes</P></DIV><PCLASS="para">The use of <ACLASS="indexterm"NAME="AUTOID-9211"></A><ACLASS="indexterm"NAME="AUTOID-9214"></A><ACLASS="indexterm"NAME="AUTOID-9216"></A>encryptioncan dramatically improve the security for backup tapes. However,if you do choose to encrypt your backup tapes, be sure that theencryption key is known by more than one person. You may wish toescrow your key (see the sidebar entitled &quot;A Note AboutKey Escrow&quot; in <ACLASS="xref"HREF="ch06_01.htm"TITLE="Cryptography">Chapter 6, <CITECLASS="chapter">Cryptography</CITE></A>). Otherwise, the backupsmay be worthless if the only person with the key forgets it, becomesincapacitated, or decides to hold your data for ransom.</P><PCLASS="para">Here are some ideas for storing a backup tape's encryptionkey:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Always use the same key. Physicalsecurity of your backup tape should be your first line of defense.</P></LI><LICLASS="listitem"><PCLASS="para">Store copies of the key on pieces of paper in envelopes.Give the envelopes to each member of the organization'sboard of directors, or chief officers.</P></LI><LICLASS="listitem"><PCLASS="para">If your organization uses an encryption system suchas <SPANCLASS="acronym">PGP</SPAN> that allows a message to be encryptedfor multiple recipients, encrypt and distribute the backup encryptionkey so that it can be decrypted by anyone on the board.</P></LI><LICLASS="listitem"><PCLASS="para">Alternatively, you might consider a secret-sharingsystem, so that the key can be decrypted by any two or three boardmembers working together, but not by any board member on his own.<ACLASS="indexterm"NAME="AUTOID-9231"></A><ACLASS="indexterm"NAME="AUTOID-9234"></A><ACLASS="indexterm"NAME="AUTOID-9237"></A><ACLASS="indexterm"NAME="AUTOID-9240"></A></P></LI></UL></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-1.7">7.1.7 Legal Issues</A></H3><PCLASS="para">Finally, <ACLASS="indexterm"NAME="AUTOID-9246"></A><ACLASS="indexterm"NAME="AUTOID-9249"></A>some firms should be careful about backingup too much information, or holding it for too long. Recently, backuptapes have become targets in lawsuits and criminal investigations.Backup tapes can be obtained by subpoena or during discovery inlawsuits. If your organization has a policy regarding the destructionof old paper files, you should extend this policy to backup tapesas well.</P><PCLASS="para">You may wish to segregate potentially sensitive data so thatit is stored on separate backup tapes. For example, you can storeapplications on one tape, pending cases on another tape, and libraryfiles and archives on a third.</P><PCLASS="para">Back up your data, but back up with caution.</P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="PART"HREF="part03.htm"TITLE="III. System Security"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: III. System Security"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 Sample Backup Strategies"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.2 Sample Backup Strategies"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">III. System Security</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">7.2 Sample Backup Strategies</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>