<HTML><HEAD><TITLE>[Chapter 7] 7.2 Sample Backup Strategies</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:05:19Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch07_01.htm"TITLE="7. Backups"><LINKREL="prev"HREF="ch07_01.htm"TITLE="7.1 Make Backups!"><LINKREL="next"HREF="ch07_03.htm"TITLE="7.3 Backing Up System Files"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_01.htm"TITLE="7.1 Make Backups!"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.1 Make Backups!"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 7<BR>Backups</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_03.htm"TITLE="7.3 Backing Up System Files"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.3 Backing Up System Files"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-7-SECT-2">7.2 Sample Backup Strategies</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9257"></A><ACLASS="indexterm"NAME="AUTOID-9260"></A>A backup strategy describes how often you back upeach of your computer's partitions, what kinds of backupsyou use, and for how long backups are kept. Backup strategies arebased on many factors, including:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">How much storage the site has</P></LI><LICLASS="listitem"><PCLASS="para">The kind of backup system that is used</P></LI><LICLASS="listitem"><PCLASS="para">The importance of the data</P></LI><LICLASS="listitem"><PCLASS="para">The amount of time and money available for conductingbackups</P></LI><LICLASS="listitem"><PCLASS="para">Expected uses of the backup archive</P></LI></UL><PCLASS="para">In the following sections, we outline some typical backupstrategies for several different situations.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-2.1">7.2.1 Individual Workstation</A></H3><PCLASS="para">Most <ACLASS="indexterm"NAME="AUTOID-9278"></A><ACLASS="indexterm"NAME="AUTOID-9280"></A>users do not back up their workstationson a regular basis: they think that backing up their data is toomuch effort. Unfortunately, they don't consider the effortrequired to retype everything that they've ever done torecover their records.</P><PCLASS="para">Here is a simple backup strategy for users with PCs or stand-aloneworkstations:</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-7-SECT-2.1.1">7.2.1.1 Backup plan</A></H4><DLCLASS="variablelist"><DTCLASS="term">Full backups </DT><DDCLASS="listitem"><PCLASS="para">Once a month, or after a major software packageis installed, back up the entire system. At the beginning of eachyear, make two complete backups and store them in different locations.</P></DD><DTCLASS="term">Project-related backups </DT><DDCLASS="listitem"><PCLASS="para">Back up current projects and critical files withspecially written Perl or shell scripts. For example, you mighthave a Perl script that backs up all of the files for a programyou are writing, or all of the chapters of your next book. Thesefiles can be bundled and compressed into a single tar file, whichcan often then be stored on a floppy disk or saved over the networkto another computer.</P></DD><DTCLASS="term">Home-directory backups</DT><DDCLASS="listitem"><PCLASS="para">If your system is on a network, write a shell scriptthat backs up your home directory to a remote machine. Set the scriptto automatically run once a day, or as often as is feasible. Butbeware: if you are not careful, you could easily overwrite yourbackup with a bad copy before you realize that something needs tobe restored. Spending a few extra minutes to set things up properly(for example, by keeping three or four home-directory backups ondifferent machines, each updated on a different day of the week)can save you a lot of time (and panic) later.</P></DD></DL><PCLASS="para">This strategy never uses incremental backups; instead, completebackups of a particular set of files are always created. Such project-relatedbackups tend to be incredibly comforting and occasionally valuable.</P><DLCLASS="variablelist"><DTCLASS="term">Retention schedule</DT><DDCLASS="listitem"><PCLASS="para">Keep the monthly backups two years. Keep the yearlybackups forever.</P></DD></DL></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-7-SECT-2.1.2">7.2.1.2 Media rotation</A></H4><PCLASS="para">If you <ACLASS="indexterm"NAME="AUTOID-9308"></A><ACLASS="indexterm"NAME="AUTOID-9311"></A>wishto perform incremental backups, you can improve their reliabilityby using media rotation. In implementing this strategy, you actuallycreate two complete sets of backup tapes, A and B. At the beginningof your backup cycle, you perform two complete dumps, first to tapeA, and then on the following day, to tape B. Each day you performan incremental dump, alternating tapes A and B. In this way, eachfile is backed up in two locations. This scheme is shown graphicallyin <ACLASS="xref"HREF="ch07_02.htm#PUIS-CHP-7-FIG-2"TITLE="Incremental backup with media rotation">Figure 7.2</A>.</P><H4CLASS="figure"><ACLASS="title"NAME="PUIS-CHP-7-FIG-2">Figure 7.2: Incremental backup with media rotation</A></H4><IMGCLASS="graphic"SRC="figs/puis_0702.gif"ALT="Figure 7.2"></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-2.2">7.2.2 Small Network of Workstations and a Server</A></H3><PCLASS="para">Most <ACLASS="indexterm"NAME="AUTOID-9320"></A><ACLASS="indexterm"NAME="AUTOID-9323"></A>small groups rely on a single server with up to afew dozen workstations. In our example, the organization has a singleserver with several disks, 15 workstations, and <SPANCLASS="acronym">DAT</SPAN>tape backup drive.</P><PCLASS="para">The organization doesn't have much money to spendon system administration, so it sets up a system for backing upthe most important files over the network to a specially designedserver.</P><TABLECLASS="informaltable"><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Server configuration</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Drive #1: /, /usr,/var (standard <SPANCLASS="acronym">UNIX</SPAN> filesystems)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Drive #2: <ICLASS="filename">/users</I> (userfiles)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Drive #3: <ICLASS="filename">/localapps</I>(locally installed applications)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Client configuration</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Clients are run as &quot;datalessworkstations&quot; and are not backed up. Most clients are equippedwith a 360MB hard disk, although one client has a 1GB drive.</P></TD></TR></TBODY></TABLE><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-7-SECT-2.2.1">7.2.2.1 Backup plan</A></H4><DLCLASS="variablelist"><DTCLASS="term">Monthly backups</DT><DDCLASS="listitem"><PCLASS="para">Once a month, each drive is backed up onto its owntape with the <SPANCLASS="acronym">UNIX</SPAN> dump utility. This is a fullbackup, also known as a level 0 dump.</P></DD><DTCLASS="term">Weekly backups</DT><DDCLASS="listitem"><PCLASS="para">Once a week, an incremental backup on drive #1and drive #3 is written to a <SPANCLASS="acronym">DAT</SPAN> tape(Level 1 dump). The entire /users filesystem is then addedto the end of that tape (Level 0 dump).</P></DD><DTCLASS="term">Daily backups</DT><DDCLASS="listitem"><PCLASS="para">A Level 1 dump on drive #2 is written toa file which is stored on the local hard disk of the client equippedwith the 1GB hard drive. The backup is compressed as it is stored.</P></DD><DTCLASS="term">Hourly backups</DT><DDCLASS="listitem"><PCLASS="para">Every hour, a special directory, <ICLASS="filename">/users/activeprojects</I>,is archived in a tar file. This file is sent over the network tothe client workstation with the 1GB drive. The last eight filesare kept, giving immediate backups in the event that a user accidentallydeletes or corrupts a file. The system checks the client to makesure that it has adequate space on the drive before beginning eachhourly backup.</P></DD></DL><PCLASS="para">The daily and hourly backups are done automatically via scriptsrun by the <ICLASS="filename">cron</I> daemon. All monthly and weeklybackups are done with shell scripts that are run manually. The scriptsboth perform the backup and then verify that the data on the tapecan be read back, but the backups do not verify that the data onthe tape is the same as that on the disk. (No easy verificationmethod exists for the standard <SPANCLASS="acronym">UNIX</SPAN> <ICLASS="filename">dump/restore</I>programs.)</P><PCLASS="para">Automated systems should be inspected on a routine basis tomake sure they are still working as planned. You may have the scriptnotify you when completed, sending a list of any errors to a human(in addition to logging them in a file).</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> If data confidentiality is very important, or if thereis a significant risk of packet sniffing, you should design yourbackup scripts so that unencrypted backup data is never sent overthe network.</P></BLOCKQUOTE></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-7-SECT-2.2.2">7.2.2.2 Retention schedule</A></H4><DLCLASS="variablelist"><DTCLASS="term">Monthly backups</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9390"></A>Kept for a full calendar year.Each quarterly backup is kept as a permanent archive for a few years.The year-end backups are kept forever.</P></DD><DTCLASS="term">Weekly backups</DT><DDCLASS="listitem"><PCLASS="para">Kept on four tapes, which are recycled each month.These tapes should be thrown out every five years (60 uses), althoughthe organization will probably have a new tape drive within fiveyears that uses different kinds of tapes.</P></DD><DTCLASS="term">Daily backups</DT><DDCLASS="listitem"><PCLASS="para">One day's backup is kept. Each day'sbackup overwrites the previous day's.</P></DD></DL></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-2.3">7.2.3 Large Service-Based Network with Small Budgets</A></H3><PCLASS="para">Most large decentralized organizations, such as universities,operate networks with thousands of users and a high degree of autonomybetween system operators. The primary goal of the backup systemof these organizations is to minimize downtime in the event of hardwarefailure or network attack; if possible, the system can also restoreuser files deleted or damaged by accident.</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Server configuration</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Primary servers</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Drive #1: <ICLASS="filename">/, /usr, /var</I> (standard <SPANCLASS="acronym">UNIX</SPAN> filesystems)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Drives#2-5: user files</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Secondary server (matcheseach primary)</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Drive #1: <ICLASS="filename">/</I>,<ICLASS="filename">/usr, /var</I> (standard <SPANCLASS="acronym">UNIX</SPAN> filesystems)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Drives#2-6: Backup staging area</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Client configuration</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Clients are run as &quot;datalessworkstations&quot; and are not backed up. Most clients are equippedwith a 500MB hard disk. The clients receive monthly software distributionsfrom a trusted server, by CD-<SPANCLASS="acronym">ROM</SPAN> or network.Each distribution includes all files and results in a reload ofa fresh copy of the operating system. These distributions keep thesystems up to date, discourage local storage by users, and reducethe impact (and lifetime) of Trojan horses and other unauthorizedmodifications of the operating system.</P></TD></TR></TBODY></TABLE><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-7-SECT-2.3.1">7.2.3.1 Backup plan</A></H4><PCLASS="para">Every night, each backup staging area drive is erased andthen filled with the contents of the matching drive on its matchingprimary server. The following morning, the entire disk is copiedto a high-speed 8mm tape drive.</P><PCLASS="para">Using special secondary servers dramatically eases the loadof writing backup tapes. This strategy also provides a hot replacementsystem should the primary server fail.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-7-SECT-2.3.2">7.2.3.2 Retention schedule</A></H4><PCLASS="para">Backups are retained for two weeks. During that time, userscan have their files restored to a special &quot;restoration&quot;area, perhaps for a small fee. Users who wish archival backups forlonger than two weeks must arrange backups of their own. One ofthe reasons for this decision is privacy: users should have a reasonableexpectation that if they delete their files, the backups will beerased at some point in the future.</P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-2.4">7.2.4 Large Service-Based Networks with Large Budgets</A></H3><PCLASS="para">Many banks and other large firms have requirements for minimumdowntime in the event of a failure. Thus, current and complete backupsthat are ready to go at a moment's notice are vital. Inthis scheme, we do not use magnetic media at all. Instead, we usea network and special disks.</P><PCLASS="para">Each of the local computers uses <SPANCLASS="acronym">RAID</SPAN> (RedundantArrays of Independent Storage) for local disk. Every write to diskis mirrored on another disk automatically, so the failure of onehas no user-noticeable effects.</P><PCLASS="para">Meanwhile, the entire storage of the system is mirrored everynight at 2 a.m. to a set of remote disks in another state (a <ICLASS="firstterm">hot site)</I>. This mirroring is done using a high-speed, encrypted leasednetwork line. At the remote location, there is an exact duplicateof the main system. During the day, a running log of activitiesis kept and mirrored to the remote site as it is written locally.</P><PCLASS="para">If a failure of the main system occurs, the remote systemis activated. It replays the transaction log and duplicates thechanges locally, and then takes over operation for the failed mainsite.</P><PCLASS="para">Every morning, a <SPANCLASS="acronym">CD-ROM</SPAN> is made of thedisk contents of the backup system, so as not to slow actual operations.The contents are then copied, and the copies sent by bonded courierto different branch offices around the country, where they are savedfor seven years. Data on old tapes will be migrated to new backupsystems as the technology becomes available.<ACLASS="indexterm"NAME="AUTOID-9460"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-2.5">7.2.5 Deciding upon a Backup Strategy</A></H3><PCLASS="para">The key to deciding upon a good strategy for backups is tounderstand the importance and time-sensitivity of your data. Asa start, we suggest that answers to the following questions willhelp you plan your backups:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">How quickly do you need to resumeoperations after a complete loss of the main system?</P></LI><LICLASS="listitem"><PCLASS="para">How quickly do you need to resume operations aftera partial loss?</P></LI><LICLASS="listitem"><PCLASS="para">Can you perform restores while the system is &quot;live?&quot;</P></LI><LICLASS="listitem"><PCLASS="para">Can you perform backups while the system is &quot;live?&quot;</P></LI><LICLASS="listitem"><PCLASS="para">What data do you need restored first? Next? Last?</P></LI><LICLASS="listitem"><PCLASS="para">Of the users you must listen to, who will complainthe most if their data is not available?</P></LI><LICLASS="listitem"><PCLASS="para">What will cause the biggest loss if it is not available?</P></LI><LICLASS="listitem"><PCLASS="para">Who loses data most often from equipment or humanfailures?</P></LI><LICLASS="listitem"><PCLASS="para">How many spare copies of the backups must you haveto feel safe?</P></LI><LICLASS="listitem"><PCLASS="para">How long do you need to keep each backup?</P></LI><LICLASS="listitem"><PCLASS="para">How much are you willing or able to spend?<ACLASS="indexterm"NAME="AUTOID-9489"></A><ACLASS="indexterm"NAME="AUTOID-9492"></A></P></LI></UL></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_01.htm"TITLE="7.1 Make Backups!"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.1 Make Backups!"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_03.htm"TITLE="7.3 Backing Up System Files"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.3 Backing Up System Files"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">7.1 Make Backups!</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">7.3 Backing Up System Files</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>