<HTML><HEAD><TITLE>[Chapter 7] 7.3 Backing Up System Files</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:05:22Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch07_01.htm"TITLE="7. Backups"><LINKREL="prev"HREF="ch07_02.htm"TITLE="7.2 Sample Backup Strategies"><LINKREL="next"HREF="ch07_04.htm"TITLE="7.4 Software for Backups"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 Sample Backup Strategies"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.2 Sample Backup Strategies"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 7<BR>Backups</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_04.htm"TITLE="7.4 Software for Backups"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.4 Software for Backups"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-7-SECT-3">7.3 Backing Up System Files</A></H2><PCLASS="para">In <ACLASS="indexterm"NAME="AUTOID-9498"></A><ACLASS="indexterm"NAME="AUTOID-9501"></A><ACLASS="indexterm"NAME="AUTOID-9504"></A>addition to performing routine backups of yourentire computer system, you may wish to make separate backup copiesof system-critical files on a regular basis. These backups can serveseveral functions:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">They can help you quickly recoverif a vital configuration file is unexpectedly erased or modified.</P></LI><LICLASS="listitem"><PCLASS="para">They can help you detect unauthorized modificationsto critical files, as well as monitor legitimate modifications.</P></LI><LICLASS="listitem"><PCLASS="para">They make installing a new version of your operatingsystem dramatically easier (especially if you do not wish to useyour vendor's &quot;upgrade&quot; facility) byisolating all site-dependent configuration files in a single place.</P></LI></UL><PCLASS="para">Ideally, you should back up every file that contains vitalsystem configuration or account information.</P><PCLASS="para">Setting-up an automatic system for backing up your systemfiles is not difficult. You might, for instance, simply have a shellscript that copies the files <ICLASS="filename">/etc/passwd</I> and <ICLASS="filename">/usr/etc/aliases</I>into a specially designated &quot;backup directory&quot;on a regular basis. Or you might have a more sophisticated system,in which a particular workstation gathers together all of the configurationfiles for every computer on a network, archives them in a directory,and sends you email each day that describes any modifications. Thechoice is up to you and your needs.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-3.1">7.3.1 What Files to Back Up?</A></H3><PCLASS="para">If <ACLASS="indexterm"NAME="AUTOID-9522"></A>youare constructing a system for backing up system files on a regularbasis, you should carefully consider which files you wish to archiveand what you want to do with them.</P><PCLASS="para">By comparing a copy of the password file with <ICLASS="filename">/etc/passwd</I>,for example, you can quickly discover if a new user has been addedto the system. But it is also important to check other files. Forexample, if an intruder can modify the <ICLASS="filename">/etc/rc </I>file,the commands he inserts will be executed automatically the nexttime the system is booted. Modifying <ICLASS="filename">/usr/lib/crontab</I>can have similar results. (<ACLASS="xref"HREF="ch11_01.htm"TITLE="Protecting Against Programmed Threats">Chapter 11, <CITECLASS="chapter">Protecting Against Programmed Threats</CITE></A>, describes what you shouldlook for in these files.)</P><PCLASS="para">Some files that you may wish to copy are listed in <ACLASS="xref"HREF="ch07_03.htm#PUIS-CHP-7-TAB-1"TITLE="Critical System Files That You Should Frequently Back Up">Table 7.1</A>.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-7-TAB-1">Table 7.1: Critical System Files That You Should Frequently Back Up</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Filename</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Things to Look for</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">/etc/passwd</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">New accounts</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">/etc/shadow</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Accounts with no passwords</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">/etc/group</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">New groups</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">/etc/rc*</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Changes in the system boot sequence</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">/etc/ttys, /etc/ttytab</I>,or <ICLASS="filename">/etc/inittab</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Configuration changes in terminals</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">/usr/lib/crontab, /usr/spool/cron/crontabs/</I>,or<ICLASS="filename">/etc/crontab</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">New commands set to run on a regularbasis</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">/usr/lib/aliases</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Changes in mail delivery (especiallyemail addresses that are redirected to programs.)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">/etc/exports</I> (<SPANCLASS="acronym">BSD</SPAN>)<ICLASS="filename">/etc/dfs/dfstab</I>(<SPANCLASS="acronym">SVR4</SPAN>)</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Changes in your <SPANCLASS="acronym">NFS</SPAN>filesystem security</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">/etc/netgroups</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Changes in network groups</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">/etc/fstab</I> (<SPANCLASS="acronym">BSD</SPAN>)<ICLASS="filename">/etc/vfstab</I>(<SPANCLASS="acronym">SVR4</SPAN>)</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Changes in mounting options</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">/etc/inetd.conf</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Changes in network daemons</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UUCP</SPAN> files (in <ICLASS="filename">/usr/lib/uucp</I>or <ICLASS="filename">/etc/uucp</I>)</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"></P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">L.sys</I> or <SPANCLASS="acronym">USERFILE</SPAN></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Changes in the <SPANCLASS="acronym">UUCP</SPAN>system</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">Systems</I> or <ICLASS="filename">Permissions</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD></TR></TBODY></TABLE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-7-SECT-3.2">7.3.2 Building an Automatic Backup System</A></H3><PCLASS="para">For <ACLASS="indexterm"NAME="AUTOID-9645"></A><ACLASS="indexterm"NAME="AUTOID-9648"></A><ACLASS="indexterm"NAME="AUTOID-9651"></A>added convenience, keep the backupsof all of the system-critical files in a single directory. Makecertain the directory isn't readable by any user otherthan <ICLASS="filename">root</I>, and make sure it has a nonobvious name&nbsp;- afterall, you want the files to remain hidden in the event that an intruderbreaks into your computer and becomes the superuser! If you havea local area network, you may wish to keep the copies of the criticalfiles on a different computer. An even better approach is to storethese files on a removable medium such as a <ACLASS="indexterm"NAME="AUTOID-9656"></A>floppy disk or a cartridgedisk that can be mounted when necessary.</P><PCLASS="para">You can use <KBDCLASS="command">tar</KBD> or <ACLASS="indexterm"NAME="AUTOID-9661"></A><ACLASS="indexterm"NAME="AUTOID-9663"></A><KBDCLASS="command">cpio</KBD>to store all of the files that you back up in a singlesnapshot. Alternatively, you can also use <SPANCLASS="acronym">RCS</SPAN><ACLASS="indexterm"NAME="AUTOID-9667"></A><ACLASS="indexterm"NAME="AUTOID-9669"></A><ACLASS="indexterm"NAME="AUTOID-9671"></A><ACLASS="indexterm"NAME="AUTOID-9673"></A>(Revision Control System) or <SPANCLASS="acronym">SCCS</SPAN> (Source CodeControl System) to archive these files and keep a revision history.</P><DIVCLASS="sidebar"><H4CLASS="sidebar"><ACLASS="title"NAME="AUTOID-9676">Never Underestimate the Value of Paper</A></H4><PCLASS="para">Keepingprinted <ACLASS="indexterm"NAME="AUTOID-9679"></A>paper copies of yourmost important configuration files is a good idea. If somethinghappens to the online versions, you can always refer to the paperones. Paper records are especially important if your system hascrashed in a severe and nontrivial fashion, because in these circumstancesyou may not be able to recover your electronic versions. Finally,paper printouts can prove invaluable in the event that your systemhas been penetrated by nefarious intruders, because they form aphysical record. Even the most skilled intruders cannot use a capturedaccount to alter a printout in a locked desk drawer or other safelocation.</P></DIV><PCLASS="para">A single shell script can automate the checking describedabove. This script compares copies of specified files with mastercopies and prints any differences. The sample script included belowkeeps two copies of several critical files and reports the differences.Modify it as appropriate for your own site.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#!/bin/sh MANAGER=/u/sysadm FILES=&quot;/etc/passwd /etc/group /usr/lib/aliases\ /etc/rc* /etc/netgroup /etc/fstab /etc/exports\ /usr/lib/crontab&quot; cd $MANAGER/private for FILE in $FILES do  /bin/echo $FILE  BFILE=`basename $FILE`  /usr/bin/diff $BFILE $FILE  /bin/mv $BFILE $BFILE.bak  /bin/cp $FILE $BFILE done </PRE></BLOCKQUOTE><PCLASS="para">You can use <ACLASS="indexterm"NAME="AUTOID-9685"></A>cronto automate running this daily shell script as follows[7]:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[7] Thisexample assumes that you have a version of cron that allows youto specify the user under which the cron script should be run.</P></BLOCKQUOTE><BLOCKQUOTECLASS="screen"><PRECLASS="screen">0 0 * * * root /bin/sh /u/sysadm/private/daily \  		<KBDCLASS="command">| mail -s &quot;daily output&quot; sysadm </KBD></PRE></BLOCKQUOTE><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> A significant disadvantage of using an automated scriptto check your system is that you run the risk that an intruder willdiscover it and circumvent it. Nonstandard entries in<ICLASS="filename">/usr/lib/crontab</I> are prime candidates for further investigationsby experienced system crackers.</P></BLOCKQUOTE><PCLASS="para">See <ACLASS="xref"HREF="ch09_01.htm"TITLE="Integrity Management">Chapter 9, <CITECLASS="chapter">Integrity Management</CITE></A>,for additional information about system checking.<ACLASS="indexterm"NAME="AUTOID-9697"></A><ACLASS="indexterm"NAME="AUTOID-9700"></A><ACLASS="indexterm"NAME="AUTOID-9703"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 Sample Backup Strategies"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.2 Sample Backup Strategies"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_04.htm"TITLE="7.4 Software for Backups"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.4 Software for Backups"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">7.2 Sample Backup Strategies</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">7.4 Software for Backups</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>