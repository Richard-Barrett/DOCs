<HTML><HEAD><TITLE>[Chapter 8] Defending  Your Accounts</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:05:33Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part03.htm"TITLE="III. System Security"><LINKREL="prev"HREF="ch07_04.htm"TITLE="7.4 Software for Backups"><LINKREL="next"HREF="ch08_02.htm"TITLE="8.2 Monitoring File Format"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_04.htm"TITLE="7.4 Software for Backups"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.4 Software for Backups"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_02.htm"TITLE="8.2 Monitoring File Format"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.2 Monitoring File Format"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="PUIS-CHP-8">8. Defending  Your Accounts</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="SECT1"HREF="#PUIS-CHP-8-SECT-1"TITLE="8.1 Dangerous Accounts">Dangerous Accounts</A><BR><ACLASS="SECT1"HREF="ch08_02.htm"TITLE="8.2 Monitoring File Format">Monitoring File Format</A><BR><ACLASS="SECT1"HREF="ch08_03.htm"TITLE="8.3 Restricting Logins">Restricting Logins</A><BR><ACLASS="SECT1"HREF="ch08_04.htm"TITLE="8.4 Managing Dormant Accounts">Managing Dormant Accounts</A><BR><ACLASS="SECT1"HREF="ch08_05.htm"TITLE="8.5 Protecting the root Account">Protecting the root Account</A><BR><ACLASS="SECT1"HREF="ch08_06.htm"TITLE="8.6 The UNIX Encrypted Password System">The UNIX Encrypted Password System</A><BR><ACLASS="SECT1"HREF="ch08_07.htm"TITLE="8.7 One-Time Passwords">One-Time Passwords</A><BR><ACLASS="SECT1"HREF="ch08_08.htm"TITLE="8.8 Administrative Techniques for Conventional Passwords">Administrative Techniques for Conventional Passwords</A></P><P></P></DIV><DIVCLASS="epigraph"><PCLASS="para"ALIGN="right"><I>An ounce of prevention . . . </I></P></DIV><PCLASS="para">The worst time to think about how to protect your computerand its data from intruders is after a break-in. At that point,the damage has already been done, and determining where and to whatextent your system has been hurt can be difficult.</P><PCLASS="para">Did the intruder modify any system programs? Did the intrudercreate any new accounts, or change the passwords of any of yourusers? If you haven't prepared in advance, you could haveno way of knowing the answers.</P><PCLASS="para">This chapter describes the ways in which an attacker can gainentry to your system through accounts that are already in place,and the ways in which you can make these accounts more difficultto attack.</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1">8.1 Dangerous Accounts</A></H2><PCLASS="para">Every account on your computer is a door to the outside, aportal through which both authorized and unauthorized users canenter. Some of the portals are well defended, while others may notbe. The system administrator should search for weak points and sealthem up.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.1">8.1.1 Accounts Without Passwords</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9977"></A><ACLASS="indexterm"NAME="AUTOID-9980"></A>Like the lock or guard on the front door ofa building, the password on each one of your computer'saccounts is your system's first line of defense. An accountwithout a password is a door without a lock. Anybody who finds thatdoor&nbsp;- anybody who knows the name of the account&nbsp;- canenter.</P><PCLASS="para">Many so-called &quot;computer crackers&quot; succeedonly because they are good at finding accounts without passwordsor accounts that have passwords that are easy to guess.</P><PCLASS="para">On <SPANCLASS="acronym">SVR4 </SPAN>versions of <SPANCLASS="acronym">UNIX</SPAN>,you can scan for accounts without passwords by using the <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-9988"></A>logins</EM> command:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># logins -p</PRE></BLOCKQUOTE><PCLASS="para">You can also scan for accounts without passwords by usingthe command: <ACLASS="indexterm"NAME="AUTOID-9992"></A><ACLASS="indexterm"NAME="AUTOID-9994"></A></P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% cat-passwd | awk -F: 'length($2)&lt;1 {print $1}' georgedan% </PRE></BLOCKQUOTE><PCLASS="para">In this example, <EMCLASS="emphasis">george</EM> and <EMCLASS="emphasis">dan</EM>don't have passwords. Take a look at their entries in the<EMCLASS="emphasis">/etc/passwd</EM> file:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% egrep 'dan|george' /etc/passwdgeorge::132:10:George Bush:/usr/wash/george:/bin/cshdan::132:10:Dan Quayle:/u/backyard/dan:/bin/csh%</PRE></BLOCKQUOTE><PCLASS="para">These two users have probably long forgotten about their accountson this system. Their accounts should be disabled.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> The <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10008"></A><ACLASS="indexterm"NAME="AUTOID-10010"></A>/etc/passwd</EM>file may not be the correct file to check for missing passwordson systems that have shadow password files (described later in thischapter) installed. Different shadow password schemes store theactual encrypted passwords in different locations. On some systems,the file to check may be <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10014"></A><ACLASS="indexterm"NAME="AUTOID-10016"></A><ACLASS="indexterm"NAME="AUTOID-10019"></A>/etc/shadow</EM>or <EMCLASS="emphasis">/etc/secure/passwd</EM>. On some AT&amp;T<ACLASS="indexterm"NAME="AUTOID-10023"></A>System V systems,passwords are stored on a user-by-user basis in individual fileslocated underneath the <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10027"></A>/tcb</EM>directory. Check your own system's documentation for details.Also, systems using <EMCLASS="emphasis">NIS, NIS+</EM> or <EMCLASS="emphasis">DCE</EM>may get the passwords from a server; see <ACLASS="xref"HREF="ch19_01.htm"TITLE="RPC, NIS, NIS+,  and Kerberos">Chapter 19, <CITECLASS="chapter">RPC, NIS, NIS+,  and Kerberos</CITE></A>, for details. <ACLASS="indexterm"NAME="AUTOID-10032"></A><ACLASS="indexterm"NAME="AUTOID-10035"></A></P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.2">8.1.2 Default Accounts</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10041"></A><ACLASS="indexterm"NAME="AUTOID-10044"></A>Manycomputer systems are delivered to end users with one or more defaultaccounts. These accounts usually have standard passwords.</P><PCLASS="para">For example, many <SPANCLASS="acronym">UNIX</SPAN> computers come witha <EMCLASS="emphasis">root</EM> account that has no password. Vendorstell users to assign passwords to these accounts, but, too often,users do not. (<SPANCLASS="acronym">UNIX</SPAN> is not alone with this problem;other operating systems come delivered with standard accounts like<SPANCLASS="acronym">SYSTEM</SPAN> with the password set to <SPANCLASS="acronym">MANAGER</SPAN>.)</P><PCLASS="para">One way around this problem that has been taken by several<SPANCLASS="acronym">UNIX</SPAN> vendors is to have the operating systemdemand passwords for special accounts such as <EMCLASS="emphasis">root</EM>when it is first installed. We hope that all vendors will adoptthis approach in the future.</P><PCLASS="para">Make a list of all of the accounts that came with your computersystem. (These accounts are normally at the beginning of the <EMCLASS="emphasis">/etc/passwd</EM>file and have names like <EMCLASS="emphasis">bin</EM>, <EMCLASS="emphasis">lib</EM>,<EMCLASS="emphasis">uucp</EM>, and <EMCLASS="emphasis">news</EM>.) Eitherdisable these accounts (as described later in this chapter) or changetheir passwords.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10063"></A>Some application programsautomatically install accounts in the <EMCLASS="emphasis">/etc/passwd</EM>file with names like <EMCLASS="emphasis">demo</EM> (used to demonstratethe software). Be sure to delete or disable these accounts afterthe software is installed. Likewise, computers that are taken totrade shows sometimes have <EMCLASS="emphasis">demo</EM> accounts createdto make demonstrations easier to run. Remember to remove these accountswhen the computer is returned. (Even better: erase the hard diskand reinstall the operating system. You never know what a computermight bring back from a trade show.)</P><PCLASS="para"><ACLASS="xref"HREF="ch08_01.htm#PUIS-CHP-8-TAB-1"TITLE="Account Names Commonly Attacked on UNIX Systems">Table 8.1</A> is a list of <ACLASS="indexterm"NAME="AUTOID-10070"></A>accounts that are commonly attacked. If youhave any of these accounts, make sure that they are protected withstrong passwords or that they are set up so they can do no damageif penetrated (see the sections below entitled &quot;AccountsThat Run a Single Command&quot; and &quot;Open Accounts&quot;).</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-8-TAB-1">Table 8.1: Account NamesCommonly Attacked on UNIX Systems</A></CAPTION><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">open</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">help</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">games</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">guest</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">demo</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">maint</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">mail</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">finger</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">uucp</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">bin</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">toor</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">system</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">who</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">ingres</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">lp</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">nuucp</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">visitor</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"></P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">manager</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">telnet</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10129"></A><ACLASS="indexterm"NAME="AUTOID-10132"></A></P></TD></TR></TBODY></TABLE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.3">8.1.3 Accounts That Run a Single Command</A></H3><PCLASS="para"><SPANCLASS="acronym">UNIX</SPAN><ACLASS="indexterm"NAME="AUTOID-10139"></A><ACLASS="indexterm"NAME="AUTOID-10142"></A><ACLASS="indexterm"NAME="AUTOID-10145"></A><ACLASS="indexterm"NAME="AUTOID-10148"></A>allows the system administrator to create accounts that simply runa single command or application program (rather than a shell) whena user logs into them. Often these accounts do not have passwords.Examples of such accounts include <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10151"></A><ACLASS="indexterm"NAME="AUTOID-10153"></A><ACLASS="indexterm"NAME="AUTOID-10155"></A><ACLASS="indexterm"NAME="AUTOID-10157"></A>date</EM>,<EMCLASS="emphasis">uptime</EM>, <EMCLASS="emphasis">sync</EM>, and <EMCLASS="emphasis">finger</EM>as shown below:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">date::60000:100:Run the date program:/tmp:/sbin/dateuptime::60001:100:Run the uptime program:/tmp:/usr/ucb/uptimefinger::60002:100:Run the finger program:/tmp:/usr/ucb/fingersync::60003:100:Run the sync program:/tmp:/sbin/sync</PRE></BLOCKQUOTE><PCLASS="para">If you have these accounts installed on your computer, someonecan use them to find out the time or to determine who'slogged into your computer simply by typing the name of the commandat the <KBDCLASS="command">login: </KBD>prompt. For example:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">login: uptimeLast login: Tue Jul 31 07:43:10 on ttya		Whammix V 17.1 ready to go!9:44am up 7 days, 13:09, 4 users, load average: 0.92, 1.34, 1.51login: </PRE></BLOCKQUOTE><PCLASS="para">If you decide to set up an account of this type, you shouldbe sure that the command it runs takes no keyboard input and canin no way be coerced into giving the user an interactive process.Specifically, these programs should not have <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10168"></A>shell escapes</EM>. Letting a user runthe Berkeley <EMCLASS="emphasis">mail</EM> program without logging inis dangerous, because the <EMCLASS="emphasis">mail</EM> program allowsthe user to run any command by preceding a line of the mail messagewith a <ACLASS="indexterm"NAME="AUTOID-10172"></A><ACLASS="indexterm"NAME="AUTOID-10175"></A>tilde and an exclamation mark.</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% mail SarahSubject: test message~!dateWed Aug 1 09:56:42 EDT 1990</PRE></BLOCKQUOTE><PCLASS="para">Allowing programs like <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10181"></A>who</EM>and <EMCLASS="emphasis">finger</EM> to be run by someone who hasn'tlogged in is also a security risk, because these commands let peoplelearn the names of accounts on your computer. Such information canbe used as the basis for further attacks against your computer system.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> If you must have accounts that run a single command,do not have those accounts run with the <SPANCLASS="acronym">UID</SPAN> of0 (<EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10188"></A>root</EM>)or of any other privileged user (such as <EMCLASS="emphasis">bin</EM>,<EMCLASS="emphasis">system</EM>, <EMCLASS="emphasis">daemon</EM>, etc.)<ACLASS="indexterm"NAME="AUTOID-10194"></A><ACLASS="indexterm"NAME="AUTOID-10197"></A><ACLASS="indexterm"NAME="AUTOID-10200"></A><ACLASS="indexterm"NAME="AUTOID-10203"></A><ACLASS="indexterm"NAME="AUTOID-10205"></A></P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.4">8.1.4 Open Accounts</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10211"></A><ACLASS="indexterm"NAME="AUTOID-10213"></A><ACLASS="indexterm"NAME="AUTOID-10215"></A><ACLASS="indexterm"NAME="AUTOID-10218"></A>Many<ACLASS="indexterm"NAME="AUTOID-10221"></A>computer centers provide accounts onwhich visitors can play games while they are waiting for an appointment,or allow visitors to use a modem or network connection to contacttheir own computer systems. Typically these accounts have nameslike <EMCLASS="emphasis">open</EM>, <EMCLASS="emphasis">guest</EM>, or <EMCLASS="emphasis">play</EM>.They usually do not require passwords.</P><PCLASS="para">Because the names and passwords of open accounts are oftenwidely known and easily guessed, they are security breaches waitingto happen. An intruder can use an open account to gain initial accessto your machine, and then use that access to probe for greater securitylapses on the inside. At the very least, an intruder who is breakinginto<EMCLASS="emphasis"> other </EM>sites might direct calls throughthe guest account on your machine, making their calls difficultor even impossible to trace.</P><PCLASS="para">Providing open accounts in your system is a very bad idea.If you must have them, for whatever reason, generate a new, randompassword daily for your visitors to use. Don't allow thepassword to be sent via electronic mail or given to anyone who doesn'tneed it for that day.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.4.1">8.1.4.1 Restricted shells under System V UNIX</A></H4><PCLASS="para">The <ACLASS="indexterm"NAME="AUTOID-10232"></A><ACLASS="indexterm"NAME="AUTOID-10235"></A><ACLASS="indexterm"NAME="AUTOID-10237"></A><ACLASS="indexterm"NAME="AUTOID-10240"></A><ACLASS="indexterm"NAME="AUTOID-10243"></A><ACLASS="indexterm"NAME="AUTOID-10245"></A>System V <SPANCLASS="acronym">UNIX</SPAN>shell can be invoked to operate in a restricted mode that can beused to minimize the dangers of an open account. This mode occurswhen the shell is invoked with a <KBDCLASS="command">-r</KBD> command-line option,or with the command named <EMCLASS="emphasis">rsh</EM> (restricted shell)[1]&nbsp;- usuallyas a link to the standard shell. When <EMCLASS="emphasis">rsh</EM> startsup, it executes the commands in the file <EMCLASS="emphasis">$HOME/.profile</EM>.Once the <EMCLASS="emphasis">.profile</EM> is processed, the followingrestrictions go into effect:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] Not to be confused with <EMCLASS="emphasis">rsh</EM>, the networkremote-shell command. This conflict is unfortunate.</P></BLOCKQUOTE><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">The user can't change thecurrent directory.</P></LI><LICLASS="listitem"><PCLASS="para">The user can't change the value of the<EMCLASS="emphasis">PATH</EM> environment variable.</P></LI><LICLASS="listitem"><PCLASS="para">The user can't use command names containingslashes.</P></LI><LICLASS="listitem"><PCLASS="para">The user can't redirect output with &gt;or &gt;&gt;.</P></LI></UL><PCLASS="para">As an added security measure, if the user tries to interrupt<EMCLASS="emphasis">rsh</EM> while it is processing the <EMCLASS="emphasis">$HOME/.profile</EM>file, <EMCLASS="emphasis">rsh</EM> immediately exits.</P><PCLASS="para">The net effect of these restrictions is to prevent the userfrom running any command that is not in a directory contained inthe <EMCLASS="emphasis">PATH</EM> environment variable, to prevent theuser from changing his or her <EMCLASS="emphasis">PATH</EM>, and toprevent the user from changing the <EMCLASS="emphasis">.profile</EM>of the restricted account that sets the <EMCLASS="emphasis">PATH</EM>variable in the first place.</P><PCLASS="para">You can further modify the <EMCLASS="emphasis">.profile</EM> fileto prevent the restricted account from being used over the network.You do this by having the shell script use the <EMCLASS="emphasis">tty</EM>command to make sure that the user is attached to a physical terminaland not a network port.</P><PCLASS="para">Be aware that <EMCLASS="emphasis">rsh</EM> is not a panacea. Ifthe user is able to run another shell, such as <EMCLASS="emphasis">sh</EM>or <EMCLASS="emphasis">csh</EM>, the user will have the same accessto your computer that he or she would have if the account was notrestricted at all. Likewise, if the user can run a program thatsupports shell escapes, such as <EMCLASS="emphasis">mail</EM>, the accountis unrestricted (see below).</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.4.2">8.1.4.2 Restricted shells under Berkeley versions</A></H4><PCLASS="para">Under <ACLASS="indexterm"NAME="AUTOID-10286"></A>Berkeley-derived<SPANCLASS="acronym">UNIX</SPAN>, you can create a restricted shell by creatinga hard link to the <EMCLASS="emphasis">sh</EM> program and giving itthe name <EMCLASS="emphasis">rsh</EM>. When <EMCLASS="emphasis">sh</EM>starts up, it looks at the program name under which it was invokedto determine what behavior it should have:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% ln /bin/sh /usr/etc/rsh</PRE></BLOCKQUOTE><PCLASS="para">This restricted shell functions in the same manner as theSystem V <EMCLASS="emphasis">rsh</EM> described above.</P><PCLASS="para">Note that a hard link will fail if the destination is on adifferent partition. If you need to put <ICLASS="filename">rsh </I>and<ICLASS="filename">sh</I> on different partition, try a symbolic link,which works on most systems. If it does not, or if your system doesnot support symbolic links, then consider copying the shell to thedestination partition, rather than linking it.</P><PCLASS="para">You should be careful not to place this restricted shell inany of the standard system program directories, so that people don'taccidentally execute it when they are trying to run the <EMCLASS="emphasis">rsh</EM>remote shell program.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.4.3">8.1.4.3 Restricted Korn shell</A></H4><PCLASS="para">The <ACLASS="indexterm"NAME="AUTOID-10304"></A>Kornshell (<EMCLASS="emphasis">ksh</EM>) can be configured to operate ina restricted mode as well, and be named <ICLASS="systemitem">rksh</I>or <EMCLASS="emphasis">krsh</EM><KBDCLASS="command"> </KBD>so as not to conflictwith the network remote shell <EMCLASS="emphasis">rsh</EM>. If <EMCLASS="emphasis">ksh</EM>is invoked with the <KBDCLASS="command">-r</KBD> command-line option, or is startedas <ICLASS="filename">rsh</I>, it also executes in restricted mode.When in restricted mode, the Korn shell behaves as the System Vrestricted shell, except that additionally the user cannot modifythe <EMCLASS="emphasis">ENV</EM> or <EMCLASS="emphasis">SHELL</EM> variables,nor can the user change the primary group using the <ICLASS="filename">newgrp</I>command.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.4.4">8.1.4.4 No restricted bash</A></H4><PCLASS="para">The <EMCLASS="emphasis">(<ACLASS="indexterm"NAME="AUTOID-10322"></A><ACLASS="indexterm"NAME="AUTOID-10324"></A>bsh)</EM>shell from the Free Software Foundation does not have a restrictedmode.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.4.5">8.1.4.5 How to set up a restricted account with rsh</A></H4><PCLASS="para">To set up a restricted account that uses <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10330"></A>rsh</EM>, you must:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Create a special directory containingonly the programs that the restricted shell can run.</P></LI><LICLASS="listitem"><PCLASS="para">Create a special user account that has the restrictedshell as its login shell.</P></LI></UL><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> The setup we show in the following example is not entirelysafe, as we explain later in this chapter.</P></BLOCKQUOTE><PCLASS="para">For example, to set up a restricted shell that lets guestsplay <EMCLASS="emphasis">rogue</EM> and <EMCLASS="emphasis">hack</EM>, anduse the <EMCLASS="emphasis">talk</EM> program, first create a user called<EMCLASS="emphasis">player</EM> that has <EMCLASS="emphasis">/bin/rsh</EM>as its shell and <EMCLASS="emphasis">/usr/rsh/home</EM> as its homedirectory:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">player::100:100:The Games Guest user:/usr/rshhome:/bin/rsh</PRE></BLOCKQUOTE><PCLASS="para">Next, create a directory for only the programs you want theguest to use, and fill the directory with the appropriate links:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># mkdir /usr/rshhome /usr/rshhome/bin# ln /usr/games/hack /usr/rshhome/bin/hack# ln /usr/games/rogue /usr/rshhome/bin/rogue# ln /usr/bin/talk /usr/rshhome/bin/talk# chmod 555 /usr/rshhome/bin# chmod 555 /usr/rshhome</PRE></BLOCKQUOTE><PCLASS="para">Finally, create a <EMCLASS="emphasis">.profile</EM> for the <EMCLASS="emphasis">player</EM>user that sets the <EMCLASS="emphasis">PATH</EM> environment variableand prints some instructions:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># cat &gt; /usr/rshhome/.profile/bin/echo This guest account is only for the use of authorized guests./bin/echo You can run the following programs:/bin/echo rogue A role playing game/bin/echo hack A better role playing game/bin/echo talk A program to talk with other people./bin/echo/bin/echo Type &quot;logout&quot; to log out.PATH=/usr/rshhome/binSHELL=/bin/rshexport PATH SHELL^D# chmod 444 /usr/rshhome/.profile# chown player /usr/rshhome/.profile# chmod 500 /usr/rshhome</PRE></BLOCKQUOTE></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.4.6">8.1.4.6 Potential problems with rsh</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10358"></A><ACLASS="indexterm"NAME="AUTOID-10360"></A>Beespecially careful when you use <EMCLASS="emphasis">rsh</EM>, becausemany <SPANCLASS="acronym">UNIX</SPAN> commands allow shell escapes, or meansof executing arbitrary commands or subshells from within themselves.Many programs that have shell escapes do not document this feature;several popular games fall into this category. If a program thatcan be run by a &quot;restricted&quot; account has the abilityto run subprograms, then the account may not be restricted at all.For example, if the restricted account can use <EMCLASS="emphasis">man</EM>to read reference pages, then a person using the restricted accountcan use <EMCLASS="emphasis">man</EM> to start up an editor, then spawna shell, and then run programs on the system.</P><PCLASS="para">For instance, in our above example, all of the commands linkedinto the restricted bin will spawn a subshell when presented withthe appropriate input. Thus, although the account appears to berestricted, it will actually only slow down users who don'tknow about shell escapes.<ACLASS="indexterm"NAME="AUTOID-10368"></A><ACLASS="indexterm"NAME="AUTOID-10370"></A><ACLASS="indexterm"NAME="AUTOID-10373"></A><ACLASS="indexterm"NAME="AUTOID-10376"></A><ACLASS="indexterm"NAME="AUTOID-10378"></A><ACLASS="indexterm"NAME="AUTOID-10380"></A><ACLASS="indexterm"NAME="AUTOID-10382"></A><ACLASS="indexterm"NAME="AUTOID-10384"></A></P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.5">8.1.5 Restricted Filesystem</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10390"></A><ACLASS="indexterm"NAME="AUTOID-10393"></A><ACLASS="indexterm"NAME="AUTOID-10396"></A><ACLASS="indexterm"NAME="AUTOID-10398"></A><ACLASS="indexterm"NAME="AUTOID-10401"></A>Anotherway to restrict some users on your system is to put them into arestricted filesystem. You can construct an environment where theyhave limited access to commands and files, but can still have accessto a regular shell (or a restricted shell if you prefer). The wayto do this is with the <EMCLASS="emphasis">chroot </EM>()system call. <EMCLASS="emphasis">chroot </EM>() changes aprocess's view of the filesystem such that the apparent<EMCLASS="emphasis">root</EM> directory is not the real filesystem <EMCLASS="emphasis">root</EM>directory, but one of its descendents.</P><PCLASS="para"><SPANCLASS="acronym">SVR4</SPAN><ACLASS="indexterm"NAME="AUTOID-10410"></A>has a feature to do this change automatically. If the shell field(field 7) for a user in the <EMCLASS="emphasis">/etc/passwd</EM> fileis a &quot;*&quot; symbol, then the login programwill make a <EMCLASS="emphasis">chroot </EM>() call on thehome directory field (field 6) listed in the entry. It will thenreexecute the login program&nbsp;- only this time, it will bethe <ICLASS="filename">login</I> program in the reduced filesystem,and will be using the new <ICLASS="filename">passwd </I>file foundthere (one that has a real shell listed, we would expect). If youdo not have this feature in your version of <SPANCLASS="acronym">UNIX</SPAN>,you can easily write a small program to do so (it will need to be<SPANCLASS="acronym">SUID</SPAN> <EMCLASS="emphasis">root</EM> for the <EMCLASS="emphasis">chroot</EM>() call to function), and place the program'spathname in the shell field instead of one of the shells.</P><PCLASS="para">The restricted filesystem so named must have all the necessaryfiles and commands for the login program to run and to execute programs(including shared libraries). Thus, the reduced filesystem needsto have an <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10423"></A><ACLASS="indexterm"NAME="AUTOID-10426"></A>/etc</EM> directory,a <ICLASS="systemitem">/lib</I> and <EMCLASS="emphasis">/usr/lib</EM><EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10432"></A></EM>directory,and a <EMCLASS="emphasis">/bin</EM> directory. However, these directoriesdo not need to contain all of the files and programs in the standarddirectories. Instead, you can copy or link only those files necessaryfor the user.[2]Remember to avoid symboliclinks reaching out of the restricted area, because the associateddirectories will not be visible. Using loopback mounts of the filesystemin read-only mode is one good way to populate these limited filesystemsas it also protects the files from modification. <ACLASS="xref"HREF="ch01_03.htm#PUIS-CHP-1-FIG-1"TITLE="Versions of UNIX">Figure 1.1</A> showshow the restricted filesystem is part of the regular filesystem.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] This may take some experimentation on your partto get the correct setup of files.</P></BLOCKQUOTE><H4CLASS="figure"><ACLASS="title"NAME="PUIS-CHP-8-FIG-1">Figure 8.1: Example of restricted filesystem</A></H4><IMGCLASS="graphic"SRC="figs/puis_0801.gif"ALT="Figure 8.1"><PCLASS="para">There are at least two good uses for such an environment.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.5.1">8.1.5.1 Limited users</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10447"></A><ACLASS="indexterm"NAME="AUTOID-10450"></A>Youmay have occasion to give access to some users for a set of limitedtasks. For instance, you may have an online company directory andan order-tracking front end to a customer database, and you mightlike to make these available to your customer service personnel.There is no need to make all of your files and commands accessibleto these users. Instead, you can set up a minimal account structureso that they can log in, use standard programs that you provide,and have the necessary access. At the same time, you have put anotherlayer of protection between your general system and the outside:if intruders manage to break the password of one of these usersand enter the accounts, they will not have access to the real <EMCLASS="emphasis">/etc/passwd</EM>(to download and crack), nor will they have access to network commandsto copy files in or out, nor will they be able to compile new programsto do the same.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.5.2">8.1.5.2 Checking new software</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10456"></A>Another use ofa restricted environment is to test new software of perhaps questionableorigin. In this case, you configure an environment for testing,and enter it with either the <EMCLASS="emphasis">chroot </EM>()system command or with a program that executes <EMCLASS="emphasis">chroot</EM>() on your behalf. Then, when you test thesoftware you have obtained, or unpack an archive, or perform anyother possibly risky operation, the only files you will affect arethe ones you put in the restricted environment&nbsp;- not everythingin the whole filesystem!</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> Be very, very careful about creating any <ACLASS="indexterm"NAME="AUTOID-10463"></A><SPANCLASS="acronym">SUID</SPAN> programsthat make a <EMCLASS="emphasis">chroot</EM>() call.If any user can write to the directory to which the program <EMCLASS="emphasis">chroot's</EM>,or if the user can specify the directory to which the <EMCLASS="emphasis">chroot</EM>() occurs, the user could become a superuseron your system. To do this, he need only change the password filein the restricted environment to give himself the ability to <EMCLASS="emphasis">su</EM>to <EMCLASS="emphasis">root</EM>, change to the restricted environment,create a <SPANCLASS="acronym">SUID</SPAN> root shell, and then log back inas the regular user to execute the <SPANCLASS="acronym">SUID</SPAN> shell.<ACLASS="indexterm"NAME="AUTOID-10474"></A><ACLASS="indexterm"NAME="AUTOID-10477"></A><ACLASS="indexterm"NAME="AUTOID-10480"></A><ACLASS="indexterm"NAME="AUTOID-10482"></A><ACLASS="indexterm"NAME="AUTOID-10485"></A></P></BLOCKQUOTE></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-8-SECT-1.6">8.1.6 Group Accounts</A></H3><PCLASS="para">A <ACLASS="indexterm"NAME="AUTOID-10491"></A><ACLASS="indexterm"NAME="AUTOID-10494"></A>groupaccount is an account that is used by more than one person. Groupaccounts are often created to allow a group of people to work onthe same project without requiring that an account be built foreach person. Other times, group accounts are created when severaldifferent people have to use the same computer for a short periodof time. In many introductory computer courses, for example, thereis a group account created for the course; different students storetheir files in different subdirectories or on floppy disks.</P><PCLASS="para">Group accounts are always a bad idea, because they eliminateaccountability. If you discover that an account shared by 50 peoplehas been used to break into computers across the United States,tracking down the individual responsible will be nearly impossible.Furthermore, a person is far more likely to disclose the passwordfor a group account than he is to release the password for an accountto which he alone has access. An account that is officially usedby 50 people may in fact be used by 150; you have no way of knowing.</P><PCLASS="para">Instead of creating group accounts, create an account foreach person in the group. If the individuals are all working onthe same project, create a new <SPANCLASS="acronym">UNIX</SPAN> group inthe file <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10501"></A><ACLASS="indexterm"NAME="AUTOID-10503"></A>/etc/group</EM>, andmake every user who is affiliated with the project part of the group.This method has the added advantage of allowing each user to havehis own start-up and dot files.</P><PCLASS="para">For example, to create a group called <EMCLASS="emphasis">spistol</EM>with the users <EMCLASS="emphasis">sid</EM>, <EMCLASS="emphasis">john</EM>,and <EMCLASS="emphasis">nancy</EM> in it, you might create the followingentry in <EMCLASS="emphasis">/etc/group</EM>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">spistol:*:201:sid,john,nancy</PRE></BLOCKQUOTE><PCLASS="para">Then be sure that Sid, John, and Nancy understand how to setpermissions and use necessary commands to work with the group account.In particular, they should set their <EMCLASS="emphasis">umask</EM>to 002 or 007 while working on the group project.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> Some versions of <SPANCLASS="acronym">UNIX</SPAN> limit the numberof characters that can be specified in a single line. If you discoverthat you cannot place more than a certain number of users in a particulargroup, the above restriction might be the cause of your problem.In such a case, you may wish to place each user in the group byspecifying the group in the user's <EMCLASS="emphasis">/etc/passwd</EM>entry. Or, you may wish to move to a network configuration-managementsystem, such as <SPANCLASS="acronym">NIS</SPAN>+ or <SPANCLASS="acronym">DCE</SPAN>,which is less likely to have such limitations.</P></BLOCKQUOTE></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_04.htm"TITLE="7.4 Software for Backups"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.4 Software for Backups"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_02.htm"TITLE="8.2 Monitoring File Format"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.2 Monitoring File Format"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">7.4 Software for Backups</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.2 Monitoring File Format</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>