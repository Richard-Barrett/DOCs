<HTML><HEAD><TITLE>[Chapter 8] 8.2 Monitoring File Format</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:05:41Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch08_01.htm"TITLE="8. Defending  Your Accounts"><LINKREL="prev"HREF="ch08_01.htm"TITLE="8.1 Dangerous Accounts"><LINKREL="next"HREF="ch08_03.htm"TITLE="8.3 Restricting Logins"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_01.htm"TITLE="8.1 Dangerous Accounts"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.1 Dangerous Accounts"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8<BR>Defending  Your Accounts</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_03.htm"TITLE="8.3 Restricting Logins"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.3 Restricting Logins"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-8-SECT-2">8.2 Monitoring File Format</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10524"></A><ACLASS="indexterm"NAME="AUTOID-10527"></A><ACLASS="indexterm"NAME="AUTOID-10530"></A>Most programs that access the <EMCLASS="emphasis">/etc/passwd</EM>and <EMCLASS="emphasis">/etc/group</EM> files are very sensitive toproblems in the formatting of those files, or to bad values. Becauseof the compact representation of the file, entries that are badlyformatted could be hidden.</P><PCLASS="para">Traditionally, a number of break-ins to <SPANCLASS="acronym">UNIX</SPAN>systems occurred when a program that was designed to write to the<EMCLASS="emphasis">/etc/passwd</EM> file was given bad input. For instance,early versions of the <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10539"></A><ACLASS="indexterm"NAME="AUTOID-10541"></A>chfn</EM> and <EMCLASS="emphasis">yppasswd</EM>commands could be given input with &quot;:&quot; charactersor too many characters. The result was a badly formatted recordto write to the <EMCLASS="emphasis">/etc/passwd</EM> file. Because ofthe way the records were written, the associated library routinesthat wrote to the file would truncate or pad the entries, and mightproduce an entry at the end that looked like:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">::0:0:::</PRE></BLOCKQUOTE><PCLASS="para">This type of entry would then allow a local user to becomea superuser by typing:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ su ''#</PRE></BLOCKQUOTE><PCLASS="para">(The above example changes the user to the null-named account.)Clearly, this result is undesirable.</P><PCLASS="para">You should check the format of both the <EMCLASS="emphasis">passwd</EM>and <EMCLASS="emphasis">group</EM> files on a regular basis. With manyversions of <SPANCLASS="acronym">UNIX</SPAN> with System V ancestry, thereare two commands on the system that will check the files for numberof fields, valid fields, and other consistency factors. These twoprograms are <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10554"></A><ACLASS="indexterm"NAME="AUTOID-10556"></A>pwck</EM>and <EMCLASS="emphasis">grpck</EM>; they are usually found in <EMCLASS="emphasis">/etc</EM>or <EMCLASS="emphasis">/usr/sbin</EM>.</P><PCLASS="para">Also on <SPANCLASS="acronym">SVR4</SPAN> systems is the <EMCLASS="emphasis">logins</EM>command. When issued with the <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10565"></A><ACLASS="indexterm"NAME="AUTOID-10568"></A>-p</EM> option,it will check for any accounts without a password. When issued withthe <EMCLASS="emphasis">-d</EM> option, it will check for duplicateIDs&nbsp;- including accounts that have an ID of 0 in additionto the <EMCLASS="emphasis">root</EM> account.</P><PCLASS="para">If you do not have access to these commands, you can writeyour own to do some of these same checks. For instance:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># awk -F: 'NF != 7 || $2 == 0 { print &quot;Problem with&quot; $0}' /etc/passwd</PRE></BLOCKQUOTE></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_01.htm"TITLE="8.1 Dangerous Accounts"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.1 Dangerous Accounts"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_03.htm"TITLE="8.3 Restricting Logins"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.3 Restricting Logins"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.1 Dangerous Accounts</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.3 Restricting Logins</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>