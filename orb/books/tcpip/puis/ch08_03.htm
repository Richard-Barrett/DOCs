<HTML><HEAD><TITLE>[Chapter 8] 8.3 Restricting Logins</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:05:41Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch08_01.htm"TITLE="8. Defending  Your Accounts"><LINKREL="prev"HREF="ch08_02.htm"TITLE="8.2 Monitoring File Format"><LINKREL="next"HREF="ch08_04.htm"TITLE="8.4 Managing Dormant Accounts"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_02.htm"TITLE="8.2 Monitoring File Format"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.2 Monitoring File Format"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8<BR>Defending  Your Accounts</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_04.htm"TITLE="8.4 Managing Dormant Accounts"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.4 Managing Dormant Accounts"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-8-SECT-3">8.3 Restricting Logins</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10578"></A><ACLASS="indexterm"NAME="AUTOID-10581"></A><ACLASS="indexterm"NAME="AUTOID-10584"></A>Some systems have (or will soon have) the abilityto restrict the circumstances under which each user may log in.In particular, you could specify times of day and days of the weekfor each account during which a user may not log in. You could alsorestrict the login account to a particular terminal line.</P><PCLASS="para">These restrictions are very useful additional features tohave, if they are available. They help prohibit access to accountsthat are only used in a limited environment, thus narrowing the&quot;window of opportunity&quot; an attacker might haveto exploit the system.</P><PCLASS="para">For example, if your system is used in a business setting,perhaps the VP of finance will never log in from any network terminal,and he is never at work outside the hours of 7 a.m. to 7 p.m. onweekdays. Thus, you could configure his account to prohibit anylogins outside those terminals and those hours. If an attacker knewthe account existed and was involved in password cracking or otherintelligence gathering over an off-site network connection, shewould not be able to get in even if she stumbled across the correctpassword.</P><PCLASS="para">If your system does not support this feature yet, you canask your vendor when it will be provided. If you want to put inyour own version, you can do so with a simple shell script:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">First, write a script something likethe following and put it in a secure location, such as <EMCLASS="emphasis">/etc/security/restrictions/fred</EM>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#!/bin/kshallowed_ttys=&quot;/dev/tty@(01|02|03)&quot;allowed_days=&quot;@(Mon|Tue|Wed|Thu|Fri)&quot;allowed_hours=&quot;(( hour &gt;= 7 &amp;&amp; hour &lt;= 19))&quot;real_shell=/bin/kshmy_tty=&quot;$(bin/tty)&quot;dow=&quot;$(/bin/date +%a)&quot;hour=$(/bin/date +%H)eval [[ $my_tty != $allowed_ttys ]] &amp;&amp; exit 1eval [[ $dow != $allowed_days ]] &amp;&amp; exit 1eval $allowed_hours || exit 1exec -a -${real_shell##*/} $real_shell &quot;${1+&quot;$@&quot;}</PRE></BLOCKQUOTE></LI><LICLASS="listitem"><PCLASS="para">Replace the user's login shell with thisscript in the <EMCLASS="emphasis">/etc/passwd</EM> file. Do so withthe <ACLASS="indexterm"NAME="AUTOID-10598"></A><KBDCLASS="command">usermod -s</KBD> command, the <KBDCLASS="command">vipw</KBD> command, orequivalent:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># usermod -s /etc/security/restrictions/fred fred</PRE></BLOCKQUOTE></LI><LICLASS="listitem"><PCLASS="para">Remove the user's ability to change hisor her own shell. If everyone on the system is going to have constraintson login place and time, then you can simply:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># chmod 0 /bin/chsh</PRE></BLOCKQUOTE><PCLASS="para">This method is preferable to deleting the command entirelybecause you might need it again later.[3]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] Be very carefulwhen running this command as it will only work if <KBDCLASS="command">/bin/chsh</KBD>is a single-purpose program that only changes the user'sshell. If <EMCLASS="emphasis">passwd</EM> is a link to <EMCLASS="emphasis">chsh</EM>(or other password utilities), the <KBDCLASS="command">chmod</KBD> canbreak a lot of things. Under SunOS, 4.1.x, <EMCLASS="emphasis">/bin/passwd</EM>is a hard link to <EMCLASS="emphasis">/bin/chfn</EM>, so if you do this<EMCLASS="emphasis">chmod</EM>, people won't be able to changepasswords either! (This may be the case for other operating systemsas well.) Note as well that removing <EMCLASS="emphasis">chsh</EM> won'twork either in this case because users can <EMCLASS="emphasis">ln -s /bin/passwdchfn</EM> and run it that way. Finally, some <KBDCLASS="command">passwd</KBD> programs have the <EMCLASS="emphasis">chfn</EM> functionalityas a command line option! On these systems, you can only preventa user from changing his shell by removing the unapproved shellsfrom the <ICLASS="filename">/etc/shells</I> file.</P></BLOCKQUOTE><PCLASS="para">If only a few people are going to have restricted access,create a new group named restricta (or similar), and add all theusers to that group. Then, do:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#  <ACLASS="indexterm"NAME="AUTOID-10624"></A> chmod 505 /bin/chsh # chgrp restricta /bin/chsh</PRE></BLOCKQUOTE><PCLASS="para">This will allow other users to change their shells, but notanyone in the restricta group.</P></LI></OL><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> If you take this approach, either with a vendor-suppliedmethod or something like the example above, keep in mind that thereare circumstances where some users may need access at differenttimes. In particular, users traveling to different time zones, orworking on big year-end projects, may need other forms of access.It is important that someone with the appropriate privileges ison call to alter these restrictions, if needed. Remember that thegoal of security is to protect users, and not get in the way oftheir work!<ACLASS="indexterm"NAME="AUTOID-10629"></A><ACLASS="indexterm"NAME="AUTOID-10632"></A><ACLASS="indexterm"NAME="AUTOID-10635"></A></P></BLOCKQUOTE></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_02.htm"TITLE="8.2 Monitoring File Format"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.2 Monitoring File Format"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_04.htm"TITLE="8.4 Managing Dormant Accounts"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.4 Managing Dormant Accounts"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.2 Monitoring File Format</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.4 Managing Dormant Accounts</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>