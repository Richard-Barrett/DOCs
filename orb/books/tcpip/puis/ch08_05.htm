<HTML><HEAD><TITLE>[Chapter 8] 8.5 Protecting the root Account</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:05:48Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch08_01.htm"TITLE="8. Defending  Your Accounts"><LINKREL="prev"HREF="ch08_04.htm"TITLE="8.4 Managing Dormant Accounts"><LINKREL="next"HREF="ch08_06.htm"TITLE="8.6 The UNIX Encrypted Password System"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_04.htm"TITLE="8.4 Managing Dormant Accounts"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.4 Managing Dormant Accounts"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8<BR>Defending  Your Accounts</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_06.htm"TITLE="8.6 The UNIX Encrypted Password System"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.6 The UNIX Encrypted Password System"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-8-SECT-5">8.5 Protecting the root Account</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10875"></A>Versionsof <SPANCLASS="acronym">UNIX</SPAN> that are derived from Berkeley <SPANCLASS="acronym">UNIX</SPAN>systems provide two additional methods of protecting the <ICLASS="systemitem.username">root</I> account:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Secure terminals</P></LI><LICLASS="listitem"><PCLASS="para">The <ICLASS="systemitem.username">wheel</I>group</P></LI></UL><PCLASS="para">A few systems provide an additional set of features, knownas a <ICLASS="firstterm">trusted path</I> and a <ICLASS="firstterm">trustedcomputing base</I> (<SPANCLASS="acronym">TCB</SPAN>).</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-8-SECT-5.1">8.5.1 Secure Terminals</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10894"></A>Because every <SPANCLASS="acronym">UNIX</SPAN>system has an account named <EMCLASS="emphasis">root</EM>, this accountis often a starting point for people who try to break into a systemby guessing passwords. One way to decrease the chance of this isto restrict logins from all but physically guarded terminals. Ifa terminal is marked as restricted, the superuser cannot log intothat terminal from the login: prompt. (However, a legitimate userwho knows the superuser password can still use the <EMCLASS="emphasis">su</EM>command on that terminal after first logging in.)</P><PCLASS="para">On a <SPANCLASS="acronym">SVR4</SPAN> machine, you can restrict theability of users to log in to the <EMCLASS="emphasis">root</EM> accountfrom any terminal other than the console. You accomplish this byediting the file <ICLASS="filename"><ACLASS="indexterm"NAME="AUTOID-10903"></A><ACLASS="indexterm"NAME="AUTOID-10905"></A><ACLASS="indexterm"NAME="AUTOID-10908"></A>/etc/default/login</I>and inserting the line:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><SPANCLASS="acronym">CONSOLE</SPAN>=/dev/console</PRE></BLOCKQUOTE><PCLASS="para">This line prevents anyone from logging in as <EMCLASS="emphasis">root</EM>on any terminal other than the console. If the console is not safe,you may set this to the pathname of a nonexistent terminal.</P><PCLASS="para">Some older Berkeley-derived versions of <SPANCLASS="acronym">UNIX</SPAN>allow you to declare terminal lines and network ports as either<EMCLASS="emphasis">secure</EM> or <EMCLASS="emphasis">not</EM> <EMCLASS="emphasis">secure</EM>.You declare a terminal secure by appending the word &quot;secure&quot;to the terminal's definition in the file <EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-10920"></A><ACLASS="indexterm"NAME="AUTOID-10922"></A>/etc/ttys</EM>:[5]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[5] Under SunOS and some other versions of <SPANCLASS="acronym">UNIX</SPAN>,this file is called <EMCLASS="emphasis">/etc/ttytab</EM>. Some olderversions of <SPANCLASS="acronym">BSD</SPAN> store the list of secure portsin the file <EMCLASS="emphasis">/etc/securettys</EM>.</P></BLOCKQUOTE><BLOCKQUOTECLASS="screen"><PRECLASS="screen">tty01 &quot;/usr/etc/getty std.9600&quot; vt100 on securetty02 &quot;/usr/etc/getty std.9600&quot; vt100 on</PRE></BLOCKQUOTE><PCLASS="para">In this example taken from a <EMCLASS="emphasis">/etc/ttys</EM>file, terminal <EMCLASS="emphasis">tty01</EM> is secure and terminal<EMCLASS="emphasis">tty02</EM> is not. This means that <EMCLASS="emphasis">root</EM>can log into terminal <EMCLASS="emphasis">tty01</EM> but not <EMCLASS="emphasis">tty02</EM>.</P><PCLASS="para">Note that after changing the <EMCLASS="emphasis">/etc/ttys</EM>file, you may need to send out a signal to initialize before thechanges will take effect. On a <SPANCLASS="acronym">BSD</SPAN>-derived system,run:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># kill -1 1</PRE></BLOCKQUOTE><PCLASS="para">Other systems vary, so check your own system's documentation.</P><PCLASS="para">You should carefully consider which terminals are declaredsecure. Many sites, for example, make neither their dial in modemsnor their network connections secure; this prevents intruders fromusing these connections to guess the system's superuserpassword. Terminals in public areas should also not be declaredsecure. Being &quot;not secure&quot; does not prevent aperson from executing commands as the superuser: it simply forcesusers to log in as themselves and then use the <EMCLASS="emphasis">su</EM>command to become <EMCLASS="emphasis">root</EM>. This method adds anextra layer of protection and accounting.</P><PCLASS="para">On the other hand, if your computer has a terminal in a specialmachine room, you may wish to make this terminal secure so you canquickly use it to log into the superuser account without havingfirst to log into your own account.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> Many versions of <SPANCLASS="acronym">UNIX</SPAN> require thatyou type the superuser password when booting in single-user modeif the console is not listed as &quot;secure&quot; in the<EMCLASS="emphasis">/etc/ttys</EM> file. Obviously, if you do not markyour console &quot;secure,&quot; you enhance your system'ssecurity.</P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-8-SECT-5.2">8.5.2 The wheel Group</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10955"></A><ACLASS="indexterm"NAME="AUTOID-10957"></A>Anothermechanism that further protects the <EMCLASS="emphasis">root</EM> accountis the <EMCLASS="emphasis">wheel</EM> group. A user who is not in the<EMCLASS="emphasis">wheel</EM> group cannot use the <EMCLASS="emphasis">su</EM>command to become the superuser. Be very careful about who you placein the <EMCLASS="emphasis">wheel</EM> group; on some versions of <SPANCLASS="acronym">UNIX</SPAN>,people in the <EMCLASS="emphasis">wheel</EM> group can provide theirown passwords to <EMCLASS="emphasis">su</EM>&nbsp;- instead of thesuperuser password&nbsp;- and become <EMCLASS="emphasis">root</EM>.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-8-SECT-5.3">8.5.3 TCB and Trusted Path</A></H3><PCLASS="para">When you are worried about security, you want to ensure thatthe commands you execute are the real system commands and not somethingdesigned to steal your password or corrupt your system. Some versionsof <SPANCLASS="acronym">UNIX</SPAN> have been augmented with special featuresto provide you with this additional assurance.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-8-SECT-5.3.1">8.5.3.1 Trusted path</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10977"></A><ACLASS="indexterm"NAME="AUTOID-10980"></A>Considerthe case where we approach a terminal and wish to log in to thesystem. What is a potential problem? What if someone has left aprogram&nbsp;- a Trojan Horse[6]program&nbsp;- running on the terminal? If the program has beendesigned to capture our password by presenting a prompt that lookslike the real login program, we might not be able to tell the differenceuntil the damage is done. If the program has been very carefullycrafted to catch signals and otherwise mimic the login program behavior,we might not catch on at all. And if you are not using one-timepasswords (described later in <ACLASS="xref"HREF="ch08_07.htm"TITLE="One-Time Passwords">Section 8.7, "One-Time Passwords</A>),you may be giving someone else access to your account.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[6] Trojan Horse programsare defined in more detail in <ACLASS="xref"HREF="ch11_01.htm"TITLE="Protecting Against Programmed Threats">Chapter 11, <CITECLASS="chapter">Protecting Against Programmed Threats</CITE></A>.</P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-10988"></A><ACLASS="indexterm"NAME="AUTOID-10991"></A>Thesolution to this is to provide a <ICLASS="firstterm">trusted path</I>to the login program from our terminal. Some <SPANCLASS="acronym">UNIX</SPAN>systems, including <SPANCLASS="acronym">AIX</SPAN> and Ultrix, can be configuredto recognize a special signal from hardwired terminals (includingworkstation consoles) for this purpose. When the signal (usuallya <SPANCLASS="acronym">BREAK</SPAN>, or some sequence of control characters)is received by the low-level terminal driver, the driver sends anunstoppable signal to all processes still connected to the terminal,that terminates them. Thereafter, a new session is started and theuser can be assured that the next prompt for a login is from thereal system software.</P><PCLASS="para">For a trusted path mechanism to work, you must have a hardwiredconnection to the computer: any networked connection can be interceptedand <ACLASS="indexterm"NAME="AUTOID-10999"></A><ACLASS="indexterm"NAME="AUTOID-11002"></A><ACLASS="indexterm"NAME="AUTOID-11005"></A>spoofed.[7] The system administrator must enablethe trusted path mechanism and indicate to which terminal linesit is to be applied. As this may require reconfiguring your kerneland rebooting (to include the necessary terminal code), you should<EMCLASS="emphasis">carefully</EM> read your vendor documentation forinstructions on how to enable this feature.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[7] Network login have other potential problems, such as passwordsniffing.</P></BLOCKQUOTE><PCLASS="para">If your system provides the trusted path mechanism and youdecide to use it, be sure to limit superuser logins to only theassociated terminals!</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-8-SECT-5.3.2">8.5.3.2 Trusted computing base</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-11015"></A><ACLASS="indexterm"NAME="AUTOID-11017"></A><ACLASS="indexterm"NAME="AUTOID-11019"></A><ACLASS="indexterm"NAME="AUTOID-11021"></A>After we've loggedin, we may be faced with situations where we are not quite certainif we are executing a trusted system command or a command put inplace by a prankster or intruder. If we are running as the superuser,this uncertainty is a recipe for disaster, and is why we repeatedlywarn you throughout the book to leave the current directory outof your search path, and to keep system commands protected.</P><PCLASS="para">Some systems can be configured to mark executable files aspart of the <ICLASS="firstterm">trusted computing base</I> (<SPANCLASS="acronym">TCB</SPAN>).Files in the <SPANCLASS="acronym">TCB</SPAN> are specially marked by thesuperuser as trusted. When running a special trusted shell, onlyfiles with the <SPANCLASS="acronym">TCB</SPAN> marking can be executed with<EMCLASS="emphasis">exec </EM>(). Thus, only trusted filescan be executed.</P><PCLASS="para">How do files get their trusted markings? New files and modified<SPANCLASS="acronym">TCB</SPAN> files have the marking turned off. The superusercan mark new executable files as part of the <SPANCLASS="acronym">TCB</SPAN>;on some systems, this process can only be done if the file was createdwith programs in the <SPANCLASS="acronym">TCB</SPAN>. In theory, an attackerwill not be able to be superuser, (or set the marking on files)and thus the superuser cannot accidentally execute dangerous code.</P><PCLASS="para">This feature is especially worthwhile if you are administeringa multiuser system, or if you tend to import files and filesystemsfrom other, potentially untrusted, systems. However, you must keepin mind that the marking does <EMCLASS="emphasis">not</EM> necessarilymean that the program is harmless. As the superuser can mark filesas part of the <SPANCLASS="acronym">TCB</SPAN>, some of those files mightbe dangerous. Thus, remember that the <SPANCLASS="acronym">TCB</SPAN>, likeany other feature, only reinforces overall security.<ACLASS="indexterm"NAME="AUTOID-11038"></A></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_04.htm"TITLE="8.4 Managing Dormant Accounts"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.4 Managing Dormant Accounts"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_06.htm"TITLE="8.6 The UNIX Encrypted Password System"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.6 The UNIX Encrypted Password System"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.4 Managing Dormant Accounts</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.6 The UNIX Encrypted Password System</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>