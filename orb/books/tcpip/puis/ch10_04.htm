<HTML><HEAD><TITLE>[Chapter 10] 10.4 Per-User Trails in the Filesystem</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:07:39Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch10_01.htm"TITLE="10. Auditing and Logging"><LINKREL="prev"HREF="ch10_03.htm"TITLE="10.3 Program-Specific Log Files"><LINKREL="next"HREF="ch10_05.htm"TITLE="10.5 The UNIX System Log (syslog) Facility"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_03.htm"TITLE="10.3 Program-Specific Log Files"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.3 Program-Specific Log Files"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 10<BR>Auditing and Logging</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_05.htm"TITLE="10.5 The UNIX System Log (syslog) Facility"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.5 The UNIX System Log (syslog) Facility"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-10-SECT-4">10.4 Per-User Trails in the Filesystem</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13551"></A><ACLASS="indexterm"NAME="AUTOID-13554"></A>Althoughnot obvious, there are some files that are kept on a per-user basisthat can be helpful in analyzing when something untoward has happenedon your system. While not real log files, as such, they can be treatedas a possible source of information on user behavior.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-10-SECT-4.1">10.4.1 Shell History</A></H3><PCLASS="para">Many of the standard user command shells, including <EMCLASS="emphasis">csh</EM>,<EMCLASS="emphasis">tcsh</EM>, and <EMCLASS="emphasis">ksh</EM>, can keepa <ICLASS="firstterm"><ACLASS="indexterm"NAME="AUTOID-13564"></A><ACLASS="indexterm"NAME="AUTOID-13566"></A><ACLASS="indexterm"NAME="AUTOID-13569"></A><ACLASS="indexterm"NAME="AUTOID-13572"></A><ACLASS="indexterm"NAME="AUTOID-13575"></A><ACLASS="indexterm"NAME="AUTOID-13578"></A><ACLASS="indexterm"NAME="AUTOID-13581"></A>historyfile</I>. When the user issues commands, the text of eachcommand and its arguments are stored into the history file for laterre-execution. If you are trying to recreate activity performed onan account, possibly by some intruder, the contents of this filecan be quite helpful when coupled with system log information. Youmust check the modification time on the file to be sure that itwas in use during the time the suspicious activity occurred. Ifit was created and modified during the intruder's activities,you should be able to determine the commands run, the programs compiled,and sometimes even the names of remote accounts or machines thatmight also be involved in the incident. Be sure of your target,however, because this is potentially a violation of privacy forthe real user of this account.</P><PCLASS="para">Obviously, an aware intruder will delete the file before loggingout. Thus, this mechanism may be of limited utility. However, thereare two ways to increase your opportunity to get a useful file.The first way is to force the logout of the suspected intruder,perhaps by using a signal or shutting down the system. If a historyfile is being kept, this will leave the file on disk where it canbe read. The second way to increase your chances of getting a usablefile is to make a hard link to the existing history file, and tolocate the link in a directory on the same disk that is normallyinaccessible to the user (e.g., in a root-owned directory). Evenif the intruder unlinks the file from the user's directory,it can still be accessed through the extra link.</P><PCLASS="para">Also note that this technique can come in handy if you suspectthat an account is being used inappropriately. You can alter thesystem profile to create and keep a history file, if none was keptbefore. On some systems, you can even designate a named pipe (<SPANCLASS="acronym">FIFO</SPAN>)as the history file, thus transmitting the material to a loggingprocess in a manner that cannot be truncated or deleted.</P><PCLASS="para">Even if you were unable to preserve a copy of the historyfile, but one was created and then unlinked by the intruder, youcan still gain some useful information if you act quickly enough.The first thing you must do is to either take the system to single-usermode, or <EMCLASS="emphasis">umount</EM> the disk with the suspect account(we recommend going to single-user mode). Then, you can use disk-examinationtools to look at the records on the free list. When a file is deleted,the contents are not immediately overwritten. Instead, the datarecords are added back into the freelist on disk. If they are notreused yet (which is why you <EMCLASS="emphasis">umount</EM> the diskor shut the system down), you can still read the contents.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-10-SECT-4.2">10.4.2 Mail</A></H3><PCLASS="para">Some <ACLASS="indexterm"NAME="AUTOID-13593"></A><ACLASS="indexterm"NAME="AUTOID-13596"></A><ACLASS="indexterm"NAME="AUTOID-13598"></A><ACLASS="indexterm"NAME="AUTOID-13601"></A>user accounts are configuredto make a copy of all outgoing mail in a file. If an intruder sendsmail from a user account where this feature is set (or where youset it), this feature can provide you with potentially useful information.In at least one case we know of, a person stealing confidentialinformation by using a coworker's pirated password wasexposed because of recorded email to his colleagues that he signedwith his own name!</P><PCLASS="para">Some systems also record a log file of mail sent and received.This file can be kept per-user, or it may be part of the system-wide<ICLASS="filename">syslog</I> audit trail. The contents of this logcan be used to track what mail has come in and left the system.If nothing else, we have found this information to be useful whena disk error (or human error) wipes out a whole set of mailboxes&nbsp;- thepeople listed in the mail log file can be contacted to resend theirmail.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-10-SECT-4.3">10.4.3 Network Setup</A></H3><PCLASS="para">Each <ACLASS="indexterm"NAME="AUTOID-13609"></A><ACLASS="indexterm"NAME="AUTOID-13612"></A><ACLASS="indexterm"NAME="AUTOID-13615"></A><ACLASS="indexterm"NAME="AUTOID-13617"></A>useraccount can have several network configuration files that can beedited to provide shortcuts for commands, or to assert access rights.Sometimes, the information in these files will provide a clue asto the activities of a malefactor. Examples include the <ICLASS="filename">.rhosts</I>file for remote logins, and the <ICLASS="filename">.netrc</I> filefor <SPANCLASS="acronym">FTP</SPAN>. Examine these files carefully for clues,but remember: the presence of information in one of these filesmay have been there prior to the incident, or it may have been plantedto throw you off.<ACLASS="indexterm"NAME="AUTOID-13622"></A><ACLASS="indexterm"NAME="AUTOID-13625"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_03.htm"TITLE="10.3 Program-Specific Log Files"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.3 Program-Specific Log Files"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_05.htm"TITLE="10.5 The UNIX System Log (syslog) Facility"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.5 The UNIX System Log (syslog) Facility"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">10.3 Program-Specific Log Files</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">10.5 The UNIX System Log (syslog) Facility</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>