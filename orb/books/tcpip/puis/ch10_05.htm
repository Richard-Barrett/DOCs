<HTML><HEAD><TITLE>[Chapter 10] 10.5 The UNIX System Log (syslog) Facility</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:07:40Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch10_01.htm"TITLE="10. Auditing and Logging"><LINKREL="prev"HREF="ch10_04.htm"TITLE="10.4 Per-User Trails in the Filesystem"><LINKREL="next"HREF="ch10_06.htm"TITLE="10.6 Swatch: A Log File Tool"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_04.htm"TITLE="10.4 Per-User Trails in the Filesystem"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.4 Per-User Trails in the Filesystem"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 10<BR>Auditing and Logging</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_06.htm"TITLE="10.6 Swatch: A Log File Tool"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.6 Swatch: A Log File Tool"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-10-SECT-5">10.5 The UNIX System Log (syslog) Facility</A></H2><PCLASS="para">In <ACLASS="indexterm"NAME="AUTOID-13631"></A><ACLASS="indexterm"NAME="AUTOID-13633"></A><ACLASS="indexterm"NAME="AUTOID-13636"></A>addition to the various loggingfacilities mentioned above, many versions of <SPANCLASS="acronym">UNIX</SPAN>provide a general-purpose logging facility called <EMCLASS="emphasis">syslog</EM>,originally developed at the University of California at Berkeleyfor the Berkeley <EMCLASS="emphasis">sendmail</EM> program. Since then,<EMCLASS="emphasis">syslog</EM> has been ported to several System V-basedsystems, and is now widely available. The uses of <EMCLASS="emphasis">syslog</EM>have similarly been expanded.</P><PCLASS="para"><EMCLASS="emphasis">syslog</EM> is a host-configurable, uniformsystem logging facility. The system uses a centralized system loggingprocess that runs the program <EMCLASS="emphasis">/etc/syslogd</EM>or <EMCLASS="emphasis">/etc/syslog</EM>. Individual programs that needto have information logged send the information to <EMCLASS="emphasis">syslog</EM>.The messages can then be logged to various files, devices, or computers,depending on the sender of the message and its severity.</P><PCLASS="para">Any program can generate a <EMCLASS="emphasis">syslog</EM> logmessage. Each message consists of four parts:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Program name</P></LI><LICLASS="listitem"><PCLASS="para">Facility</P></LI><LICLASS="listitem"><PCLASS="para">Priority</P></LI><LICLASS="listitem"><PCLASS="para">Log message itself</P></LI></UL><PCLASS="para">For example, the message:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">login: Root LOGIN REFUSED on ttya</PRE></BLOCKQUOTE><PCLASS="para">is a log message generated by the <EMCLASS="emphasis">login</EM>program. It means that somebody tried to log into an unsecure terminalas <EMCLASS="emphasis">root</EM>. The messages's facility (authorization)and error level (critical error) are not shown.</P><PCLASS="para">The <EMCLASS="emphasis">syslog</EM> facilities are summarizedin <ACLASS="xref"HREF="ch10_05.htm#PUIS-CHP-10-TAB-1"TITLE="syslog Facilities">Table 10.1</A>. Not all facilities are present on all versions of<SPANCLASS="acronym">UNIX</SPAN>.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-10-TAB-1">Table 10.1: syslog Facilities</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Name</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Facility</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">kern</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Kernel</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">user</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Regular user processes</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">mail</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Mail system</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">lpr</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Line printer system</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">auth</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Authorization system, or programs thatask for user names and passwords (<KBDCLASS="command">login, su, getty, ftpd,</KBD> etc.)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">daemon</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Other system daemons</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">news</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">News subsystem</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">uucp</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UUCP</SPAN> subsystem</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">local0... local7</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Reserved for site-specific use</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">mark</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">A timestamp facility that sends out amessage every 20 minutes</P></TD></TR></TBODY></TABLE><PCLASS="para">The <EMCLASS="emphasis">syslog</EM> priorities are summarizedin Table 10-2:</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-10-TAB-2">Table 10.2: syslog Priorities</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Priority</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Meaning</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">emerg</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Emergency condition, such as an imminentsystem crash, usually broadcast to all users</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">alert</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Condition that should be corrected immediately,such as a corrupted system database</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">crit</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Critical condition, such as a hardwareerror</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">err</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Ordinary error</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">warning</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Warning</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">notice</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Condition that is not an error, but possiblyshould be handled in a special way</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">info</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Informational message</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">debug</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Messages that are used when debuggingprograms</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">none</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Do not send messages from the indicatedfacility to the selected file. For example, specifying <EMCLASS="emphasis">*.debug;mail.none</EM>sends all messages except mail messages to the selected file.</P></TD></TR></TBODY></TABLE><PCLASS="para">When <EMCLASS="emphasis">syslogd</EM> starts up, it reads itsconfiguration file, usually <ICLASS="filename">/</I><EMCLASS="emphasis">etc/syslog.conf</EM>,to determine what kinds of events it should log and where they shouldbe logged. <EMCLASS="emphasis">syslogd</EM> then listens for log messagesfrom three sources, shown in <ACLASS="xref"HREF="ch10_05.htm#PUIS-CHP-10-TAB-3"TITLE="Log Message Sources">Table 10.3</A>.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-10-TAB-3">Table 10.3: Log Message Sources</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Source</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Meaning</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><EMCLASS="emphasis">/dev/klog</EM></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Special device, used to read messagesgenerated by the kernel</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><EMCLASS="emphasis">/dev/log</EM></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UNIX</SPAN> domain socket,used to read messages generated by processes running on the localmachine</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">UDP</SPAN> port 514</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Internet domain socket, used to readmessages generated over the local area network from other machines</P></TD></TR></TBODY></TABLE><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-10-SECT-5.1">10.5.1 The syslog.conf Configuration File</A></H3><PCLASS="para">The <ICLASS="systemitem">/etc/syslog.conf</I>file controls where messages are logged. A typical <EMCLASS="emphasis">syslog.conf</EM>file might look like this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">*.err;kern.debug;auth.notice /dev/consoledaemon,auth.notice           /var/adm/messageslpr.*                        /var/adm/lpd-errsauth.*                       root,nosmisauth.*                       @prep.ai.mit.edu*.emerg                      **.alert                      |dectalkermark.*                       /dev/console</PRE></BLOCKQUOTE><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> <ACLASS="indexterm"NAME="AUTOID-13849"></A>Theformat of the <ICLASS="filename">syslog.conf</I> configuration filemay vary from vendor to vendor. Be sure to check the documentationfor your own system.</P></BLOCKQUOTE><PCLASS="para">Each line of the file contains two parts:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">A selector that specifies which kindof messages to log (e.g., all error messages or all debugging messagesfrom the kernel).</P></LI><LICLASS="listitem"><PCLASS="para">An action field that says what should be done withthe message (e.g., put it in a file or send the message to a user'sterminal).</P></LI></UL><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> You must use the tab character between the selectorand the action field. If you use a space, it will look the same,but <ICLASS="filename">syslog </I>will not work.</P></BLOCKQUOTE><PCLASS="para">Message selectors have two parts: a facility and a priority.<EMCLASS="emphasis">kern.debug</EM>, for example, selects all debugmessages (the priority) generated by the kernel (the facility).It also selects all priorities that are greater than debug. An asteriskin place of either the facility or the priority indicates &quot;all.&quot;(That is, *<EMCLASS="emphasis">.debug</EM> means all debugmessages, while <EMCLASS="emphasis">kern.</EM>* means all messagesgenerated by the kernel.) You can also use commas to specify multiplefacilities. Two or more selectors can be grouped together by usinga semicolon. (Examples are shown above.)</P><PCLASS="para">The action field specifies one of five actions:[7]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[7] Someversions of <EMCLASS="emphasis">syslog</EM> support additional actions,such as logging to a proprietary error management system.</P></BLOCKQUOTE><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Log to a file or a device. In thiscase, the action field consists of a filename (or device name),which must start with a forward slash (e.g., <EMCLASS="emphasis">/var/adm/lpd-errsor /dev/console).</EM> [8]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[8] Beware: logging to<ICLASS="filename">/dev/console</I> creates the possibility of a denialof service attack. If you are logging to the console, an attackercan flood your console with log messages, rendering it unusable.</P></BLOCKQUOTE></LI><LICLASS="listitem"><PCLASS="para">Send a message to a <ACLASS="indexterm"NAME="AUTOID-13878"></A>user. In this case, the action field consists of ausername (e.g., <EMCLASS="emphasis">root</EM>). You can specify multipleusernames by separating them with commas (e.g., <EMCLASS="emphasis">root,nosmis</EM>).The message is written to each terminal where these users are shownto be logged in, according to the <ICLASS="filename">utmp</I> file.</P></LI><LICLASS="listitem"><PCLASS="para">Send a message to all users. In this case, the actionfield consists of an asterisk (e.g., *).</P></LI><LICLASS="listitem"><PCLASS="para">Pipe the message to a program. In this case, theprogram is specified after the <SPANCLASS="acronym">UNIX</SPAN> pipe symbol(|). [9]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[9] Some versions of <EMCLASS="emphasis">syslog</EM>do not support logging to programs.</P></BLOCKQUOTE></LI><LICLASS="listitem"><PCLASS="para">Send the message to the <EMCLASS="emphasis">syslog</EM>on another host. In this case, the action field consists of a hostname,preceded by an at sign (e.g.,<EMCLASS="emphasis"> </EM><ICLASS="filename">@prep.ai.mit.edu</I><EMCLASS="emphasis">.</EM>).</P></LI></UL><PCLASS="para">With the following explanation, understanding the typical<EMCLASS="emphasis">syslog.conf</EM> configuration file as shown earlierbecomes easy.</P><DLCLASS="variablelist"><DTCLASS="term"><KBDCLASS="command">*.err;kern.debug;auth.notice/dev/console</KBD> </DT><DDCLASS="listitem"><PCLASS="para">This line causes all error messages, all kerneldebug messages, and all notice messages generated by the authorizationsystem to be printed on the system console. If your system consoleis a printing terminal, this process will generate a permanent hardcopythat you can file and use for later reference. (Note that <EMCLASS="emphasis">kern.debug</EM>means all messages of priority <EMCLASS="emphasis">debug</EM> and above.)</P></DD><DTCLASS="term"><KBDCLASS="command">daemon,auth.notice           /var/adm/messages</KBD></DT><DDCLASS="listitem"><PCLASS="para">This line causes all notice messages from eitherthe system daemons or the authorization system to be appended tothe file <EMCLASS="emphasis">/var/adm/messages</EM>.</P><PCLASS="para">Note that this is the second line that mentions<EMCLASS="emphasis">auth.notice</EM> messages. As a result, <EMCLASS="emphasis">auth.notice</EM>messages will be sent to <EMCLASS="emphasis">both</EM> theconsole and the <EMCLASS="emphasis">messages</EM> file.</P></DD><DTCLASS="term"><KBDCLASS="command">lpr.*                        /var/adm/lpd-errs</KBD></DT><DDCLASS="listitem"><PCLASS="para">This line causes all messages from the line printersystem to be appended to the <EMCLASS="emphasis">/var/adm/lpd-errs</EM>file.</P></DD><DTCLASS="term"><KBDCLASS="command">auth.*                       root,nosmis</KBD></DT><DDCLASS="listitem"><PCLASS="para">This line causes all messages from the authorizationsystem to be sent to the users <EMCLASS="emphasis">root</EM> and <EMCLASS="emphasis">nosmis</EM>.Note, however, that if the users are not logged in, the messageswill be lost.</P></DD><DTCLASS="term"><KBDCLASS="command">auth.*                       @prep.ai.mit.edu</KBD></DT><DDCLASS="listitem"><PCLASS="para">This line causes all authorization messages to besent to the <EMCLASS="emphasis">syslog</EM> daemon on the computer <ICLASS="filename">prep.ai.mit.edu</I>.If you have a cluster of many different machines, you may wish tohave them all perform their loggings on a central (and presumablysecure) computer.</P></DD><DTCLASS="term"><KBDCLASS="command">*.emerg                      *</KBD></DT><DDCLASS="listitem"><PCLASS="para">This line causes all emergency messages to be displayedon every user's terminal.</P></DD><DTCLASS="term"><KBDCLASS="command">*.alert                      |dectalker</KBD></DT><DDCLASS="listitem"><PCLASS="para">This line causes all alert messages to be sent toa program called <EMCLASS="emphasis">dectalker</EM>, which might broadcastthe message over a public address system.</P></DD><DTCLASS="term"><KBDCLASS="command">mark.*                       /dev/console</KBD></DT><DDCLASS="listitem"><PCLASS="para">This line causes the time to be printed on the systemconsole every 20 minutes. This is useful if you have other informationbeing printed on the console and you want a running clock on theprintout.</P></DD></DL><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> By default, <ICLASS="filename">syslog </I>will acceptlog messages from arbitrary hosts sent to the local <ICLASS="filename">syslog</I> <SPANCLASS="acronym">UDP</SPAN> port. This can result in a <ACLASS="indexterm"NAME="AUTOID-13960"></A>denialof service attack when the port is flooded with messages fasterthan the <EMCLASS="emphasis">syslog</EM> daemon can process them. Individualscan also log fraudulent messages. You must properly screen yournetwork against outside log messages.<ACLASS="indexterm"NAME="AUTOID-13964"></A></P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-10-SECT-5.2">10.5.2 Where to Log</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13969"></A>Becausethe <EMCLASS="emphasis">syslog</EM> facility provides many differentlogging options, this gives individual sites flexibility in settingup their own logging. Different kinds of messages can be handledin different ways. For example, most users won't want tobe bothered with most log messages. On the other hand, <KBDCLASS="command">auth.crit</KBD> messages should be displayed on the system administrator'sscreen (in addition to being recorded in a file). This section describesa few different approaches.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-10-SECT-5.2.1">10.5.2.1 Logging to a printer</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13977"></A><ACLASS="indexterm"NAME="AUTOID-13980"></A><ACLASS="indexterm"NAME="AUTOID-13983"></A>If you have a printeryou wish to devote to system logging, you can connect it to a terminalport and specify that port name in the <ICLASS="filename">/</I><EMCLASS="emphasis">etc/syslog.conf</EM>file.</P><PCLASS="para">For example, you might connect a special-purpose printer tothe port <ICLASS="filename">/</I><EMCLASS="emphasis">dev/ttya</EM>. Youcan then log all messages from the authorization system (such asinvalid passwords) by inserting the following line in your <EMCLASS="emphasis">syslog.conf</EM>file:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">auth.*                 /dev/ttya</PRE></BLOCKQUOTE><PCLASS="para">A printer connected in such a way should only be used forlogging. We suggest using dot-matrix printers, rather than laserprinters, because dot-matrix printers allow you to view the logline by line as it is written, rather than waiting until an entirepage is completed.</P><PCLASS="para">Logging to a hardcopy device is a very good idea if you thinkthat your system is being visited by unwelcome intruders on a regularbasis. The intruders can erase log files, but after something issent to a printer, they cannot touch the printer output withoutphysically breaking into your establishment.[10]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[10] Althoughif they have superuser access they can temporarily stop loggingor change what is logged.</P></BLOCKQUOTE><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> Be sure that you do not log solely to a hardcopy device.Otherwise, you will lose valuable information if the printer jamsor runs out of paper, the ribbon breaks, or somebody steals thepaper printout.</P></BLOCKQUOTE></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-10-SECT-5.2.2">10.5.2.2 Logging across the network</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14001"></A><ACLASS="indexterm"NAME="AUTOID-14004"></A><ACLASS="indexterm"NAME="AUTOID-14007"></A>If you have several machinesconnected together by a <SPANCLASS="acronym">TCP/IP</SPAN> network, you maywish to have events from all of the machines logged on one (or more)log machines. If this machine is secure, the result will be a logfile that can't be altered, even if the security on theother machines is compromised.* To have all of the messagesfrom one computer sent to another computer, you simply insert thisline in the first computer's <EMCLASS="emphasis">syslog.conf</EM>file:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">*.*               @loghost</PRE></BLOCKQUOTE><PCLASS="para">This feature can cause a lot of network traffic. Instead,you limit your log to only &quot;important&quot; messages.For example, this log file would simply send the hardware and security-relatedmessages to the remote logging host, but keep some copies on thelocal host for debugging purposes:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">*.err;kern.debug;auth.notice /dev/consoledaemon,auth.notice           /var/adm/messageslpr.*                        @loghost1,@loghost2auth.*                       @loghost1,@loghost2*.emerg                      @loghost1,@loghost2*.alert                      @loghost1,@loghost2mark.*                       /dev/console&#13;</PRE></BLOCKQUOTE><PCLASS="para">Logging to another host adds to your overall system security:even if people break into one computer and erase its log files,they will still have to deal with the log messages sent across thenetwork to the other system. If you do log to a remote host, youmight wish to restrict user accounts on that machine. However, becareful: if you only log over the network to a single host, thenthat one host is a single point of failure. The above example logsto both <EMCLASS="emphasis">loghost1</EM> and <EMCLASS="emphasis">loghost2</EM>.</P><PCLASS="para">Another alternative is to use a non<SPANCLASS="acronym">-UNIX</SPAN>machine as the log host. The <EMCLASS="emphasis">syslog</EM> code canbe compiled on other machines with standard C and <SPANCLASS="acronym">TCP/IP</SPAN>libraries. Thus, you can log to a <SPANCLASS="acronym">DOS</SPAN> or Macintoshmachine, and further protect your logs. After all, if <EMCLASS="emphasis">syslog</EM>is the only network service running on those systems, there is noway for someone to break in from the net to alter the logs!</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-10-SECT-5.2.3">10.5.2.3 Logging everything everywhere</A></H4><PCLASS="para">Disks are cheap these days. Sites with sufficient resourcesand adequately trained personnel sometimes choose to log everythingthat might possibly be useful, and log it in many different places.For example, clients can create their own log files of <EMCLASS="emphasis">syslog</EM>events, and also send all logging messages to several differentlogging hosts&nbsp;- possibly on different networks.</P><PCLASS="para">The advantage of logging in multiple places is that it makesan attacker's attempts at erasing any evidence of his presencemuch more difficult. On the other hand, multiple log files willnot do you any good if they are never examined. Furthermore, ifthey are never pruned, they may grow so large that they will shutdown your computers.<ACLASS="indexterm"NAME="AUTOID-14029"></A></P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-10-SECT-5.3">10.5.3 syslog Messages</A></H3><PCLASS="para">The <ACLASS="indexterm"NAME="AUTOID-14035"></A><ACLASS="indexterm"NAME="AUTOID-14038"></A>following tables[11]summarize some typical messages available on various versions of<SPANCLASS="acronym">UNIX</SPAN>.:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[11] A similar listis not available for System V UNIX, because <EMCLASS="emphasis">syslog</EM>is part of the Berkeley UNIX offering. Companies that sell <EMCLASS="emphasis">syslog</EM>with their System V offerings may or may not have modified the additionalprograms in their operating systems to allow them to use the <ICLASS="systemitem">syslog</I> logging facility.</P></BLOCKQUOTE><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-10-TAB-4">Table 10.4: Typical Critical Messages</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Program</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Message</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Meaning</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">halt</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">halted by &lt;user&gt;</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;user&gt; used the <EMCLASS="emphasis">/etc/halt</EM>command to shut down the system.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">login</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">ROOT</SPAN> <SPANCLASS="acronym">LOGIN</SPAN><SPANCLASS="acronym">REFUSED</SPAN> <SPANCLASS="acronym">ON</SPAN> &lt;tty&gt;[<SPANCLASS="acronym">FROM</SPAN> &lt;hostname&gt;]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><EMCLASS="emphasis">root</EM> tried to logonto a terminal that is not secure.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">login</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">REPEATED</SPAN> <SPANCLASS="acronym">LOGIN</SPAN><SPANCLASS="acronym">FAILURES</SPAN> <SPANCLASS="acronym">ON</SPAN> &lt;tty&gt;[<SPANCLASS="acronym">FROM</SPAN> &lt;hostname&gt;]&lt;user&gt;</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Somebody tried to log in as &lt;user&gt;and supplied a bad password more than five times.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">reboot</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">rebooted by &lt;user&gt;</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;user&gt; rebooted thesystem with the <EMCLASS="emphasis">/etc/reboot</EM> command.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">su</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">BAD</SPAN> <SPANCLASS="acronym">SU</SPAN>&lt;user&gt; on &lt;tty&gt;</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Somebody tried to <EMCLASS="emphasis">su</EM>to the superuser and did not supply the correct password.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">shutdown</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">reboot, halt, or shutdown by &lt;user&gt;on &lt;tty&gt;</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;user&gt; used the <EMCLASS="emphasis">/etc/shutdown</EM>command to reboot, halt, or shut down the system.</P></TD></TR></TBODY></TABLE><PCLASS="para">Other critical conditions that might be present might includemessages about full filesystems, device failures, or network problems.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-10-TAB-5">Table 10.5: Typical Info Messages</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Program</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Message</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Meaning</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">date</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">date set by &lt;user&gt;</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;user&gt; changed thesystem date.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">login</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><SPANCLASS="acronym">ROOT</SPAN> <SPANCLASS="acronym">LOGIN</SPAN>&lt;tty&gt; [<SPANCLASS="acronym">FROM</SPAN> &lt;hostname&gt;]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"></P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">root logged in.</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"></P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">su</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;user&gt; on &lt;tty&gt;</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;user&gt; used the <EMCLASS="emphasis">su</EM>command to become the superuser.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">getty</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">&lt;tty&gt;</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">/bin/getty was unableto  open &lt;tty&gt;.</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> <ACLASS="indexterm"NAME="AUTOID-14178"></A>For securityreasons, some information should never be logged. For example, althoughyou should log failed <ACLASS="indexterm"NAME="AUTOID-14181"></A><ACLASS="indexterm"NAME="AUTOID-14184"></A><ACLASS="indexterm"NAME="AUTOID-14188"></A>passwordattempts, you should not log the password that was used in the failedattempt. Users frequently mistype their own passwords, and loggingthese mistyped passwords would help a computer cracker break intoa user's account. Some system administrators believe thatthe account name should also not be logged on failed login attempts&nbsp;- especiallywhen the account typed by the user is nonexistent. The reason isthat users occasionally type their passwords when they are promptedfor their usernames. If invalid accounts are logged, then it mightbe possible for an attacker to use those logs to infer people'spasswords.</P></BLOCKQUOTE><PCLASS="para">You may want to insert <EMCLASS="emphasis">syslog</EM> calls intoyour own programs to record information of importance. Third-partysoftware also often has a capability to send log messages into the<ICLASS="filename">syslog</I> if configured correctly. For example,Xyplex terminal servers and Cisco routers both can log informationto a network <EMCLASS="emphasis">syslog</EM> daemon; Usenet news and<SPANCLASS="acronym">POP</SPAN> mail servers also log information.</P><PCLASS="para">If you are writing shell scripts, you can also log to <EMCLASS="emphasis">syslog</EM>.Usually, systems with <EMCLASS="emphasis">syslog</EM> come with the<EMCLASS="emphasis"><ACLASS="indexterm"NAME="AUTOID-14200"></A>logger</EM>command. To log a warning message about a user trying to executea shell file with invalid parameters, you might include:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">logger -t ThisProg -p user.notice &quot;Called without required # of parameters&quot;</PRE></BLOCKQUOTE><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> Prior to 1995, many versions of the <EMCLASS="emphasis">syslog</EM>library call did not properly check their inputs to be certain thatthe data would fit into the function's internal buffers.Thus, many programs could be coerced to accept input to write arbitrarydata over their stacks, leading to potential compromise. Be certainthat you are running software using a version of <EMCLASS="emphasis">syslog</EM>that does not have this vulnerability.</P></BLOCKQUOTE><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-10-SECT-5.3.1">10.5.3.1 Beware false log entries</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14210"></A><ACLASS="indexterm"NAME="AUTOID-14213"></A>The <SPANCLASS="acronym">UNIX</SPAN> <EMCLASS="emphasis">syslog</EM>facility allows any user to create log entries. This capabilityopens up the possibility for false data to be entered into yourlogs. An interesting story of such logging was given to us by Alec<ACLASS="indexterm"NAME="AUTOID-14218"></A>Muffet:</P><BLOCKQUOTECLASS="blockquote"><PCLASS="para">A friend of mine&nbsp;- a UNIX sysadmin&nbsp;- enrolledas a mature student at a local polytechnic in order to secure thedegree which had been eluding him for the past four years.</P><PCLASS="para">One of the other students on his Computer Science course wasan obnoxious geek user who was shoulder surfing people and generallymaking a nuisance of himself, and so my friend determined to takerevenge.</P><PCLASS="para">The site was running an early version of Ultrix on an 11/750,but the local operations staff were somewhat paranoid about security,had removed world execute from &quot;<EMCLASS="emphasis">su</EM>&quot;and left it group-execute to those in the <ICLASS="filename">wheel</I>group, or similar; in short, only the sysadmin staff should haveexecute access for <EMCLASS="emphasis">su</EM>.</P><PCLASS="para">Hence, the operations staff were somewhat worried to see messageswith the following scrolling up the console:</P></BLOCKQUOTE><BLOCKQUOTECLASS="screen"><PRECLASS="screen">		BAD SU: geekuser ON ttyp4 AT 11:05:20		BAD SU: geekuser ON ttyp4 AT 11:05:24		BAD SU: geekuser ON ttyp4 AT 11:05:29		BAD SU: geekuser ON ttyp4 AT 11:05:36		...</PRE></BLOCKQUOTE><BLOCKQUOTECLASS="blockquote"><PCLASS="para">When the console eventually displayed:</P></BLOCKQUOTE><BLOCKQUOTECLASS="screen"><PRECLASS="screen">		SU: geekuser ON ttyp4 AT 11:06:10</PRE></BLOCKQUOTE><BLOCKQUOTECLASS="blockquote"><PCLASS="para">all hell broke loose: the operations staff panickedat the thought of an undergrad running around the system as <EMCLASS="emphasis">root</EM>and pulled the plug (!) on the machine. The system administratorcame into the terminal room, grabbed the geekuser, took him awayand shouted at him for half an hour, asking (a) why was he hacking,(b) how was he managing to execute <EMCLASS="emphasis">su</EM> and (c)how he had guessed the <EMCLASS="emphasis">root</EM> password?</P><PCLASS="para">Nobody had noticed my friend in the corner of the room, quietlyrunning a script which periodically issued the following command,redirected into <EMCLASS="emphasis">/dev/console</EM>, which was world-writable:</P></BLOCKQUOTE><BLOCKQUOTECLASS="screen"><PRECLASS="screen">		echo BAD SU: geekuser ON ttyp4 AT `date` </PRE></BLOCKQUOTE><BLOCKQUOTECLASS="blockquote"><PCLASS="para">The moral of course is that you shouldn'tpanic, and that you should treat your audit trail with <ACLASS="indexterm"NAME="AUTOID-14242"></A><ACLASS="indexterm"NAME="AUTOID-14245"></A>suspicion.<ACLASS="indexterm"NAME="AUTOID-14248"></A><ACLASS="indexterm"NAME="AUTOID-14250"></A></P></BLOCKQUOTE></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_04.htm"TITLE="10.4 Per-User Trails in the Filesystem"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.4 Per-User Trails in the Filesystem"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_06.htm"TITLE="10.6 Swatch: A Log File Tool"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.6 Swatch: A Log File Tool"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">10.4 Per-User Trails in the Filesystem</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">10.6 Swatch: A Log File Tool</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>