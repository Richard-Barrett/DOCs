<HTML><HEAD><TITLE>[Chapter 10] 10.6 Swatch: A Log File Tool</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:07:44Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch10_01.htm"TITLE="10. Auditing and Logging"><LINKREL="prev"HREF="ch10_05.htm"TITLE="10.5 The UNIX System Log (syslog) Facility"><LINKREL="next"HREF="ch10_07.htm"TITLE="10.7 Handwritten Logs"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_05.htm"TITLE="10.5 The UNIX System Log (syslog) Facility"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.5 The UNIX System Log (syslog) Facility"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 10<BR>Auditing and Logging</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_07.htm"TITLE="10.7 Handwritten Logs"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.7 Handwritten Logs"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-10-SECT-6">10.6 Swatch: A Log File Tool</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14256"></A><ACLASS="indexterm"NAME="AUTOID-14258"></A><ACLASS="indexterm"NAME="AUTOID-14261"></A>Swatch is a simpleprogram written in the Perl programming language that is designedto monitor log files. It allows you to automatically scan log filesfor particular entries and then take appropriate action, such assending you mail, printing a message on your screen, or runninga program. There are a few other similar tools available, and wehope that more might be written in the near future, but we'llexplain Swatch here as an example of how to automate monitoringof your log files. Swatch allows a great deal of flexibility, althoughit offers no debugging facility for complicated configuration andit has a temperamental configuration file syntax.</P><PCLASS="para">Swatch was developed by E. Todd Atkins at Stanford'sEE Computer Facility to automatically scan log files. Swatch isnot currently included as standard software with any <SPANCLASS="acronym">UNIX</SPAN>distribution, but it is available via anonymous <SPANCLASS="acronym">FTP</SPAN>from <ACLASS="systemitem.url"HREF="ftp://sierra.stanford.edu/swatch">ftp://sierra.stanford.edu/swatch</A>or <ACLASS="systemitem.url"HREF="ftp://coast.cs.purdue.edu/pub/tools/swatch">ftp://coast.cs.purdue.edu/pub/tools/swatch</A>.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-10-SECT-6.1">10.6.1 Running Swatch</A></H3><PCLASS="para">Swatch has two modes of operation. It can be run in batch,scanning a log file according to a preset configuration. Alternatively,Swatch can monitor your log files in real time, looking at linesas they are added.</P><PCLASS="para">Swatch is run from the command line:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% swatch options input-source</PRE></BLOCKQUOTE><PCLASS="para">The following are the ones that you will most likely use whenrunning Swatch:</P><DLCLASS="variablelist"><DTCLASS="term">-c config_file</DT><DDCLASS="listitem"><PCLASS="para">Specifies a configuration file to use. By default,<EMCLASS="emphasis">Swatch</EM> uses the file <EMCLASS="emphasis">~/.swatchrc</EM>,which probably isn't what you want to use. (You will probablywant to use different configuration files for different log files.)</P></DD><DTCLASS="term">-r restart_time</DT><DDCLASS="listitem"><PCLASS="para">Allows you to tell <EMCLASS="emphasis">Swatch</EM>to restart itself after a certain amount of time. Time may be inthe form <EMCLASS="emphasis">hh:mm[am|pm]</EM> to specify an absolutetime, or in the form <EMCLASS="emphasis">+hh:mm</EM>, meaning a timehh hours and mm minutes in the future.</P></DD></DL><PCLASS="para">The Swatch options given below allow you to change the separatorthat the program uses when interpreting its files. They are probablyof limited use in most applications:</P><DLCLASS="variablelist"><DTCLASS="term">-P pattern_separator</DT><DDCLASS="listitem"><PCLASS="para">Specifies the separator that Swatch uses when parsingthe patterns in configuration file. By default, Swatch uses thecomma (,) as the separator.</P></DD><DTCLASS="term">-A action_separator</DT><DDCLASS="listitem"><PCLASS="para">Specifies the separator that Swatch will use whenparsing the actions in the configuration file. By default, Swatchuses the comma (,) as the separator.</P></DD><DTCLASS="term">-I input_separator</DT><DDCLASS="listitem"><PCLASS="para">Specifies the separator that Swatch will use toseparate each input record of the input file. By default, Swatchuses the newline.</P></DD></DL><PCLASS="para">The input source is specified by one of the following arguments:</P><DLCLASS="variablelist"><DTCLASS="term">-f filename</DT><DDCLASS="listitem"><PCLASS="para">Specifies a file for Swatch to examine. Swatch willdo a single pass through the file.</P></DD><DTCLASS="term">-p program</DT><DDCLASS="listitem"><PCLASS="para">Specifies a program for Swatch to run and examinethe results.</P></DD><DTCLASS="term">-t filename</DT><DDCLASS="listitem"><PCLASS="para">Specifies a file for Swatch to examine on a continualbasis. Swatch will examine each line of text as it is added.</P></DD></DL></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-10-SECT-6.2">10.6.2 The Swatch Configuration File</A></H3><PCLASS="para">Swatch's operation is controlled by a configurationfile. Each line of the file consists of four tab-delimited fields,and has the form:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">/pattern/[,/pattern/,...] action[,action,...] [[[HH:]MM:]SS] [start:length]</PRE></BLOCKQUOTE><PCLASS="para">The first field specifies a pattern which is scanned for oneach line of the log file. The pattern is in the form of a Perlregular expression, which is similar to regular expressions usedby <EMCLASS="emphasis">egrep</EM>. If more than one pattern is specified,then a match on either pattern will signify a match.</P><PCLASS="para">The second field specifies an action to be taken each timethe pattern in the first field is matched. Swatch supports the followingactions:</P><DLCLASS="variablelist"><DTCLASS="term">echo[=mode]</DT><DDCLASS="listitem"><PCLASS="para">Prints the matched line. You can specify an optionalmode, which may be either normal, bold, underscore, blink, or inverse.</P></DD><DTCLASS="term">bell[=N]</DT><DDCLASS="listitem"><PCLASS="para">Prints the matched line and rings the <ACLASS="indexterm"NAME="AUTOID-14333"></A>bell. You can specify a number <ICLASS="filename">N</I>to cause the bell to ring <EMCLASS="emphasis">N </EM>times.</P></DD><DTCLASS="term">exec=command</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14341"></A>Executesthe specified command. If you specify $0 or $*in the configuration file, the symbol will be replaced by the entireline from the log file. If you specify $1, $2or $<ICLASS="filename">N</I>, the symbol will be replacedby the <EMCLASS="emphasis">Nth</EM> field from the log file line.</P></DD><DTCLASS="term">system=command</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14349"></A>Similarto the <EMCLASS="emphasis">exec=</EM> action, except that Swatch willnot process additional lines from the log file until the <EMCLASS="emphasis">command</EM>has finished executing.</P></DD><DTCLASS="term">ignore</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14357"></A>Ignoresthe matched line.</P></DD><DTCLASS="term">mail[=address:address:...]</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14363"></A>Sendselectronic mail to the specified address containing the matchedline. If no address is specified, the mail will be sent to the userwho is running the program.</P></DD><DTCLASS="term">pipe=command	</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14370"></A>Pipesthe matched lines into the specified <EMCLASS="emphasis">command</EM>.</P></DD><DTCLASS="term">write[=user:user:...]</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-14377"></A>Writes the matched lines on theuser's terminal with the <EMCLASS="emphasis">write</EM> command.</P></DD></DL><PCLASS="para">The third and fourth fields are optional. They give you atechnique for controlling identical lines which are sent to thelog file. If you specify a time, then Swatch will not alert youfor identical lines which are sent to the log file within the specifiedperiod of time. Instead, Swatch will merely notify you when thefirst line is triggered, and then after the specified period oftime has passed. The fourth field specifies the location withinthe log file where the timestamp takes place.</P><PCLASS="para">For example, on one system, you may have a process which generatesthe following message repeatedly in the log file:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Apr  3 01:01:00 next routed[9055]: bind: Bad file numberApr  3 02:01:00 next routed[9135]: bind: Bad file numberApr  3 03:01:00 next routed[9198]: bind: Bad file numberApr  3 04:01:00 next routed[9273]: bind: Bad file number</PRE></BLOCKQUOTE><PCLASS="para">You can catch the log file message with the following Swatchconfiguration line:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">/routed.*bind/  echo        24:00:00        0:16</PRE></BLOCKQUOTE><PCLASS="para">This line should cause Swatch to report the <ICLASS="filename">routed</I>message only once a day, with the following message:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">*** The following was seen 20 times in the last 24 hours(s):==&gt; next routed[9273]: bind: Bad file number</PRE></BLOCKQUOTE><PCLASS="para">Be sure that you use the tab character to separate the fieldsin your configuration file. If you use spaces, you may get an errormessage like this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">parse error in file /tmp/..swatch..2097 at line 24, next 2 tokens &quot;/routed.*bind/ echo&quot;parse error in file /tmp/..swatch..2097 at line 27, next token &quot;}&quot;Execution of /tmp/..swatch..2097 aborted due to compilation errors.<EMCLASS="emphasis"> <ACLASS="indexterm"NAME="AUTOID-14392"></A><ACLASS="indexterm"NAME="AUTOID-14394"></A><ACLASS="indexterm"NAME="AUTOID-14397"></A> </EM>&#13;</PRE></BLOCKQUOTE></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_05.htm"TITLE="10.5 The UNIX System Log (syslog) Facility"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.5 The UNIX System Log (syslog) Facility"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_07.htm"TITLE="10.7 Handwritten Logs"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.7 Handwritten Logs"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">10.5 The UNIX System Log (syslog) Facility</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">10.7 Handwritten Logs</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>