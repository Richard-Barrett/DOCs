<HTML><HEAD><TITLE>[Chapter 11] 11.6 Protecting Your System</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:08:40Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch11_01.htm"TITLE="11. Protecting Against Programmed Threats"><LINKREL="prev"HREF="ch11_05.htm"TITLE="11.5 Protecting Yourself"><LINKREL="next"HREF="ch12_01.htm"TITLE="12. Physical Security"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_05.htm"TITLE="11.5 Protecting Yourself"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 11.5 Protecting Yourself"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 11<BR>Protecting Against Programmed Threats</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch12_01.htm"TITLE="12. Physical Security"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 12. Physical Security"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-11-SECT-6">11.6 Protecting Your System</A></H2><PCLASS="para">No matter whatthe threat is called, how it enters your system, or what the motivesof the person(s) who wrote it may be, the potential for damage isyour main concern. Any of these problems can result in downtimeand lost or damaged resources. Understanding the nature of a threatis insufficient to prevent it from occurring.</P><PCLASS="para">At thesame time, remember that you do not need many special precautionsor special software to protect against programmed threats. The samesimple, effective measures you would take to protect your systemagainst unauthorized entry or malicious damage from insiders willalso protect your system against these other threats.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-11-SECT-6.1">11.6.1 File Protections</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15723"></A>Files,directories, and devices that are writable (world-writable) by anyuser on the system can be dangerous security holes. An attackerwho gains access to your system can gain even more access by modifyingthese files, directories, and devices. Maintaining a vigilant watchover your file protections protects against intrusion and also protectsyour system's legitimate users from each other'smistakes and antics. (<ACLASS="xref"HREF="ch05_01.htm"TITLE="The UNIX Filesystem">Chapter 5</A>introduces file permissions and describes how you can change them.)</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-11-SECT-6.1.1">11.6.1.1 World-writable user files and directories</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15729"></A><ACLASS="indexterm"NAME="AUTOID-15732"></A><ACLASS="indexterm"NAME="AUTOID-15735"></A>Many inexperienced users (and evencareless experienced users) often make themselves vulnerable toattack by improperly setting the permissions on files in their homedirectories.</P><PCLASS="para">The <ICLASS="filename">.login</I> file is a particularly vulnerablefile. For example, if a user has a <ICLASS="filename">.login </I>file that is world-writable,an attacker can modify the file to do his bidding. Suppose a maliciousattacker inserts this line at the end of a user's <ICLASS="filename">.login</I>file:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">/bin/rm -rf ~</PRE></BLOCKQUOTE><PCLASS="para">Whenevera user logs in, the C shell executes all of the commands in the<ICLASS="filename">.login</I> file. A user whose <ICLASS="filename">.login file</I> contains this nasty line willfind all of his files deleted when he logs in!</P><PCLASS="para">Supposethe attacker appends these lines to the user's .login file:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">/bin/cp /bin/sh /usr/tmp/.$USER/bin/chmod 4755 /usr/tmp/.$USER</PRE></BLOCKQUOTE><PCLASS="para">When the user logs in, the system creates a <SPANCLASS="acronym">SUID</SPAN>shell in the <ICLASS="filename">/usr/tmp</I> directory that will allowthe attacker to assume the identity of the user at some point inthe future.</P><PCLASS="para">In addition to <ICLASS="filename">.login,</I> many other filespose security risks when they are world writable. For example, ifan attacker modifies a world-writable <ICLASS="filename">.rhosts </I>file, she can takeover the user's account via the network.</P><PCLASS="para">Ingeneral, the home directories and the files in the home directoriesshould have the permissions set so that they are only writable bythe owner. Many files in the home directory, such as <ICLASS="filename">.rhosts</I>, shouldonly be readable by the owner as well. This practice will hinderan intruder in searching for other avenues of attack.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-11-SECT-6.1.2">11.6.1.2 Writable system files and directories</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15758"></A>There is also a risk when system files and directoriesare world writable. An attacker can replace system programs (suchas <ICLASS="filename">/bin/ls</I>) with new programs that do the attacker'sbidding. This practice is discussed in <ACLASS="xref"HREF="ch08_01.htm"TITLE="Defending  Your Accounts">Chapter 8, <CITECLASS="chapter">Defending  Your Accounts</CITE></A>.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> If you have a server that exports filesystems containingsystem programs (such as the <ICLASS="filename">/bin</I> and <ICLASS="filename">/usr/bin</I>directories), you may wish to export those filesystems read-only.Exporting a filesystem read-only renders the client unable to modifythe files in that directory. To export a filesystem read-only, youmust specify the read-only option in the <ICLASS="filename">/etc/exports</I>file on the server. For example, to export the /bin and<ICLASS="filename">/usr/bin</I> filesystems read-only, specify thefollowing in your <ICLASS="filename">/etc/dfs/dfstab</I> file: <ACLASS="indexterm"NAME="AUTOID-15769"></A><ACLASS="indexterm"NAME="AUTOID-15772"></A><ACLASS="indexterm"NAME="AUTOID-15774"></A></P></BLOCKQUOTE><BLOCKQUOTECLASS="screen"><PRECLASS="screen">share -F nfs -o ro=client /binshare -F nfs -o ro=client /usr/binOn a Berkeley-based system, place these lines in your <ICLASS="filename">/etc/exports </I>file:/bin &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-ro, access=client/usr/bin &nbsp;&nbsp;-ro, access=client</PRE></BLOCKQUOTE><PCLASS="para"><EMCLASS="emphasis">Group-writable files</EM></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15781"></A><ACLASS="indexterm"NAME="AUTOID-15784"></A>Sometimes,making a file group writable is almost as risky as making it worldwritable. If everybody on your system is a member of the group <ICLASS="filename">user</I>,then making a file group-writable by the group <ICLASS="filename">user</I> is the sameas making the file world-writable.</P><PCLASS="para">You can use the<KBDCLASS="command">find</KBD> command to search for files that are group writable by a particulargroup, and to print a list of these files. For example, to searchfor all files that are writable by the group <ICLASS="filename">user</I>, you might specifya command in the following form:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># find / -perm -020 -group user \!   \( -type l -o -type p -o -type s \) -ls</PRE></BLOCKQUOTE><PCLASS="para">If you have <SPANCLASS="acronym">NFS</SPAN>, besure to use the longer version of the command:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># find / \( -local -o -prune \) -perm -020 -group user \!   \( -type l -o -type p -o -type s \) -ls</PRE></BLOCKQUOTE><PCLASS="para">Often,files are made group writable so several people can work on thesame project, and this may be appropriate in your system. However,some files, such as <ICLASS="filename">.cshrc</I> and <ICLASS="filename">.profile,</I> should never be made groupwritable. In many cases, this rule can be generalized to the following:</P><BLOCKQUOTECLASS="blockquote"><PCLASS="para">Any file beginning with a period should not beworld writable or group writable.</P></BLOCKQUOTE><PCLASS="para">A moresecurity-conscious site can further generalize this rule:</P><BLOCKQUOTECLASS="blockquote"><PCLASS="para">Files that begin with a period should not be readableor writable by anyone other than the file's owner (thatis, they should be mode 600).</P></BLOCKQUOTE><PCLASS="para">Use the followingform of the <ICLASS="filename">find </I>command to search for allfiles beginning with a period in the <ICLASS="filename">/u filesystem</I> thatare either group writable or world writable:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># find /u -perm -2 -o -perm -20 -name .\* -ls</PRE></BLOCKQUOTE><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> As noted earlier, if you're using <SPANCLASS="acronym">NFS</SPAN>,be sure to add the <ACLASS="indexterm"NAME="AUTOID-15811"></A><ACLASS="indexterm"NAME="AUTOID-15814"></A><KBDCLASS="command">-local</KBD>or <KBDCLASS="command">-xdev</KBD> option to each of the find commands above and run themon each of your servers, or use the <KBDCLASS="command">fstype/prune</KBD> options.</P></BLOCKQUOTE></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-11-SECT-6.1.3">11.6.1.3 World-readable backup devices</A></H4><PCLASS="para">Your tapedrive should not be world readable. Otherwise, it allows any userto read the contents of any tape that happens to be in the tapedrive. This scenario can be a significant problem for sites whichdo backups overnight, and then leave the tape in the drive untilmorning. During the hours that the tape is awaiting removal, anyuser can read the contents of any file on the tape.<ACLASS="indexterm"NAME="AUTOID-15823"></A></P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-11-SECT-6.2">11.6.2 Shared Libraries</A></H3><PCLASS="para">Programsthat depend on shared libraries are vulnerable to a variety of attacksthat involve switching the shared library that the program is running.If your system has dynamic libraries, they need to be protectedto the same level as the most sensitive program on your system,because modifying those shared libraries can alter the operationof every program.</P><PCLASS="para">On some systems, additional sharedlibraries may be specified through the use of environment variables.While this is a useful feature on some occasions, the system'sshared libraries should not be superseded for the following kindsof programs:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Programs executed by <SPANCLASS="acronym">SUID</SPAN>programs</P></LI><LICLASS="listitem"><PCLASS="para">User shells</P></LI><LICLASS="listitem"><PCLASS="para">Network servers</P></LI><LICLASS="listitem"><PCLASS="para">Security services</P></LI><LICLASS="listitem"><PCLASS="para">Auditing and logging processes</P></LI></UL><PCLASS="para">On some versions of <SPANCLASS="acronym">UNIX</SPAN>, you can disableshared libraries by statically linking the executable program. Onothers, you can limit whether alternate shared libraries are referencedby setting additional mode bits inside the executable image. Weadvise you to take these precautions when available.<ACLASS="indexterm"NAME="AUTOID-15843"></A><ACLASS="indexterm"NAME="AUTOID-15846"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_05.htm"TITLE="11.5 Protecting Yourself"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 11.5 Protecting Yourself"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch12_01.htm"TITLE="12. Physical Security"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 12. Physical Security"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">11.5 Protecting Yourself</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">12. Physical Security</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>