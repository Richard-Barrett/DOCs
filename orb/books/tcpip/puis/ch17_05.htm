<HTML><HEAD><TITLE>[Chapter 17] 17.5 Monitoring Your Network with netstat</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:13:57Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch17_01.htm"TITLE="17. TCP/IP Services"><LINKREL="prev"HREF="ch17_04.htm"TITLE="17.4 Security Implications of Network Services"><LINKREL="next"HREF="ch17_06.htm"TITLE="17.6 Network Scanning"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_04.htm"TITLE="17.4 Security Implications of Network Services"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 17.4 Security Implications of Network Services"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 17<BR>TCP/IP Services</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_06.htm"TITLE="17.6 Network Scanning"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 17.6 Network Scanning"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-17-SECT-5">17.5 Monitoring Your Network with netstat</A></H2><PCLASS="para">You can use the <ACLASS="indexterm"NAME="AUTOID-24155"></A><ACLASS="indexterm"NAME="AUTOID-24157"></A><KBDCLASS="command">netstat</KBD> command to list all of the activeand pending <SPANCLASS="acronym">TCP/IP</SPAN> connections between your machineand every other machine on the Internet. This command is very importantif you suspect that somebody is breaking into your computer or usingyour computer to break into another one. <KBDCLASS="command">netstat</KBD> lets you see whichmachines your machine is talking to over the network. The command'soutput includes the host and port number of each end of the connection,as well as the number of bytes in the receive and transmit queues.If a port has a name assigned in the <ICLASS="filename">/etc/services</I>file, <KBDCLASS="command">netstat</KBD> will print it instead of the port number.</P><PCLASS="para">Normally, the <KBDCLASS="command">netstat</KBD> command displays <SPANCLASS="acronym">UNIX</SPAN>domain sockets in addition to IP sockets. You can restrict the displayto IP sockets only by using the <ICLASS="filename">-f inet</I> option.</P><PCLASS="para">Sample output from the <KBDCLASS="command">netstat</KBD> command looks like this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">charon% <BCLASS="emphasis.bold">netstat -f inet</B>Active Internet connectionsProto Recv-Q Send-Q Local Address          Foreign Address        (state)tcp   0      0      CHARON.MIT.EDU.telnet  GHOTI.LCS.MIT.ED.1300  ESTABLISHEDtcp   0      0      CHARON.MIT.EDU.telnet  amway.ch.apollo..4196  ESTABLISHEDtcp   4096   0      CHARON.MIT.EDU.1313    E40-008-7.MIT.ED.telne ESTABLISHEDtcp   0      0      CHARON.MIT.EDU.1312    MINT.LCS.MIT.EDU.6001  ESTABLISHEDtcp   0      0      CHARON.MIT.EDU.1309    MINT.LCS.MIT.EDU.6001  ESTABLISHEDtcp   0      0      CHARON.MIT.EDU.telnet  MINT.LCS.MIT.EDU.1218  ESTABLISHEDtcp   0      0      CHARON.MIT.EDU.1308    E40-008-7.MIT.ED.telne ESTABLISHEDtcp   0      0      CHARON.MIT.EDU.login   RING0.MIT.EDU.1023     ESTABLISHEDtcp   0      0      CHARON.MIT.EDU.1030    *.*                    LISTEN</PRE></BLOCKQUOTE><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> The <ACLASS="indexterm"NAME="AUTOID-24175"></A><KBDCLASS="command">netstat</KBD>program only displays abridged hostnames, but you can use the <KBDCLASS="command">-n</KBD>flag to display the IP address of the foreign machine.</P></BLOCKQUOTE><PCLASS="para">The first two lines of this output indicate Telnet connectionsbetween the machines <ICLASS="filename">GHOTI.LCS.MIT.EDUu</I> and <ICLASS="filename">AMWAY.CH.APOLLO.COM</I>and the machine <ICLASS="filename">CHARON.MIT.EDU</I>. Both of these connections originatedat the remote machine and represent interactive sessions currentlybeing run on <SPANCLASS="acronym">CHARON</SPAN>; you can tell this becausethese ports are greater than 1023 and are connected to the Telnetport. (They may or may not be unnamed.) Likewise, the third Telnetconnection, between <SPANCLASS="acronym">CHARON</SPAN> and E40-008-7.MIT.EDU,originated at <SPANCLASS="acronym">CHARON</SPAN> to the machine E40-008-7.The next two lines are connections to port 6001 (the X Window Server)on <ICLASS="filename">MINT.LCS.MIT.EDU.</I> There is a <KBDCLASS="command">Telnet</KBD> from <SPANCLASS="acronym">MINT</SPAN>to <SPANCLASS="acronym">CHARON</SPAN>, one from <SPANCLASS="acronym">CHARON</SPAN>to <ICLASS="filename">E40-008-7.MIT.EDU,</I> and an <ICLASS="filename">rlogin</I> from <ICLASS="filename">RINGO.MIT.EDU</I> to <SPANCLASS="acronym">CHARON</SPAN>.The last line indicates that a user program running on <SPANCLASS="acronym">CHARON</SPAN>is listening for connections on port 1030. If you run <KBDCLASS="command">netstat</KBD> onyour computer, you are likely to see many connections. If you usethe X Window System, you may also see &quot;<SPANCLASS="acronym">UNIX</SPAN>domain sockets&quot; that are the local network connectionsfrom your X clients to the X Window Server.</P><PCLASS="para">With the <ACLASS="indexterm"NAME="AUTOID-24200"></A><KBDCLASS="command">-a</KBD>option, <KBDCLASS="command">netstat</KBD> will also print a list of all of the <SPANCLASS="acronym">TCP</SPAN>and <SPANCLASS="acronym">UDP</SPAN> sockets to which programs are listening.Using the <KBDCLASS="command">-a</KBD> option will provide you with a list of allthe ports that programs and users outside your computer can useto enter the system via the network. (Unfortunately, <KBDCLASS="command">netstat</KBD> willnot give you the name of the program that is listening on the socket.)[20]:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[20] But the lsof command will. See the discussion about lsof in<ACLASS="xref"HREF="ch25_01.htm"TITLE="Denial of Service Attacks and Solutions">Chapter 25, <CITECLASS="chapter">Denial of Service Attacks and Solutions</CITE></A>.</P></BLOCKQUOTE><BLOCKQUOTECLASS="screen"><PRECLASS="screen">charon% <BCLASS="emphasis.bold">netstat -a -f inet</B>Active Internet connectionsProto Recv-Q Send-Q Local Address          Foreign Address        (state)Previous netstat printout...tcp       0       0  *.telnet              *.*                    LISTENtcp       0       0  *.smtp                *.*                    LISTENtcp       0       0  *.finger              *.*                    LISTENtcp       0       0  *.printer             *.*                    LISTENtcp       0       0  *.time                *.*                    LISTENtcp       0       0  *.daytime             *.*                    LISTENtcp       0       0  *.chargen             *.*                    LISTENtcp       0       0  *.discard             *.*                    LISTENtcp       0       0  *.echo                *.*                    LISTENtcp       0       0  *.exec                *.*                    LISTENtcp       0       0  *.login               *.*                    LISTENtcp       0       0  *.shell               *.*                    LISTENtcp       0       0  *.ftp                 *.*                    LISTENudp       0       0  *.time                *.*udp       0       0  *.daytime             *.*udp       0       0  *.chargen             *.*udp       0       0  *.discard             *.*udp       0       0  *.echo                *.*udp       0       0  *.ntalk               *.*udp       0       0  *.talk                *.*udp       0       0  *.biff                *.*udp       0       0  *.tftp                *.*udp       0       0  *.syslog              *.*charon%&#13;</PRE></BLOCKQUOTE><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> <ACLASS="indexterm"NAME="AUTOID-24216"></A><ACLASS="indexterm"NAME="AUTOID-24219"></A><ACLASS="indexterm"NAME="AUTOID-24222"></A>There are weaknessesin the implementation of network services that can be exploitedso that one machine can masquerade temporarily as another machine.There is <ICLASS="firstterm">nothing</I> that you can do to prevent this deception, assumingthat the attacker gets the code correct and has access to the network.This kind of &quot;spoof&quot; is not easy to carry out,but toolkits are available to make the process easier. Some formsof spoofing may require physical access to your local network, butothers may be done remotely. All require exact timing of eventsto succeed. Such spoofs are often impossible to spot afterwards.<ACLASS="indexterm"NAME="AUTOID-24227"></A><ACLASS="indexterm"NAME="AUTOID-24229"></A></P></BLOCKQUOTE></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_04.htm"TITLE="17.4 Security Implications of Network Services"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 17.4 Security Implications of Network Services"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_06.htm"TITLE="17.6 Network Scanning"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 17.6 Network Scanning"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">17.4 Security Implications of Network Services</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">17.6 Network Scanning</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>