<HTML><HEAD><TITLE>[Chapter 20] 20.5 Some Last Comments</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:16:08Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch20_01.htm"TITLE="20. NFS"><LINKREL="prev"HREF="ch20_04.htm"TITLE="20.4 Improving NFS Security"><LINKREL="next"HREF="part05.htm"TITLE="V. Advanced Topics"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch20_04.htm"TITLE="20.4 Improving NFS Security"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 20.4 Improving NFS Security"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 20<BR>NFS</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="PART"HREF="part05.htm"TITLE="V. Advanced Topics"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: V. Advanced Topics"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-20-SECT-5">20.5 Some Last Comments</A></H2><PCLASS="para">Here are a few final words about <SPANCLASS="acronym">NFS</SPAN>.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-20-SECT-5.1">20.5.1 Well-Known Bugs</A></H3><PCLASS="para"><SPANCLASS="acronym">NFS</SPAN> depends on <SPANCLASS="acronym">NIS</SPAN> or<SPANCLASS="acronym">NIS</SPAN>+ on many machines. Both <SPANCLASS="acronym">NFS</SPAN>and <SPANCLASS="acronym">NIS</SPAN> implementations have had some well-knownimplementation flaws and bugs in recent years. Not only are theseflaws well-known, there are a number of hacker toolboxes availablethat include programs to take advantage of these flaws. Therefore,if you are running <SPANCLASS="acronym">NFS</SPAN>, you should be certainthat you are up to date on vendor patches and bug fixes. In particular:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Make sure that your version of the<SPANCLASS="acronym">RPC</SPAN> <KBDCLASS="command">portmapper</KBD> does not allow <ICLASS="firstterm">proxyrequests</I> and that your own system is not in the exportlist for a partition. Otherwise, a faked packet sent to your <SPANCLASS="acronym">RPC</SPAN>system can be made to fool your <SPANCLASS="acronym">NFS</SPAN> system intoacting as if the packet was valid and came from your own machine.</P></LI><LICLASS="listitem"><PCLASS="para">Make sure that your <SPANCLASS="acronym">NFS</SPAN> eitheruses Secure <SPANCLASS="acronym">RPC</SPAN>, or examines the full 32 bitsof the <SPANCLASS="acronym">UIDS</SPAN> passed in. Some early versions of<SPANCLASS="acronym">NFS</SPAN> only examined the least significant 16 bitsof the passed-in <SPANCLASS="acronym">UID</SPAN> for some tests, so accessescould be crafted that would not get mapped to <ICLASS="systemitem">nobody</I>, and would function asroot accesses.</P></LI><LICLASS="listitem"><PCLASS="para">Make sure that your version of <SPANCLASS="acronym">NFS</SPAN>does not allow remote users to issue mknod commands on partitionsthey import from your servers. A user creating a new <ICLASS="filename">/dev/kmem</I>file on your partition has made a big first step towards a completecompromise of your system.</P></LI><LICLASS="listitem"><PCLASS="para">Make sure that your <SPANCLASS="acronym">NFS</SPAN> doesthe correct thing when someone does a <KBDCLASS="command">cd..</KBD> inthe top level of an imported directory from your server. Some olderversions of <SPANCLASS="acronym">NFS</SPAN> would return a file handle tothe server's real parent directory instead of the parentto the client's mount point. Because <SPANCLASS="acronym">NFS</SPAN>doesn't know how you get file handles, and it applies permissionson whole partitions rather than mount points, this process couldlead to your server's security being compromised.</P><PCLASS="para">In particular, when a server would export a subdirectory asthe <ICLASS="filename">root</I> partition for a diskless workstation, a user on the workstationcould do <KBDCLASS="command">cd /; cd..</KBD>. and instead of getting the<ICLASS="filename">root</I> directory again, they would have access to the parent directoryon the server! Further compounding this scenario, the export ofthe partition needed to be done with <ICLASS="filename">root=</I> access. As aresult, clients would have unrestricted access to the server'sdisks!</P></LI><LICLASS="listitem"><PCLASS="para">Make sure that your server parses the export optionlist correctly. Some past and current <SPANCLASS="acronym">NFS</SPAN> implementationsget accesses mixed up. If you specify <ICLASS="filename">access=</I> and <ICLASS="filename">rw=</I>on the same export, or <ICLASS="filename">access=</I> and <ICLASS="filename">root=,</I> thesystem sometimes forgets the <ICLASS="filename">access=</I> specification andexports the partition to every other machine in the world.</P></LI></UL></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-20-SECT-5.2">20.5.2 For Real Security, Don't Use NFS</A></H3><PCLASS="para"><SPANCLASS="acronym">NFS</SPAN> and other distributed filesystems providesome wonderful functions. They are also a source of continuing headaches.You should consider the question of whether you really need allthe flexibility and power of <SPANCLASS="acronym">NFS</SPAN> and distributedsystems. By reexamining your fundamental assumptions, you may findthat you can reconfigure your systems to avoid <SPANCLASS="acronym">NFS</SPAN>problems completely, by eliminating <SPANCLASS="acronym">NFS</SPAN>.</P><PCLASS="para">For instance, one reason that is often given for having <SPANCLASS="acronym">NFS</SPAN>is to easily keep software in sync on many machines at once. However,that argument was more valid before the days of high-speed localnetworks and cheap disks. You might be better served by equippingeach workstation in your enterprise with a 2GB or 4GB disk, witha complete copy of all of your applications residing on each machine.You can use a facility such as <KBDCLASS="command">rdist</KBD> (see Chapter9) to make necessary updates. Not only will this configuration giveyou better security, but it will also provide better fault tolerance:if the server or network goes down, each system has everything necessaryto continue operation. This configuration also facilitates systemcustomization.</P><PCLASS="para">A second argument for network filesystems is that they allowusers to access their home accounts with greater ease, no matterwhich machine they use. But while this may make sense in a universitystudent lab, most employees almost always use the same machine,so there is no reason to access multiple machines as if they wereequivalent.</P><PCLASS="para">Network filesystems are sometimes used to share large databasesfrom multiple points. But network filesystems are a poor choicefor this application because locking the database and synchronizingupdates is usually more difficult than sharing a single machineusing remote logins. In fact, with the X Window System, openinga window on a central database machine is convenient and often asfast (or faster) than accessing the data via a network filesystem.Alternatively, you can use a database server, with client programsthat are run locally.</P><PCLASS="para">The argument is also made that sharing filesystems over thenetwork results in lower cost. In point of fact, such a configurationmay be <EMCLASS="emphasis">more expensive</EM> than the alternatives.For instance, putting high-resolution color X display terminalson each desktop and connecting them with 100MB Ethernet to a multiprocessorserver equipped with <SPANCLASS="acronym">RAID</SPAN> disk may be more cost-effective,provide better security, give better performance, and use less electricity.The result may be a system that is cheaper to buy, operate, andmaintain. The only loss is the cachet of equipping each user witha top-of-the-line workstation on his desktop when all he reallyneeds is access to a keyboard, mouse, and fast display.</P><PCLASS="para">Indeed, the only argument for network filesystems may be security.Today most X terminals have no support for encryption.[13] On client/server-basedsystems that use Kerberos or <SPANCLASS="acronym">DCE, </SPAN>you can avoidsending unencrypted passwords and user data over the network. Butbe careful: you will only get the data confidentiality aspects ofthis approach if your remote filesystem encrypts all user data;most don't.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[13] Weexpect this to change in the near future.</P></BLOCKQUOTE><PCLASS="para">Questioning your basic assumptions may simultaneously saveyou time, money, and improve your security.</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch20_04.htm"TITLE="20.4 Improving NFS Security"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 20.4 Improving NFS Security"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="PART"HREF="part05.htm"TITLE="V. Advanced Topics"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: V. Advanced Topics"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">20.4 Improving NFS Security</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">V. Advanced Topics</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>