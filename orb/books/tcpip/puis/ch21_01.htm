<HTML><HEAD><TITLE>[Chapter 21] Firewalls</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:16:32Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part05.htm"TITLE="V. Advanced Topics"><LINKREL="prev"HREF="part05.htm"TITLE="V. Advanced Topics"><LINKREL="next"HREF="ch21_02.htm"TITLE="21.2 Building Your Own Firewall"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="PART"HREF="part05.htm"TITLE="V. Advanced Topics"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: V. Advanced Topics"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 21</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch21_02.htm"TITLE="21.2 Building Your Own Firewall"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 21.2 Building Your Own Firewall"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="PUIS-CHP-21">21. Firewalls</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="SECT1"HREF="#PUIS-CHP-21-SECT-1"TITLE="21.1 What's a Firewall?">What's a Firewall?</A><BR><ACLASS="SECT1"HREF="ch21_02.htm"TITLE="21.2 Building Your Own Firewall">Building Your Own Firewall</A><BR><ACLASS="SECT1"HREF="ch21_03.htm"TITLE="21.3 Example: Cisco Systems Routers as Chokes">Example: Cisco Systems Routers as Chokes</A><BR><ACLASS="SECT1"HREF="ch21_04.htm"TITLE="21.4 Setting Up the Gate">Setting Up the Gate</A><BR><ACLASS="SECT1"HREF="ch21_05.htm"TITLE="21.5 Special Considerations">Special Considerations</A><BR><ACLASS="SECT1"HREF="ch21_06.htm"TITLE="21.6 Final Comments">Final Comments</A></P><P></P></DIV><PCLASS="para">Most systems for providing <SPANCLASS="acronym">UNIX </SPAN>network security thatwe have discussed in this book are designed to protect an individual<SPANCLASS="acronym">UNIX</SPAN> host from a hostile network. <ACLASS="indexterm"NAME="AUTOID-29255"></A>Wehave also explored systems such as Kerberos and Secure <SPANCLASS="acronym">RPC</SPAN>,which allow a set of hosts to communicate securely in a hostileenvironment.</P><PCLASS="para">As an alternative to protecting individualcomputers on a network, many organizations have opted for a seeminglysimpler solution: protecting an organization's internalnetwork from external attack. </P><PCLASS="para">The simplest way to protecta network of computers is with <ICLASS="firstterm">physical isolation</I>.Avoid the problems of networks by not connecting your host to theInternet and not providing dial-in modems. Nobody from the outsidewill be able to attack your computers without first entering yourphysical premises. Although this approach completely ignores thedamage that insiders can do, it is nevertheless a simple, straightforwardpolicy that has been used by most organizations for years. In manyenvironments, this is still the best way to approach network security&nbsp;- thereis little to be gained from connection to outside networks, andmuch to lose.</P><PCLASS="para">Recently, however, the growth of the Internethas made physical isolation more difficult. Employees in organizationswant email, they want access to Usenet news, and they want to browsethe World Wide Web. In addition, organizations want to publish informationabout themselves on the Web. To allow partial connection to theInternet, while retaining some amount of isolation, some organizationsare using firewalls to protect their security.</P><PCLASS="para">Firewallsare powerful tools, but they should never be used <EMCLASS="emphasis">instead</EM>of other security measures. They should only be used <EMCLASS="emphasis">inaddition</EM> to such measures.</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-21-SECT-1">21.1 What's a Firewall?</A></H2><PCLASS="para">A <ICLASS="firstterm">firewall</I>gives organizations a way to create a middle ground between networksthat are completely isolated from external networks, such as theInternet, and those that are completely connected. Placed betweenan organization's internal network and the external network,the firewall provides a simple way to control the amount and kindsof traffic that will pass between the two.</P><PCLASS="para">The term<ICLASS="firstterm">firewall </I>comes from the construction industry.When apartment houses or office buildings are built, they are oftenequipped with firewalls&nbsp;- specially constructed walls thatare resistant to fire. If a fire should start in the building, itmay burn out of control in one portion, but the firewall will stopor slow the progress of the fire until help arrives. </P><PCLASS="para">Thesame philosophy can be applied to the protection of local area networksof machines from outside attack. Used within an organization, afirewall can limit the amount of damage: an intruder may break intoone set of machines, but the firewall will protect others. Erectedbetween an organizational network and the Internet at large, a firewallprevents a malicious attacker who has gained control of computersoutside the organization's walls from gaining a footholdon the inside. Firewalls seem to make sense because there is alwaysa &quot;fire&quot; burning somewhere on the Internet.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-21-SECT-1.1">21.1.1 Default Permit vs. Default Deny</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-29275"></A><ACLASS="indexterm"NAME="AUTOID-29278"></A>Thefundamental function of a firewall is to restrict the flow of informationbetween two networks. To set up your firewall, you must thereforedefine what kinds of data pass and what kinds are blocked. Thisis called defining your firewall's <ICLASS="firstterm">policy</I>.After a policy is defined, you must then create the actual <ICLASS="firstterm">mechanisms</I>that implement that policy.</P><PCLASS="para">There are two basic strategiesfor defining firewall policy: </P><DLCLASS="variablelist"><DTCLASS="term">Default permit</DT><DDCLASS="listitem"><PCLASS="para">With this strategy, you give the firewall the setof conditions that will result in data being blocked. Any host orprotocol that is not covered by your policy will be passed by default.</P></DD><DTCLASS="term">Default deny</DT><DDCLASS="listitem"><PCLASS="para">With this strategy, you describe the specific protocolsthat should be allowed to cross through the firewall, and the specifichosts that may pass data and be contacted. The rest are denied.</P></DD></DL><PCLASS="para">There are advantages and disadvantages to both default permitand default deny. The primary advantage of default permit is thatit is easier to configure: you simply block out the protocols thatare &quot;too dangerous,&quot; and rely on your awarenessto block new dangerous protocols as they are developed (or discovered).With default deny, you simply enable protocols as they are requestedby your users or management. Any protocol that isn't beingused by your organization might as well be blocked.</P><PCLASS="para">Neitherdefault permit nor default deny is a panacea. With both policies,you can create a firewall that is either secure or unsecure, bypermitting (or failing to deny) &quot;dangerous&quot; protocols.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-21-SECT-1.2">21.1.2 Uses of Firewalls</A></H3><PCLASS="para">Firewalls are partof a good defense in depth strategy. The idea is to place severallayers of protection between your machines and the potential threats.There are some obvious threats from the outside, so you should naturallyplace a firewall between the outside and your internal network(s).&#13;</P><PCLASS="para">Because a firewall is placed at the intersection oftwo networks, it can be used for many other purposes besides simplycontrolling access. For example:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Firewalls can be used to block accessto particular sites on the Internet, or to prevent certain usersor machines from accessing certain servers or services.</P></LI><LICLASS="listitem"><PCLASS="para">A firewall can be used to monitor communicationsbetween your internal network and an external network. For example,you could use the firewall to log the endpoints and amount of datasent over every <SPANCLASS="acronym">TCP/IP</SPAN> connection between yourorganization and the outside world. </P></LI><LICLASS="listitem"><PCLASS="para">A firewall can even be used to eavesdrop and recordall communications between your internal network and the outsideworld. A 56KB leased line at 100% utilization passes only605 MB/day, meaning that a week's worth of Internettraffic can easily fit on a single 8mm digital tape. Such recordscan be invaluable for tracking down network penetrations or detectinginternal subversion.[1]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] Such records also pose profoundprivacy questions, and possibly legal ones as well. Investigatethese questions carefully before engaging in such monitoring.</P></BLOCKQUOTE></LI><LICLASS="listitem"><PCLASS="para">If your organization has more than one physicallocation and you have a firewall for each location, you can programthe firewalls to automatically encrypt packets that are sent overthe network between them. In this way, you can use the Internetas your own private wide area network (<SPANCLASS="acronym">WAN</SPAN>) withoutcompromising the data; this process is often referred to as creatinga <ICLASS="firstterm"><ACLASS="indexterm"NAME="AUTOID-29313"></A><ACLASS="indexterm"NAME="AUTOID-29315"></A>virtualprivate network</I>, or <SPANCLASS="acronym">VPN</SPAN>. (You willstill be vulnerable to traffic analysis and denial of service attacks,however.)</P></LI></UL></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-21-SECT-1.3">21.1.3 Anatomy of a Firewall</A></H3><PCLASS="para">Fundamentally,all firewalls consist of the following two kinds of components:[2]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] The first edition of this book introduced this terminologyas part of one of the first written descriptions of firewalls. Althoughnot everyone in the community has adopted these terms, we believethat they are at least as descriptive as other terms invented since.</P></BLOCKQUOTE><DLCLASS="variablelist"><DTCLASS="term"><ICLASS="firstterm">Chokes</I></DT><DDCLASS="listitem"><PCLASS="para">Computer or communications devices that restrictthe free flow of packets between networks. Chokes are often implementedwith routers, but they do not have to be. The use of the word &quot;choke&quot;is taken from the field of electronics: a choke is a device thatexhibits great resistance to certain types of signals, but not toothers.</P></DD><DTCLASS="term"><ICLASS="firstterm">Gates</I></DT><DDCLASS="listitem"><PCLASS="para">Specially designated programs, devices, or computerswithin the firewall's perimeter that receive connectionsfrom external networks and handle them appropriately. Other textson firewalls sometimes refer to single machines that handle allgate functions as <ICLASS="firstterm"><ACLASS="indexterm"NAME="AUTOID-29335"></A>bastionhosts. </I></P><PCLASS="para">Ideally, users should not have accounts on a gatecomputer. This restriction helps improve the computer'sreliability and users' security.</P><PCLASS="para">On the gate(s), you may run one or more of the followingkinds of programs:</P></DD><DTCLASS="term"><ICLASS="filename">Network client software</I></DT><DDCLASS="listitem"><PCLASS="para">Client software includes programs such as <KBDCLASS="command">telnet</KBD>,<KBDCLASS="command">ftp</KBD> and <KBDCLASS="command">mosaic</KBD>. One of thesimplest ways to give users limited access to the Internet is toallow them to log onto the gate machine and allow them to run networkclient software directly. This technique has the disadvantage thatyou must either create user accounts on the gate computer, or youmust have users share a single account.</P></DD><DTCLASS="term"><ICLASS="firstterm">Proxy server</I></DT><DDCLASS="listitem"><PCLASS="para">A proxy is a program that poses as another. In thecase of a firewall, a proxy is a program that forwards a requestthrough your firewall, from the internal network to the externalone.</P></DD><DTCLASS="term"><ICLASS="firstterm">Network servers</I></DT><DDCLASS="listitem"><PCLASS="para">You can also run network servers on your gate. Forexample, you might want to run an <SPANCLASS="acronym">SMTP</SPAN> serversuch as sendmail or smap so that you can receive electronic mail.(If you wish to run an <SPANCLASS="acronym">HTTP</SPAN> server to publishinformation on the World Wide Web, that server should be run ona separate computer, and <EMCLASS="emphasis">not </EM>on your gate.)</P></DD></DL><PCLASS="para">Many network servers can also function as proxies. They cando so because they implement simple store-and-forward models, allowingthem to forward queries or messages that they cannot handle themselves.Some servers that can operate easily as proxies include <SPANCLASS="acronym">SMTP</SPAN>(because email messages are automatically forwarded), <SPANCLASS="acronym">NNTP</SPAN>(news is cached locally), <SPANCLASS="acronym">NTP</SPAN> (time is maintainedlocally), and <SPANCLASS="acronym">DNS</SPAN> (host addresses are locallycached). The following sections explore a variety of different kindsof firewall configurations in use today.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-21-SECT-1.4">21.1.4 Dual-ported Host: The First Firewalls</A></H3><PCLASS="para">Thefirst Internet firewalls were <SPANCLASS="acronym">UNIX</SPAN> computersequipped with two network ports: one for the internal network, andone for the external network (see <ACLASS="xref"HREF="ch21_01.htm#PUIS-CHP-21-FIG-1"TITLE="Firewall built from a dual-ported host">Figure 21.1</A>).</P><H4CLASS="figure"><ACLASS="title"NAME="PUIS-CHP-21-FIG-1">Figure 21.1: Firewall built from a dual-ported host</A></H4><IMGCLASS="graphic"SRC="figs/puis_2101.gif"ALT="Figure 21.1"><PCLASS="para">In this configuration, the <SPANCLASS="acronym">UNIX</SPAN>computer functions as both the choke and the gate. Services areprovided to internal users in one of two ways:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Users can log onto the dual-portedhost directly (not a good idea, because users can then compromisethe security of the firewall computer).</P></LI><LICLASS="listitem"><PCLASS="para">The dual-ported host can run proxy servers for theindividual services that you wish to pass across the firewall.</P></LI></UL><PCLASS="para">To ensure that the computer functions as a choke, the computermust not forward packets from the external network to the internalnetwork and vice versa. On most <SPANCLASS="acronym">UNIX</SPAN> systemsusing Berkeley-derived <SPANCLASS="acronym">TCP/IP</SPAN>, you can do soby setting the kernel variable <ICLASS="filename">ip_forwarding</I> to 0.[3]Unfortunately, some <SPANCLASS="acronym">UNIX</SPAN> systems will still forwardpackets that have IP source-routing options set. Thus, you shouldcarefully examine any dual-ported <SPANCLASS="acronym">UNIX</SPAN> systemthat is used as a choke to make sure that it will not forward packetsfrom one interface to another.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] This setting is usually established with a SET in the <ICLASS="filename">/etc/system</I>file under SVR4, or with a small shell and <KBDCLASS="command">adb</KBD> script under othersystems. See your system documentation for details.</P></BLOCKQUOTE><PCLASS="para">On a Solaris machine,you can disable both IP forwarding and forwarding of source-routedpackets by including the following commands in some start-up file(e.g., in the appropriate file in <ICLASS="filename">/etc/rc2.d</I>):[4]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] Be careful when you set these variables. The file <ICLASS="filename">/etc/init.d/netinit</I>(linked to <ICLASS="filename">/etc/rc2.d/S69inet)</I> also containsexplicit settings of the <ICLASS="filename">ip_forward</I> variable. To avoidhaving your values overwritten, comment out the system code in inetthat sets <ICLASS="filename">ip_forward</I>, and put your code in its place.</P></BLOCKQUOTE><BLOCKQUOTECLASS="screen"><PRECLASS="screen">ndd -set /dev/ip ip_forwarding 0ndd -set /dev/ip ip_forward_src_routed 0</PRE></BLOCKQUOTE><PCLASS="para">Note that under SunOS, you need to set <ICLASS="filename">ip_forwarding</I>= 0 in the kernel configuration. If you don't,the kernel will still IP forward under some conditions even if you'veset the <ICLASS="filename">ip_forwarding</I> variable to 0.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-21-SECT-1.5">21.1.5 Packet Filtering: A Simple Firewall with Only a Choke</A></H3><PCLASS="para">A simple firewall can be built from a single choke (see <ACLASS="xref"HREF="ch21_01.htm#PUIS-CHP-21-FIG-2"TITLE="Firewall built from a single choke">Figure 21.2</A>.)For example, some organizations use the <ICLASS="firstterm">packet filtering</I>features available on some routers to block the <SPANCLASS="acronym">TCP</SPAN>and <SPANCLASS="acronym">UDP</SPAN> packets for certain kinds of services.</P><H4CLASS="figure"><ACLASS="title"NAME="PUIS-CHP-21-FIG-2">Figure 21.2: Firewall built from a single choke</A></H4><IMGCLASS="graphic"SRC="figs/puis_2102.gif"ALT="Figure 21.2"><PCLASS="para">Programming the choke is straightforward:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Block all packets for services thatare not used.</P></LI><LICLASS="listitem"><PCLASS="para">Block all packets that explicitly set IP source-routingoptions.</P></LI><LICLASS="listitem"><PCLASS="para">Allow incoming <SPANCLASS="acronym">TCP</SPAN> connectionsto your predetermined network servers, but block all others.</P></LI><LICLASS="listitem"><PCLASS="para">Optionally, allow computers within your organization'snetwork to initiate outgoing <SPANCLASS="acronym">TCP</SPAN> connectionsto any computer on the Internet.</P></LI></UL><PCLASS="para">Thisis a simple configuration very popular on today's Internet.Many organizations use a single choke (usually a router) as a firewallfor the entire organization.</P><PCLASS="para">Packet filtering has anumber of advantages:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">It is simple and cheap. Most organizationscan build packet filters using routers that they already use toconnect their networks to the Internet.</P></LI><LICLASS="listitem"><PCLASS="para">Packet filtering is flexible. For example, if youdiscover that a person on a particular subnet, say 204.17.191.0,is trying to break into your computer, you can simply block allaccess to your network from that subnet. (Of course, this methodwill only work until the user at the subnet decides to launch anattack against you from another network or begins to forge IP addressesin the packets.)</P></LI></UL><PCLASS="para">Packet filtershave several disadvantages: </P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Filters typically do not have verysophisticated systems for logging the amount of traffic that hascrossed the firewall, logging break-in attempts, or giving differentkinds of access to different users; however, some routers now includesupport for logging filter violations through the use of <KBDCLASS="command">syslog</KBD>.</P></LI><LICLASS="listitem"><PCLASS="para">Filter rulesets can be very complex&nbsp;- socomplex that you might not know if they are correct or not. </P></LI><LICLASS="listitem"><PCLASS="para">There is no easy way to test filters except throughdirect experimentation, which may prove problematical in many situations.</P></LI><LICLASS="listitem"><PCLASS="para">Packet filters do not handle the <SPANCLASS="acronym">FTP</SPAN>protocol well because data transfers occur over high-numbered <SPANCLASS="acronym">TCP</SPAN>ports; however, this problem can be alleviated by <SPANCLASS="acronym">FTP</SPAN>clients that support the <SPANCLASS="acronym">FTP</SPAN> passive mode.</P></LI></UL><PCLASS="para">In addition to these disadvantages, there are several fundamentaldesign weaknesses with packet filters:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">If the security of the router is compromised,then all hosts on the internal network are wide open to attack.&#13;</P></LI><LICLASS="listitem"><PCLASS="para">You may not know if the security of the router iscompromised because there is no simple way to test the router'sconfiguration tables.</P></LI><LICLASS="listitem"><PCLASS="para">Although the router may record the number of packetsthat are passed and blocked, it usually does not record other kindsof useful information.</P></LI><LICLASS="listitem"><PCLASS="para">The router may allow remote administration. It maynot alert you if somebody is repeatedly trying to guess its accesspassword.</P></LI><LICLASS="listitem"><PCLASS="para">The scheme can easily be defeated with minimal aidfrom a cooperative (or duped) insider.</P></LI><LICLASS="listitem"><PCLASS="para">There is no protection against the <EMCLASS="emphasis">contents</EM>of some connections, such as email or <SPANCLASS="acronym">FTP</SPAN> transfercontents.</P></LI></UL></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-21-SECT-1.6">21.1.6 One Choke, One Gate: <ICLASS="firstterm">Screened Host Architecture</I></A></H3><PCLASS="para">You can build a more secure firewall using a choke and a gate.The gate is a specially chosen computer on your network at whichyou run your mail server and any user proxy programs. (<SPANCLASS="acronym">WWW</SPAN>servers and anonymous <SPANCLASS="acronym">FTP</SPAN> servers should be runon separate computers, outside the firewall.) The choke can be arouter with two interfaces. For example, a router with two Ethernetinterfaces can partition one network from another. Alternatively,a router with an Ethernet and a high-speed interface can serve bothas a gate and as an organization's connection with an off-siteInternet service provider (<SPANCLASS="acronym">ISP</SPAN>).[5](See <ACLASS="xref"HREF="ch21_01.htm#PUIS-CHP-21-FIG-3"TITLE="Traditional firewall with a choke and a gate">Figure 21.3</A>.)</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[5] Many ISPswill, as a courtesy, maintain the router that connects your networkto theirs. If you allow your ISP to maintain your router, then youshould <EMCLASS="emphasis">not </EM>use it as the basis for your firewall.Instead, you should have a second router behind the first routerthat is used only for security.</P></BLOCKQUOTE><H4CLASS="figure"><ACLASS="title"NAME="PUIS-CHP-21-FIG-3">Figure 21.3: Traditional firewall with a choke and a gate</A></H4><IMGCLASS="graphic"SRC="figs/puis_2103.gif"ALT="Figure 21.3"><PCLASS="para">Programming is somewhat more complex in thisarrangement.</P><PCLASS="para"><EMCLASS="emphasis">External choke:</EM></P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Block packets for services that youdo not wish to cross your firewall.</P></LI><LICLASS="listitem"><PCLASS="para">Block packets that have IP source routing, or thathave other &quot;unusual&quot; options set (e.g., record-route).</P></LI><LICLASS="listitem"><PCLASS="para">Block packets that have your internal network astheir destination.</P></LI><LICLASS="listitem"><PCLASS="para">Only pass packets for which the source or destinationIP address is the IP address of the gate.</P></LI></UL><PCLASS="para"><EMCLASS="emphasis">Gate:</EM></P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Runs server proxies to allow userson the inside network to use services on the external network.</P></LI><LICLASS="listitem"><PCLASS="para">Either acts as a mail server, or receives mail fromthe external network and forwards it to a specially designed hoston the internal network.</P></LI></UL><PCLASS="para">Withthis configuration, the choke is configured so that it will onlypass packets between the outside network and the gate. If any computeron your inside network wishes to communicate with the outside, thecommunication package must pass through a special &quot;proxy&quot;program running on the gate.[6]Users on the outside network must connect to the gate before bridgingthrough to your internal network.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[6] We describe one suchset of proxies in <ACLASS="xref"HREF="ch22_01.htm"TITLE="Wrappers and Proxies">Chapter 22, <CITECLASS="chapter">Wrappers and Proxies</CITE></A>.</P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-21-SECT-1.7">21.1.7 Two Chokes and One Gate: Screened Subnet Architecture</A></H3><PCLASS="para">For a higher degree of security, some sites have implementeda firewall built from two chokes, as shown in <ACLASS="xref"HREF="ch21_01.htm#PUIS-CHP-21-FIG-4"TITLE=". Firewall built from two chokes and one gate">Figure 21.4</A>.</P><H4CLASS="figure"><ACLASS="title"NAME="PUIS-CHP-21-FIG-4">Figure 21.4: . Firewall built from two chokes and one gate</A></H4><IMGCLASS="graphic"SRC="figs/puis_2104.gif"ALT="Figure 21.4"><PCLASS="para">In this configuration, boththe external choke and the gate are programmed as before. What'snew is the addition of an internal choke. This second choke is afail-safe: in the event that an attacker breaks into the gate andgains control over it, the internal choke prevents the attackerfrom using the gate to launch attacks against other computers insidethe organization's network.</P><PCLASS="para">Programming issimilar to that of a single choke:</P><PCLASS="para"><EMCLASS="emphasis">External choke:</EM></P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Block packets for services that youdo not wish to cross your firewall.</P></LI><LICLASS="listitem"><PCLASS="para">Block packets that have IP source routing or thathave other &quot;unusual&quot; options set.</P></LI><LICLASS="listitem"><PCLASS="para">Block packets addressed to your internal networkor your internal choke.</P></LI><LICLASS="listitem"><PCLASS="para">Only pass packets for which the source or the destinationIP address is that of the gate.</P></LI></UL><PCLASS="para"><EMCLASS="emphasis">Gate:</EM></P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Runs server proxies to allow userson the inside network to use services on the external network.</P></LI><LICLASS="listitem"><PCLASS="para">Either acts as a mail server, or sends mail to aspecially designed host on the internal network.</P></LI></UL><PCLASS="para"><EMCLASS="emphasis">Internal choke:</EM></P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Block packets for services that youdo not wish to cross your firewall.</P></LI><LICLASS="listitem"><PCLASS="para">Block packets that have IP source routing or thathave other &quot;unusual&quot; options set.</P></LI><LICLASS="listitem"><PCLASS="para">Block packets addressed to the external choke.</P></LI><LICLASS="listitem"><PCLASS="para">Pass packets for which the source or destinationIP address is that of the gate, and for which the ports are fordefined proxies on the gate.</P></LI><LICLASS="listitem"><PCLASS="para">Block everything else.</P></LI></UL></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-21-SECT-1.8">21.1.8 Multiple Gates</A></H3><PCLASS="para">Instead of using a singlegate, you can use several gates&nbsp;- one for each protocol.This approach has the advantage of making the gates easier to administer.However, this approach also increases the number of machines thatmust be carefully watched for unusual activity. A simpler approachmight be to have a single gate, but to create individual serverswithin your organization's network for specific servicessuch as mail, Usenet, World Wide Web, and so forth.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-21-SECT-1.9">21.1.9 Internal Firewalls</A></H3><PCLASS="para">Instead of puttingall your organization's machines on a single local network,you can separate your installation into sets of independent localarea networks. These networks can communicate through gateway machines,routers, or full-blown firewalls. Alternatively, they can communicatewith each other through independent links to the Internet, usingan appropriate encryption system to prevent eavesdropping by your<SPANCLASS="acronym">ISP</SPAN> and others.</P><PCLASS="para">Internal firewallsmake a lot of sense in a large organization. After all, there isno reason to allow your research scientists any privileged accessto a computer that is used for accounting, or to allow people whoare sitting in front of data-entry terminals to try their hand atbreaking into the research and development department'sfile servers. With an internal firewall, you can place extra securitywhere needed.</P><PCLASS="para">The goal in setting up independent internalnetworks should be to minimize the damage that will take place ifone of your internal networks is compromised, either by an intruderor, more likely, by an insider. By practicing stringent isolation,you can reduce the chances that an attacker will be able to usea foothold in one network as a beachhead for breaking into others.</P><PCLASS="para">A firewall designed for use within an organization is verysimilar to one that is used to protect an organization against externalthreats. However, because the same management team and structuremay be responsible for many networks within an organization, thereis a great temptation to share information or services via an internalfirewall, when such information services should in fact be blocked.</P><PCLASS="para">Follow these basic guidelines when setting up independentinternal networks:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">If you use <SPANCLASS="acronym">NIS</SPAN>,make sure that each local area network has its own server. Makesure that each server and its clients have their own netgroup domain.&#13;</P></LI><LICLASS="listitem"><PCLASS="para">Don't let any server or workstation onone network trust hosts on any other network or any gateway machine.(For an explanation of trusted hosts, see &quot;Trusted hostsand users&quot; in <ACLASS="xref"HREF="ch17_01.htm"TITLE="TCP/IP Services">Chapter 17, <CITECLASS="chapter">TCP/IP Services</CITE></A>.) </P></LI><LICLASS="listitem"><PCLASS="para">Make certain that users who have accounts on morethan one local network have different passwords for each subnet.If possible, use a one-time password scheme or token-based system.</P></LI><LICLASS="listitem"><PCLASS="para">Enable the highest level of logging for the gateways,and the most restrictive security possible. If possible, do notallow user accounts on the gateway machines. </P></LI><LICLASS="listitem"><PCLASS="para">Do not <SPANCLASS="acronym">NFS</SPAN>-mount filesystemsfrom one <SPANCLASS="acronym">LAN</SPAN> onto another <SPANCLASS="acronym">LAN</SPAN>.If you absolutely must share a partition, be sure that it is exportedread-only.</P></LI></UL><PCLASS="para">Internal firewallmachines have many benefits: </P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">They help isolate physical failureof the network to a smaller number of machines. </P></LI><LICLASS="listitem"><PCLASS="para">They limit the number of machines putting informationon any physical segment of the network, thus limiting the damagethat can be done by eavesdropping. </P></LI><LICLASS="listitem"><PCLASS="para">They limit the number of machines that will be affectedby flooding attacks. </P></LI><LICLASS="listitem"><PCLASS="para">They create barriers for attackers, both externaland internal, who are trying to attack specific machines at a particularinstallation. </P></LI></UL><PCLASS="para">Remember: Althoughmost people spend considerable time and money protecting againstattacks from outsiders, dishonest and disgruntled employees arein a position to do much more damage to your organization. Properlyconfigured internal firewalls help limit the amount of damage thatan insider can do.</P><PCLASS="para">In the following text, we'llrefer to <EMCLASS="emphasis">internal networks</EM> and <EMCLASS="emphasis">externalnetworks</EM> when describing a firewall, with the understandingthat both networks may in fact be internal to your organization.</P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="PART"HREF="part05.htm"TITLE="V. Advanced Topics"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: V. Advanced Topics"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch21_02.htm"TITLE="21.2 Building Your Own Firewall"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 21.2 Building Your Own Firewall"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">V. Advanced Topics</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">21.2 Building Your Own Firewall</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>