<HTML><HEAD><TITLE>[Chapter 22] 22.3 tcpwrapper</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:17:09Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch22_01.htm"TITLE="22. Wrappers and Proxies"><LINKREL="prev"HREF="ch22_02.htm"TITLE="22.2 sendmail (smap/smapd) Wrapper"><LINKREL="next"HREF="ch22_04.htm"TITLE="22.4 SOCKS"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch22_02.htm"TITLE="22.2 sendmail (smap/smapd) Wrapper"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 22.2 sendmail (smap/smapd) Wrapper"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 22<BR>Wrappers and Proxies</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch22_04.htm"TITLE="22.4 SOCKS"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 22.4 SOCKS"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-22-SECT-3">22.3 tcpwrapper</A></H2><PCLASS="para">The <ICLASS="filename">tcpwrapper</I>program, written by Wietse Venema, is an easy-to-use utility thatyou can use for logging and intercepting <SPANCLASS="acronym">TCP</SPAN>services that are started by <ICLASS="filename">inetd.</I></P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-22-SECT-3.1">22.3.1 Getting tcpwrapper</A></H3><PCLASS="para">The <KBDCLASS="command">tcpwrapper</KBD> programcan be downloaded from the Internet using anonymous <SPANCLASS="acronym">FTP</SPAN>.The path is:</P><PCLASS="para"><ACLASS="systemitem.url"HREF="ftp://ftp.win.tue.nl/pub/security/tcp_wrapper_XXX.tar.gz">ftp://ftp.win.tue.nl/pub/security/tcp_wrapper_XXX.tar.gz</A></P><PCLASS="para">Where <ICLASS="filename">XXX</I> is the current versionnumber. The file that you <SPANCLASS="acronym">FTP</SPAN> will be a <ICLASS="filename">tar</I> archive compressed with <ICLASS="filename">gunzip</I> (oftencalled <ICLASS="filename">gzip</I>). While you are connected to thecomputer <ACLASS="systemitem.ftpserver"HREF="ftp://ftp.win.tue.nl">ftp.win.tue.nl</A>,you might want to pick up Venema's <ICLASS="filename">portmapper</I>replacement.</P><PCLASS="para">Another good place to look for <ICLASS="filename">tcpwrapper</I>is:</P><PCLASS="para"><ACLASS="systemitem.url"HREF="ftp://coast.cs.purdue.edu/pub/tools/tcp_wrappers">ftp://coast.cs.purdue.edu/pub/tools/tcp_wrappers</A></P><PCLASS="para">While you are connected to the <ICLASS="systemitem">coast.cs.purdue.edu</I> machine,you can find scores of other nifty security tools and papers, sodon't connect if you only have a few minutes to spare!</P><PCLASS="para">The tcpwrapper program is shipped standard with only a fewoperating systems such as <SPANCLASS="acronym">BSD/OS</SPAN>. (It is shippedstandard with Linux but is rarely configured properly.) We hopethat this standard will change in the future.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-22-SECT-3.2">22.3.2 What tcpwrapper Does</A></H3><PCLASS="para">The <KBDCLASS="command">tcpwrapper</KBD>program gives the system administrator a high degree of controlover incoming <SPANCLASS="acronym">TCP</SPAN> connections. The program isstarted by <KBDCLASS="command">inetd</KBD> after a remote host connects to your computer;then <KBDCLASS="command">tcpwrapper</KBD> does one or more of the following:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Optionally sends a &quot;banner&quot;to the connecting client. Banners are useful for displaying legalmessages or advisories.</P></LI><LICLASS="listitem"><PCLASS="para">Performs a double-reverse lookup of the IP address,making sure that the <SPANCLASS="acronym">DNS</SPAN>[5] entries for the IP address andhostname match. If they do not, this fact is logged. (By default,<KBDCLASS="command">tcpwrapper</KBD> is compiled with the -<SPANCLASS="acronym">DPARANOID</SPAN> option,so the program will automatically drop the incoming connection ifthe two do not match, under the assumption that something somewhereis being hacked.)</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[5] DomainName Service, the distributed service that maps IP numbers to hostnames,and vice versa.</P></BLOCKQUOTE></LI><LICLASS="listitem"><PCLASS="para">Compares the incoming hostname and requested servicewith an access control list, to see if this host or this combinationof host and service has been explicitly denied. If either is denied,<KBDCLASS="command">tcpwrapper</KBD> drops the connection.</P></LI><LICLASS="listitem"><PCLASS="para">Uses the <ICLASS="filename">ident</I> protocol (<SPANCLASS="acronym">RFC</SPAN>1413)[6] to determine theusername associated with the incoming connection.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[6] RFC 1413 superseded RFC 931, but the <KBDCLASS="command">define</KBD>in the code has not changed.</P></BLOCKQUOTE></LI><LICLASS="listitem"><PCLASS="para">Logs the results with <KBDCLASS="command">syslog</KBD>. (For further information,see Chapter 10, <EMCLASS="emphasis">Auditing and Logging</EM>.)</P></LI><LICLASS="listitem"><PCLASS="para">Optionally runs a command. (For example, you canhave <KBDCLASS="command">tcpwrapper</KBD> run <KBDCLASS="command">finger</KBD>, to get a list of users on a computerthat is trying to contact yours.)</P></LI><LICLASS="listitem"><PCLASS="para">Passes control of the connection to the &quot;real&quot;network daemon, or passes control to some other program that cantake further action.</P></LI><LICLASS="listitem"><PCLASS="para">Transfers to a &quot;jail&quot; or &quot;faux&quot;environment where you study the user's actions.[7]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[7] We won't describe this approach further. It requiressome significant technical sophistication to get right, is of limitedvalue in most environments, and may pose some potentially significantlegal problems. For further information on hacker jails, see <EMCLASS="emphasis">Firewallsand Internet Security</EM> by Bill Cheswick and Steve Bellovin.</P></BLOCKQUOTE></LI></UL><PCLASS="para">The <KBDCLASS="command">tcpwrapper</KBD> thus gives you a way to add logging to servicesthat are not normally logged, such as <KBDCLASS="command">finger</KBD>and <KBDCLASS="command">systat</KBD>. It also allows you to substitutedifferent versions of a service daemon depending on the callinghost&nbsp;- or to reject the connection without providing anyserver at all.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-22-SECT-3.3">22.3.3 Understanding Access Control</A></H3><PCLASS="para">The<KBDCLASS="command">tcpwrapper</KBD> system has a simple but powerful language and a pairof configuration files that allow you to specify whether or notincoming connections should be accepted. The files are <ICLASS="filename">/etc/hosts.allow</I> and <ICLASS="filename"> /etc/hosts.deny</I>. When an incomingconnection is handed to <KBDCLASS="command">tcpwrapper</KBD>, the programapplies the following rules:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">The file <ICLASS="filename">/etc/hosts.allow</I>is searched to see if this (host, protocol) pair should be allowed.</P></LI><LICLASS="listitem"><PCLASS="para">If no match if found, the file <ICLASS="filename">/etc/hosts.deny</I>is searched to see if this (host, protocol) pair should be denied.</P></LI><LICLASS="listitem"><PCLASS="para">If no match is found, the connection is allowed.</P></LI></OL><PCLASS="para">Each line in the <ICLASS="filename">/etc/hosts.allow </I>and<ICLASS="filename">/etc/hosts.deny</I> file has the following format:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">daemon_list : client_host_list [: shell_command]</PRE></BLOCKQUOTE><PCLASS="para">Where:</P><DLCLASS="variablelist"><DTCLASS="term">daemon_list</DT><DDCLASS="listitem"><PCLASS="para">Specifies the command name (<ICLASS="filename">argv[0]</I>)of a list of <SPANCLASS="acronym">TCP</SPAN> daemons (e.g., <KBDCLASS="command">telnetd</KBD>). Thereserved keyword &quot;<SPANCLASS="acronym">ALL</SPAN>&quot; matchesall daemons; you can also use the &quot;<SPANCLASS="acronym">EXCEPT</SPAN>&quot;operator (e.g., &quot;<SPANCLASS="acronym">ALL</SPAN> <SPANCLASS="acronym">EXCEPT</SPAN><ICLASS="filename">in.ftpd&quot;</I>).</P></DD><DTCLASS="term">client_host_list</DT><DDCLASS="listitem"><PCLASS="para">Specifies the hostname or IP address of the incomingconnection. You can also use the format <ICLASS="filename">username@hostname</I>to specify a particular user on a remote computer, although theremote computer must implement the <KBDCLASS="command">ident</KBD> protocol.[8]The keyword <SPANCLASS="acronym">ALL</SPAN> matches all clients; for a fulllist of keywords, see <ACLASS="xref"HREF="ch22_03.htm#PUIS-CHP-22-TAB-1"TITLE=" Special tcpwrapper Hosts">Table 22.1</A>.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[8] And as we noted in the discussion of <KBDCLASS="command">ident</KBD>, the identificationreturned is not something that can always be believed.</P></BLOCKQUOTE></DD><DTCLASS="term">shell_command</DT><DDCLASS="listitem"><PCLASS="para">Specifies a command that should be executed if the<ICLASS="filename">daemon_list</I> and <ICLASS="filename">client_host_list</I> arematched. A limited amount of token expansion is available withinthe shell command; see <ACLASS="xref"HREF="ch22_03.htm#PUIS-CHP-22-TAB-2"TITLE=" Token Expansion Available for the tcpwrapper Shell Command">Table 22.2</A> for a list ofthe tokens that are available.</P></DD></DL><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-22-TAB-1">Table 22.1:  Special tcpwrapper Hosts</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Hostname as it Appears in the File <ICLASS="filename">/etc/hosts.allow</I>or <ICLASS="filename">/etc/hosts.deny</I></P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Has This Effect:</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">ALL</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Matches all hosts.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">KNOWN</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Matches any IP address that has a correspondinghostname; also matches usernames when the <KBDCLASS="command">ident</KBD>service is available.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">LOCAL</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Matches any host that does not have aperiod (.) in its name.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">PARANOID</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Matches any host for which double-reversehostname/IP address translation does not match.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">UNKNOWN</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Matches any IP address that does nothave a corresponding hostname. Also matches usernames when <KBDCLASS="command">ident</KBD>service is not available.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">.subdomain.domain</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">If the hostname begins with a period(.), the hostname will match any host whose hostname ends with thehostname (in this case, &quot;<ICLASS="filename">.subdomain.domain</I>&quot;).</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">iii.iii.jjj.iii.jjj.kkk.iii.jjj.kkk.lll.(e.g.,18. or 204.17.195.)</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">If the hostname ends with a period (.),the hostname is interpreted as the beginning of an IP address. Thestring &quot;18.&quot; will match any host with an IP addresses18.0.0.1 through 18.255.255.254. The string <ICLASS="filename">&quot;204.17.195.&quot;</I>will match any host with an IP addresses 204.17.195.1 through 204.17.195.254.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><EMCLASS="emphasis">a </EM><ICLASS="filename">pattern</I><EMCLASS="emphasis"></EM> EXCEPT <ICLASS="filename">another pattern</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Matches any host that is matched by <EMCLASS="emphasis">apattern</EM> except those that also match <EMCLASS="emphasis">anotherpattern.</EM>[9]</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[9] The EXCEPT operator may also be used for specifyingan Internet service.</P></BLOCKQUOTE><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-22-TAB-2">Table 22.2:  Token Expansion Available for the tcpwrapper Shell Command</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Token</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Mnemonic</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Expands to:</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">%a</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">address</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">The IP address of the client.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">%A</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">address</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">The IP address of the server.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">%c</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">client info</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">username@hostname</I> (if usernameis available); otherwise, only hostname or IP address.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">%d</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">daemon name</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">The name of the daemon (<KBDCLASS="command">argv</KBD>[0]).</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">%h</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">hostname</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">The hostname of the client. (IP addressif hostname is unavailable.)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">%H</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">hostname</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">The hostname of the server. (IP addressif hostname is unavailable.)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">%p</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">process</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">The Process ID of the daemon process.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">%s</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">server info.</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para"><ICLASS="filename">daemon@host.</I></P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">%u</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">user</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">The client username (or unknown)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">%%</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">percent</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Expands to the &quot;%&quot;character.</P></TD></TR></TBODY></TABLE><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> The <KBDCLASS="command">tcpwrapper</KBD> is vulnerable to IP spoofing becauseit uses IP addresses for authentication. The <KBDCLASS="command">tcpwrapper</KBD> also providesonly limited support for <SPANCLASS="acronym">UDP</SPAN> servers, becauseonce the server is launched, it will continue to accept packetsover the network, even if those packets come from &quot;blocked&quot;hosts.</P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-22-SECT-3.4">22.3.4 Installing tcpwrapper</A></H3><PCLASS="para"><KBDCLASS="command">tcpwrapper</KBD> is apowerful program that can seriously mess up your computer if itis not properly installed. It has many configuration options thatare set at compile time. Therefore, before you start compiling orinstalling the program, <EMCLASS="emphasis">read all of the documentation.</EM></P><PCLASS="para">Briefly, here is what the documentation will tell you to do:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">You need to decide where to place the<KBDCLASS="command">tcpwrapper</KBD> program and where to place your &quot;real&quot;network daemons. The documentation will give you a choice. Yourfirst option is to name the <KBDCLASS="command">tcpwrapper</KBD> program something innocuous,like <ICLASS="filename">/usr/local/etc/tcpd,</I> leavethe &quot;real&quot; network daemons in their original locations,and modify the inetd configuration file <ICLASS="filename">/etc/inetd.conf</I>.Alternatively, you can move the network daemons (such as <ICLASS="filename">/usr/sbin/in.fingerd</I>)to another location (such as <ICLASS="filename">/usr/sbin.real/in.fingerd</I>),place the tcpwrapper in the location that the daemon formerly occupied,and leave the file <ICLASS="filename">/etc/inetd.conf</I> as is.</P><PCLASS="para">We recommend that you leave your executable programs wherethey currently are, and modify the <ICLASS="filename">/etc/inetd.conf</I>file. The reason for this recommendation is that having changesin your system configuration clearly indicated in your system configurationfiles is less confusing than changing the names and/orthe locations of your distributed system programs. In the long run,this option is much more maintainable. This is especially importantif vendor patches expect to find the binary where it was originallystored, and overwrite it.</P></LI><LICLASS="listitem"><PCLASS="para">Having followed our advice and decided that youwill modify your <ICLASS="filename">/etc/inetd.conf</I> file, make acopy of the file, in case you make any mistakes later:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <BCLASS="emphasis.bold">cp /etc/inetd.conf /etc/inetd.conf.DIST</B>#</PRE></BLOCKQUOTE></LI><LICLASS="listitem"><PCLASS="para">Edit <KBDCLASS="command">tcpwrapper</KBD>'s <ICLASS="filename">Makefile</I> so that thevariable <ICLASS="filename">REAL_DAEMON_DIR</I> reflects where your operatingsystem places its network daemons. Check the other options in the<ICLASS="filename">Makefile</I> to be sure they are appropriate to your needs.</P></LI><LICLASS="listitem"><PCLASS="para">Compile <KBDCLASS="command">tcpwrapper</KBD>.</P></LI><LICLASS="listitem"><PCLASS="para">Read the <KBDCLASS="command">tcpwrapper</KBD> man pages <ICLASS="filename">host_access</I>and <ICLASS="filename">host_options</I>. These files define the tcpwrapper hostaccess-control language that is used by the files <ICLASS="filename">/etc/hosts.allow</I>and <ICLASS="filename">/etc/hosts.deny.</I></P><PCLASS="para">You may wishto start off with a relatively simple set of rules&nbsp;- forexample, allowing all services to all machines except for a smallgroup that have been known to cause problems. But you may wish toalso enable complete logging, so that you can see if particularservices or sites warrant further attention.</P></LI><LICLASS="listitem"><PCLASS="para">Create your <ICLASS="filename">/etc/hosts.allow </I>and<ICLASS="filename">/etc/hosts.deny</I> files. If you wish to allow all <SPANCLASS="acronym">TCP</SPAN>servers through, you do not need to create these files at all(<KBDCLASS="command">tcpwrapper</KBD> will default to rule #3, which is to pass through all connections).If you wish to deny service from a specific machine, such as <ICLASS="systemitem">pirate.net</I>, you could simplycreate a single /etc/hosts.deny file, like this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">## /etc/hosts.deny#all : pirate.net</PRE></BLOCKQUOTE><PCLASS="para">Alternatively, you could usethe following <ICLASS="filename">/etc/hosts.deny</I>, which would fingerthe computer <ICLASS="systemitem">pirate.net</I>and email the result to you (<ICLASS="filename">security@machine.com</I>), wheneversomebody from that network tries to initiate any connection to yourmachine. Note that this example uses the <ICLASS="filename">safe_finger</I> commandthat comes with <KBDCLASS="command">tcpwrapper</KBD>; this version of the <KBDCLASS="command">finger</KBD> command willremove control characters or other nasty data that might be returnedfrom a <KBDCLASS="command">finger</KBD> server running on a remote machine, as well as limitthe total amount of data received:[10]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[10] The <KBDCLASS="command">safe_finger</KBD>program is a replacement for your system's <KBDCLASS="command">finger</KBD> program,which automatically filters out dangerous characters allowed throughby the standard versions of <ICLASS="filename">finger</I>. If youdon't think that your standard UNIX <KBDCLASS="command">finger</KBD> program shouldallow data-driven attacks, you might wish to send a letter to yourUNIX vendor.</P></BLOCKQUOTE><BLOCKQUOTECLASS="screen"><PRECLASS="screen">## /etc/hosts.deny with more logging!#all EXCEPT in.fingerd : pirate.net : (/usr/local/bin/safe_finger -l @%h | \						/bin/mailx -s %d-%h security@machine.com) &amp;</PRE></BLOCKQUOTE><PCLASS="para">Note that the <ICLASS="filename">/etc/hosts.deny</I> file allowscontinuation lines by using the backslash (\) character.</P><PCLASS="para">The <KBDCLASS="command">finger</KBD> command is run for all services <EMCLASS="emphasis">except</EM><ICLASS="filename">in.fingerd;</I> this restriction prevents a &quot;feedback loop&quot;in which a <KBDCLASS="command">finger</KBD> on one computer triggers a <KBDCLASS="command">finger</KBD> on a secondcomputer, and vice versa. Also note that the <KBDCLASS="command">finger</KBD> command is runin the background; this mode prevents <KBDCLASS="command">tcpwrapper</KBD> from waiting untilthe <ICLASS="filename">safe_finger</I> command completes.</P></LI><LICLASS="listitem"><PCLASS="para">Check out your <ICLASS="filename">/etc/syslog.conf</I>file to make sure that <KBDCLASS="command">tcpwrapper</KBD>'s events will be logged!By default, <KBDCLASS="command">tcpwrapper</KBD> will log with <SPANCLASS="acronym">LOG_ERR</SPAN>if a program cannot be launched, <SPANCLASS="acronym">LOG_WARNING</SPAN>if a connection is rejected, and <SPANCLASS="acronym">LOG_INFO</SPAN> ifa connection is accepted. The logging service is <SPANCLASS="acronym">LOG_MAIL</SPAN>,but you can change it by editing the program's <ICLASS="filename">Makefile</I>.</P></LI><LICLASS="listitem"><PCLASS="para">If you make any changes to the <KBDCLASS="command">syslog</KBD> configurationfile, restart <KBDCLASS="command">syslog</KBD> with the command:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">		# <BCLASS="emphasis.bold">kill -1 `cat /etc/syslog.pid`</B></PRE></BLOCKQUOTE></LI><LICLASS="listitem"><PCLASS="para">Edit your <ICLASS="filename">/etc/inetd.conf</I> fileso that the <KBDCLASS="command">tcpwrapper</KBD> program is invoked by <KBDCLASS="command">inetd</KBD> for each servicethat you wish to log and control.</P><PCLASS="para">Modifying the <ICLASS="filename">/etc/inetd.conf</I>file is easy: simply change the filename of each program to thefull pathname of the <KBDCLASS="command">tcpwrapper</KBD> program, and edit the command nameof each program so that it is the complete pathname of the originalnetwork daemon.</P><PCLASS="para">For example, if you have a line in youroriginal <ICLASS="filename">/etc/inetd.conf</I> file that says this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">finger   stream tcp nowait nobody /usr/etc/fingerd fingerd</PRE></BLOCKQUOTE><PCLASS="para">Change it to this:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">finger  stream tcp nowait nobody /usr/local/bin/tcpd /usr/etc/fingerd</PRE></BLOCKQUOTE><PCLASS="para">Youmay need to send a signal to the <KBDCLASS="command">inetd</KBD> daemon, or restart it, toget it to note the new configuration you have added.</P></LI><LICLASS="listitem"><PCLASS="para">Test to make sure that everything works! For example,try doing a <KBDCLASS="command">finger</KBD> of your computer; does a message get writteninto your system's log files? If not, check to make surethat <KBDCLASS="command">inetd</KBD> is starting the <KBDCLASS="command">tcpwrapper</KBD>, that <KBDCLASS="command">tcpwrapper</KBD> can accessits configuration files, and that the <KBDCLASS="command">syslog</KBD> system is set up todo something with <KBDCLASS="command">tcpwrapper</KBD>'s messages.</P></LI></OL></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-22-SECT-3.5">22.3.5 Advanced tcpwrapper Options</A></H3><PCLASS="para">Instead ofspecifying a particular shell command that should be executed whena (daemon, host) line is matched, <KBDCLASS="command">tcpwrapper</KBD> allows you to specifya rich set of options. To use options, you compile the <KBDCLASS="command">tcpwrapper</KBD>program with the option -<SPANCLASS="acronym">DPROCESS_OPTIONS</SPAN>. Ifyou compile with -<SPANCLASS="acronym">DPROCESS_OPTIONS</SPAN>, you mustchange the files <ICLASS="filename">/etc/hosts.allow</I> and <ICLASS="filename">/etc/hosts.deny</I>files to reflect that change; the format of these files when <KBDCLASS="command">tcpwrapper</KBD>is compiled with -<SPANCLASS="acronym">DPROCESS_OPTIONS</SPAN> is incompatiblewith the format of the files when tcpwrapper is compiled withoutthe options.</P><PCLASS="para">If you do compile with -<SPANCLASS="acronym">DPROCESS_OPTIONS</SPAN>,the new format of the <ICLASS="filename">/etc/hosts.allow</I> and <ICLASS="filename">/etc/hosts.deny</I>becomes:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">daemon_list : client_host_list : option : option ...</PRE></BLOCKQUOTE><PCLASS="para">Because you may havemore than one option on a line, if you need to place a colon (:)within the option, you must protect it with a backslash (\).</P><PCLASS="para">The options allow you considerable flexibility in handlinga variety of conditions. They also somewhat obsolete the need tohave separate <ICLASS="filename">/etc/hosts.allow</I> and <ICLASS="filename">/etc/hosts.deny</I>files, as the words &quot;allow&quot; and &quot;deny&quot;are now option keywords (making it possible to deny a specific pair(daemon, client) in the /etc/hosts.allow file,or vice versa). Although you should check <KBDCLASS="command">tcpwrapper</KBD>'sdocumentation for a current list of options, most of them are includedin <ACLASS="xref"HREF="ch22_03.htm#PUIS-CHP-22-TAB-3"TITLE="Advanced Options for tcpwrapper When Compiled with -DPROCESS_OPTIONS">Table 22.3</A></P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="PUIS-CHP-22-TAB-3">Table 22.3: Advanced Options for tcpwrapper When Compiled with -DPROCESS_OPTIONS</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Option</P></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Effect</P></TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">allow</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Allows the connection.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">deny</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Denies the connection.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="2"><PCLASS="para">Options for dealing with sub-shells:</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">nice <EMCLASS="emphasis">nn</EM></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Changes the priority of the process to<EMCLASS="emphasis">nn</EM>. Use numbers such as +4 or +8to reduce the amount of CPU time allocated to network services.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">setenv <EMCLASS="emphasis">name value</EM></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Sets the environment variable <EMCLASS="emphasis">name</EM> to <EMCLASS="emphasis">value</EM> for the daemon<EMCLASS="emphasis">.</EM></P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">spawn <EMCLASS="emphasis">shell_command</EM></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Runs the <EMCLASS="emphasis">shell_command. </EM>Thestreams <KBDCLASS="command">stdin</KBD>, <KBDCLASS="command">stdout</KBD>, and <KBDCLASS="command">stderr</KBD> are connected to <ICLASS="filename">/dev/null</I>to avoid conflict with any communications with the client.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">twist <EMCLASS="emphasis">shell_command</EM></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Runs the <EMCLASS="emphasis">shell_command. </EM>Thestreams <KBDCLASS="command">stdin</KBD>, <KBDCLASS="command">stdout</KBD>, and <KBDCLASS="command">stderr</KBD> are connected to the remote client.This allows you to run a server process other than the one specifiedin the file <ICLASS="filename">/etc/inetd.conf.</I> (Note: Will not workwith some UDP services.)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">umask <ICLASS="filename">nnn</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Specifies the umask that should be usedfor sub-shells. Specify it in octal.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">user <EMCLASS="emphasis">username</EM></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Assume the privileges of <EMCLASS="emphasis">username.</EM>(Note: <KBDCLASS="command">tcpwrapper</KBD> must be running as root for this option to work.)</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">user <EMCLASS="emphasis">username.groupname</EM></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Assume the privileges of <EMCLASS="emphasis">username</EM>and set the current group to be <EMCLASS="emphasis">groupname.</EM></P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="2"><PCLASS="para">Options for dealing with the network connection:</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">banners <ICLASS="filename">/some/directory/</I></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Specifies a directory that contains bannerfiles. If a filename is found in the banner directory that has thesame name as the network server (such as <ICLASS="filename">telnetd</I>),the contents of the banner file are sent to the client before theTCP connection is turned over to the server. This process allowsyou to send clients messages, for example, informing them that unauthorizeduse of your computer is prohibited.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">keepalive</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Causes the <SPANCLASS="acronym">UNIX</SPAN> kernelto periodically send a message to a  client process; if the messagecannot be sent, the connection is automatically broken.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">linger <EMCLASS="emphasis">seconds</EM></P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Specifies how long the <SPANCLASS="acronym">UNIX</SPAN>kernel should spend trying to send a message to the remote clientafter the server closes the connection.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">rfc931 [<EMCLASS="emphasis">timeout inseconds</EM>]</P></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Specifies that the <KBDCLASS="command">ident</KBD> protocol shouldbe used to attempt to determine the username of the person runningthe client program on the remote computer. The <EMCLASS="emphasis">timeout</EM>,if specified, is the number of seconds that <KBDCLASS="command">tcpwrapper</KBD> should spendwaiting for this information.</P></TD></TR></TBODY></TABLE><PCLASS="para">.</P><PCLASS="para">Don't be afraid ofusing these so-called &quot;advanced&quot; options: theyactually allow you to have simpler configurations than the <ICLASS="filename">/etc/hosts.allow</I>and <ICLASS="filename">/etc/hosts.deny</I> files.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> The following examples use <SPANCLASS="acronym">DNS</SPAN> hostnamesfor clarity. For added security, use IP addresses instead.</P></BLOCKQUOTE><PCLASS="para">Suppose you wish to allow all connections to your computer,except those from the computers in the domain <ICLASS="systemitem">pirate.net</I>, with this very simple<ICLASS="filename">/etc/hosts.allow</I> file; specify:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">## /etc/hosts.allow:## Allow anybody to connect to our machine except people from pirate.net#all : .pirate.net : denyall : all         : allow</PRE></BLOCKQUOTE><PCLASS="para">Suppose you wish to modify your rules to allow the use of<KBDCLASS="command">finger</KBD> from any of your internal machines, but you wish to haveexternal <KBDCLASS="command">finger</KBD> requests met with a canned message. You might trythis configuration file:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">## /etc/hosts.allow:## Allow anybody to connect to our machine except people from pirate.net##in.fingerd : LOCAL : allowin.fingerd : all : twist /usr/local/bin/external_fingerd_messageall : .pirate.net : denyall : all : allow</PRE></BLOCKQUOTE><PCLASS="para">If you discover repeated break-in attempts through <KBDCLASS="command">telnet</KBD>and <KBDCLASS="command">rlogin</KBD> from all over the world, but you havea particular user who needs to <ICLASS="filename">telnet</I> intoyour computer from the host <ICLASS="systemitem">sleepy.com</I>,you could accomplish this somewhat more complex security requirementwith the following configuration file:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">## /etc/hosts.allow:## Allow email from pirate.net, but nothing else:# Allow telnet &amp; rlogin from sleepy.com, but nowhere else#telnetd,rlogind : sleepy.com : allowtelnetd,rlogind : all : denyin.fingerd : LOCAL : allowin.fingerd : all : twist /usr/local/bin/external_fingerd_messageall : .pirate.net : denyall : all : allow</PRE></BLOCKQUOTE><PCLASS="para">Here's an example that combines two possible options:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">## /etc/hosts.deny:## Don't allow logins from pirate.net, and log attempts#telnetd,rlogind : pirate.net : spawn=(/security/logit %d deny %c %p %a %h %u)&amp;\  	: linger 10 : banners /security/banners</PRE></BLOCKQUOTE><PCLASS="para">In the file <ICLASS="filename">/security/banners/telnetd,</I>you would have the following text:</P><BLOCKQUOTECLASS="blockquote"><PCLASS="para">This machine is owned and operated by the BigWhammix Corporation for the exclusive use of Big Whammix Corporationemployees. Your attempt to access this machine is not allowed.</P><PCLASS="para">Access to Big Whammix Corporation computers is logged andmonitored. If you use or attempt to use a Big Whammix computer system,you consent to such monitoring and to adhere to Big Whammix Corporationpolicies about appropriate use. If you do not agree, then do notattempt use of these systems. Unauthorized use of Big Whammix Corporationcomputers may be in violation of state or Federal law, and willbe prosecuted.</P><PCLASS="para">If you have any questions about thismessage or policy, contact  &lt;security@bwammix.com&gt;or call during EST business hours: 1-800-555-3662.</P></BLOCKQUOTE><PCLASS="para">The banner will be displayed if anyone from <ICLASS="systemitem">pirate.net</I> tries to log in overthe net. The system will pause 10 seconds for the message to befully displayed before disconnecting.</P><PCLASS="para">In the <ICLASS="filename">/security/logit</I> shell file, you could have something similar to the scriptin <ACLASS="xref"HREF="ch22_03.htm#PUIS-CHP-22-EX-1"TITLE="alert Script">Example 22.1</A>. Thisscript puts an entry into the <KBDCLASS="command">syslog</KBD> about the event, and attemptsto raise a very visible alert window on the screen of the securityadministrator's workstation. Furthermore, it does a reverse<KBDCLASS="command">finger</KBD> on the calling host, and for good measure does a <KBDCLASS="command">netstat</KBD>and <KBDCLASS="command">ps</KBD> on the local machine. This process isdone in the event that some mischief is already occurring that hasn'ttriggered an alarm.</P><PCLASS="para">Note the -n option to the <KBDCLASS="command">netstat</KBD>command in the script. This is because <SPANCLASS="acronym">DNS</SPAN> canbe slow to resolve all the IP numbers to names. You want the commandto complete before the connection is dropped; it is always possibleto look the hostnames up later from the log file.</P><DIVCLASS="example"><H4CLASS="example"><ACLASS="title"NAME="PUIS-CHP-22-EX-1">Example 22.1: alert Script</A></H4><PRECLASS="programlisting">#!/bin/kshset -o nolog -u -h +a +o bgnice +e -m#  Bmon is intended to capture some information about whatever site is#  twisting my doorknob. It is probably higher overhead than I need,#  but...export PATH=/usr/ucb:/usr/bin:/bin:/usr/etc:/etcmkdir /tmp/root# Create /tmp/root in case it doesn't exist.print &quot;Subject: Notice\nFrom: operator\n\n$@&quot; | /usr/lib/sendmail securitytypeset daemon=&quot;$1&quot; status=&quot;$2&quot; client=&quot;$3&quot; pid=$4 addr=$5 host=$6 user=$7# For most things, we simply want a notice.# Unsuccessful attempts are warnings# Unsuccessful attempts on special accounts merit an alerttypeset level=notice[[ $status != allow ]] &amp;&amp; level=warning[[ $daemon = in.@(rshd|rlogind) &amp;&amp; $user = @(root|security) ]] &amp;&amp; level=alert/usr/ucb/logger -t tcpd -p auth.$level &quot;$*&quot; &amp;umask 037function mktemp {    typeset temp=/security/log.$$    typeset -Z3 suffix=0    while [[ -a $temp.$suffix ]]    do    let suffix+=1    done    logfile=$temp.$suffix    chgrp security $logfile}function Indent {    sed -e 's/^//' &gt;&gt; $logfile}exec 3&gt;&amp;1 &gt;&gt;$logfile 2&gt;&amp;1dateprint &quot;Remote host: $host   Remote user: $user&quot;print &quot;&quot;print &quot;Local processes:&quot;ps axg | Indentprint &quot;&quot;print &quot;Local network connections:&quot;netstat -n -a -f inet | Indentprint &quot;&quot;print &quot;Finger of $host&quot;safe_finger -s @$host|Indentprint &quot;&quot;[[ $user != unknown ]] &amp;&amp; safe_finger -h -p -m $user@$host | Indentexec &gt;&gt; /netc/log/$daemon.log 2&gt;&amp;1print &quot;-----------------------&quot;print &quot;\npid=$pid client=$client addr=$addr user=$user&quot;print Details in $logfiledateprint &quot;&quot;# Now bring up an alert box on the admin's workstation{  print &quot;\ndaemon=$daemon client=$client addr=$addr user=$user&quot;  print Details in $logfile  date  print &quot;&quot;  print -n &quot;(press return to close window.)&quot; &gt;&gt; /tmp/root/alert.$$ } &gt; /tmp/root/alert.$$integer lines=$(wc -l &lt; /tmp/root/alert.$$ | tr -d ' ')xterm -display security:0  -fg white -bg red -fn 9x15 -T &quot;ALERT&quot; -fn 9x15B\   -geom 60x$lines+20+20 -e sh -c &quot;cat /tmp/root/alert.$$;read nothing&quot;/bin/rm /tmp/root/alert.$$</PRE></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-22-SECT-3.6">22.3.6 Making Sense of Your tcpwrapper Configuration Files</A></H3><PCLASS="para">The configuration files we have shown earlier aresimple; unfortunately, sometimes things get complicated. The <KBDCLASS="command">tcpwrapper</KBD>system comes with a utility called <KBDCLASS="command">tcpdchk</KBD> thatwill scan through your configuration file and report on a wide varietyof potential configuration errors.</P><PCLASS="para">The <KBDCLASS="command">tcpwrapper</KBD> systemcomes with another utility program called <KBDCLASS="command">tcpdmatch</KBD>,which allows you to simulate an incoming connection and determineif the connection would be permitted or blocked with your currentconfiguration files.</P><PCLASS="para">Programs like <KBDCLASS="command">tcpdchk</KBD>and <KBDCLASS="command">tcpdmatch</KBD> are excellent complements to thesecurity program <KBDCLASS="command">tcpwrapper</KBD>, because they help you head off securityproblems before they happen. Wietse Venema is to be complimentedfor thinking to write and include them in his <KBDCLASS="command">tcpwrapper</KBD> release;other programmers should follow his example.</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch22_02.htm"TITLE="22.2 sendmail (smap/smapd) Wrapper"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 22.2 sendmail (smap/smapd) Wrapper"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch22_04.htm"TITLE="22.4 SOCKS"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 22.4 SOCKS"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">22.2 sendmail (smap/smapd) Wrapper</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">22.4 SOCKS</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>