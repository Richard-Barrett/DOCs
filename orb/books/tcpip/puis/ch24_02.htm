<HTML><HEAD><TITLE>[Chapter 24] 24.2 Discovering an Intruder</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:18:42Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch24_01.htm"TITLE="24. Discovering a  Break-in"><LINKREL="prev"HREF="ch24_01.htm"TITLE="24.1 Prelude"><LINKREL="next"HREF="ch24_03.htm"TITLE="24.3 The Log Files: Discovering an Intruder's Tracks"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_01.htm"TITLE="24.1 Prelude"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.1 Prelude"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 24<BR>Discovering a  Break-in</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_03.htm"TITLE="24.3 The Log Files: Discovering an Intruder's Tracks"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.3 The Log Files: Discovering an Intruder's Tracks"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-24-SECT-2">24.2 Discovering an Intruder</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-33223"></A><ACLASS="indexterm"NAME="AUTOID-33226"></A><ACLASS="indexterm"NAME="AUTOID-33229"></A>There are severalways you might discover a break-in:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Catching the perpetrator in the act.For example, you might see the superuser logged in from a dial-upterminal when you are the only person who should know the superuserpassword.</P></LI><LICLASS="listitem"><PCLASS="para">Deducing that a break-in has taken place based onchanges that have been made to the system. For example, you mightreceive an electronic mail message from an attacker taunting youabout a security hole, or you may discover new account entries inyour <ICLASS="filename">/etc/passwd</I> file.</P></LI><LICLASS="listitem"><PCLASS="para">Receiving a message from a system administratorat another site indicating strange activity at his or her site thathas originated from an account on your machine.</P></LI><LICLASS="listitem"><PCLASS="para">Strange activities on the system, such as systemcrashes, significant hard disk activity, unexplained reboots, minoraccounting discrepancies,[1]or sluggish response when it is not expected (Crack may be runningon the system).</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] See Cliff Stoll'sThe <ICLASS="filename">Cuckoo's Egg</I> for the tale of how such a discrepancyled to his discovery of a hacker's activities.</P></BLOCKQUOTE></LI></UL><PCLASS="para">There are a variety of commands that you can use to discovera break-in, and some excellent packages, such as Tiger and Tripwire,described elsewhere in this book. Issue these commands on a regularbasis, but execute them sporadically as well. This introduces afactor of randomness that can make perpetrators unable to covertheir tracks. This principle is a standard of <ICLASS="firstterm">operationssecurity</I>: try to be unpredictable.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-24-SECT-2.1">24.2.1 Catching One in the Act</A></H3><PCLASS="para">The easiest way to catch an intruder is by looking for eventsthat are out of the ordinary. For example:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">A user who is logged in more thanonce. (Many window systems register a separate login for each windowthat is opened by a user, but it is usually considered odd for thesame user to be logged in on two separate dial-in lines at the sametime.)</P></LI><LICLASS="listitem"><PCLASS="para">A user who is not a programmer but who is neverthelessrunning a compiler or debugger.</P></LI><LICLASS="listitem"><PCLASS="para">A user who is making heavy and uncharacteristicuse of the network.</P></LI><LICLASS="listitem"><PCLASS="para">A user who is initiating many dialout calls.</P></LI><LICLASS="listitem"><PCLASS="para">A user who does not own a modem logged into thecomputer over a dial-in line.</P></LI><LICLASS="listitem"><PCLASS="para">A person who is executing commands as the superuser.</P></LI><LICLASS="listitem"><PCLASS="para">Network connections from previously unknown machines,or from sites that shouldn't be contacting yours for anyreason.</P></LI><LICLASS="listitem"><PCLASS="para">A user who is logged in while on vacation or outsideof normal working hours (e.g., a secretary dialed in by phone at1:00 a.m. or a computer science graduate student working at 9:00&nbsp;a.m.).</P></LI></UL><PCLASS="para"><SPANCLASS="acronym">UNIX</SPAN> provides a number of commands to helpyou figure out who is doing what on your system. The <ACLASS="indexterm"NAME="AUTOID-33269"></A><ACLASS="indexterm"NAME="AUTOID-33271"></A><ACLASS="indexterm"NAME="AUTOID-33273"></A><ACLASS="indexterm"NAME="AUTOID-33275"></A><ACLASS="indexterm"NAME="AUTOID-33277"></A><ACLASS="indexterm"NAME="AUTOID-33279"></A><ACLASS="indexterm"NAME="AUTOID-33281"></A><KBDCLASS="command">finger, users, whodo, w,</KBD> and who commands alldisplay lists of the users who are currently logged in. The <KBDCLASS="command">ps</KBD> and<KBDCLASS="command">w</KBD> commands help you determine what any user is doing at any giventime; <KBDCLASS="command">ps</KBD> displays a more comprehensive report, and <KBDCLASS="command">w</KBD> displays aneasy-to-read summary. The <KBDCLASS="command">netstat</KBD> command can be used to check oncurrent network connections and activity.</P><PCLASS="para">If you are a system administrator, you should be in the habitof issuing these commands frequently to monitor user activity. Aftera while, you will begin to associate certain users with certaincommands. Then, when something out of the ordinary happens, youwill have cause to take a closer look.</P><PCLASS="para">Be aware, however, that all of these commands can be &quot;fooled&quot;by computer intruders with sufficient expertise. For example, <KBDCLASS="command">w</KBD>,<KBDCLASS="command">users</KBD>, and <KBDCLASS="command">finger</KBD> all check the <ACLASS="indexterm"NAME="AUTOID-33294"></A><ACLASS="indexterm"NAME="AUTOID-33297"></A><ICLASS="filename">/etc/utmp</I>file to determine who is currently logged in to the computer. Ifan intruder erases or changes his entry in this file, these commandswill not report the intruder's presence. Also, some systemsfail to update this file, and some window systems do not properlyupdate it with new entries, so even when the file is protected,it may not have accurate information.</P><PCLASS="para">As the <KBDCLASS="command">ps</KBD> command actually examines the kernel'sprocess table, it is more resistant to subversion than the commandsthat examine the <ICLASS="filename">/etc/utmp</I> file. However, an intruderwho also has attained superuser access on your system can modifythe <KBDCLASS="command">ps</KBD> command or the code in the system calls it uses so that itwon't print his or her processes. Furthermore, any processcan modify its <KBDCLASS="command">argv</KBD> arguments, allowing it to display whatever itwishes in the output of the <KBDCLASS="command">ps</KBD> command. If you don't believewhat these commands are printing, you might be right!</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-24-SECT-2.2">24.2.2 What to Do When You Catch Somebody</A></H3><PCLASS="para">You have a number of choices when you discover an intruderon your system:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">Ignore them.</P></LI><LICLASS="listitem"><PCLASS="para">Try to contact them with <KBDCLASS="command">write</KBD> or <KBDCLASS="command">talk</KBD>, and askthem what they want.</P></LI><LICLASS="listitem"><PCLASS="para">Try to trace the connection and identify the intruder.</P></LI><LICLASS="listitem"><PCLASS="para">Break their connection by killing their processes,unplugging the modem or network, or turning off your computer.</P></LI><LICLASS="listitem"><PCLASS="para">Contact a <SPANCLASS="acronym">FIRST</SPAN> (Forum of IncidentResponse and Security Teams) team (e.g., the <SPANCLASS="acronym">CERT</SPAN>-CC[2]) to notify them of the attack.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] See <ACLASS="xref"HREF="appf_01.htm"TITLE="Organizations">Appendix F, <CITECLASS="appendix">Organizations</CITE></A>, for a complete list ofFIRST teams.</P></BLOCKQUOTE></LI></OL><PCLASS="para">What you do is your choice. If you are most inclined towardsoption #1, you probably should reread <ACLASS="xref"HREF="ch01_01.htm"TITLE="Introduction">Chapter 1, <CITECLASS="chapter">Introduction</CITE></A>, and <ACLASS="xref"HREF="ch02_01.htm"TITLE="Policies and Guidelines">Chapter 2, <CITECLASS="chapter">Policies and Guidelines</CITE></A>, . Ignoring an intruder who is on your systemessentially gives him or her free reign to do harm to you, yourusers, or others on the network.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-33331"></A><ACLASS="indexterm"NAME="AUTOID-33334"></A>If youchoose option #2, keep a log of everything the intrudersends back to you, then decide whether to pursue one of the otheroptions. Options #3 and #4 are discussed in thesections &quot;Tracing a Connection&quot; and &quot;GettingRid of the Intruder&quot; that follow.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> Some intruders are either malicious in intent,or extremely paranoid about being caught. If you contact them, theymay react by trying to delete everything on disk so as to hide theiractivities. If you try to contact an intruder who turns out to beone of these types, be certain you have a set of extremely currentbackups!</P></BLOCKQUOTE><PCLASS="para">If the intruder is logged into your computer over the network,you may wish to trace the connection first, because it is usuallymuch easier to trace an active network connection than one thathas been disconnected.</P><PCLASS="para">After the trace, you may wish to try to communicate with theintruder using the <KBDCLASS="command">write</KBD> or <KBDCLASS="command">talk</KBD> programs. If the intruder is connectedto your computer by a physical terminal, you may wish to walk overto that terminal and confront the person directly (then again, youmight not!).</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> Avoid using <KBDCLASS="command">mail</KBD> or <KBDCLASS="command">talk</KBD> to contact the remote siteif you are trying to trace the connection without tipping off theintruder, because the remote root account on the remote site maybe compromised. Try to use the telephone, if at all possible, beforesending email. If you must send a message, send something innocuous,such as &quot;could you please give me a call: we are havingproblems with your mailer.&quot; Of course, if somebody callsyou, verify who they are.</P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-24-SECT-2.3">24.2.3 Monitoring the Intruder</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-33349"></A>You may wish tomonitor the intruder's actions to figure out what he isdoing. This will give you an idea if he is modifying your accountingdatabase, or simply rummaging around through your users'email.</P><PCLASS="para">There are a variety of means that you can use for monitoringthe intruder's actions. The simplest way is to use programssuch as <KBDCLASS="command">ps</KBD> or <KBDCLASS="command">lastcomm</KBD> to see which processes the intruder is using.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-33356"></A><ACLASS="indexterm"NAME="AUTOID-33359"></A>Dependingon your operating system, you may be able to monitor the intruder'skeystrokes using programs such as <ACLASS="indexterm"NAME="AUTOID-33362"></A><ACLASS="indexterm"NAME="AUTOID-33364"></A><KBDCLASS="command">ttywatch</KBD> or <KBDCLASS="command">snoop</KBD>. These commands can give youa detailed, packet-by-packet account of information sent over anetwork. They can also give you a detailed view of what an intruderis doing. For example:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># snoopasy8.vineyard.net -&gt; next         SMTP C port=1974 asy8.vineyard.net -&gt; next         SMTP C port=1974 MAIL FROM:&lt;dfddf@vin        next -&gt; asy8.vineyard.net SMTP R port=1974 250 &lt;dfddf@vineyard.asy8.vineyard.net -&gt; next         SMTP C port=1974 asy8.vineyard.net -&gt; next         SMTP C port=1974 RCPT TO:&lt;vdsalaw@ix.        next -&gt; asy8.vineyard.net SMTP R port=1974 250 &lt;vdsalaw@ix.netcasy8.vineyard.net -&gt; next         SMTP C port=1974 asy8.vineyard.net -&gt; next         SMTP C port=1974 DATA\r\n        next -&gt; asy8.vineyard.net SMTP R port=1974 354 Enter mail, end </PRE></BLOCKQUOTE><PCLASS="para">In this case, an email message was intercepted as it was sentfrom <ICLASS="systemitem">asy8.vineyard.net</I>to the computer <ICLASS="systemitem">next</I>.As the above example shows, these utilities will give you a detailedview of what people on your system are doing, and they have a greatpotential for abuse.</P><PCLASS="para">You should be careful with the tools that you install on yoursystem, as these tools can be used against you, to monitor yourmonitoring. Also, consider using tools such as <KBDCLASS="command">snoop</KBD> on anothermachine (not the one that has been compromised). Doing so lessensthe chance of being discovered by the intruder.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-24-SECT-2.4">24.2.4 Tracing a Connection</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-33377"></A><ACLASS="indexterm"NAME="AUTOID-33379"></A><ACLASS="indexterm"NAME="AUTOID-33382"></A>The <KBDCLASS="command">ps</KBD>, <KBDCLASS="command">w</KBD>, and <KBDCLASS="command">who</KBD> commandsall report the terminals to which each user (or each process) isattached. Terminal names like <ICLASS="systemitem">/dev/tty01</I>may be abbreviated to <ICLASS="systemitem">tty01 </I>oreven to <ICLASS="systemitem">01</I>. Generally,names like<ICLASS="systemitem"> tty01</I>, <ICLASS="systemitem">ttya</I>, or <ICLASS="systemitem">tty4a</I> represent physical seriallines, while names that contain the letters <ICLASS="systemitem">p</I>, <ICLASS="systemitem">q</I>,or <ICLASS="systemitem">r</I> (such as <ICLASS="systemitem">ttyp1</I>) refer to network connections(virtual ttys, also called pseudo-terminals or ptys).</P><PCLASS="para">If the intruder has called your computer by telephone, youmay be out of luck. In general, telephone calls can be traced onlyby prior arrangement with the telephone company. However, many telephonecompanies offer special features such as <ACLASS="indexterm"NAME="AUTOID-33399"></A><ACLASS="indexterm"NAME="AUTOID-33401"></A><ACLASS="indexterm"NAME="AUTOID-33403"></A><SPANCLASS="acronym">CALL</SPAN>*<SPANCLASS="acronym">TRACE</SPAN>and <SPANCLASS="acronym">CALLER</SPAN>*ID (<SPANCLASS="acronym">CNID</SPAN>),which can be used with modem calls as easily as with voice calls.If you have already set up the service and installed the appropriatehardware, all you need to do is activate it. Then you can read theresults.</P><PCLASS="para">If the intruder is logged in over the network, you can usethe <KBDCLASS="command">who</KBD> command to determine quickly the name of the computer thatthe person may have used to originate the connection. Simply type<ACLASS="indexterm"NAME="AUTOID-33411"></A><KBDCLASS="command">who</KBD>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <BCLASS="emphasis.bold">who </B>orpheus &nbsp;console&nbsp; Jul 16 16:01 root&nbsp;&nbsp;&nbsp;&nbsp; tty01 &nbsp;&nbsp;&nbsp;Jul 15 20:32 jason&nbsp;&nbsp;&nbsp; ttyp1 &nbsp;&nbsp;&nbsp;Jul 16 18:43 (robot.ocp.com) devon&nbsp;&nbsp;&nbsp; ttyp2 &nbsp;&nbsp;&nbsp;Jul 16 04:33 (next.cambridge.m) %</PRE></BLOCKQUOTE><PCLASS="para">In this example, the user <ICLASS="systemitem.username">orpheus</I> is logged in at the console,user <ICLASS="filename">root</I> is logged on at <ICLASS="systemitem">tty01</I>(a terminal connected by a serial line), and <ICLASS="systemitem.username">jason</I> and <ICLASS="systemitem.username">devon</I> areboth logged in over the network: <ICLASS="systemitem.username">jason</I> from <ICLASS="filename">robot.ocp.com</I>, and <ICLASS="systemitem.username">devon</I> from<ICLASS="filename">next.cambridge.ma.us</I>.</P><PCLASS="para">Some versions of the <KBDCLASS="command">who</KBD> command display only the first 16letters of the hostname of the computer that originated the connection.(The machine name is stored in a 16-byte field in <ACLASS="indexterm"NAME="AUTOID-33428"></A><ACLASS="indexterm"NAME="AUTOID-33431"></A><ICLASS="filename">/etc/utmp;</I>some versions of <SPANCLASS="acronym">UNIX</SPAN> store more letters.) Tosee the complete hostname, you may need to use the <ACLASS="indexterm"NAME="AUTOID-33435"></A><KBDCLASS="command">netstat</KBD> command (described in <ACLASS="xref"HREF="ch16_01.htm"TITLE="TCP/IP Networks">Chapter 16, <CITECLASS="chapter">TCP/IP Networks</CITE></A>). You will also have to use <KBDCLASS="command">netstat</KBD> if the intruderhas deleted or modified the <ICLASS="filename">/etc/utmp</I> file tohide his presence. Unfortunately, netstat does not reveal whichnetwork connection is associated with which user. (Of course, ifyou have the first 16 characters of the hostname, you should beable to figure out which is which, even if <ICLASS="filename">/etc/utmp</I>has been deleted. You can still use <KBDCLASS="command">netstat</KBD> and look for connectionsfrom unfamiliar machines.) Luckily, most modern versions of <SPANCLASS="acronym">UNIX</SPAN>,including <SPANCLASS="acronym">SVR4</SPAN>, report the entire machine name.</P><PCLASS="para">Let's say that in this example we suspect Jason isan intruder, because we know that the real Jason is at a yoga retreatin Tibet (with no terminals around). Using <KBDCLASS="command">who</KBD> and <KBDCLASS="command">netstat</KBD>, we determinethat the intruder who has appropriated Jason's accountis logged in remotely from the computer<ICLASS="systemitem">robot.ocp.com</I>. We can now use the <KBDCLASS="command">finger</KBD> command tosee which users are logged onto that remote computer:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <BCLASS="emphasis.bold">finger @robot.ocp.com </B>[robot.ocp.com] Login &nbsp;&nbsp;&nbsp;&nbsp;Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TTY Idle &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;When olivia&nbsp;&nbsp;&nbsp; Dr. Olivia Layson &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;co &nbsp;12d &nbsp;&nbsp;Sun 11:59 wonder&nbsp;&nbsp;&nbsp; Wonder Hacker &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sun 14:33  %</PRE></BLOCKQUOTE><PCLASS="para">Of course, this method doesn't pin the attacker down,because the intruder may be using the remote machine only as a relaypoint. Indeed, in the above example, <ICLASS="filename">Wonder Hacker</I> is logged into<ICLASS="systemitem">ttyp1</I>, which is anothervirtual terminal. He's probably coming from another machine,and simply using <ICLASS="systemitem">robot.ocp.com</I>as a relay point. You would probably not see a username like <ICLASS="filename">WonderHacker.</I> More likely, you would only see an assorted list of apparentlylegitimate users and have to guess who the attacker is. Even ifyou did see a listing such as that, you can't assume anythingabout who is involved. For instance, Dr. Layson could be conductingindustrial espionage on your system, using a virtual terminal (e.g.,<ICLASS="filename">xterm</I>) that is not listed as a logged in session!</P><PCLASS="para">If you have an account on the remote computer, log into itand find out who is running the <KBDCLASS="command">rlogin</KBD> or <KBDCLASS="command">telnet</KBD> command that iscoming into your computer. In any event, consider contacting thesystem administrator of that remote computer and alert him or herto the problem.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-24-SECT-2.4.1">24.2.4.1 Other tip-offs</A></H4><PCLASS="para">There are many other tip-offs that an intruder might be loggedonto your system. For example, you may discover that shells arerunning on terminals that no one seems to be logged into at themoment. You may discover open network connections to machines youdo not recognize. Running processes may be reported by some programsbut not others.</P><PCLASS="para">Be suspicious and nosy.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="PUIS-CHP-24-SECT-2.4.2">24.2.4.2 How to contact the system administrator of a computeryou don't know</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-33468"></A><ACLASS="indexterm"NAME="AUTOID-33471"></A>Often, you can't figure outthe name and telephone number of the system administrator of a remotemachine, because <SPANCLASS="acronym">UNIX</SPAN> provides no formal mechanismfor identifying such people.</P><PCLASS="para">One good way is to contact the appropriate incident responseteam for the designated security person at the organization. Anotherway to find out the telephone number and email address of the remoteadministrator is to use the <ACLASS="indexterm"NAME="AUTOID-33476"></A><KBDCLASS="command">whois</KBD>command to search the <ACLASS="indexterm"NAME="AUTOID-33479"></A><ACLASS="indexterm"NAME="AUTOID-33481"></A>Network Information Center(<SPANCLASS="acronym">NIC</SPAN>) registration database. If your system doesnot have a <KBDCLASS="command">whois</KBD> command, you can simply <ICLASS="filename">telnet</I>to the <SPANCLASS="acronym">NIC</SPAN> site. Below is an example of how tofind the name and phone number of a particular site administrator.</P><PCLASS="para">The <SPANCLASS="acronym">NIC</SPAN> maintains a database of the names,addresses, and phone numbers of significant network users, as wellas the contact people for various hosts and domains. If you canconnect to the host <ICLASS="systemitem">whois.internic.net</I> via telnet, you may be able to get the informationyou need. Try the following:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">Connect to the host <ICLASS="systemitem">whois.internic.net </I>via telnet.</P></LI><LICLASS="listitem"><PCLASS="para">At the &gt; prompt, type <KBDCLASS="command">whois</KBD>.</P></LI><LICLASS="listitem"><PCLASS="para">Try typing <KBDCLASS="command">host robot.ocp.com</KBD>(using the name of the appropriate machine, of course). The servermay return a record indicating the administrative contact for thatmachine.</P></LI><LICLASS="listitem"><PCLASS="para">Try typing <KBDCLASS="command">domain ocp.com</KBD> (usingthe appropriate domain). The server may return a record indicatingthe administrative contact for that domain.</P></LI><LICLASS="listitem"><PCLASS="para">When done, type <KBDCLASS="command">quit </KBD>to disconnect.</P></LI></OL><PCLASS="para">Here is an example, showing how to get information about thedomain <ICLASS="systemitem">whitehouse.gov</I>:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <BCLASS="emphasis.bold">telnet whois.internic.net</B>Trying 198.41.0.6 ...Connected to rs.internic.net.Escape character is `^]'.SunOS UNIX 4.1 (rs1) (ttyp1)************************************************************************ -- InterNIC Registration Services Center  --** For wais, type:                    WAIS &lt;search string&gt; &lt;return&gt;* For the *original* whois type:     WHOIS [search string] &lt;return&gt;* For referral whois type:           RWHOIS [search string] &lt;return&gt;** For user assistance call (703) 742-4777# Questions/Updates on the whois database to HOSTMASTER@internic.net* Please report system problems to ACTION@internic.net***********************************************************************Please be advised that use constitutes consent to monitoring (Elec Comm Priv Act, 18 USC 2701-2711)Cmdinter Ver 1.3 Tue Oct 17 21:51:53 1995 EST[xterm] InterNIC &gt; <BCLASS="emphasis.bold">whois</B>Connecting to the rs Database . . . . . .Connected to the rs DatabaseWhois: <BCLASS="emphasis.bold">whitehouse.gov</B>Executive Office of the President USA (WHITEHOUSE-HST) WHITEHOUSE.GOV                                                               198.137.240.100Whitehouse Public Access (WHITEHOUSE-DOM)                       WHITEHOUSE.GOVWhois: <BCLASS="emphasis.bold">whitehouse-dom</B>Whitehouse Public Access (WHITEHOUSE-DOM)   Executive Office of the President USA   Office of Administration   Room NEOB 4208   725 17th Street NW   Washington, D.C. 20503   Domain Name: WHITEHOUSE.GOV   Administrative Contact:      Fox, Jack S.  (JSF)  fox_j@EOP.GOV      (202) 395-7323   Technical Contact, Zone Contact:      Ranum, Marcus J.  (MJR)  mjr@BSDI.COM      (410) 889-6449   Record last updated on 17-Oct-94.   Record created on 17-Oct-94.   Domain servers in listed order:   GATEKEEPER.EOP.GOV           198.137.241.3   ICM1.ICP.NET                 192.94.207.66Whois: <BCLASS="emphasis.bold">quit</B>[xterm] InterNIC &gt; quitTue Oct 17 21:55:30 1995 ESTConnection closed by foreign host.%</PRE></BLOCKQUOTE><PCLASS="para">In addition to looking for information about the host, youcan look for information about the network domain. You may findthat technical contacts are more helpful than administrative contacts.If that approach fails, you can attempt to discover the site'snetwork service provider (discovered by sending packets to the siteusing <KBDCLASS="command">traceroute</KBD>) and call them to see if they have contact information.Even if the site's network service provider will tell younothing, he or she will often forward messages to the relevant people.In an emergency, you can call the organization's main numberand ask the security guard to contact the computer center'ssupport staff.</P><PCLASS="para">If you are attempting to find out information about a U.S.military site (the hostname ends in <EMCLASS="emphasis">.mil</EM>),you need to try the <ICLASS="filename">whois</I> command at <ICLASS="systemitem">nic.ddn.mil</I> instead of the oneat the Inter<SPANCLASS="acronym">NIC</SPAN>.</P><PCLASS="para">Another thing to try is to <ACLASS="indexterm"NAME="AUTOID-33522"></A><ACLASS="indexterm"NAME="AUTOID-33524"></A><KBDCLASS="command">finger</KBD> the <ICLASS="filename">root</I> account of the remote machine.Occasionally this will produce the desired result:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <BCLASS="emphasis.bold">finger root@robot.ocp.com </B>[robot.ocp.com] Login name: root in real life: Joel Wentworth Directory: / Shell: /bin/csh Last login Sat April 14, 1990 on /dev/tty Plan: For information regarding this computer, please contact Joel Wentworth at 301-555-1212 </PRE></BLOCKQUOTE><PCLASS="para">More often, unfortunately, you'll be given uselessinformation about the root account:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <BCLASS="emphasis.bold">finger root@robot.ocp.com </B>[robot.ocp.com] Login name: root in real life: Operator Directory: / Shell: /bin/csh Last login Mon Dec. 3, 1990 on /dev/console No plan </PRE></BLOCKQUOTE><PCLASS="para">In these cases, you can try to figure out who is the computer'ssystem administrator by connecting to the computer's <ACLASS="indexterm"NAME="AUTOID-33535"></A><KBDCLASS="command">sendmail</KBD>daemon and identifying who gets mail for the root or postmastermailboxes:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <BCLASS="emphasis.bold">telnet robot.ocp.com smtp </B>Trying... Connected to robot.ocp.com Escape character is &quot;^]&quot;. 220 robot.ocp.com Sendmail NeXT-1.0 (From Sendmail 5.52)/NeXT-1.0   ready at Sun, 2 Dec 90 14:34:08 EST helo mymachine.my.domain.com 250 robot.ocp.com Hello mymachine.my.domain.com, pleased to meet you vrfy postmaster 250 Joel Wentworth &lt;jw&gt; expn root 250 Joel Wentworth &lt;jw&gt; quit 221 robot.ocp.com closing connection Connection closed by foreign host. </PRE></BLOCKQUOTE><PCLASS="para">You can then use the <KBDCLASS="command">finger</KBD> command to learn this person'stelephone number.</P><PCLASS="para">Unfortunately, many system administrators have disabled their<KBDCLASS="command">finger</KBD> command, and the <KBDCLASS="command">sendmail</KBD> daemon may not honor your requeststo verify or expand the alias. However, you may still be able toidentify the contact person.</P><PCLASS="para">If all else fails, you can send mail to the &quot;<ACLASS="indexterm"NAME="AUTOID-33546"></A>postmaster&quot; of the indicated machineand hope it gets read soon. <EMCLASS="emphasis">Do not </EM>mentiona break-in in the message&nbsp;- mail is sometimes monitored byintruders. Instead, give your name and phone number, indicate thatthe matter is important, and ask the postmaster to call you. (Offeringto accept collect calls is a nice gesture and may improve the responserate.) Of course, after you've phoned, find out the phonenumber of the organization you're dealing with and tryphoning back&nbsp;- just to be sure that it's the administratorwho phoned (and not the intruder who read your email and deletedit before it got to the administrator). You can also contact thefolks at one of the <SPANCLASS="acronym">FIRST</SPAN> teams, such as the<SPANCLASS="acronym">CERT</SPAN>-CC. They have some additional resources,and they may be able to provide you with contact information. <ACLASS="indexterm"NAME="AUTOID-33551"></A><ACLASS="indexterm"NAME="AUTOID-33553"></A><ACLASS="indexterm"NAME="AUTOID-33556"></A></P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-24-SECT-2.5">24.2.5 Getting Rid of the Intruder</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-33562"></A><ACLASS="indexterm"NAME="AUTOID-33564"></A><ACLASS="indexterm"NAME="AUTOID-33567"></A>Killingyour computer's power&nbsp;- turning it off&nbsp;- isthe very quickest way to get an intruder off your computer and preventhim from doing anything else&nbsp;- including possibly furtherdamage. Unfortunately, this is a drastic action. Not only does itstop the intruder, but it also interrupts the work of all of yourlegitimate users. It may also delete evidence you night need incourt some day, delete necessary evidence of the break-in, suchas running processes (e.g., <KBDCLASS="command">mailrace</KBD>), and cause the system to bedamaged when you reboot because of the Trojaned startup scripts.In addition, the <SPANCLASS="acronym">UNIX</SPAN> filesystem does not dealwith sudden power loss very gracefully: pulling the plug might dosignificantly more damage than the intruder might ever do.</P><PCLASS="para">In some cases, you can get rid of an intruder by politelyasking him or her to leave. Inform the person that breaking intoyour computer is both antisocial and illegal. Some computer trespassershave the motivation of a child sneaking across private property;they often do not stop to think about the full impact of their actions.However, don't bet on your intruder being so simplistic,even if he acts that way. (And keep in mind our warning earlierin this chapter.)</P><PCLASS="para">If the person refuses to leave, you can forcibly kill hisor her processes with the <KBDCLASS="command">kill</KBD> command. Use the <ACLASS="indexterm"NAME="AUTOID-33575"></A><ACLASS="indexterm"NAME="AUTOID-33577"></A><KBDCLASS="command">ps</KBD>command to get a list of all of the user's process numbers,change the password of the penetrated account, and finally killall of the attacker's processes with a single <KBDCLASS="command">kill</KBD> command.For example:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <BCLASS="emphasis.bold">ps -aux </B>USER &nbsp;PID &nbsp;%CPU &nbsp;%MEM &nbsp;&nbsp;VSIZE &nbsp;&nbsp;RSIZE &nbsp;TT &nbsp;STAT &nbsp;&nbsp;TIME &nbsp;COMMAND root 1434 &nbsp;20.1 &nbsp;&nbsp;1.4 &nbsp;&nbsp;&nbsp;968K &nbsp;&nbsp;224K &nbsp;&nbsp;01 &nbsp;&nbsp;&nbsp;R &nbsp;&nbsp;&nbsp;0:00 &nbsp;ps aux nasty 147 &nbsp;&nbsp;1.1 &nbsp;&nbsp;1.9 &nbsp;&nbsp;1.02M &nbsp;&nbsp;304K &nbsp;&nbsp;p3 &nbsp;&nbsp;&nbsp;S &nbsp;&nbsp;&nbsp;0:07 &nbsp;- (csh) nasty 321 &nbsp;10.0 &nbsp;&nbsp;8.7 &nbsp;&nbsp;&nbsp;104K &nbsp;&nbsp;104K &nbsp;&nbsp;p3 &nbsp;&nbsp;&nbsp;S &nbsp;&nbsp;&nbsp;0:09 &nbsp;cat /etc/passwd nasty 339 &nbsp;&nbsp;8.0 &nbsp;&nbsp;3.7 &nbsp;&nbsp;2.05M &nbsp;&nbsp;456K &nbsp;&nbsp;p3 &nbsp;&nbsp;&nbsp;S &nbsp;&nbsp;&nbsp;0:09 &nbsp;rogue ... # <BCLASS="emphasis.bold">passwd nasty</B> Changing password for nasty. New password: <ICLASS="systemitem.password">rogue32</I>Retype new password: <ICLASS="systemitem.password">rogue32</I> # kill -9 147 321 339 </PRE></BLOCKQUOTE><PCLASS="para">You are well-advised to change the password on the account<EMCLASS="emphasis">before </EM>you kill the processes&nbsp;- especiallyif the intruder is logged in as root. If the intruder is a fastertypist than you are, you might find yourself forced off before youknow it! Also bear in mind that most intruders will install a backdoor into the system. Thus, even if you change the password, thatmay not be sufficient to keep them off: you may need to take thesystem to single-user mode and check the system out, first.</P><PCLASS="para">As a last resort, you can physically break the connection.If the intruder has dialed in over a telephone line, you can turnoff the modem&nbsp;- or unplug it from the back of the computer.If the intruder is connected through the network, you can unplugthe network connector&nbsp;- although this will also interruptservice for all legitimate users. Once the intruder is off yourmachine, try to determine the extent of the damage done (if any),and seal the holes that let the intruder get in. You also shouldcheck for any new holes that the intruder may have created. Thisis an important reason for creating and maintaining the checklistsdescribed in <ACLASS="xref"HREF="ch09_01.htm"TITLE="Integrity Management">Chapter 9, <CITECLASS="chapter">Integrity Management</CITE></A>.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-24-SECT-2.6">24.2.6 Anatomy of a Break-in</A></H3><PCLASS="para">The following story is true. The names and a few details havebeen changed to protect people's jobs.</P><PCLASS="para">Late one night in November 1995, a part-time computer consultantat a Seattle-based firm logged into one of the computers that heoccasionally used. The system seemed sluggish, so he ran the <KBDCLASS="command">top</KBD>command to get an idea of what was slowing down the system. Theconsultant noticed that a program called <KBDCLASS="command">vs</KBD> was consuming a largeamount of system resources. The program was running as superuser.</P><PCLASS="para">Something didn't look right. To get more information,the programmer ran the ps command. That's when things gotstranger still&nbsp;- <EMCLASS="emphasis">the mysterious program didn't appearwhen ps was run.</EM> So the occasional system manager used the <KBDCLASS="command">top</KBD> commandagain, and, sure enough, the <KBDCLASS="command">vs</KBD> program was still running.</P><PCLASS="para">The programmer suspected a break-in. He started looking aroundthe filesystem using the Emacs <KBDCLASS="command">dired</KBD> command and found the <KBDCLASS="command">vs</KBD> programin a directory called <ICLASS="filename">/var/.e</I>. That certainlydidn't look right. So the programmer went to his shellwindow, did a <KBDCLASS="command">chdir()</KBD> tothe <ICLASS="filename">/var</I> directory, and then did an <KBDCLASS="command">ls -a</KBD>. But the <KBDCLASS="command">ls</KBD> programdidn't show the directory <ICLASS="filename">/var/.e</I>. Nevertheless,the program was definitely there: it was still visible from theEmacs <KBDCLASS="command">dired</KBD> command.</P><PCLASS="para">The programmer was now pretty sure that somebody had brokeninto the computer. And the attack seemed sophisticated, becausesystem commands appeared to have been altered to hide evidence ofthe break-in. Not wanting to let the break-in proceed further, theoperator wanted to shut down the computer. But he was afraid thatthe attacker might have booby-trapped the <ACLASS="indexterm"NAME="AUTOID-33612"></A><ACLASS="indexterm"NAME="AUTOID-33615"></A><ICLASS="filename">/etc/halt</I>command to destroy traces of the break-in. So before the programmershut down the system, he used the <ACLASS="indexterm"NAME="AUTOID-33618"></A><KBDCLASS="command">tar</KBD>command to make a copy of the directory <ICLASS="filename">/var/.e,</I>as well as the directories <ICLASS="filename">/bin</I> and <ICLASS="filename">/etc</I>. As soonas the <ICLASS="filename">tar </I>file was made, he copied it to anothercomputer and halted the system.</P><PCLASS="para">The following morning, the programmer made the followingobservations from the <ICLASS="filename">tar </I>file:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Somebody had broken into the system.</P></LI><LICLASS="listitem"><PCLASS="para">The program <ICLASS="filename">/bin/login</I> had beenmodified so that anybody on the Internet could log into the <ICLASS="filename">root</I>account by trying a special password.</P></LI><LICLASS="listitem"><PCLASS="para">The <ICLASS="filename">/var/.e/vs</I> programthat had been left running was a password sniffing program. It listenedon the company's local area network for users typing theirpasswords; these passwords were then sent to another computer elsewhereon the Internet.</P></LI><LICLASS="listitem"><PCLASS="para">The program <ICLASS="filename">/bin/ls</I> and <ICLASS="filename">/bin/ps</I>had been modified so that they would not display the directory <ICLASS="filename">/var/.e.</I></P></LI><LICLASS="listitem"><PCLASS="para">The inode creation dates and the modification timeson the files <ICLASS="filename">/bin/ls</I>, <ICLASS="filename">/bin/ps</I>and <ICLASS="filename">/bin/login</I> had been reset to their originaldates before the modifications took place. The checksums for themodified commands (as computed with the <KBDCLASS="command">sum</KBD> command) matched thoseof the original, unmodified versions. But a comparison of the programswith a backup made the previous month revealed that the programshad been changed.</P></LI></UL><PCLASS="para">It was 10:00 p.m. at night when the break-in was discovered.Nevertheless, the consultant telephoned the system manager at home.When he did, he discovered something else:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">The computer's system managerhad known about the break-in for three days, but had not done anythingabout it. The reason: she feared that the intruder had created numerousholes in their system's security, and was afraid that ifshe angered the intruder, that person might take revenge by deletingimportant files or shutting down the system.</P></LI></UL><PCLASS="para">In retrospect, this was rather stupid behavior. Allowing theintruder to stay on the system let him collect more passwords fromusers of the system. The delay also allowed for plenty of time tomake yet further modifications to the system. If it was compromisedbefore, it was certainly compromised now!</P><PCLASS="para">Leaving the intruder alone also left the company in a precariouslegal position. If the intruder used the system to break in anywhereelse, the company might be held partially liable in a lawsuit becausethey left the intruder with free run of the compromised system.</P><PCLASS="para">So, what should the system manager have done when she firstdiscovered the break-in? Basically, the same thing as what the outsideconsultant did: take a snapshot of the system to tape or anotherdisk, isolate the system, and then investigate. If the staff wasworried about some significant files being damaged, they shouldhave done a complete backup right away to preserve whatever theycould. If the system had been booby-trapped and a power failureoccurred, they would have lost everything as surely as if they hadshut down the system themselves.</P><PCLASS="para">The case above is typical of many break-ins that have occurredin 1994 and 1995. The attackers have access to one of many &quot;toolkits&quot;used to break into systems, install password sniffers, and altersystem programs to hide their presence. Many of the users of thesetoolkits are quite ignorant of how they work. Some are even unfamiliarwith <SPANCLASS="acronym">UNIX</SPAN>: we have heard many stories of monitoredsystems compromised with these sophisticated toolkits, only to resultin the intruders attempting to use <SPANCLASS="acronym">DOS</SPAN> commandsto look at files!<ACLASS="indexterm"NAME="AUTOID-33658"></A><ACLASS="indexterm"NAME="AUTOID-33661"></A><ACLASS="indexterm"NAME="AUTOID-33664"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_01.htm"TITLE="24.1 Prelude"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.1 Prelude"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_03.htm"TITLE="24.3 The Log Files: Discovering an Intruder's Tracks"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.3 The Log Files: Discovering an Intruder's Tracks"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">24.1 Prelude</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">24.3 The Log Files: Discovering an Intruder's Tracks</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>