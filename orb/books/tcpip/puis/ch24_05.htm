<HTML><HEAD><TITLE>[Chapter 24] 24.5 An Example</TITLE><METANAME="DC.title"CONTENT="Practical UNIX &amp; Internet Security"><METANAME="DC.creator"CONTENT="Simson Garfinkel &amp; Gene Spafford"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:19:23Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-148-8"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch24_01.htm"TITLE="24. Discovering a  Break-in"><LINKREL="prev"HREF="ch24_04.htm"TITLE="24.4 Cleaning Up After the Intruder"><LINKREL="next"HREF="ch24_06.htm"TITLE="24.6 Resuming Operation"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Practical UNIX &amp; Internet Security"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Practical UNIX &amp; Internet Security"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_04.htm"TITLE="24.4 Cleaning Up After the Intruder"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.4 Cleaning Up After the Intruder"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 24<BR>Discovering a  Break-in</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_06.htm"TITLE="24.6 Resuming Operation"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.6 Resuming Operation"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="PUIS-CHP-24-SECT-5">24.5 An Example</A></H2><PCLASS="para">Suppose you're a system administrator and John Q.Random is there with you in your office. Suddenly, an alert windowpops up on your display, triggered by a Swatch rule monitoring the<ICLASS="filename">syslog</I> output. The <ICLASS="filename">syslog </I>messagehas indicated that John Q. Random has logged in and has used the<KBDCLASS="command">su</KBD> command to become <ICLASS="filename">root</I>.</P><PCLASS="para">The user must be an intruder&nbsp;- an intruder who hasbecome <ICLASS="systemitem">root! </I></P><PCLASS="para">Fortunately, in one of the windows on your terminal you havea superuser shell. You decide that the best course of action isto bring your system to an immediate halt. To do so, you executethe commands:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <BCLASS="emphasis.bold">sync</B> # <BCLASS="emphasis.bold">/etc/init 0</B></PRE></BLOCKQUOTE><PCLASS="para">Alternatively, you can send a <SPANCLASS="acronym">TERM</SPAN> signalto the init process:</P><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <BCLASS="emphasis.bold">sync</B># <BCLASS="emphasis.bold">kill -TERM 1</B></PRE></BLOCKQUOTE><PCLASS="para">This method is not the recommended procedure on System V systems,but is required on <SPANCLASS="acronym">BSD</SPAN> systems.</P><PCLASS="para">Your decision to halt the system was based on the fact thatyou had no idea who this intruder was or what he was doing, andthe fact that the intruder had become the superuser. After the intruderis the superuser, you don't know what parts of the operatingsystem he is modifying, if any.</P><PCLASS="para">For example, the intruder may be replacing system programsand destroying log files. You decide that the best thing you cando is to shut the system down and go to a protected terminal whereyou know that no other intruder is going to be interfering withthe system while you figure out what's going on.</P><PCLASS="para">The next step is to get a printed copy of all of the necessarylogs that you may have available (e.g., console logs and printedcopies of network logs), and to examine these logs to try to getan idea of what the unauthorized intruder has done. You will alsowant to see if anything unusual has happened on the system sincethe intruder logged in. These logs may give you a hint as to whatprograms the intruder was running and what actions the intrudertook. Be sure to initial and timestamp these printouts.</P><PCLASS="para"><EMCLASS="emphasis">Do not </EM>confine your examination to today'slogs. If the intruder is now logged in as <ICLASS="filename">root</I>, he may have alsobeen on the system under another account name earlier. If your logsgo back for a few days, examine the older versions as well. If theyare on your backup tapes, consider retrieving them from the tapes.</P><PCLASS="para">If the break-in is something that you wish to pursue further&nbsp;- possiblywith law enforcement&nbsp;- be sure to do a complete backup ofthe system to tape. This way, you'll have evidence in theform of the corrupted system. Also, save copies of the logs. Keepa written log of everything you've done and are about todo, and be sure to write the time of day along with each notation.</P><PCLASS="para">The next step is to determine how the intruder got in andthen to make sure the intruder can't get in again. Examinethe entire system. Check the permissions and the modes on all yourfiles. Scan for new <SPANCLASS="acronym">SUID</SPAN> or <SPANCLASS="acronym">SGID</SPAN>files. Look for additions in <ICLASS="filename">/etc/passwd</I>. If youhave constructed checklists of your program directories, rerun themto look for any changes.</P><PCLASS="para">Remember: the intruder may <EMCLASS="emphasis">not</EM> be anoutsider! The majority of major incidents occur from inside theorganization, either from someone with current access or someonewho recently had legitimate access. When you perform your evaluation,don't forget to consider the case that the behavior yousaw coming from a user account was not someone breaking a passwordand coming in from outside, but was someone on the inside who brokethe password, or perhaps it was the real account owner herself!</P><PCLASS="para">Only after performing all these steps, and checking all thisinformation, should you bring the system back up.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="PUIS-CHP-24-SECT-5.1">24.5.1 Never Trust Anything Except Hardcopy</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-34039"></A><ACLASS="indexterm"NAME="AUTOID-34042"></A><ACLASS="indexterm"NAME="AUTOID-34045"></A>If your system is compromised, don'ttrust anything that is online. If you discover changes in fileson your system that seem suspicious, don't believe anythingthat your system tells you, because a good system cracker can changeanything on the computer. This may seem extreme, but it is probablybetter to spend a little extra time restoring files and playingdetective now than it would be to replay the entire incident whenthe intruder gets in again.</P><PCLASS="para">Remember, an attacker who becomes the superuser on your computercan do <EMCLASS="emphasis">anything</EM> to it, change <EMCLASS="emphasis">any</EM>byte on the hard disk. The attacker can compile and install newversions of any system program&nbsp;- so there might be changes,but your standard utilities might not tell you about them. The attackercan patch the kernel that the computer is running, possibly disablingsecurity features that you have previously enabled. The attackercan even open the raw disk devices for reading and writing. Essentially,attackers who becomes the superuser can warp your system to theirliking&nbsp;- if they have sufficient skill, motivation, and time.Often, they don't need (or have) great skill. Instead,they have access to toolkits put together by others with more skill.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-34052"></A>For example, supposeyou discover a change in a file and do an ls -l or an ls-lt. The modification time you see printed for the filemay not be the actual modification time of the file. There are atleast four ways for an attacker to modify the time that is displayedby this command, all of which have been used in actual system attacks:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">The attacker could write a programthat changes the modification time of the file using the <ACLASS="indexterm"NAME="AUTOID-34058"></A><ACLASS="indexterm"NAME="AUTOID-34060"></A><ICLASS="filename">utimes</I>()<ICLASS="filename"></I> system call.</P></LI><LICLASS="listitem"><PCLASS="para">The attacker could have altered the system clockby using the <KBDCLASS="command">date</KBD> command. The attacker could then modify your filesand, finally, reset the date back again. This technique has theadvantage for the attacker that the inode access and creation timesalso get set.</P></LI><LICLASS="listitem"><PCLASS="para">The attacker could write to the raw disk, changingsaved values of <EMCLASS="emphasis">any</EM> stored time.</P></LI><LICLASS="listitem"><PCLASS="para">The attacker could have modified the <KBDCLASS="command">ls</KBD> commandto show a predetermined modification time whenever this file isexamined.</P></LI></UL><PCLASS="para">The only limit to the powers of an attacker who has gainedsuperuser status is that the attacker cannot change something thathas been <EMCLASS="emphasis">printed</EM> on a line printer or a hardcopyterminal. For this reason, if you have a logging facility that logswhenever the date is changed, you might consider having the logmade to a hardcopy terminal or to another computer. Then, be sureto examine this log on a regular basis.</P><PCLASS="para">It is also the case that we recommend that you have a bootablecopy of your operating system on a removable disk pack so, whenneeded, you can boot from a known good copy of the system and doyour examination of the system with uncorrupted tools. Coupled witha database of message digests of unmodified files such as that producedby a tool such as Tripwire, you should be able to find anythingthat was modified on your system.</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_04.htm"TITLE="24.4 Cleaning Up After the Intruder"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.4 Cleaning Up After the Intruder"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Practical UNIX &amp; Internet Security"><IMGSRC="../gifs/txthome.gif"ALT="Practical UNIX &amp; Internet Security"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_06.htm"TITLE="24.6 Resuming Operation"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.6 Resuming Operation"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">24.4 Cleaning Up After the Intruder</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">24.6 Resuming Operation</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>