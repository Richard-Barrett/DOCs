<HTML><HEAD><TITLE>[Chapter 2] 2.4 Preliminaries</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:32:28Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch02_01.htm"TITLE="2. Have a V8"><LINKREL="prev"HREF="ch02_03.htm"TITLE="2.3 What's What in src"><LINKREL="next"HREF="ch02_05.htm"TITLE="2.5 Build"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_03.htm"TITLE="2.3 What's What in src"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.3 What's What in src"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 2<BR>Have a V8</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_05.htm"TITLE="2.5 Build"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.5 Build"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-2-SECT-4">2.4 Preliminaries</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-2-IX-CONFIGURING-SENDMAIL"></A><ACLASS="indexterm"NAME="SML2-CH-2-IX-MAKESENDMAIL-SCRIPT"></A>Now that you have the distribution and have changed into the<EMCLASS="emphasis">src</EM> directory, you will find a script called<EMCLASS="emphasis">makesendmail</EM>. For nearly all systems, all you have todo is run that script to build <EMCLASS="emphasis">sendmail</EM>.To determine whether your system is supported, run the <EMCLASS="emphasis">makesendmail</EM>script now, with the <CODECLASS="literal">-m</CODE> command-line switch:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>./makesendmail -m</B></CODE><CODECLASS="literal">Configuration: os=SunOS, rel=4.1.4, rbase=4, arch=sun4, sfx=</CODE><CODECLASS="literal">Will run in virgin obj.SunOS.4.1.4.sun4 using Makefile.SunOS</CODE><CODECLASS="literal">%</CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Here, <EMCLASS="emphasis">makesendmail</EM> indicates that it knows how to build a <EMCLASS="emphasis">sendmail</EM>for SunOS 4.1.4. It will use the <EMCLASS="emphasis">Makefile</EM> called <EMCLASS="emphasis">Makefile.SunOS</EM>.If it is unable to determine a <EMCLASS="emphasis">Makefile</EM>,it will print a message like this and exit:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Cannot determine how to support <CODECLASS="replaceable"><I>arch</I></CODE><CODECLASS="literal">.</CODE><CODECLASS="replaceable"><I>os</I></CODE><CODECLASS="literal">.</CODE><CODECLASS="replaceable"><I>rel</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Here, <EMCLASS="emphasis">arch</EM> is the generic type of machine, such as <EMCLASS="emphasis">sun4</EM> or<EMCLASS="emphasis">9000/720</EM>. The <EMCLASS="emphasis">os</EM> is the operating system type, such asSunOS or HP-UX. And the <EMCLASS="emphasis">rel</EM> is the version of theoperating system, such as A or 4.1.3. If your system is not supported,you are going to have to do a port (ugh!). Read the <EMCLASS="emphasis">READ_ME</EM> file,and skip ahead to<ACLASS="xref"HREF="ch18_01.htm"TITLE="Compile and Install sendmail">Chapter 18, <CITECLASS="chapter">Compile and Install sendmail</CITE></A>.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-1301"></A>Fortunately <EMCLASS="emphasis">makesendmail</EM> succeeded in this example, and, becausewe are running on a Sun system with SunOS 4.1.4,<EMCLASS="emphasis">makesendmail</EM> selected <EMCLASS="emphasis">Makefile.SunOS</EM> as the <EMCLASS="emphasis">Makefile</EM>that we will be using. Had we been running on something else, for example,say an SGI machine, it might have selected a different<EMCLASS="emphasis">Makefile</EM>, such as <EMCLASS="emphasis">Makefile.IRIX</EM>.All the <EMCLASS="emphasis">Makefile</EM> files are located under <EMCLASS="emphasis">src</EM> ina subdirectory called <EMCLASS="emphasis">Makefiles</EM>.That subdirectory should look something like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Makefile.386BSD            Makefile.ISC               Makefile.SolarisMakefile.A-UX              Makefile.KSR               Makefile.SunOSMakefile.AIX               Makefile.LUNA              Makefile.SunOS.4.0Makefile.Altos             Makefile.Linux             Makefile.SunOS.5.1Makefile.BSD-OS            Makefile.Mach386           Makefile.SunOS.5.2Makefile.BSD43             Makefile.NCR3000           Makefile.SunOS.5.3Makefile.CLIX              Makefile.NEWS-OS.4.x       Makefile.SunOS.5.4Makefile.CSOS              Makefile.NEWS-OS.6.x       Makefile.SunOS.5.5Makefile.ConvexOS          Makefile.NEXTSTEP          Makefile.TitanMakefile.Dell              Makefile.NeXT              Makefile.ULTRIXMakefile.DomainOS          Makefile.NetBSD            Makefile.UMAXMakefile.Dynix             Makefile.NonStop-UX        Makefile.UNICOSMakefile.EWS-UX_V          Makefile.OSF1              Makefile.UNIX_SV.4.x.i386Makefile.FreeBSD           Makefile.PTX               Makefile.UX4800Makefile.HP-UX             Makefile.Paragon           Makefile.UXPDSMakefile.HP-UX.10.x        Makefile.RISCos            Makefile.UtahMakefile.IRIX              Makefile.SCO               Makefile.dguxMakefile.IRIX.5.x          Makefile.SCO.3.2v4.2       Makefile.distMakefile.IRIX64            Makefile.SVR4              Makefile.uts.systemV</PRE></BLOCKQUOTE></P><PCLASS="para">Since we have thus far been successful, you can now go ahead and run <EMCLASS="emphasis">makesendmail</EM>for real. Be prepared to interrupt it with a control-C, because we will need totune your <EMCLASS="emphasis">Makefile</EM> after it has been copied:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>./makesendmail</B></CODE><CODECLASS="literal"></CODE>Configuration: os=SunOS, rel=4.1.4, rbase=4, arch=sun4, sfx=Creating obj.SunOS.4.1.4.sun4 using Makefile.SunOSMaking dependencies in obj.SunOS.4.1.4.sun4Making in obj.SunOS.4.1.4.sun4cc -I. -O -I/usr/sww/include -DNDBM -DNEWDB -DNIS   -target sun4 -c  alias.c<CODECLASS="userinput"><B>^C</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <EMCLASS="emphasis">makesendmail</EM> script first creates a directory in which you willeventually build <EMCLASS="emphasis">sendmail</EM>. It then (invisibly) creates links insidethat directory to all the source files and to an appropriate<EMCLASS="emphasis">Makefile</EM>. Finally, it starts to build <EMCLASS="emphasis">sendmail</EM>.You interrupt the build with a control-C just after the first compilerline of output. From this point forward we will work inside that newdirectory, so <EMCLASS="emphasis">cd</EM> into it:<ACLASS="indexterm"NAME="AUTOID-1328"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cd obj.SunOS.4.1.4.sun4</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">As distributed, your newly created <EMCLASS="emphasis">Makefile</EM> is not writable.But we may need to modify it, so we need to make it writable:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>chmod u+w Makefile</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-1338"></A>There are three important reasons to modify your default <EMCLASS="emphasis">Makefile</EM>.If you don't have the Berkeley <EMCLASS="emphasis">db</EM>(3) library,you need to remove <EMCLASS="emphasis">db</EM> support from your <EMCLASS="emphasis">Makefile</EM>.If you are not connected to the Internet and are not runninga <EMCLASS="emphasis">named</EM>(8) name server, you need to eliminate DNS supportfrom your <EMCLASS="emphasis">Makefile</EM>. Finally, you need to read the commentsinside your <EMCLASS="emphasis">Makefile</EM> and make any changes suggested there.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-2-SECT-4-1">2.4.1 Eliminate or Keep db Support?</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-1350"></A>If you have not installed the Berkeley <EMCLASS="emphasis">db(8)</EM> library package, ordo not know whether you have, you need to remove support for thatpackage from your <EMCLASS="emphasis">Makefile</EM>.Edit your <EMCLASS="emphasis">Makefile</EM> and look for the line that beginswith the word <CODECLASS="literal">DBMDEF</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">DBMDEF= -DNDBM -DNEWDB -DNIS                 <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> this line</I>                  <IMGSRC="../chars/uarr.gif"ALT="-^">            <ICLASS="lineannotation"> delete this from the line</I></PRE></BLOCKQUOTE></P><PCLASS="para">Delete the string <CODECLASS="literal">-DNEWDB</CODE> from the <CODECLASS="literal">DBMDEF</CODE> line to formthe following:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">DBMDEF= -DNDBM -DNIS                        <ICLASS="lineannotation"> <IMGSRC="../chars/larr.gif"ALT="&lt;-"> after delete</I></PRE></BLOCKQUOTE></P><PCLASS="para">&#13;Next search for the line that begins with <CODECLASS="literal">LIBS</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">LIBS=   -ldb -ldbm -lresolv                <ICLASS="lineannotation">  <IMGSRC="../chars/larr.gif"ALT="&lt;-"> this line (exact text may vary)</I>        <IMGSRC="../chars/uarr.gif"ALT="-^">   <ICLASS="lineannotation"> delete this from the line</I></PRE></BLOCKQUOTE></P><PCLASS="para">Delete the string <CODECLASS="literal">-ldb</CODE> from the <CODECLASS="literal">LIBS=</CODE> line to form thefollowing:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">LIBS=   -ldbm -lresolv                       <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> after delete</I></PRE></BLOCKQUOTE></P><PCLASS="para">This completes the removal of Berkeley <EMCLASS="emphasis">db</EM>(3) support from your<EMCLASS="emphasis">Makefile</EM>.</P><PCLASS="para">If your site does support the Berkeley <EMCLASS="emphasis">db(3)</EM> library package, youmay still need to massage your <EMCLASS="emphasis">Makefile</EM>. To include this supportinside <EMCLASS="emphasis">sendmail</EM>, you need to specify the correct include filesand library path. Search for the line that begins with <CODECLASS="literal">INCDIRS</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">INCDIRS=-I/usr/sww/include                   <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> this line</I># loader options LDOPTS= -Bstatic # library directoriesLIBDIRS=-L/usr/sww/lib                       <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> and this line</I></PRE></BLOCKQUOTE></P><PCLASS="para">You need to change both lines to contain the correct paths where youinstalled the Berkeley <EMCLASS="emphasis">db</EM>(3) library. If you aren't sure aboutany of this information, you should eliminate support instead.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">INCDIRS=-I/usr/<CODECLASS="userinput"><B>local</B></CODE>/include/<CODECLASS="userinput"><B>db</B></CODE>            <ICLASS="lineannotation">   <IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I># loader options LDOPTS= -Bstatic # library directoriesLIBDIRS=-L/usr/<CODECLASS="userinput"><B>local</B></CODE>/lib                      <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I></PRE></BLOCKQUOTE></P><PCLASS="para">As shown in the two preceding examples, we installed the Berkeley<EMCLASS="emphasis">db</EM>(3) include files in <EMCLASS="emphasis">/usr/local/include/db</EM> and the library in<EMCLASS="emphasis">/usr/local/lib</EM>.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-2-SECT-4-2">2.4.2 Eliminate DNS Support</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-1406"></A>If you are on a machine that does not support DNS(such as a home workstation that connects to the outside worldexclusively via UUCP), you will need to exclude DNS support from<EMCLASS="emphasis">sendmail</EM>. One way to tell whether your machine supportsDNS is to run the <EMCLASS="emphasis">nslookup</EM>(8) program. It may not be inyour path, so if it is not found when you try to run it, you have to find it. Try looking in <EMCLASS="emphasis">/usr/etc</EM> or <EMCLASS="emphasis">/usr/sbin</EM>.If <EMCLASS="emphasis">nslookup</EM>(8) hangs when you run it, your system probably does notsupport DNS. If it doesn't hang, its output will look like this. Justtype Control-D to exit:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="literal">% </CODE><CODECLASS="userinput"><B>/usr/etc/nslookup</B></CODE><CODECLASS="literal">Default Server: localhost</CODE><CODECLASS="literal">Address:  127.0.0.1</CODE><CODECLASS="literal">&gt; </CODE><CODECLASS="userinput"><B>^D</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">If your system lacks DNS support, you must then redefine the value ofNAMED_BIND as 0 in <EMCLASS="emphasis">Makefile</EM>. One way to do that is toedit your <EMCLASS="emphasis">Makefile</EM> and search for the line beginningwith the string <CODECLASS="literal">ENVDEF</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">ENVDEF=</PRE></BLOCKQUOTE></P><PCLASS="para">Append to that line the following string, which turns offDNS support inside <EMCLASS="emphasis">sendmail</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">ENVDEF= <CODECLASS="userinput"><B>-DNAMED_BIND=0 </B></CODE>        <IMGSRC="../chars/uarr.gif"ALT="-^">     <ICLASS="lineannotation">append this</I></PRE></BLOCKQUOTE></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-2-SECT-4-3">2.4.3 Other Massaging in Makefile</A></H3><PCLASS="para">Independent of support for <EMCLASS="emphasis">db</EM>(3) and DNS, your operating system may impose its own requirements. To discover whether it does andwhat they might be, edit your <EMCLASS="emphasis">Makefile</EM>, and look through itfor operating-system-specific comments. A sampling of the manysuch comments might look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># you can use -O3 on AIX 3.2.4 or greater ONLY!            <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> Makefile.AIX</I># use DGUX_5_4_2 for versions prior to 5.4.3.              <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> Makefile.DGUX</I>#  delete -l44bsd if you are not running BIND 4.9.x        <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> Makefile.SunOS.5.5</I># define SPT_TYPE=SPT_NONE if you are using NEWS-OS 6.0.1  <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> Makefile.NEWS-OS.6.x</I></PRE></BLOCKQUOTE></P><PCLASS="para">No matter which <EMCLASS="emphasis">Makefile</EM> is yours, all customizing should be donebefore this line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">###################  end of user configuration flags  ######################</PRE></BLOCKQUOTE></P><PCLASS="para">Unless you are an expert at compiling <EMCLASS="emphasis">Makefiles</EM>, avoid changinganything after this line. You risk &quot;breaking&quot; your <EMCLASS="emphasis">Makefile</EM> andruining your ability to build.<ACLASS="indexterm"NAME="AUTOID-1452"></A>&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_03.htm"TITLE="2.3 What's What in src"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.3 What's What in src"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_05.htm"TITLE="2.5 Build"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.5 Build"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">2.3 What's What in src</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">2.5 Build</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>