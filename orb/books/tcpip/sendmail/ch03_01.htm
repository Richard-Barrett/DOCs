<HTML><HEAD><TITLE>[Chapter 3] The Roles of sendmail</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:32:43Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part01.htm"TITLE="I. A Tutorial"><LINKREL="prev"HREF="ch02_07.htm"TITLE="2.7 Things to Try"><LINKREL="next"HREF="ch03_02.htm"TITLE="3.2 Role in Local Delivery"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_07.htm"TITLE="2.7 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.7 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 3</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch03_02.htm"TITLE="3.2 Role in Local Delivery"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 3.2 Role in Local Delivery"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="SML2-CH-3">3. The Roles of sendmail</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#SML2-CH-3-SECT-1"TITLE="3.1 Role in the Filesystem">Role in the Filesystem</A><BR><ACLASS="sect1"HREF="ch03_02.htm"TITLE="3.2 Role in Local Delivery">Role in Local Delivery</A><BR><ACLASS="sect1"HREF="ch03_03.htm"TITLE="3.3 Role in Network Transport">Role in Network Transport</A><BR><ACLASS="sect1"HREF="ch03_04.htm"TITLE="3.4 Role as a Daemon">Role as a Daemon</A><BR><ACLASS="sect1"HREF="ch03_05.htm"TITLE="3.5 Things to Try">Things to Try</A></P><P></P></DIV><PCLASS="para"></P><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> program plays a variety of roles, allcritical to the proper flow of electronic mail.It listens to the network for incoming mail, transports mail messagesto other machines, and hands local mail to a localprogram for local delivery. It can append mail to filesand can pipe mail through other programs. It can queue mail forlater delivery and understands the aliasing of one recipientname to another. </P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-3-SECT-1">3.1 Role in the Filesystem</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-3-IX-FILESYSTEM-HIERARCHY"></A>The <EMCLASS="emphasis">sendmail</EM> program's role (position) in the local file systemhierarchy can be viewed as an inverted tree (see<ACLASS="xref"HREF="ch03_01.htm#SML2-CH-3-FIG-0"TITLE="The sendmail.cf file leads to everything else">Figure 3.1</A>).</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-3-FIG-0">Figure 3.1: The sendmail.cf file leads to everything else</A></H4><IMGCLASS="graphic"SRC="figs/sm0301.gif"ALT="Figure 3.1"><ACLASS="indexterm"NAME="AUTOID-1566"></A><ACLASS="indexterm"NAME="AUTOID-1568"></A><PCLASS="para">When <EMCLASS="emphasis">sendmail</EM>is run, it first reads the <EMCLASS="emphasis">/etc/sendmail.cf</EM> configuration file.Among the many items contained in that fileare the locations of all the other files and directories that<EMCLASS="emphasis">sendmail</EM> needs.</P><PCLASS="para">Files and directories listed in <EMCLASS="emphasis">sendmail.cf</EM> are usuallyspecified as full pathnames for security (such as <EMCLASS="emphasis">/var/spool/mqueue</EM>rather than <EMCLASS="emphasis">mqueue</EM>).As the first step in our tour of those files, run the followingcommand to gather a list of them:[1]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] If you are not currently running V8.7 or above <EMCLASS="emphasis">sendmail</EM>, you will haveto grep for &quot;/[^0-9].*/&quot; instead. If you're not running <EMCLASS="emphasis">sendmail</EM>at all, you won't be able to do this, so for now just read along instead.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>grep =/ /etc/sendmail.cf</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">&#13;The output produced by the <EMCLASS="emphasis">grep</EM>(1)command may look something like the following:[2]&#13;</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] Lines that begin with <CODECLASS="literal">F</CODE> or <CODECLASS="literal">K</CODE> may also appear. If so,ignore them for now.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">O AliasFile=/etc/aliases#O ErrorHeader=/etc/sendmail.oEO HelpFile=/usr/lib/sendmail.hfO QueueDirectory=/var/spool/mqueueO StatusFile=/etc/sendmail.st#O UserDatabaseSpec=/etc/userdb#O ServiceSwitchFile=/etc/service.switch#O HostsFile=/etc/hosts#O SafeFileEnvironment=/archMlocal,         P=/bin/mail, F=lsDFMAw5:/|@rmn, S=10/30, R=20/40,Mprog,          P=/bin/sh, F=lsDFMoeu, S=10/30, R=20/40, D=$z:/,</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-1595"></A><ACLASS="indexterm"NAME="AUTOID-1597"></A>Notice that some lines begin with an <CODECLASS="literal">O</CODE> character, somewith an <CODECLASS="literal">M</CODE>, and others with a <CODECLASS="literal">#</CODE>.The <CODECLASS="literal">O</CODE> marks a line as a configuration option.The word following the <CODECLASS="literal">O</CODE> is the name of the option.  The options in the above output show the location of the files that<EMCLASS="emphasis">sendmail</EM> uses. <CODECLASS="literal">AliasFile</CODE>, for example, defines thelocation of the <EMCLASS="emphasis">aliases</EM>(5) database.<ACLASS="indexterm"NAME="AUTOID-1607"></A><ACLASS="indexterm"NAME="AUTOID-1609"></A><ACLASS="indexterm"NAME="AUTOID-1612"></A>The lines that begin with <CODECLASS="literal">M</CODE> define <EMCLASS="emphasis">delivery agents</EM>.The lines that begin with a <CODECLASS="literal">#</CODE> are comments.</P><PCLASS="para">First we will examine the files in the <CODECLASS="literal">O</CODE> optionlines. Then we will discuss local delivery and the filesin the <CODECLASS="literal">M</CODE> delivery agent lines.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-3-SECT-1-1">3.1.1 The Aliases File</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-3-IX-ALIASES-FILE"></A><ACLASS="indexterm"NAME="SML2-CH-3-IX-ALIASING"></A><ACLASS="indexterm"NAME="AUTOID-1627"></A>Aliasing is the process of converting one recipient name into another.One use is to convert a generic name (such as <EMCLASS="emphasis">root</EM>) intoa real username.Anotheris to convert one name into a list of many names (for mailing lists).</P><PCLASS="para">&#13;Take a few moments to examine your <EMCLASS="emphasis">aliases</EM> file. Itslocation is determined by the <CODECLASS="literal">AliasFile</CODE>option in your <EMCLASS="emphasis">sendmail.cf</EM> file. For example,<ACLASS="indexterm"NAME="AUTOID-1635"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">O AliasFile=/etc/aliases</PRE></BLOCKQUOTE></P><PCLASS="para">Compare what you find in your <EMCLASS="emphasis">aliases</EM> fileto the brief example of an <EMCLASS="emphasis">aliases</EM> file listed below:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="literal"># Mandatory aliases.</CODE><CODECLASS="literal">postmaster: root</CODE><CODECLASS="literal">MAILER-DAEMON: postmaster</CODE><CODECLASS="literal"></CODE><CODECLASS="literal"># The five forms of aliases</CODE><CODECLASS="literal">John_Adams:    adamj</CODE><CODECLASS="literal">xpres:         ford,carter,bush</CODE><CODECLASS="literal">oldlist:       :include: /usr/local/oldguys</CODE><CODECLASS="literal">nobody:        /dev/null</CODE><CODECLASS="literal">ftphelp:       |/usr/local/bin/sendhelp</CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Your <EMCLASS="emphasis">aliases</EM> file is probably far more complex, but even so,note that the example shows all the possible forms of aliases.</P><PCLASS="para">Lines that begin with <CODECLASS="literal">#</CODE> are comments.  Empty linesare ignored.As the first comment indicates, there are twoaliases that are mandatory in every <EMCLASS="emphasis">aliases</EM> file.Both are the simplest form of alias: a name and what to changethat name into.<ACLASS="indexterm"NAME="AUTOID-1659"></A><ACLASS="indexterm"NAME="AUTOID-1662"></A><ACLASS="indexterm"NAME="AUTOID-1665"></A>The name on the left of the <CODECLASS="literal">:</CODE>is changed into the name on the right.Names are not case-sensitive. For example, <CODECLASS="literal">POSTMASTER</CODE>,<CODECLASS="literal">Postmaster</CODE>, and <CODECLASS="literal">postmaster</CODE> are all the same.[3]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] According to RFC822, all usernames <EMCLASS="emphasis">are</EM> case-sensitiveexcept postmaster. But <EMCLASS="emphasis">sendmail</EM>, when processing itsaliases file, views all names as case-insensitive.</P></BLOCKQUOTE><PCLASS="para">For every envelope that lists a local user as a recipient,<EMCLASS="emphasis">sendmail</EM> looks up that recipient's name in the <EMCLASS="emphasis">aliases</EM>file. (A local user is any address that would normally be delivered on the local machine.That is, <EMCLASS="emphasis">postmaster</EM> is local, whereas <EMCLASS="emphasis">postmaster@remote</EM> may not be.)When <EMCLASS="emphasis">sendmail</EM> matches the recipient to one of thenames on the left of the <EMCLASS="emphasis">aliases</EM> file, it replaces thatrecipient name with the text to the right of the <CODECLASS="literal">:</CODE> character.For example, the recipient <CODECLASS="literal">postmaster</CODE> becomes the recipient <CODECLASS="literal">root</CODE>.</P><PCLASS="para">After a name is substituted, the new name is then looked up,and the process is repeated untilno more matches are found. <ACLASS="indexterm"NAME="AUTOID-1686"></A>The name <CODECLASS="literal">MAILER-DAEMON</CODE> is first changedto <CODECLASS="literal">postmaster</CODE>. Then <CODECLASS="literal">postmaster</CODE> is looked up again and changed to <CODECLASS="literal">root</CODE>. Since there is no entry for <CODECLASS="literal">root</CODE> in the <EMCLASS="emphasis">aliases</EM> file,the mail message is delivered into <EMCLASS="emphasis">root</EM>'s mailbox.</P><PCLASS="para">&#13;Every <EMCLASS="emphasis">aliases</EM> file must have an alias for <CODECLASS="literal">postmaster</CODE>that will expand to the name of a real user.[4]Mail about mailproblems is always sent to <CODECLASS="literal">postmaster</CODE> both by mail-relatedprograms and by users who are having trouble sending mail. </P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] The name <CODECLASS="literal">postmaster</CODE> is required by RFC822 and RFC1648,so resist the temptation to redefine it as <CODECLASS="literal">postperson</CODE>or <CODECLASS="literal">sysop</CODE>.</P></BLOCKQUOTE><PCLASS="para">When mail isbounced (returned because it could not be delivered),it is always sent from <CODECLASS="literal">MAILER-DAEMON</CODE>.That alias is needed because users may reply to bounced mail.Without it, replies to bounced mail would themselves bounce.</P><PCLASS="para">The five types of lines in an <EMCLASS="emphasis">aliases</EM> file areas are as follows:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="literal">John_Adams:    adamj</CODE><CODECLASS="literal">xpres:         ford,carter,reagan,bush</CODE><CODECLASS="literal">oldlist:       :include: /usr/local/oldguys</CODE><CODECLASS="literal">nobody:        /dev/null</CODE><CODECLASS="literal">ftphelp:       |/usr/local/bin/sendhelp</CODE></PRE></BLOCKQUOTE></P><PCLASS="para">You have already seen the first (it was the form used to convert<CODECLASS="literal">postmaster</CODE> to <CODECLASS="literal">root</CODE>). In the above example, mail sentto <CODECLASS="literal">John_Adams</CODE> is delivered to the user whoselogin name is <CODECLASS="literal">adamj</CODE>.</P><PCLASS="para">The <CODECLASS="literal">xpres:</CODE> line shows how one name canbe expanded into a list of many names. Each of those new namesbecomes a new name for further alias processing.If a name can't be further expanded, a copy of the mailmessage is delivered to it.</P><PCLASS="para">The <CODECLASS="literal">oldlist:</CODE> line shows how a mailing list can be readfrom a file. The expression<CODECLASS="literal">:include:</CODE> tells <EMCLASS="emphasis">sendmail</EM> to read a specific fileand to use the names in that file as the list of recipients.</P><PCLASS="para">The <CODECLASS="literal">nobody:</CODE> line shows how a name can be aliasedto a file.The mail message is appended to the file.The <EMCLASS="emphasis">/dev/null</EM> file listed here is a special one. Thatfile is an empty hole into which the mail message simply vanishes.</P><PCLASS="para">The <CODECLASS="literal">ftphelp:</CODE> line shows how a name can be replaced bythe name of a program. The <CODECLASS="literal">|</CODE> character causes <EMCLASS="emphasis">sendmail</EM> to pipe the mail message through the program whosefull pathname follows (in this case, we specified the full pathname as<EMCLASS="emphasis">/usr/local/bin/sendhelp</EM>).</P><PCLASS="para">The <EMCLASS="emphasis">aliases</EM> file can become very complex.It can be used to solve many special mail problems.The <EMCLASS="emphasis">aliases</EM> file is covered in greater detail in <ACLASS="xref"HREF="ch24_01.htm"TITLE="Aliases">Chapter 24, <CITECLASS="chapter">Aliases</CITE></A>.<ACLASS="indexterm"NAME="AUTOID-1738"></A><ACLASS="indexterm"NAME="AUTOID-1739"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-3-SECT-1-2">3.1.2 The Queue Directory</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-1743"></A>A mail message can be temporarily undeliverable for a wide variety of reasons,such as when a remote machine is down or has a temporary disk problem.To ensure that suchmessages are eventually delivered, <EMCLASS="emphasis">sendmail</EM> storesthem in its queue directory until they can be deliveredsuccessfully.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-1747"></A>The <CODECLASS="literal">QueueDirectory</CODE> optionin your configuration file tells <EMCLASS="emphasis">sendmail</EM>where to find its queue directory:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="literal">O QueueDirectory=/var/spool/mqueue</CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The location of that directory must be a full pathname. Its exactlocation varies from vendor to vendor, but youcan always find it by looking for the <CODECLASS="literal">QueueDirectory</CODE> option in yourconfiguration file.</P><PCLASS="para">If you have permission, take a look at the queue directory.It may be empty if there is no mail waiting to be sent. If it is not empty, it will contain files like these:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">dfQAA07038 dfMAA08000 qfQAA07038 qfMAA08000</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-1760"></A><ACLASS="indexterm"NAME="AUTOID-1763"></A><ACLASS="indexterm"NAME="AUTOID-1766"></A><ACLASS="indexterm"NAME="AUTOID-1769"></A><ACLASS="indexterm"NAME="AUTOID-1771"></A>When a mail message is queued, it is split into two parts,each part being saved in a separate file. The header informationis saved in a file whose name begins with the characters <CODECLASS="literal">qf</CODE>.The body of the mail message is saved in a file whose name beginswith the characters <CODECLASS="literal">df</CODE>.</P><PCLASS="para">The example above shows two queued mail messages. Oneis identified by the unique string <CODECLASS="literal">QAA07038</CODE> and the otherby <CODECLASS="literal">MAA08000</CODE>.</P><PCLASS="para">The internals of the queue files and the processing of thosefiles are covered in <ACLASS="xref"HREF="ch23_01.htm"TITLE="The Queue">Chapter 23, <CITECLASS="chapter">The Queue</CITE></A>.<ACLASS="indexterm"NAME="AUTOID-1780"></A></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_07.htm"TITLE="2.7 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.7 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch03_02.htm"TITLE="3.2 Role in Local Delivery"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 3.2 Role in Local Delivery"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">2.7 Things to Try</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">3.2 Role in Local Delivery</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>