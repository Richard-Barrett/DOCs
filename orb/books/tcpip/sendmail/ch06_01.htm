<HTML><HEAD><TITLE>[Chapter 6] The Mail Hub and Delivery Agents</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:34:43Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part01.htm"TITLE="I. A Tutorial"><LINKREL="prev"HREF="ch05_04.htm"TITLE="5.4 Things to Try"><LINKREL="next"HREF="ch06_02.htm"TITLE="6.2 Define a Mail Delivery Agent"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_04.htm"TITLE="5.4 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.4 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 6</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_02.htm"TITLE="6.2 Define a Mail Delivery Agent"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 6.2 Define a Mail Delivery Agent"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="SML2-CH-6">6. The Mail Hub and Delivery Agents</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#SML2-CH-6-SECT-1"TITLE="6.1 The client.cf File">The client.cf File</A><BR><ACLASS="sect1"HREF="ch06_02.htm"TITLE="6.2 Define a Mail Delivery Agent">Define a Mail Delivery Agent</A><BR><ACLASS="sect1"HREF="ch06_03.htm"TITLE="6.3 The local Delivery Agent">The local Delivery Agent</A><BR><ACLASS="sect1"HREF="ch06_04.htm"TITLE="6.4 Add the Missing Parts to Mhub">Add the Missing Parts to Mhub</A><BR><ACLASS="sect1"HREF="ch06_05.htm"TITLE="6.5 Things to Try">Things to Try</A></P><P></P></DIV><PCLASS="para"></P><PCLASS="para">Instead of having each individual workstation in a networkhandle its own mail, it can be advantageous to have a powerfulcentral machine that handles all mail. <ACLASS="indexterm"NAME="SML2-CH-6-IX-HUBS"></A>Such a machine is called a <EMCLASS="emphasis">mail hub</EM> and is analogous to the way Federal Express originally handled packagedelivery. In the old days, when you sent a package via Federal Express from, say,San Francisco to Paris, or even fromSan Francisco to Los Angeles, that package was first sent to Memphis, Tennessee(see <ACLASS="xref"HREF="ch06_01.htm#SML2-CH-6-FIG-0"TITLE="The Federal Express hub approach">Figure 6.1</A>).The Memphis location was the Federal Express hub. All packages, nomatter what their origin or destination, were sent to the hub firstand then were transported outward from there.</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-6-FIG-0">Figure 6.1: The Federal Express hub approach</A></H4><IMGCLASS="graphic"SRC="figs/sm0601.gif"ALT="Figure 6.1"><PCLASS="para">The advantage to this approach is that the Memphis hubwas the only Federal Express office that needed the special knowledgeof how to deliver packages anywhere in the world.[1]Local offices needed to know only how to deliver to the hub.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] Federal Express now has several regional hubs.</P></BLOCKQUOTE><PCLASS="para">In a similar way, your workstations can be thought of asthe outlying offices (client machines) and your central mail-handling machineas the hub. For mail, the hubperforms the following functions for the entire site:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">All incoming mail is sent to the hub, meaning that no mail is sentdirectly to a client machine.This hub approach has several advantages.No client needs to run a <EMCLASS="emphasis">sendmail</EM>daemon to listen for mail. No client's name needsto be known to the outside world, thus insulating client machinesfor easier security.</P></LI><LICLASS="listitem"><PCLASS="para">Rather than having each client send its mail directlyto the outside world,all outgoing mail from clients is sent to thehub, and the hub then forwards that mail to its ultimate destination.The advantages arethat clients do not need to be continually aware of changes inthe Internet; deferred mail queues on the hub, not onthe client machine, making management simpler;and a single,simple <EMCLASS="emphasis">sendmail.cf</EM> file may be shared by, or distributedto, all the clients.</P></LI><LICLASS="listitem"><PCLASS="para">All outgoing mail is modified sothat it appears to have originated on the hub.The alternative is to have <EMCLASS="emphasis">reply</EM> mail returned directlyto each client. The advantages of the hub approach are thatall mail appears to come from a single, giant machine (makingreplying to mail easier).</P></LI><LICLASS="listitem"><PCLASS="para">All mail to local users is delivered to, and spooled on, thehub. The alternative is to have one or more separate mailspool directories on separate client machines. The advantagesof the hub approach are that all local delivery is handledby one machine, that no client needs to accept mail forlocal delivery, and that management is easier with a singlespool. </P></LI></UL><PCLASS="para">There are disadvantages to the hub approach when asite is composed of differing machine architecturesand when machines are spread over many networks:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">At sites where there is a huge amount of mail constantly flowing,the load on the hub can become excessive. This can cause clientmail to be queued rather than sent, even when mail is destined forlocal delivery.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3394"></A><ACLASS="indexterm"NAME="AUTOID-3397"></A><ACLASS="indexterm"NAME="AUTOID-3400"></A>For the hub to work, it needs to know the login names of all users on the system.Either it must have a master <EMCLASS="emphasis">/etc/passwd</EM> file that isthe union of all systems' <EMCLASS="emphasis">passwd</EM> files, or it must useNIS to access such a master file.[2]In the absence of universaluser <EMCLASS="emphasis">passwd</EM> knowledge, it must have an <EMCLASS="emphasis">aliases</EM> fileentry for every local user.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] See <EMCLASS="emphasis">Managing NFS and NIS</EM> by Hal Stern (O'Reilly &amp; Associates, 1992).</P></BLOCKQUOTE></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3413"></A><ACLASS="indexterm"NAME="AUTOID-3416"></A><ACLASS="indexterm"NAME="AUTOID-3419"></A><ACLASS="indexterm"NAME="AUTOID-3422"></A><ACLASS="indexterm"NAME="AUTOID-3426"></A><ACLASS="indexterm"NAME="AUTOID-3429"></A>Because all mail passes through the hub, rather than beingsent to the recipient directly, there are unavoidabledelays. Those delays are negligibleat small sites (a couple of hundred or so users) but can becomesignificant at sites with a huge number of users.</P></LI><LICLASS="listitem"><PCLASS="para">If a client machine has direct UUCP connections or is connected tomultiple networks, a more complex configuration file is needed.</P></LI></UL><PCLASS="para"></P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-6-SECT-1">6.1 The client.cf File</A></H2><PCLASS="para">The purpose of this tutorial is to develop a small <EMCLASS="emphasis">sendmail.cf</EM>file for the clients of a hub scheme. As we did in the previous chapter,we will call our file <EMCLASS="emphasis">client.cf</EM>. [3]We will be developing it in piecesand examining those pieces individually in the chapters that follow.In this chapter we will begin the process of developing a <EMCLASS="emphasis">client.cf</EM>file from scratch.It will perform only two tasks:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] The <EMCLASS="emphasis">client.cf</EM> file is a teaching tool. Although it can beused to send mail when it is finished, alternatives presented in <ACLASS="xref"HREF="ch16_01.htm"TITLE="The null.mc File and m4">Chapter 16, <CITECLASS="chapter">The null.mc File and m4</CITE></A>are generally more useful. Consequently, we never show the completed<EMCLASS="emphasis">client.cf</EM> file.</P></BLOCKQUOTE><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">It will instruct <EMCLASS="emphasis">sendmail</EM> to send all mail to another machinethat serves as a mail hub. (Recall that in the hub design, no workstationreceives mail, and all mail from clients is sent first to the huband from there to the outside world.)</P></LI><LICLASS="listitem"><PCLASS="para">It will make all outgoing mail appear as though it originally came from that hub. (Thus, replies to mail will be delivered to the hub, not to the client.)</P></LI></UL><PCLASS="para">In this chapter we tackle the first task: how to get mail from the client machine to the hub.&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_04.htm"TITLE="5.4 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.4 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_02.htm"TITLE="6.2 Define a Mail Delivery Agent"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 6.2 Define a Mail Delivery Agent"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">5.4 Things to Try</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">6.2 Define a Mail Delivery Agent</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>