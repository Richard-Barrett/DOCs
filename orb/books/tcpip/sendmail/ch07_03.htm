<HTML><HEAD><TITLE>[Chapter 7] 7.3 Predefined Macros</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:35:12Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch07_01.htm"TITLE="7. Macros"><LINKREL="prev"HREF="ch07_02.htm"TITLE="7.2 Defining Macros"><LINKREL="next"HREF="ch07_04.htm"TITLE="7.4 Things to Try"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 Defining Macros"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.2 Defining Macros"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 7<BR>Macros</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_04.htm"TITLE="7.4 Things to Try"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.4 Things to Try"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-7-SECT-3">7.3 Predefined Macros</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-7-IX-PREDEFINED-MACROS"></A><ACLASS="indexterm"NAME="SML2-CH-7-IX-MACROS-PREDEFINED"></A><ACLASS="indexterm"NAME="SML2-CH-7-IX-INTERNAL-PREDEFINED-MACROS"></A>The <EMCLASS="emphasis">sendmail</EM> program internally defines many macros for you.You have already seen <CODECLASS="literal">u</CODE> (which contains the recipient'susername) and <CODECLASS="literal">h</CODE> (which contains the recipient's hostname) in our delivery agent definitions.They are given values by <EMCLASS="emphasis">sendmail</EM> instead ofbeing given values with <CODECLASS="literal">D</CODE> macro definitions in yourconfiguration file.A short list of some of the more common predefined macros is shown in<ACLASS="xref"HREF="ch07_03.htm#SML2-CH-7-TAB-0"TITLE="Some Predefined Macros">Table 7.1</A>.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="SML2-CH-7-TAB-0">Table 7.1: Some Predefined Macros</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Macro</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Description</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">n</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Identity of the error message sender</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">v</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Version of the currently running <EMCLASS="emphasis">sendmail</EM></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">w</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The short hostname</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">j</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The canonical hostname</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">m</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The domain name</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">k</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The UUCP node name</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">b</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Date in RFC1123 format</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">_</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Identification information</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">opMode</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Current operating mode (beginning with V8.7)</TD></TR></TBODY></TABLE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4218"></A><ACLASS="indexterm"NAME="AUTOID-4221"></A>To watch the processing of all the macro definitions,run <EMCLASS="emphasis">sendmail</EM> once again. This time, add a <CODECLASS="literal">-d35.9</CODE>debugging switch, which tells <EMCLASS="emphasis">sendmail</EM> to print each macroas it is defined:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>./sendmail -d35.9 -Cclient.cf -bt &lt; /dev/null</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The output that is produced is surprisingly long, considering the small size ofthe <EMCLASS="emphasis">client.cf</EM> file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">define(* as $*)define(+ as $+)define(- as $-)define(= as $=)define(~ as $~)define(# as $#)define(@ as $@)define(: as $:)define(&gt; as $&gt;)define(? as $?)define(| as $|)define(. as $.)define([ as $[)define(] as $])define(( as $()define() as $))define(&amp; as $&amp;)define(0 as $0)define(1 as $1)define(2 as $2)define(3 as $3)define(4 as $4)define(5 as $5)define(6 as $6)define(7 as $7)define(8 as $8)define(9 as $9)<CODECLASS="userinput"><B>define(n as MAILER-DAEMON)                             </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> note</I><CODECLASS="userinput"><B>define(v as 8.8.4)                                     </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> note</I><CODECLASS="userinput"><B>define(w as here.us.edu)                               </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> note</I><CODECLASS="userinput"><B>define(j as here.us.edu)                               </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> note</I><CODECLASS="userinput"><B>define(m as us.edu)                                    </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> note</I><CODECLASS="userinput"><B>define(k as here)                                      </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> note</I><CODECLASS="userinput"><B>define(b as Fri, 13 Dec 1996 07:11:47 -0700 (PDT))     </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> note</I><CODECLASS="userinput"><B>define(_ as you@localhost)                             </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> note</I><CODECLASS="userinput"><B>define(opMode as t)                                    </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> note</I><CODECLASS="userinput"><B>redefine(w as here)                                    </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> note</I><CODECLASS="userinput"><B>define(REMOTE as mailhost)                             </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> note</I></PRE></BLOCKQUOTE></P><PCLASS="para">This output will differ from version to version. For example, <CODECLASS="literal">l</CODE>, <CODECLASS="literal">o</CODE>,and <CODECLASS="literal">e</CODE> were macros prior to V8.7 but, beginning with V8.7, are now options.The first 27 lines of this output show <EMCLASS="emphasis">sendmail</EM> reserving macronames that will be used as operators. (Operators are introduced inthe next chapter.)The last 11 definitions are the only ones we are interested infor now. The first 10 of those are internally defined by <EMCLASS="emphasis">sendmail</EM>for your use. The last definition is caused by <EMCLASS="emphasis">sendmail</EM>processing the <CODECLASS="literal">D{REMOTE}mailhost</CODE> line in the <EMCLASS="emphasis">client.cf</EM> file.</P><PCLASS="para">This output demonstrates another concept. Some internal macrosare defined before the configuration file is read, so you can change them from inside your <EMCLASS="emphasis">client.cf</EM>file. To change <CODECLASS="literal">w</CODE>, for example, you might place thefollowing into your configuration file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Dwmyhost.my.domain</PRE></BLOCKQUOTE></P><PCLASS="para">Doing this would then cause the text <CODECLASS="literal">myhost.my.domain</CODE> to replacethe text <CODECLASS="literal">here.us.edu</CODE> as the value of the macronamed <CODECLASS="literal">w</CODE>.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4275"></A><ACLASS="indexterm"NAME="AUTOID-4277"></A>Note that in the preceding output there were nodefinitions for the <CODECLASS="literal">h</CODE> and <CODECLASS="literal">u</CODE> macros used in thedelivery agent definitions. These macros, although internally defined,are not actually given values until mail is sent.You cannot change their values from withinyour configuration file, because they are not defineduntil after the configuration file is read.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4282"></A>Finally, note that proper defaults are set only by V8 <EMCLASS="emphasis">sendmail</EM>.All older versions require you to manually provide defaults for the <CODECLASS="literal">e</CODE>,<CODECLASS="literal">l</CODE>, <CODECLASS="literal">n</CODE>, <CODECLASS="literal">o</CODE>, and <CODECLASS="literal">q</CODE> macros in your <EMCLASS="emphasis">client.cf</EM>file.&#13;</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-7-SECT-3-1">7.3.1 The hostname</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-7-IX-HOSTNAMES"></A>The name of your local machine is composed of two parts. The host part is the machinename and never contains a dot (such as <EMCLASS="emphasis">here</EM>).The domain part is composed of at least twoparts separated from each other by dots (such as <EMCLASS="emphasis">us.edu</EM>).<ACLASS="indexterm"NAME="AUTOID-4299"></A><ACLASS="indexterm"NAME="AUTOID-4302"></A>The <EMCLASS="emphasis">fully qualified</EM> name of your local machine is madeby specifying the host part, then a dot, and finally the domain part(e.g., <EMCLASS="emphasis">here.us.edu</EM>).The machine's name needs to be fully qualified to uniquely identify it worldwide.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4307"></A><ACLASS="indexterm"NAME="AUTOID-4310"></A>The name of the local machine also needs to be <EMCLASS="emphasis">canonical</EM>(official and fully qualified). A machine can have multiple names (such as <EMCLASS="emphasis">mailhost</EM>or <EMCLASS="emphasis">printserver</EM>), of which only one is official. The official name for the local machinecan be found by issuing the <EMCLASS="emphasis">hostname</EM>(1) command:<ACLASS="indexterm"NAME="AUTOID-4316"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>hostname</B></CODE>here.us.edu</PRE></BLOCKQUOTE></P><PCLASS="para">The official name, when fully qualified with a domain, is the<EMCLASS="emphasis">canonical</EM> name of the machine. Any other names are aliases.[3]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] We are fudging for simplicity. The canonical name is the nameassociated with the DNS A record. If a machine has multiplenetwork interfaces (and therefore multiple <CODECLASS="literal">A</CODE> records),it can have multiple canonical names.</P></BLOCKQUOTE><PCLASS="para">To see how <EMCLASS="emphasis">sendmail</EM> interprets your local hostname, enterthe following command, which uses the <CODECLASS="literal">-d0.1</CODE> debuggingswitch:<ACLASS="indexterm"NAME="AUTOID-4329"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>./sendmail -Cclient.cf -d0.1 -bt &lt;/dev/null</B></CODE>Version 8.8.4 Compiled with: LOG NAMED_BIND NDBM NETINET NETUNIX NIS SCANF XDEBUG============ SYSTEM IDENTITY (after readcf) ============      (short domain name) $w = here  (canonical domain name) $j = here.us.edu         (subdomain name) $m = us.edu              (node name) $k = here========================================================</PRE></BLOCKQUOTE></P><PCLASS="para">Many things can go wrong here. For example, if you're noton the Internet, you may not have assigned your machine a domainname yet. Or you may be running NIS and have listed only theshort name in the <EMCLASS="emphasis">hosts.byname</EM> map. The important thingto observe in the above output is that <EMCLASS="emphasis">sendmail</EM> correctlyfound your short and canonical names:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">      (short domain name) $w = here           <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> short hostname</I>  (canonical domain name) $j = here.us.edu    <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> fully qualified canonical name</I>         (subdomain name) $m = us.edu         <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> domain</I></PRE></BLOCKQUOTE></P><PCLASS="para">If any are wrong, you need to fix the system problem that ledto the error.At the system level, investigate:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">The <EMCLASS="emphasis">/etc/hosts</EM> file.<ACLASS="indexterm"NAME="AUTOID-4348"></A><ACLASS="indexterm"NAME="AUTOID-4350"></A>You may have wrongly listed only short names in it.Prior to V8.7, a fully qualified name had to be listed first.Beginning with V8.7, a fully qualified name can appear anywhere in a line.</P></LI><LICLASS="listitem"><PCLASS="para">The <EMCLASS="emphasis">nis</EM> maps.<ACLASS="indexterm"NAME="AUTOID-4356"></A>Make sure hostnames are looked up with DNS by specifying the <CODECLASS="literal">-b</CODE> in<EMCLASS="emphasis">/var/yp/Makefile</EM>.</P></LI><LICLASS="listitem"><PCLASS="para">The <EMCLASS="emphasis">nsswitch.conf</EM> or <EMCLASS="emphasis">svc.conf</EM> files.<ACLASS="indexterm"NAME="AUTOID-4364"></A><ACLASS="indexterm"NAME="AUTOID-4366"></A>Make sure the method used to look up hosts is correctly specified.</P></LI></UL><PCLASS="para">If you can'tfind or don't have permission to fix things at the system level, youcan fix them in your <EMCLASS="emphasis">client.cf</EM> file. Suppose, for example,that the canonical name showed up as the short hostname:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">  (canonical domain name) $j = here           <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> wrong</I></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4374"></A><ACLASS="indexterm"NAME="AUTOID-4377"></A>To fix this, you would need to redefine the <CODECLASS="literal">j</CODE> macro witha <CODECLASS="literal">D</CODE> command in the <EMCLASS="emphasis">client.cf</EM> file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Dj$w.$m               # The local official domain name</PRE></BLOCKQUOTE></P><PCLASS="para">This defines the canonical (fully qualified official)name to be the same as the local hostname (<CODECLASS="literal">$w</CODE>) witha dot and the domain name (<CODECLASS="literal">$m</CODE>) appended.Rerunning <EMCLASS="emphasis">sendmail</EM> as above would now display the correctinformation:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">  (canonical domain name) $j = here.us.edu    <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> correct</I></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4392"></A><ACLASS="indexterm"NAME="AUTOID-4394"></A><ACLASS="indexterm"NAME="AUTOID-4396"></A>In a similar manner you can fix <CODECLASS="literal">$w</CODE> and <CODECLASS="literal">$m</CODE> if either of them is wrong. But here we should stress that <EMCLASS="emphasis">sendmail</EM>goes to great lengths to get this information right.<ACLASS="indexterm"NAME="AUTOID-4402"></A><ACLASS="indexterm"NAME="AUTOID-4403"></A><ACLASS="indexterm"NAME="AUTOID-4404"></A><ACLASS="indexterm"NAME="AUTOID-4405"></A>&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 Defining Macros"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.2 Defining Macros"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_04.htm"TITLE="7.4 Things to Try"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.4 Things to Try"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">7.2 Defining Macros</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">7.4 Things to Try</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>