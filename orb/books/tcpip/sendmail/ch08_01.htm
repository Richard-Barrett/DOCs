<HTML><HEAD><TITLE>[Chapter 8] Addresses and Rules</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:35:21Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part01.htm"TITLE="I. A Tutorial"><LINKREL="prev"HREF="ch07_04.htm"TITLE="7.4 Things to Try"><LINKREL="next"HREF="ch08_02.htm"TITLE="8.2 Why Rules?"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_04.htm"TITLE="7.4 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.4 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_02.htm"TITLE="8.2 Why Rules?"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.2 Why Rules?"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="SML2-CH-8">8. Addresses and Rules</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#SML2-CH-8-SECT-1"TITLE="8.1 A Fictional Network">A Fictional Network</A><BR><ACLASS="sect1"HREF="ch08_02.htm"TITLE="8.2 Why Rules?">Why Rules?</A><BR><ACLASS="sect1"HREF="ch08_03.htm"TITLE="8.3 Rule Sets">Rule Sets</A><BR><ACLASS="sect1"HREF="ch08_04.htm"TITLE="8.4 Rules">Rules</A><BR><ACLASS="sect1"HREF="ch08_05.htm"TITLE="8.5 The Workspace">The Workspace</A><BR><ACLASS="sect1"HREF="ch08_06.htm"TITLE="8.6 The Flow of Addresses Through Rules">The Flow of Addresses Through Rules</A><BR><ACLASS="sect1"HREF="ch08_07.htm"TITLE="8.7 Wildcard Operators">Wildcard Operators</A><BR><ACLASS="sect1"HREF="ch08_08.htm"TITLE="8.8 Things to Try">Things to Try</A></P><P></P></DIV><PCLASS="para"></P><PCLASS="para">Before delving into the inner workings of rules, we needto create a fictional network to provide a commonground for discussing mail addresses.<ACLASS="indexterm"NAME="SML2-CH-8-IX-ADDRESSES"></A>&#13;</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-8-SECT-1">8.1 A Fictional Network</A></H2><PCLASS="para">Consider the network shown in<ACLASS="xref"HREF="ch08_01.htm#SML2-CH-8-FIG-0"TITLE="Domains in our fictional network">Figure 8.1</A>.It consists of three sites (theclouds) that are interconnected by high-speed networks (thesolid lines). Each site is a DNS <EMCLASS="emphasis">domain</EM> composed of many individualcomputers. Each domain is set up differently, as we will show,but from the user's point of view, the process of sending mail from a machinein one domain to a machine in another is the same in all cases.</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-8-FIG-0">Figure 8.1: Domains in our fictional network</A></H4><IMGCLASS="graphic"SRC="figs/sm0801.gif"ALT="Figure 8.1"><ACLASS="indexterm"NAME="AUTOID-4450"></A><ACLASS="indexterm"NAME="AUTOID-4452"></A><ACLASS="indexterm"NAME="AUTOID-4455"></A><PCLASS="para">A domain name is interpreted right to left. The <EMCLASS="emphasis">com</EM> in <EMCLASS="emphasis">.acme.com</EM>,for example, means that <EMCLASS="emphasis">acme</EM> is a part of the top-leveldomain <EMCLASS="emphasis">com</EM> (for <EMCLASS="emphasis">commercial</EM>). There are many commercialsites in the <EMCLASS="emphasis">com</EM> top-level domain, but only one <EMCLASS="emphasis">acme</EM>among them. Similarly, <EMCLASS="emphasis">edu</EM> is the top-level domain for educationalinstitutions (such as colleges and universities), and <EMCLASS="emphasis">gov</EM> is the top-level domain forgovernment organizations.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4468"></A><ACLASS="indexterm"NAME="AUTOID-4470"></A>A domain can consist of many machines. Each machine inside a domain hasa <EMCLASS="emphasis">fully qualified domain name</EM> that consists ofa hostname, a dot, and then its domain name.For example, <EMCLASS="emphasis">sec.acme.com</EM> is a fully qualified domain name becauseit consists of the hostname <EMCLASS="emphasis">sec</EM>, a dot, then thedomain name <EMCLASS="emphasis">acme.com</EM>.</P><PCLASS="para">Host and domain names are case-insensitive. That is, <EMCLASS="emphasis">sec.acme.com</EM>may be expressed in any of the following ways:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">sec.acme.com       <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> good</I>SEC.Acme.COM       <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> also good</I>sEc.aCmE.cOm       <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> ugly, but also good</I></PRE></BLOCKQUOTE></P><PCLASS="para"></P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-8-SECT-1-1">8.1.1 The dc.gov Domain</A></H3><PCLASS="para"><ACLASS="xref"HREF="ch08_01.htm#SML2-CH-8-FIG-1"TITLE="The dc.gov domain is accessible only through fbi.dc.gov">Figure 8.2</A>shows the <EMCLASS="emphasis">dc.gov</EM> domain fromthe inside. It is composed of three machines (although in the realworld it might be composed of many more). These three machinesare connected together on a private network for security (the solidlines). Onlyone machine, <EMCLASS="emphasis">fbi.dc.gov</EM>, has a connection to theoutside world. Mail from the outsideworld always goes to <EMCLASS="emphasis">fbi.dc.gov</EM> first; from there it is forwardedto the appropriate machine on the internal network.For example, the user <EMCLASS="emphasis">george</EM> eventuallyreceives his mail on his own machine (<EMCLASS="emphasis">wash.dc.gov</EM>),even though that mail is first handled by <EMCLASS="emphasis">fbi.dc.gov</EM>.</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-8-FIG-1">Figure 8.2: The dc.gov domain is accessible only through fbi.dc.gov</A></H4><IMGCLASS="graphic"SRC="figs/sm0802.gif"ALT="Figure 8.2"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4499"></A>The <EMCLASS="emphasis">fbi.dc.gov</EM> machine is called a <EMCLASS="emphasis">gateway</EM>because it forms a gate between the internal and externalnetworks through which all network traffic (such as mail) mustflow.<ACLASS="indexterm"NAME="AUTOID-4503"></A>It is also called a <EMCLASS="emphasis">forwarder</EM>, because it accepts mail formachines on the internal network, then forwards mail to them.</P><PCLASS="para">Despite the presence of a gateway, users in <EMCLASS="emphasis">.dc.gov</EM> stillreceive mail on their individual machines.Inside <EMCLASS="emphasis">.dc.gov</EM>, mail from one machine to another goesdirectly over the internal network. The gateway is not involved.But mail destined for the outside world must always first go tothe gateway, which then forwards that mail over the outside network.</P><PCLASS="para">Mail that is addressed to the domain (<EMCLASS="emphasis">dc.gov</EM> rather than a specificmachine such as <EMCLASS="emphasis">wash.dc.gov</EM>) will be delivered to the gatewaymachine. Unfortunately, in our fiction the gateway does notknow about any of the users at other machines in the domain. Asa consequence, mail to a user at the domain(<EMCLASS="emphasis">user@dc.gov</EM>) will bounce.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-8-SECT-1-2">8.1.2 The acme.com Domain</A></H3><PCLASS="para"><ACLASS="xref"HREF="ch08_01.htm#SML2-CH-8-FIG-2"TITLE="All machines in acme.com connect to the outside world">Figure 8.3</A>shows the <EMCLASS="emphasis">.acme.com</EM> domain. It is differentfrom <EMCLASS="emphasis">.dc.gov</EM> because all machinesare connected directly to the outside world and to one another.</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-8-FIG-2">Figure 8.3: All machines in acme.com connect to the outside world</A></H4><IMGCLASS="graphic"SRC="figs/sm0803.gif"ALT="Figure 8.3"><PCLASS="para">All machines can directly receive mail from the outside world.For example, the user <EMCLASS="emphasis">tim</EM> receives and reads his mail on themachine <EMCLASS="emphasis">boss.acme.com</EM>,but unlike the previous network, there is no gateway.</P><PCLASS="para">Like <EMCLASS="emphasis">fbi.dc.gov</EM>, the machine <EMCLASS="emphasis">sec.acme.com</EM> willreceive all mail addressedto the domain <EMCLASS="emphasis">acme.com</EM>. But unlikethe gateway <EMCLASS="emphasis">fbi.dc.gov</EM>, <EMCLASS="emphasis">sec.acme.com</EM> knowsabout all the users in its domain.[1]So mail to <EMCLASS="emphasis">tim@acme.com</EM>will be correctly forwarded to <EMCLASS="emphasis">tim</EM> at <EMCLASS="emphasis">boss.acme.com</EM>.&#13;</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] It runs <EMCLASS="emphasis">nis</EM> (formerly Yellow Pages)and can mount the home directories of all users.</P></BLOCKQUOTE></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-8-SECT-1-3">8.1.3 The us.edu Domain</A></H3><PCLASS="para"><ACLASS="xref"HREF="ch08_01.htm#SML2-CH-8-FIG-3"TITLE="Only mail.us.edu receives mail in the domain us.edu">Figure 8.4</A>shows a third way to set up a domain.In this domain, all mail (both inside and outside) is deliveredto the machine <EMCLASS="emphasis">mail.us.edu</EM>. Unlike the previous twoexamples, no mail is ever delivered tothe other machines. Instead, it is delivered into the master spooldirectory on <EMCLASS="emphasis">mail.us.edu</EM>. The other machines thennetwork <EMCLASS="emphasis">mount</EM> that directory so that users can read their mail fromany machine.</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-8-FIG-3">Figure 8.4: Only mail.us.edu receives mail in the domain us.edu</A></H4><IMGCLASS="graphic"SRC="figs/sm0804.gif"ALT="Figure 8.4"><PCLASS="para">Under this system, mail addresses need to contain onlythe name of the local recipient, an <CODECLASS="literal">@</CODE>, and thename of the domain (such as <EMCLASS="emphasis">user@us.edu</EM>).This arrangement eliminates the needfor users elsewhere in the world to know any specificmachine's name.</P><PCLASS="para">All three forms of domains have their advantages and disadvantages.We don't favor any one above another. In this and the chapters to follow, we consider our machine to be inthe <EMCLASS="emphasis">us.edu</EM> domain. We selected it onlybecause it allows the simplest <EMCLASS="emphasis">sendmail</EM>configuration file to be used.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-8-SECT-1-4">8.1.4 UUCP and Host Paths</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4556"></A><ACLASS="indexterm"NAME="AUTOID-4558"></A>In addition to our fictional network, consider two hosts that are connectedto <EMCLASS="emphasis">acme.com</EM> using dial-up lines (see<ACLASS="xref"HREF="ch08_01.htm#SML2-CH-8-FIG-4"TITLE="UUCP connections to sec.acme.com">Figure 8.5</A>).Under UUCP, one needs to know exactly how hostsare connected in order to send mail to any one of them.To get from <EMCLASS="emphasis">sec.acme.com</EM> to <EMCLASS="emphasis">sonya</EM>,for example, the mail needs to go through <EMCLASS="emphasis">lady</EM> first.</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-8-FIG-4">Figure 8.5: UUCP connections to sec.acme.com</A></H4><IMGCLASS="graphic"SRC="figs/sm0805.gif"ALT="Figure 8.5"><PCLASS="para">&#13;</P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_04.htm"TITLE="7.4 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.4 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_02.htm"TITLE="8.2 Why Rules?"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.2 Why Rules?"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">7.4 Things to Try</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.2 Why Rules?</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>