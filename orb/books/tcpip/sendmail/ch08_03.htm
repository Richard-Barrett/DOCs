<HTML><HEAD><TITLE>[Chapter 8] 8.3 Rule Sets</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:35:26Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch08_01.htm"TITLE="8. Addresses and Rules"><LINKREL="prev"HREF="ch08_02.htm"TITLE="8.2 Why Rules?"><LINKREL="next"HREF="ch08_04.htm"TITLE="8.4 Rules"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_02.htm"TITLE="8.2 Why Rules?"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.2 Why Rules?"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8<BR>Addresses and Rules</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_04.htm"TITLE="8.4 Rules"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.4 Rules"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-8-SECT-3">8.3 Rule Sets</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-8-IX-RULE-SETS"></A>Sequences of rules are grouped together into rule sets. Eachset is similar to a subroutine. A rule set is declared withthe <CODECLASS="literal">S</CODE> command, which must begin a line in <EMCLASS="emphasis">sendmail.cf</EM>.<ACLASS="indexterm"NAME="AUTOID-4619"></A>For example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">S0</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4624"></A>This begins the declaration of the rules that form rule setnumber 0. Rule sets are numbered starting from 0.[2]<ACLASS="indexterm"NAME="AUTOID-4630"></A>Sets 0 through 5[3]are internally defined by <EMCLASS="emphasis">sendmail</EM>to have very specific purposes, as shown in<ACLASS="xref"HREF="ch08_03.htm#SML2-CH-8-TAB-0"TITLE="The Purposes of Rule Sets">Table 8.1</A>.We'll expand on them throughout the rest of the tutorial.Rule-set definitions may appear in any order inthe configuration file. For example, rule set <CODECLASS="literal">S5</CODE> may be defined first,followed by <CODECLASS="literal">S2</CODE> and then <CODECLASS="literal">S7</CODE>. The rule setsare gathered when the <EMCLASS="emphasis">sendmail.cf</EM> file is read and are then sortedinternally by <EMCLASS="emphasis">sendmail</EM>.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] Beginning with V8.7, rule sets may have symbolic names too. We show this in<ACLASS="xref"HREF="ch11_01.htm"TITLE="Rule Sets 1 and S=">Chapter 11, <CITECLASS="chapter">Rule Sets 1 and S=</CITE></A>.</P><PCLASS="para">[3] Other rule sets may be used by future versions of <EMCLASS="emphasis">sendmail</EM>, so avoidusing rule sets 6 through 9.</P></BLOCKQUOTE><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="SML2-CH-8-TAB-0">Table 8.1: The Purposes of Rule Sets</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Rule Set</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Purpose</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">0</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Resolve a mail delivery agent</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">1</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Process sender address</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">2</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Process recipient address</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">3</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Preprocess all addresses</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">4</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Postprocess all addresses</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">5</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Rewrite unaliased local users</TD></TR></TBODY></TABLE><PCLASS="para">The <EMCLASS="emphasis">client.cf</EM> file contains no rule-set definitions yet.To observe the effect of nonexistent rules, rerun <EMCLASS="emphasis">sendmail</EM>on that file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>./sendmail -Cclient.cf -bt</B></CODE>ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)Enter &lt;ruleset&gt; &lt;address&gt;&gt;</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4676"></A><ACLASS="indexterm"NAME="AUTOID-4679"></A><ACLASS="indexterm"NAME="AUTOID-4681"></A>The <CODECLASS="literal">-bt</CODE> command-line switchcauses <EMCLASS="emphasis">sendmail</EM> to run in address-testing mode.In this mode, <EMCLASS="emphasis">sendmail</EM> waits for you to type a rule set andan address.[4]<ACLASS="indexterm"NAME="AUTOID-4690"></A>It then shows you how the rule set <EMCLASS="emphasis">rewrites</EM>the address.At the <CODECLASS="literal">&gt;</CODE> prompt, you can now enter an address by specifying a rule-set number, then a space, and then a mail address: </P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] V8.7's rule-testing mode can do much more (see <ACLASS="xref"HREF="ch38_01.htm#SML2-CH-38-SECT-1"TITLE="Overview">Section 38.1, "Overview"</A>).</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>0 gw@wash.dc.gov</B></CODE>rewrite: ruleset  0   input: gw @ wash . dc . govrewrite: ruleset  0 returns: gw @ wash . dc . gov&gt;</PRE></BLOCKQUOTE></P><PCLASS="para">The rule set specifiedis 0, but you can specify any number.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-4700"></A>The <CODECLASS="literal">rewrite:</CODE> word that begins each line of address-testing modeoutput is there simply to distinguish rewriting lines when they aremixed with other kinds of debugging output. The <CODECLASS="literal">input</CODE>means that <EMCLASS="emphasis">sendmail</EM> placed the address into the workspace(more about this soon).The <CODECLASS="literal">returns</CODE> shows the result after the rule set hasrewritten that address on the basis of its rules.</P><PCLASS="para">The address that is fed to <EMCLASS="emphasis">sendmail</EM>, <CODECLASS="literal">gw@wash.dc.gov</CODE>,is first split into parts (tokens) based on two sets ofseparating characters. Both are defined internally.One can be changed in your configuration file;[5]the other cannot:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[5] Prior to V8.7, the <CODECLASS="literal">o</CODE> macro was used in theconfiguration file to define different or more characters.Beginning with V8.7, the <CODECLASS="literal">OperatorChars</CODE> option is usedinstead.<ACLASS="indexterm"NAME="AUTOID-4714"></A></P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">.:@[]          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> you can change these</I>()&lt;&gt;,;\&quot;\r\n   <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> you cannot change these</I></PRE></BLOCKQUOTE></P><PCLASS="para">The two sets are combined into one, and the result is used toseparate the various parts of email addresses. Theaddress <EMCLASS="emphasis">gw@wash.dc.gov</EM> is divided into seven tokens becausethe <CODECLASS="literal">@</CODE> and dot are both in the list of separation characters.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">rewrite: ruleset  0   input: gw @ wash . dc . govrewrite: ruleset  0 returns: gw @ wash . dc . gov</PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">input:</CODE> line shows seven tokens passed to ruleset 0. The <CODECLASS="literal">returns:</CODE> line shows, since there is no rule set0, that the undefined &nbsp;- pty) rule set returns those tokens unchanged.</P><PCLASS="para">If a rule set is undefined, the result is thesame as if it were defined but had no rules associated with it.It is like a C language subroutinethat contains nothing but a <EMCLASS="emphasis">return</EM> statement.It does nothing and produces no errors.<ACLASS="indexterm"NAME="AUTOID-4730"></A>&#13;</P></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_02.htm"TITLE="8.2 Why Rules?"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.2 Why Rules?"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_04.htm"TITLE="8.4 Rules"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.4 Rules"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.2 Why Rules?</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.4 Rules</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>