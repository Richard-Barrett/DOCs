<HTML><HEAD><TITLE>[Chapter 8] 8.6 The Flow of Addresses Through Rules</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:35:42Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch08_01.htm"TITLE="8. Addresses and Rules"><LINKREL="prev"HREF="ch08_05.htm"TITLE="8.5 The Workspace"><LINKREL="next"HREF="ch08_07.htm"TITLE="8.7 Wildcard Operators"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_05.htm"TITLE="8.5 The Workspace"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.5 The Workspace"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8<BR>Addresses and Rules</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_07.htm"TITLE="8.7 Wildcard Operators"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.7 Wildcard Operators"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-8-SECT-6">8.6 The Flow of Addresses Through Rules</A></H2><PCLASS="para">When rule sets contain many rules, addresses flowfrom the first rule that is declared through the last (top down).To illustrate, remove the demo rule that you added tothe <EMCLASS="emphasis">client.cf</EM> file, and replace it with three newdemo rules:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Rleft.side     new.stuff          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> remove</I><CODECLASS="userinput"><B>Rx     y                          </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I><CODECLASS="userinput"><B>Rz     x                          </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I><CODECLASS="userinput"><B>Rx     w                          </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I></PRE></BLOCKQUOTE></P><PCLASS="para">&#13;Remember that the LHS of each rule must be separated from the RHSby one or more tab characters.</P><PCLASS="para">Before you test these new rules,consider what they do. The first rulerewrites any <CODECLASS="literal">x</CODE> in the workspace into a <CODECLASS="literal">y</CODE>.The second rule rewrites any <CODECLASS="literal">z</CODE> in the workspaceinto an <CODECLASS="literal">x</CODE>. The last rule rewrites any<CODECLASS="literal">x</CODE> that it finds in the workspace into a <CODECLASS="literal">w</CODE>.</P><PCLASS="para">Now run <EMCLASS="emphasis">sendmail</EM> in rule-testing mode once again:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>./sendmail -Cclient.cf -bt</B></CODE>ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)Enter &lt;ruleset&gt; &lt;address&gt;&gt;</PRE></BLOCKQUOTE></P><PCLASS="para">Enter rule set 0 and the letter <CODECLASS="literal">x</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>0 x</B></CODE>rewrite: ruleset  0   input: xrewrite: ruleset  0 returns: y</PRE></BLOCKQUOTE></P><PCLASS="para">This shows that any <CODECLASS="literal">x</CODE> in the workspace is rewritten by the first ruleto become a <CODECLASS="literal">y</CODE>. The new workspace is carried down to the second rule,where it fails, then to the third rule, where it also fails:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"> x          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> the original workspace</I> <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I> <ICLASS="lineannotation">exact match, so: ``true''</I> <ICLASS="lineannotation"><IMGSRC="../chars/darr.gif"ALT="-v"></I>Rx     y    <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> first rule rewrites</I> y          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-">    the workspace to be this</I> <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I> <ICLASS="lineannotation">does not match, so skip</I> <ICLASS="lineannotation"><IMGSRC="../chars/darr.gif"ALT="-v"></I>Rz     x    <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> second rule</I> y          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-">    the workspace is still this</I> <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I> <ICLASS="lineannotation">does not match, so skip</I> <ICLASS="lineannotation"><IMGSRC="../chars/darr.gif"ALT="-v"></I>Rx     w    <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> third rule</I> y          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-">    the workspace is still this</I></PRE></BLOCKQUOTE></P><PCLASS="para">The important point here is that each rule matches its LHSto the <EMCLASS="emphasis">current</EM> contents of the workspace. Preceding rulesmay have modified that workspace. The third rule, for example,tries to match an <CODECLASS="literal">x</CODE> but fails because the first rulechanged our <CODECLASS="literal">x</CODE> into a <CODECLASS="literal">y</CODE>.</P><PCLASS="para">Now enter rule set 0 and the letter <CODECLASS="literal">z</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>0 z</B></CODE>rewrite: ruleset  0   input: zrewrite: ruleset  0 returns: w</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;Notice that any <CODECLASS="literal">z</CODE> in the workspace is rewritten to be a <CODECLASS="literal">w</CODE>.Look at the flow of the <CODECLASS="literal">z</CODE> through the rules to see why this happened:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"> z          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> the original workspace</I> <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I> <ICLASS="lineannotation">does not match, so skip</I> <ICLASS="lineannotation"><IMGSRC="../chars/darr.gif"ALT="-v"></I>Rx     y    <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> first rule</I> z          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-">    the workspace remains this</I> <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I> <ICLASS="lineannotation">exact match, so ...</I> <ICLASS="lineannotation"><IMGSRC="../chars/darr.gif"ALT="-v"></I>Rz     x    <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> second rule rewrites</I> x          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-">    the workspace to be this</I> <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I> <ICLASS="lineannotation">exact match, so ... </I> <ICLASS="lineannotation"><IMGSRC="../chars/darr.gif"ALT="-v"></I>Rx     w    <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> third rule rewrites</I> w          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-">    the workspace to be this</I></PRE></BLOCKQUOTE></P><PCLASS="para">In this instance the first rule does nothing. The second rule matches the <CODECLASS="literal">z</CODE> andchanges the workspace into an <CODECLASS="literal">x</CODE>. The third rule sees the rewritten workspace.It changes the <CODECLASS="literal">x</CODE> (the current contents of the workspace) into a <CODECLASS="literal">w</CODE>.</P><PCLASS="para">Now feed one more letter into <EMCLASS="emphasis">sendmail</EM> in rule-testing mode.This time, enter anything other than an <CODECLASS="literal">x</CODE> or <CODECLASS="literal">z</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>0 b</B></CODE>rewrite: ruleset  0   input: brewrite: ruleset  0 returns: b</PRE></BLOCKQUOTE></P><PCLASS="para">Here, the workspace remains unchangedbecause <CODECLASS="literal">b</CODE> does not match the left-hand side in anyof the three rules. If the LHS of a rule fails to match the workspace,that rule is skipped, and the workspace remains unchanged.&#13;</P></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_05.htm"TITLE="8.5 The Workspace"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.5 The Workspace"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_07.htm"TITLE="8.7 Wildcard Operators"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.7 Wildcard Operators"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.5 The Workspace</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.7 Wildcard Operators</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>