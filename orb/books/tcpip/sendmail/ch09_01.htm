<HTML><HEAD><TITLE>[Chapter 9] Rule Set 0</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:35:55Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part01.htm"TITLE="I. A Tutorial"><LINKREL="prev"HREF="ch08_08.htm"TITLE="8.8 Things to Try"><LINKREL="next"HREF="ch09_02.htm"TITLE="9.2 The RHS Triple"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_08.htm"TITLE="8.8 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.8 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 9</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_02.htm"TITLE="9.2 The RHS Triple"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.2 The RHS Triple"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="SML2-CH-9">9. Rule Set 0</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#SML2-CH-9-SECT-1"TITLE="9.1 Introducing Rule Set&nbsp;0">Introducing Rule Set&nbsp;0</A><BR><ACLASS="sect1"HREF="ch09_02.htm"TITLE="9.2 The RHS Triple">The RHS Triple</A><BR><ACLASS="sect1"HREF="ch09_03.htm"TITLE="9.3 Testing Rule Set 0">Testing Rule Set 0</A><BR><ACLASS="sect1"HREF="ch09_04.htm"TITLE="9.4 The error Delivery Agent">The error Delivery Agent</A><BR><ACLASS="sect1"HREF="ch09_05.htm"TITLE="9.5 Things to Try">Things to Try</A></P><P></P></DIV><PCLASS="para"></P><PCLASS="para">The function of rule set 0 is to decide which mail delivery agentwill handle delivery for a particular recipient address.<ACLASS="xref"HREF="ch09_01.htm#SML2-CH-9-FIG-0"TITLE="The flow of addresses for rule set 0">Figure 9.1</A>shows how rule set 0 relates to the other rule sets.<ACLASS="indexterm"NAME="SML2-CH-9-IX-DELIVERY-AGENTS-MTAS-CHOOSING"></A><ACLASS="indexterm"NAME="SML2-CH-9-IX-RULE-SETS-RULE-SET-0"></A></P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-9-FIG-0">Figure 9.1: The flow of addresses for rule set 0</A></H4><IMGCLASS="graphic"SRC="figs/sm0901.gif"ALT="Figure 9.1"><PCLASS="para">&#13;Rule set 0 is called once for each recipient of a mail message.Rule set 0 determinesa <EMCLASS="emphasis">triple</EM> for each address. The triple iscomposed of three parts: the symbolic name of the mail delivery agent, the name of the user to whom the mail is addressed, and the name of thehost to which the mail will be sent.  We'll expand on these soonand cover the other rule sets in later chapters.&#13;</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-9-SECT-1">9.1 Introducing Rule Set&nbsp;0</A></H2><PCLASS="para">Recall that one goal of the <EMCLASS="emphasis">client.cf</EM> file is to cause <EMCLASS="emphasis">sendmail</EM>to forward all mail to a central hub machine for processing. To lay the groundwork for this, we designed the <CODECLASS="literal">hub</CODE> delivery agent in <ACLASS="xref"HREF="ch06_01.htm"TITLE="The Mail Hub and Delivery Agents">Chapter 6, <CITECLASS="chapter">The Mail Hub and Delivery Agents</CITE></A>,and declared it like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># Delivery agent definition to forward mail to hubMhub,   P=[IPC], S=0, R=0, F=mDFMuXa, T=DNS/RFC822/SMTP, A=IPC $h</PRE></BLOCKQUOTE></P><PCLASS="para">As this goal implies,we don't want to design any fancy rules for rewritingthe recipient's address, we simply want to send it to the hub as is. </P><PCLASS="para">The rule set that we show below does just that. It maylook complicated, but recall that its one rule is basically just an if-thenstatement:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">S0R$+     $#hub $@${REMOTE} $:$1          forward to hub</PRE></BLOCKQUOTE></P><PCLASS="para">The first line (the <CODECLASS="literal">S0</CODE>) declares the start of rule set 0.The <CODECLASS="literal">R</CODE> line in this example is the first of many possible rules that will formrule set 0.</P><PCLASS="para">You saw the LHS of this rule in the preceding chapter. The <CODECLASS="literal">$+</CODE> wildcard operatoris used to match <EMCLASS="emphasis">one or more</EM> tokens in the workspace. Essentially,this LHS will match anything in the workspace but will fail to matchan empty workspace.&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_08.htm"TITLE="8.8 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.8 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_02.htm"TITLE="9.2 The RHS Triple"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.2 The RHS Triple"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.8 Things to Try</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">9.2 The RHS Triple</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>