<HTML><HEAD><TITLE>[Chapter 9] 9.2 The RHS Triple</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:35:58Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch09_01.htm"TITLE="9. Rule Set 0"><LINKREL="prev"HREF="ch09_01.htm"TITLE="9.1 Introducing Rule Set&nbsp;0"><LINKREL="next"HREF="ch09_03.htm"TITLE="9.3 Testing Rule Set 0"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_01.htm"TITLE="9.1 Introducing Rule Set&nbsp;0"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.1 Introducing Rule Set&nbsp;0"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 9<BR>Rule Set 0</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_03.htm"TITLE="9.3 Testing Rule Set 0"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.3 Testing Rule Set 0"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-9-SECT-2">9.2 The RHS Triple</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-9-IX-RHS-RULE-RHS-TRIPLE"></A><ACLASS="indexterm"NAME="SML2-CH-9-IX-TRIPLE-RHS"></A>The job of rule set 0 is to resolveeach address into a triple: the delivery agent's symbolicname, the name of the host, and the name of the user in that order (see<ACLASS="xref"HREF="ch09_02.htm#SML2-CH-9-FIG-1"TITLE="Rule set 0 resolves a triple">Figure 9.2</A>).</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-9-FIG-1">Figure 9.2: Rule set 0 resolves a triple</A></H4><IMGCLASS="graphic"SRC="figs/sm0902.gif"ALT="Figure 9.2"><PCLASS="para">Recall that rules are like if-then statements. If the rule in the LHS evaluates to true,then <EMCLASS="emphasis">sendmail</EM> evaluates the RHS:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"> <ICLASS="lineannotation">if true <IMGSRC="../chars/rarr.gif"ALT="-&gt;">         do this</I> <IMGSRC="../chars/darr.gif"ALT="-v">         <IMGSRC="../chars/darr.gif"ALT="-v">R$+         $#hub $@${REMOTE} $:$1          forward to hub <IMGSRC="../chars/darr.gif"ALT="-v"><ICLASS="lineannotation">otherwise go to next rule</I></PRE></BLOCKQUOTE></P><PCLASS="para">This RHS resolves all three parts of the triple. To accomplish this,the text of the RHS is <EMCLASS="emphasis">transformed</EM> and then copied into the workspace:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$#hub           <ICLASS="lineannotation"><IMGSRC="../chars/rarr.gif"ALT="-&gt;"> copied as is (delivery agent part)</I>$@${REMOTE}     <ICLASS="lineannotation"><IMGSRC="../chars/rarr.gif"ALT="-&gt;"> defined macro is expanded (host part)</I>$:$1            <ICLASS="lineannotation"><IMGSRC="../chars/rarr.gif"ALT="-&gt;"> positional macro is expanded (user part)</I></PRE></BLOCKQUOTE></P><PCLASS="para">We examine these parts in order, showing howeach is transformed and copied into the workspace. The transformation operators are shown in<ACLASS="xref"HREF="ch09_02.htm#SML2-CH-9-TAB-0"TITLE="Rule Set 0 RHS Transformation Operators">Table 9.1</A>.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="SML2-CH-9-TAB-0">Table 9.1: Rule Set 0 RHS Transformation Operators</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Operator</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Description</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">$#</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The mail delivery agent</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">$@</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The host</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">$:</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The user</TD></TR></TBODY></TABLE><PCLASS="para"></P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-9-SECT-2-1">9.2.1 The Delivery Agent ($#)</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5272"></A><ACLASS="indexterm"NAME="AUTOID-5275"></A>The first part of the triple is the name of the delivery agent.The RHS <CODECLASS="literal">$#</CODE> transformation operator tells <EMCLASS="emphasis">sendmail</EM> that the text following(up to but not including the next operator, ignoring spaces) is the symbolic name of the delivery agent to use. </P><PCLASS="para">The symbolic name <CODECLASS="literal">hub</CODE> was defined in the <EMCLASS="emphasis">client.cf</EM> fileas</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># Delivery agent definition to forward mail to hubMhub,   P=[IPC], S=0, R=0, F=mDFMuXa, T=DNS/RFC822/SMTP, A=IPC $h</PRE></BLOCKQUOTE></P><PCLASS="para">When the RHS is copied into the workspace, any transformation operatorssuch as <CODECLASS="literal">$#</CODE> are copied as is and become new tokens:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$#     <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> the workspace thus far</I></PRE></BLOCKQUOTE></P><PCLASS="para">&#13;When text, such as <CODECLASS="literal">hub</CODE>, is copied into the workspace,it is tokenized by using the separation characters:[1]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] As a result, the symbolic name of the mail delivery agent cannotcontain any separation characters.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">.:@[]          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> you can change these</I>()&lt;&gt;,;\&quot;\r\n   <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> you cannot change these</I></PRE></BLOCKQUOTE></P><PCLASS="para">Since our symbolic name <CODECLASS="literal">hub</CODE> contains none of those characters,it is copied as a single token into the workspace:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$# hub      <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> the workspace thus far</I></PRE></BLOCKQUOTE></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-9-SECT-2-2">9.2.2 The Host ($@)</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5306"></A><ACLASS="indexterm"NAME="AUTOID-5309"></A>The second part of the triple is the hostname.The RHS <CODECLASS="literal">$@</CODE> transformation operator tells <EMCLASS="emphasis">sendmail</EM> that the text following(up to, but not including, the next operator and ignoring spaces) is the name of the host to which the mail will be sent.Whenever <EMCLASS="emphasis">sendmail</EM> encounters <CODECLASS="literal">${</CODE><CODECLASS="replaceable"><I>name</I></CODE><CODECLASS="literal">}</CODE> in the RHS,it uses the value of the named macro.You previously defined <CODECLASS="literal">${REMOTE}</CODE> to containthe name of the host to which all mail will be sent:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">D{REMOTE}mailhost              # The name of the mail hub</PRE></BLOCKQUOTE></P><PCLASS="para">The second part of the triple is now copied to the workspace.The name of the host is in <CODECLASS="literal">${REMOTE}</CODE>. Combined, they look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$@${REMOTE}</PRE></BLOCKQUOTE></P><PCLASS="para"><CODECLASS="literal">$@</CODE> is copied as is. <CODECLASS="literal">${REMOTE}</CODE> is expanded(its value taken), and then that value is broken into tokens andcopied into the workspace.If the value of the <CODECLASS="literal">${REMOTE}</CODE> macro is <CODECLASS="literal">mailhost</CODE>,the workspace will look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$# hub $@ mailhost   <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> the workspace thus far</I></PRE></BLOCKQUOTE></P><PCLASS="para"></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-9-SECT-2-3">9.2.3 The User ($:)</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5337"></A><ACLASS="indexterm"NAME="AUTOID-5340"></A>The third part of the triple is the username.The RHS <CODECLASS="literal">$:</CODE> transformation operator tells <EMCLASS="emphasis">sendmail</EM> that the following text(up to, but not including, the next operator and ignoring spaces) is the user to whom mail is being sent. <ACLASS="indexterm"NAME="AUTOID-5345"></A><ACLASS="indexterm"NAME="AUTOID-5347"></A>Here, the username is determined by the <CODECLASS="literal">$1</CODE>, which is called a &quot;positional operator&quot;:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$:$1</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5355"></A>When <EMCLASS="emphasis">sendmail</EM> sees a positional operator, a <CODECLASS="literal">$</CODE> followed by a singledigit in the RHS, it counts up the number ofwildcard operators inthe LHS. In this example the LHS has only one wildcard operator,<CODECLASS="literal">$+</CODE>, so <CODECLASS="literal">$1</CODE> refers to that operator. If there weremore than one wildcard operator in the LHS, for example,</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$+.$+<IMGSRC="../chars/uarr.gif"ALT="-^">  <IMGSRC="../chars/uarr.gif"ALT="-^">$1 $2</PRE></BLOCKQUOTE></P><PCLASS="para">then <CODECLASS="literal">$1</CODE> would refer to the first <CODECLASS="literal">$+</CODE> and<CODECLASS="literal">$2</CODE> to the second <CODECLASS="literal">$+</CODE>.</P><PCLASS="para">A <CODECLASS="literal">$</CODE><CODECLASS="replaceable"><I>digit</I></CODE> tells <EMCLASS="emphasis">sendmail</EM> to copywhatever tokens the corresponding LHS wildcard operator matched.If the original workspace had contained</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">boss @ acme    <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> in the original workspace</I></PRE></BLOCKQUOTE></P><PCLASS="para">then the lone <CODECLASS="literal">$+</CODE> (match one or more) LHS wildcard operator wouldmatch the entire workspace (all of its tokens). </P><PCLASS="para">All of theoriginal workspace's tokens are then copied.The workspace contains</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$# hub $@ mailhost $: boss @ acme</PRE></BLOCKQUOTE></P><PCLASS="para">After <EMCLASS="emphasis">sendmail</EM> has completed writing the workspace,the workspace (the triple) is returned.<ACLASS="indexterm"NAME="AUTOID-5383"></A><ACLASS="indexterm"NAME="AUTOID-5384"></A>&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_01.htm"TITLE="9.1 Introducing Rule Set&nbsp;0"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.1 Introducing Rule Set&nbsp;0"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_03.htm"TITLE="9.3 Testing Rule Set 0"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.3 Testing Rule Set 0"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">9.1 Introducing Rule Set&nbsp;0</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">9.3 Testing Rule Set 0</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>