<HTML><HEAD><TITLE>[Chapter 9] 9.4 The error Delivery Agent</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:36:01Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch09_01.htm"TITLE="9. Rule Set 0"><LINKREL="prev"HREF="ch09_03.htm"TITLE="9.3 Testing Rule Set 0"><LINKREL="next"HREF="ch09_05.htm"TITLE="9.5 Things to Try"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_03.htm"TITLE="9.3 Testing Rule Set 0"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.3 Testing Rule Set 0"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 9<BR>Rule Set 0</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_05.htm"TITLE="9.5 Things to Try"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.5 Things to Try"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-9-SECT-4">9.4 The error Delivery Agent</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-9-IX-DELIVERY-AGENTS-MTAS-FOR-ERRORS-ERRORS"></A><ACLASS="indexterm"NAME="SML2-CH-9-IX-ERRORS-DELIVERY-AGENT-FOR"></A>Although all mail, under the hub scheme, should be passedto the hub for processing, certain errors should still behandled locally. By recognizing these errors locally, the user is advisedof mistakes immediately, rather than having to wait for mail to bounce.</P><PCLASS="para">When we discussed delivery agents, we showed you that <EMCLASS="emphasis">sendmail</EM>requires the <CODECLASS="literal">local</CODE> delivery agent. Because<EMCLASS="emphasis">sendmail</EM> requires it, you had to define it yourself (tokeep <EMCLASS="emphasis">sendmail</EM> from complaining):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mlocal, P=/bin/mail, F=lsDFMAw5:/|@rmn, S=0, R=0, A=mail -d $u</PRE></BLOCKQUOTE></P><PCLASS="para">Inside <EMCLASS="emphasis">sendmail</EM>, a specially defined deliveryagent exists. Called <CODECLASS="literal">error</CODE>, that deliveryagent is one that you can't define yourself.</P><PCLASS="para">The <CODECLASS="literal">error</CODE> delivery agent is the internal mechanism that<EMCLASS="emphasis">sendmail</EM> uses to process errors. When thatdelivery agent is selected, it causes <EMCLASS="emphasis">sendmail</EM> to print the offendingaddress, then theusername part of the triple (the <CODECLASS="literal">$:</CODE> part) as an error message.</P><PCLASS="para">For example, recall the earlier experiment with three demo rules:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">S0R@      oneR@$+    twoR$+@$+  three</PRE></BLOCKQUOTE></P><PCLASS="para">When this rule set was given an address of <EMCLASS="emphasis">@host</EM> (notethe missing user part), the RHS rewrote the workspace to be <CODECLASS="literal">two</CODE>.[3]We use a similar technique toselect <EMCLASS="emphasis">sendmail</EM>'s built-inerror handling delivery agent <CODECLASS="literal">error</CODE>.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] We are fudging here for the sake of a simple example. In reality a leading<CODECLASS="literal">@</CODE> is legal for route addresses(see the <CODECLASS="literal">DontPruneRoutes</CODE> option in <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-20"TITLE="">Section 34.8.20, DontPruneRoutes (R)</A>,how route addresses are handled in rules in <ACLASS="xref"HREF="ch29_04.htm#SML2-CH-29-SECT-4-3"TITLE="Handling Routing Addresses">Section 29.4.3, "Handling Routing Addresses"</A>,and the <CODECLASS="literal">F=d</CODE> delivery agent flag in <ACLASS="xref"HREF="ch30_08.htm#SML2-CH-30-SECT-8-16"TITLE="">Section 30.8.16, F=d</A>).</P></BLOCKQUOTE><PCLASS="para">Add the following new line to the <EMCLASS="emphasis">client.cf</EM> file's rule set0. Don't forget that the LHS, RHS, and comment must be separatedfrom each other by tab characters, not spaces. But note thatthe RHS may contain space characters (not tabs) for clarity.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">S0 # select delivery agent<CODECLASS="userinput"><B>R@$+    $#error $: Missing user name                           </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I>R$+     $#hub $@${REMOTE} $:$1          forward to hub</PRE></BLOCKQUOTE></P><PCLASS="para">Run <EMCLASS="emphasis">sendmail</EM> again, this time to see which addressesare caught locally as errors and which are passed onward to thecentral hub.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>./sendmail -Cclient.cf -bt</B></CODE>ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)Enter &lt;ruleset&gt; &lt;address&gt;&gt; <CODECLASS="userinput"><B>0 @acme</B></CODE>rewrite: ruleset  0   input: @ acmerewrite: ruleset  0 returns: $# error $: Missing user name</PRE></BLOCKQUOTE></P><PCLASS="para">Here, you are supplying an address that lacks a username. As expected,the <CODECLASS="literal">error</CODE> delivery agent is selected. If someone attemptedto send mail to this address, they would get the error<ACLASS="indexterm"NAME="AUTOID-5501"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">@acme... Missing user name</PRE></BLOCKQUOTE></P><PCLASS="para">Now feed <EMCLASS="emphasis">sendmail</EM> a legal address:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>0 boss@acme</B></CODE>rewrite: ruleset  0   input: boss @ acmerewrite: ruleset  0 returns: $# hub $@ mailhost $: boss @ acme</PRE></BLOCKQUOTE></P><PCLASS="para">This legal address, one with both a user and host part, bypasses theerror-handling rule and will be accepted for delivery via the <CODECLASS="literal">hub</CODE>delivery agent.</P><PCLASS="para">Take some time to experiment. Give <EMCLASS="emphasis">sendmail</EM> an assortmentof addresses and try to predict which will produce errors andwhich will not.<ACLASS="indexterm"NAME="AUTOID-5514"></A><ACLASS="indexterm"NAME="AUTOID-5515"></A>&#13;</P></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_03.htm"TITLE="9.3 Testing Rule Set 0"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.3 Testing Rule Set 0"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_05.htm"TITLE="9.5 Things to Try"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.5 Things to Try"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">9.3 Testing Rule Set 0</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">9.5 Things to Try</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>