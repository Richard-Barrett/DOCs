<HTML><HEAD><TITLE>[Chapter 10] Rule Set 3</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:36:09Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part01.htm"TITLE="I. A Tutorial"><LINKREL="prev"HREF="ch09_05.htm"TITLE="9.5 Things to Try"><LINKREL="next"HREF="ch10_02.htm"TITLE="10.2 Rule Set 3"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_05.htm"TITLE="9.5 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.5 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 10</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_02.htm"TITLE="10.2 Rule Set 3"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.2 Rule Set 3"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="SML2-CH-10">10. Rule Set 3</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#SML2-CH-10-SECT-1"TITLE="10.1 Why Preprocess?">Why Preprocess?</A><BR><ACLASS="sect1"HREF="ch10_02.htm"TITLE="10.2 Rule Set 3">Rule Set 3</A><BR><ACLASS="sect1"HREF="ch10_03.htm"TITLE="10.3 Missing Addresses">Missing Addresses</A><BR><ACLASS="sect1"HREF="ch10_04.htm"TITLE="10.4 Nested Angle Brackets">Nested Angle Brackets</A><BR><ACLASS="sect1"HREF="ch10_05.htm"TITLE="10.5 Details of Rule Flow">Details of Rule Flow</A><BR><ACLASS="sect1"HREF="ch10_06.htm"TITLE="10.6 Things to Try">Things to Try</A></P><P></P></DIV><PCLASS="para"></P><PCLASS="para">The job of rule sets 1 through 4<ACLASS="indexterm"NAME="SML2-CH-10-IX-RULE-SETS-RULE-SET-3"></A>is to change recipient and sender addressesin both the header and the envelope[1]into a form appropriate for a given delivery agent.Each kind of address takes a different path throughthe rule sets. The possibilities (which can be confusing) are illustrated in<ACLASS="xref"HREF="ch10_01.htm#SML2-CH-10-FIG-0"TITLE="The flow of addresses through rule sets">Figure 10.1</A>.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] Headers and envelopes were introduced in<ACLASS="xref"HREF="ch01_01.htm"TITLE="Introduction">Chapter 1, <CITECLASS="chapter">Introduction</CITE></A>.</P></BLOCKQUOTE><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-10-FIG-0">Figure 10.1: The flow of addresses through rule sets</A></H4><IMGCLASS="graphic"SRC="figs/sm1001.gif"ALT="Figure 10.1"><PCLASS="para">The sender's address on the envelope, for example, isfirst rewritten by rule set 3, then by rule set 1, thenby the rule set specified by the <CODECLASS="literal">S=</CODE> equate in the deliveryagent definition, and finally by rule set 4.</P><PCLASS="para">All addresses are first processed by rule set 3.All sender addresses flow through rule set 3 and then 1. All recipientaddresses flow through 3 and then 2. Each then flows through therule set that is specified by the <CODECLASS="literal">S=</CODE> or <CODECLASS="literal">R=</CODE> equate forthe delivery agent that will handle the message.Each is then postprocessed by rule set 4.But because the role of rule set 0 is to select a deliveryagent (and therefore the appropriate <CODECLASS="literal">S=</CODE> and <CODECLASS="literal">R=</CODE> equates),rule set 0 needs to process an address before it cango through rule set 1 or 2.</P><PCLASS="para">In the previous few chapters you began to learn about rules sets in generaland rule set 0 specifically.However, before the recipient address can be processed by rule set 0,it must first be processed by rule set 3. All addresses arepreprocessed by rule set 3.&#13;</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-10-SECT-1">10.1 Why Preprocess?</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5562"></A><ACLASS="indexterm"NAME="AUTOID-5565"></A><ACLASS="indexterm"NAME="AUTOID-5569"></A>To understand why a preprocessing rule set (rule set 3) is needed,we need to briefly examine how users specify addresses.One common way to send mail is by using the reply feature of your<ACLASS="indexterm"NAME="AUTOID-5573"></A>mail-reading program (MUA). That feature looks at the <CODECLASS="literal">From:</CODE>line in the mail message's header and uses the text that followsas the address for the reply. That text cantake one of two forms:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">From: address (Full Name and other comments)From: Full Name &lt;address&gt;</PRE></BLOCKQUOTE></P><PCLASS="para">Both forms are legal. The first is an email address followed byarbitrary text in parentheses, usually the user'sfull name. The parentheses form a comment. Your mail reading programoften strips that comment before sending the mail, so <EMCLASS="emphasis">sendmail</EM>sees only <CODECLASS="literal">address</CODE>.But even if the comment isn't stripped, <EMCLASS="emphasis">sendmail</EM> removes(and saves) the text in parentheses before entering rule set 3.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5583"></A><ACLASS="indexterm"NAME="AUTOID-5585"></A>The second form has the user's full name first, followed by theemail address in angle brackets. When your MUA sendsemail using this form of return address, it hands <EMCLASS="emphasis">sendmail</EM>the entire text: full name, and address in angle brackets.</P><PCLASS="para">In both cases, what <EMCLASS="emphasis">sendmail</EM> needs is the <CODECLASS="literal">address</CODE>part. But, as in the second case, <EMCLASS="emphasis">sendmail</EM> can getmore than just the <CODECLASS="literal">address</CODE>.Therefore <EMCLASS="emphasis">sendmail</EM> needs a way to discard everything else:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Full Name &lt;address&gt;   <IMGSRC="../chars/darr.gif"ALT="-v"><ICLASS="lineannotation">needs to be transformed into</I>   <IMGSRC="../chars/darr.gif"ALT="-v">address</PRE></BLOCKQUOTE></P><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> program handles this initial transformationby preprocessing addresses using rule set 3.&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_05.htm"TITLE="9.5 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.5 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_02.htm"TITLE="10.2 Rule Set 3"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.2 Rule Set 3"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">9.5 Things to Try</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">10.2 Rule Set 3</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>