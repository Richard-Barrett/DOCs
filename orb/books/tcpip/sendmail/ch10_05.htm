<HTML><HEAD><TITLE>[Chapter 10] 10.5 Details of Rule Flow</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:36:22Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch10_01.htm"TITLE="10. Rule Set 3"><LINKREL="prev"HREF="ch10_04.htm"TITLE="10.4 Nested Angle Brackets"><LINKREL="next"HREF="ch10_06.htm"TITLE="10.6 Things to Try"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_04.htm"TITLE="10.4 Nested Angle Brackets"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.4 Nested Angle Brackets"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 10<BR>Rule Set 3</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_06.htm"TITLE="10.6 Things to Try"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.6 Things to Try"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-10-SECT-5">10.5 Details of Rule Flow</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-10-IX-D21-12-SWITCH-D21-12"></A><ACLASS="indexterm"NAME="SML2-CH-10-IX-RULES-PROCESSING-FLOW-OF"></A>To better see what is happening inside each rule, rerun <EMCLASS="emphasis">sendmail</EM> with a <CODECLASS="literal">-d21.12</CODE> debugging command-lineswitch:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>./sendmail -Cclient.cf -d21.12 -bt</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">-d21.12</CODE> switch tells <EMCLASS="emphasis">sendmail</EM> to print eachrule as it is processed. Run <EMCLASS="emphasis">sendmail</EM> again withthis new switch. This time, when you feed in anested address, you get considerably more output:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>3 &lt;a&lt;b&gt;c&gt;</B></CODE>rewrite: ruleset  3   input: &lt; a &lt; b &gt; c &gt;---trying rule: $* &lt; &gt; $*--- rule fails---trying rule: $* &lt; $* &lt; $* &gt; $* &gt; $*---rule matches: $2 &lt; $3 &gt; $4rewritten as: a &lt; b &gt; c---trying rule: $* &lt; $* &lt; $* &gt; $* &gt; $*--- rule fails---trying rule: $* &lt; $* &gt; $*---rule matches: $2rewritten as: b---trying rule: $* &lt; $* &gt; $*--- rule failsrewrite: ruleset  3 returns: b</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;This output may appear complicated, but it is really fairly straightforward.The first two lines and last line are what you have been seeingall along (when you <EMCLASS="emphasis">didn't</EM> use the <CODECLASS="literal">-d21.12</CODE> switch):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>3 &lt;a&lt;b&gt;c&gt;</B></CODE>rewrite: ruleset  3   input: &lt; a &lt; b &gt; c &gt;rewrite: ruleset  3 returns: b</PRE></BLOCKQUOTE></P><PCLASS="para">Everything in between those lines is new output caused by the <CODECLASS="literal">-d21.12</CODE>switch.That new output shows each rule in rule set 3 being called andprocessed in turn.The first rule looks for empty angle brackets:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* &lt;&gt; $*           $n                      handle &lt;&gt; error address</PRE></BLOCKQUOTE></P><PCLASS="para">The workspace (tokenized from the input of <CODECLASS="literal">&lt;a&lt;b&gt;c&gt;</CODE>)is compared to the LHS of this rule:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">---trying rule: $* &lt; &gt; $*--- rule fails</PRE></BLOCKQUOTE></P><PCLASS="para">The LHS doesn't match (the rule fails) because the angle bracketsof the workspace are not empty. Consequently, the RHS of the firstrule is not called, and the workspace is unchanged.</P><PCLASS="para">The second rule is the de-nesting one:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* &lt; $* &lt; $* &gt; $* &gt; $*     $2&lt;$3&gt;$4             de-nest brackets</PRE></BLOCKQUOTE></P><PCLASS="para">The workspace (still <CODECLASS="literal">&lt;a&lt;b&gt;c&gt;</CODE>) is compared to the LHS of this rule.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">---trying rule: $* &lt; $* &lt; $* &gt; $* &gt; $*</PRE></BLOCKQUOTE></P><PCLASS="para">The LHS matches the workspace, so the workspace is rewrittenon the basis of the RHS of that rule, and the extra angle brackets are stripped away:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">---rule matches: $2 &lt; $3 &gt; $4rewritten as: a &lt; b &gt; c</PRE></BLOCKQUOTE></P><PCLASS="para">The new workspace is then compared to the LHS of the same rule<EMCLASS="emphasis">once again</EM>&nbsp;- that is, to the rule that just did the rewriting.If it were to match again, it would be rewritten again. Thisproperty (which in error can continue forever) can be useful in solving manyconfiguration problems. We'll cover this property more fully in thenext chapter.</P><PCLASS="para">So the rewritten workspace is compared once again to the secondrule.The workspace (having been rewritten by the second rule)now contains</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">a  &lt;  b  &gt;  c</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;This time the comparison fails:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">---trying rule: $* &lt; $* &lt; $* &gt; $* &gt; $*--- rule fails</PRE></BLOCKQUOTE></P><PCLASS="para">The last of the three rules then gets a crack at the workspace. That rule is</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* &lt; $* &gt; $*       $2                      basic RFC822 parsing</PRE></BLOCKQUOTE></P><PCLASS="para">That workspace is still</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">a  &lt;  b  &gt;  c</PRE></BLOCKQUOTE></P><PCLASS="para">The workspace is once again matched, so it is rewritten againon the basis of the RHS of the third rule:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">---trying rule: $* &lt; $* &gt; $*---rule matches: $2rewritten as: b</PRE></BLOCKQUOTE></P><PCLASS="para">After the third rule rewrites the workspace, it again tries tomatch that rewritten workspace and fails:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">---trying rule: $* &lt; $* &gt; $*--- rule fails</PRE></BLOCKQUOTE></P><PCLASS="para">As you can see, the <CODECLASS="literal">-d21.12</CODE> debugging switch can bevery useful. It shows you exactly what each rule is tryingto do. It shows you each rewrite of the workspace, and itshows you the order in which rules are being applied.(Note that in real rule sets, this output can easily span many screens.)<ACLASS="indexterm"NAME="AUTOID-5979"></A><ACLASS="indexterm"NAME="AUTOID-5980"></A>&#13;</P></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_04.htm"TITLE="10.4 Nested Angle Brackets"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.4 Nested Angle Brackets"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_06.htm"TITLE="10.6 Things to Try"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 10.6 Things to Try"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">10.4 Nested Angle Brackets</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">10.6 Things to Try</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>