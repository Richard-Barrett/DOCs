<HTML><HEAD><TITLE>[Chapter 11] Rule Sets 1 and S=</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:36:27Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part01.htm"TITLE="I. A Tutorial"><LINKREL="prev"HREF="ch10_06.htm"TITLE="10.6 Things to Try"><LINKREL="next"HREF="ch11_02.htm"TITLE="11.2 Rule Set S="></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_06.htm"TITLE="10.6 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.6 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 11</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_02.htm"TITLE="11.2 Rule Set S="><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 11.2 Rule Set S="BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="SML2-CH-11">11. Rule Sets 1 and S=</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#SML2-CH-11-SECT-1"TITLE="11.1 Flow of the Sender's Address">Flow of the Sender's Address</A><BR><ACLASS="sect1"HREF="ch11_02.htm"TITLE="11.2 Rule Set S=">Rule Set S=</A><BR><ACLASS="sect1"HREF="ch11_03.htm"TITLE="11.3 All Mail from the Hub">All Mail from the Hub</A><BR><ACLASS="sect1"HREF="ch11_04.htm"TITLE="11.4 Rule Set Hubset">Rule Set Hubset</A><BR><ACLASS="sect1"HREF="ch11_05.htm"TITLE="11.5 Testing So Far">Testing So Far</A><BR><ACLASS="sect1"HREF="ch11_06.htm"TITLE="11.6 Handling user@thishost">Handling user@thishost</A><BR><ACLASS="sect1"HREF="ch11_07.htm"TITLE="11.7 Rule Set 1">Rule Set 1</A><BR><ACLASS="sect1"HREF="ch11_08.htm"TITLE="11.8 Things to Try">Things to Try</A></P><P></P></DIV><PCLASS="para"></P><PCLASS="para">Recall that the <EMCLASS="emphasis">client.cf</EM> file that we have been developinghas two purposes: to forward all mail to a central mail hub forprocessing and to make all mail appear as though it originated fromthe hub. The first purpose was fulfilled by the creation of a rule set0 that always selects the <CODECLASS="literal">hub</CODE> delivery agent. In this chapterwe begin the process of fulfilling the second purpose, by designingrule sets 1 and <CODECLASS="literal">S=</CODE>.</P><PCLASS="para">But first, to review, recall also that the recipient's address is firstprocessed by rule set 3 and then by rule set 0. Rule set 3 finds an addressamong other text and cleans up the address by removing nested angle brackets. After that, rule set0 selects a delivery agent on the basis of the recipient's address.If the address is bad, rule set 0 selects the<CODECLASS="literal">error</CODE> delivery agent. For a valid address, rule set 0 selectsthe <CODECLASS="literal">hub</CODE> delivery agent.Once the delivery agent is selected, the processing of other addresses,such as the sender's address, may proceed.&#13;</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-11-SECT-1">11.1 Flow of the Sender's Address</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-6009"></A>When <EMCLASS="emphasis">sendmail</EM> begins processing a mail message fordelivery, it first looks for the envelope[1]recipients.Each recipient address that is found is first processed byrule set 3, and then by rule set 0, which selects a deliveryagent.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] See <ACLASS="xref"HREF="ch01_01.htm"TITLE="Introduction">Chapter 1, <CITECLASS="chapter">Introduction</CITE></A>, for a reviewof the concepts of header versus envelope.</P></BLOCKQUOTE><PCLASS="para">After appropriate delivery agents have been selected for all recipients, <EMCLASS="emphasis">sendmail</EM>processes the sender's address. There is usually only a single sender[2]for any given mail message. The sender's address (or addresses)may appear in the envelope or in a <CODECLASS="literal">From:</CODE> header line, or it maybe derived from the <EMCLASS="emphasis">uid</EM> of the process that ran <EMCLASS="emphasis">sendmail</EM>.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] The envelope sender and the header sender arenot necessarily the same.</P></BLOCKQUOTE><PCLASS="para">As shown in <ACLASS="xref"HREF="ch11_01.htm#SML2-CH-11-FIG-0"TITLE="The flow of the sender's address">Figure 11.1</A>the address is processed by rule set 3 first and then byrule set 1. Then, for each recipient in the list of recipients,each sender's address is custom processed by the rule setspecified in the recipient delivery agent's <CODECLASS="literal">S=</CODE> equate.This custom processing is necessary because different deliveryagents may want the sender's address to have a different appearance.One example is the difference between a domain-based deliveryagent (needing an address such as <EMCLASS="emphasis">gw@wash.dc.gov</EM>) anda UUCP-based delivery agent (needing a routing path such as<EMCLASS="emphasis">fbi!wash!gw</EM>).</P><PCLASS="para">We will examine the custom <CODECLASS="literal">S=</CODE> processing first, thendiscuss why a generic rule set 1 is not needed in the <EMCLASS="emphasis">client.cf</EM> file.</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-11-FIG-0">Figure 11.1: The flow of the sender's address</A></H4><IMGCLASS="graphic"SRC="figs/sm1101.gif"ALT="Figure 11.1"></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch10_06.htm"TITLE="10.6 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 10.6 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_02.htm"TITLE="11.2 Rule Set S="><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 11.2 Rule Set S="BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">10.6 Things to Try</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">11.2 Rule Set S=</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>