<HTML><HEAD><TITLE>[Chapter 14] 14.2 Headers Versus Delivery Agent Flags</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:38:29Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch14_01.htm"TITLE="14. Headers, Precedence, and Trust"><LINKREL="prev"HREF="ch14_01.htm"TITLE="14.1 Headers"><LINKREL="next"HREF="ch14_03.htm"TITLE="14.3 Headers Learned So Far"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch14_01.htm"TITLE="14.1 Headers"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 14.1 Headers"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 14<BR>Headers, Precedence, and Trust</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch14_03.htm"TITLE="14.3 Headers Learned So Far"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 14.3 Headers Learned So Far"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-14-SECT-2">14.2 Headers Versus Delivery Agent Flags</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-14-IX-FLAGS-DELIVERY-AGENT"></A><ACLASS="indexterm"NAME="SML2-CH-14-IX-DELIVERY-AGENTS-MTAS-FLAGS"></A><ACLASS="indexterm"NAME="SML2-CH-14-IX-HEADERS-MESSAGE-DELIVERY-AGENT-FLAGS-AND"></A>Some headers should be inserted into a mail message only ifa certain delivery agent is used.For example, one traditionally should include the <CODECLASS="literal">Full-Name:</CODE>header when mail is being delivered with UUCP but should not include itfor most other delivery agents.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7847"></A>The mechanism that governs inclusion is a listof flags that prefix the header definition in the configuration file.Those flags are composed of a series of one or more letters, all ofwhich are surrounded with a pair of <CODECLASS="literal">?</CODE> characters.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">H<CODECLASS="userinput"><B>?</B></CODE><CODECLASS="replaceable"><I>flags</I></CODE><CODECLASS="userinput"><B>?</B></CODE>name: value</PRE></BLOCKQUOTE></P><PCLASS="para">When <EMCLASS="emphasis">sendmail</EM> decides whether a header is to be addedto the mail message, it compares the <CODECLASS="replaceable"><I>flags</I></CODE> listed withthe flags of the delivery agent's <CODECLASS="literal">F=</CODE> equate:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mhub,   P=[IPC], S=Hubset, R=0, F=mDFMuXa, T=DNS/RFC822/SMTP, A=IPC $h                                  <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                                  <ICLASS="lineannotation">flags</I></PRE></BLOCKQUOTE></P><PCLASS="para">If a given <EMCLASS="emphasis">flag</EM> (letter) appears in both, the headeris added to the mail message. Otherwise, it is not.</P><PCLASS="para">Traditionally, for example, the <CODECLASS="literal">x</CODE> flag is used to indicatethe need for a <CODECLASS="literal">Full-Name:</CODE> header. But our hubdelivery agent does not have an <CODECLASS="literal">x</CODE> in its <CODECLASS="literal">F=</CODE> flags.Since that is the only delivery agent we use, we need to addthat flag to the <EMCLASS="emphasis">client.cf</EM> file.&#13;</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-14-SECT-2-1">14.2.1 The Full-Name: Header</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7874"></A><ACLASS="indexterm"NAME="AUTOID-7876"></A><ACLASS="indexterm"NAME="AUTOID-7878"></A>The <CODECLASS="literal">Full-Name:</CODE> header is used to display the full nameof the sender, as taken from the <EMCLASS="emphasis">gecos</EM> field of the<EMCLASS="emphasis">passwd</EM>(5) file. You saw above how the hub machine triesto add the sender's full name to the <CODECLASS="literal">From:</CODE> header.But since you don't necessarily have control over the hub, you shouldadd a <CODECLASS="literal">Full-Name:</CODE> header locally, so that the full nameis displayed even if the hub fails to add it.</P><PCLASS="para">The way to declare the <CODECLASS="literal">Full-Name:</CODE> header is like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">H?x?Full-Name: $?x$x$.         # Add full name if available</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7891"></A>First prefix it with the <CODECLASS="literal">?x?</CODE> flag. This means thatthe <CODECLASS="literal">Full-Name:</CODE> header is added only if thedelivery agent also contains that flag.</P><PCLASS="para">The value given to the <CODECLASS="literal">Full-Name:</CODE> header is just likethe conditional that you saw earlier. If (<CODECLASS="literal">$?</CODE>) the macro <CODECLASS="literal">x</CODE>contains a value, use that value (<CODECLASS="literal">$x</CODE>), and endif (<CODECLASS="literal">$.</CODE>).We use this conditional test so that the full name is added only ifit is known.</P><PCLASS="para">Next, to make the <CODECLASS="literal">Full-Name:</CODE> effective, you need toadd an <CODECLASS="literal">x</CODE> flag to the <CODECLASS="literal">hub</CODE> delivery agent declaration:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mhub,   P=[IPC], S=Hubset, R=0, F=<CODECLASS="userinput"><B>x</B></CODE>mDFMuXa, T=DNS/RFC822/SMTP, A=IPC $h                                  <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                                  <ICLASS="lineannotation">add</I></PRE></BLOCKQUOTE></P><PCLASS="para">Now any mail that uses the <CODECLASS="literal">hub</CODE> delivery agent for a recipient(in other words, all mail)will add a <CODECLASS="literal">Full-Name:</CODE> header to the message if there is notalready one there. If the full name is known (<CODECLASS="literal">$x</CODE> has a value),that name follows the <CODECLASS="literal">Full-Name:</CODE> header on the same line;otherwise, the header contains only the header name and is omitted entirely.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-14-SECT-2-2">14.2.2 The Date: Header</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7918"></A><ACLASS="indexterm"NAME="AUTOID-7920"></A><ACLASS="indexterm"NAME="AUTOID-7923"></A><ACLASS="indexterm"NAME="AUTOID-7927"></A>The <CODECLASS="literal">Date:</CODE> header is required in all messages to show thetime and day that the message originated. It is a good idea to include <CODECLASS="literal">?</CODE><CODECLASS="replaceable"><I>flags</I></CODE><CODECLASS="literal">?</CODE>in its definition so that custom delivery agentsthat do not need the <CODECLASS="literal">Date:</CODE> can be designed later.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">H?D?Date: $a                    # Add if F=D</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7939"></A><ACLASS="indexterm"NAME="AUTOID-7941"></A>The <CODECLASS="literal">$a</CODE> is the <EMCLASS="emphasis">origin date</EM> of the mail messagein RFC822 format. That date is set internally by <EMCLASS="emphasis">sendmail</EM>to be correct for inclusion in the <CODECLASS="literal">Date:</CODE> header.</P><PCLASS="para">An <CODECLASS="literal">F=D</CODE> flag already exists in the <CODECLASS="literal">hub</CODE> delivery agent:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mhub,   P=[IPC], S=Hubset, R=0, F=xm<CODECLASS="userinput"><B>D</B></CODE>FMuXa, T=DNS/RFC822/SMTP, A=IPC $h                                    <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                                    <ICLASS="lineannotation">add the date if missing</I></PRE></BLOCKQUOTE></P><PCLASS="para">That <CODECLASS="literal">D</CODE> was originally put in this delivery agent definitionwith the <CODECLASS="literal">Date:</CODE> header in mind.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-14-SECT-2-3">14.2.3 The Message-ID: Header</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7961"></A><ACLASS="indexterm"NAME="AUTOID-7964"></A><ACLASS="indexterm"NAME="AUTOID-7967"></A>The <CODECLASS="literal">Message-ID:</CODE> header is used to uniquely identifyeach mail message. It must be inserted into the message whenit is first created (first handled by <EMCLASS="emphasis">sendmail</EM>). The formof the <CODECLASS="literal">Message-ID:</CODE> header is very specific:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">H?M?Message-Id: &lt;$t.$i@$j&gt;      # Add if F=M</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7975"></A>Here, a <CODECLASS="literal">?M?</CODE> prefix is included. The <CODECLASS="literal">hub</CODE> delivery agentdefinition already has the <CODECLASS="literal">F=M</CODE> flag listed:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mhub,   P=[IPC], S=Hubset, R=0, F=xmDF<CODECLASS="userinput"><B>M</B></CODE>uXa, T=DNS/RFC822/SMTP, A=IPC $h                                      <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                                      <ICLASS="lineannotation">add the message identifier if missing</I></PRE></BLOCKQUOTE></P><PCLASS="para">The field following the <CODECLASS="literal">Message-ID:</CODE> must followparticular rules. First, it must be surrounded by angle brackets.Then, what appears between the angle brackets must look like a legaladdress:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&lt;<EMCLASS="emphasis">address&gt;</EM></PRE></BLOCKQUOTE></P><PCLASS="para">The address must be composed of pieces of information that uniquelyidentify the mail message worldwide. We create that addressin a way that is commonly used in most configuration files:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&lt;$t.$i@$j&gt;</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-7994"></A><ACLASS="indexterm"NAME="AUTOID-7996"></A><CODECLASS="literal">$t</CODE> is the current date and time represented by an integer.<ACLASS="indexterm"NAME="AUTOID-8000"></A><ACLASS="indexterm"NAME="AUTOID-8002"></A><ACLASS="indexterm"NAME="AUTOID-8006"></A><CODECLASS="literal">$i</CODE>is the local unique identifier for the queue file for this message(even if the message isn't queued), and <CODECLASS="literal">$j</CODE> is your host'sfully qualified domain name. Other information may be used, provided thatthe result looks like a legal address and provided that no two identicalidentifiers ever go out.<ACLASS="indexterm"NAME="AUTOID-8011"></A><ACLASS="indexterm"NAME="AUTOID-8012"></A><ACLASS="indexterm"NAME="AUTOID-8015"></A><ACLASS="indexterm"NAME="AUTOID-8016"></A>&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch14_01.htm"TITLE="14.1 Headers"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 14.1 Headers"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch14_03.htm"TITLE="14.3 Headers Learned So Far"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 14.3 Headers Learned So Far"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">14.1 Headers</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">14.3 Headers Learned So Far</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>