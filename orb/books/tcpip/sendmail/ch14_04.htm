<HTML><HEAD><TITLE>[Chapter 14] 14.4 Precedence</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:38:32Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch14_01.htm"TITLE="14. Headers, Precedence, and Trust"><LINKREL="prev"HREF="ch14_03.htm"TITLE="14.3 Headers Learned So Far"><LINKREL="next"HREF="ch14_05.htm"TITLE="14.5 Sending Real Mail"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch14_03.htm"TITLE="14.3 Headers Learned So Far"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 14.3 Headers Learned So Far"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 14<BR>Headers, Precedence, and Trust</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch14_05.htm"TITLE="14.5 Sending Real Mail"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 14.5 Sending Real Mail"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-14-SECT-4">14.4 Precedence</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-14-IX-PRIORITY-MESSAGE"></A><ACLASS="indexterm"NAME="SML2-CH-14-IX-MESSAGES-MAIL-PRIORITY-OF"></A>The precedence of a mail message determines its position among othermessages in the queue when the queue is processed. Precedence, as a header line,also defines whether or not a bounced message should be returnedto the sender. Precedences are not hard-coded into <EMCLASS="emphasis">sendmail</EM>.Instead, they need to be declared in the configuration file.The typical declarations, and the ones we will use, look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Pspecial-delivery=100Pfirst-class=0Plist=-30Pbulk=-60Pjunk=-100</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8060"></A>These lines use the <CODECLASS="literal">P</CODE> (precedence) configuration command.Like all configurationcommands, the <CODECLASS="literal">P</CODE> must begin the line. It is followedby a name, an equal sign, and a value. The general formlooks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">P<CODECLASS="replaceable"><I>name</I></CODE>=<CODECLASS="replaceable"><I>value</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">There are only five possibilities for <CODECLASS="replaceable"><I>name</I></CODE> that are legal:<CODECLASS="literal">special-delivery</CODE> <ACLASS="indexterm"NAME="AUTOID-8071"></A>This mail message needs to be processed before any others. Thisprecedence is effective only when the message is being deliveredfrom the queue.<CODECLASS="literal">first-class</CODE> <ACLASS="indexterm"NAME="AUTOID-8074"></A>Unless otherwise declared with a <CODECLASS="literal">Precedence:</CODE> header,the message is <CODECLASS="literal">first-class</CODE> by default.<CODECLASS="literal">list</CODE> <ACLASS="indexterm"NAME="AUTOID-8079"></A><ACLASS="indexterm"NAME="AUTOID-8081"></A>The message originated as part of a mailing list. It should bedeferred until other more important mail has been processedfrom the queue.<CODECLASS="literal">bulk</CODE> <ACLASS="indexterm"NAME="AUTOID-8085"></A><ACLASS="indexterm"NAME="AUTOID-8087"></A><ACLASS="indexterm"NAME="AUTOID-8089"></A>The message is a broadcast, like a mailing list but less important.If the message can't be delivered, the message body is discardedfrom the bounced mail.<CODECLASS="literal">junk</CODE> <ACLASS="indexterm"NAME="AUTOID-8093"></A>Absolutely worthless mail. Test messages and mail from someprograms fall into this category. Like <CODECLASS="literal">bulk</CODE>, the messagebody is discarded from the bounced mail.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8097"></A>The <CODECLASS="replaceable"><I>value</I></CODE> assigned to each <CODECLASS="replaceable"><I>name</I></CODE> is somewhat arbitrary.The ones that we use are common. As you gain familiarity with thequeue and mailing lists, you may want to adjust these values.In general, the higher the number, the higher the precedence.By convention, formal first-class mail has a precedence of zero, withpositive numbers used for high-precedence mail and negative numbersused for various kinds of bulk mail.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8102"></A>The <CODECLASS="literal">P</CODE> configuration command only tells <EMCLASS="emphasis">sendmail</EM>the <CODECLASS="replaceable"><I>value</I></CODE> to assign to a given <CODECLASS="replaceable"><I>name</I></CODE>. Ithas no other effect. The values are used only when a mailmessage is processed that has a <CODECLASS="literal">Precedence:</CODE> headerline in it. The inclusion of <CODECLASS="literal">Precedence:</CODE> header linesis left to MUAs.</P><PCLASS="para">To illustrate, imagine that a user on your machine is managinga mailing list. The software that is used to create each messagefor the list arranges to include a <CODECLASS="literal">Precedence:</CODE> headerthat looks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Precedence: list</PRE></BLOCKQUOTE></P><PCLASS="para">The mailing-list message is given to <EMCLASS="emphasis">sendmail</EM> on the localmachine. The local <EMCLASS="emphasis">sendmail</EM> sees the <CODECLASS="literal">Precedence:</CODE> headerin the message and extracts the field of that header, the <CODECLASS="literal">list</CODE>.It then compares <CODECLASS="literal">list</CODE> to each of the <CODECLASS="replaceable"><I>name</I></CODE>parts of its <CODECLASS="literal">P</CODE> configuration lines. It finds a matchwith the line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Plist=-30</PRE></BLOCKQUOTE></P><PCLASS="para">Because it finds a match, it uses the <CODECLASS="replaceable"><I>value</I></CODE> from thisconfiguration command as the initial precedence of the mail message.If there is no match (or if the original message lacksa <CODECLASS="literal">Precedence:</CODE> header), the initial precedence of themail message defaults to zero.</P><PCLASS="para">Now add <CODECLASS="literal">P</CODE> configuration commands tothe <EMCLASS="emphasis">client.cf</EM> file. Traditionally, they are placed after the headercommands:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">H?D?Date: $a                    # Add if F=DH?M?Message-Id: &lt;$t.$i@$j&gt;      # Add if F=M<CODECLASS="userinput"><B># Precedence                                   </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I><CODECLASS="userinput"><B>Pspecial-delivery=100                          </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I><CODECLASS="userinput"><B>Pfirst-class=0                                 </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I><CODECLASS="userinput"><B>Plist=-30                                      </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I><CODECLASS="userinput"><B>Pbulk=-60                                      </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I><CODECLASS="userinput"><B>Pjunk=-100                                     </B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8145"></A><ACLASS="indexterm"NAME="AUTOID-8146"></A></P></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch14_03.htm"TITLE="14.3 Headers Learned So Far"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 14.3 Headers Learned So Far"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch14_05.htm"TITLE="14.5 Sending Real Mail"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 14.5 Sending Real Mail"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">14.3 Headers Learned So Far</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">14.5 Sending Real Mail</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>