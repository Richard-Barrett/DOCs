<HTML><HEAD><TITLE>[Chapter 15] Install and Test the client.cf File</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:38:40Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part01.htm"TITLE="I. A Tutorial"><LINKREL="prev"HREF="ch14_07.htm"TITLE="14.7 Things to Try"><LINKREL="next"HREF="ch15_02.htm"TITLE="15.2 The Real Queue Directory"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch14_07.htm"TITLE="14.7 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 14.7 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 15</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_02.htm"TITLE="15.2 The Real Queue Directory"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 15.2 The Real Queue Directory"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="SML2-CH-15">15. Install and Test the client.cf File</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#SML2-CH-15-SECT-1"TITLE="15.1 Test the Configuration File">Test the Configuration File</A><BR><ACLASS="sect1"HREF="ch15_02.htm"TITLE="15.2 The Real Queue Directory">The Real Queue Directory</A><BR><ACLASS="sect1"HREF="ch15_03.htm"TITLE="15.3 MX Records">MX Records</A><BR><ACLASS="sect1"HREF="ch15_04.htm"TITLE="15.4 Hub Accepts Mail for Client">Hub Accepts Mail for Client</A><BR><ACLASS="sect1"HREF="ch15_05.htm"TITLE="15.5 Prevent the Daemon from Running">Prevent the Daemon from Running</A><BR><ACLASS="sect1"HREF="ch15_06.htm"TITLE="15.6 Install the client.cf File">Install the client.cf File</A><BR><ACLASS="sect1"HREF="ch15_07.htm"TITLE="15.7 Things to Try">Things to Try</A></P><P></P></DIV><PCLASS="para"></P><PCLASS="para">In this chapter and the next, we tie up a few looseends to install a <EMCLASS="emphasis">client.cf</EM> file as the system configuration file.&#13;</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-15-SECT-1">15.1 Test the Configuration File</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8302"></A><ACLASS="indexterm"NAME="AUTOID-8305"></A>Clearly, you won't want to install the <EMCLASS="emphasis">client.cf</EM> file as thereal <EMCLASS="emphasis">sendmail.cf</EM> file untilyou've made sure it works properly.One of thebetter ways to test a new configuration file is to create a fileof addresses for which you already know the correct outcome, thenfeed the contents of that file to <EMCLASS="emphasis">sendmail</EM> in rule-testing mode:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">/tryflags es/parse user@here/parse user@here.us.edu/parse user@foo/parse foo!user/parse user</PRE></BLOCKQUOTE></P><PCLASS="para">Each line begins with a special V8.7 rule-testing command.[1]The first line causes the tests that follow to parse the addressas an envelope sender (instead of the default envelope recipient).<ACLASS="indexterm"NAME="AUTOID-8317"></A><ACLASS="indexterm"NAME="AUTOID-8319"></A>The <CODECLASS="literal">/parse</CODE> command causes each address to be rewrittenby rule sets 3 and 0 to select a delivery agent and then by rule set 4 to clean up afterward.The addresses listed that are humbly few but will suffice forthe needs of the <EMCLASS="emphasis">client.cf</EM> file. No matter the formof the address, each should be forwarded to the hub as is.(The <CODECLASS="literal">/parse</CODE> command is described in <ACLASS="xref"HREF="ch38_05.htm#SML2-CH-38-SECT-5-5"TITLE="Parse an Address with /parse">Section 38.5.5, "Parse an Address with /parse"</A>.)</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] The same thing can be done in earlier versions, but with somedifficulty.  See a sample script in <ACLASS="xref"HREF="ch38_08.htm"TITLE="Batch Rule-Set Testing">Section 38.8, "Batch Rule-Set Testing"</A>.</P></BLOCKQUOTE><PCLASS="para">The way to test the <EMCLASS="emphasis">client.cf</EM> file using this list lookslike this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>./sendmail -Cclient.cf -bt &lt; </B></CODE><CODECLASS="replaceable"><I>list</I></CODE><CODECLASS="userinput"><B> | grep ^mailer</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Here, <CODECLASS="replaceable"><I>list</I></CODE> is the name of the file containing theabove list of rule tests and addresses. The output showsthat each will be passed as is to the hub:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">mailer hub, host mailhost, user user@heremailer hub, host mailhost, user user@here.us.edumailer hub, host mailhost, user user@foomailer hub, host mailhost, user here!usermailer hub, host mailhost, user user</PRE></BLOCKQUOTE></P><PCLASS="para">Notice that mail to these addresses will be delivered by using the hub deliveryagent (<CODECLASS="literal">mailer</CODE>). Also notice that each will be forwarded tothe hub machine (<CODECLASS="literal">mailhost</CODE>) for delivery. Finally, notethat the user part will be the original address.[2]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] This is the triple that we described in <ACLASS="xref"HREF="ch09_02.htm"TITLE="The RHS Triple">Section 9.2, "The RHS Triple"</A>, in whichthe RHS of rule set 0 returned the <CODECLASS="literal">mailer</CODE> with <CODECLASS="literal">$#</CODE>,the <CODECLASS="literal">host</CODE> with <CODECLASS="literal">$@</CODE>, and the <CODECLASS="literal">user</CODE> with <CODECLASS="literal">$:</CODE>.</P></BLOCKQUOTE><PCLASS="para">But why was the lone username in the last line not rewrittento appear as though it was coming from the hub? Recall thatsender rewriting is done in the <CODECLASS="literal">Hubset</CODE> rule set.That rule set is called only by the <CODECLASS="literal">S=</CODE> of thedelivery agent. To see <CODECLASS="literal">Hubset</CODE> rewriting, you need to run <EMCLASS="emphasis">sendmail</EM> again, but this time use <CODECLASS="literal">/try</CODE> instead of<CODECLASS="literal">/parse</CODE>:[3]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] Under old versions of <EMCLASS="emphasis">sendmail</EM> you must specify the rule setsby hand, for example, <CODECLASS="literal">3,Hubset</CODE>.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>./sendmail -Cclient.cf -bt</B></CODE>ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)Enter &lt;ruleset&gt; &lt;address&gt;&gt; <CODECLASS="userinput"><B>/tryflags es</B></CODE>&gt; <CODECLASS="userinput"><B>/try hub user</B></CODE>rewrite: ruleset  3   input: userrewrite: ruleset  3 returns: userrewrite: ruleset  1   input: userrewrite: ruleset  1 returns: userrewrite: ruleset 199   input: userrewrite: ruleset 199 returns: user @ mail . us . edurewrite: ruleset  4   input: user @ mail . us . edurewrite: ruleset  4 returns: user @ mail . us . eduRcode = 0, addr = user@mail.us.edu</PRE></BLOCKQUOTE></P><PCLASS="para">Here, <EMCLASS="emphasis">sendmail</EM> rewrites the lone username firstwith rule set 3 (all addresses start with rule set 3), and thenwith rule set 1 (all sender addresses pass through rule set 1).The address is then rewritten by rule set <CODECLASS="literal">Hubset</CODE>(which prints as 199 because it is a symbolic rule-set name).As intended, a lone sender name hasthe address of the hub machine appended to it.(The rest of this <CODECLASS="literal">/try</CODE> output is described in <ACLASS="xref"HREF="ch38_05.htm#SML2-CH-38-SECT-5-6"TITLE="Try a Delivery Agent with /try">Section 38.5.6, "Try a Delivery Agent with /try"</A>.)</P><PCLASS="para">Further testing would be suggested if the output varied in unexpectedways. It might be necessary to run <EMCLASS="emphasis">sendmail</EM> in rule-testing mode by hand,testing each rule and sequence of rules individually to findany mistakes in the <EMCLASS="emphasis">client.cf</EM> file.If the <EMCLASS="emphasis">client.cf</EM> file tests okay, you are now almostready to install it as the official <EMCLASS="emphasis">sendmail.cf</EM> file.&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch14_07.htm"TITLE="14.7 Things to Try"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 14.7 Things to Try"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_02.htm"TITLE="15.2 The Real Queue Directory"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 15.2 The Real Queue Directory"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">14.7 Things to Try</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">15.2 The Real Queue Directory</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>