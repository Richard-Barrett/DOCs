<HTML><HEAD><TITLE>[Chapter 15] 15.3 MX Records</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:39:03Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch15_01.htm"TITLE="15. Install and Test the client.cf File"><LINKREL="prev"HREF="ch15_02.htm"TITLE="15.2 The Real Queue Directory"><LINKREL="next"HREF="ch15_04.htm"TITLE="15.4 Hub Accepts Mail for Client"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_02.htm"TITLE="15.2 The Real Queue Directory"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 15.2 The Real Queue Directory"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 15<BR>Install and Test the client.cf File</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_04.htm"TITLE="15.4 Hub Accepts Mail for Client"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 15.4 Hub Accepts Mail for Client"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-15-SECT-3">15.3 MX Records</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-15-IX-MX-RECORDS"></A><ACLASS="indexterm"NAME="AUTOID-8444"></A><ACLASS="indexterm"NAME="SML2-CH-15-IX-DNS-DOMAIN-NAME-SYSTEM-MX-RECORDS"></A>Recall that in the hub/client setup, all mail goes to the hubmachine and none is ever delivered directly to the client. This requirestwo things: that all mail to the client be automaticallysent to the hub machine instead of to the client and thatthe hub machine accept mailaddressed to the client as though that mail were addressedto the hub machine instead.Forcing all mail to go to thehub machine requires special Mail Exchanger (MX) records.</P><PCLASS="para">If you already administer DNS, the changes that we will make areeasily accomplished. If you don't, you will have to ask your DNS administratorto make the changes for you.How DNS interacts with <EMCLASS="emphasis">sendmail</EM> is described in greater detail in <ACLASS="xref"HREF="ch21_01.htm"TITLE="DNS and sendmail">Chapter 21, <CITECLASS="chapter">DNS and sendmail</CITE></A>.You may want to jump ahead to that chapter, and then returnhere, to better understand the changes we are making.</P><PCLASS="para">To arrange for all mail to go to the hub machine,first find the primary file for your DNS zone. We won't tell youwhere to find it, because either you know where it is or you probablylack permission to edit it.Somewhere in the primary file for your DNS zone is anentry for the local client. It looks something like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">here            IN      A       123.45.67.8                IN      HINFO   Sun4/75 unix</PRE></BLOCKQUOTE></P><PCLASS="para">Remember that the local machine is <EMCLASS="emphasis">here.us.edu</EM>. The entry forthis machine begins with its hostname (with the domain partomitted). The <CODECLASS="literal">IN</CODE> says that this is an Internet-typeentry&nbsp;- the only type that is currently supported. The A<ACLASS="indexterm"NAME="AUTOID-8459"></A>says that this is an <EMCLASS="emphasis">address</EM> record, one that associatesan IP address with a hostname. The IP address is the <EMCLASS="emphasis">dottedquad</EM> that follows (the <CODECLASS="literal">123.45.67.8</CODE>).</P><PCLASS="para">Other lines may follow the Arecord. Here, we show an HINFO (host information)record that describes the hardware and the operating systemfor the local machine.</P><PCLASS="para">&#13;Immediately below the A record for the local machine,add a new MX record:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">here            IN      A       123.45.67.8                IN      MX      13 mail <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> add</I>                IN      HINFO   Sun4/75 unix</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8470"></A><ACLASS="indexterm"NAME="AUTOID-8473"></A><ACLASS="indexterm"NAME="AUTOID-8477"></A><ACLASS="indexterm"NAME="AUTOID-8481"></A>Two pieces of information are necessary foran MX record. The first is a relativepreference (the <CODECLASS="literal">13</CODE>), which must be a number.The preference is used only when there is more than oneMX record for a host. If there were two, the host withthe lower preference would be tried first and then the host withthe higher preference if the first failed.The number that is selected doesn'tmatter, because there is only one MX record for this host.</P><PCLASS="para">The second item (the one following the preference) is the nameof the hub machine to which mail will be sent in place of sendingit to the client. If the domain part for both the hub machineand the client machine is the same, only the hostname of thehub machine needs to appear in this record. The hostnameof the hub in all our examples has been <CODECLASS="literal">mail</CODE>, so that is what we used:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">                IN      MX      13 <CODECLASS="userinput"><B>mail</B></CODE>                                   <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                                   <ICLASS="lineannotation">hostname of our mail hub</I></PRE></BLOCKQUOTE></P><PCLASS="para">You should, of course, replace <CODECLASS="literal">mail</CODE> with the actual nameof your central mail-handling machine.</P><PCLASS="para">If the hub machine is in a different domain than the client,a fully qualified domain name needs to be specified in place of<CODECLASS="literal">mail</CODE>.For example, if all local mail is being sent offsiteto the central server at <EMCLASS="emphasis">wash.dc.gov</EM>, the following would appear:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">                IN      MX      13 <CODECLASS="userinput"><B>wash.dc.gov.</B></CODE>                                              <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                                   <ICLASS="lineannotation">note the dot at the end</I></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8503"></A><ACLASS="indexterm"NAME="AUTOID-8505"></A><ACLASS="indexterm"NAME="AUTOID-8508"></A>If you place a fully qualified name in an MX record,be sure to terminate that name with a dot. That dot tells DNSthat this name is complete. Without it, DNS automaticallyappends your local domain to the name, resulting in an unknown address.In the entry <CODECLASS="literal">mail</CODE> above, the dot was omitted because <CODECLASS="literal">mail</CODE> is in the local domain.</P><PCLASS="para">After you've made this change, you need to wait for the oldrecord to time out. The length of time to wait depends on the value<ACLASS="indexterm"NAME="AUTOID-8514"></A><ACLASS="indexterm"NAME="AUTOID-8516"></A>of the Time To Live (TTL) that is defined for the record. A TTL canappear in two places. It can appear in the A record,or it can appear elsewhere as a default TTL. If the TTL appears inthe A record, it will be a number between the hostnameand the <CODECLASS="literal">IN</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">here     28800       IN      A       123.45.67.8         <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>         <ICLASS="lineannotation">Time To Live (TTL) for this record</I></PRE></BLOCKQUOTE></P><PCLASS="para">TTL values are always in seconds. Here, the A record willtime out and any new information will be updated after eight hours have elapsed.Depending on when it was last updated, you may have to wait up toeight hours for the new MX record to be recognized.</P><PCLASS="para">If the A record has a TTL, you should duplicate that TTLin the new MX record so that they both time out together:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">here    28800        IN      A       123.45.67.8        <CODECLASS="userinput"><B>28800</B></CODE>        IN      MX      13 mail</PRE></BLOCKQUOTE></P><PCLASS="para">At most sites the TTL for A and MX records are notstored with them but are defined by a default TTL elsewhere.To find the default TTL, look at the top of the same file for aStart Of Authority (<CODECLASS="literal">SOA</CODE>) record:<ACLASS="indexterm"NAME="AUTOID-8530"></A><ACLASS="indexterm"NAME="AUTOID-8532"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">@       IN      SOA     us.edu. postmaster.us.edu. (                                1.43    ; serial number                                7200    ; secondary refresh                                1800    ; secondary retry                                3600000 ; secondary expire                                86400 ) ; default ttl</PRE></BLOCKQUOTE></P><PCLASS="para">The details of your <CODECLASS="literal">SOA</CODE> record will differ, but thedesired information can still be found. The <CODECLASS="literal">SOA</CODE> recordincludes a parenthetical list of five numbers. The lastis the default TTL that will be used for all records that don'tspecify one. Here, that defaultis 86400 seconds, or 24 hours.</P><PCLASS="para">If your MX records lack individual TTLs (because theA record lacks them), you will need to wait the defaultTTL period of time for the new MX record to become known.</P><PCLASS="para">We've omitted a few wrinkles, such as <EMCLASS="emphasis">reloading</EM> the name server,for a simpler description of the process.If you have permission to change the zone file, you have doubtless changed it beforeand are familiar with the missing steps. If you haven't, a shortsection like this one can't begin to give you the information youneed to manage DNS.Instead, we refer you to<EMCLASS="emphasis">DNS and BIND, Second Edition</EM> by Paul Albitz and Cricket Liu (O'Reilly&amp; Associates, Inc., 1997).<ACLASS="indexterm"NAME="AUTOID-8544"></A><ACLASS="indexterm"NAME="AUTOID-8545"></A>&#13;</P></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_02.htm"TITLE="15.2 The Real Queue Directory"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 15.2 The Real Queue Directory"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_04.htm"TITLE="15.4 Hub Accepts Mail for Client"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 15.4 Hub Accepts Mail for Client"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">15.2 The Real Queue Directory</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">15.4 Hub Accepts Mail for Client</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>