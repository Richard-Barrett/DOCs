<HTML><HEAD><TITLE>[Chapter 15] 15.4 Hub Accepts Mail for Client</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:39:11Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch15_01.htm"TITLE="15. Install and Test the client.cf File"><LINKREL="prev"HREF="ch15_03.htm"TITLE="15.3 MX Records"><LINKREL="next"HREF="ch15_05.htm"TITLE="15.5 Prevent the Daemon from Running"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_03.htm"TITLE="15.3 MX Records"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 15.3 MX Records"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 15<BR>Install and Test the client.cf File</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_05.htm"TITLE="15.5 Prevent the Daemon from Running"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 15.5 Prevent the Daemon from Running"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-15-SECT-4">15.4 Hub Accepts Mail for Client</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-15-IX-HUBS-ACCEPTING-MAIL"></A><ACLASS="indexterm"NAME="SML2-CH-15-IX-MESSAGES-MAIL-HUBS-ACCEPTANCE-OF"></A><ACLASS="indexterm"NAME="SML2-CH-15-IX-CONFIGURING-HUB"></A>Recall that mail to your machinewill be delivered to the hub, because of the MX recordthat you just created. Unless you change the configuration of thehub, that mail will bounce, because the hub doesn't yet know that itshould accept it.</P><PCLASS="para">Again, you may lack permission to make the required changes. Butfor the sake of illustration we'll assume that you can.</P><PCLASS="para">You need to modify the hub's configuration file sothat the hub thinks mail to your local machine is instead mailto itself. The first step is to edit the hub's configurationfile and search for the rule that allows it to recognizeitself. Because every machine needs to recognize itself under thename <CODECLASS="literal">localhost</CODE>, you should search for that string first. Such asearch will reveal something like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># We always want localhost to be considered local.Cwlocalhost</PRE></BLOCKQUOTE></P><PCLASS="para">This example shows part of a typical configuration file thatdeclares <CODECLASS="literal">localhost</CODE> as equivalent to the hub's hostname.<ACLASS="indexterm"NAME="AUTOID-8565"></A><ACLASS="indexterm"NAME="AUTOID-8568"></A>Recall that class <CODECLASS="literal">w</CODE> is special because it is initializedinternally by <EMCLASS="emphasis">sendmail</EM> to contain all the possible names ofa machine&nbsp;- all, that is, except <CODECLASS="literal">localhost</CODE>, which always needs to be added to class <CODECLASS="literal">w</CODE> in the configuration file.</P><PCLASS="para">We searched for <CODECLASS="literal">localhost</CODE> instead of <CODECLASS="literal">Cw</CODE> because some configuration files use a letter other than <CODECLASS="literal">w</CODE>to list alternative names. The following illustrates oneof those other letters:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># Other name for our machineCO localhost printserver faxhost</PRE></BLOCKQUOTE></P><PCLASS="para">If your hub's configuration file is like this, use the letter <CODECLASS="literal">O</CODE>(or whatever letter appeared) in place of themore standard letter <CODECLASS="literal">w</CODE> in the following examples.</P><PCLASS="para">Now that you have the name (letter) of the class of other names,you need to add the local workstation's name to that list.This can be done in either of two ways. If the local machineis the only one that will be using the <EMCLASS="emphasis">client.cf</EM> file,you can add its name to the existing class definition:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># Other name for our machineCO localhost printserver faxhost <CODECLASS="userinput"><B>here</B></CODE>                                 <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                        <ICLASS="lineannotation">add the local machine's name here</I></PRE></BLOCKQUOTE></P><PCLASS="para">On the other hand, if yours is just the first of many machinesthat will be using the <EMCLASS="emphasis">client.cf</EM> file, you should createan external file now, so that the hub's configuration fileonly needs to be edited once:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># Other name for our machineCO localhost printserver faxhost<CODECLASS="userinput"><B># Clients for which we receive mail</B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I><CODECLASS="userinput"><B>FO/etc/mail/clientlist</B></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> new</I></PRE></BLOCKQUOTE></P><PCLASS="para">If you use the external file approach, make certain to createthat file and add the local machine's name to it beforecontinuing.</P><PCLASS="para">&#13;After modifying the hub's <EMCLASS="emphasis">sendmail.cf</EM> file, you shouldtest it. Run <EMCLASS="emphasis">sendmail</EM> in rule-testingmode and give it the local machine's name as part of each address:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>/usr/lib/sendmail -bt</B></CODE>ADDRESS TEST MODEEnter &lt;ruleset&gt; &lt;address&gt;&gt;</PRE></BLOCKQUOTE></P><PCLASS="para">This example shows that the hub is running anold version of <EMCLASS="emphasis">sendmail</EM>,[4]one that always calls rule set 3 first. Bear that in mindas you feed it addresses.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] By old, we mean a non-IDA version, prior to V8.</P></BLOCKQUOTE><PCLASS="para">To test whether or not the hub's <EMCLASS="emphasis">sendmail</EM> recognizes thelocal machine as local to the hub, you need to see whether rule set0 selects the <CODECLASS="literal">local</CODE> delivery agent. Since rule set 3is automatically called first (for this old version of <EMCLASS="emphasis">sendmail</EM>),don't specify it. In itsabsence, the rules called for this old version of <EMCLASS="emphasis">sendmail</EM>will be 3, then 0:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>0 user@here</B></CODE>rewrite: ruleset  3   input: &quot;user&quot; &quot;@&quot; &quot;here&quot;rewrite: ruleset  6   input: &quot;user&quot; &quot;&lt;&quot; &quot;@&quot; &quot;here&quot; &quot;&gt;&quot;rewrite: ruleset  6 returns: &quot;user&quot; &quot;&lt;&quot; &quot;@&quot; &quot;LOCAL&quot; &quot;&gt;&quot;rewrite: ruleset  3 returns: &quot;user&quot; &quot;&lt;&quot; &quot;@&quot; &quot;LOCAL&quot; &quot;&gt;&quot;rewrite: ruleset  0   input: &quot;user&quot; &quot;&lt;&quot; &quot;@&quot; &quot;LOCAL&quot; &quot;&gt;&quot;rewrite: ruleset 30   input: &quot;user&quot;rewrite: ruleset  3   input: &quot;user&quot;rewrite: ruleset  3 returns: &quot;user&quot;rewrite: ruleset  0   input: &quot;user&quot;rewrite: ruleset  9   input: &quot;user&quot;rewrite: ruleset  9 returns: &quot;user&quot;rewrite: ruleset  0 returns: $# &quot;local&quot; $: &quot;user&quot;rewrite: ruleset 30 returns: $# &quot;local&quot; $: &quot;user&quot;rewrite: ruleset  0 returns: $# &quot;local&quot; $: &quot;user&quot;&gt;</PRE></BLOCKQUOTE></P><PCLASS="para">Success! The output that is produced will vary dependingon your hub's configuration file and version of <EMCLASS="emphasis">sendmail</EM>,but the result you are seeking will be the same. The lastline of output (what rule set 0 returns) should show thatthe <CODECLASS="literal">local</CODE> delivery agent was selected (the <CODECLASS="literal">$#</CODE>operator).</P><PCLASS="para">Now perform the same test, but this time include your domainas part of the hostname:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>0 user@here.us.edu</B></CODE>rewrite: ruleset  3   input: &quot;user&quot; &quot;@&quot; &quot;here&quot; &quot;.&quot; &quot;us&quot; &quot;.&quot; &quot;edu&quot;rewrite: ruleset  6   input: &quot;user&quot; &quot;&lt;&quot; &quot;@&quot; &quot;here&quot; &quot;.&quot; &quot;us&quot; &quot;.&quot; &quot;edu&quot; &quot;&gt;&quot;rewrite: ruleset  6 returns: &quot;user&quot; &quot;&lt;&quot; &quot;@&quot; &quot;LOCAL&quot; &quot;&gt;&quot;rewrite: ruleset  3 returns: &quot;user&quot; &quot;&lt;&quot; &quot;@&quot; &quot;LOCAL&quot; &quot;&gt;&quot;rewrite: ruleset  0   input: &quot;user&quot; &quot;&lt;&quot; &quot;@&quot; &quot;LOCAL&quot; &quot;&gt;&quot;rewrite: ruleset 30   input: &quot;user&quot;rewrite: ruleset  3   input: &quot;user&quot;rewrite: ruleset  3 returns: &quot;user&quot;rewrite: ruleset  0   input: &quot;user&quot;rewrite: ruleset  9   input: &quot;user&quot;rewrite: ruleset  9 returns: &quot;user&quot;rewrite: ruleset  0 returns: $# &quot;local&quot; $: &quot;user&quot;rewrite: ruleset 30 returns: $# &quot;local&quot; $: &quot;user&quot;rewrite: ruleset  0 returns: $# &quot;local&quot; $: &quot;user&quot;&gt;</PRE></BLOCKQUOTE></P><PCLASS="para">If all tests well, you need to kill and restart the <EMCLASS="emphasis">sendmail</EM>daemon on the hub. Review <ACLASS="xref"HREF="ch04_01.htm"TITLE="How to Run sendmail">Chapter 4, <CITECLASS="chapter">How to Run sendmail</CITE></A>,if you've forgotten how to do this.Beware of any frozen configuration file that might exist if thehub is running a pre-V8 version of <EMCLASS="emphasis">sendmail</EM>. If one exists, you willhave to refreeze it. (See the discussion of the <CODECLASS="literal">-bz</CODE>switch in<ACLASS="xref"HREF="ch36_01.htm"TITLE="The Command Line">Chapter 36, <CITECLASS="chapter">The Command Line</CITE></A>.)<ACLASS="indexterm"NAME="AUTOID-8631"></A><ACLASS="indexterm"NAME="AUTOID-8632"></A><ACLASS="indexterm"NAME="AUTOID-8633"></A>&#13;</P></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_03.htm"TITLE="15.3 MX Records"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 15.3 MX Records"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_05.htm"TITLE="15.5 Prevent the Daemon from Running"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 15.5 Prevent the Daemon from Running"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">15.3 MX Records</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">15.5 Prevent the Daemon from Running</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>