<HTML><HEAD><TITLE>[Chapter 15] 15.5 Prevent the Daemon from Running</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:39:19Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch15_01.htm"TITLE="15. Install and Test the client.cf File"><LINKREL="prev"HREF="ch15_04.htm"TITLE="15.4 Hub Accepts Mail for Client"><LINKREL="next"HREF="ch15_06.htm"TITLE="15.6 Install the client.cf File"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_04.htm"TITLE="15.4 Hub Accepts Mail for Client"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 15.4 Hub Accepts Mail for Client"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 15<BR>Install and Test the client.cf File</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_06.htm"TITLE="15.6 Install the client.cf File"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 15.6 Install the client.cf File"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-15-SECT-5">15.5 Prevent the Daemon from Running</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8637"></A>Once your MX record has taken effect, and once the hubhas been configured to recognize the client machine as itself,no mail should ever again be delivered to your local machine.[5]Since there will be no incoming mail connections, you no longerneed to run a <EMCLASS="emphasis">sendmail</EM> daemon. Preventing the daemonfrom running involves two steps. First you need to kill the<ACLASS="indexterm"NAME="AUTOID-8644"></A>running daemon, then you need to modify your <EMCLASS="emphasis">rc</EM>files so the daemon never runs again. We won't show you howto kill the daemon, because you have already learned that(see <ACLASS="xref"HREF="ch04_01.htm#SML2-CH-4-SECT-1-1-1"TITLE="Kill and restart, beginning with V8.7">Section 4.1.1.1, "Kill and restart, beginning with V8.7"</A>).Instead, we'll jump directly into preventing it from ever runningagain.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[5] Actually, some sites ignore MX records and try to deliver toyour local machine anyway. See <ACLASS="xref"HREF="ch36_07.htm#SML2-CH-36-SECT-7-11"TITLE="">Section 36.7.11, -bs</A> for adiscussion of one way to solve this problem.</P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8649"></A>If you haven't already done so, search your <EMCLASS="emphasis">rc</EM> filesto see how <EMCLASS="emphasis">sendmail</EM> is started when the machine firstboots. Under SysV, for example, that command and its resultsmight look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>grep &quot;sendmail.*-bd&quot; /etc/init.d/*</B></CODE>/etc/init.d/mail:    /usr/lib/sendmail -bd -q15m  &amp;</PRE></BLOCKQUOTE></P><PCLASS="para">Under BSD 4.4 UNIX, however, they will look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>grep sendmail /etc/rc*</B></CODE>/etc/rc:echo -n ' sendmail';            sendmail -bd -q30m</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;In the following, we will describe the BSD version. It is somewhatsimpler to describe, but the underlying lessons are the samefor both.</P><PCLASS="para">To be safe, save a copy of the <EMCLASS="emphasis">rc</EM> file beforechanging it:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cp /etc/rc /etc/rc.orig</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Then edit the <EMCLASS="emphasis">rc</EM> file and searchfor the shell commands that runs <EMCLASS="emphasis">sendmail</EM>. They will looksomething like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">echo -n ' nfsd';                nfsd -u -t 6echo -n ' nfsiod';              nfsiod 4echo -n ' sendmail';            sendmail -bd -q30m<ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> note</I>echo -n ' inetd';               inetd</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8673"></A>Find the line that runs the daemon (<EMCLASS="emphasis">sendmail</EM> with the <CODECLASS="literal">-bd</CODE>command-line switch) and remove the <CODECLASS="literal">-bd</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">echo -n ' sendmail';      sendmail -q30m                                  <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                                  <ICLASS="lineannotation">remove -bd</I></PRE></BLOCKQUOTE></P><PCLASS="para">Extreme care must be taken in making changes to any of the <EMCLASS="emphasis">rc</EM>files. These are executed only when the system is rebooted, so errorswon't show up until a very awkward moment. A mistake here can potentiallykeep your workstation from booting.</P><PCLASS="para">The <CODECLASS="literal">-bd</CODE> switch caused <EMCLASS="emphasis">sendmail</EM> to run as a daemonand listen for incoming SMTP connections. We removed thatswitch so that <EMCLASS="emphasis">sendmail</EM> would no longer listen for connections.<ACLASS="indexterm"NAME="AUTOID-8689"></A>The <CODECLASS="literal">-q30m</CODE> switchthat remains causes <EMCLASS="emphasis">sendmail</EM> to process the queue onceevery 30 minutes. We leave that switch in place because <EMCLASS="emphasis">sendmail</EM>still needs to process the queue periodically[6](in case the hub is down).&#13;</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[6] An alternative approach is to use <EMCLASS="emphasis">cron</EM>(8) to execute <EMCLASS="emphasis">sendmail</EM>periodically with a bare <CODECLASS="literal">-q</CODE> switch.</P></BLOCKQUOTE></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_04.htm"TITLE="15.4 Hub Accepts Mail for Client"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 15.4 Hub Accepts Mail for Client"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch15_06.htm"TITLE="15.6 Install the client.cf File"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 15.6 Install the client.cf File"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">15.4 Hub Accepts Mail for Client</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">15.6 Install the client.cf File</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>