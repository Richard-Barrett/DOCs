<HTML><HEAD><TITLE>[Chapter 17] 17.2 Rule Set 96</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:40:14Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch17_01.htm"TITLE="17. The Hub's Complex Rules"><LINKREL="prev"HREF="ch17_01.htm"TITLE="17.1 Rule Set 3"><LINKREL="next"HREF="ch17_03.htm"TITLE="17.3 Rule Set 0"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_01.htm"TITLE="17.1 Rule Set 3"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 17.1 Rule Set 3"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 17<BR>The Hub's Complex Rules</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_03.htm"TITLE="17.3 Rule Set 0"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 17.3 Rule Set 0"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-17-SECT-2">17.2 Rule Set 96</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-17-IX-RULE-SETS-RULE-SET-96"></A>After each address has its host part focused by rule set 3, itis passed to rule set 96 (by a subroutine call with the <CODECLASS="literal">$&gt;</CODE>operator). Rule set 96 verifies that each address is good.It is not used by all configuration files but is usedby the configuration files that are distributed with V8 <EMCLASS="emphasis">sendmail</EM>.&#13;</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-17-SECT-2-1">17.2.1 Is the Host Local?</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9284"></A><ACLASS="indexterm"NAME="AUTOID-9287"></A><ACLASS="indexterm"NAME="AUTOID-9290"></A>First, rule set 96 determines whether the focusedhost part is really the name of the local machine. This determinationis less straightforward than you might think.The special hostname <CODECLASS="literal">localhost</CODE>, by which all hosts are known,is checked first:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* &lt; @localhost      &gt;$*       $: $1 &lt;@$j.&gt; $2      Sans domainR$* &lt; @localhost.$m   &gt;$*       $: $1 &lt;@$j.&gt; $2      With domainR$* &lt; @localhost.UUCP &gt;$*       $: $1 &lt;@$j.&gt; $2      With UUCP domain</PRE></BLOCKQUOTE></P><PCLASS="para">The name <CODECLASS="literal">localhost</CODE> is checked in three forms (thus three rules):first as a bare hostname (without a domain part), then with the localdomain attached (as stored in <CODECLASS="literal">$m</CODE>), and finally with the pseudo-name UUCP attached (on the off chance that mail was sent to the localhost via UUCP).<ACLASS="indexterm"NAME="AUTOID-9299"></A><ACLASS="indexterm"NAME="AUTOID-9302"></A>Later, the class <CODECLASS="literal">$=w</CODE>, whichlists all the names of the local host, will be checked.Here, <CODECLASS="literal">localhost</CODE> is checkedbecause there is no guarantee that it will be included in <CODECLASS="literal">$=w</CODE>.</P><PCLASS="para">The next three rules handle a host that is in numeric IP form.Such a hostname is formed by surrounding four dot-separatedintegers with square brackets (like <EMCLASS="emphasis">[123.45.67.8]</EM>).</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* &lt; @ [$+] &gt; $*            $: $1 &lt;@@ [$2]&gt;$3      is it numeric IP?R$* &lt; @@ $=w &gt; $*            $: $1 &lt;@  $j.&gt; $2      yes. Is it us?R$* &lt; @@ $+  &gt; $*            $@ $1 &lt;@  $2&gt; $3       yes, but not us.</PRE></BLOCKQUOTE></P><PCLASS="para">The first of these rulesfinds anything surrounded by square brackets (it doesnot care whether that anything is an IP address). If found, it prefixes thehost part with an extra <CODECLASS="literal">@</CODE> so that only the next two ruleswill see it. The second rule compares the IP address to thelist of hostnames in <CODECLASS="literal">$=w</CODE>.[4]If the IP address is found in <CODECLASS="literal">$=w</CODE>, the host is changedto the value in <CODECLASS="literal">$j</CODE> (the local, full canonical hostname).If the IP address is not that of the local host, the third rulecauses it to be immediately returned as a valid (but not local)IP address.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] Under V8 <EMCLASS="emphasis">sendmail</EM> the localhost's IP address is automatically added to class <CODECLASS="literal">w</CODE>.Beginning with V8.7 <EMCLASS="emphasis">sendmail</EM>, the addresses associatedwith all network interfaces are also added to the class <CODECLASS="literal">w</CODE>.</P></BLOCKQUOTE><PCLASS="para">The next two rules in rule set 96 determine whether the hostname isone of those declared as local in class <CODECLASS="literal">$=w</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* &lt; @ $=w    &gt; $*         $: $1 &lt;@ $j.&gt; $3     us?R$* &lt; @ $=w.$m &gt; $*         $: $1 &lt;@ $j.&gt; $3     us with domain?</PRE></BLOCKQUOTE></P><PCLASS="para">The first just examines the list of hosts in the class <CODECLASS="literal">$=w</CODE>and, if found, converts the workspace to the full canonical name of the localhost (<CODECLASS="literal">$j.</CODE>). The second performs the same search and substitutionbut appends the local domain (<CODECLASS="literal">$m</CODE>) to each host in <CODECLASS="literal">$=w</CODE>.Neither rewrite is returned (no <CODECLASS="literal">$@</CODE> prefix to the RHS) butis instead carried down to subsequent rules.</P><PCLASS="para">At this point, UUCP hosts should be returned as is because the rest ofthe rules in rule set 96 deal with DNS and canonicalization.<ACLASS="indexterm"NAME="AUTOID-9333"></A><ACLASS="indexterm"NAME="AUTOID-9335"></A>The next rule handles this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* &lt; @ $+.UUCP &gt; $*        $@ $1 &lt;@$2.UUCP&gt; $3  pass back uucp</PRE></BLOCKQUOTE></P><PCLASS="para">This rule looks for any host (<CODECLASS="literal">$+</CODE>)with a .UUCP suffix and returns (the <CODECLASS="literal">$@</CODE> prefix to the RHS)that address unchanged.Review <ACLASS="xref"HREF="ch17_01.htm#SML2-CH-17-SECT-1-4"TITLE="UUCP Addresses">Section 17.1.4, "UUCP Addresses"</A> to see how the .UUCP suffixcame to be attached in the first place. </P><PCLASS="para">Any address that has made it this far is next looked up withDNS:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* &lt; @ $* $~P &gt; $*         $: $1 &lt;@ $[ $2$3 $]&gt; $4      canonicalize</PRE></BLOCKQUOTE></P><PCLASS="para">Here, the notation <CODECLASS="literal">$~P</CODE> denotes anything that is <EMCLASS="emphasis">not</EM> in theclass <CODECLASS="literal">P</CODE>. That class was declared elsewhere. It contains a listof pseudo-domains (domains that cannot be looked up with DNS, suchas UUCP and BITNET).If the last component of the hostname is other than one of thepseudo-domains, the RHS causes that hostname to be looked upwith DNS and replaced with the full canonical name for that host.If the hostname corresponds to a CNAME, it will be replaced withthe name of the corresponding A or MX record.If the address is an IP address (such as <EMCLASS="emphasis">[123.45.67.80]</EM>),a PTR record will be looked up to find the canonical name.If the lookup fails, the name is unchanged.If the lookup succeeds, the canonical name will replace the lookedup name and a dot will be appended.[5]On some machines this lookup may use <EMCLASS="emphasis">/etc/hosts</EM>, <EMCLASS="emphasis">nis</EM>,<EMCLASS="emphasis">nisplus</EM>, or some other means defined by your service switch file.In the configuration file that we have been examining, a successful DNS lookup causes a dotto be appended to the resulting hostname. This the same as what hasbeen done all along by adding a dot to <CODECLASS="literal">$j</CODE>.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[5] This process is described in more detail in <ACLASS="xref"HREF="ch33_04.htm#SML2-CH-33-SECT-4-3"TITLE="$[ and $]: A Special Case">Section 33.4.3, "$[ and $]: A Special Case"</A>, whichalso explains how to change the dot to a different character or characters.</P></BLOCKQUOTE><PCLASS="para">The last few rules merely perform some housekeeping by addinga dot to any valid addresses that lack one:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* &lt; @ $* $=P &gt; $*         $: $1 &lt;@ $2$3 .&gt; $4        canonicalize pseudosR$* &lt; @ $*..   &gt; $*            $1 &lt;@ $2.&gt; $3           strip extra dotsR$* &lt; @ $j     &gt; $*            $1 &lt;@ $2.&gt; $3           canonicalize local</PRE></BLOCKQUOTE></P><PCLASS="para">In the first rule, pseudo-domains are considered canonical because there isno way to check their validity.The second rule strips any extra trailing dots in case they may have been addedby accident.[6]Finally, a hostname of <CODECLASS="literal">$j</CODE> is checked, and if it is found,a dot is added, thus finishing rule set 96's job.<ACLASS="indexterm"NAME="AUTOID-9366"></A>&#13;</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[6] Sometimes <CODECLASS="literal">$=P</CODE> contains just a dot. In this case, any address thatends with a dot will have that ending dot doubled.</P></BLOCKQUOTE></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_01.htm"TITLE="17.1 Rule Set 3"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 17.1 Rule Set 3"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_03.htm"TITLE="17.3 Rule Set 0"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 17.3 Rule Set 0"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">17.1 Rule Set 3</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">17.3 Rule Set 0</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>