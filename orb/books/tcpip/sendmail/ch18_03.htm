<HTML><HEAD><TITLE>[Chapter 18] 18.3 Obtain the Source</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T18:42:18Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch18_01.htm"TITLE="18. Compile and Install sendmail"><LINKREL="prev"HREF="ch18_02.htm"TITLE="18.2 Vendor Versus Compiling"><LINKREL="next"HREF="ch18_04.htm"TITLE="18.4 Tuning Makefile"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_02.htm"TITLE="18.2 Vendor Versus Compiling"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 18.2 Vendor Versus Compiling"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 18<BR>Compile and Install sendmail</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_04.htm"TITLE="18.4 Tuning Makefile"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 18.4 Tuning Makefile"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-18-SECT-3">18.3 Obtain the Source</A></H2><PCLASS="para">V8 <EMCLASS="emphasis">sendmail</EM> is available from: </P><PCLASS="para"><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><ACLASS="systemitem.url"HREF="ftp://ftp.sendmail.org/ucb/sendmail">ftp://ftp.sendmail.org/ucb/sendmail</A></P></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-18-IX-SENDMAIL-OBTAINING-SOURCE-CODE"></A><ACLASS="indexterm"NAME="SML2-CH-18-IX-OBTAINING-SENDMAIL-SOURCE-CODE"></A><ACLASS="indexterm"NAME="SML2-CH-18-IX-SOURCE-CODE-OBTAINING"></A>When you <EMCLASS="emphasis">cd</EM> into this directory, a banner is displayed that describesthe latest release and available patches. You may choose between two formsof compressed <EMCLASS="emphasis">tar</EM>(1) distributions. Those that end in <EMCLASS="emphasis">.Z</EM> arecompressed with UNIX <EMCLASS="emphasis">compress</EM>(1); those that end in <EMCLASS="emphasis">.gz</EM>are compressed with GNU <EMCLASS="emphasis">gzip</EM>(1).The latter is the preferred form because the file is smaller and quicker to transfer.</P><PCLASS="para">In addition to the two forms of distribution, each release has associatedwith it a PGP signature file. It is a signature of the uncompressedfile, so you need to uncompress the <EMCLASS="emphasis">tar</EM>(1) file before verifying it.To verify a pre-V8.6 distribution, get Eric Allman's public key bysending email to <EMCLASS="emphasis">pgp-public-keys@keys.pgp.net</EM> with the following subject line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Subject: MGET Allman</PRE></BLOCKQUOTE></P><PCLASS="para">Eric Allman's public key will be mailed back to you a few minutes later.[2]Save that returned email to a file, for example <EMCLASS="emphasis">/tmp/eric.asc</EM>, andadd that key to your public &quot;keyring&quot; with the command:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] As an alternative, you can run the command&#13;</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">finger -l eric@finger.sendmail.org &gt; /tmp/eric.asc</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;and use that PGP information in place of the email information.They are equivalent.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">pgp -ka /tmp/eric.asc</PRE></BLOCKQUOTE></P><PCLASS="para">For V8.6 and above, you download a special <EMCLASS="emphasis">signing key</EM> from<EMCLASS="emphasis">www.sendmail.org</EM>, instead of Eric's key. The fingerprint forthe <EMCLASS="emphasis">signing key</EM> is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">CA AE F2 94 3B 1D 41 3C  94 7B 72 5F AE 0B 6A 11</PRE></BLOCKQUOTE></P><PCLASS="para">The fingerprint for Eric's key is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">C0 28 E6 7B 13 5B 29 02 6F 7E 43 3A 48 4F 45 29</PRE></BLOCKQUOTE></P><PCLASS="para">then execute:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">pgp <ICLASS="lineannotation">signature file here</I></PRE></BLOCKQUOTE></P><PCLASS="para">If the uncompressed tar file is good, <EMCLASS="emphasis">pgp</EM>(1) will report the followingor some variation on it:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Good signature from user &quot;Eric P. Allman &lt;eric@CS.Berkeley.EDU&gt;&quot;.</PRE></BLOCKQUOTE></P><PCLASS="para">A few things can go wrong here, causing the verification to fail:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Signature and <EMCLASS="emphasis">tar</EM>(1) files must match each other's versions.Transfer them again, this time with matching versions.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9685"></A><ACLASS="indexterm"NAME="AUTOID-9688"></A>When transferring the files with <EMCLASS="emphasis">ftp</EM>(1), you must be sureto use <EMCLASS="emphasis">binary</EM> mode. Transfer them again, this timewith the correct mode.</P></LI><LICLASS="listitem"><PCLASS="para">A presumed mirror FTP site might not be as official as youexpect.If a secondary distribution fails to verify, get the official distributions from the official site shown above.</P></LI><LICLASS="listitem"><PCLASS="para">The official distribution may appear bad. If it fails to verify,first check that your copy of <EMCLASS="emphasis">pgp</EM> was correctly installed,then check that your network connection is clean and thatit has not been compromised. If all else fails (including gettingthe distribution anew as above), describe your problem tothe folks at <EMCLASS="emphasis">sendmail@sendmail.org</EM>.</P></LI></UL><PCLASS="para">If your copy of the <EMCLASS="emphasis">sendmail</EM> distribution fails to verify,<EMCLASS="emphasis">don't use it</EM>!</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-18-SECT-3-1">18.3.1 What's Where in the Source</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9705"></A>V8.8.6 <EMCLASS="emphasis">sendmail</EM> unpacks by creating a directory, then unpackinginto that directory. The directory name is the same as the compressedfile name but with the first dot a dash instead:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>zcat sendmail.8.8.6.tar.Z | tar xvf -</B></CODE>x sendmail-8.8.6/FAQ, 32312 bytes, 64 tape blocksx sendmail-8.8.6/KNOWNBUGS, 4714 bytes, 10 tape blocksx sendmail-8.8.6/Makefile, 1215 bytes, 3 tape blocks... <ICLASS="lineannotation">and so on</I></PRE></BLOCKQUOTE></P><PCLASS="para">Inside the newly created directory you will find the full <EMCLASS="emphasis">sendmail</EM>distribution:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cd sendmail-8.8.6</B></CODE>% <CODECLASS="userinput"><B>ls</B></CODE>FAQ             RELEASE_NOTES   mail.local      rmailKNOWNBUGS       cf              mailstats       smrshMakefile        contrib         makemap         srcREAD_ME         doc             praliases       test</PRE></BLOCKQUOTE></P><PCLASS="para">The <EMCLASS="emphasis">READ_ME</EM> and <EMCLASS="emphasis">RELEASE_NOTES</EM> files provide the most up-to-dateinformation about changes, new features, and bug fixes.Read the documents in the <EMCLASS="emphasis">doc</EM> directory.Also note that there are important comments in the <EMCLASS="emphasis">src/READ_ME</EM>and <EMCLASS="emphasis">cf/README</EM> files.</P><PCLASS="para">You will find almost everything you need to build <EMCLASS="emphasis">sendmail</EM> in the <EMCLASS="emphasis">src</EM> subdirectory.There are a few exceptions that we will cover in thischapter.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-18-SECT-3-2">18.3.2 The makesendmail Script</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9730"></A>The first step in compiling <EMCLASS="emphasis">sendmail</EM> is to establish an objectdirectory and a <EMCLASS="emphasis">Makefile</EM> that is appropriate to your machine architectureand operating system. You do this by running the <EMCLASS="emphasis">makesendmail</EM> scriptin the <EMCLASS="emphasis">src</EM> directory:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cd src</B></CODE>% <CODECLASS="userinput"><B>./makesendmail -n</B></CODE>Configuration: os=SunOS, rel=4.1.4, rbase=4, arch=sun4, sfx=Creating obj.SunOS.4.1.4.sun4 using Makefile.SunOSMaking dependencies in obj.SunOS.4.1.4.sun4<ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> many more lines here</I>%</PRE></BLOCKQUOTE></P><PCLASS="para">Here, <EMCLASS="emphasis">makesendmail</EM> found that ours was a <CODECLASS="literal">sun4</CODE> machine,running the SunOS 4.1.4 release of UNIX. It created the workingdirectory <EMCLASS="emphasis">obj.SunOS.4.1.4.sun4</EM>, set up symbolic links to all the source filesin that directory, and copied a <EMCLASS="emphasis">Makefile</EM> there.<ACLASS="indexterm"NAME="AUTOID-9746"></A>The <CODECLASS="literal">-n</CODE> switch[3]prevents <EMCLASS="emphasis">make</EM> from actuallybuilding <EMCLASS="emphasis">sendmail</EM>.Note that, except for the <CODECLASS="literal">-m</CODE> switch, all command-line arguments followingthe <EMCLASS="emphasis">makesendmail</EM> are passed to <EMCLASS="emphasis">make</EM>(1) as its own command-line arguments.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] As an alternative, the <CODECLASS="literal">-m</CODE> command-line switchcauses <EMCLASS="emphasis">makesendmail</EM> to print the name of your <EMCLASS="emphasis">Makefile</EM>without actually creating the <EMCLASS="emphasis">obj.*</EM> subdirectory.<ACLASS="indexterm"NAME="AUTOID-9755"></A></P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9763"></A><ACLASS="indexterm"NAME="AUTOID-9766"></A>The <EMCLASS="emphasis">makesendmail</EM> script knows how to build <EMCLASS="emphasis">sendmail</EM> on manyversions of UNIX, including offshoots such as OSF/1 and NextStep.In the unlikely case that your operating system is not supported, you will seean error message instead of the above output:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Configuration: os=EX/Unix, rel=1, rbase=1, arch=sun4, sfx=Cannot determine how to support sun4.EX/Unix.1</PRE></BLOCKQUOTE></P><PCLASS="para">Here, an experimental version of UNIX called <EMCLASS="emphasis">EX/Unix</EM> on a sun4 computer was unrecognized by the <EMCLASS="emphasis">makesendmail</EM>script. Porting <EMCLASS="emphasis">sendmail</EM> to new operating systems is reallybeyond the scope of this book. But we offer a complete listingof <CODECLASS="literal">#define</CODE> macros in <ACLASS="xref"HREF="ch18_08.htm"TITLE="Alphabetized Reference">Section 18.8</A> at theend of this chapter, and that, as well asmuch of the tuning that we discuss here, can also be germane to porting.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-18-SECT-3-3">18.3.3 What to Tune</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9782"></A>Before you let <EMCLASS="emphasis">makesendmail</EM> run to completion, you mayneed to tune three of <EMCLASS="emphasis">sendmail</EM>'s files for your site:</P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">Makefile/</EM><CODECLASS="literal">*</CODE></DT><DDCLASS="listitem"><PCLASS="para">Specifies where to install the binaries and how to compile them.<EMCLASS="emphasis">Makefile</EM> is normally the only file you willhave to modify if you are running an already supported operating system</P></DD><DTCLASS="term"><EMCLASS="emphasis">conf.h</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9800"></A>Specifies maximum sizes and other properties that are tunable for porting:</P></DD><DTCLASS="term"><EMCLASS="emphasis">conf.c</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9807"></A>Specifies C language code to support specific and unusual needs.Tunable items in <EMCLASS="emphasis">conf.c</EM> include the <EMCLASS="emphasis">checkcompat</EM>()routine (see <ACLASS="xref"HREF="ch20_01.htm"TITLE="The checkcompat() Cookbook">Chapter 20, <CITECLASS="chapter">The checkcompat() Cookbook</CITE></A>)and default header behavior (see <ACLASS="xref"HREF="ch35_05.htm"TITLE="Header Behavior in conf.c">Section 35.5, "Header Behavior in conf.c"</A>).<ACLASS="indexterm"NAME="AUTOID-9813"></A><ACLASS="indexterm"NAME="AUTOID-9814"></A><ACLASS="indexterm"NAME="AUTOID-9815"></A></P></DD></DL></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_02.htm"TITLE="18.2 Vendor Versus Compiling"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 18.2 Vendor Versus Compiling"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_04.htm"TITLE="18.4 Tuning Makefile"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 18.4 Tuning Makefile"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">18.2 Vendor Versus Compiling</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">18.4 Tuning Makefile</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>