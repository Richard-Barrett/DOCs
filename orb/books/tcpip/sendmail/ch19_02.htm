<HTML><HEAD><TITLE>[Chapter 19] 19.2 Build with m4</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:11:27Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch19_01.htm"TITLE="19. V8 m4 Configuration"><LINKREL="prev"HREF="ch19_01.htm"TITLE="19.1 The m4 Preprocessor"><LINKREL="next"HREF="ch19_03.htm"TITLE="19.3 The Minimal mc File"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch19_01.htm"TITLE="19.1 The m4 Preprocessor"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 19.1 The m4 Preprocessor"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 19<BR>V8 m4 Configuration</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch19_03.htm"TITLE="19.3 The Minimal mc File"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 19.3 The Minimal mc File"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-19-SECT-2">19.2 Build with m4</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13194"></A>The process of building a <EMCLASS="emphasis">sendmail</EM> configuration file begins by creating a file of <EMCLASS="emphasis">m4</EM>statements. Traditionally, the suffix for such files is <CODECLASS="literal">.mc</CODE>.The <EMCLASS="emphasis">cf/cf</EM> directory contains examples of many <CODECLASS="literal">mc</CODE> files. Ofspecial interest are those that begin with <CODECLASS="literal">generic</CODE>, forthese can serve as boilerplates in developing your own <CODECLASS="literal">mc</CODE> files:<ACLASS="indexterm"NAME="AUTOID-13204"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">generic-bsd4.4.mc       generic-solaris2.mcgeneric-hpux10.mc       generic-sunos4.1.mcgeneric-hpux9.mc        generic-ultrix4.mcgeneric-osf1.mc</PRE></BLOCKQUOTE></P><PCLASS="para">All <CODECLASS="literal">mc</CODE> files require specific minimal statements. For a SunOS 4.1.4 siteon the Internet, for example, the following are minimal:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">OSTYPE(sunos4.1)dnl	<ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> see <ACLASS="xref"HREF="ch19_03.htm#SML2-CH-19-SECT-3-1"TITLE="OSTYPE()">Section 19.3.1, "OSTYPE()"</A></I>MAILER(local)dnl		<ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> see <ACLASS="xref"HREF="ch19_03.htm#SML2-CH-19-SECT-3-2"TITLE="MAILER()">Section 19.3.2</A></I>MAILER(smtp)dnl		<ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> see <ACLASS="xref"HREF="ch19_03.htm#SML2-CH-19-SECT-3-2"TITLE="MAILER()">Section 19.3.2</A></I></PRE></BLOCKQUOTE></P><PCLASS="para">To build a configuration file from these statements, you would place theminto a file, say <EMCLASS="emphasis">localsun.mc</EM>, then run the following command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>m4  ../m4/cf.m4 localsun.mc &gt; sendmail.cf</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Here, the <CODECLASS="literal">../m4/cf.m4</CODE> tells <EMCLASS="emphasis">m4</EM> where to look for its defaultconfiguration file information.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13227"></A><ACLASS="indexterm"NAME="AUTOID-13230"></A>If you are using an old version of <EMCLASS="emphasis">m4</EM>,the following error message will be printed:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">You need a newer version of M4, at least as new asSystem V or GNUm4: file not found: NoSuchFile</PRE></BLOCKQUOTE></P><PCLASS="para">Just as the messages says, you need a newer version of <EMCLASS="emphasis">m4</EM>.(The third line is just a result of forcing <EMCLASS="emphasis">m4</EM> to fail andmay be safely ignored.) In our <EMCLASS="emphasis">localsun.mc</EM>example we would need to rerun it as</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>/usr/5bin/m4  ../m4/cf.m4 localsun.mc &gt; sendmail.cf</B></CODE>  <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>  <ICLASS="lineannotation">System V version of m4</I></PRE></BLOCKQUOTE></P><PCLASS="para">Another cause of failure could be that the <CODECLASS="literal">../m4/cf.m4</CODE> file wasnot where you thought it was.Various versions of <EMCLASS="emphasis">m4</EM> print this error in different ways:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">/usr/5bin/m4:-:1 can't open file                 <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> SysV m4</I>m4: ../m4/cf.m4: No such file or directory       <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> GNU m4</I>m4: file not found: ../m4/cf.m4                  <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> BSD m4</I></PRE></BLOCKQUOTE></P><PCLASS="para">One possible reason for this error might be that you aredeveloping your <CODECLASS="literal">mc</CODE> file somewhereother than in the <EMCLASS="emphasis">cf/cf</EM> directory.[1]The solution is to use a full pathname to <EMCLASS="emphasis">cf.m4</EM> or to replacethat expression on the command line with a shell variable.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] This is actually a good idea. It prevents new <EMCLASS="emphasis">sendmail</EM> distributions fromclobbering your <CODECLASS="literal">mc</CODE> files.</P></BLOCKQUOTE><PCLASS="para">After you have successfully produced a &quot;first draft&quot; of your configurationfile, you can edit <EMCLASS="emphasis">localsun.mc</EM> and add features as you need them.Many possibilities are described in the rest of this chapter.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-19-SECT-2-1">19.2.1 Maintain local files with _CF_DIR_</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13266"></A>It can be advantageous to maintain all the files that make up yourlocal <EMCLASS="emphasis">m4</EM> configuration separately from the <EMCLASS="emphasis">sendmail</EM> distribution.This prevents new releases of <EMCLASS="emphasis">sendmail</EM> from clobbering your source files.It also allows you to maintain configuration information more conveniently(perhaps under <EMCLASS="emphasis">rcs</EM>(1) control)and to use programs like <EMCLASS="emphasis">make</EM>(1) to simplify configuring and installation.</P><PCLASS="para">Most modern versions of <EMCLASS="emphasis">m4</EM> allow you to define macros on the command line,and one such macro is recognized internally by the <EMCLASS="emphasis">m4</EM> technique:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">_CF_DIR_</PRE></BLOCKQUOTE></P><PCLASS="para">This macro tells <EMCLASS="emphasis">m4</EM> where the <EMCLASS="emphasis">m4/cf.m4</EM> file described aboveis located.This macro needs to be set to the <EMCLASS="emphasis">cf</EM> directory under the <EMCLASS="emphasis">sendmail</EM>source distribution, and it needs to end in a slash character. For example,GNU <EMCLASS="emphasis">m4</EM> version 1.2 allows this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>setenv CFDIR /usr/local/src/mail/sendmail/cf/</B></CODE>% <CODECLASS="userinput"><B>/usr/local/gnu/bin/m4 -D_CF_DIR_=${CFDIR} ${CFDIR}m4/cf.m4 localsun.mc \</B></CODE>    &gt; sendmail.cf</PRE></BLOCKQUOTE></P><PCLASS="para">Notice that we store the value for <CODECLASS="literal">_CF_DIR_</CODE> in an environmental variable.[2]If your version of <EMCLASS="emphasis">m4</EM> lacks this ability, you should consider upgrading.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] Note that <EMCLASS="emphasis">gnu</EM> <EMCLASS="emphasis">m4</EM> can figure out the <CODECLASS="literal">_CF_DIR_</CODE>path itself from the path of the <EMCLASS="emphasis">cf.m4</EM> file. We include <CODECLASS="literal">_CF_DIR_</CODE> herefor example purposes.</P></BLOCKQUOTE><PCLASS="para">By using the _CF_DIR_ macro, configuration and installation can be further simplified by using <EMCLASS="emphasis">make</EM>(1). To illustrate, consider thefollowing few lines from a <EMCLASS="emphasis">Makefile</EM> on a SunOS system:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">M4=/usr/local/gnu/bin/m4CFDIR=/usr/local/src/mail/sendmail/cf/localsun: localsun.mc        $(M4) -D_CF_DIR_=$(CFDIR) $(CFDIR)/m4/cf.m4 localsun.mc &gt; sendmail.cf</PRE></BLOCKQUOTE></P><PCLASS="para">With this <EMCLASS="emphasis">Makefile</EM> the above two complex command lines are reducedto a single, simple command line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>make</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch19_01.htm"TITLE="19.1 The m4 Preprocessor"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 19.1 The m4 Preprocessor"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch19_03.htm"TITLE="19.3 The Minimal mc File"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 19.3 The Minimal mc File"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">19.1 The m4 Preprocessor</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">19.3 The Minimal mc File</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>