<HTML><HEAD><TITLE>[Chapter 21] DNS and sendmail</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:27:26Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part03.htm"TITLE="III. Administration"><LINKREL="prev"HREF="part03.htm"TITLE="III. Administration"><LINKREL="next"HREF="ch21_02.htm"TITLE="21.2 How sendmail Uses DNS"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="PART"HREF="part03.htm"TITLE="III. Administration"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: III. Administration"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 21</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch21_02.htm"TITLE="21.2 How sendmail Uses DNS"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 21.2 How sendmail Uses DNS"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="SML2-CH-21">21. DNS and sendmail</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#SML2-CH-21-SECT-1"TITLE="21.1 Overview">Overview</A><BR><ACLASS="sect1"HREF="ch21_02.htm"TITLE="21.2 How sendmail Uses DNS">How sendmail Uses DNS</A><BR><ACLASS="sect1"HREF="ch21_03.htm"TITLE="21.3 Set Up MX Records">Set Up MX Records</A><BR><ACLASS="sect1"HREF="ch21_04.htm"TITLE="21.4 How to Use nslookup">How to Use nslookup</A><BR><ACLASS="sect1"HREF="ch21_05.htm"TITLE="21.5 Prepare for Disaster">Prepare for Disaster</A><BR><ACLASS="sect1"HREF="ch21_06.htm"TITLE="21.6 Pitfalls">Pitfalls</A></P><P></P></DIV><PCLASS="para"></P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-21-SECT-1">21.1 Overview</A></H2><PCLASS="para">DNS stands for Domain Naming System.<ACLASS="indexterm"NAME="SML2-CH-21-IX-DNS-DOMAIN-NAME-SYSTEM"></A><ACLASS="indexterm"NAME="AUTOID-17079"></A>A domain is any logical or physical collection of related hosts or sites.A naming system is best visualized as an inverted tree of informationthat corresponds to full qualified hostnames (see<ACLASS="xref"HREF="ch21_01.htm#SML2-CH-21-FIG-0"TITLE="Domain names form a tree of information">Figure 21.1</A>).</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-21-FIG-0">Figure 21.1: Domain names form a tree of information</A></H4><IMGCLASS="graphic"SRC="figs/sm2101.gif"ALT="Figure 21.1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-17088"></A>The parts of a fully qualified name are separatedfrom one another with dots. For example,</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">here.uofa.edu</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;This name describes the machine <CODECLASS="literal">here</CODE> that is part of the <CODECLASS="literal">uofa</CODE>subdomain of the <CODECLASS="literal">edu</CODE> top-level domain. In<ACLASS="xref"HREF="ch21_01.htm#SML2-CH-21-FIG-0"TITLE="Domain names form a tree of information">Figure 21.1</A>the dot at the top is the &quot;root&quot; of the tree.It is implied but never[1]included in fully-qualified domain names:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] Well, hardly ever. It can be used under some circumstances to preventthe local domain from being accidently appended improperly.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">here.uofa.edu.             <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>             <ICLASS="lineannotation">implied</I></PRE></BLOCKQUOTE></P><PCLASS="para">The root corresponds to (is served by) actual machines. [2]Each has knowledge of all the top-level domains(such as <CODECLASS="literal">gov</CODE>, <CODECLASS="literal">com</CODE>, etc.) and the server machinesfor those domains.Each of the top-level domain's servers knows of one or more machines withknowledge of the next level below. For example, the server for <CODECLASS="literal">edu</CODE> &quot;knows&quot; about the subdomains<CODECLASS="literal">uofa</CODE>, <CODECLASS="literal">uofb</CODE>, and <CODECLASS="literal">uofc</CODE> but may not knowabout anything below those subdomains, nor about the otherdomains next to itself such as <CODECLASS="literal">com</CODE>.[3]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] This used to be a single machine named <EMCLASS="emphasis">ns.internic.net</EM>but is now several machines named <EMCLASS="emphasis">a.root-servers.net</EM>,<EMCLASS="emphasis">b.root-servers.net</EM>, and so on.</P><PCLASS="para">[3] There is also a type of server called &quot;caching.&quot; This typedoesn't originate information about domains but is able to lookup and save information and to supply it on request.<ACLASS="indexterm"NAME="AUTOID-17118"></A><ACLASS="indexterm"NAME="AUTOID-17121"></A></P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-17125"></A><ACLASS="indexterm"NAME="AUTOID-17128"></A>A knowledgeable machine, one that can look up or distribute information aboutits domain and subdomains, is called a <EMCLASS="emphasis">name server</EM>.Each little black square in the figure represents a name server for a portion ofa domain.Each is required to have knowledge only of what is immediatelybelow it. This minimizes the amount of knowledgeany given name server must store and administer.</P><PCLASS="para">To illustrate the way this distributed information is used, see<ACLASS="xref"HREF="ch21_01.htm#SML2-CH-21-FIG-1"TITLE="How DNS lookups are performed">Figure 21.2</A>for the steps that are taken when<EMCLASS="emphasis">sendmail</EM> on <EMCLASS="emphasis">here.uofa.edu</EM> (the local host) attempts toconnect to <EMCLASS="emphasis">fbi.dc.gov</EM> (the remote host) to sendan email message to a user there.</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-21-FIG-1">Figure 21.2: How DNS lookups are performed</A></H4><IMGCLASS="graphic"SRC="figs/sm2102.gif"ALT="Figure 21.2"><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">The local <EMCLASS="emphasis">sendmail</EM> needs the IP number of the remote host to initiate a network connection. The local <EMCLASS="emphasis">sendmail</EM>asks its local name server (say, <EMCLASS="emphasis">mail.uofa.edu</EM>) for that address.The <EMCLASS="emphasis">mail.uofa.edu</EM> name server may alreadyknow the address (having cached thatinformation during a previous inquiry). If so, it gives the requestedaddress to the local <EMCLASS="emphasis">sendmail</EM>, and no further DNS requestsneed to be made. If the local name serverdoesn't have that information, it contacts other name servers forthe needed information.</P></LI><LICLASS="listitem"><PCLASS="para">In the case of <EMCLASS="emphasis">fbi.dc.gov</EM> the local name servernext contacts one of the root servers (the dot in the big box in our example).A root server will likely not have the information requestedbut will indicate the best place to inquire.For our example, the root serverrecommends the name server for the <EMCLASS="emphasis">.gov</EM> domain and providesour local name server with the address of that <EMCLASS="emphasis">.gov</EM> domainserver machine.</P></LI><LICLASS="listitem"><PCLASS="para">The local name server then contacts the <EMCLASS="emphasis">.gov</EM> name server.This process continues until a name server provides theneeded information.As it happens, any name server can return the finalanswer if it happens to have it in its cache.For our example, <EMCLASS="emphasis">.gov</EM> knows the address for <EMCLASS="emphasis">fbi.dc.gov</EM>.It returns that address to the local name server, which in turnreturns the address to the local <EMCLASS="emphasis">sendmail</EM>.</P></LI></OL><PCLASS="para">Note that this is a simplified description. The actual practice can be more orless complex depending on who is &quot;authoritative&quot; about which machinesand domains and what is cached where.</P><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> program needs the IP addressof the machine to which it must connect. That address can bereturned by name servers in three possible forms:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">An MX (Mail eXchanger) record lists one or more machinesthat have agreed to receive mail for a particular site or machine.Multiple MX records aretried in order of cost[4](least to most). An MX record need not pointto the original receiving host.MX records always take precedence over A records.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] Technically, this field is called the preference. We use costto clarify that lower values are preferable, whereas preference wronglyconnotes that higher values are preferable.</P></BLOCKQUOTE></LI><LICLASS="listitem"><PCLASS="para">An A (Address) record gives the IP address directly.</P></LI><LICLASS="listitem"><PCLASS="para">A CNAME (Canonical NAME, or alias) record refers <EMCLASS="emphasis">sendmail</EM> to the realname, which may have an A record or MX records.</P></LI></UL><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-21-SECT-1-1">21.1.1 Which DNS? 4.8.3 or 4.9?</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-17174"></A>Before we discuss DNS in greater detail,we must first attend to an administrative detail.Every site on the Internet should run BIND software version 4.8.3 at theminimum.BIND provides the software and libraries that are needed to performDNS inquiries.Version 4.8.3 was the last stable version beforePaul Vixie (while at <EMCLASS="emphasis">dec.com</EM>) started rewriting the code. The currentrelease is 4.9.[5]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[5] As of the final draft of this manuscript, release 4.9.3 was themost recent.</P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-17181"></A><ACLASS="indexterm"NAME="AUTOID-17184"></A><ACLASS="indexterm"NAME="AUTOID-17187"></A>Unless you are already running the latest version, you should considerupgrading to V4.9.BIND 4.9 is available via anonymous FTP from</P><PCLASS="para"><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><ACLASS="systemitem.url"HREF="ftp://ftp.vix.com/pub/bind/release">ftp://ftp.vix.com/pub/bind/release</A></P></BLOCKQUOTE></P><PCLASS="para">We won't describe in this book how to install BIND. Instead, youshould refer to the book <EMCLASS="emphasis">DNS and BIND</EM> byPaul Albitz and Cricket Liu (O'Reilly &amp; Associates, 2nd edition, 1997).&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-21-SECT-1-2">21.1.2 Make sendmail DNS Aware</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-17198"></A>Not all releases of <EMCLASS="emphasis">sendmail</EM> are ready to use DNS. To determine whetheryours is ready, type the following command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>/usr/lib/sendmail -d0.1 -bt &lt; /dev/null</B></CODE>Version 8.8.4 Compiled with: LOG MIME8TO7 <CODECLASS="userinput"><B>NAMED_BIND</B></CODE> NETINET NETUNIX NEWDB SCANF                USERDB XDEBUG============ SYSTEM IDENTITY (after readcf) ============      (short domain name) $w = here  (canonical domain name) $j = here.uofa.edu         (subdomain name) $m = uofa.edu              (node name) $k = here========================================================</PRE></BLOCKQUOTE></P><PCLASS="para">Look for a statement that indicates whether or not your<EMCLASS="emphasis">sendmail</EM> was compiled with NAMED_BIND support(see <ACLASS="xref"HREF="ch18_08.htm#SML2-CH-18-SECT-8-23"TITLE="">Section 18.8.23, NAMED-BIND</A>). If so, it can use DNS.If not, either you will have to get a corrected versionfrom your vendor[6]or you will have to download and compile the latest version of<EMCLASS="emphasis">sendmail</EM> from scratch (see <ACLASS="xref"HREF="ch18_03.htm"TITLE="Obtain the Source">Section 18.3, "Obtain the Source"</A>).</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[6] Sun typically supplies two versions. The one named <EMCLASS="emphasis">sendmail.mx</EM> isable to use DNS.</P></BLOCKQUOTE><PCLASS="para">But even if your <EMCLASS="emphasis">sendmail</EM> binary supports DNS, site configurationmay not.If your host supports a service-switch file, for instance, make sure it lists <CODECLASS="literal">dns</CODE> as the method used to fetchinformation about hosts.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-17218"></A>Another possible problem might be your configurationfile. It may, for example, have been derived from the <CODECLASS="literal">nodns</CODE> FEATURE[7](see <ACLASS="xref"HREF="ch19_06.htm#SML2-CH-19-SECT-6-18"TITLE="">Section 19.6.18, FEATURE(nodns)</A>):</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[7] Note that the <CODECLASS="literal">nodns</CODE> FEATURE did nothing in V8.7 <EMCLASS="emphasis">sendmail</EM>.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>grep dns /etc/sendmail.cf</B></CODE>#####  @(#)nodns.m4 8.1 (Berkeley) 8/6/93  #####</PRE></BLOCKQUOTE></P><PCLASS="para">If it was, as indicated by the phrase <CODECLASS="literal">nodns.m4</CODE>, you canget <EMCLASS="emphasis">sendmail</EM> back into the DNS business by setting the<CODECLASS="literal">ResolverOptions</CODE> (<CODECLASS="literal">I</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-55"TITLE="">Section 34.8.55, ResolverOptions (I)</A>).</P><PCLASS="para">If your <EMCLASS="emphasis">sendmail</EM> still seems unable to useDNS, despite your efforts, look for other reasons for failure.Make sure, for example,that your <EMCLASS="emphasis">/etc/resolv.conf</EM> file is present and that it containsthe address (not the name) of a valid name server machine for your domain.If you are running NIS or NIS+, make sure it is configuredto look up hosts with DNS. &#13;</P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="PART"HREF="part03.htm"TITLE="III. Administration"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: III. Administration"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch21_02.htm"TITLE="21.2 How sendmail Uses DNS"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 21.2 How sendmail Uses DNS"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">III. Administration</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">21.2 How sendmail Uses DNS</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>