<HTML><HEAD><TITLE>[Chapter 22] 22.6 The Aliases File</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:29:58Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch22_01.htm"TITLE="22. Security"><LINKREL="prev"HREF="ch22_05.htm"TITLE="22.5 Permissions"><LINKREL="next"HREF="ch22_07.htm"TITLE="22.7 Forged Mail"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch22_05.htm"TITLE="22.5 Permissions"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 22.5 Permissions"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 22<BR>Security</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch22_07.htm"TITLE="22.7 Forged Mail"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 22.7 Forged Mail"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-22-SECT-6">22.6 The Aliases File</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-19168"></A>The <EMCLASS="emphasis">aliases</EM> filecan easily be used to gain privileged status if it is wronglyor carelessly administered.In addition to proper permissions and ownership you should be awareof potentially harmful entries that you may have inherited from the vendoror previous administrators. For example, many vendors used to ship systems with a <CODECLASS="literal">decode</CODE> aliasin the <EMCLASS="emphasis">aliases</EM> file.This practice is becoming less common.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># you may wish to comment this out for securitydecode:    |/usr/bin/guudecode</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-19176"></A>The intention is to provide an easy way for users to transfer binaryfiles using mail. At the sending site the user converts the binary to ASCIIwith <EMCLASS="emphasis">uuencode</EM>(1), then mails the result to the<CODECLASS="literal">decode</CODE> alias at the receiving site. That alias pipes themail message through the <EMCLASS="emphasis">/usr/bin/uudecode</EM> program, which convertsthe ASCII back into the original binary file.</P><PCLASS="para">The <EMCLASS="emphasis">uudecode</EM>(1)program takes the name of the file to create from the file itis decoding. That information is in the <CODECLASS="literal">begin</CODE> line, usedby <EMCLASS="emphasis">uudecode</EM>.For example, here's an attempt to use <EMCLASS="emphasis">uudecode</EM>(1) to place abogus queue file directly into the <EMCLASS="emphasis">sendmail</EM> queue:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">begin 777 /var/spool/mqueue/qfAA12345</PRE></BLOCKQUOTE></P><PCLASS="para">Here, the <CODECLASS="literal">begin</CODE> tells <EMCLASS="emphasis">uudecode</EM> to begin conversion.The <CODECLASS="literal">777</CODE> is the permissions to give to the file that willbe created. That is followed by thefull pathname of the file.If the queue directory were wrongly owned by <EMCLASS="emphasis">daemon</EM>,any outsider could create a bogus queued message at your site.</P><PCLASS="para">&#13;Some versions of <EMCLASS="emphasis">uudecode</EM> (such as the one with SunOS) will create<EMCLASS="emphasis">suid</EM> files. That is, a <CODECLASS="literal">begin</CODE> line like the following canbe used to create an <EMCLASS="emphasis">suid</EM> <EMCLASS="emphasis">daemon</EM> shell in <EMCLASS="emphasis">/tmp</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">begin 4777 /tmp/sh</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-19204"></A>The <CODECLASS="literal">decode</CODE> alias should be removed from all <EMCLASS="emphasis">aliases</EM>files. Similarly, every alias that executes a program&nbsp;- that youdid not place there yourself and check completely&nbsp;- should be questionedand probably removed.</P><PCLASS="para"></P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-22-SECT-6-1">22.6.1 The Alias Database Files</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-19212"></A>The <EMCLASS="emphasis">aliases</EM>(5) file is often stored in <EMCLASS="emphasis">dbm</EM>(3) or <EMCLASS="emphasis">db</EM>(3) databaseformat for faster lookups. The database files live in the same directoryas the <EMCLASS="emphasis">aliases</EM> file. For all versions of <EMCLASS="emphasis">sendmail</EM> theyare called <EMCLASS="emphasis">aliases.dir</EM> and <EMCLASS="emphasis">aliases.pag</EM> (but for V8<EMCLASS="emphasis">sendmail</EM>, only a single database file might exist and becalled <EMCLASS="emphasis">aliases.db</EM>).</P><PCLASS="para">It is useless to protect the <EMCLASS="emphasis">aliases</EM>(5) file if you do notprotect its corresponding database files. If the database filesare not protected,the attacker can create a private <EMCLASS="emphasis">aliases</EM> file and then run</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>/usr/lib/sendmail -oA./aliases -bi</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">This causes <EMCLASS="emphasis">sendmail</EM> to build <EMCLASS="emphasis">./aliases</EM> database filesin the current directory. The attacker then copies those bogusdatabase files over the unprotected system originals. The <EMCLASS="emphasis">sendmail</EM>program never detects the change, because the database filesappear to be newer than the <EMCLASS="emphasis">aliases</EM> file.</P><PCLASS="para">Note also that the <EMCLASS="emphasis">aliases</EM> file and its database files must be ownedby <EMCLASS="emphasis">root</EM>, and writable only by <EMCLASS="emphasis">root</EM>. They mustlive in a directory, every path component of which is ownedby and writable only by <EMCLASS="emphasis">root</EM>.</P><PCLASS="para"></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch22_05.htm"TITLE="22.5 Permissions"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 22.5 Permissions"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch22_07.htm"TITLE="22.7 Forged Mail"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 22.7 Forged Mail"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">22.5 Permissions</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">22.7 Forged Mail</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>