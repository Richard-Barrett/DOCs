<HTML><HEAD><TITLE>[Chapter 23] 23.9 The qf File Internals</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:35:12Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch23_01.htm"TITLE="23. The Queue"><LINKREL="prev"HREF="ch23_08.htm"TITLE="23.8 Pitfalls"><LINKREL="next"HREF="ch24_01.htm"TITLE="24. Aliases"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch23_08.htm"TITLE="23.8 Pitfalls"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 23.8 Pitfalls"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 23<BR>The Queue</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch24_01.htm"TITLE="24. Aliases"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24. Aliases"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-23-SECT-9">23.9 The qf File Internals</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-23-IX-QF-FILES"></A>The <CODECLASS="literal">qf</CODE> file holds all the information that is needed to perform delivery of a queued mailmessage. The information contained in that file, and its appearance,changes from release to release of <EMCLASS="emphasis">sendmail</EM>.Here, we document the <CODECLASS="literal">qf</CODE> file that is used with V8.8 <EMCLASS="emphasis">sendmail</EM>.Note that as of V8.7 a <CODECLASS="literal">V</CODE> version line has been introducedto enable future versions to correctly process older version's queue files.</P><PCLASS="para">This section must be taken with a proverbial grain of salt. The internalsof the <CODECLASS="literal">qf</CODE> file are essentially an internal interfaceto <EMCLASS="emphasis">sendmail</EM> and, as such, are subject to change withoutnotice. The information offered here is intended only to helpdebug <EMCLASS="emphasis">sendmail</EM> problems. It is <EMCLASS="emphasis">not</EM> intended (andwe strongly discourage its use) as a guide for writing files directly to the queue.</P><PCLASS="para">The <CODECLASS="literal">qf</CODE> file is line-oriented, containing one item of information perline. Each line begins with a single uppercase character (the <EMCLASS="emphasis">code letter</EM>), whichspecifies the contents of the line. Each code letter is followed,with no intervening space, by the information appropriate tothe letter. The complete list of code letters is shown in<ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-TAB-1"TITLE="qf File Code Letters">Table 23.2</A>.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="SML2-CH-23-TAB-1">Table 23.2: qf File Code Letters</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Code</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Meaning</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Version</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">How Many</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">B</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-1"TITLE="">Section 23.9.1</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Body type</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">V8.6 and above</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">At most one</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">C</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-2"TITLE="">Section 23.9.2</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Controlling user</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">V5.62 and above</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">At most one per R line</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">D</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-3"TITLE="">Section 23.9.3, D line</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Data filename</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Obsolete as of V8.7</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Exactly one</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">E</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-4"TITLE="">Section 23.9.4, E line</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Errors to</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">V8.6 and earlier</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Many</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">F</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-5"TITLE="">Section 23.9.5, F line</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Flag bits</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">V8.1 and above</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Many</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">H</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-6"TITLE="">Section 23.9.6, H line</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Header definition</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">All versions</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Many</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">I</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-8"TITLE="">Section 23.9.8, K line</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><EMCLASS="emphasis">df</EM> file's inode number</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">V8.7 and above</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Exactly one</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">K</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-8"TITLE="">Section 23.9.8</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Time last processed</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">V8.7 and above</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Exactly one</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">M</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-9"TITLE="">Section 23.9.9</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Message (why queued)</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">All versions</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">At most one</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">N</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-10"TITLE="">Section 23.9.10, N line</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Number times tried</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">V8.7 and above</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">At most one</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">P</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-11"TITLE="">Section 23.9.11</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Priority (current)</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">All versions</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">At most one</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">Q</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-12"TITLE="">Section 23.9.12, Q line</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Original recipient</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">V8.7 and above</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">At most one per R line</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">R</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-13"TITLE="">Section 23.9.13</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Recipient address</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">All versions</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Many</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">S</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-14"TITLE="">Section 23.9.14</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Sender address</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">All versions</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Exactly one</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">T</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-15"TITLE="">Section 23.9.15</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Time created</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">All versions</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Exactly one</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">V</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-16"TITLE="">Section 23.9.16, V line</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Version</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">V8.7 and above</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Exactly one</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">Z</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-17"TITLE="">Section 23.9.17, Z line</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">DSN envelope ID</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">V8.7 and above</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">At most one</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">$</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-18"TITLE="">Section 23.9.18, $ line</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Restore macro value</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">V8.6 and above</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">At most one each</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">.</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-19"TITLE="">Section 23.9.19, . line</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">End of <EMCLASS="emphasis">qf</EM> file</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">V8.7 and above</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">At most one</TD></TR></TBODY></TABLE><PCLASS="para">Some code letters may appear only once in a <CODECLASS="literal">qf</CODE> file;others may appear many times. Any line that beginswith a tab or space character is joined to the line above it.Empty lines are ignored. The order in which these lines appear in the <CODECLASS="literal">qf</CODE> file is important for the <EMCLASS="emphasis">mailq</EM> command to work properly.</P><PCLASS="para">We discuss the individual lines in the <CODECLASS="literal">qf</CODE>file by code letters. Each letter ispresented in alphabetical order rather than the order in which they should appearin the <CODECLASS="literal">qf</CODE> file.</P><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-1">23.9.1 B line</A></H3><PCLASS="refpurpose">Message body type</P>(V8.6 and above)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21257"></A><ACLASS="indexterm"NAME="AUTOID-21260"></A><ACLASS="indexterm"NAME="AUTOID-21263"></A>The message body type is described under the <CODECLASS="literal">-B</CODE> command-line switch(see <ACLASS="xref"HREF="ch36_07.htm#SML2-CH-36-SECT-7-1"TITLE="">Section 36.7.1</A>).The <CODECLASS="literal">B</CODE> line in the <CODECLASS="literal">qf</CODE> file stores whatever the body type wasset to, either from the command line or by the SMTP MAIL command.The two usual body types are <CODECLASS="literal">8BITMIME</CODE> or <CODECLASS="literal">7BIT</CODE>.</P><PCLASS="para">The form of the <CODECLASS="literal">B</CODE> line is</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">B<CODECLASS="replaceable"><I>type</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">There must be no space between the <CODECLASS="literal">B</CODE> and the <CODECLASS="replaceable"><I>type</I></CODE>.If the <CODECLASS="replaceable"><I>type</I></CODE> is missing, the body type becomes the charactervalue zero.If the entire <CODECLASS="literal">B</CODE> line is missing, the default is <CODECLASS="literal">7BIT</CODE>.If <CODECLASS="replaceable"><I>type</I></CODE> is longer than MAXNAME as defined in <EMCLASS="emphasis">conf.h</EM>(see <ACLASS="xref"HREF="ch18_08.htm#SML2-CH-18-SECT-8-19"TITLE="">Section 18.8.19, MAX...</A>) when compiling <EMCLASS="emphasis">sendmail</EM>, it is truncatedto MAXNAME-1 characters when the <CODECLASS="literal">qf</CODE> file is read.</P><PCLASS="para">Note that the <CODECLASS="replaceable"><I>type</I></CODE> must be either <CODECLASS="literal">7bit</CODE> or <CODECLASS="literal">8bitmime</CODE>.Anything else will not be detected when the <CODECLASS="literal">qf</CODE> file is read andmay eventually cause the ESMTP dialogue to fail:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">501 &lt;<ICLASS="lineannotation">sender</I>&gt;... Unknown BODY type <ICLASS="lineannotation">badtype</I></PRE></BLOCKQUOTE></P><PCLASS="para">This error will be reproduced at every MX site for the recipient untila site that does not speak ESMTP is found or until the MX list is exhausted.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-2">23.9.2 C line</A></H3><PCLASS="refpurpose">Set controlling user</P>(V5.62 and above)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21305"></A><ACLASS="indexterm"NAME="AUTOID-21307"></A>To ensure secure handling of delivery, recipient addresses thatare either a file or a program require that <EMCLASS="emphasis">sendmail</EM>perform delivery as the owner of the file or program ratherthan as <EMCLASS="emphasis">root</EM>. A file address is one that begins witha <CODECLASS="literal">/</CODE> character. A program address is one that begins with a <CODECLASS="literal">|</CODE> character. Both characters are detected after  quotation marks have been stripped from the address.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21315"></A><ACLASS="indexterm"NAME="AUTOID-21317"></A><ACLASS="indexterm"NAME="AUTOID-21319"></A>To prevent potential security violations, <EMCLASS="emphasis">sendmail</EM> must take specialprecautions when addresses in the <CODECLASS="literal">qf</CODE> file result from reading a<EMCLASS="emphasis">~/.forward</EM> or <CODECLASS="literal">:include:</CODE> file.When such an address is to be placed into the <CODECLASS="literal">qf</CODE> file(whether as a recipient's address in an <CODECLASS="literal">R</CODE> line or as anerror recipient's address in an <CODECLASS="literal">E</CODE> line), <EMCLASS="emphasis">sendmail</EM>first places a <CODECLASS="literal">C</CODE> line (for Controlling user) into the fileand then the recipient's address. The <CODECLASS="literal">C</CODE> line specifiesthe owner of the <EMCLASS="emphasis">~/.forward</EM> or <CODECLASS="literal">:include:</CODE> file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">CgeorgeRPF:/u/users/george/mail/archiveCbenRPF:|/u/users/ben/bin/mailfilter</PRE></BLOCKQUOTE></P><PCLASS="para">Here, when <EMCLASS="emphasis">sendmail</EM> later delivers to the recipientsin this <CODECLASS="literal">qf</CODE> file,it first converts its user identity to that of the user <EMCLASS="emphasis">george</EM>,then resets itself back to being <EMCLASS="emphasis">root</EM> again. The same process repeatswith the next recipient, except that <EMCLASS="emphasis">sendmail</EM> changesfrom <EMCLASS="emphasis">root</EM> to <EMCLASS="emphasis">ben</EM> and back again.If there is no <CODECLASS="literal">C</CODE> line preceding a <CODECLASS="literal">R</CODE> line, the previous<CODECLASS="literal">C</CODE> line's value is carried down:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">CgeorgeRPF:/u/users/george/mail/archiveRPF:|/u/users/ben/bin/mailfilter          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> controlling user is george</I></PRE></BLOCKQUOTE></P><PCLASS="para">The form of the <CODECLASS="literal">C</CODE> line in the <CODECLASS="literal">qf</CODE> file is</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">C<CODECLASS="replaceable"><I>user                  </I></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> Prior to V8</I>C<CODECLASS="replaceable"><I>user:eaddr            </I></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> V8.1 through V8.7.5</I>C<CODECLASS="replaceable"><I>user:uid:gid:eaddr    </I></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> V8.7.6 and V8.8</I></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">C</CODE> must begin the line and be immediately followedby <CODECLASS="replaceable"><I>user</I></CODE>, with no intervening space.If no <CODECLASS="replaceable"><I>user</I></CODE> follows the <CODECLASS="literal">C</CODE>, any prior controlling user is clearedand the identity that is used reverts to that specified by the <CODECLASS="literal">DefaultUser</CODE>(<CODECLASS="literal">u</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-15"TITLE="">Section 34.8.15, DefaultUser (g)(u)</A>).If present, the <CODECLASS="replaceable"><I>user</I></CODE>is the login name of the owner of the <EMCLASS="emphasis">~/.forward</EM> or <CODECLASS="literal">:include:</CODE> filethat yielded the addressin the next following <CODECLASS="literal">R</CODE> or <CODECLASS="literal">E</CODE> line. If <CODECLASS="literal">user</CODE>is the name of a user who is unknown to the system, prior to V8.7.6 and priorto V8.8 the effect was the same as if it were missing.Beginning with V8.8 and V8.7.6, an unknown <CODECLASS="replaceable"><I>user</I></CODE> causes theidentity to become that of the <CODECLASS="replaceable"><I>uid</I></CODE> and <CODECLASS="literal">gid</CODE>.Beginning with V8 <EMCLASS="emphasis">sendmail</EM>, an optional <CODECLASS="replaceable"><I>eaddr</I></CODE> maybe last. If present, the <CODECLASS="replaceable"><I>eaddr</I></CODE> gives the address to usefor error messages.</P><PCLASS="para">There may be only one <CODECLASS="literal">C</CODE> line immediately preceding each<CODECLASS="literal">R</CODE> and <CODECLASS="literal">E</CODE> line. Two <CODECLASS="literal">C</CODE> lines in a rowhave the effect of the second superseding the first.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-3">23.9.3 D line</A></H3><PCLASS="refpurpose">Data filename</P>(Obsolete as of V8.7)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21394"></A><ACLASS="indexterm"NAME="AUTOID-21396"></A>Beginning with V8.7 <EMCLASS="emphasis">sendmail</EM> looks for its data file (the filecontaining the message body) under thesame name as its <CODECLASS="literal">qf</CODE> file, but with the <CODECLASS="literal">q</CODE> changed intoa <CODECLASS="literal">d</CODE>.Prior to V8.7, the <CODECLASS="literal">D</CODE> line in the <CODECLASS="literal">qf</CODE> file containedthe name of the file that contained the message body.If the <CODECLASS="literal">D</CODE> line was missing, there was no messagebody.  The form of the <CODECLASS="literal">qf</CODE> file <CODECLASS="literal">D</CODE> line was</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">D<CODECLASS="replaceable"><I>file</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">D</CODE> must begin the line. The <CODECLASS="replaceable"><I>file</I></CODE> must immediatelyfollow with no intervening space. All text, from the first characterfollowing the <CODECLASS="literal">D</CODE> to the end of the line, is taken as thename of the file. There is no default for <CODECLASS="replaceable"><I>file</I></CODE>; either it mustbe present, or the entire <CODECLASS="literal">D</CODE> line must be absent.</P><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> program opens the<CODECLASS="literal">df</CODE> <CODECLASS="replaceable"><I>file</I></CODE> for reading. If that open fails, <EMCLASS="emphasis">sendmail</EM><EMCLASS="emphasis">syslog</EM>(3)'s the following error message at LOG_CRIT and continuesto process the <CODECLASS="literal">qf</CODE> file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">readqf: cannot open dfAA12345</PRE></BLOCKQUOTE></P><PCLASS="para">Be aware that <EMCLASS="emphasis">sendmail</EM> attempts to remove the<CODECLASS="replaceable"><I>file</I></CODE> after it has been delivered to all recipients.If <EMCLASS="emphasis">sendmail</EM> is unable to remove the <CODECLASS="replaceable"><I>file</I></CODE>, andif the <CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-33"TITLE="">Section 34.8.33, LogLevel (L)</A>) is greater than 97,<EMCLASS="emphasis">sendmail</EM> <EMCLASS="emphasis">syslog</EM>(3)'s the following warning at LOG_DEBUG:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><EMCLASS="emphasis">file</EM>: unlink-fail <ICLASS="lineannotation">#</I></PRE></BLOCKQUOTE></P><PCLASS="para">The <EMCLASS="emphasis">file</EM> is the name of the file that could not be removed.The <EMCLASS="emphasis">#</EM> is the error number, as defined in <EMCLASS="emphasis">/usr/include/errno.h</EM>.</P><PCLASS="para">The <CODECLASS="literal">df</CODE> file is opened onlywhen processing the queue file, not when printing it.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-4">23.9.4 E line</A></H3><PCLASS="refpurpose">Send errors to</P>(V8.6 and earlier)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21453"></A><ACLASS="indexterm"NAME="AUTOID-21455"></A>Notification of errors often requires special handling by <EMCLASS="emphasis">sendmail</EM>.When mail to a mailing list fails, for example, <EMCLASS="emphasis">sendmail</EM> looksfor the owner of that list. If it finds one, the owner, notthe sender, receivesnotification of the error. To differentiateerror notification addresses from ordinary sender and recipient addresses,pre-V8.7 <EMCLASS="emphasis">sendmail</EM> stored error addresses separately in the <CODECLASS="literal">qf</CODE> file,one per <CODECLASS="literal">E</CODE> line.Beginning with V8.7, this <CODECLASS="literal">E</CODE> line is no longer used. Instead, <EMCLASS="emphasis">sendmail</EM>uses the <CODECLASS="literal">S</CODE> line.</P><PCLASS="para">The form of the <CODECLASS="literal">E</CODE> line in the <CODECLASS="literal">qf</CODE> file looks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">E<CODECLASS="replaceable"><I>addr         </I></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> V8.6 and earlier</I></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">E</CODE> must begin the line. One or more addresses may beentered on that same line. Whitespace and commas may surroundthe individual addresses. Note, however, that <EMCLASS="emphasis">sendmail</EM>places only a single address on each <CODECLASS="literal">E</CODE> line.There may be multiple <CODECLASS="literal">E</CODE> lines. Each is processed in turn.</P><PCLASS="para">Each line is fully processed as it is read. That is, the line isscanned for multiple addresses. Each address that is found is alias-expanded.Each resulting new address is processed by rule sets 3 and 0to resolve a delivery agent for each.</P><PCLASS="para">If an alias expands to a program or a file (text that begins witha <CODECLASS="literal">/</CODE> or <CODECLASS="literal">|</CODE> character), that text is sent outin the delivered message's <CODECLASS="literal">Errors-To:</CODE> line in that form.This can cause confusion when the message is later processed andbounced at the receiving site.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-5">23.9.5 F line</A></H3><PCLASS="refpurpose">Saved flag bits</P>(V8.1 and above)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21491"></A><ACLASS="indexterm"NAME="AUTOID-21493"></A><ACLASS="indexterm"NAME="AUTOID-21495"></A>Under V8 <EMCLASS="emphasis">sendmail</EM> the <CODECLASS="literal">Timeout.queuewarn</CODE> option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-70"TITLE="">Section 34.8.70</A>)can specify an intervalto wait before notifying the sender that a message could not immediatelybe delivered. To keep track of whether such a notification has beensent, <EMCLASS="emphasis">sendmail</EM> stores the state of its EF_WARNING envelopeflag in the <CODECLASS="literal">qf</CODE> file.If that flag is set, notification has already been sent.</P><PCLASS="para">Error mail messages sent by <EMCLASS="emphasis">sendmail</EM> may occasionallybe queued, rather than immediately delivered. The <CODECLASS="literal">Timeout.queuewarn</CODE> optionnotification should not be sent for such mail. If such mail remainsin the queue too long, it should be canceled rather than bounced.V8 <EMCLASS="emphasis">sendmail</EM> saves the state of the EF_RESPONSE envelopeflag in the <CODECLASS="literal">qf</CODE> file.<ACLASS="indexterm"NAME="AUTOID-21507"></A>If that flag is set, the message is an error notification.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21510"></A><ACLASS="indexterm"NAME="AUTOID-21512"></A>Beginning with V8.8, <EMCLASS="emphasis">sendmail</EM> also records the state of theEF_HAS8BIT flag (the message body contains 8-bit data)and the EF_DELETE_BCC flag (delete empty <CODECLASS="literal">Bcc:</CODE> headers;see <ACLASS="xref"HREF="ch35_10.htm#SML2-CH-35-SECT-10-4"TITLE="">Section 35.10.4, Bcc:</A>).</P><PCLASS="para">All envelope flags are listed in <ACLASS="xref"HREF="ch37_05.htm#SML2-CH-37-TAB-2"TITLE="Hexadecimal Envelope Flags">Table 37.3</A> of <ACLASS="xref"HREF="ch37_05.htm#SML2-CH-37-SECT-5-12"TITLE="">Section 37.5.12, -d2.1</A>.The <CODECLASS="literal">F</CODE> line is used to save envelope flags for laterrestoration. Its form looks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">F<CODECLASS="replaceable"><I>flags</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Here, the <CODECLASS="replaceable"><I>flags</I></CODE> are any combination of <CODECLASS="literal">w</CODE>, whichrestores (sets) the EF_WARNING flag; <CODECLASS="literal">r</CODE>, which restoresthe EF_RESPONSE flag; <CODECLASS="literal">8</CODE>, which restores the EF_HAS8BIT flag;and <CODECLASS="literal">b</CODE>, which restores the EF_DELETE_BCC flag.Only those letters are recognized. Other letters are silentlyignored.Note that these flags may be done away with in later versionsof <EMCLASS="emphasis">sendmail</EM> and new flags may be added without notice.</P><PCLASS="para">For security protection, V8 <EMCLASS="emphasis">sendmail</EM> rejects and logs thefollowing flag sequence:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">From    <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>    <ICLASS="lineannotation">a space here</I></PRE></BLOCKQUOTE></P><PCLASS="para">See <ACLASS="xref"HREF="ch23_03.htm#SML2-CH-23-SECT-3-5"TITLE="Funny Flag Bits in qf File">Section 23.3.5, "Funny Flag Bits in qf File"</A> for more information about this.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-6">23.9.6 H line</A></H3><PCLASS="refpurpose">Header line</P>(All versions of sendmail)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21547"></A><ACLASS="indexterm"NAME="AUTOID-21549"></A>The lines of text that form the message header are saved tothe <CODECLASS="literal">qf</CODE> file, one per <CODECLASS="literal">H</CODE> line. Any header lines added by<EMCLASS="emphasis">sendmail</EM> are also saved to <CODECLASS="literal">H</CODE> linesin the <CODECLASS="literal">qf</CODE> file.</P><PCLASS="para">The form of the <CODECLASS="literal">H</CODE> line is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">H<CODECLASS="replaceable"><I>definition</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">H</CODE> must begin the line, and the <CODECLASS="replaceable"><I>definition</I></CODE> mustimmediately follow with no intervening space. The <CODECLASS="replaceable"><I>definition</I></CODE>is exactly the same as, and obeys the same rules as, the<CODECLASS="literal">H</CODE> commands in the configuration file (see <ACLASS="xref"HREF="ch35_01.htm#SML2-CH-35-SECT-1"TITLE="The H Configuration Command">Section 35.1, "The H Configuration Command"</A>).</P><PCLASS="para">When <EMCLASS="emphasis">sendmail</EM> writes header lines to the <CODECLASS="literal">qf</CODE> file,it pre-expands macros (replaces expressions such as <CODECLASS="literal">$x</CODE>with their values) and preresolves conditionals (<CODECLASS="literal">$?</CODE>, <CODECLASS="literal">$!</CODE>, and <CODECLASS="literal">$.</CODE>).</P><PCLASS="para">The order in which <CODECLASS="literal">H</CODE> lines appear in the <CODECLASS="literal">qf</CODE> file isexactly the same as the order in which they appear in the delivered message.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-7">23.9.7 I line</A></H3><PCLASS="refpurpose">Inode and device information for the df file</P>(V8.7 and above)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21586"></A><ACLASS="indexterm"NAME="AUTOID-21588"></A><ACLASS="indexterm"NAME="AUTOID-21590"></A><ACLASS="indexterm"NAME="AUTOID-21592"></A><ACLASS="indexterm"NAME="AUTOID-21595"></A>When a machine crashes under UNIX, files in a directory may become detachedfrom that directory. When this happens, those orphaned files are saved in a directorycalled <EMCLASS="emphasis">lost+found</EM>. Because file names are saved only in directories, orphanedfiles are nameless.  Consequently, UNIX stores them in <EMCLASS="emphasis">lost+found</EM>using their <EMCLASS="emphasis">inode</EM> numbers as their names.</P><PCLASS="para">To illustrate, consider finding these four files in <EMCLASS="emphasis">lost+found</EM> after acrash:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#1528 #1200 #3124 #3125</PRE></BLOCKQUOTE></P><PCLASS="para">Two of these are <CODECLASS="literal">qf</CODE> files, and two are <CODECLASS="literal">df</CODE> files. Beginning withV8.7 <EMCLASS="emphasis">sendmail</EM> the <CODECLASS="literal">qf</CODE> files contain a record of the inodenumbers for their corresponding <CODECLASS="literal">df</CODE> files. That information is storedin the <CODECLASS="literal">I</CODE> line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">I<CODECLASS="replaceable"><I>major/minor/ino</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">&#13;Here, the <CODECLASS="replaceable"><I>major</I></CODE> and <CODECLASS="replaceable"><I>minor</I></CODE> are the major and minor device numbersfor the disk device that the <CODECLASS="literal">df</CODE> file was stored on. The <CODECLASS="replaceable"><I>ino</I></CODE> isthe inode number for the <CODECLASS="literal">df</CODE> file. In our above <EMCLASS="emphasis">lost+found</EM> examplethe following command could be run to pair up the orphaned files:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>grep &quot;^I.*/.*/&quot; *</B></CODE>#1200:I123/45/3124#1325:I123/45/1528</PRE></BLOCKQUOTE></P><PCLASS="para">This shows that the <CODECLASS="literal">qf</CODE> file <EMCLASS="emphasis">#1200</EM> has the <CODECLASS="literal">df</CODE> file <EMCLASS="emphasis">#3124</EM>and that the <CODECLASS="literal">qf</CODE> file <EMCLASS="emphasis">#1325</EM> has the <CODECLASS="literal">df</CODE> file <EMCLASS="emphasis">#1528</EM>.</P><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> program does not check the inode number in the <CODECLASS="literal">I</CODE> lineagainst the actual inode number of the <CODECLASS="literal">df</CODE> file. Instead, the <CODECLASS="literal">I</CODE>line is generated afresh each time the <CODECLASS="literal">qf</CODE> file is processed.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-8">23.9.8 K line</A></H3><PCLASS="refpurpose">The time last processed from the queue</P>(V8.7 and above)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21648"></A><ACLASS="indexterm"NAME="AUTOID-21650"></A><ACLASS="indexterm"NAME="AUTOID-21652"></A><ACLASS="indexterm"NAME="AUTOID-21656"></A>The <CODECLASS="literal">MinQueueAge</CODE> option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-41"TITLE="">Section 34.8.41</A>) sets the length of timea queued message must remain queued before delivery can again be tried.Each time <EMCLASS="emphasis">sendmail</EM> processes a <CODECLASS="literal">qf</CODE> file, it subtracts the time stored in the <CODECLASS="literal">K</CODE> line from the current time and compares theresult to the <CODECLASS="literal">MinQueueAge</CODE>. If sufficient time has not passed,the rest of processing is skipped. (Note that this test is performed onlyif the <CODECLASS="literal">qf</CODE> file has been processed at least once; see the <CODECLASS="literal">N</CODE> linein <ACLASS="xref"HREF="ch23_09.htm#SML2-CH-23-SECT-9-10"TITLE="">Section 23.9.10</A>).</P><PCLASS="para">The time stored in the<CODECLASS="literal">K</CODE> line looks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">K703531020</PRE></BLOCKQUOTE></P><PCLASS="para">This number represents the date and time in seconds.Every time the <CODECLASS="literal">qf</CODE> file is processed (delivery is attempted),the <CODECLASS="literal">K</CODE> line is updated with the current time.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-9">23.9.9 M line</A></H3><PCLASS="refpurpose">The reason message was queued</P>(All versions of sendmail)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21683"></A><ACLASS="indexterm"NAME="AUTOID-21686"></A><ACLASS="indexterm"NAME="AUTOID-21688"></A>When a mail message is placed into the queue because of an errorduring the delivery attempt, the nature of that error is storedin the <CODECLASS="literal">M</CODE> line of the <CODECLASS="literal">qf</CODE> file. The error is usually prefixed with <CODECLASS="literal">Deferred</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Deferred: <EMCLASS="emphasis">reason</EM></PRE></BLOCKQUOTE></P><PCLASS="para">Delivery can be deferred until a later queue run becauseof a temporary lack of services. For example, the <EMCLASS="emphasis">reason</EM>may be &quot;remote host is down.&quot;</P><PCLASS="para">&#13;The form of the <CODECLASS="literal">qf</CODE> file <CODECLASS="literal">M</CODE> line is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">M<CODECLASS="replaceable"><I>msg</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">M</CODE> must begin the line. It is immediately followedby the <CODECLASS="replaceable"><I>msg</I></CODE> with no intervening space. The text of<CODECLASS="replaceable"><I>msg</I></CODE> is everything up to the end of the line.The <CODECLASS="replaceable"><I>msg</I></CODE> created by <EMCLASS="emphasis">sendmail</EM> may include theword <CODECLASS="literal">Deferred:</CODE>, followed by a reason.The <CODECLASS="literal">M</CODE> line should appear before the <CODECLASS="literal">S</CODE> line.</P><PCLASS="para">If the <CODECLASS="replaceable"><I>msg</I></CODE> is missing, <EMCLASS="emphasis">sendmail</EM> simplyprints a blank line rather than a reason when showing thequeue with <EMCLASS="emphasis">mailq</EM> or the <CODECLASS="literal">-bp</CODE> command-line switch.If the <CODECLASS="literal">M</CODE> line is entirely missing, <EMCLASS="emphasis">sendmail</EM>prints nothing.</P><PCLASS="para">The maximum number of characters in <CODECLASS="replaceable"><I>msg</I></CODE> is defined byMAXLINE in <EMCLASS="emphasis">conf.h</EM> (see <ACLASS="xref"HREF="ch18_08.htm#SML2-CH-18-SECT-8-19"TITLE="">Section 18.8.19</A>). There should be only one <CODECLASS="literal">M</CODE> line in a <CODECLASS="literal">qf</CODE> file.If there are multiple <CODECLASS="literal">M</CODE> lines, only the last is used.If multiple recipients produced error messages, only the lastone is stored in an <CODECLASS="literal">M</CODE> line.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-10">23.9.10 N line</A></H3><PCLASS="refpurpose">Number of times tried</P>(V8.7 and above)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21737"></A><ACLASS="indexterm"NAME="AUTOID-21739"></A><ACLASS="indexterm"NAME="AUTOID-21742"></A><ACLASS="indexterm"NAME="AUTOID-21745"></A>Each time delivery is attempted for a message, the number storedin its <CODECLASS="literal">qf</CODE> file's <CODECLASS="literal">N</CODE> line is incremented by one.This number always begins at zero.</P><PCLASS="para">When delivering many messages to a single host, <EMCLASS="emphasis">sendmail</EM>remembers failures.  If one message fails to make it all the way through an SMTP dialogue, all the following messagesto that same host will be deferred (not attempted duringthe current queue run). For thosedeferred messages the number of tries is correctlyincremented as though the delivery was actually attempted.</P><PCLASS="para">The value in this <CODECLASS="literal">N</CODE> line is usedto determine whether the delay of the <CODECLASS="literal">MinQueueAge</CODE> option(see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-41"TITLE="">Section 34.8.41</A>) should be triggered.This value, when zero, can also be usedto enable a special first-time connection timeout (see<ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-70-9"TITLE="Timeout.iconnect">Section 34.8.70.9, "Timeout.iconnect"</A>). </P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-11">23.9.11 P line</A></H3><PCLASS="refpurpose">Priority when processed from queue</P>(All versions of sendmail)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21765"></A><ACLASS="indexterm"NAME="AUTOID-21767"></A>Not all messages need to be treated equally.Messages that have failed often, for example, tend tocontinue to fail. When sendmail processes the messages in its queue,it sorts them by priority that was and attempts to deliver those most likelyto succeed first.</P><PCLASS="para">&#13;When a mail message is first placed into the queue, it is given aninitial priority calculated when it was first created (see<ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-53"TITLE="">Section 34.8.53</A>), which is stored in the <CODECLASS="literal">P</CODE> line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">P640561</PRE></BLOCKQUOTE></P><PCLASS="para">This number in the <CODECLASS="literal">qf</CODE> file is really a cost.The <EMCLASS="emphasis">lower</EM> it is, the more preferentially the messageis treated by <EMCLASS="emphasis">sendmail</EM>.Each time the <CODECLASS="literal">qf</CODE> file is read,the number in the <CODECLASS="literal">P</CODE> lineis incremented. The size of that increment is set by the valueof the <CODECLASS="literal">RetryFactor</CODE> (<CODECLASS="literal">Z</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-56"TITLE="">Section 34.8.56, RetryFactor (Z)</A>). If that optionis negative, the logic of &quot;what fails will continue to fail&quot; isinverted.</P><PCLASS="para">The form of the <CODECLASS="literal">qf</CODE> file <CODECLASS="literal">P</CODE> line is</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">P<CODECLASS="replaceable"><I>pri</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">P</CODE> must begin the line. The <CODECLASS="replaceable"><I>pri</I></CODE> is a textrepresentation of an integer value. The <CODECLASS="replaceable"><I>pri</I></CODE> must immediatelyfollow the <CODECLASS="literal">P</CODE> with no intervening space. The text in<CODECLASS="replaceable"><I>pri</I></CODE> is converted to an integer using the C libraryroutine <EMCLASS="emphasis">atol</EM>(3). That routine allows <CODECLASS="replaceable"><I>pri</I></CODE> tobe represented in text as a signed decimal number, an octal number,or a hexadecimal number.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21799"></A>If <CODECLASS="replaceable"><I>pri</I></CODE> is absent, the priority value used is that of theconfiguration file <CODECLASS="literal">RetryFactor</CODE> (<CODECLASS="literal">Z</CODE>) option. If the entire <CODECLASS="literal">P</CODE> lineis absent, the priority value begins as zero.</P><PCLASS="para">There should be only one <CODECLASS="literal">P</CODE> line in any <CODECLASS="literal">qf</CODE> file.Multiple <CODECLASS="literal">P</CODE> lines cause all but the last to be ignored.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-12">23.9.12 Q line</A></H3><PCLASS="refpurpose">The DSN ORCPT address</P>(V8.7 and above)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21817"></A><ACLASS="indexterm"NAME="AUTOID-21819"></A><ACLASS="indexterm"NAME="AUTOID-21822"></A><ACLASS="indexterm"NAME="AUTOID-21824"></A><ACLASS="indexterm"NAME="AUTOID-21826"></A><ACLASS="indexterm"NAME="AUTOID-21828"></A>When a mail message arrives that includes an ORCPT parameter forthe ESMTP RCPT command (see RFC1891),<EMCLASS="emphasis">sendmail</EM> needs to save that parameter's information separately from the RCPTrecipient address:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">RCPT TO:&lt;gw@wash.dc.gov&gt; ORCPT=rfc822;gw@wash.dc.gov         <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                    <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>         <ICLASS="lineannotation">recipient address</I>   <ICLASS="lineannotation">parameter's information</I></PRE></BLOCKQUOTE></P><PCLASS="para">Not all sites understand ESMTP. If<EMCLASS="emphasis">sendmail</EM> forwards the message to such a site, it needsto omit the ORCPT parameter. Consequently, <EMCLASS="emphasis">sendmail</EM> must notstore that parameter with the RCPT address.</P><PCLASS="para">The <CODECLASS="literal">Q</CODE> line is used to separately store the ORCPT parameterinformation:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Q<CODECLASS="replaceable"><I>type</I></CODE>;<CODECLASS="replaceable"><I>addr</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="replaceable"><I>type</I></CODE><CODECLASS="literal">;</CODE><CODECLASS="replaceable"><I>addr</I></CODE> is defined by RFC1891. The<EMCLASS="emphasis">sendmail</EM> program checks the validity of <CODECLASS="replaceable"><I>addr</I></CODE> when thatinformation is received but otherwise merely stores <CODECLASS="replaceable"><I>type</I></CODE><CODECLASS="literal">;</CODE><CODECLASS="replaceable"><I>addr</I></CODE>as is in the <CODECLASS="literal">Q</CODE> line.</P><PCLASS="para">There must be only a single <CODECLASS="literal">Q</CODE> line for each recipient <CODECLASS="literal">R</CODE> line, andeach such <CODECLASS="literal">Q</CODE> line  must precede its corresponding <CODECLASS="literal">R</CODE> line.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-13">23.9.13 R line</A></H3><PCLASS="refpurpose">Recipient's address</P>(All versions of sendmail)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21870"></A><ACLASS="indexterm"NAME="AUTOID-21872"></A><ACLASS="indexterm"NAME="AUTOID-21875"></A>The <CODECLASS="literal">qf</CODE> file lists all the recipients for a mail message.There may be one recipient or many. When <EMCLASS="emphasis">sendmail</EM> createsthe <CODECLASS="literal">qf</CODE> file, it lists each recipient address on an individual<CODECLASS="literal">R</CODE> line.The form of the <CODECLASS="literal">R</CODE> line in the <CODECLASS="literal">qf</CODE> file looks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R<CODECLASS="replaceable"><I>flags:addr</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">R</CODE> must begin the line. Only a single address may appear on each <CODECLASS="literal">R</CODE> line.There may be multiple <CODECLASS="literal">R</CODE> lines. Each is processed in turn.</P><PCLASS="para">If the colon is present and if the version of the <CODECLASS="literal">qf</CODE> fileis greater than 0, the characters between the <CODECLASS="literal">R</CODE> and thecolon are interpreted as flags that further define the natureof the address:<CODECLASS="literal">P</CODE> (primary) Addresses can undergo many transformations prior todelivery. When expanding aliases, for example, the address <EMCLASS="emphasis">george</EM>might be transformed into two addresses via a <EMCLASS="emphasis">~/.forward</EM> file:<EMCLASS="emphasis">george@here</EM> and <EMCLASS="emphasis">george@there</EM>. In this instance, <EMCLASS="emphasis">george</EM>is the primary address, and the aliases are secondary addresses.If aliasing yields only a single transformation, the single newaddress is considered primary.Addresses that are received via a RCPT SMTP command are always consideredprimary, as are all other recipient addressees prior to aliasing.<CODECLASS="literal">N</CODE> (notify) Recipient addresses can lead to various kinds of notification<ACLASS="indexterm"NAME="AUTOID-21901"></A>based on the nature of the DSN NOTIFY extension to theRCPT SMTP command. That notification can be eitherNEVER or some combination of SUCCESS, FAILURE, orDELAY. Internally, <EMCLASS="emphasis">sendmail</EM> uses the absence of thelatter three to imply NEVER. This <CODECLASS="literal">N</CODE> flag simply saysthat the DSN NOTIFY extension appeared in the message.If the  <CODECLASS="literal">N</CODE> is absent, but an <CODECLASS="literal">S</CODE>, <CODECLASS="literal">F</CODE>, or <CODECLASS="literal">D</CODE>is present, DSN information will not be propagated.Note that NOTIFY can also be specified by usingthe <CODECLASS="literal">-N</CODE> command line switch (see <ACLASS="xref"HREF="ch36_07.htm#SML2-CH-36-SECT-7-28"TITLE="">Section 36.7.28, -N</A>).</P><DLCLASS="variablelist"><DTCLASS="term"><CODECLASS="literal">S</CODE>, <CODECLASS="literal">F</CODE>, <CODECLASS="literal">D</CODE></DT><DDCLASS="listitem"><PCLASS="para">(success, failure, delay)The DSN NOTIFY extension to theRCPT SMTP command will specify either NEVERor some combination of SUCCESS, FAILURE, orDELAY. When any of these is specified, its first letter isused as a flag for the recipient address. SUCCESS meansto notify the sender that final delivery succeeded.FAILURE is used to notify the sender that some steptoward delivery failed fatally. DELAY lets the senderknow that the message has been delayed but delivery willcontinue to be attempted.</P></DD></DL><PCLASS="para">Each <CODECLASS="literal">R</CODE> line is fully processed as it is read. That is, the line isscanned for multiple addresses. Each address that is found is alias-expanded.Each resulting new address is processed by rule sets 3 and 0to resolve a delivery agent for each.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-14">23.9.14 S line</A></H3><PCLASS="refpurpose">Sender's address</P>(All versions of sendmail)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21929"></A><ACLASS="indexterm"NAME="AUTOID-21931"></A>Each mail message must have a sender. The <EMCLASS="emphasis">sendmail</EM> programcan determine the sender in four ways:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">If the sender is specified in the envelope of an SMTP connection,that sender's address is used.</P></LI><LICLASS="listitem"><PCLASS="para">If the <CODECLASS="literal">-f</CODE> command-line argument is used to run <EMCLASS="emphasis">sendmail</EM>,the sender's address is the address following the <CODECLASS="literal">-f</CODE>.</P></LI><LICLASS="listitem"><PCLASS="para">If the sender is not specified in the envelope, the address that is usedis that of the user who ran the <EMCLASS="emphasis">sendmail</EM> program. If thatuser is unknown, the sender is made to be <EMCLASS="emphasis">postmaster</EM>.</P></LI><LICLASS="listitem"><PCLASS="para">When processing the queue, the sender's address isspecified in the <CODECLASS="literal">S</CODE> line of the <CODECLASS="literal">qf</CODE> file.</P></LI></UL><PCLASS="para">The form of the <CODECLASS="literal">S</CODE> line in the <CODECLASS="literal">qf</CODE> file looks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">S<CODECLASS="replaceable"><I>addr</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">S</CODE> must begin the line. Exactly one address mustfollow on that same line. Whitespace may surroundthat address.There may be only one <CODECLASS="literal">S</CODE> line in the <CODECLASS="literal">qf</CODE> file.</P><PCLASS="para">If the <CODECLASS="replaceable"><I>addr</I></CODE> is missing, <EMCLASS="emphasis">sendmail</EM> sets the senderto be the user who ran <EMCLASS="emphasis">sendmail</EM>. If that user is not knownin the <EMCLASS="emphasis">passwd</EM> file (or database), <EMCLASS="emphasis">sendmail</EM> <EMCLASS="emphasis">syslog</EM>(3)'sthe following message and sets the sender to be <EMCLASS="emphasis">postmaster</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Who are you?</PRE></BLOCKQUOTE></P><PCLASS="para">The resulting address is then processed to extract the user's fullname into <CODECLASS="literal">$x</CODE> (see <ACLASS="xref"HREF="ch31_10.htm#SML2-CH-31-SECT-10-42"TITLE="">Section 31.10.42, $x</A>).Finally, the sender's address is rewritten by rule sets 3, 1, and then 4.</P><PCLASS="para">Under all versions of<EMCLASS="emphasis">sendmail</EM> the address in the <CODECLASS="literal">S</CODE> linewill include any RFC822 comment text that appeared withthe original message. Under V8.7, if the <CODECLASS="literal">F=c</CODE> flag(see <ACLASS="xref"HREF="ch30_08.htm#SML2-CH-30-SECT-8-14"TITLE="">Section 30.8.14, F=c</A>)is set for the sender's delivery agent, all comment textis stripped from the address.</P><PCLASS="para">If <EMCLASS="emphasis">sendmail</EM> is compiled with USERDB defined (see <ACLASS="xref"HREF="ch18_08.htm#SML2-CH-18-SECT-8-54"TITLE="">Section 18.8.54, USERDB</A>),the sender address can optionally be rewritten by the UserDatabase before it is placed into the <CODECLASS="literal">S</CODE> line. Suchrewriting is allowed only if the delivery agent for the senderincludes the <CODECLASS="literal">F=i</CODE> flag(see <ACLASS="xref"HREF="ch30_08.htm#SML2-CH-30-SECT-8-24"TITLE="">Section 30.8.24, F=i</A>).</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-15">23.9.15 T line</A></H3><PCLASS="refpurpose">Creation time</P>(All versions of sendmail)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-23-IX-T-LINE-QF-FILE"></A><ACLASS="indexterm"NAME="AUTOID-21994"></A><ACLASS="indexterm"NAME="AUTOID-21997"></A><ACLASS="indexterm"NAME="AUTOID-22000"></A>To limit the amount of time a message can remain inthe queue before being bounced, <EMCLASS="emphasis">sendmail</EM> mustknow when that message was first placed in the queue.That time of first placement is stored in the<CODECLASS="literal">T</CODE> line in the <CODECLASS="literal">qf</CODE> file. For example,the following number represents the date and time in seconds:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">T703531020</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22009"></A><ACLASS="indexterm"NAME="AUTOID-22011"></A><ACLASS="indexterm"NAME="AUTOID-22013"></A>Each time <EMCLASS="emphasis">sendmail</EM> fails to deliver a message from thequeue, it checks to see whether too much time has passed.It adds the <CODECLASS="literal">T</CODE> line value to the value specifiedin the <CODECLASS="literal">Timeout.queuereturn</CODE> (<CODECLASS="literal">T</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-70"TITLE="">Section 34.8.70</A>). If thatsum is less than the current time, the message is bouncedinstead of being left in the queue.</P><PCLASS="para">Messages are occasionally left in the queuefor longer than the normal timeout period. This might happen,for example, ifa remote machine is down but you know that it will eventually be brought backup.There are two ways to lengthen the amount of time a messagemay remain in the queue. </P><PCLASS="para">The preferred way is to create a temporary separatequeue directory and move the necessary queued file to that temporaryholding place. When the remote site comes back up, you can laterprocess the files in that other queue by running <EMCLASS="emphasis">sendmail</EM> withan artificially long <CODECLASS="literal">Timeout.queuereturn</CODE> value(see <ACLASS="xref"HREF="ch23_07.htm"TITLE="Process Alternate Queues">Section 23.7</A>).</P><PCLASS="para">A second way to extend the life of messages in the queue is toedit the <CODECLASS="literal">qf</CODE> file and change the value stored in the <CODECLASS="literal">T</CODE>line. Just add 86400 to that value for each day you want to extend.Care is required to avoid editing a file that is currently beingprocessed by <EMCLASS="emphasis">sendmail</EM>.[8]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[8] The <EMCLASS="emphasis">nvi</EM>(1) editor uses the same file locking as <EMCLASS="emphasis">sendmail</EM> and socan safely be used to edit <CODECLASS="literal">qf</CODE> files.</P></BLOCKQUOTE><PCLASS="para">There is currently no plan to give <EMCLASS="emphasis">sendmail</EM> the ability torejuvenate queued messages (make old messages appear young).</P><PCLASS="para">The form of the <CODECLASS="literal">T</CODE> line in the <CODECLASS="literal">qf</CODE> file is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">T<CODECLASS="replaceable"><I>secs</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">T</CODE> begins the line, and the <CODECLASS="replaceable"><I>secs</I></CODE> must immediatelyfollow with no intervening space. The numeric text that forms<CODECLASS="replaceable"><I>secs</I></CODE> is converted to an integer using the C libraryroutine <EMCLASS="emphasis">atol</EM>(3). That routine allows <CODECLASS="replaceable"><I>secs</I></CODE> tobe represented in text as a signed decimal number, an octal number,or a hexadecimal number.</P><PCLASS="para">If <CODECLASS="replaceable"><I>secs</I></CODE> is absent or the entire <CODECLASS="literal">T</CODE> lineis absent, the time value is zero. A zero value causes themail message to time out immediately.</P><PCLASS="para">There should be only one <CODECLASS="literal">T</CODE> line in any <CODECLASS="literal">qf</CODE> file.Multiple <CODECLASS="literal">T</CODE> lines cause all but the last to be ignored.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22056"></A></P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-16">23.9.16 V line</A></H3><PCLASS="refpurpose">Version of the qf file</P>(V8.7 and above)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22065"></A><ACLASS="indexterm"NAME="AUTOID-22068"></A><ACLASS="indexterm"NAME="AUTOID-22071"></A>s <EMCLASS="emphasis">sendmail</EM> evolves, it will continue to add new abilitiesto the <CODECLASS="literal">qf</CODE> file. To protect old versions of <EMCLASS="emphasis">sendmail</EM>from wrongly misinterpreting new configuration files, the <CODECLASS="literal">V</CODE> linehas been introduced. Prior to V8.7 <EMCLASS="emphasis">sendmail</EM> there wasno <CODECLASS="literal">V</CODE> line. For versions prior to 8.7.6 the version forthe <CODECLASS="literal">V</CODE> line is 1:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">V1            <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> V8.7.5 and earlier</I></PRE></BLOCKQUOTE></P><PCLASS="para">For V8.7.6 and above, including V8.8, the version is 2 (where version 2changes the layout of the <CODECLASS="literal">C</CODE> line in the <CODECLASS="literal">qf</CODE> file):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">V2            <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> V8.7.6 and above and V8.8</I></PRE></BLOCKQUOTE></P><PCLASS="para">If the version is greater than that currently supported, <EMCLASS="emphasis">sendmail</EM>will log this error and exit:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Version number in qf (<CODECLASS="replaceable"><I>bad</I></CODE>) greater than max (<CODECLASS="replaceable"><I>max</I></CODE>)</PRE></BLOCKQUOTE></P><PCLASS="para">A version 1 <CODECLASS="literal">qf</CODE> file allows <CODECLASS="replaceable"><I>flags</I></CODE> to follow the<CODECLASS="literal">R</CODE> line.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-17">23.9.17 Z line</A></H3><PCLASS="refpurpose">DSN ENVID envelope identifier</P>(V8.7 and above)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22107"></A><ACLASS="indexterm"NAME="AUTOID-22109"></A><ACLASS="indexterm"NAME="AUTOID-22112"></A><ACLASS="indexterm"NAME="AUTOID-22115"></A>The MAIL ESMTP command may optionally be followed byan RFC1891 ENVID envelope identifier:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">MAIL From: &lt;<CODECLASS="replaceable"><I>address</I></CODE>&gt; ENVID=<CODECLASS="replaceable"><I>envelopeID</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">ENVID is used to propagate a consistent envelope identifier(distinct from the <CODECLASS="literal">Message-ID:</CODE> header see <ACLASS="xref"HREF="ch35_10.htm#SML2-CH-35-SECT-10-19"TITLE="">Section 35.10.19, Message-ID:</A>) thatis permanently associated with a message.</P><PCLASS="para">The <CODECLASS="literal">Z</CODE> line holds that ENVID envelope identifierinformation:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Z<CODECLASS="replaceable"><I>envelopeID</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The ENVID information needs to be heldseparately from the <CODECLASS="literal">S</CODE> sender line because <EMCLASS="emphasis">sendmail</EM>has no way to determine in advance whether a recipient host speaksESMTP.</P><PCLASS="para">There must be only a single <CODECLASS="literal">Z</CODE> line in any <CODECLASS="literal">qf</CODE> file.The <CODECLASS="literal">${envid}</CODE> macro (see <ACLASS="xref"HREF="ch31_10.htm#SML2-CH-31-SECT-10-12"TITLE="">Section 31.10.12, ${envid}</A>) also stores the ENVID value.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-18">23.9.18 $ line</A></H3><PCLASS="refpurpose">Restore macro value</P>(V8.6 and above)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22146"></A><ACLASS="indexterm"NAME="AUTOID-22149"></A><ACLASS="indexterm"NAME="AUTOID-22152"></A>The <EMCLASS="emphasis">sendmail</EM> program uses the <CODECLASS="literal">$r</CODE> macro (see <ACLASS="xref"HREF="ch31_10.htm#SML2-CH-31-SECT-10-31"TITLE="">Section 31.10.31, $r</A>)to store the protocol used when <EMCLASS="emphasis">sendmail</EM> first received a mailmessage. If the messagewas received by using SMTP, that protocol is <CODECLASS="literal">smtp</CODE>.Otherwise, it is NULL.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22160"></A>The <EMCLASS="emphasis">sendmail</EM> program uses the <CODECLASS="literal">$s</CODE> macro (see <ACLASS="xref"HREF="ch31_10.htm#SML2-CH-31-SECT-10-33"TITLE="">Section 31.10.33, $s</A>)to store the full canonical name of the sender's machine.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22166"></A>The <EMCLASS="emphasis">sendmail</EM> program uses the <CODECLASS="literal">$_</CODE> macro (see <ACLASS="xref"HREF="ch31_10.htm#SML2-CH-31-SECT-10-1"TITLE="">Section 31.10.1, $-</A>)to store RFC1413 <EMCLASS="emphasis">identd</EM>(8) information and IP source routinginformation.</P><PCLASS="para">When <EMCLASS="emphasis">sendmail</EM> creates a <CODECLASS="literal">qf</CODE> file, it saves thevalues of the <CODECLASS="literal">$r</CODE>, <CODECLASS="literal">$s</CODE>, and <CODECLASS="literal">$_</CODE> macros in lines that begin with<CODECLASS="literal">$</CODE>.</P><PCLASS="para">The form of the <CODECLASS="literal">$</CODE> line in the <CODECLASS="literal">qf</CODE> file looks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$X<CODECLASS="replaceable"><I>value</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">$</CODE> must begin the line, and the macro's single-character name (the <CODECLASS="literal">X</CODE>)must immediately follow with no intervening space.The <CODECLASS="literal">X</CODE> is followed (again with no intervening space) by thevalue of the macro.</P><PCLASS="para">If <CODECLASS="replaceable"><I>value</I></CODE> is missing, the value given to the macro is NULL.If the <CODECLASS="literal">X</CODE> and <CODECLASS="replaceable"><I>value</I></CODE> are missing, the macro <CODECLASS="literal">\0</CODE> is given a value of NULL.If both are present, the macro that is specified (<CODECLASS="literal">X</CODE>) is given the value specified (<CODECLASS="replaceable"><I>value</I></CODE>).</P><PCLASS="para">There may be multiple <CODECLASS="literal">$</CODE> lines.The need to quickly process a <CODECLASS="literal">qf</CODE> file requires thatonly single-character macro names be used.</P></DIV></BLOCKQUOTE></DIV><DIVCLASS="refentry"><DIVCLASS="refnamediv"><H3CLASS="refname"><ACLASS="refname"NAME="SML2-CH-23-SECT-9-19">23.9.19 . line</A></H3><PCLASS="refpurpose">Mark EOF in qf file</P>(V8.7 and above)</DIV><BLOCKQUOTE><DIVCLASS="refsect1"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22207"></A><ACLASS="indexterm"NAME="AUTOID-22210"></A><ACLASS="indexterm"NAME="AUTOID-22213"></A><ACLASS="indexterm"NAME="AUTOID-22217"></A>One form of attack against <EMCLASS="emphasis">sendmail</EM> involves appending informationto an existing <CODECLASS="literal">qf</CODE> file. To prevent such attacks, V8.7 introducedthe dot line. In a <CODECLASS="literal">qf</CODE> file, any line that begins witha single dot:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">.<ICLASS="lineannotation">followed by anything</I></PRE></BLOCKQUOTE></P><PCLASS="para">is considered to mark the end of the file's useful information. Upon encountering that dot, <EMCLASS="emphasis">sendmail</EM> continues to readthe <CODECLASS="literal">qf</CODE> file. If any line follows the dot line, <EMCLASS="emphasis">sendmail</EM>logs the following message and changes the <CODECLASS="literal">qf</CODE> file intoa <CODECLASS="literal">Qf</CODE> file (see <ACLASS="xref"HREF="ch23_03.htm#SML2-CH-23-SECT-3-3"TITLE="Extra Data at End of qf File">Section 23.3.3, "Extra Data at End of qf File"</A>):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">SECURITY ALERT: extra data in qf: <ICLASS="lineannotation">bogus line here</I></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22237"></A><ACLASS="indexterm"NAME="AUTOID-22238"></A></P></DIV></BLOCKQUOTE></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch23_08.htm"TITLE="23.8 Pitfalls"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 23.8 Pitfalls"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch24_01.htm"TITLE="24. Aliases"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24. Aliases"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">23.8 Pitfalls</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">24. Aliases</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>