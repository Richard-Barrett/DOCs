<HTML><HEAD><TITLE>[Chapter 24] Aliases</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:37:57Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part03.htm"TITLE="III. Administration"><LINKREL="prev"HREF="ch23_09.htm"TITLE="23.9 The qf File Internals"><LINKREL="next"HREF="ch24_02.htm"TITLE="24.2 Forms of Alias Delivery"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch23_09.htm"TITLE="23.9 The qf File Internals"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 23.9 The qf File Internals"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 24</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_02.htm"TITLE="24.2 Forms of Alias Delivery"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.2 Forms of Alias Delivery"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="SML2-CH-24">24. Aliases</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#SML2-CH-24-SECT-1"TITLE="24.1 The aliases(5) File">The aliases(5) File</A><BR><ACLASS="sect1"HREF="ch24_02.htm"TITLE="24.2 Forms of Alias Delivery">Forms of Alias Delivery</A><BR><ACLASS="sect1"HREF="ch24_03.htm"TITLE="24.3 Write a Delivery Agent Script">Write a Delivery Agent Script</A><BR><ACLASS="sect1"HREF="ch24_04.htm"TITLE="24.4 Special Aliases">Special Aliases</A><BR><ACLASS="sect1"HREF="ch24_05.htm"TITLE="24.5 The Aliases Database">The Aliases Database</A><BR><ACLASS="sect1"HREF="ch24_06.htm"TITLE="24.6 Prevent Aliasing with -n">Prevent Aliasing with -n</A><BR><ACLASS="sect1"HREF="ch24_07.htm"TITLE="24.7 Pitfalls">Pitfalls</A></P><P></P></DIV><PCLASS="para"></P><PCLASS="para">Aliasing is the replacing of one recipient address with one or moredifferent recipient addresses. The replacement address can be that ofa single user, a list of recipients, a program, a file, or any mixtureof these. In this chapter we cover the <EMCLASS="emphasis">aliases</EM>(5) file, one ofthe three methods of aliasing available with the <EMCLASS="emphasis">sendmail</EM>program. We cover the other two forms, <CODECLASS="literal">:include:</CODE> (forincluding separate files from within the <EMCLASS="emphasis">aliases</EM> file) and<EMCLASS="emphasis">~/.forward</EM> (the user's personal <CODECLASS="literal">:include:</CODE> file) in thenext chapter.<ACLASS="indexterm"NAME="SML2-CH-24-IX-ALIASING"></A></P><PCLASS="para">Aliasing can be used to handle several complex delivery problems:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Delivering mail to a single user under a variety of usernames</P></LI><LICLASS="listitem"><PCLASS="para">Distributing a mail message to many users by specifying only a singlerecipient name</P></LI><LICLASS="listitem"><PCLASS="para">Appending mail to files for archival and other purposes</P></LI><LICLASS="listitem"><PCLASS="para">Filtering mail through programs and shell scripts</P></LI></UL><PCLASS="para">All the information that is needed to perform these tasks is contained in the <EMCLASS="emphasis">aliases</EM>(5) file (which is often also stored in database formatto make lookups faster).&#13;</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-24-SECT-1">24.1 The aliases(5) File</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-24-IX-ALIASES-FILE-"></A>The <EMCLASS="emphasis">aliases</EM>(5) file is one of several sources that can supplysystem mail aliases. We describe it first because it is the most traditionaland because it illustrates the syntax and limitations common to all techniques.</P><PCLASS="para">The <EMCLASS="emphasis">aliases</EM>(5) file is composed of lines of text. Any line thatbegins with a <CODECLASS="literal">#</CODE> is a comment and is ignored.Empty lines (those that contain only a newline character)are also ignored. Any line that begins with a space or a tab isjoined (appended) to the line above it. All other lines of textare viewed as alias lines. The format for an alias line is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">local: alias</PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">local</CODE> must begin a line. It is an address in theform of a local recipient address (we will discuss this in more detail soon).The colon follows the <CODECLASS="literal">local</CODE> on the same line and maybe preceded with spaces or tabs. If the colon is missing,<EMCLASS="emphasis">sendmail</EM> prints and <EMCLASS="emphasis">syslog</EM>(3)'s the following error messageand skips that alias line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">missing colon</PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">alias</CODE> (to the right of the colon) is one or more addresses on the same line.Indented continuation lines are permitted. Each addressshould be separated from the next by a comma and optional space characters.A typical alias looks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">root: jim, sysadmin@server,      gunther  <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>  <ICLASS="lineannotation">indenting whitespace</I></PRE></BLOCKQUOTE></P><PCLASS="para">Here, <CODECLASS="literal">root</CODE> is the local address to be aliased.When mail is to be locally delivered to <CODECLASS="literal">root</CODE>, it is lookedup in the <EMCLASS="emphasis">aliases</EM>(5) file. If found, <CODECLASS="literal">root</CODE>is replaced with the three addresses shown earlier, and mail isinstead delivered to those other three addresses.</P><PCLASS="para">This process of looking up and possibly aliasing local recipientsis repeated for each recipient until no more aliases are found in the<EMCLASS="emphasis">aliases</EM>(5) file.That is, for example, if one of the aliases for <CODECLASS="literal">root</CODE> is <CODECLASS="literal">jim</CODE>and if <CODECLASS="literal">jim</CODE> also exists to the left of a colon in the <EMCLASS="emphasis">aliases</EM>file, he too is replaced with his alias:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">jim: jim@otherhost</PRE></BLOCKQUOTE></P><PCLASS="para">The list of addresses to the right of the colon may be mail addresses(such as <EMCLASS="emphasis">gunther</EM> or <EMCLASS="emphasis">jim@otherhost</EM>),the name of a program to run (such as <EMCLASS="emphasis">/etc/relocated</EM>),the name of a file onto which to append (such as <EMCLASS="emphasis">/usr/share/archive</EM>), or thename of a file to read for additional addresses (using <CODECLASS="literal">:include:</CODE>).The <CODECLASS="literal">:include:</CODE> is used in creating mailing lists and will be coveredin the next chapter.&#13;</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-24-SECT-1-1">24.1.1 The aliases(5) file's location</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22310"></A><ACLASS="indexterm"NAME="AUTOID-22312"></A>The location of the <EMCLASS="emphasis">aliases</EM>(5) file is specified with the<CODECLASS="literal">ServiceSwitchFile</CODE> option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-61"TITLE="">Section 34.8.61, ServiceSwitchFile</A>)and the <CODECLASS="literal">AliasFile</CODE> (<CODECLASS="literal">A</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-1"TITLE="">Section 34.8.1, AliasFile (A)</A>)in the configuration file. Be aware that, since these two options interact,it may not suffice to simply declare one or the other. Alsobe aware that some systems supply service-switch files that willbe used even if the <CODECLASS="literal">ServiceSwitchFile</CODE> option is omitted.</P><PCLASS="para">Note that the service-switch file merely specifies the order in which variousmethods should be used to look up aliases, not the specific files.If it lists <CODECLASS="literal">files</CODE> as a method:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">aliases    files</PRE></BLOCKQUOTE></P><PCLASS="para">then all the files declared with the<CODECLASS="literal">AliasFile</CODE> option will be looked up in the order in which they were declared:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">If the <CODECLASS="literal">AliasFile</CODE> option specifies a file and ifa service-switch file omits the <CODECLASS="literal">files</CODE> specification,the <CODECLASS="literal">AliasFile</CODE> option is ignored.</P></LI><LICLASS="listitem"><PCLASS="para">If the <CODECLASS="literal">AliasFile</CODE> option specifies a file and ifa service-switch file omits the <CODECLASS="literal">aliases</CODE> line,the <CODECLASS="literal">AliasFile</CODE> option is used.</P></LI><LICLASS="listitem"><PCLASS="para">If the <CODECLASS="literal">AliasFile</CODE> option specifies a file and if thereis no service-switch file, then the <CODECLASS="literal">AliasFile</CODE> option fileis used.</P></LI><LICLASS="listitem"><PCLASS="para">If the <CODECLASS="literal">AliasFile</CODE> option is omittedand if there is no service-switch file or if there is aservice-switch file but it omits an <CODECLASS="literal">aliases</CODE> line,<EMCLASS="emphasis">sendmail</EM> silently presumes that it should not do aliasing.</P></LI></UL><PCLASS="para">Note that service-switch files and <CODECLASS="literal">AliasFile</CODE> (<CODECLASS="literal">A</CODE>) optioncan list other techniques for obtaining aliases in addition to, orinstead of, an <EMCLASS="emphasis">aliases</EM>(5) file. But this can lead to a side effect.For example, if your configuration file declares</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">O AliasFile=/etc/aliases,nis:</PRE></BLOCKQUOTE></P><PCLASS="para">and if the service-switch file <CODECLASS="literal">aliases</CODE> line specifies:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">aliases    nis files</PRE></BLOCKQUOTE></P><PCLASS="para">then <EMCLASS="emphasis">sendmail</EM> looks up aliases firstwith <EMCLASS="emphasis">nis</EM>, then in the <EMCLASS="emphasis">/etc/aliases</EM> file, then with <EMCLASS="emphasis">nis</EM> a second time.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-24-SECT-1-2">24.1.2 Local Must Be Local</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22365"></A>The <CODECLASS="literal">local</CODE> part of an alias must bein the form of a local recipient. This restriction is enforced each time <EMCLASS="emphasis">sendmail</EM>reads the <EMCLASS="emphasis">aliases</EM>(5) file. For every name to the leftof a colon that it finds, <EMCLASS="emphasis">sendmail</EM> performs the followingnormalization and verification steps.</P><PCLASS="para">To begin, <EMCLASS="emphasis">sendmail</EM> normalizes each address by removingeverything but the address part.For example, consider the following two alias lines:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">george (George Washington): gwGeorge Washington &lt;george&gt;: gw</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;When <EMCLASS="emphasis">sendmail</EM> reads these lines, it normalizes each into its address part:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">george (George Washington)    <ICLASS="lineannotation">becomes <IMGSRC="../chars/rarr.gif"ALT="-&gt;"></I>  georgeGeorge Washington &lt;george&gt;    <ICLASS="lineannotation">becomes <IMGSRC="../chars/rarr.gif"ALT="-&gt;"></I>  george</PRE></BLOCKQUOTE></P><PCLASS="para">After the address part is extracted, it is convertedto lowercase and rewritten by rule sets 3 and 0 to seewhether it causes the <CODECLASS="literal">local</CODE> delivery agent to be selectedor, beginning with V8.7 <EMCLASS="emphasis">sendmail</EM>, to see whether it causes any deliveryagent with the <CODECLASS="literal">F=A</CODE> flag set (see <ACLASS="xref"HREF="ch30_08.htm#SML2-CH-30-SECT-8-12"TITLE="">Section 30.8.12, F=A</A>)to be selected.</P><PCLASS="para">Here, the address <CODECLASS="literal">george</CODE> (after processing)selects a local delivery agent, and sothese alias lines are legal.Internally (or in its database), <EMCLASS="emphasis">sendmail</EM> stores the abovealias as</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">george: gw</PRE></BLOCKQUOTE></P><PCLASS="para">When mail arrives that is addressed for delivery to <CODECLASS="literal">george</CODE>,<EMCLASS="emphasis">sendmail</EM> rewrites that address with rule sets 3 and 0.Rule set 0 selects the <CODECLASS="literal">local</CODE> delivery agent (or, for V8.7, anyagent with <CODECLASS="literal">F=A</CODE> set). Only ifa local delivery agent is selected for an address does<EMCLASS="emphasis">sendmail</EM> look up an address in its <EMCLASS="emphasis">aliases</EM> file. The address <CODECLASS="literal">george</CODE> is looked up and replaced with <CODECLASS="literal">gw</CODE>.Internally, <EMCLASS="emphasis">sendmail</EM> marks the recipient <CODECLASS="literal">george</CODE>as defunct, having been replaced with an alias, and then adds <CODECLASS="literal">gw</CODE>to the list of recipients.</P><PCLASS="para">The new recipient, <CODECLASS="literal">gw</CODE>, is then processed for delivery.Rule sets 3 and 0 are called once more and again select a localdelivery agent. As a consequence, <CODECLASS="literal">gw</CODE> is also looked up.If it is found to the left of a colon in the <EMCLASS="emphasis">aliases</EM> file,it too is replaced with yet another address (or addresses).This process repeats until no new local addresses are found.</P><PCLASS="para">The entry <CODECLASS="literal">george</CODE> is marked defunct ratherthan being deleted to detect alias loops. To illustrate, considerthe following two mutually referencing aliases:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">george: gwgw: george</PRE></BLOCKQUOTE></P><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> program first replaces <CODECLASS="literal">george</CODE> with <CODECLASS="literal">gw</CODE>,marking <CODECLASS="literal">george</CODE> as defunct. It goes to mark <CODECLASS="literal">gw</CODE>as defunct but notices that a loop has been formed.If <EMCLASS="emphasis">sendmail</EM> is running in verbose mode (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-76"TITLE="">Section 34.8.76, Verbose</A>),it prints</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">aliasing/forwarding loop broken</PRE></BLOCKQUOTE></P><PCLASS="para">and bounces the message.</P><PCLASS="para">Note that aliases can get pretty complex. As a consequence, when one addressaliases to many new addresses, this autodetection of loops will fail (butthe problem will be caught later with &quot;hop counting&quot;; see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-36"TITLE="">Section 34.8.36, MaxHopCount (h)</A>).<ACLASS="indexterm"NAME="AUTOID-22425"></A>&#13;</P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch23_09.htm"TITLE="23.9 The qf File Internals"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 23.9 The qf File Internals"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_02.htm"TITLE="24.2 Forms of Alias Delivery"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.2 Forms of Alias Delivery"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">23.9 The qf File Internals</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">24.2 Forms of Alias Delivery</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>