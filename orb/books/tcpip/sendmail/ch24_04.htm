<HTML><HEAD><TITLE>[Chapter 24] 24.4 Special Aliases</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:38:41Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch24_01.htm"TITLE="24. Aliases"><LINKREL="prev"HREF="ch24_03.htm"TITLE="24.3 Write a Delivery Agent Script"><LINKREL="next"HREF="ch24_05.htm"TITLE="24.5 The Aliases Database"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_03.htm"TITLE="24.3 Write a Delivery Agent Script"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.3 Write a Delivery Agent Script"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 24<BR>Aliases</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_05.htm"TITLE="24.5 The Aliases Database"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.5 The Aliases Database"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-24-SECT-4">24.4 Special Aliases</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-24-IX-SPECIAL-ALIASES"></A><ACLASS="indexterm"NAME="SML2-CH-24-IX-ALIASING-SPECIAL-ALIASES"></A>The behavior of the <EMCLASS="emphasis">sendmail</EM> program requires that twospecific aliases (<EMCLASS="emphasis">Postmaster</EM> and <EMCLASS="emphasis">MAILER-DAEMON</EM>)be defined in every <EMCLASS="emphasis">aliases</EM> file.Beginning with V8.7 <EMCLASS="emphasis">sendmail</EM>, aliases that contain a pluscharacter can be used to route mail on the basis of special needs.Also, beginning with V8.7 <EMCLASS="emphasis">sendmail</EM>, databases that allowduplicates can be declared to help automate the creation ofthose files.&#13;</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-24-SECT-4-1">24.4.1 The Postmaster Alias</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22843"></A>RFC822 requires every site to accept for delivery mail that is addressedto a user named <EMCLASS="emphasis">postmaster</EM>. It also requires that mail acceptedfor <EMCLASS="emphasis">postmaster</EM> always be delivered to a real human being&nbsp;- someone who is capable of handling mail problems.If <EMCLASS="emphasis">postmaster</EM> is not an alias, or a real user, <EMCLASS="emphasis">sendmail</EM><EMCLASS="emphasis">syslog</EM>(3)'s the following error:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">can't even parse postmaster!</PRE></BLOCKQUOTE></P><PCLASS="para">Unless a site has a real user account named <EMCLASS="emphasis">postmaster</EM>, an aliasis required in every <EMCLASS="emphasis">aliases</EM> file for that name. That aliasmust be a list of one or more real people, although it may alsocontain a specification for an archive file or filter program.One such alias might look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">postmaster: bill, /mail/archives/postmaster,       &quot;|/usr/local/bin/notify root@mailhost&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">Here, <CODECLASS="literal">postmaster</CODE> is lowercase. Because all aliasesare converted to lowercase for lookup, <CODECLASS="literal">Postmaster</CODE>or even <CODECLASS="literal">POSTMASTER</CODE> could have been used for equal effect.</P><PCLASS="para">Note that there are three aliases to the right of the colon: a local usernamed <CODECLASS="literal">bill</CODE>, the full path of a file onto which mailmessages will be appended, and a program to <CODECLASS="literal">notify</CODE>the user <CODECLASS="literal">root</CODE> at the machine <CODECLASS="literal">mailhost</CODE>that <CODECLASS="literal">postmaster</CODE> mail has arrived on the local machine.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22868"></A><ACLASS="indexterm"NAME="AUTOID-22870"></A><ACLASS="indexterm"NAME="AUTOID-22873"></A>As a convention, the special name <EMCLASS="emphasis">postmaster</EM>can also be that of the user who gets duplicate copiesof some bounced mail.This is enabled by using the <CODECLASS="literal">PostmasterCopy</CODE> (<CODECLASS="literal">P</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-46"TITLE="">Section 34.8.46, PostmasterCopy (P)</A>) in the configuration file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">OPpostmaster                  <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> pre-V8.7</I>O PostmasterCopy=postmaster   <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> V8.7 and above</I></PRE></BLOCKQUOTE></P><PCLASS="para">To disable sending copies of bounced mail to a special user (perhaps to protect privacy), omit this option from the configuration file.</P><PCLASS="para">Note that V8 <EMCLASS="emphasis">sendmail</EM> does not send to the postmastercopies of error mail that include a <CODECLASS="literal">Precedence:</CODE> header with a value less thanzero, like <EMCLASS="emphasis">junk</EM>, <EMCLASS="emphasis">bulk</EM>, or <EMCLASS="emphasis">list</EM> used by mailing lists.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22892"></A><ACLASS="indexterm"NAME="AUTOID-22895"></A>Also note that some sites define this user as one who isalways aliased to a filter program in the <EMCLASS="emphasis">aliases</EM> file. For example,if the <CODECLASS="literal">PostmasterCopy</CODE> (<CODECLASS="literal">P</CODE>) option is declared as</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">OPmail-errors                  <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> pre-V8.7</I>O PostmasterCopy=mail-errors   <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> V8.7 and above</I></PRE></BLOCKQUOTE></P><PCLASS="para">and the corresponding <EMCLASS="emphasis">aliases</EM> file entry is declared as</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">mail-errors: &quot;|/etc/mail/filter postmaster&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">a program <CODECLASS="literal">filter</CODE> can be designed that discardsall common error messages, such as mistyped addresses, and forwardswhat remains to <CODECLASS="literal">postmaster</CODE>.</P><PCLASS="para">Many sites have developed just such filters.One is distributed with the V8 <EMCLASS="emphasis">sendmail</EM> sourcein the file <EMCLASS="emphasis">contrib/mmuegel</EM>. Written by Michael S. Muegel of Motorola's Corporate Information Office, it is a <EMCLASS="emphasis">shar</EM>(1) fileof several useful <EMCLASS="emphasis">perl</EM>(1) scripts. One (<EMCLASS="emphasis">postclip.pl</EM>) is a tool that filters out the body of bouncedmail messages to prevent postmasters from potentially violating the privacy of senders. It tries to retain all headers, no matter how deeplythey are buried in what appears to be the message body.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-24-SECT-4-2">24.4.2 The MAILER-DAEMON Alias</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22920"></A><ACLASS="indexterm"NAME="AUTOID-22922"></A>When mail is bounced, the notification of failure is alwaysshown as being fromthe sender whose name is defined by the <CODECLASS="literal">$n</CODE> macro (see<ACLASS="xref"HREF="ch31_10.htm#SML2-CH-31-SECT-10-26"TITLE="">Section 31.10.26, $n</A>). Traditionally,that macro is given the value <CODECLASS="literal">mailer-daemon</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">DnMAILER-DAEMON</PRE></BLOCKQUOTE></P><PCLASS="para">That tradition is enforced by the fact that if <CODECLASS="literal">$n</CODE> is notdefined, it defaults to <CODECLASS="literal">mailer-daemon</CODE>.</P><PCLASS="para">There needs to be an alias for whatever name is defined for<CODECLASS="literal">$n</CODE>, because users occasionally make the mistakeof replying to bounced mail. Two typical aliases are</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">mailer-daemon: postmastermailer-daemon: /dev/null</PRE></BLOCKQUOTE></P><PCLASS="para">Here, the name to the left of the colon should be whateverwas defined for <CODECLASS="literal">$n</CODE> in the configuration file,traditionally (and recommended to be) <CODECLASS="literal">mailer-daemon</CODE>.The first alias forwards all <CODECLASS="literal">mailer-daemon</CODE> reply mail tothe postmaster. Many site administrators prefer the second,which discards such mail by using <EMCLASS="emphasis">/dev/null</EM>.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-24-SECT-4-3">24.4.3 Plussed Users</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22944"></A><ACLASS="indexterm"NAME="AUTOID-22947"></A><ACLASS="indexterm"NAME="AUTOID-22950"></A>Plussed users is a simple way to do more versatile aliasing. It is availableonly with V8.7 <EMCLASS="emphasis">sendmail</EM> and above, and it requires that youuse a configuration file that comes with V8 <EMCLASS="emphasis">sendmail</EM>.To illustrate its use, consider the need to have mail routedto different sets of administrators depending on how theaddress <EMCLASS="emphasis">root</EM> is augmented:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">root: hans, georgeroot+db:   root, dbadmin@server.db.here.eduroot+*:    root, root@here.edu</PRE></BLOCKQUOTE></P><PCLASS="para">Here, the first line shows a normal sort of alias in which mail sent to<EMCLASS="emphasis">root</EM> will instead be delivered to the local users <EMCLASS="emphasis">hans</EM>and <EMCLASS="emphasis">george</EM>.The second line is still not all that special, because we could as easily have used an alias such as <EMCLASS="emphasis">root_db</EM> toaccomplish the same thing.It sends mailto <EMCLASS="emphasis">root+db</EM> to the local <EMCLASS="emphasis">root</EM> users and to the databaseadministrators in another department, <EMCLASS="emphasis">dbadmin@server.db.here.edu</EM>.</P><PCLASS="para">The third line is where things start to get interesting. The <CODECLASS="literal">+*</CODE>in it will match anything or nothing following the plus,so mail sent to <EMCLASS="emphasis">root+</EM> will be sent both to the local<EMCLASS="emphasis">root</EM> users and to the central administratorsat <EMCLASS="emphasis">root@here.edu</EM>. But so will anything following the plusthat is not <CODECLASS="literal">db</CODE>, such as <EMCLASS="emphasis">root+foo</EM>.</P><PCLASS="para">If the <CODECLASS="literal">+*</CODE> form is omitted:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">root: hans, georgeroot+db:   root, dbadmin@server.db.here.edu</PRE></BLOCKQUOTE></P><PCLASS="para">the default for plussed addresses other than <EMCLASS="emphasis">root+db</EM> becomes<EMCLASS="emphasis">root</EM>. That is, when <EMCLASS="emphasis">sendmail</EM> looks up a plussed address(for example <EMCLASS="emphasis">root+foo</EM>)it does so in the following order:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Look for an exact match. Does <EMCLASS="emphasis">root+foo</EM> match <EMCLASS="emphasis">root+db</EM>?</P></LI><LICLASS="listitem"><PCLASS="para">Look for a wildcard match. Does <EMCLASS="emphasis">root+</EM><CODECLASS="literal">*</CODE> exist? If so, use thatalias for <EMCLASS="emphasis">root+foo</EM>.</P></LI><LICLASS="listitem"><PCLASS="para">Look for a base match. Does the <EMCLASS="emphasis">root</EM> of <EMCLASS="emphasis">root+foo</EM> existas an alias? If so, use that alias for <EMCLASS="emphasis">root+foo</EM>.</P></LI></UL><PCLASS="para">Note that plussed users is a simple mechanism that is intended to solvesimple needs. In distributing a common aliases file to manymachines, for example, plussed users can furnish a hook that allows customizationbased on simple alias extensions. Because plussed users is simple, attemptsto extend it to handle complex needs will likely fail. If your needsare complex, consider using the User Database (see <ACLASS="xref"HREF="ch33_05.htm"TITLE="The User Database">Section 33.5, "The User Database"</A>) or writing custom hooks in <EMCLASS="emphasis">checkcompat</EM>() (see <ACLASS="xref"HREF="ch20_01.htm#SML2-CH-20-SECT-1"TITLE="How checkcompat() Works">Section 20.1, "How checkcompat() Works"</A>)instead.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-24-SECT-4-4">24.4.4 Duplicate Entries and Automation</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-23003"></A>Ordinarily, duplicate local names on the left-hand side of the colon inan alias file will result in an error. For example, consider thisabstract from an aliases file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">staff: bobstaff: george</PRE></BLOCKQUOTE></P><PCLASS="para">Running <EMCLASS="emphasis">newaliases</EM> on this file would produce the following errormessage and would cause the first entry to be ignored:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Warning: duplicate alias name <CODECLASS="replaceable"><I>george</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Sometimes, however, it is advantageous to produce an alias filewith duplicates. Consider this abstract from a newuser addingscript:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">if [ $GROUP = &quot;staff&quot; ]then        echo &quot;staff: $USER&quot; &gt;&gt; /etc/aliasdir/groupsfi</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;Here, we seek to add the user whose login name is stored in<CODECLASS="literal">$USER</CODE> to the mailing list called <CODECLASS="literal">staff</CODE>.To prevent <EMCLASS="emphasis">sendmail</EM> from complaining, we declare the<EMCLASS="emphasis">/etc/aliasdir/groups</EM> file like this in the configurationfile:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">O AliasFile=dbm:-A /etc/aliasdir/groups</PRE></BLOCKQUOTE></P><PCLASS="para">Here, the <CODECLASS="literal">dbm</CODE> tells <EMCLASS="emphasis">sendmail</EM> this isa <EMCLASS="emphasis">ndbm</EM>(3) type file (it could also be <CODECLASS="literal">btree</CODE> or <CODECLASS="literal">hash</CODE>for <EMCLASS="emphasis">db</EM>(3) type files). The <CODECLASS="literal">-A</CODE> switch tells <EMCLASS="emphasis">sendmail</EM> toappend duplicates rather than rejecting them.Too illustrate, revisit the earlier alias file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">staff: bobstaff: george</PRE></BLOCKQUOTE></P><PCLASS="para">The first alias line is read and stored normally with this key and value pair:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">staff    bob  <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>        <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>  <ICLASS="lineannotation">key</I>      <ICLASS="lineannotation">value</I></PRE></BLOCKQUOTE></P><PCLASS="para">The second line is then appended to the first line, because of the <CODECLASS="literal">-A</CODE> switch,to form</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">staff    bob,george  <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>        <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>  <ICLASS="lineannotation">key</I>      <ICLASS="lineannotation">value</I></PRE></BLOCKQUOTE></P><PCLASS="para">The comma is intelligently inserted by <EMCLASS="emphasis">sendmail</EM>.</P><PCLASS="para">Although this technique can simplify the maintenance of some aliasfiles, it should not be overused. Each append requires the prior entryto be read, the space for it and the new entry to be allocated, the old and new entries to be concatenated, andthe result to be stored in such a way as to replace the original. This processslows down <EMCLASS="emphasis">sendmail</EM> noticeably when it rebuilds largefiles with many duplicates.<ACLASS="indexterm"NAME="AUTOID-23052"></A><ACLASS="indexterm"NAME="AUTOID-23053"></A>&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_03.htm"TITLE="24.3 Write a Delivery Agent Script"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.3 Write a Delivery Agent Script"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_05.htm"TITLE="24.5 The Aliases Database"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.5 The Aliases Database"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">24.3 Write a Delivery Agent Script</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">24.5 The Aliases Database</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>