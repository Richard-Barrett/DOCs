<HTML><HEAD><TITLE>[Chapter 24] 24.6 Prevent Aliasing with -n</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:39:02Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch24_01.htm"TITLE="24. Aliases"><LINKREL="prev"HREF="ch24_05.htm"TITLE="24.5 The Aliases Database"><LINKREL="next"HREF="ch24_07.htm"TITLE="24.7 Pitfalls"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_05.htm"TITLE="24.5 The Aliases Database"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.5 The Aliases Database"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 24<BR>Aliases</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_07.htm"TITLE="24.7 Pitfalls"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.7 Pitfalls"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-24-SECT-6">24.6 Prevent Aliasing with -n</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-24-IX-ALIASING-PREVENTING"></A><ACLASS="indexterm"NAME="SML2-CH-24-IX-N-SWITCH-N-SWITCH-1"></A>At times it is desirable to run <EMCLASS="emphasis">sendmail</EM> so thatit does not perform aliasing. When aliasing is disabled,<EMCLASS="emphasis">sendmail</EM> uses the recipient address as is.No addresses are ever looked up in the <EMCLASS="emphasis">aliases</EM> file,even if they are local.</P><PCLASS="para">The <CODECLASS="literal">-n</CODE> command-line switch tells <EMCLASS="emphasis">sendmail</EM> not toperform aliasing of recipient addresses. This switchis rarely used but can be handy in a couple of situations.&#13;</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-24-SECT-6-1">24.6.1 Is an Alias Bad?</A></H3><PCLASS="para">In tracking down delivery problems, it can be difficult todetermine where the problem lies. If you suspect a bad alias,you can force aliasing to be skipped and see whether that causes the problemto go away:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>/usr/lib/sendmail -n user &lt; /dev/null</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">This tells <EMCLASS="emphasis">sendmail</EM> to send an empty mail message (one containingmandatory headers only) to the recipient named <CODECLASS="literal">user</CODE>. The<CODECLASS="literal">-n</CODE> prevents <EMCLASS="emphasis">sendmail</EM> from looking up <CODECLASS="literal">user</CODE>either in the <EMCLASS="emphasis">aliases</EM> database or in <EMCLASS="emphasis">~/.forward</EM>.If <CODECLASS="literal">user</CODE> resolves to the <CODECLASS="literal">local</CODE> delivery agent,the message will be delivered, and you should therefore suspect analiasing problem.</P><PCLASS="para">Other switches, such as <CODECLASS="literal">-v</CODE> (verbose) and<CODECLASS="literal">-d</CODE> (debugging), can be combined with <CODECLASS="literal">-n</CODE> to view the delivery process in more detail.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-24-SECT-6-2">24.6.2 Filtering Recipients with a Shell Script</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-23272"></A><ACLASS="indexterm"NAME="AUTOID-23275"></A><ACLASS="indexterm"NAME="AUTOID-23278"></A>The <CODECLASS="literal">-n</CODE> command-line switch can also be used to suppressaliasing when delivering to a list of recipients that has alreadybeen aliased. For example, consider the following script, which attempts to restrict delivery to users who havemail delivered locally and to skip users who have mail forwardedoffsite:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#!/bin/shEX_OK=0                   # From &lt;sysexits.h&gt;EX_NOUSER=67              # From &lt;sysexits.h&gt;EX_SOFTWARE=70            # From &lt;sysexits.h&gt;if [ ${#} -ne 2 ]; then        echo Usage: $0 list-name        exit $EX_USAGEfitrap &quot;exit 70&quot; 1 2 13 15LIST= &quot;`/usr/lib/sendmail -bv $1 \          | grep &quot;mailer local&quot; 2&gt;&amp;1`&quot; \         | sed 's/\\.\\.\\..*$//'if [ -z &quot;$LIST&quot; ]        echo &quot;$1 expanded to an empty list&quot;        exit $EX_NOUSERfiif /usr/lib/sendmail -n $LIST &gt;/dev/null 2&gt;&amp;1then        exit $EX_OKfiexit $EX_SOFTWARE</PRE></BLOCKQUOTE></P><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> program is called twice inside this script. First, itis given the <CODECLASS="literal">-bv</CODE> switch,which causes it to expand the list of recipientsin <CODECLASS="literal">$1</CODE>. That expansion includes aliasing (and <EMCLASS="emphasis">~/.forward</EM>aliasing) for each name in the list. The output produced looks likethis:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">user1... deliverable: mailer local, user user1user2@otherhost... deliverable: mailer smtp, host otherhost, user user2@otherhost</PRE></BLOCKQUOTE></P><PCLASS="para">The <EMCLASS="emphasis">grep</EM>(1) program selects only those lines thatcontain the expression <CODECLASS="literal">&quot;mailer local&quot;</CODE>, thus indicating alocal user.The <EMCLASS="emphasis">sed</EM>(1) program then discards from the ... to the endof each selected line.The result, a list of local recipients only, is saved in the shell variable<CODECLASS="literal">LIST</CODE>.</P><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> program is called with the <CODECLASS="literal">-n</CODE> switch,which prevents it from re-aliasing the list of names in <CODECLASS="literal">$LIST</CODE> (they have already been aliased once).</P><PCLASS="para">Note that this script should not be used as is because it checks only for the deliveryagent named <CODECLASS="literal">local</CODE>, rather than for any delivery agent that canperform final delivery.<ACLASS="indexterm"NAME="AUTOID-23301"></A><ACLASS="indexterm"NAME="AUTOID-23302"></A>&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_05.htm"TITLE="24.5 The Aliases Database"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.5 The Aliases Database"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_07.htm"TITLE="24.7 Pitfalls"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.7 Pitfalls"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">24.5 The Aliases Database</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">24.7 Pitfalls</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>