<HTML><HEAD><TITLE>[Chapter 25] 25.7 The User's ~/.forward File</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:39:37Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch25_01.htm"TITLE="25. Mailing Lists and ~/.forward"><LINKREL="prev"HREF="ch25_06.htm"TITLE="25.6 Packages That Help"><LINKREL="next"HREF="ch25_08.htm"TITLE="25.8 Pitfalls"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch25_06.htm"TITLE="25.6 Packages That Help"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 25.6 Packages That Help"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 25<BR>Mailing Lists and ~/.forward</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch25_08.htm"TITLE="25.8 Pitfalls"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 25.8 Pitfalls"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-25-SECT-7">25.7 The User's ~/.forward File</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-25-IX-FORWARD-FILE-FORWARD"></A>The <EMCLASS="emphasis">sendmail</EM> program allows each user to have a <CODECLASS="literal">:include:</CODE>style list to customize the receipt of personal mail. That file(actually a possible sequence of files) is defined by the<CODECLASS="literal">ForwardPath</CODE> (<CODECLASS="literal">J</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-27"TITLE="">Section 34.8.27, ForwardPath (J)</A>).Traditionally, that file is located in a user's home directory.[6]<ACLASS="indexterm"NAME="AUTOID-23925"></A>We use the C-shell notation <CODECLASS="literal">~</CODE>to indicate user home directories, so we will compactly refer tothis file as <EMCLASS="emphasis">~/.forward</EM>.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[6] Prior to V8 <EMCLASS="emphasis">sendmail</EM> the <EMCLASS="emphasis">~/.forward</EM> file could live <EMCLASS="emphasis">only</EM> in the user's home directory and had to be called &amp;<CODECLASS="literal">.</CODE><EMCLASS="emphasis">forward</EM>.</P></BLOCKQUOTE><PCLASS="para">If a recipient address selects a delivery agent with the<CODECLASS="literal">F=w</CODE> flag set (see <ACLASS="xref"HREF="ch30_08.htm#SML2-CH-30-SECT-8-43"TITLE="">Section 30.8.43, F=w</A>),that address is considered the address of a localuser whose <EMCLASS="emphasis">~/.forward</EM> file can be processed.If it contains a backslash, <EMCLASS="emphasis">sendmail</EM>disallows further processing,and the message is handed to the <CODECLASS="literal">local</CODE>delivery agent's <CODECLASS="literal">P=</CODE> program for delivery to the mail-spoolingdirectory. If a backslash is absent, <EMCLASS="emphasis">sendmail</EM>tries to read that user's <EMCLASS="emphasis">~/.forward</EM> file.</P><PCLASS="para">If all the <EMCLASS="emphasis">.forward</EM> files listed in the <CODECLASS="literal">ForwardPath</CODE> (<CODECLASS="literal">J</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-27"TITLE="">Section 34.8.27</A>)cannot be read, their absenceis silently ignored. This is how <EMCLASS="emphasis">sendmail</EM> behaves when thosefiles don't exist. Users often choose not to have <EMCLASS="emphasis">~/.forward</EM>files. But problems may arise when users' home directories are remotelymounted. If the user's home directory is temporarily absent (as itwould be if an <SPANCLASS="acronym">NFS</SPAN> server is down),or if a user has no home directory, <EMCLASS="emphasis">sendmail</EM> <EMCLASS="emphasis">syslog</EM>(3)'sthe following error message and falls back to the other directoriesin its <CODECLASS="literal">ForwardPath</CODE> (<CODECLASS="literal">J</CODE>) option:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">forward: no home</PRE></BLOCKQUOTE></P><PCLASS="para">V8 <EMCLASS="emphasis">sendmail</EM> temporarily transforms itself into the user[7]before trying to read the <EMCLASS="emphasis">~/.forward</EM> file. This is doneso that reads will work across <SPANCLASS="acronym">NFS</SPAN>.If <EMCLASS="emphasis">sendmail</EM> cannot read the <EMCLASS="emphasis">~/.forward</EM> file (forany reason), it silently ignores that file.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[7] This is supported only under operating systems that properly support<EMCLASS="emphasis">seteuid</EM>(3) or <EMCLASS="emphasis">setreuid</EM>(3) (see <ACLASS="xref"HREF="ch18_08.htm#SML2-CH-18-SECT-8-55"TITLE="">Section 18.8.55, USESETEUID</A>).</P></BLOCKQUOTE><PCLASS="para">Before reading the <EMCLASS="emphasis">~/.forward</EM> file, <EMCLASS="emphasis">sendmail</EM> checksto see whether it is a &quot;safe&quot; file&nbsp;- one that is ownedby the user or <EMCLASS="emphasis">root</EM> and that has the read permission bit set for the owner.If the <EMCLASS="emphasis">~/.forward</EM> file is not safe, <EMCLASS="emphasis">sendmail</EM> silentlyignores it.</P><PCLASS="para">If <EMCLASS="emphasis">sendmail</EM> can find and read the <EMCLASS="emphasis">~/.forward</EM> fileand if that file is safe, <EMCLASS="emphasis">sendmail</EM> opens the file forreading and gathers a list of recipients from it.Internally, the <EMCLASS="emphasis">~/.forward</EM> file is exactly the same as a <CODECLASS="literal">:include:</CODE>file. Each line of text in it may contain one or more recipientaddresses. Recipient addresses may be email addresses, thenames of files onto which the message should be appended, the names ofprograms through which to pipe the message, or <CODECLASS="literal">:include:</CODE> files.</P><PCLASS="para">Beginning with V8 <EMCLASS="emphasis">sendmail</EM>, <EMCLASS="emphasis">~/.forward</EM> files may containcomments (lines that begin with a <CODECLASS="literal">#</CODE> character).Other versions of <EMCLASS="emphasis">sendmail</EM> treat comment linesas addresses and bounce mail that is seemingly addressed to <CODECLASS="literal">#</CODE>.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-25-SECT-7-1">25.7.1 Unscrambling Forwards</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-23985"></A>The traditional use of the <EMCLASS="emphasis">~/.forward</EM> file, as its name implies,is to forward mail to another site. Unfortunately, as users movefrom machine to machine, they can leave behind a series of<EMCLASS="emphasis">~/.forward</EM> files, each of which points to the next machine in a chain.As machine names change and as old machines are retired, thelinks in this chain can be broken.One common consequence is a bounced mail message (&quot;host unknown&quot;)with a dozen or so <CODECLASS="literal">Received:</CODE> (see <ACLASS="xref"HREF="ch35_10.htm#SML2-CH-35-SECT-10-25"TITLE="">Section 35.10.25, Received:</A>) header lines. </P><PCLASS="para">As the mail administrator, you should beware of the <EMCLASS="emphasis">~/.forward</EM>files of users at your site. If any contain offsite addresses,<ACLASS="indexterm"NAME="AUTOID-23994"></A>you should periodically use the SMTP <EMCLASS="emphasis">expn</EM> command[8]to examine them. For example, consider a local user whose<EMCLASS="emphasis">~/.forward</EM> contains the following line:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[8] Under old versions of <EMCLASS="emphasis">sendmail</EM> the <EMCLASS="emphasis">vrfy</EM> and <EMCLASS="emphasis">expn</EM>commands are interchangeable.Under V8 <EMCLASS="emphasis">sendmail</EM> and other, modern SMTP servers, the two commandsdiffer.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">user@remote.domain</PRE></BLOCKQUOTE></P><PCLASS="para">This causes all local mail for the user to be forwarded tothe host <CODECLASS="literal">remote.domain</CODE> for delivery there. The validityof that address can be checked with <EMCLASS="emphasis">telnet</EM>(1) at port 25[9]and the SMTP <CODECLASS="literal">expn</CODE> command:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[9] In place of specifying port 25, you can use either <EMCLASS="emphasis">mail</EM> or<EMCLASS="emphasis">smtp</EM>. These are more mnemonic and easier to remember (althoughwe &quot;oldtimers&quot; tend to still use 25).</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>telnet remote.domain 25</B></CODE>Trying 123.45.123.45 ...Connected to remote.domain.Escape character is '^]'.220 remote.domain Sendmail 8.6.13/8.6.12 ready at Tue, 7 May 1996 13:39:21 -0700220 ESMTP spoken here<CODECLASS="userinput"><B>expn user</B></CODE>250 &lt;user@another.site&gt;<CODECLASS="userinput"><B>quit</B></CODE>221 remote.domain closing connectionConnection closed by foreign host.%</PRE></BLOCKQUOTE></P><PCLASS="para">This shows that the user is known at <CODECLASS="literal">remote.site</CODE> butalso shows that mail will be forwarded (yet again) fromthere to <CODECLASS="literal">another.site</CODE>. By repeating this process,you will eventually find the site at which the user's mail willbe delivered.Depending on your site's policies, you can either correct theuser's <EMCLASS="emphasis">~/.forward</EM> file or have the user correct it.It should contain the address of the host where that user's mail willultimately be delivered.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-25-SECT-7-2">25.7.2 Forwarding Loops</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24026"></A><ACLASS="indexterm"NAME="AUTOID-24029"></A><ACLASS="indexterm"NAME="AUTOID-24032"></A><ACLASS="indexterm"NAME="AUTOID-24035"></A><ACLASS="indexterm"NAME="AUTOID-24038"></A>Because <EMCLASS="emphasis">~/.forward</EM> files are under user control, the administratoroccasionally needs to break loops caused by improper use of thosefiles. To illustrate, consider a user who wishes to have maildelivered on two different machines (call them machines A and B).On machine A the user creates a <EMCLASS="emphasis">~/.forward</EM> file like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">\user, user@B</PRE></BLOCKQUOTE></P><PCLASS="para">Then, on machine B the user creates this <EMCLASS="emphasis">~/.forward</EM> file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">\user, user@A</PRE></BLOCKQUOTE></P><PCLASS="para">The intention is that the backslashed name (<CODECLASS="literal">\user</CODE>) willcause local delivery and the second address in each will forwarda copy of the message to the other machine. Unfortunately, thiscauses mail to go back and forth between the two machines (deliveringand forwarding at each) until the mail is finally bounced withthe error message &quot;too many hops.&quot;</P><PCLASS="para">On the machine that the administrator controls, a fix to this loopingis to temporarily edit the <EMCLASS="emphasis">aliases</EM> database and insert analias for the offending user like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">user:  \user</PRE></BLOCKQUOTE></P><PCLASS="para">This causes mail for <CODECLASS="literal">user</CODE> to be delivered locally andthat user's <EMCLASS="emphasis">~/.forward</EM> file to be ignored. After the userhas corrected the offending <EMCLASS="emphasis">~/.forward</EM> files, this alias canbe removed.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-25-SECT-7-3">25.7.3 Appending to Files</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24062"></A><ACLASS="indexterm"NAME="AUTOID-24065"></A><ACLASS="indexterm"NAME="AUTOID-24069"></A>The <EMCLASS="emphasis">~/.forward</EM> file can contain the names offiles onto which mail is to be appended. Such filenames must beginwith a slash character that cannot be quoted. For example, if a userwishes to keep a backup copy of incoming mail:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">\user/home/user/mail/in.backup</PRE></BLOCKQUOTE></P><PCLASS="para">The first line (<CODECLASS="literal">\user</CODE>) tells <EMCLASS="emphasis">sendmail</EM> to deliverdirectly to the user's mail spool file using the <CODECLASS="literal">local</CODE>delivery agent. The second line tells <EMCLASS="emphasis">sendmail</EM> to appenda copy of the mail message to the file specified (<CODECLASS="literal">in.backup</CODE>).</P><PCLASS="para">Note that, prior to V8, <EMCLASS="emphasis">sendmail</EM> did no file locking, so writing files by wayof the <EMCLASS="emphasis">~/.forward</EM>file was not recommended. Beginning with V8, however, <EMCLASS="emphasis">sendmail</EM>locks those files during writing, so such use of the <EMCLASS="emphasis">~/.forward</EM>file is now okay.</P><PCLASS="para">If the <CODECLASS="literal">SafeFileEnvironment</CODE> option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-58"TITLE="">Section 34.8.58, SafeFileEnvironment</A>)is set, the user should be advised to specify the pathof that safe directory:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">\user/arch/bob.backup          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> here /arch was specified by the SafeFileEnvironment option</I></PRE></BLOCKQUOTE></P><PCLASS="para">When the <CODECLASS="literal">SafeFileEnvironment</CODE> option is used, the cooperation of the system administrationmay be needed if users are to have the capability of savingmail to files via the <EMCLASS="emphasis">~/.forward</EM> file.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-25-SECT-7-4">25.7.4 Piping Through Programs</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24097"></A><ACLASS="indexterm"NAME="AUTOID-24100"></A><ACLASS="indexterm"NAME="AUTOID-24103"></A><ACLASS="indexterm"NAME="AUTOID-24106"></A>The <EMCLASS="emphasis">~/.forward</EM> file can contain the names of programsto run. A program name is indicated by a leading pipe (<CODECLASS="literal">|</CODE>)character, which may or may not be quoted (see <ACLASS="xref"HREF="ch24_02.htm#SML2-CH-24-SECT-2-3"TITLE="Delivery via Programs">Section 24.2.3, "Delivery via Programs"</A>).For example, a usermay be away on a trip and want mail to be handled by the <EMCLASS="emphasis">vacation</EM>(1)program:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">\user, &quot;|/usr/ucb/vacation user&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;Recall that prefixing a local address with a backslash tells <EMCLASS="emphasis">sendmail</EM>to skip additional alias transformations. For <CODECLASS="literal">\user</CODE> thiscauses <EMCLASS="emphasis">sendmail</EM> to deliver the message (via the <CODECLASS="literal">local</CODE>delivery agent) directly to the user's spool mail box.</P><PCLASS="para">The quotes around the <EMCLASS="emphasis">vacation</EM> program are necessary to preventthe program and its single argument (<CODECLASS="literal">user</CODE>) from beingviewed as two separate addresses. The <EMCLASS="emphasis">vacation</EM> programis run with the command-line argument <CODECLASS="literal">user</CODE>, and themail message is given to it via its standard input.</P><PCLASS="para">Beginning with V8 <EMCLASS="emphasis">sendmail</EM>, a user must have a valid shellto run programs from the <EMCLASS="emphasis">~/.forward</EM> file. See<ACLASS="xref"HREF="ch18_08.htm#SML2-CH-18-SECT-8-34"TITLE="">Section 18.8.34, PATH...</A> for a description of this process andfor methods to circumvent it at the system level.</P><PCLASS="para">Because <EMCLASS="emphasis">sendmail</EM> sorts all addresses and deletes duplicatesbefore delivering to any of them, it is important that programs in<EMCLASS="emphasis">~/.forward</EM> files be unique. Consider aprogram that doesn't take an argument and suppose that two usersboth specified that program in their <EMCLASS="emphasis">~/.forward</EM> files:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><EMCLASS="emphasis">user 1 <IMGSRC="../chars/rarr.gif"ALT="-&gt;">  \user1, &quot;|/bin/notify&quot;</EM><EMCLASS="emphasis">user 2 <IMGSRC="../chars/rarr.gif"ALT="-&gt;">  \user2, &quot;|/bin/notify&quot;</EM></PRE></BLOCKQUOTE></P><PCLASS="para">Prior to V8 <EMCLASS="emphasis">sendmail</EM>, when mail was sent to both <CODECLASS="literal">user1</CODE> and <CODECLASS="literal">user2</CODE>, theaddress <CODECLASS="literal">/bin/notify</CODE> appeared twice inthe list of addresses. The <EMCLASS="emphasis">sendmail</EM> programeliminated what seems to be a duplicate,[10]and one of the two users did not have the program run.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[10] V8 <EMCLASS="emphasis">sendmail</EM> uses the owner of the <EMCLASS="emphasis">~/.forward</EM>file in addition to the program name when comparing.</P></BLOCKQUOTE><PCLASS="para">If a program <EMCLASS="emphasis">requires</EM> no arguments(as opposed to ignoring them), the <EMCLASS="emphasis">~/.forward</EM> programspecifications can be made unique by including a shell comment:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><EMCLASS="emphasis">user 1 <IMGSRC="../chars/rarr.gif"ALT="-&gt;">  \user1, &quot;|/bin/notify #user1&quot;</EM><EMCLASS="emphasis">user 2 <IMGSRC="../chars/rarr.gif"ALT="-&gt;">  \user2, &quot;|/bin/notify #user2&quot;</EM></PRE></BLOCKQUOTE></P><PCLASS="para"></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-25-SECT-7-5">25.7.5 Specialty Programs for Use with ~/.forward</A></H3><PCLASS="para">Rather than expecting users to write home-grown programs for use in<EMCLASS="emphasis">~/.forward</EM> files, offer them any orall of the publicly available alternatives. The most common are listed below.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-25-SECT-7-5-1">25.7.5.1 The deliver program</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24162"></A>The <EMCLASS="emphasis">deliver</EM>(1) program, by Chip Salzenberg, is specifically designed tohandle all types of final delivery for users. It is intendedfor use in the <EMCLASS="emphasis">~/.forward</EM> file but also functionsas a <CODECLASS="literal">local</CODE> delivery agent. The <EMCLASS="emphasis">deliver</EM> programsupports a large number of command-line options and can reliablyhandle delivery to files and through programs. It is typicallyused in the <EMCLASS="emphasis">~/.forward</EM> file like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"> &quot;|/usr/local/bin/deliver user&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">The <EMCLASS="emphasis">deliver</EM> program is available via anonymous <SPANCLASS="acronym">FTP</SPAN>from many archive sites.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-25-SECT-7-5-2">25.7.5.2 The procmail program</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24177"></A>The <EMCLASS="emphasis">procmail</EM>(1) program, by Stephen R. van den Berg, is purported to be the mostreliable of the delivery programs. It can sort incoming mailinto separate folders and files, run programs, preprocess mail (filteringout unwanted mail), and selectively forward mail elsewhere.It can function as a substitute for the <CODECLASS="literal">local</CODE> delivery agentor handle mail delivery for the individual user.The <EMCLASS="emphasis">procmail</EM> program is typically used in the <EMCLASS="emphasis">~/.forward</EM> filelike this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"> &quot;|exec /usr/local/bin/procmail #user&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">Note that <EMCLASS="emphasis">procmail</EM> does not accept a username as a command-line argument.Because of this, a dummy shell comment is needed for pre-V8versions of <EMCLASS="emphasis">sendmail</EM> to make the address unique.The <EMCLASS="emphasis">procmail</EM> program is available via anonymous <SPANCLASS="acronym">FTP</SPAN>from many archive sites.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-25-SECT-7-5-3">25.7.5.3 The slocal program</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24193"></A>The <EMCLASS="emphasis">slocal</EM> program, distributed with the <EMCLASS="emphasis">mh</EM> distribution,is useful for sorting incoming mail intoseparate files and folders. It can be used with both <SPANCLASS="acronym">UNIX</SPAN>-stylemail files and with <EMCLASS="emphasis">mh</EM>-style mail directory folders.It is typically used in the <EMCLASS="emphasis">~/.forward</EM> file like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"> &quot;| /usr/local/lib/mh/slocal -user user&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">The disposition of mail is controlled using a companion filecalled <EMCLASS="emphasis">~/.maildelivery</EM>.</P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-25-SECT-7-6">25.7.6 Force Requeue on Error</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24207"></A><ACLASS="indexterm"NAME="AUTOID-24210"></A>Normally, a program in the user's <EMCLASS="emphasis">~/.forward</EM> file is executedwith the Bourne shell. The precise means that is used is defined by the<CODECLASS="literal">prog</CODE> delivery agent.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Mprog, P=/bin/sh,   F=lsDFMeuP,  S=10, R=20, A=sh -c $u                                                 <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                                              <ICLASS="lineannotation">The Bourne shell</I></PRE></BLOCKQUOTE></P><PCLASS="para">One drawback to using the Bourne shell to run programsis that it exits with a value of 1 when the program cannot be executed.When <EMCLASS="emphasis">sendmail</EM> sees the exit value 1, it bounces the mail message.</P><PCLASS="para">&#13;There will be times when bouncing a mail message because the programcould not execute is not desirable. For example, consider thefollowing <EMCLASS="emphasis">~/.forward</EM> file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"> &quot;| /usr/local/lib/slocal -user george&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">If the directory <EMCLASS="emphasis">/usr/local/lib</EM> is unavailable (perhaps becausea file server is down or because an automounter failed), the mail messageshould be queued, rather than bounced. To arrange for requeueingof the message on failure, users should be encouraged to constructtheir <EMCLASS="emphasis">~/.forward</EM> files like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"> &quot;| /usr/local/lib/slocal -user george || exit 75&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">Here, the <CODECLASS="literal">||</CODE> tells the Bourne shell to perform what follows(the <CODECLASS="literal">exit 75</CODE>) if the preceding program could not be executed orif the program exited because of an error.The exit value 75 is special, in that it tells <EMCLASS="emphasis">sendmail</EM> toqueue the message for later delivery, rather than to bounce it.<ACLASS="indexterm"NAME="AUTOID-24234"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch25_06.htm"TITLE="25.6 Packages That Help"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 25.6 Packages That Help"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch25_08.htm"TITLE="25.8 Pitfalls"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 25.8 Pitfalls"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">25.6 Packages That Help</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">25.8 Pitfalls</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>