<HTML><HEAD><TITLE>[Chapter 26] Logging and Statistics</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:40:01Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part03.htm"TITLE="III. Administration"><LINKREL="prev"HREF="ch25_08.htm"TITLE="25.8 Pitfalls"><LINKREL="next"HREF="ch26_02.htm"TITLE="26.2 Statistics"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch25_08.htm"TITLE="25.8 Pitfalls"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 25.8 Pitfalls"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 26</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch26_02.htm"TITLE="26.2 Statistics"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 26.2 Statistics"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="SML2-CH-26">26. Logging and Statistics</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#SML2-CH-26-SECT-1"TITLE="26.1 Logging with syslog">Logging with syslog</A><BR><ACLASS="sect1"HREF="ch26_02.htm"TITLE="26.2 Statistics">Statistics</A><BR><ACLASS="sect1"HREF="ch26_03.htm"TITLE="26.3 Signaling the Daemon">Signaling the Daemon</A><BR><ACLASS="sect1"HREF="ch26_04.htm"TITLE="26.4 Log Transactions with -X">Log Transactions with -X</A><BR><ACLASS="sect1"HREF="ch26_05.htm"TITLE="26.5 Pitfalls">Pitfalls</A></P><P></P></DIV><PCLASS="para"></P><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> program can keep the system administratorup-to-date about many aspects of mail delivery and forwarding. It does thisby logging its activities using the <EMCLASS="emphasis">syslog</EM>(3) facility.It can also gather (or aid in gathering)statistics about what it is doing. Information about thingslike total message volume and site connectivity, for example, can help theadministrator to make <EMCLASS="emphasis">sendmail</EM> more efficient.Information about the SMTP dialog that was used to send the messagecan help the administrator to solve delivery problems.</P><PCLASS="para">In this chapter we cover these three important aspects of <EMCLASS="emphasis">sendmail</EM>.First, we explain the use of the <EMCLASS="emphasis">syslog</EM>(3) facility andillustrate several ways to tune its logging. Second,we show the built-in means that <EMCLASS="emphasis">sendmail</EM> has for recordingstatistics and other information and how scripts can be used to extend that information.Third, we explore ways to tune the performance of <EMCLASS="emphasis">sendmail</EM>.&#13;</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-26-SECT-1">26.1 Logging with syslog</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-26-IX-LOGGING"></A><ACLASS="indexterm"NAME="AUTOID-24304"></A><ACLASS="indexterm"NAME="AUTOID-24307"></A><ACLASS="indexterm"NAME="AUTOID-24310"></A>Logging is the process of issuing one-line warnings that willbe either displayed to a human, archived toa file, or both. The mechanism that <EMCLASS="emphasis">sendmail</EM> usesto produce these warnings is called <EMCLASS="emphasis">syslog</EM>(3). The <EMCLASS="emphasis">sendmail</EM>program is concerned only with issuing its warnings.Once they are issued, the <EMCLASS="emphasis">syslog</EM> facility takes overand disposes of them in a manner described inthe file <EMCLASS="emphasis">/etc/syslog.conf</EM>. Statements in this file determinewhether a warning is written to a device (such as <EMCLASS="emphasis">/dev/console</EM>),appended to a file, forwarded to another host, or displayed ona logged-in user's screen.</P><PCLASS="para">In the following discussion of <EMCLASS="emphasis">syslog</EM> and <EMCLASS="emphasis">syslog.conf</EM>,we will describe the BSD 4.4 version. Some versions of UNIX, such asUltrix, use the 4.2 version of <EMCLASS="emphasis">syslog</EM>, but because <EMCLASS="emphasis">syslog</EM>is public domain, we recommend upgrading and will not cover that old version here.&#13;</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-26-SECT-1-1">26.1.1 syslog(3)</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-26-IX-LOGGING-SYSLOG-UTILITY"></A><ACLASS="indexterm"NAME="AUTOID-24331"></A><ACLASS="indexterm"NAME="AUTOID-24333"></A><ACLASS="indexterm"NAME="AUTOID-24336"></A><ACLASS="indexterm"NAME="AUTOID-24339"></A>The <EMCLASS="emphasis">syslog</EM>(3) facility uses two items of information indetermining how to handle messages: <EMCLASS="emphasis">facility</EM> and <EMCLASS="emphasis">level</EM>.The facility is the category of program issuing a message.The <EMCLASS="emphasis">syslog</EM> facility can handle many categories, butonly one, <CODECLASS="literal">mail</CODE>, is used by <EMCLASS="emphasis">sendmail</EM>.The level is the degree of severity of the warnings.The <EMCLASS="emphasis">sendmail</EM> program issuesmessages with <EMCLASS="emphasis">syslog</EM>(3) at various levels depending on how seriousthe warning is.</P><PCLASS="para">When <EMCLASS="emphasis">sendmail</EM> first starts to run, it opens its connection tothe <EMCLASS="emphasis">syslog</EM> facility with the following C language line:<ACLASS="indexterm"NAME="AUTOID-24352"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">openlog(&quot;sendmail&quot;, LOG_PID, LOG_MAIL);</PRE></BLOCKQUOTE></P><PCLASS="para">This tells <EMCLASS="emphasis">syslog</EM> three things: </P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">All messages shouldbe printed using <CODECLASS="literal">sendmail</CODE> as the name of theprogram doing the logging. This means that no matter what name isused to run <EMCLASS="emphasis">sendmail</EM> (such as <EMCLASS="emphasis">newaliases</EM> or <EMCLASS="emphasis">smtpd</EM>),the name that is logged will always be <CODECLASS="literal">sendmail</CODE>.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24368"></A><ACLASS="indexterm"NAME="AUTOID-24371"></A>The LOG_PID tells <EMCLASS="emphasis">syslog</EM> that the PID (process identificationnumber) should be included when each message is written. This is necessarybecause <EMCLASS="emphasis">sendmail</EM> forks often, and each parent and child will havea different PID. Because queue file identifiers are constructed fromPIDs, this record helps to determine which invocation of <EMCLASS="emphasis">sendmail</EM>created a particular queued file. The PID also allows messages fromthe daemon form of <EMCLASS="emphasis">sendmail</EM> to be differentiated from others.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24379"></A>The facility for <EMCLASS="emphasis">sendmail</EM> (and all mail-handlingprograms) is LOG_MAIL. We'll show why this is importantwhen we discuss the <EMCLASS="emphasis">syslog.conf</EM> file.</P></LI></UL><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24385"></A>Just before <EMCLASS="emphasis">sendmail</EM> issues a warning,it looks at the logging level defined by its <CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-33"TITLE="">Section 34.8.33, LogLevel (L)</A>).If the severity of the warning is greater than the logging level,nothing is output.If the severity of the warning that it intends to issue is less than or equal tothe logging level (lower is more serious),it issues that warning with a C language call like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">syslog(<CODECLASS="replaceable"><I>pri, msg</I></CODE>);</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24395"></A>Here, <CODECLASS="replaceable"><I>pri</I></CODE> is the <EMCLASS="emphasis">syslog</EM> logging priority, and <CODECLASS="replaceable"><I>msg</I></CODE>is the text of the warning message. Note thatthe <CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-33"TITLE="">Section 34.8.33</A>) level is different than the <EMCLASS="emphasis">syslog</EM> priority.The former is used internally by <EMCLASS="emphasis">sendmail</EM> to decidewhether it should log a message. The latter is used by <EMCLASS="emphasis">syslog</EM>to determine how it will dispose of the message (if it gets one).</P><PCLASS="para">The <CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>) option sets a threshold at and belowwhich <EMCLASS="emphasis">sendmail</EM> will issue warnings. When the<CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>) option has azero value, nothing is ever issued. When the<CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>) option has a lowvalue, only critical warnings are issued. At higher values,less critical messages are also issued.</P><PCLASS="para">The syntax of the <CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>) option and the kinds of informationissued for each level are explained in <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-33"TITLE="">Section 34.8.33</A>.For each level, all the information produced at lower levels is alsoissued. That is, setting the <CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>) optionto 9 causes messagesfor levels 1 through 8 also to be issued.</P><PCLASS="para">The relationship between the <CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>)option logging levels and<EMCLASS="emphasis">syslog</EM> priorities is shown in<ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-TAB-0"TITLE="L Levels Versus syslog Priorities">Table 26.1</A>.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="SML2-CH-26-TAB-0">Table 26.1: L Levels Versus syslog Priorities</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Level</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Priority</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">1</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">LOG_CRIT and LOG_ALERT</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">2-8</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">LOG_NOTICE</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">9-10</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">LOG_INFO</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">11+</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">LOG_DEBUG</TD></TR></TBODY></TABLE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24447"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-26-SECT-1-2">26.1.2 Tuning syslog.conf</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24451"></A><ACLASS="indexterm"NAME="AUTOID-24454"></A><ACLASS="indexterm"NAME="AUTOID-24456"></A>Although all messages are emitted by <EMCLASS="emphasis">sendmail</EM> using a singlefacility, that of <EMCLASS="emphasis">syslog</EM>, they need not all arrive at thesame place. The disposition of messages is tuned by the <EMCLASS="emphasis">syslog.conf</EM>file.</P><PCLASS="para">The file <EMCLASS="emphasis">syslog.conf</EM> (usually located in the <EMCLASS="emphasis">/etc</EM> directory)contains routing commands for use by <EMCLASS="emphasis">syslog</EM>.That file can be complex, because it is designed to handle messagesfrom many programs other than <EMCLASS="emphasis">sendmail</EM>, even messages fromthe kernel itself. Under SunOS the <EMCLASS="emphasis">syslog.conf</EM> fileis also complex because it ispreprocessed by <EMCLASS="emphasis">m4</EM>(1) when it is read by <EMCLASS="emphasis">syslog</EM>.</P><PCLASS="para">The file <EMCLASS="emphasis">syslog.conf</EM> is composed of lines of text thateach have the form:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">facility.level           target</PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">facility</CODE> is the type of program that may be producinga message.The <CODECLASS="literal">facility</CODE> called <CODECLASS="literal">mail</CODE> is the one that <EMCLASS="emphasis">sendmail</EM> uses.For the complete list, see the online manual for <EMCLASS="emphasis">syslog.conf</EM>(5).</P><PCLASS="para">The <CODECLASS="literal">level</CODE> indicates the severity at or above which messagesshould be handled. These levels correspond to the <CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>)option levels shown in<ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-TAB-0"TITLE="L Levels Versus syslog Priorities">Table 26.1</A> of <ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-1"TITLE="syslog(3)">Section 26.1.1, "syslog(3)"</A>. The complete list of <EMCLASS="emphasis">syslog.conf</EM> levels used by <EMCLASS="emphasis">sendmail</EM> is shown in<ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-TAB-1"TITLE="syslog.conf Levels Used by sendmail">Table 26.2</A>.<ACLASS="indexterm"NAME="AUTOID-24488"></A><ACLASS="indexterm"NAME="AUTOID-24491"></A><ACLASS="indexterm"NAME="AUTOID-24494"></A></P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="SML2-CH-26-TAB-1">Table 26.2: syslog.conf Levels Used by sendmail</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Level</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Meaning of Severity (Highest to Lowest)</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">alert</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Conditions requiring immediate correction</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">crit</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Critical conditions for which action may be deferred</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">err</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Other errors</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">warning</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Warning messages</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">notice</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Nonerrors that may require special handling</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">info</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Statistical and informational messages</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">debug</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Messages used only in debugging a program</TD></TR></TBODY></TABLE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24533"></A>The <CODECLASS="literal">target</CODE> is one of the four possibilities shown in <ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-TAB-2"TITLE="syslog.conf Targets">Table 26.3</A>.It is the <CODECLASS="literal">target</CODE> and the preceding<CODECLASS="literal">level</CODE> that must be tuned for use by <EMCLASS="emphasis">sendmail</EM>.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="SML2-CH-26-TAB-2">Table 26.3: syslog.conf Targets</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Target</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Description</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">@<EMCLASS="emphasis">host</EM></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Forward message to named <EMCLASS="emphasis">host</EM></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">/<EMCLASS="emphasis">file</EM></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Append message to named <EMCLASS="emphasis">file</EM></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><EMCLASS="emphasis">user</EM>,<EMCLASS="emphasis">user</EM>,...</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Write to users' screens, if logged in</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Write to all logged-in users' screens</TD></TR></TBODY></TABLE><PCLASS="para">For example, the following <EMCLASS="emphasis">syslog.conf</EM> line causes messages from&quot;mail&quot; (the <CODECLASS="literal">facility</CODE>) that are at or above severity &quot;info&quot;(the <CODECLASS="literal">level</CODE>) to be appended to the file<EMCLASS="emphasis">/var/log/syslog</EM> (the <CODECLASS="literal">target</CODE>):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">  <ICLASS="lineannotation">facility</I>                  <ICLASS="lineannotation">target</I>  <ICLASS="lineannotation"><IMGSRC="../chars/darr.gif"ALT="-v"></I>                      <ICLASS="lineannotation"><IMGSRC="../chars/darr.gif"ALT="-v"></I>mail.info                /var/log/syslog      <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>      <ICLASS="lineannotation">level</I></PRE></BLOCKQUOTE></P><PCLASS="para">A typical (albeit much simplified) <EMCLASS="emphasis">/etc/syslog.conf</EM> file might look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">*.err;kern.debug;user.none          /dev/console*.err;kern.debug;user.none          /var/adm/messagesauth.notice                         @authhostmail.info                           /var/log/syslog*.emerg;user.none                   *</PRE></BLOCKQUOTE></P><PCLASS="para">Notice that there may be multiple <CODECLASS="literal">facility.level</CODE> pairson the left, each separated from the others by semicolons. The firsttwo lines handle messages for all facilities at level <CODECLASS="literal">err</CODE>,all kernel messages (<CODECLASS="literal">kern</CODE>) at level <CODECLASS="literal">debug</CODE> andabove, and none of the levels (<CODECLASS="literal">none</CODE>) for thefacility <CODECLASS="literal">user</CODE>. The first line sends those messages tothe file <CODECLASS="literal">/dev/console</CODE>, the computer's screen. The secondappends its messages to the file <CODECLASS="literal">/var/adm/messages</CODE>.</P><PCLASS="para">The third line sends authorization messages (such as repeated login failures)to the host named <CODECLASS="literal">authhost</CODE>.</P><PCLASS="para">The fourth line appends all messages printed by <EMCLASS="emphasis">sendmail</EM> atlevel <CODECLASS="literal">info</CODE> and above (the <CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>) optionis level 10 and below)to the file <CODECLASS="literal">/var/log/syslog</CODE>.</P><PCLASS="para">The last line is an emergency broadcast facility. A messageto any facility (theleftmost <CODECLASS="literal">*</CODE>) at the highest level (<CODECLASS="literal">emerg</CODE>), exceptfor the facility <CODECLASS="literal">user</CODE> (the <CODECLASS="literal">.none</CODE>), will be written to the screen of all currently logged-in users (the target<CODECLASS="literal">*</CODE>).</P><PCLASS="para">Finally, note that facilities may be listed together byusing a comma:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">mail,daemon.info</PRE></BLOCKQUOTE></P><PCLASS="para">This causes the level <CODECLASS="literal">info</CODE> to be the level for boththe facilities <CODECLASS="literal">mail</CODE> and <CODECLASS="literal">daemon</CODE>. Only the facilitymay be listed this way. The level may not, and (unfortunately)the target may not.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3">26.1.3 syslog's Output</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-26-IX-OUTPUT-SYSLOG"></A>When the <CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>) option levelis 9 or above (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-33"TITLE="">Section 34.8.33</A>), <EMCLASS="emphasis">sendmail</EM> logs one line of information for eachenvelope sender and one line of information for each recipient delivery ordeferral. As <EMCLASS="emphasis">sendmail</EM> has evolved, these lines of logging informationhave grown more complex. Here, we discuss the lines produced by<EMCLASS="emphasis">sendmail</EM> 8.8.4.</P><PCLASS="para">Each line of information logged looks something like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="replaceable"><I>date host </I></CODE>sendmail[<CODECLASS="replaceable"><I>pid</I></CODE>]: <CODECLASS="replaceable"><I>qid</I></CODE>: <CODECLASS="replaceable"><I>what=value</I></CODE>, ...</PRE></BLOCKQUOTE></P><PCLASS="para">Each line of output that <EMCLASS="emphasis">syslog</EM> produces begins with five piecesof information. The <CODECLASS="replaceable"><I>date</I></CODE> is the month, day, and time that theline of information was logged (note that the year is absent).The <CODECLASS="replaceable"><I>host</I></CODE> is the name of the host that produced this information(note that this may differ from the name of the host on which thelog files are kept).The <CODECLASS="literal">sendmail</CODE> is literal. Because of the LOG_PID argument that is givento <EMCLASS="emphasis">openlog</EM>(3) by <EMCLASS="emphasis">sendmail</EM> (see <ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-1"TITLE="syslog(3)">Section 26.1.1</A>),the process ID of the invocation of <EMCLASS="emphasis">sendmail</EM> that producedthis information is included in square brackets.Finally, each line includes the <CODECLASS="replaceable"><I>qid</I></CODE> queue identifier(see <ACLASS="xref"HREF="ch23_02.htm#SML2-CH-23-SECT-2-1"TITLE="The Queue Identifier">Section 23.2.1, "The Queue Identifier"</A>) that uniquely identifies each message ona given host.</P><PCLASS="para">This initial information is followed by a comma-separated list of <CODECLASS="replaceable"><I>what=value</I></CODE> equates.Which equate appears in which line depends on whether the line documentsthe sender or the recipient and whether deliver succeed, failed, or wasdeferred. In<ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-TAB-3"TITLE="what= in syslog Output Lines">Table 26.4</A>we list the possibilities in alphabetical order. Then, in the sectionsthat follow, we describe the role that each plays.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="SML2-CH-26-TAB-3">Table 26.4: what= in syslog Output Lines</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">what=</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Description</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">class=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-1"TITLE="class= the queue class">Section 26.1.3.1, "class= the queue class"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The queue class</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">delay=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-2"TITLE="delay= total time to deliver">Section 26.1.3.2, "delay= total time to deliver"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Total time to deliver</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">from=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-3"TITLE="from= show envelope sender">Section 26.1.3.3, "from= show envelope sender"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Show envelope sender</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">mailer=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-4"TITLE="mailer= the delivery agent used">Section 26.1.3.4, "mailer= the delivery agent used"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The delivery agent used</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">msgid=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-5"TITLE="msgid= the Message-ID: identifier">Section 26.1.3.5, "msgid= the Message-ID: identifier"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The Message-ID: identifier</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">nrcpts=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-6"TITLE="nrcpts= the number of recipients">Section 26.1.3.6, "nrcpts= the number of recipients"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The number of recipients</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">pri=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-7"TITLE="pri= the initial priority">Section 26.1.3.7, "pri= the initial priority"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The initial priority</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">proto=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-8"TITLE="proto= the protocol used in transmission">Section 26.1.3.8, "proto= the protocol used in transmission"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The protocol used in transmission</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">relay=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-9"TITLE="relay= the host that sent or accepted the message">Section 26.1.3.9, "relay= the host that sent or accepted the message"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The host that sent or accepted the message</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">size=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-10"TITLE="size= the size of the message">Section 26.1.3.10, "size= the size of the message"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The size of the message</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">stat=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-11"TITLE="stat= status of delivery">Section 26.1.3.11, "stat= status of delivery"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Status of delivery</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">to=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-12"TITLE="to= show final recipient">Section 26.1.3.12, "to= show final recipient"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The final recipient</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">xdelay=</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch26_01.htm#SML2-CH-26-SECT-1-3-13"TITLE="xdelay= transaction">Section 26.1.3.13, "xdelay= transaction"</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Transaction delay for this address only</TD></TR></TBODY></TABLE><PCLASS="para"></P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-1">26.1.3.1 class= the queue class</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24739"></A><ACLASS="indexterm"NAME="AUTOID-24741"></A>If the mail message contained a <CODECLASS="literal">Precedence:</CODE> header(see <ACLASS="xref"HREF="ch35_08.htm"TITLE="Precedence">Section 35.8, "Precedence"</A>), the <CODECLASS="literal">class=</CODE>reflects <EMCLASS="emphasis">sendmail</EM>'s interpretation of the keywordthat follows that header. For example, given the configuration command</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">PPlist=-30</PRE></BLOCKQUOTE></P><PCLASS="para">The following header will yield a <CODECLASS="literal">class=</CODE> value of <CODECLASS="literal">-30</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Precedence: list</PRE></BLOCKQUOTE></P><PCLASS="para">If no <CODECLASS="literal">Precedence:</CODE> header is present in the message, the value shown for<CODECLASS="literal">class=</CODE> is zero.The <CODECLASS="literal">class=</CODE> is shown only for sender records.&#13;</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-2">26.1.3.2 delay= total time to deliver</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24761"></A><ACLASS="indexterm"NAME="AUTOID-24763"></A><ACLASS="indexterm"NAME="AUTOID-24766"></A>A mail message can be delivered immediately, without ever havingbeen queued, or it can be queued and retried over and overagain until it either times out or succeeds.The <CODECLASS="literal">delay=</CODE> shows the total amount of time the messagetook to be delivered. This period of time starts when <EMCLASS="emphasis">sendmail</EM>first receives the message and ends when the message is finallydelivered or bounced. This interval is displayed with the<CODECLASS="literal">delay=</CODE> <EMCLASS="emphasis">syslog</EM> line equate:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">delay=<CODECLASS="replaceable"><I>days+</I></CODE>HH:MM:SS</PRE></BLOCKQUOTE></P><PCLASS="para">The time expression shows the time it took in hours (<CODECLASS="literal">HH</CODE>), minutes (<CODECLASS="literal">MM</CODE>),and seconds (<CODECLASS="literal">SS</CODE>) to handle delivery or rejection of the message.If the delay exceeds 24 hours, the time expression is prefixed with the numberof days and a plus character.For example, the following message took 5 seconds to deliver or bounce:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">delay=00:00:05</PRE></BLOCKQUOTE></P><PCLASS="para">The following message took 4 days, 2 hours, 16 minutes, and 2 seconds to deliver or bounce:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">delay=4+02:16:02</PRE></BLOCKQUOTE></P><PCLASS="para">Note that the <CODECLASS="literal">delay=</CODE> equate is shown only for recipient records.&#13;</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-3">26.1.3.3 from= show envelope sender</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24790"></A><ACLASS="indexterm"NAME="AUTOID-24792"></A><ACLASS="indexterm"NAME="AUTOID-24795"></A>The envelope sender may or may notappear in any of the sender headers.The <CODECLASS="literal">from=</CODE> <EMCLASS="emphasis">syslog</EM> line equate shows the envelope sender:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">from=<CODECLASS="replaceable"><I>addr</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="replaceable"><I>addr</I></CODE> is the address of the envelope sender with anyRFC822 commentary (see <ACLASS="xref"HREF="ch35_03.htm#SML2-CH-35-SECT-3-4"TITLE="Comments in the Header Field">Section 35.3.4, "Comments in the Header Field"</A>) removed. This will usually be the address of an actual person, but it canalso be <CODECLASS="literal">postmaster</CODE> or the value of the <CODECLASS="literal">$n</CODE> macroin the case of a bounced message.The <CODECLASS="literal">from=</CODE> equate is shown only for sender records.&#13;</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-4">26.1.3.4 mailer= the delivery agent used</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24812"></A><ACLASS="indexterm"NAME="AUTOID-24814"></A>The <EMCLASS="emphasis">sendmail</EM> program does not perform the actual delivery of mail. Instead, it calls other programs (called mail delivery agents) to performthat service.The <CODECLASS="literal">mailer=</CODE> equate shows the symbolic name (see <ACLASS="xref"HREF="ch30_01.htm#SML2-CH-30-SECT-1"TITLE="Configuration File Syntax">Section 30.1, "Configuration File Syntax"</A>)of the delivery agent that was used to perform delivery to the recipient&quot;</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">mailer=<CODECLASS="replaceable"><I>agent</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">A list of symbolic names assigned to delivery agents can be viewedwith the <CODECLASS="literal">-d0.15</CODE> debugging switch (see <ACLASS="xref"HREF="ch37_05.htm#SML2-CH-37-SECT-5-4"TITLE="">Section 37.5.4, -d0.15</A>).The <CODECLASS="literal">mailer=</CODE> equate is shown only for recipient records.&#13;</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-5">26.1.3.5 msgid= the Message-ID: identifier</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24830"></A><ACLASS="indexterm"NAME="AUTOID-24832"></A><ACLASS="indexterm"NAME="AUTOID-24834"></A><ACLASS="indexterm"NAME="AUTOID-24837"></A>RFC822 requires that each email message have a unique worldwideidentifier associated with it. That identifier is listed withthe <CODECLASS="literal">Message-ID:</CODE> header (see <ACLASS="xref"HREF="ch35_10.htm#SML2-CH-35-SECT-10-19"TITLE="">Section 35.10.19, Message-ID:</A>)and often looks something like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Message-Id: &lt;199605051122.VAA07923@here.us.edu&gt;</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;The information inside, and including,the angle brackets is the message identifier.That identifier is what is listed with the <CODECLASS="literal">msgid=</CODE> equate:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">msgid=&lt;199605051122.VAA07923@here.us.edu&gt;</PRE></BLOCKQUOTE></P><PCLASS="para">If a mail message arrives without a <CODECLASS="literal">Message-ID:</CODE> header, andif your configuration file correctly includes a definition forthat header, a new identifier will be created and listed with<CODECLASS="literal">msgid=</CODE>. If a <CODECLASS="literal">Message-ID:</CODE> header is absent, and ifyour configuration file incorrectly excludes a definition forthat header, the <CODECLASS="literal">msgid=</CODE> equate will be excluded fromthe <EMCLASS="emphasis">syslog</EM> report.</P><PCLASS="para">The <CODECLASS="literal">msgid=</CODE> equate is shown only for sender records.&#13;</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-6">26.1.3.6 nrcpts= the number of recipients</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24859"></A><ACLASS="indexterm"NAME="AUTOID-24862"></A>The <CODECLASS="literal">nrcpts=</CODE> equate shows the number of recipients<EMCLASS="emphasis">after</EM> all aliasing has been performed. If theoriginal message was addressed to <EMCLASS="emphasis">root</EM>,  if <EMCLASS="emphasis">root</EM>was aliased like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">root: bob, hans</PRE></BLOCKQUOTE></P><PCLASS="para">and if <EMCLASS="emphasis">bob</EM>'s <EMCLASS="emphasis">~/.forward</EM> file contained this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">\bob|&quot;/usr/ucb/vacation bob&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">then the <CODECLASS="literal">nrcpts=</CODE> equate would show three recipients.</P><PCLASS="para">Note that <CODECLASS="literal">nrcpts=</CODE> is included only with the sender recordand that record is emitted when the message is first processed.Any later changes in aliasing that may happen while the messageis queued are not reported. Aliasing on remote machines (as would be the case with exploder mailing lists)is also not reported for obvious reasons.&#13;</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-7">26.1.3.7 pri= the initial priority</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24882"></A><ACLASS="indexterm"NAME="AUTOID-24884"></A>The <CODECLASS="literal">pri=</CODE> equate shows the initial priority assigned tothe message (see <ACLASS="xref"HREF="ch35_08.htm"TITLE="Precedence">Section 35.8</A>).This value is calculated once when the message is first processedand changed each time the queued file is tried. This <CODECLASS="literal">pri=</CODE> equateshows the initial value.</P><PCLASS="para">The <CODECLASS="literal">pri=</CODE> <EMCLASS="emphasis">syslog</EM> equate is displayed only for thesender.&#13;</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-8">26.1.3.8 proto= the protocol used in transmission</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24896"></A><ACLASS="indexterm"NAME="AUTOID-24898"></A><ACLASS="indexterm"NAME="AUTOID-24900"></A><ACLASS="indexterm"NAME="AUTOID-24902"></A>The <CODECLASS="literal">$r</CODE> macro (see <ACLASS="xref"HREF="ch31_10.htm#SML2-CH-31-SECT-10-31"TITLE="">Section 31.10.31, $r</A>) holds as itsvalue the protocol that was used when a mail message was first received.That value is either SMTP, ESMTP, or internalor is a protocol assigned with the <CODECLASS="literal">-p</CODE> command-lineswitch (see <ACLASS="xref"HREF="ch36_07.htm#SML2-CH-36-SECT-7-32"TITLE="">Section 36.7.32, -p</A>). If <CODECLASS="literal">$r</CODE> lacks a value,this <CODECLASS="literal">proto=</CODE> equate is omitted. If <CODECLASS="literal">$r</CODE> has a value,the first 20 characters of that value are printed followingthe <CODECLASS="literal">proto=</CODE> in the <EMCLASS="emphasis">syslog</EM> line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">proto=ESMTP</PRE></BLOCKQUOTE></P><PCLASS="para"></P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-9">26.1.3.9 relay= the host that sent or accepted the message</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24919"></A><ACLASS="indexterm"NAME="AUTOID-24921"></A>When running as a daemon and listening for incoming connections,<EMCLASS="emphasis">sendmail</EM> attempts to look up the true identity ofconnecting users and hosts. When it can find that information, itsaves it in the <CODECLASS="literal">$_</CODE> macro (see <ACLASS="xref"HREF="ch31_10.htm#SML2-CH-31-SECT-10-1"TITLE="">Section 31.10.1, $-</A>).</P><PCLASS="para">When transporting mail to other hosts, <EMCLASS="emphasis">sendmail</EM> looks upthe MX records for those hosts and connects to the MXrecords when they are available. If MX records are notavailable, <EMCLASS="emphasis">sendmail</EM> connects to thehostname that is specified in the recipient address.</P><PCLASS="para">If the <CODECLASS="literal">$_</CODE> information is available, that informationappears following the <CODECLASS="literal">relay=</CODE> equate:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">relay=root@other.site.edu [123.45.67.89]</PRE></BLOCKQUOTE></P><PCLASS="para">If the sender is a local user, the login name and <EMCLASS="emphasis">localhost</EM> willappear in the <CODECLASS="literal">relay=</CODE> equate:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">relay=bob@localhost</PRE></BLOCKQUOTE></P><PCLASS="para">Otherwise, the canonical name of the host that actually accepted deliverywill appear here:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">relay=mx.host.domain [123.45.67.89]</PRE></BLOCKQUOTE></P><PCLASS="para">In summary, the <CODECLASS="literal">relay=</CODE> equate shows who <EMCLASS="emphasis">really</EM> acceptedor sent the message. The <CODECLASS="literal">relay=</CODE>  <EMCLASS="emphasis">syslog</EM> equateis included with both sender and recipient records.&#13;</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-10">26.1.3.10 size= the size of the message</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24950"></A><ACLASS="indexterm"NAME="AUTOID-24952"></A><ACLASS="indexterm"NAME="AUTOID-24955"></A>The size of an incoming SMTP message is the number ofbytes sent during the DATA phase (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-70-5"TITLE="Timeout.datainit">Section 34.8.70.5, "Timeout.datainit"</A>), includingend-of-line characters.The size of a message received via <EMCLASS="emphasis">sendmail</EM>'s standard inputis a count of the bytes received, including the newline characters.In both instances the size is displayed with the <CODECLASS="literal">size=</CODE>equate:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">size=23</PRE></BLOCKQUOTE></P><PCLASS="para">Note that this size is reported before <EMCLASS="emphasis">sendmail</EM> adds ordeletes any headers. Therefore for mail being relayed through a site,the size will usually be small coming in and somewhat larger going out.</P><PCLASS="para">The <CODECLASS="literal">size=</CODE> <EMCLASS="emphasis">syslog</EM> equate is produced only for senderrecords.&#13;</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-11">26.1.3.11 stat= status of delivery</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24971"></A>Whenever the delivery status of a mail message changes, <EMCLASS="emphasis">sendmail</EM>logs the event and includes the <CODECLASS="literal">status=</CODE> to specify whythe change happened. For example, a mail message may initiallybe queued because the recipient's host was down:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">stat=queued</PRE></BLOCKQUOTE></P><PCLASS="para">Later it might change again because it succeeded in beingdelivered:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">stat=Sent (HAA03001 Message accepted for delivery)</PRE></BLOCKQUOTE></P><PCLASS="para">In transmitting a mail message via SMTP the <CODECLASS="literal">stat=</CODE>will include the actual text that the other host printedwhen it accepted the mail message, as shown above. But in delivering locally,the <CODECLASS="literal">stat=</CODE> is more succinct:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">stat=Sent</PRE></BLOCKQUOTE></P><PCLASS="para">In the case of bounced mail the <CODECLASS="literal">stat=</CODE> will show the reasonfor failure:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">stat=User unknown</PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">stat=</CODE> <EMCLASS="emphasis">syslog</EM> equate is included only in recipientrecords.&#13;</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-12">26.1.3.12 to= show final recipient</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-24995"></A><ACLASS="indexterm"NAME="AUTOID-24997"></A>As each recipient is delivered to, deferred, or bounced, <EMCLASS="emphasis">sendmail</EM>logs a line of information that includes the recipientaddress:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">to=bob@here.us.edu</PRE></BLOCKQUOTE></P><PCLASS="para">Each such address is that of a final recipient (from the point ofthe view of the local host) after all aliasing, list expansions,and processing of <EMCLASS="emphasis">~/.forward</EM> files.&#13;</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-3-13">26.1.3.13 xdelay= transaction</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-25008"></A><ACLASS="indexterm"NAME="AUTOID-25010"></A><ACLASS="indexterm"NAME="AUTOID-25013"></A>The <CODECLASS="literal">xdelay=</CODE> equate shows the total amount of time the messagetook to be transmitted during final delivery.This differs from <CODECLASS="literal">delay=</CODE> in that <CODECLASS="literal">delay=</CODE> is computed from when the message was originally received (and can be days),whereas this <CODECLASS="literal">xdelay=</CODE> shows how fast the receiving host was(and is usually seconds).</P><PCLASS="para">In the case of SMTP mail the <CODECLASS="literal">xdelay=</CODE> computation starts when <EMCLASS="emphasis">sendmail</EM> successfullyconnects to the remote host.In the case of locally delivered mail the computation starts when<EMCLASS="emphasis">sendmail</EM> executes the delivery agent.The computation ends when the dot is accepted at the close of theDATA SMTP phase or when the local delivery agent exits.</P><PCLASS="para">&#13;The form of the <CODECLASS="literal">xdelay=</CODE> looks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">xdelay=HH:MM:SS</PRE></BLOCKQUOTE></P><PCLASS="para">The time expression shows the hours (<CODECLASS="literal">HH</CODE>), minutes (<CODECLASS="literal">MM</CODE>),and seconds (<CODECLASS="literal">SS</CODE>) it took to perform delivery via thefinal delivery agent. In the case of networked mail that intervalcan be long:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">xdelay=00:41:05</PRE></BLOCKQUOTE></P><PCLASS="para">But in the case of locally delivered mail this interval canseem instantaneous:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">xdelay=00:00:00</PRE></BLOCKQUOTE></P><PCLASS="para">Note that the <CODECLASS="literal">xdelay=</CODE> equate is shown only for recipient records.<ACLASS="indexterm"NAME="AUTOID-25038"></A>&#13;</P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-26-SECT-1-4">26.1.4 Gathering Statistics from syslog</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-26-IX-STATISTICS-SYSLOG-UTILITY-AND"></A><ACLASS="indexterm"NAME="SML2-CH-26-IX-SYSTEM-ADMINISTRATION-STATISTICS"></A>The log files that <EMCLASS="emphasis">syslog</EM> creates provide a wealth of informationthat can be used to examine and tune the performance of <EMCLASS="emphasis">sendmail</EM>.To illustrate, we will present a simple shell script for printingdaily total message volume.</P><PCLASS="para">In the following discussionwe will assume that <EMCLASS="emphasis">sendmail</EM> logging is enabled(the <CODECLASS="literal">LogLevel</CODE> (<CODECLASS="literal">L</CODE>) option, see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-33"TITLE="">Section 34.8.33</A>,is nonzero) and thatall <EMCLASS="emphasis">syslog</EM>(8) messages for the facility <CODECLASS="literal">mail</CODE>at level LOG_INFO are being placed into the file <EMCLASS="emphasis">/var/log/syslog</EM>.&#13;</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-26-SECT-1-4-1">26.1.4.1 message_volume.sh</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-25061"></A>Each mail message that <EMCLASS="emphasis">sendmail</EM> receives for delivery (excludingthose processed from the queue) causes <EMCLASS="emphasis">sendmail</EM> to log a messagelike this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">date host sendmail[pid]: quid: from=sender, size=bytes, ...</PRE></BLOCKQUOTE></P><PCLASS="para">That is, for each <CODECLASS="literal">sender</CODE> that is logged (the <CODECLASS="literal">from=</CODE>), <EMCLASS="emphasis">sendmail</EM>also logs the total received size of the messagein <CODECLASS="literal">bytes</CODE> (the <CODECLASS="literal">size=</CODE>).</P><PCLASS="para">By summing all the <CODECLASS="literal">size=</CODE> lines in a <EMCLASS="emphasis">/var/log/syslog</EM> file,we can generate the total volume of all messages received for the periodrepresented by that file. One way to generate such a total isshown in the following Bourne shell script:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#!/bin/shLOG=/var/log/syslogTOTAL=`(echo 0;        sed -e '/size=/!d' -e 's/.*size=//' -e 's/,.*/+/' $LOG;        echo p;       ) | dc`echo Total characters sent: $TOTAL</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;The <EMCLASS="emphasis">sed</EM>(1) selects only the lines in <EMCLASS="emphasis">/var/log/syslog</EM> thatcontain the expression <CODECLASS="literal">size=</CODE>.[1]It then throws away all butthe number immediately following each <CODECLASS="literal">size=</CODE> (the actualnumber of bytes of each message), and appends a <CODECLASS="literal">+</CODE> toeach.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] If other programs also put <CODECLASS="literal">size=</CODE> expressions into the log file, youmay also want to screen for &quot;sendmail.&quot;</P></BLOCKQUOTE><PCLASS="para">The entire sequence of processes is enclosed in parentheses. An <EMCLASS="emphasis">echo</EM>statement first prints a zero. Then the list of <CODECLASS="literal">+</CODE>-suffixedsizes is printed. Finally, another <EMCLASS="emphasis">echo</EM>prints a character <CODECLASS="literal">p</CODE>. The resulting combined outputmight look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">123+456+7890+p</PRE></BLOCKQUOTE></P><PCLASS="para">The leading <CODECLASS="literal">0</CODE>, the <CODECLASS="literal">+</CODE> suffixes, and the final<CODECLASS="literal">p</CODE> are commands for the <EMCLASS="emphasis">dc</EM>(1) program, which addsup all the numbers (the <CODECLASS="literal">+</CODE> suffixes) and prints thetotal (the <CODECLASS="literal">p</CODE>). That total is saved in the variable<CODECLASS="literal">TOTAL</CODE> for later use in the final <EMCLASS="emphasis">echo</EM> statement.The output of this simple script might look something like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Total characters sent: 8469</PRE></BLOCKQUOTE></P><PCLASS="para">More sophisticated scripts are possible, but the Bourneshell's lack of arrays suggest that <EMCLASS="emphasis">perl</EM>(1) would providea more powerful scripting environment. Most of the scripts that are available publicly are written in the <EMCLASS="emphasis">perl</EM> scripting language.<ACLASS="indexterm"NAME="AUTOID-25108"></A><ACLASS="indexterm"NAME="AUTOID-25109"></A>&#13;</P></DIV></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch25_08.htm"TITLE="25.8 Pitfalls"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 25.8 Pitfalls"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch26_02.htm"TITLE="26.2 Statistics"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 26.2 Statistics"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">25.8 Pitfalls</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">26.2 Statistics</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>