<HTML><HEAD><TITLE>[Chapter 29] 29.3 The Sequence of Rule Sets</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:51:17Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch29_01.htm"TITLE="29. Rule Sets"><LINKREL="prev"HREF="ch29_02.htm"TITLE="29.2 Rule Sets and m4"><LINKREL="next"HREF="ch29_04.htm"TITLE="29.4 Rule Set 3"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_02.htm"TITLE="29.2 Rule Sets and m4"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 29.2 Rule Sets and m4"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 29<BR>Rule Sets</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_04.htm"TITLE="29.4 Rule Set 3"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 29.4 Rule Set 3"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-29-SECT-3">29.3 The Sequence of Rule Sets</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-29-IX-PROCESSING-FLOW-OF-RULES"></A><ACLASS="indexterm"NAME="SML2-CH-29-IX-RULES-PROCESSING-FLOW-OF"></A>When <EMCLASS="emphasis">sendmail</EM> rewrites addresses, it applies its rule setsin a specific sequence.The sequence differs for sender and recipient addresses, witha third branch used to select delivery agents.<ACLASS="xref"HREF="ch29_03.htm#SML2-CH-29-FIG-0"TITLE="The flow of rules through rule sets">Figure 29.1</A>shows a map of the different paths taken by each kind of address.Those paths show how addresses flow through rule sets.</P><PCLASS="para">Both sender and recipient addresses are first input into rule set 3.Then eachtakes a different path through the rule sets based on its type.Recipient addresses take the dashed path, whereas sender addressestake the solid path. But before those paths can be taken, <EMCLASS="emphasis">sendmail</EM>needs to select a delivery agent (the dotted path) to get rule-set numbers for the<CODECLASS="literal">R=</CODE> and <CODECLASS="literal">S=</CODE> of each path.</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-29-FIG-0">Figure 29.1: The flow of rules through rule sets</A></H4><IMGCLASS="graphic"SRC="figs/sm2801.gif"ALT="Figure 29.1"><PCLASS="para">&#13;To select a delivery agent, <EMCLASS="emphasis">sendmail</EM>rewrites the recipient address with rule sets 3 and0 (the dotted path).Rule set 0 selects a delivery agent that is appropriate for the recipient.That delivery agent supplies rule set values for the <CODECLASS="literal">S=</CODE>and <CODECLASS="literal">R=</CODE> in the corresponding sender (solid) and recipient(dashed) paths.</P><PCLASS="para">After a delivery agent has been selected,the sender address is processed(see<ACLASS="xref"HREF="ch29_03.htm#SML2-CH-29-FIG-1"TITLE="The flow of sender addresses through rule sets">Figure 29.2</A>).As was mentioned above, it is first inputinto rule set 3. Then it flows through rule set 1, then the <CODECLASS="literal">S=</CODE>rule set as determined by the delivery agent. Finally, it flowsthrough rule set 4, which returns the rewritten address.This rewritten sender address appears in the header and envelopeof the mail message.</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-29-FIG-1">Figure 29.2: The flow of sender addresses through rule sets</A></H4><IMGCLASS="graphic"SRC="figs/sm2802.gif"ALT="Figure 29.2"><PCLASS="para">&#13;Note that all addresses are eventually rewritten by rule set 4. In general,rule set 4 undoes any special rewriting that rule set 3 did.</P><PCLASS="para">Finally, the recipient address also needs to be rewritten for inclusion inthe header and envelope of mail messages(see <ACLASS="xref"HREF="ch29_03.htm#SML2-CH-29-FIG-2"TITLE="The flow of recipient addresses through rule sets">Figure 29.3</A>).Recall that it was already used once to select the delivery agent.It is used as input to rule set3, as are all addresses. It then flows through rule set 2, then throughthe <CODECLASS="literal">R=</CODE> rule set selected by the delivery agent, andfinally through rule set 4.</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-29-FIG-2">Figure 29.3: The flow of recipient addresses through rule sets</A></H4><IMGCLASS="graphic"SRC="figs/sm2803.gif"ALT="Figure 29.3"><PCLASS="para"></P><PCLASS="para">The need for separate paths for the sender and the recipientis best explained with an example. Consider a site that wantsthe addresses of all local users to appear as though they arefrom the local domain. Such rewriting is appropriatefor local users on outgoing mail but inappropriate forrecipients at other sites. Clearly, such rewriting should berestricted to the sender path, probably in rule set 1.</P><PCLASS="para">The flow of rules through rule sets (as is shown in <ACLASS="xref"HREF="ch29_03.htm#SML2-CH-29-FIG-2"TITLE="The flow of recipient addresses through rule sets">Figure 29.3</A>)is appropriate for <EMCLASS="emphasis">all</EM> versions of <EMCLASS="emphasis">sendmail</EM>. Some versions, such asV8, enhance these rules with others, but allthose enhancements begin with this basic set.&#13;</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-29-SECT-3-1">29.3.1 V8 Enhancements</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-27858"></A><ACLASS="indexterm"NAME="AUTOID-27860"></A>V8 <EMCLASS="emphasis">sendmail</EM> allows envelope addresses to be rewritten separatelyfrom header addresses. This separation takes place in the deliveryagent <CODECLASS="literal">R=</CODE> and <CODECLASS="literal">S=</CODE> specific rule sets as illustrated in<ACLASS="xref"HREF="ch29_03.htm#SML2-CH-29-FIG-3"TITLE="V8 splits rewriting: envelope (solid) versus header (dashed)">Figure 29.4</A>.</P><H4CLASS="figure"><ACLASS="title"NAME="SML2-CH-29-FIG-3">Figure 29.4: V8 splits rewriting: envelope (solid) versus header (dashed)</A></H4><IMGCLASS="graphic"SRC="figs/sm2805.gif"ALT="Figure 29.4"><PCLASS="para">The method that is used to split rewriting looks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R=<CODECLASS="replaceable"><I>eset/hset          </I></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> beginning with V8</I>S=<CODECLASS="replaceable"><I>eset/hset          </I></CODE><ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> beginning with V8</I></PRE></BLOCKQUOTE></P><PCLASS="para">The envelope-specific rule set is the one to the left of the slash and isrepresented by a solid line. Theheader-specific rule set is to the right of the slash (<CODECLASS="literal">R=eset/hset</CODE>) and isrepresented by a dashed line.See <ACLASS="xref"HREF="ch30_04.htm#SML2-CH-30-SECT-4-10"TITLE="">Section 30.4.10, R=</A> for a complete description of this process.<ACLASS="indexterm"NAME="AUTOID-27880"></A><ACLASS="indexterm"NAME="AUTOID-27881"></A>&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_02.htm"TITLE="29.2 Rule Sets and m4"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 29.2 Rule Sets and m4"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_04.htm"TITLE="29.4 Rule Set 3"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 29.4 Rule Set 3"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">29.2 Rule Sets and m4</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">29.4 Rule Set 3</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>