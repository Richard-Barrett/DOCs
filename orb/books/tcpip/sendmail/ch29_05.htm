<HTML><HEAD><TITLE>[Chapter 29] 29.5 Rule Set 4</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:51:33Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch29_01.htm"TITLE="29. Rule Sets"><LINKREL="prev"HREF="ch29_04.htm"TITLE="29.4 Rule Set 3"><LINKREL="next"HREF="ch29_06.htm"TITLE="29.6 Rule Set 0"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_04.htm"TITLE="29.4 Rule Set 3"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 29.4 Rule Set 3"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 29<BR>Rule Sets</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_06.htm"TITLE="29.6 Rule Set 0"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 29.6 Rule Set 0"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-29-SECT-5">29.5 Rule Set 4</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-28027"></A>Just as all addresses are first rewritten by rule set 3, so are alladdresses rewritten last by rule set 4. Its jobis to undo any special processing done by rule set 3, such as focusing.In this section we'll examine some typical rule set 4 rules.&#13;</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-29-SECT-5-1">29.5.1 Stripping Trailing Dots</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-28033"></A><ACLASS="indexterm"NAME="AUTOID-28036"></A><ACLASS="indexterm"NAME="AUTOID-28039"></A>Under some versions of <EMCLASS="emphasis">sendmail</EM>a successful conversion to a fully qualified domain nameleaves an extra dot trailingthe result. This rule strips that dot:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># strip trailing dot off possibly canonical nameR$* &lt;@ $+. &gt; $*       $1 &lt;@ $2 &gt; $3</PRE></BLOCKQUOTE></P><PCLASS="para">Note that this rule recursively removes as many trailing dotsas it finds. Also note that the host part remains focused afterrewriting.&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-29-SECT-5-2">29.5.2 Restoring Source Routes</A></H3><PCLASS="para">Recall that rule set 3 converted the commas of source route addressesinto colons (see <ACLASS="xref"HREF="ch29_04.htm#SML2-CH-29-SECT-4-3"TITLE="Handling Routing Addresses">Section 29.4.3, "Handling Routing Addresses"</A>).Rule set 4 now needs to restore those commas:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* : $+ :$+ &lt;@ $+&gt;       $1 , $2 : $3 &lt;@ $4&gt;            &lt;route-addr&gt; canonical</PRE></BLOCKQUOTE></P><PCLASS="para">This rule recursively changes all but one (the rightmost) colonback into a comma.</P><PCLASS="para">As a special note, under V8 <EMCLASS="emphasis">sendmail</EM>, envelope-senderroute addresses are always surrounded by angle bracketswhen passed to the delivery agent.If this behavior is inappropriate for your site, beginning withV8.7 it is possible to prevent this heuristic by specifyingthe <CODECLASS="literal">F=d</CODE> delivery agent flag (see <ACLASS="xref"HREF="ch30_08.htm#SML2-CH-30-SECT-8-16"TITLE="">Section 30.8.16</A>).&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-29-SECT-5-3">29.5.3 Removing Focus</A></H3><PCLASS="para">Rule set 4 also removes angle brackets inserted byrule set 3 to focus on the host part of the address. This is necessarybecause mail will fail if they are left in place.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># externalize local domain infoR$* &lt;$+&gt; $*         $1 $2 $3                   defocus</PRE></BLOCKQUOTE></P><PCLASS="para"></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-29-SECT-5-4">29.5.4 Correcting Tags</A></H3><PCLASS="para">After defocusing, rule set 4 may need to convert some addressesback to their original forms. For example, consider UUCP addresses.They entered rule set 3 in the form <EMCLASS="emphasis">host!host!user</EM>. Rule set3 rewrote them in the more normal <EMCLASS="emphasis">user@host</EM> form,and added a <CODECLASS="literal">.uucp</CODE> to the end of the host.The following rule in rule set 4 converts suchnormalized UUCP addresses back to their original form:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># UUCP must always be presented in old formR$+ @ $-.uucp         $2 ! $1                  u@h.UUCP =&gt; h!u</PRE></BLOCKQUOTE></P><PCLASS="para"></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_04.htm"TITLE="29.4 Rule Set 3"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 29.4 Rule Set 3"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_06.htm"TITLE="29.6 Rule Set 0"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 29.6 Rule Set 0"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">29.4 Rule Set 3</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">29.6 Rule Set 0</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>