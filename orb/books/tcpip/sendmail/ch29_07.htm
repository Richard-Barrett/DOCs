<HTML><HEAD><TITLE>[Chapter 29] 29.7 Rule Set 5</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:52:02Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch29_01.htm"TITLE="29. Rule Sets"><LINKREL="prev"HREF="ch29_06.htm"TITLE="29.6 Rule Set 0"><LINKREL="next"HREF="ch29_08.htm"TITLE="29.8 Rule Set 2"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_06.htm"TITLE="29.6 Rule Set 0"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 29.6 Rule Set 0"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 29<BR>Rule Sets</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_08.htm"TITLE="29.8 Rule Set 2"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 29.8 Rule Set 2"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-29-SECT-7">29.7 Rule Set 5</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-28289"></A>For version 2 and higher configuration files (see <ACLASS="xref"HREF="ch27_05.htm"TITLE="The V Configuration Command">Section 27.5, "The V Configuration Command"</A>),V8 <EMCLASS="emphasis">sendmail</EM> allows localrecipients to undergo additional rewriting.Recall that each recipient address is processed by rule sets 3 and 0.Beginning with V8.7 <EMCLASS="emphasis">sendmail</EM>, any delivery agent with the <CODECLASS="literal">F=A</CODE> flagset[4](see <ACLASS="xref"HREF="ch30_08.htm#SML2-CH-30-SECT-8-12"TITLE="">Section 30.8.12, F=A</A>) will cause the address to undergo aliasing(via the <EMCLASS="emphasis">aliases</EM> file),which may result in a new local address.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] Prior to V8.7 <EMCLASS="emphasis">sendmail</EM>, only the <CODECLASS="literal">local</CODE> delivery agent had thisproperty.</P></BLOCKQUOTE><PCLASS="para">Under V8 <EMCLASS="emphasis">sendmail</EM>, if an address makes it through aliasingunchanged, it is given to rule set 5, which may select a newdelivery agent.Note that it is given to rule set 5 before the ~/.forward file is processed.</P><PCLASS="para">Beginning with V8.7 <EMCLASS="emphasis">sendmail</EM>, any delivery agent that hasthe <CODECLASS="literal">F=5</CODE> flag set (see <ACLASS="xref"HREF="ch30_08.htm#SML2-CH-30-SECT-8-3"TITLE="">Section 30.8.3, F=5</A>) will cause rule set 5 to be called as though the agent were a local one.</P><PCLASS="para">To illustrate, consider that a new delivery agent might be needed in the case ofa mail <EMCLASS="emphasis">firewall</EM> machine. A firewall machine isone that sits between the local network and the outside worldand protects the local network from intrusion byoutsiders. In such an arrangement it may be desirable forall incoming mail to be delivered to the firewall so thatno outsider needs to know the real names of machines onthe local network.</P><PCLASS="para">Consider mail to the address <EMCLASS="emphasis">john@firewall</EM>. On the firewall machine,rule set 3 recognizes the host part as local and throws away the<EMCLASS="emphasis">@firewall</EM>. Rule set 0 then selects the <CODECLASS="literal">local</CODE> deliveryagent. Because the address <EMCLASS="emphasis">john</EM> is local, it is looked upin the <EMCLASS="emphasis">aliases</EM> file. For this example we will assume that it is not found there.The user's <EMCLASS="emphasis">~/.forward</EM> file would normally be examined next, butuser home directories are not visible to the firewall machine.</P><PCLASS="para">Because the address <EMCLASS="emphasis">john</EM> is not aliased, it is then passedto rule set 5, which selects another delivery agent toforward the message into the local network:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">S5R$-     $#smtp $@hub.internal.net $:$1</PRE></BLOCKQUOTE></P><PCLASS="para">Here, the <EMCLASS="emphasis">john</EM> matches the <CODECLASS="literal">$-</CODE> in the LHS, so the<CODECLASS="literal">smtp</CODE> delivery agent is selected.The mail message is forwarded to the local network with <EMCLASS="emphasis">john</EM>(the <CODECLASS="literal">$1</CODE>) as the username and <CODECLASS="literal">hub.internal.net</CODE> asthe name of the receiving machine on the internal network.</P><PCLASS="para">For such a scheme to work, all local machines must sendoffsite mail addressed as though it were from the firewall, andlocal names must be changed to offsite forms when forwardedoffsite. For example, the name <EMCLASS="emphasis">john@local.host</EM> needs tobe changed to <EMCLASS="emphasis">john@firewall</EM> for all outgoing offsitemail.</P><PCLASS="para">Note that rule set 5 can also be used in situations that do notinvolve firewalls. It can beused as a hook into forwarding to other types of networks,with special mailing list software, or even as a way tohandle retired accounts.Also note that rule set 5 <EMCLASS="emphasis">may</EM> select a new delivery agent, but it doesnot have to.</P><PCLASS="para">For those times when rule set 5 may not be appropriate, V8 <EMCLASS="emphasis">sendmail</EM>offers a technique for bypassing it. In rule set 0, if the first token followingthe <CODECLASS="literal">$:</CODE> of a rule that selects the <CODECLASS="literal">local</CODE> deliveryagent is an <CODECLASS="literal">@</CODE>, <EMCLASS="emphasis">sendmail</EM> removes the<CODECLASS="literal">@</CODE> and skips calling rule set 5:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$-         $#local $: @ $1                       <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                       <ICLASS="lineannotation">removed and rule set 5 skipped</I></PRE></BLOCKQUOTE></P><PCLASS="para">Note that rule set 5 is the way V8.7 <EMCLASS="emphasis">sendmail</EM> and above institutesthe plussed users technique (see <ACLASS="xref"HREF="ch24_04.htm#SML2-CH-24-SECT-4-3"TITLE="Plussed Users">Section 24.4.3, "Plussed Users"</A>).&#13;</P></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_06.htm"TITLE="29.6 Rule Set 0"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 29.6 Rule Set 0"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_08.htm"TITLE="29.8 Rule Set 2"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 29.8 Rule Set 2"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">29.6 Rule Set 0</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">29.8 Rule Set 2</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>