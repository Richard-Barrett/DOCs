<HTML><HEAD><TITLE>[Chapter 30] 30.5 Internally Defined Names</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T19:57:20Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch30_01.htm"TITLE="30. Delivery Agents"><LINKREL="prev"HREF="ch30_04.htm"TITLE="30.4 The Equates"><LINKREL="next"HREF="ch30_06.htm"TITLE="30.6 How Executed"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch30_04.htm"TITLE="30.4 The Equates"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 30.4 The Equates"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 30<BR>Delivery Agents</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch30_06.htm"TITLE="30.6 How Executed"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 30.6 How Executed"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-30-SECT-5">30.5 Internally Defined Names</A></H2><PCLASS="para">V8 <EMCLASS="emphasis">sendmail</EM> internally predefines twodelivery agents for the special handling of files (<CODECLASS="literal">*file*</CODE> and<CODECLASS="literal">*include*</CODE>) and one for thespecial handling of errors (<CODECLASS="literal">error</CODE>).</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-30-SECT-5-1">30.5.1 The *file* and *include* Agents</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-30396"></A><ACLASS="indexterm"NAME="AUTOID-30398"></A>The <CODECLASS="literal">*file*</CODE>delivery agent (the <CODECLASS="literal">*</CODE> characters are part of the name)handles delivery to files. The <CODECLASS="literal">*include*</CODE> delivery agenthandles delivery through <CODECLASS="literal">:include:</CODE> lists. Neither can be considereda real delivery agent, because actual delivery is still handledinternally by <EMCLASS="emphasis">sendmail</EM>. Instead, they provide a way to tunedelivery-agent behavior for these two delivery needs.</P><PCLASS="para">The predefined defaults for these delivery agents can be viewed withthe following command:[13]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[13] The output lines are unfortunately wrapped at the right margin of thisbook text.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>/usr/lib/sendmail -d0.15 -bt &lt; /dev/null | egrep &quot;file|include&quot; </B></CODE>mailer 1 (*file*): P=[FILE] S=0/0 R=0/0 M=0 U=0:0 F=9DEFMPloqsu L=0 E=\n T=DNS/RFC822/X-Unix A=FILE $umailer 2 (*include*): P=/dev/null S=0/0 R=0/0 M=0 U=0:0 F=su L=0 E=\n T=&lt;undefined&gt;/&lt;undefined&gt;/&lt;undefined&gt; A=INCLUDE $u</PRE></BLOCKQUOTE></P><PCLASS="para">The defaults may be overwritten by declaring these deliveryagents in the configuration file.For example, the following configuration file declaration overrides theinternal definition shown above, andlimits the size of any mail message that is delivered to files to 1 megabyte:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">M*file*, P=[FILE], <CODECLASS="userinput"><B>M=1000000</B></CODE>, F=9DEFMPloqsu, T=DNS/RFC822/X-Unix, A=FILE $u</PRE></BLOCKQUOTE></P><PCLASS="para">Note that any equate that does not default to zero (such as the<CODECLASS="literal">P=</CODE>, <CODECLASS="literal">F=</CODE>, <CODECLASS="literal">T=</CODE>, and <CODECLASS="literal">A=</CODE> equates) needs tobe copied to this configuration file declaration, or the originalvalue will be lost.</P><PCLASS="para">A similar change in definition for the m4 configuration of V8<EMCLASS="emphasis">sendmail</EM> would look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">LOCAL_CONFIGM*file*, P=[FILE], <CODECLASS="userinput"><B>M=1000000</B></CODE>, F=9DEFMPloqsu, T=DNS/RFC822/X-Unix, A=FILE $u</PRE></BLOCKQUOTE></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-30-SECT-5-2">30.5.2 The error Delivery Agent</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-30428"></A>All versions of <EMCLASS="emphasis">sendmail</EM> define a special internal delivery agentcalled <CODECLASS="literal">error</CODE> that is designed to aid in the issuance of error messages.It is always available for use in rule sets 0 and 5, and the <CODECLASS="literal">check_...</CODE>rule sets and cannot be defined with an <CODECLASS="literal">M</CODE> command.</P><PCLASS="para">Beginning with V8.7, the form for using the <CODECLASS="literal">error</CODE> agent in the RHS of a rulelooks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R...          $#error $@ <CODECLASS="replaceable"><I>dsn </I></CODE> $: <ICLASS="lineannotation">text of error message here</I></PRE></BLOCKQUOTE></P><PCLASS="para">In general terms, the text following the <CODECLASS="literal">$:</CODE> is the actual error message thatwill be included in bounced mail and sent back to a connecting SMTP host.For example, the following rule in rule set 0 would causeall mail to the local user George Washington to bounce:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">RGeorge.Washington       $#error $: George Washington doesn't sleep here anymore</PRE></BLOCKQUOTE></P><PCLASS="para">with an error message like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">553 &lt;george.washington&gt;... George Washington doesn't sleep here anymore</PRE></BLOCKQUOTE></P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-30-SECT-5-2-1">30.5.2.1 The $@ dsn part</A></H4><PCLASS="para">Delivery Status Notification (DSN, see RFC1893)provides a means for conveying the status of a message's delivery.That status is conveyed in the form of a numeric triple (so as tobe easily parseable by machines). This triple is included in the&quot;machine readable&quot; part of bounced messages:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="replaceable"><I>success</I></CODE>.<CODECLASS="replaceable"><I>category</I></CODE>.<CODECLASS="replaceable"><I>detail</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Each part of the triple is separated from the others with dot characters. There may be nospace around the dots.The parts are numeric, and the meanings are as follows:<CODECLASS="replaceable"><I>success</I></CODE> <ACLASS="indexterm"NAME="AUTOID-30457"></A>Was the overall delivery attempt a success? This part can be one of threedigits. A 2 means that the message was successfully delivered. A 4 means thatdelivery has failed so far but it may succeed in the future. A 5 means thatdelivery failed (permanently).<CODECLASS="replaceable"><I>category</I></CODE> <ACLASS="indexterm"NAME="AUTOID-30460"></A>Failure can be caused by several categories of problem.For example, if this <CODECLASS="replaceable"><I>category</I></CODE> is a 1, it meansthat there was a problem with the address. If it is a 4 it means that therewas a problem with the network.<CODECLASS="replaceable"><I>detail</I></CODE> <ACLASS="indexterm"NAME="AUTOID-30464"></A>The <CODECLASS="replaceable"><I>detail</I></CODE> further illuminates the <CODECLASS="replaceable"><I>category</I></CODE>. For example,a category of 1 (address problem) might be caused by a detail of1 (no such mailbox), or 4 (ambiguous address).</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-30469"></A>The <CODECLASS="literal">$@</CODE> part of the <CODECLASS="literal">error</CODE> delivery agent declaration specifiesa DSN code that is appropriate for the error.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R...          $#error <CODECLASS="userinput"><B>$@ success.category.detail </B></CODE> $: <ICLASS="lineannotation">text of error message here</I></PRE></BLOCKQUOTE></P><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> programsets its <EMCLASS="emphasis">exit</EM>(2) value according to the <CODECLASS="replaceable"><I>success.category.detail</I></CODE> specified. <ACLASS="xref"HREF="ch30_05.htm#SML2-CH-30-TAB-5"TITLE="DSN Versus exit(2) Values with $@ of $#error">Table 30.6</A>shows the relationship between those DSN codes on the left and UNIX <EMCLASS="emphasis">exit</EM>(2) values on the right. Note that the exit values are defined in <EMCLASS="emphasis">&lt;sysexits.h&gt;</EM>, and notethat <CODECLASS="replaceable"><I>success</I></CODE> codes of 2 and 4 completely ignore any <CODECLASS="replaceable"><I>category</I></CODE> and<CODECLASS="replaceable"><I>detail</I></CODE> that may be present (that is, 2.<EMCLASS="emphasis">anything</EM>.<EMCLASS="emphasis">anything</EM> marks successful delivery).If <CODECLASS="literal">$@</CODE> lists a code that is not in the table, the default exit value is EX_CONFIG.To illustrate, observe that <CODECLASS="literal">8.7.1</CODE> (see RFC1893)will exit with EX_DATAERR because it corresponds to the <CODECLASS="literal">*.7.*</CODE> in the table.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="SML2-CH-30-TAB-5">Table 30.6: DSN Versus exit(2) Values with $@ of $#error</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">DSN</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">exit(2)</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">String</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Meaning</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">2.*.*</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_OK</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Successful delivery</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">4.*.*</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_TEMPFAIL</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">tempfail</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Temporary failure, will keep trying</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.0.*</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_UNAVAILABLE</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">unavailable</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Other address status</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.1.0</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_DATAERR</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Other address status</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.1.1</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_NOUSER</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">nouser</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Address is that of a bad mailbox</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.1.2</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_NOHOST</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">nohost</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Address of recipient is bad</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.1.3</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_USAGE</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">usage</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Address of recipient has bad syntax</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.1.4</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_UNAVAILABLE</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">unavailable</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Address is ambiguous</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.1.5</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_OK</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Address of destination is valid</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.1.6</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_NOUSER</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">nouser</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Address has moved, no forwarding</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.1.7</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_USAGE</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">usage</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Address of sender has bad syntax</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.1.8</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_NOHOST</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">nohost</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Address of sender is bad</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.2.0</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_UNAVAILABLE</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">unavailable</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Mailbox status is undefined</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.2.1</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_UNAVAILABLE</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">unavailable</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Mailbox disabled</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.2.2</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_UNAVAILABLE</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">unavailable</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Mailbox full</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.2.3</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_DATAERR</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Mailbox is too small or message is too large</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.2.4</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_UNAVAILABLE</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">unavailable</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Mailbox led to mail list expansion problems</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.3.*</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_OSERR</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Operating system error</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.4.0</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_IOERR</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Network error is undefined</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.4.1</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_TEMPFAIL</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">tempfail</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Network: no answer from host</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.4.2</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_IOERR</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Network bad connection</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.4.3</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_TEMPFAIL</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">tempfail</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Network routing failure</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.4.4</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_PROTOCOL</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">protocol</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Network unable to route</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.4.5</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_TEMPFAIL</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">tempfail</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Network congestion</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.4.6</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_CONFIG</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">config</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Network routing loop detected</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.4.7</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_UNAVAILABLE</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">unavailable</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Network delivery time expired</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.5.*</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_PROTOCOL</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">protocol</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Protocol failure</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.6.*</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_UNAVAILABLE</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">unavailable</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Message contents bad or media failure</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">*.7.*</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_DATAERR</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Security: general security rejection</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">else</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">EX_CONFIG</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">config</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Internal configuration error</TD></TR></TBODY></TABLE><PCLASS="para">To illustrate, consider the need to reject all mail from a particular host (say <EMCLASS="emphasis">evilhost.domain</EM>).We want to reject that host for security reasons, so we might set up a rule like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* &lt; @ evilhost.domain &gt; $*        $#error $@ 5.7.1 $: You are bad, go away</PRE></BLOCKQUOTE></P><PCLASS="para">Here, the number following the <CODECLASS="literal">$@</CODE> contains a dot, so it is interpreted asa DSN status expression. The <CODECLASS="literal">.7.</CODE> in it causes sendmail to set itsexit valut to EX_DATAERR, and the <CODECLASS="literal">5.7.1</CODE> is defined inRFC1893 as meaning &quot;Permanent failure,delivery not authorized, message refused.&quot;</P><PCLASS="para">If the number following the <CODECLASS="literal">$@</CODE> does not contain a dot, <EMCLASS="emphasis">sendmail</EM> setsits <EMCLASS="emphasis">exit</EM>(2) value to that number. For example, the below results in the same<EMCLASS="emphasis">exit</EM>(2) value as the above but gives a less informative DSN in the bounce message:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* &lt; @ evilhost.domain &gt; $*        $#error $@ <CODECLASS="userinput"><B>65</B></CODE> $: You are bad, go away                                               <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                                    <ICLASS="lineannotation">the value of EX_DATAERR from &lt;sysexits.h&gt;</I></PRE></BLOCKQUOTE></P><PCLASS="para">If the expression following the <CODECLASS="literal">$@</CODE> is non-numeric, <EMCLASS="emphasis">sendmail</EM> looks up the stringand translates a known one into the appropriate <EMCLASS="emphasis">exit</EM>(2) value. The recognizedstrings are listed in the third column of<ACLASS="xref"HREF="ch30_05.htm#SML2-CH-30-TAB-5"TITLE="DSN Versus exit(2) Values with $@ of $#error">Table 30.6</A>.For example, the following will cause <EMCLASS="emphasis">sendmail</EM> to exit with an EX_UNAVAILABLEvalue:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$* &lt; @ evilhost.domain &gt; $*        $#error $@ <CODECLASS="userinput"><B>unavailable</B></CODE> $: You are bad, go away</PRE></BLOCKQUOTE></P><PCLASS="para">If the string following the <CODECLASS="literal">$@</CODE> is not one of those listed in the table,the default <EMCLASS="emphasis">exit</EM>(2) value becomes EX_UNAVAILABLE.</P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-30-SECT-5-3">30.5.3 The $: Part</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-30714"></A><ACLASS="indexterm"NAME="AUTOID-30717"></A>Recall that the text of the error message following the <CODECLASS="literal">$:</CODE> is used as a literalerror message. That is, this  <CODECLASS="literal">$:</CODE> part:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R...          $#error <CODECLASS="userinput"><B> $: george doesn't sleep here anymore</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">&#13;produces this error for the address <EMCLASS="emphasis">george@wash.dc.gov</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">553 &lt;george@wash.dc.gov&gt;... george doesn't sleep here anymore</PRE></BLOCKQUOTE></P><PCLASS="para">Here the 553 is an SMTP code (see RFC821). If you want a differentSMTP code issued, you may do so by prefixing the <CODECLASS="literal">$:</CODE> part with it:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R...          $#error  $: <CODECLASS="userinput"><B>421 </B></CODE>george doesn't sleep here anymore</PRE></BLOCKQUOTE></P><PCLASS="para">If three digits followed by a space are present as a prefix, those digits are used as theSMTP reply code when <EMCLASS="emphasis">sendmail</EM> is speaking SMTP.If no digits and space prefix the text, the default SMTP replycode is 553.</P><PCLASS="para">A few SMTP codes that are useful with <CODECLASS="literal">$:</CODE> are listed in<ACLASS="xref"HREF="ch30_05.htm#SML2-CH-30-TAB-6"TITLE="Useful SMTP Codes for Use with $:">Table 30.7</A>.The complete list of all SMTP codes can be found in RFC821.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="SML2-CH-30-TAB-6">Table 30.7: Useful SMTP Codes for Use with $:</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Code</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Meaning</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">421</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Service not available (drop the message)</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">553</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Requested action not taken (bounce the message)</TD></TR></TBODY></TABLE><PCLASS="para">Note that you should restrict yourself to the small set ofcodes that may legally be returned to the RCPT SMTP command.Also note that any DSN code that is specified in the <CODECLASS="literal">$@</CODE> part mustavoid conflicting with the meaning of the SMTP code. For example, thefollowing construct is wrong and should be avoided:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R...          $#error $@ 2.1.1 $: 553 ...     <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> avoid such conflicts</I></PRE></BLOCKQUOTE></P><PCLASS="para">Here, the DSN <CODECLASS="literal">2.1.1</CODE> means that delivery was successful, whereas theSMTP <CODECLASS="literal">553</CODE> means that delivery failed and the message bounced.</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch30_04.htm"TITLE="30.4 The Equates"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 30.4 The Equates"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch30_06.htm"TITLE="30.6 How Executed"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 30.6 How Executed"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">30.4 The Equates</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">30.6 How Executed</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>