<HTML><HEAD><TITLE>[Chapter 31] 31.6 Macro Conditionals: $?, $|, and $.</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T20:11:18Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch31_01.htm"TITLE="31. Defined Macros"><LINKREL="prev"HREF="ch31_05.htm"TITLE="31.5 Macro Expansion: $ and $&amp;"><LINKREL="next"HREF="ch31_07.htm"TITLE="31.7 Categories of Macros"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch31_05.htm"TITLE="31.5 Macro Expansion: $ and $&amp;"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 31.5 Macro Expansion: $ and $&amp;"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 31<BR>Defined Macros</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch31_07.htm"TITLE="31.7 Categories of Macros"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 31.7 Categories of Macros"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-31-SECT-6">31.6 Macro Conditionals: $?, $|, and $.</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-31-IX-OPERATORS-DOLLAR-OPERATORS-DOT"></A><ACLASS="indexterm"NAME="SML2-CH-31-IX-OPERATORS-DOLLAR-OPERATORS-VERTICAL"></A><ACLASS="indexterm"NAME="SML2-CH-31-IX-OPERATORS-DOLLAR-OPERATORS-QUESTION"></A><ACLASS="indexterm"NAME="SML2-CH-31-IX-MACRO-CONDITIONALS"></A><ACLASS="indexterm"NAME="AUTOID-33503"></A>Occasionally, it is necessary to test a macro to see whethera value has been assigned to it. To perform such a test, a specialprefix and two operators are used. The general form is</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">  <ICLASS="lineannotation">if</I>       <ICLASS="lineannotation">else</I>       <ICLASS="lineannotation">endif</I>  <IMGSRC="../chars/darr.gif"ALT="-v">        <IMGSRC="../chars/darr.gif"ALT="-v">        <IMGSRC="../chars/darr.gif"ALT="-v">$?x text1 $| text2 $.      <IMGSRC="../chars/uarr.gif"ALT="-^">        <IMGSRC="../chars/uarr.gif"ALT="-^"><ICLASS="lineannotation">if </I>x<ICLASS="lineannotation"> is defined   if </I>x <ICLASS="lineannotation">is not defined</I></PRE></BLOCKQUOTE></P><PCLASS="para">This expression yields one of two possible values: <CODECLASS="literal">text1</CODE>if the macro named <CODECLASS="literal">x</CODE> has a value, <CODECLASS="literal">text2</CODE> if itdoesn't.The entire above expression, starting with the <CODECLASS="literal">$?</CODE> and ending with the <CODECLASS="literal">$.</CODE>, yields a single value, whichmay contain multiple tokens.</P><PCLASS="para">The following, for example, includesthe configuration-file versionin the SMTP greeting message but does so only ifthat version (in <CODECLASS="literal">$v</CODE>; see <ACLASS="xref"HREF="ch31_10.htm#SML2-CH-31-SECT-10-38"TITLE="">Section 31.10.38</A>) is defined:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">O SmtpGreetingMessage=$j Sendmail ($v/<CODECLASS="userinput"><B>$?Z$Z$|generic$.</B></CODE>) ready at $b                                                <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                                                <ICLASS="lineannotation">note</I></PRE></BLOCKQUOTE></P><PCLASS="para">Here the parenthetical version information is expressed oneway if <CODECLASS="literal">Z</CODE> has a value (like <CODECLASS="literal">1.4</CODE>):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">($v/$Z)</PRE></BLOCKQUOTE></P><PCLASS="para">but is expressed differently if <CODECLASS="literal">Z</CODE> lacks a value:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">($v/generic)</PRE></BLOCKQUOTE></P><PCLASS="para">The <EMCLASS="emphasis">else</EM> part (<CODECLASS="literal">$|</CODE>) of this conditional expression is optional.If it is omitted, the result is the same as if the <CODECLASS="literal">text2</CODE> wereomitted:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$?xtext1$|$.$?xtext1$.</PRE></BLOCKQUOTE></P><PCLASS="para">Both of the preceding yield the same result. If <CODECLASS="literal">x</CODE> has a value, then<CODECLASS="literal">text1</CODE> becomes the value of the entire expression. If <CODECLASS="literal">x</CODE>lacks a value, then the entire expression lacks a value (producesno tokens).</P><PCLASS="para">Note that it is <EMCLASS="emphasis">not</EM> advisable to use the <CODECLASS="literal">$?</CODE>conditional expression in rules. It may not have theintended effect, because macro conditionalsare expanded when the configuration file is read.&#13;</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-31-SECT-6-1">31.6.1 Conditionals May Nest</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-33554"></A>V8 <EMCLASS="emphasis">sendmail</EM> allows conditionals to nest.To illustrate, consider the following expression:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$?x $?y both $| xonly $. $| $?y yonly $| none $. $.</PRE></BLOCKQUOTE></P><PCLASS="para">This is just like the example in the previous section:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$?x text1 $| text2 $.</PRE></BLOCKQUOTE></P><PCLASS="para">except that <CODECLASS="literal">text1</CODE> and <CODECLASS="literal">text2</CODE> are both conditionals:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">text1 = $?y both $| xonly $.text2 = $?y yonly $| none $.</PRE></BLOCKQUOTE></P><PCLASS="para">The grouping when conditionals nest is from the outside in. In thefollowing example, parentheses have been inserted to show thegroupings (they are not a part of either expression):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>(</B></CODE>$?x <CODECLASS="userinput"><B>(</B></CODE>text1<CODECLASS="userinput"><B>)</B></CODE> $| <CODECLASS="userinput"><B>(</B></CODE>text2<CODECLASS="userinput"><B>)</B></CODE> $.<CODECLASS="userinput"><B>)</B></CODE><CODECLASS="userinput"><B>(</B></CODE>$?x <CODECLASS="userinput"><B>(</B></CODE>$?y both $| xonly $.<CODECLASS="userinput"><B>)</B></CODE> $| <CODECLASS="userinput"><B>(</B></CODE>$?y yonly $| none $.<CODECLASS="userinput"><B>)</B></CODE> $.<CODECLASS="userinput"><B>)</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Interpretation is from left to right.The logic of the second line above is therefore this:If both <CODECLASS="literal">$x</CODE> and <CODECLASS="literal">$y</CODE>have values, the result is <CODECLASS="literal">both</CODE>. If <CODECLASS="literal">$x</CODE> has a valuebut <CODECLASS="literal">$y</CODE> lacks one, the result is <CODECLASS="literal">xonly</CODE>. If <CODECLASS="literal">$x</CODE>lacks a value but <CODECLASS="literal">$y</CODE> has one, the result is <CODECLASS="literal">yonly</CODE>.And if both lack values, the result is <CODECLASS="literal">none</CODE>.</P><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> program does not enforce or check for balancein nested conditionals. Each <CODECLASS="literal">$?</CODE> should have a corresponding<CODECLASS="literal">$.</CODE> to balance it. If they do not balance, <EMCLASS="emphasis">sendmail</EM>will not detect the problem. Instead, it may interpret theexpression in a way that you did not intend.</P><PCLASS="para">The depth to which conditionals may be nestedis limited only by our ability to easily comprehend the result.More than two deep is not recommended,and more than three deep is vigorously discouraged.<ACLASS="indexterm"NAME="AUTOID-33600"></A><ACLASS="indexterm"NAME="AUTOID-33601"></A><ACLASS="indexterm"NAME="AUTOID-33602"></A><ACLASS="indexterm"NAME="AUTOID-33603"></A>&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch31_05.htm"TITLE="31.5 Macro Expansion: $ and $&amp;"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 31.5 Macro Expansion: $ and $&amp;"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch31_07.htm"TITLE="31.7 Categories of Macros"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 31.7 Categories of Macros"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">31.5 Macro Expansion: $ and $&amp;</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">31.7 Categories of Macros</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>