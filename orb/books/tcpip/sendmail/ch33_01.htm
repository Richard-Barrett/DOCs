<HTML><HEAD><TITLE>[Chapter 33] Database Macros</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T20:21:37Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part04.htm"TITLE="IV. Reference"><LINKREL="prev"HREF="ch32_05.htm"TITLE="32.5 Alphabetized Reference"><LINKREL="next"HREF="ch33_02.htm"TITLE="33.2 Create Files with makemap"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch32_05.htm"TITLE="32.5 Alphabetized Reference"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 32.5 Alphabetized Reference"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 33</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch33_02.htm"TITLE="33.2 Create Files with makemap"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 33.2 Create Files with makemap"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="SML2-CH-33">33. Database Macros</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#SML2-CH-33-SECT-1"TITLE="33.1 Enable at Compile Time">Enable at Compile Time</A><BR><ACLASS="sect1"HREF="ch33_02.htm"TITLE="33.2 Create Files with makemap">Create Files with makemap</A><BR><ACLASS="sect1"HREF="ch33_03.htm"TITLE="33.3 The K Configuration Command">The K Configuration Command</A><BR><ACLASS="sect1"HREF="ch33_04.htm"TITLE="33.4 Use Maps with $( and $) in Rules">Use Maps with $( and $) in Rules</A><BR><ACLASS="sect1"HREF="ch33_05.htm"TITLE="33.5 The User Database">The User Database</A><BR><ACLASS="sect1"HREF="ch33_06.htm"TITLE="33.6 Database Maps and m4">Database Maps and m4</A><BR><ACLASS="sect1"HREF="ch33_07.htm"TITLE="33.7 Pitfalls">Pitfalls</A><BR><ACLASS="sect1"HREF="ch33_08.htm"TITLE="33.8 Alphabetized Reference">Alphabetized Reference</A></P><P></P></DIV><PCLASS="para"></P><PCLASS="para">Database macros are special forms of defined macros.When used with certain special operators, they can cause rules to access information in external files.Database macros offer these advantages:<ACLASS="indexterm"NAME="SML2-CH-33-IX-DATABASE-MACROS"></A><ACLASS="indexterm"NAME="SML2-CH-33-IX-MACROS-DATABASE-MACROS"></A></P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Information may be easily changed without having to kill andrestart <EMCLASS="emphasis">sendmail</EM>, because database information is external to the configuration file.</P></LI><LICLASS="listitem"><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> program starts up faster, becauseonly the location of the information is stored at startup, ratherthan the information itself. </P></LI><LICLASS="listitem"><PCLASS="para">Rules are more versatile becausedatabase information can be used in the RHS side of rules.Class macros are still of use in the LHS.</P></LI></UL><PCLASS="para">To fully appreciate <EMCLASS="emphasis">sendmail</EM> databases, consider the onlyalternative, the <CODECLASS="literal">F</CODE> configuration command.<ACLASS="indexterm"NAME="AUTOID-36895"></A>For example, mail that is sent by using UUCP is a typicalapplication that requires lists of information:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">FU /etc/mail/uuhosts</PRE></BLOCKQUOTE></P><PCLASS="para">Here, the external file <EMCLASS="emphasis">/etc/mail/uuhosts</EM> contains a listof UUCP hosts connected to the local machine.If the list rarely changes, the <CODECLASS="literal">F</CODE> command is appropriate.On the other hand, if the list is volatile and changes often,the <CODECLASS="literal">F</CODE> command has drawbacks. The file <EMCLASS="emphasis">/etc/mail/uuhosts</EM>is read only when the configuration file is processed. Any change tothat file is ignored by a running <EMCLASS="emphasis">sendmail</EM> (such as the daemon).To make the change effective, the daemon needs to be killed andrestarted. [1]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] If you're running an old <EMCLASS="emphasis">sendmail</EM> version witha freeze file, that file also will need to be recreated.</P></BLOCKQUOTE><PCLASS="para">In such volatile situations, storing UUCP information in a databaseis preferred. A change to a database is immediately availableto the running daemon, eliminating the need to kill and restart.</P><PCLASS="para">V8 <EMCLASS="emphasis">sendmail</EM> is designed to rewrite addresses on the basis ofinformation looked up in external databases or in its internal symbol table.It can use a wide variety of database forms, ranging from<EMCLASS="emphasis">ndbm</EM>(3) files (see <ACLASS="xref"HREF="ch33_08.htm#SML2-CH-33-SECT-8-3"TITLE="">Section 33.8.3, dbm</A>) to Hesiod network maps(see <ACLASS="xref"HREF="ch33_08.htm#SML2-CH-33-SECT-8-6"TITLE="">Section 33.8.6, hesiod</A>).The <CODECLASS="literal">K</CODE> configuration command (see <ACLASS="xref"HREF="ch33_03.htm"TITLE="The K Configuration Command">Section 33.3, "The K Configuration Command"</A>)is used to declare the name,location, and other parameters of databases or to modify use ofits symbol table.The <CODECLASS="literal">$(</CODE> and <CODECLASS="literal">$)</CODE> database operators (see <ACLASS="xref"HREF="ch33_04.htm"TITLE="Use Maps with $( and $) in Rules">Section 33.4, "Use Maps with $( and $) in Rules"</A>) are used in the RHS of rules to access and utilize that information.</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-33-SECT-1">33.1 Enable at Compile Time</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-33-IX-COMPILING-SENDMAIL-ENABLING-DATABASES"></A>Vendors that provide V8 <EMCLASS="emphasis">sendmail</EM> in precompiled form may ormay not provide access to all the types of databases that V8<EMCLASS="emphasis">sendmail</EM> supports. If your online documentation lacks thisinformation, you can run <EMCLASS="emphasis">strings</EM>(1) on <EMCLASS="emphasis">sendmail</EM> to discoverwhat it supports:<ACLASS="indexterm"NAME="AUTOID-36929"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>strings /usr/lib/sendmail | grep map_open</B></CODE>ndbm_map_open(%s, %s, %d)hash_map_open(%s, %s, %d)nis_map_open(%s, %s)text_map_open(%s, %s, %d)text_map_open: file name requiredtext_map_open(%s): file name must be fully qualifiedtext_map_open(%s): can not stat %stext_map_open(%s): %s is not a filetext_map_open(%s): -k should specify a number, not %stext_map_open(%s): -v should specify a number, not %stext_map_open(%s): delimiter = %cstab_map_open(%s, %s)impl_map_open(%s, %s, %d)user_map_open(%s)switch_map_open(%s, %s, %d)</PRE></BLOCKQUOTE></P><PCLASS="para">In this implementation of <EMCLASS="emphasis">sendmail</EM>, NDBM (the <CODECLASS="literal">ndbm_map_open</CODE>)and Berkeley DB (the <CODECLASS="literal">hash_map_open</CODE>) type database files areavailable. Sun style NIS maps (the <CODECLASS="literal">nis_map_open</CODE>) are alsoavailable. The others (<CODECLASS="literal">text</CODE>, <CODECLASS="literal">stab</CODE>, <CODECLASS="literal">impl</CODE>, <CODECLASS="literal">user</CODE>,and <CODECLASS="literal">switch</CODE>) are always automatically included.Note that <CODECLASS="literal">hesiod</CODE> and <CODECLASS="literal">nisplus</CODE> maps are not supported by this particular <EMCLASS="emphasis">sendmail</EM> binary.</P><PCLASS="para">If you download and compile <EMCLASS="emphasis">sendmail</EM> yourself, you may includeany supported databases.  Support is declared onthe DBMDEF= line in the appropriate <EMCLASS="emphasis">Makefile</EM> for your system. Possible definitions for DBMDEF= are shown in<ACLASS="xref"HREF="ch33_01.htm#SML2-CH-33-TAB-0"TITLE="DBMDEF Definitions in Makefile">Table 33.1</A>.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="SML2-CH-33-TAB-0">Table 33.1: DBMDEF Definitions in Makefile</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Definition</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1"></TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Database Support Included</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">-DHESIOD</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch33_08.htm#SML2-CH-33-SECT-8-6"TITLE="">Section 33.8.6</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><EMCLASS="emphasis">hesiod</EM>(3) aliases only</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">-DLDAPMAP</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch33_08.htm#SML2-CH-33-SECT-8-9"TITLE="">Section 33.8.9, ldapx</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><EMCLASS="emphasis">ldap</EM>(3) white pages</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">-DNDBM</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch33_08.htm#SML2-CH-33-SECT-8-3"TITLE="">Section 33.8.3</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><EMCLASS="emphasis">ndbm</EM>(3) database files</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">-DNEWDB</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch33_08.htm#SML2-CH-33-SECT-8-1"TITLE="">Section 33.8.1, btree</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Berkeley <EMCLASS="emphasis">db</EM>(3) database files</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">-DNIS</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch33_08.htm#SML2-CH-33-SECT-8-11"TITLE="">Section 33.8.11, nis</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Sun NIS network databases</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">-DNISPLUS</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch33_08.htm#SML2-CH-33-SECT-8-12"TITLE="">Section 33.8.12, nisplus</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Sun NIS+ network databases</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">-DNETINFO</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><ACLASS="xref"HREF="ch33_08.htm#SML2-CH-33-SECT-8-10"TITLE="">Section 33.8.10, netinfo</A></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">NeXT <EMCLASS="emphasis">netinfo</EM>(3) aliases only</TD></TR></TBODY></TABLE><PCLASS="para">For example,the <EMCLASS="emphasis">Makefile.ULTRIX</EM> file might include this line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">DBMDEF= -DNDBM -DNEWDB -DNIS</PRE></BLOCKQUOTE></P><PCLASS="para">which includes support for <EMCLASS="emphasis">ndbm</EM>(3), <EMCLASS="emphasis">db</EM>(3), and <EMCLASS="emphasis">nis</EM>(3)databases,[2]whereas the <EMCLASS="emphasis">Makefile.SunOS.5.x</EM> file might include the following:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] If you declare support for both NDBM and NEWDB, be sure to remove<EMCLASS="emphasis">ndbm.h</EM> and <EMCLASS="emphasis">ndbm.o</EM> from the NEWDB distribution. Failure toremove them will confuse <EMCLASS="emphasis">sendmail</EM>, causing it to fail inugly ways.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">DBMDEF= -DNDBM -DNIS -DNISPLUS</PRE></BLOCKQUOTE></P><PCLASS="para">which excludes <EMCLASS="emphasis">db</EM>(3) support but includes <EMCLASS="emphasis">nisplus</EM>(3) support.</P><PCLASS="para">If you omit all database support (by undefining DBMDEF, for example,or not supplying support indications after the equal sign), <EMCLASS="emphasis">sendmail</EM> willbe unable to maintain its aliases in database format. Also, anyattempt to rebuild the aliases database (with <EMCLASS="emphasis">newalias</EM> orwith <CODECLASS="literal">-bi</CODE>) will fail with the following error message:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Cannot rebuild aliases: no database format definedCannot create database for alias file /etc/aliases: No such device</PRE></BLOCKQUOTE></P><PCLASS="para">Note that if you add new map types, you may have to also add librariesto the LIBS= line in your <EMCLASS="emphasis">Makefile</EM>.<ACLASS="indexterm"NAME="AUTOID-37027"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch32_05.htm"TITLE="32.5 Alphabetized Reference"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 32.5 Alphabetized Reference"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch33_02.htm"TITLE="33.2 Create Files with makemap"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 33.2 Create Files with makemap"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">32.5 Alphabetized Reference</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">33.2 Create Files with makemap</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>