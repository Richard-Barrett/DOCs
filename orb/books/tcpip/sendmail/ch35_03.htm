<HTML><HEAD><TITLE>[Chapter 35] 35.3 Header Field Contents</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T21:47:50Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch35_01.htm"TITLE="35. Headers"><LINKREL="prev"HREF="ch35_02.htm"TITLE="35.2 Header Names"><LINKREL="next"HREF="ch35_04.htm"TITLE="35.4 ?flags? in Header Definitions"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch35_02.htm"TITLE="35.2 Header Names"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 35.2 Header Names"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 35<BR>Headers</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch35_04.htm"TITLE="35.4 ?flags? in Header Definitions"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 35.4 ?flags? in Header Definitions"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-35-SECT-3">35.3 Header Field Contents</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-35-IX-TOKENIZATION-OF-HEADER-FIELD-CONTENTS-HEADER-FIELD-CONTENTS"></A><ACLASS="indexterm"NAME="SML2-CH-35-IX-HEADERS-MESSAGE-FIELD-CONTENTS"></A>The <CODECLASS="replaceable"><I>field</I></CODE> of the <CODECLASS="literal">H</CODE> configuration commandmay contain any ASCII characters, including whitespaceand newlines that result from joining. For most headers, however,those characters must obey the following rules for grouping:[2]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] This discussion is adapted from RFC822.</P></BLOCKQUOTE><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">Atom</EM></DT><DDCLASS="listitem"><PCLASS="para">In the header <CODECLASS="replaceable"><I>field</I></CODE>, space characters separateone item from another. Each space-delimited item is further subdividedby specials (see below), into atoms.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">smtp          <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> an atom</I>foo@host      <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> atom special atom</I>Babe Ruth     <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> atom atom</I></PRE></BLOCKQUOTE></P><PCLASS="para">An atom is the smallest unit in a header and may not containany control characters. When the <CODECLASS="replaceable"><I>field</I></CODE> is an address, an atomis the same thing as a token (see <ACLASS="xref"HREF="ch28_01.htm"TITLE="Rules">Chapter 28, <CITECLASS="chapter">Rules</CITE></A>).</P></DD><DTCLASS="term"><EMCLASS="emphasis">Specials</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-48194"></A>The special characters are those used to separate one componentof an address from another. They are internally defined as:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">( ) &lt; &gt; @ , ; : \ &quot; . [ ]</PRE></BLOCKQUOTE></P><PCLASS="para">A special character can be made nonspecial by preceding it witha backslash character, for example,</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">foo;fum       <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> atom special atom</I>foo\;fum      <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> one atom</I></PRE></BLOCKQUOTE></P><PCLASS="para">The space and tab characters are also used to separate atoms andcan be thought of as specials.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Quoted text</EM></DT><DDCLASS="listitem"><PCLASS="para">Quotation marks can be used to force multiple items to betreated as a single atom. For example,</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Babe Ruth       <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> atom atom</I>&quot;Babe Ruth&quot;     <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> a single atom</I></PRE></BLOCKQUOTE></P><PCLASS="para">Quoted text may contain any characters except the quotation mark(<CODECLASS="literal">&quot;</CODE>) and the backslash character (<CODECLASS="literal">\</CODE>).</P></DD><DTCLASS="term"><EMCLASS="emphasis">Any text</EM></DT><DDCLASS="listitem"><PCLASS="para">Some headers, such as <CODECLASS="literal">Subject:</CODE> (see <ACLASS="xref"HREF="ch35_10.htm#SML2-CH-35-SECT-10-31"TITLE="">Section 35.10.31, Subject:</A>), impose no rules onthe text in the header <CODECLASS="replaceable"><I>field</I></CODE>. For such headers, atoms,specials, and quotes have no significance, and the entire fieldis taken as arbitrary text.</P></DD></DL><PCLASS="para">The detailed requirements of each header name are covered at theend of this chapter.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-35-SECT-3-1">35.3.1 Macros in the Header Field</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-48229"></A>Macros may appear in any position in the <CODECLASS="replaceable"><I>field</I></CODE> of a headerdefinition line. Such macros are not expanded (their values tested or used)until mail is queued or delivered. For the meaning of each macro name and a description of when each is given a value, see <ACLASS="xref"HREF="ch31_01.htm"TITLE="Defined Macros">Chapter 31, <CITECLASS="chapter">Defined Macros</CITE></A>.</P><PCLASS="para">Only two macro prefixes may be used in the <CODECLASS="replaceable"><I>field</I></CODE> ofheader definitions:$ The <CODECLASS="literal">$</CODE> prefix tells <EMCLASS="emphasis">sendmail</EM> to replace the macro'sname with its value at that place in the <CODECLASS="replaceable"><I>field</I></CODE> definition.$? The <CODECLASS="literal">$?</CODE> prefix tells <EMCLASS="emphasis">sendmail</EM> to perform conditionalreplacement of a macro's value.</P><PCLASS="para">For example, the following header definitionuses the <CODECLASS="literal">$</CODE> prefix to insert thevalue of the macro <CODECLASS="literal">x</CODE> into the header field:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">HFull-Name: $x</PRE></BLOCKQUOTE></P><PCLASS="para">The macro <CODECLASS="literal">$x</CODE> (see <ACLASS="xref"HREF="ch31_10.htm#SML2-CH-31-SECT-10-42"TITLE="">Section 31.10.42, $x</A>)contains as its value the full name of the sender.</P><PCLASS="para">When the possibility exists that a macro will not have a value at thetime the header line is processed, the <CODECLASS="literal">$?</CODE> conditional prefix (see <ACLASS="xref"HREF="ch31_06.htm"TITLE="Macro Conditionals: $?, $|, and $.">Section 31.6, "Macro Conditionals: $?, $|, and $."</A>) may be used:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">HReceived: $?sfrom $s $.by $j ($v/$V)</PRE></BLOCKQUOTE></P><PCLASS="para">Here, the <CODECLASS="literal">$?</CODE> prefix and <CODECLASS="literal">$.</CODE> operator cause the text</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">from $s</PRE></BLOCKQUOTE></P><PCLASS="para">to be inserted into the header field <EMCLASS="emphasis">only</EM> if the macro <CODECLASS="literal">s</CODE>has a value. <CODECLASS="literal">$s</CODE> may contain as its value thename of the sending site.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-35-SECT-3-2">35.3.2 Escape Character in the Header Field</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-48266"></A><ACLASS="indexterm"NAME="AUTOID-48268"></A><ACLASS="indexterm"NAME="AUTOID-48271"></A>Recall that the backslash escapecharacter (<CODECLASS="literal">\</CODE>) is used to deprive the specialcharacters of their special meaning.In the <CODECLASS="literal">field</CODE> of header definitions the escape charactermay be used only inside quoted strings (see next item), in domainliterals (addresses enclosed in square bracket pairs), or in comments(see below).Specifically, this means that the escape character may <EMCLASS="emphasis">not</EM>be used within atoms. Therefore the following is not legal:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Full\ Name@domain        <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> not legal</I></PRE></BLOCKQUOTE></P><PCLASS="para">&#13;Instead, the atom to the left of the <CODECLASS="literal">@</CODE> must be isolatedwith quotation marks:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&quot;Full Name&quot;@domain        <ICLASS="lineannotation"><IMGSRC="../chars/larr.gif"ALT="&lt;-"> legal</I></PRE></BLOCKQUOTE></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-35-SECT-3-3">35.3.3 Quoted Strings in the Header Field</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-48288"></A>Recall that quotation marks (<CODECLASS="literal">&quot;</CODE>) force arbitrarytext to be viewed as a single atom. Arbitrary text is everything(including joined lines) that begins with the first quotation mark andends with the final quotation mark. The followingexample illustrates two quoted strings:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&quot;Full Name&quot;&quot;One long string carried over        two lines by indenting the second&quot;   <IMGSRC="../chars/uarr.gif"ALT="-^">   <ICLASS="lineannotation">whitespace</I></PRE></BLOCKQUOTE></P><PCLASS="para">The quotation mark character may appear inside a quotedstring only if it is escaped by using a backslash.[3]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] Note that the backslash itself may not appear within full quotationmarks.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&quot;George Herman \&quot;Babe\&quot; Ruth&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">Internally, <EMCLASS="emphasis">sendmail</EM> does not check for balanced quotation marks.If it finds the first but not the second, it takes everything up to the end of the line as the quoted string.</P><PCLASS="para">When quotation marks are used in an <CODECLASS="literal">H</CODE> configuration command,they must be balanced. Although <EMCLASS="emphasis">sendmail</EM> remains silent,unbalanced quotation marks can cause serious problems when theyare propagated to other programs.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-35-SECT-3-4">35.3.4 Comments in the Header Field</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-48308"></A>Comments consist of text inside a header <CODECLASS="replaceable"><I>field</I></CODE> that is intended to give humansadditional information.Comments are saved internally by <EMCLASS="emphasis">sendmail</EM> when processing headers,then are restored, but otherwise are not used.Beginning with V8.7 <EMCLASS="emphasis">sendmail</EM>, the <CODECLASS="literal">F=c</CODE> delivery agentflag (see <ACLASS="xref"HREF="ch30_08.htm#SML2-CH-30-SECT-8-14"TITLE="">Section 30.8.14, F=c</A>) can be used to prevent restorationof the saved comments.</P><PCLASS="para">A comment begins with a left parenthesis and ends with a right parenthesis.Comments may nest. The following lines illustrate a non-nested commentand a comment nested inside another:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">(this is a comment)(text(this is a comment nested inside another)text)</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;Comments may be split over multiple lines by indenting:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">(this is a comment       split into two lines)   <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>   <ICLASS="lineannotation">whitespace</I></PRE></BLOCKQUOTE></P><PCLASS="para">A comment (even if nested) separates one atom from anotherjust like a space or a tab does.Therefore the following produces two atoms rather than one:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Bill(postmaster)Johnson</PRE></BLOCKQUOTE></P><PCLASS="para">However, comments inside quoted strings are not special, so thefollowing produces a single atom:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&quot;Bill(postmaster)Johnson&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">Parentheses may exist inside of comments only if they are escapedwith a backslash:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&lt;root@host.domain&gt; (The happy administrator ;-\))                                              <ICLASS="lineannotation"><IMGSRC="../chars/uarr.gif"ALT="-^"></I>                                              <ICLASS="lineannotation">note</I></PRE></BLOCKQUOTE></P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="SML2-CH-35-SECT-3-4-1">35.3.4.1 Balancing special characters</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-48338"></A>Many of the special characters that are used in the header <CODECLASS="replaceable"><I>field</I></CODE> andin addresses need to appear in balanced pairs. <ACLASS="xref"HREF="ch35_03.htm#SML2-CH-35-TAB-0"TITLE="Balancing Characters">Table 35.1</A>shows these characters and the characters needed to balance them.Failure to maintain balance can lead to failed mail.Note that only parentheses may be nested. None of the other balanced pairsmay nest.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="SML2-CH-35-TAB-0">Table 35.1: Balancing Characters</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Begin</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">End</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">(</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">)</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">[</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">]</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&lt;</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&gt;</TD></TR></TBODY></TABLE><PCLASS="para">You have already seen the quoted string and comments. The angle brackets(<CODECLASS="literal">&lt;</CODE> and <CODECLASS="literal">&gt;</CODE>) are used to specify a machine-readableaddress, such as <CODECLASS="literal">&lt;gw@wash.dc.gov&gt;</CODE>. The square brackets (<CODECLASS="literal">[</CODE>and <CODECLASS="literal">]</CODE>) are used to specify a direct Internet address (one thatbypasses normal DNS name lookups) such as <CODECLASS="literal">[123.45.67.89]</CODE>.</P><PCLASS="para">The <EMCLASS="emphasis">sendmail</EM> program gives warnings about unbalanced charactersonly when it is attempting to extract an address from a header definition,from the header line of a mail message, orfrom the envelope. Beginning with V8.6, when <EMCLASS="emphasis">sendmail</EM> finds an unbalanced condition,it tries to balance the offending characters as rationally as possible. Whether or not it can balance them, it printsone of the following warning messages:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Unbalanced ')'Unbalanced '&gt;'Unbalanced '('Unbalanced '&lt;'Unbalanced '&quot;'</PRE></BLOCKQUOTE></P><PCLASS="para">If it did not succeed in balancing them, the mail will probably bounce.<ACLASS="indexterm"NAME="AUTOID-48376"></A><ACLASS="indexterm"NAME="AUTOID-48377"></A></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch35_02.htm"TITLE="35.2 Header Names"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 35.2 Header Names"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch35_04.htm"TITLE="35.4 ?flags? in Header Definitions"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 35.4 ?flags? in Header Definitions"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">35.2 Header Names</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">35.4 ?flags? in Header Definitions</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>