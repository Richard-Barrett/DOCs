<HTML><HEAD><TITLE>[Chapter 35] 35.8 Precedence</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T21:52:44Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch35_01.htm"TITLE="35. Headers"><LINKREL="prev"HREF="ch35_07.htm"TITLE="35.7 Forwarding with Resent-Headers"><LINKREL="next"HREF="ch35_09.htm"TITLE="35.9 Pitfalls"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch35_07.htm"TITLE="35.7 Forwarding with Resent-Headers"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 35.7 Forwarding with Resent-Headers"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 35<BR>Headers</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch35_09.htm"TITLE="35.9 Pitfalls"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 35.9 Pitfalls"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-35-SECT-8">35.8 Precedence</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-49321"></A><ACLASS="indexterm"NAME="SML2-CH-35-IX-PRIORITY-MESSAGE"></A>The costof a mail message determines its ability to be sentdespite a high machine loadand its position in the queue when the queue is processed.Each mail message has a priority and a cost.The initial priority (class) of a mail message is defined by the optionalpresence of a <CODECLASS="literal">Precedence:</CODE> header line inside the messagewith a symbol corresponding to a value defined by <CODECLASS="literal">P</CODE> configuration command.<ACLASS="indexterm"NAME="SML2-CH-35-IX-LQPRECEDENCE-RQ-HEADER-LINE-PRECEDENCE-HEADER-LINE"></A>For example, if your <EMCLASS="emphasis">sendmail.cf</EM> file contained this line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Pspecial-delivery=100</PRE></BLOCKQUOTE></P><PCLASS="para">and your mail message header contained this line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Precedence: special-delivery</PRE></BLOCKQUOTE></P><PCLASS="para">then your mail message would begin its life with a classof 100. We'll cover how this is done soon.</P><PCLASS="para">After the message's initial class value is set, that valueis never changed. As soon as the class is determined, theinitial cost is calculated. This costis the value that is used to determine if a message will be sentdespite a high machine load (defined by the <CODECLASS="literal">RefuseLA</CODE> (<CODECLASS="literal">X</CODE>) option, see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-54"TITLE="">Section 34.8.54, RefuseLA (X)</A>,and the <CODECLASS="literal">QueueLA</CODE> (<CODECLASS="literal">x</CODE>) option, see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-50"TITLE="">Section 34.8.50, QueueLA (x)</A>)and to determine its order in queue processing.The formula for the initial calculation is the following:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">cost = nbytes - (class * z) + (recipients * y)</PRE></BLOCKQUOTE></P><PCLASS="para">Where <CODECLASS="literal">nbytes</CODE> is the total size in bytes of the message,<CODECLASS="literal">recipients</CODE> is either the number of recipients in the envelopeor (with <CODECLASS="literal">-t</CODE>) the number of recipients specifiedin the <CODECLASS="literal">To:</CODE>, <CODECLASS="literal">Cc:</CODE>, and <CODECLASS="literal">Bcc:</CODE> header lines(after alias expansion),and <CODECLASS="literal">z</CODE> and <CODECLASS="literal">y</CODE> are the values of the<CODECLASS="literal">ClassFactor</CODE> (<CODECLASS="literal">z</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-8"TITLE="">Section 34.8.8, ClassFactor (z)</A>)and the <CODECLASS="literal">RecipientFactor</CODE> (<CODECLASS="literal">y</CODE>) option (see <ACLASS="xref"HREF="ch34_08.htm#SML2-CH-34-SECT-8-53"TITLE="">Section 34.8.53, RecipientFactor (y)</A>).</P><PCLASS="para">The <CODECLASS="literal">Precedence:</CODE> header should rarely be declared in the configurationfile. Instead, it is added to messages by MUAs and by mailing-listsoftware. If it is declared in the configuration file, it shouldbe prefixed with an appropriate <CODECLASS="literal">?</CODE><CODECLASS="replaceable"><I>flag</I></CODE><CODECLASS="literal">?</CODE> (see <ACLASS="xref"HREF="ch35_04.htm"TITLE="?flags? in Header Definitions">Section 35.4</A>)so that it is inserted only for an appropriate delivery agent.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-35-SECT-8-1">35.8.1 The P Configuration Command</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-35-IX-P-CONFIGURATION-COMMAND"></A>The <CODECLASS="literal">P</CODE> configuration command must begin a line. This commandis composed of four parts:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">P<CODECLASS="replaceable"><I>string=value</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="replaceable"><I>string</I></CODE> is text, such as <CODECLASS="literal">special-delivery</CODE>. Everythingbetween the <CODECLASS="literal">P</CODE> and the <CODECLASS="replaceable"><I>=</I></CODE> (<EMCLASS="emphasis">including</EM> any whitespace) is taken as is for <CODECLASS="replaceable"><I>string</I></CODE>.The <CODECLASS="replaceable"><I>value</I></CODE> is evaluated as a signed integer and may bedecimal, octal (with a leading 0), or hexadecimal (with a leading 0x).</P><PCLASS="para">Although you may define any <CODECLASS="replaceable"><I>string</I></CODE> you choose, only fivehave any universal meaning. Those five usually appear in <EMCLASS="emphasis">sendmail.cf</EM>files like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Pspecial-delivery=100Pfirst-class=0Plist=-30Pjunk=-60Pbulk=-200</PRE></BLOCKQUOTE></P><PCLASS="para">You may, of course, define your own precedence strings for internal mail, butthey will be ignored (evaluate to 0) by all outside <EMCLASS="emphasis">sendmail</EM>programs.</P><PCLASS="para">The classes <CODECLASS="literal">junk</CODE> and <CODECLASS="literal">bulk</CODE> are also recognized bymany other programs. Newer versions of the<EMCLASS="emphasis">vacation</EM>(1) program, for example, silently skip replyingto messages that have a <CODECLASS="literal">Precedence:</CODE> header line of<CODECLASS="literal">junk</CODE> or <CODECLASS="literal">bulk</CODE>.</P><PCLASS="para">As a general rule, <CODECLASS="literal">special-delivery</CODE> is rarely used. Mostmail has a class of <CODECLASS="literal">first-class</CODE>. Mailing lists should always have a class of <CODECLASS="literal">list</CODE> or <CODECLASS="literal">bulk</CODE>.</P><PCLASS="para">Because your local <EMCLASS="emphasis">sendmail.cf</EM> file is where values are given to these class names, you are free to modify those values locally. The valuesaffect only the delivery at your site.</P><PCLASS="para">Old versions of <EMCLASS="emphasis">sendmail</EM> didn't return errors on messages witha negative precedence. V8 <EMCLASS="emphasis">sendmail</EM> does but omits the messagebody.<ACLASS="indexterm"NAME="AUTOID-49409"></A><ACLASS="indexterm"NAME="AUTOID-49410"></A><ACLASS="indexterm"NAME="AUTOID-49411"></A>&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch35_07.htm"TITLE="35.7 Forwarding with Resent-Headers"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 35.7 Forwarding with Resent-Headers"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch35_09.htm"TITLE="35.9 Pitfalls"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 35.9 Pitfalls"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">35.7 Forwarding with Resent-Headers</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">35.9 Pitfalls</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>