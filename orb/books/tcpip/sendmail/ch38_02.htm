<HTML><HEAD><TITLE>[Chapter 38] 38.2 Configuration Lines</TITLE><METANAME="DC.title"CONTENT="sendmail"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-01-06T22:47:33Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-222-0"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch38_01.htm"TITLE="38. Rule-Set Testing with -bt"><LINKREL="prev"HREF="ch38_01.htm"TITLE="38.1 Overview"><LINKREL="next"HREF="ch38_03.htm"TITLE="38.3 Dump a Macro"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ssrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch38_01.htm"TITLE="38.1 Overview"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 38.1 Overview"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 38<BR>Rule-Set Testing with -bt</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch38_03.htm"TITLE="38.3 Dump a Macro"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 38.3 Dump a Macro"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="SML2-CH-38-SECT-2">38.2 Configuration Lines</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="SML2-CH-38-IX-SENDMAIL-CF-CONFIGURATION-FILE-RULE-TESTING-MODE-AND"></A>Selected configuration file lines can be entered in rule-testing mode.They will behave just as they do when being read from the configurationfile. Currently (as of V8.8 <EMCLASS="emphasis">sendmail</EM>), three configurationcommands are honored:</P><DLCLASS="variablelist"><DTCLASS="term"><CODECLASS="literal">#</CODE></DT><DDCLASS="listitem"><PCLASS="para">Commands that begin with a <CODECLASS="literal">#</CODE> are treated as comments andignored. Blank lines are also ignored.</P></DD><DTCLASS="term"><CODECLASS="literal">D</CODE></DT><DDCLASS="listitem"><PCLASS="para">The <CODECLASS="literal">D</CODE> configuration command (see <ACLASS="xref"HREF="ch31_03.htm"TITLE="Configuration File Definitions">Section 31.3, "Configuration File Definitions"</A>)is used to define a macro. Both single-character and multicharacter macronames may be used.</P></DD><DTCLASS="term"><CODECLASS="literal">C</CODE></DT><DDCLASS="listitem"><PCLASS="para">The <CODECLASS="literal">C</CODE> configuration command (see <ACLASS="xref"HREF="ch32_01.htm#SML2-CH-32-SECT-1"TITLE="Class Configuration Commands">Section 32.1, "Class Configuration Commands"</A>)is used to add a value to a class. Both single-character and multicharacter classnames may be used.</P></DD></DL><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-61650"></A>The <CODECLASS="literal">#</CODE> may begin a line. The other two configuration commands in rule-testing mode must beginwith a dot. Failure to use a dot will produce this error message:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">No address!</PRE></BLOCKQUOTE></P><PCLASS="para">The use of any character other than the two listed will produce this error:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Unknown &quot;.&quot; command .<ICLASS="lineannotation">bad command here</I></PRE></BLOCKQUOTE></P><PCLASS="para">To get a usage message, just type a dot:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>.</B></CODE>Usage: .[DC]macro value(s)</PRE></BLOCKQUOTE></P><PCLASS="para"></P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-38-SECT-2-1">38.2.1 Define a Macro with .D</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-61667"></A><ACLASS="indexterm"NAME="AUTOID-61670"></A><ACLASS="indexterm"NAME="AUTOID-61673"></A>The <CODECLASS="literal">.D</CODE> rule testing command is used to define a macro.One use for this command might be to modify a rule that dependson the <CODECLASS="literal">$&amp;</CODE> prefix (see <ACLASS="xref"HREF="ch31_05.htm#SML2-CH-31-SECT-5-3"TITLE="Use Value as Is with $&amp;">Section 31.5.3, "Use Value as Is with $&amp;"</A>).For example, consider the rule in rule set 0 that is intendedis to deliver a local user's address via the <CODECLASS="literal">local</CODE> delivery agent: </P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">R$+      $#local $@ $&amp;X $: $1</PRE></BLOCKQUOTE></P><PCLASS="para">If <CODECLASS="literal">$X</CODE> has a value, this rule returns it as the host (the <CODECLASS="literal">$@</CODE>) part of a rule set 0 triple. If <CODECLASS="literal">$X</CODE>lacks a value, the host part is empty. This technique isuseful because the <CODECLASS="literal">$@</CODE> part with the <CODECLASS="literal">local</CODE>delivery agent is used to implement plussed users (see <ACLASS="xref"HREF="ch24_04.htm#SML2-CH-24-SECT-4-3"TITLE="Plussed Users">Section 24.4.3, "Plussed Users"</A>).</P><PCLASS="para">This scheme can be tested in rule-testing mode by first specifyinga local user with <CODECLASS="literal">$X</CODE> undefined:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>0 bob</B></CODE>rewrite: ruleset   0   input: bobrewrite: ruleset   0 returns: $# local $@ $: bob</PRE></BLOCKQUOTE></P><PCLASS="para">This form of rule testing and the output produced are describedin detail in <ACLASS="xref"HREF="ch38_06.htm"TITLE="Process-Specified Addresses">Section 38.6</A>. Here it is important only to notethat the host part of the triple (<CODECLASS="literal">the $@</CODE> part) is empty.</P><PCLASS="para">Now use the <CODECLASS="literal">.D</CODE> command to give <CODECLASS="literal">$X</CODE> the value <CODECLASS="literal">home</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>.DXhome</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Now test those rules again:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>0 bob</B></CODE>rewrite: ruleset   0   input: bobrewrite: ruleset   0 returns: $# local $@ home $: bob</PRE></BLOCKQUOTE></P><PCLASS="para">This time the host part of the triple (<CODECLASS="literal">the $@</CODE> part)has the value <CODECLASS="literal">host</CODE> as intended.</P><PCLASS="para">The <CODECLASS="literal">.D</CODE> command can also be used to redefine the value ofexisting macros. It may not, however, be used to redefine macrosused in rules (except for <CODECLASS="literal">$&amp;</CODE>), because macros are expandedas rules are read from the configuration file. (See <ACLASS="xref"HREF="ch31_05.htm#SML2-CH-31-SECT-5-2"TITLE="When Is a Macro Expanded?">Section 31.5.2, "When Is a Macro Expanded?"</A>and <ACLASS="xref"HREF="ch38_03.htm#SML2-CH-38-SECT-3-1"TITLE="Dump a Defined Macro with $">Section 38.3.1</A>; describes how to view macro values in rule-testing mode.)</P><PCLASS="para">Internally, the <CODECLASS="literal">.D</CODE> command calls three routines, two ofwhich you can watch.First it calls <EMCLASS="emphasis">macid</EM>() to translate a macro name into aninteger index. This can be watched with the <CODECLASS="literal">-d35.14</CODE> debuggingswitch (see <ACLASS="xref"HREF="ch37_05.htm#SML2-CH-37-SECT-5-121"TITLE="">Section 37.5.121, -d35.14</A>). Second, it calls <EMCLASS="emphasis">translate_dollars</EM>()to convert the <CODECLASS="literal">$x</CODE> form into its internal form. This stepcannot be watched. Finally, it calls <EMCLASS="emphasis">define</EM>() to actuallydefine the macro. This step can be watched with the <CODECLASS="literal">-d35.9</CODE>debugging switch (see <ACLASS="xref"HREF="ch37_05.htm#SML2-CH-37-SECT-5-120"TITLE="">Section 37.5.120, -d35.9</A>).&#13;</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="SML2-CH-38-SECT-2-2">38.2.2 Add to a Class with .C</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-61728"></A><ACLASS="indexterm"NAME="AUTOID-61730"></A><ACLASS="indexterm"NAME="AUTOID-61733"></A>The <CODECLASS="literal">.C</CODE> rule testing command is used to add a member toa class. If the class does not exist, it is created.One possible use for this command would be to test whether addinga member to <CODECLASS="literal">$=w</CODE> will have the effect you desire.For example, suppose that a new alias called <CODECLASS="literal">mailhub</CODE> has been createdfor the local host. In the following, we test <EMCLASS="emphasis">sendmail</EM> to see whether itwill detect that new name as local:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>3,0 bob@mailhub</B></CODE>rewrite: ruleset   3   input: bob @ mailhubrewrite: ruleset   3 returns: bob &lt; @ mailhub &gt;rewrite: ruleset   0   input: bob &lt; @ mailhub &gt;rewrite: ruleset   0 returns: $# smtp $@ mailhub $: bob &lt; @ mailhub</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;This form of rule testing and the outputthat is produced are describedin detail in <ACLASS="xref"HREF="ch38_06.htm"TITLE="Process-Specified Addresses">Section 38.6</A>. Here, merely note thatthe <CODECLASS="literal">smtp</CODE> delivery agent was selected, suggesting that<EMCLASS="emphasis">mailhub</EM> was not automatically recognized as local.</P><PCLASS="para">One way to fix this is to add <EMCLASS="emphasis">mailhub</EM>to the class <CODECLASS="literal">$=w</CODE> (see <ACLASS="xref"HREF="ch32_05.htm#SML2-CH-32-SECT-5-8"TITLE="">Section 32.5.8, $=w</A>).In rule-testing mode this can be done by using the <CODECLASS="literal">.C</CODE> command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; <CODECLASS="userinput"><B>.Cw mailhub</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Now feed <EMCLASS="emphasis">sendmail</EM> the same rules and address as beforeto see whether this fixed the problem:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&gt; 3,0 bob@mailhubrewrite: ruleset   3   input: bob @ mailhubrewrite: ruleset   3 returns: bob &lt; @ mailhub . &gt;rewrite: ruleset   0   input: bob &lt; @ mailhub . &gt;rewrite: ruleset   0 returns: $# local $: bob</PRE></BLOCKQUOTE></P><PCLASS="para">Success! Adding <EMCLASS="emphasis">mailhub</EM> to the class <CODECLASS="literal">$=w</CODE> fixedthe problem. You could now make that change permanentby editing the configuration file or by adding the nameto the <EMCLASS="emphasis">sendmail.cw</EM> file (see <ACLASS="xref"HREF="ch19_06.htm#SML2-CH-19-SECT-6-26"TITLE="">Section 19.6.26, FEATURE(use-cw-file)</A>).</P><PCLASS="para">Another use for <CODECLASS="literal">.C</CODE> would includetrying out masquerading for a subdomain. (See <ACLASS="xref"HREF="ch19_06.htm#SML2-CH-19-SECT-6-12"TITLE="">Section 19.6.12, FEATURE(limited-masquerade)</A>. See also <ACLASS="xref"HREF="ch38_03.htm#SML2-CH-38-SECT-3-2"TITLE="Dump a Class Macro with $=">Section 38.3.2</A> for a way to print the membersof a class while in rule-testing mode.)</P><PCLASS="para">Internally, the <CODECLASS="literal">.C</CODE> command calls four routines,but you can watch only three.First it calls <EMCLASS="emphasis">macid</EM>() to translate a macro name into aninteger index. This can be watched with the <CODECLASS="literal">-d35.14</CODE> debuggingswitch (see <ACLASS="xref"HREF="ch37_05.htm#SML2-CH-37-SECT-5-121"TITLE="">Section 37.5.121</A>). Second, it calls <EMCLASS="emphasis">translate_dollars</EM>()to convert the <CODECLASS="literal">$=x</CODE> form into its internal form. This stepcannot be watched.Third, it calls <EMCLASS="emphasis">expand</EM>() to expand any macros that appear inthe list of words. This may be watched with the <CODECLASS="literal">-d35.24</CODE>debugging switch (see <ACLASS="xref"HREF="ch37_05.htm#SML2-CH-37-SECT-5-122"TITLE="">Section 37.5.122, -d35.24</A>).Finally, for each word that it adds to the class, it calls <EMCLASS="emphasis">setclass</EM>(),which can be watched with the <CODECLASS="literal">-d37.8</CODE> debugging switch(see <ACLASS="xref"HREF="ch37_05.htm#SML2-CH-37-SECT-5-127"TITLE="">Section 37.5.127, -d37.8</A>).<ACLASS="indexterm"NAME="AUTOID-61781"></A>&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch38_01.htm"TITLE="38.1 Overview"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 38.1 Overview"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail"><IMGSRC="../gifs/txthome.gif"ALT="sendmail"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch38_03.htm"TITLE="38.3 Dump a Macro"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 38.3 Dump a Macro"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">38.1 Overview</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">38.3 Dump a Macro</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>