<HTML><HEAD><TITLE>[Chapter 4] Configuring with m4</TITLE><METANAME="DC.title"CONTENT="sendmail Desktop Reference"><METANAME="DC.creator"CONTENT="Bryan Costales &amp; Eric Allman"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T00:04:33Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-278-6"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="index.htm"TITLE="sendmail Desktop Reference"><LINKREL="prev"HREF="ch03_10.htm"TITLE="3.10 Hints"><LINKREL="next"HREF="ch04_02.htm"TITLE="4.2 FEATURE Declarations"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="sendmail Desktop Reference"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="sendmail Desktop Reference"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/rsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch03_10.htm"TITLE="3.10 Hints"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 3.10 Hints"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 4</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch04_02.htm"TITLE="4.2 FEATURE Declarations"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 4.2 FEATURE Declarations"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="SMQR-CH-4">4. Configuring with m4</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="SECT1"HREF="#SMQR-CH-4-SECT-1"TITLE="4.1 Special Local Parameters">Special Local Parameters</A><BR><ACLASS="SECT1"HREF="ch04_02.htm"TITLE="4.2 FEATURE Declarations">FEATURE Declarations</A><BR><ACLASS="SECT1"HREF="ch04_03.htm"TITLE="4.3 MAILER Declarations">MAILER Declarations</A><BR><ACLASS="SECT1"HREF="ch04_04.htm"TITLE="4.4 Virtual User Tables">Virtual User Tables</A><BR><ACLASS="SECT1"HREF="ch04_05.htm"TITLE="4.5 Mailer Tables">Mailer Tables</A><BR><ACLASS="SECT1"HREF="ch04_06.htm"TITLE="4.6 Hints">Hints</A></P><P></P></DIV><PCLASS="para">A configuration file is generated from an <EMCLASS="emphasis">m4</EM> source file(e.g., one named <EMCLASS="emphasis">our.mc</EM>)in the <EMCLASS="emphasis">cf/cf</EM> <EMCLASS="emphasis">sendmail</EM> source tree like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">m4  ../m4/cf.m4 <CODECLASS="replaceable"><I>our.mc</I></CODE> &gt; sendmail.cf</PRE></BLOCKQUOTE></P><PCLASS="para">To use a directory other than ..<EMCLASS="emphasis">/m4</EM>, use:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">m4 -D_CF_DIR_=<CODECLASS="replaceable"><I>path/</I></CODE> <CODECLASS="replaceable"><I>path</I></CODE>/m4/cf.m4 <CODECLASS="replaceable"><I>our.mc</I></CODE> &gt;   sendmail.cf</PRE></BLOCKQUOTE></P><PCLASS="para">Here, <EMCLASS="emphasis">path</EM> is the full path to the <EMCLASS="emphasis">m4/cf.m4</EM> file.The <EMCLASS="emphasis">our.mc</EM> sourcemay contain the following lines (in this order):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">OSTYPE(<CODECLASS="replaceable"><I>os</I></CODE>)DOMAIN(<CODECLASS="replaceable"><I>domain</I></CODE>)                      <CODECLASS="replaceable"><I><IMGSRC="../chars/larr.gif"ALT="&lt;-"> declare local parameters using </I></CODE>                         define<CODECLASS="replaceable"><I> here</I></CODE>FEATURE(<CODECLASS="replaceable"><I>feature</I></CODE>)      <CODECLASS="replaceable"><I><IMGSRC="../chars/larr.gif"ALT="&lt;-"> can be several</I></CODE>MAILER(<CODECLASS="replaceable"><I>agent</I></CODE>)         <CODECLASS="replaceable"><I><IMGSRC="../chars/larr.gif"ALT="&lt;-"> can be several</I></CODE>                      <CODECLASS="replaceable"><I><IMGSRC="../chars/larr.gif"ALT="&lt;-"> local rule set declarations here</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Thus, a minimal filewould declare the operating system and local delivery agent supportwith two lines like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">OSTYPE(<CODECLASS="replaceable"><I>os</I></CODE>)MAILER(local)</PRE></BLOCKQUOTE></P><PCLASS="para">In some cases you may see lines terminated with<BCLASS="emphasis.bold">dnl</B>, which means &quot;delete to new line.&quot; Its use prevents extra blank lines from appearing in the output.It is almost never required.For more details about the <EMCLASS="emphasis">m4</EM> technique in general,see &#167;19.2.&#13;</P><DLCLASS="variablelist"><DTCLASS="term"><BCLASS="emphasis.bold">OSTYPE</B></DT><DDCLASS="listitem"><PCLASS="para">Causes support to be included from one of the files inthe <EMCLASS="emphasis">cf/ostype</EM> directory.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">OSTYPE(<CODECLASS="replaceable"><I>os</I></CODE>)</PRE></BLOCKQUOTE></P><PCLASS="para">This sets defaults for your operating system from the file<EMCLASS="emphasis">cf/ostype/os.m4</EM> (as for example, <EMCLASS="emphasis">sunos4.1.m4</EM>).If you want to change any of the defaults that come withyour operating system's file, do so after declaring OSTYPE.(See &#167;19.3.1).&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">DOMAIN</B></DT><DDCLASS="listitem"><PCLASS="para">Collects together local paramater declarations for an (optional)administrative domain:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">DOMAIN(<CODECLASS="replaceable"><I>domain</I></CODE>)</PRE></BLOCKQUOTE></P><PCLASS="para">Here, <EMCLASS="emphasis">domain</EM> is the name of a file in the<EMCLASS="emphasis">cf/domain</EM> directory.With the exception of the file called <EMCLASS="emphasis">generic</EM>,you should create your own <EMCLASS="emphasis">domain</EM> file(see &#167;19.3.3).&#13;</P></DD><DTCLASS="term"><EMCLASS="emphasis">local parameter declarations</EM></DT><DDCLASS="listitem"><PCLASS="para">Are (mostly) named conf<EMCLASS="emphasis">NAME</EM>,and most all cases are declared using the <CODECLASS="literal">define</CODE>directive:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">define(`<CODECLASS="replaceable"><I>parameter_name</I></CODE>', `<CODECLASS="replaceable"><I>value</I></CODE>')</PRE></BLOCKQUOTE></P><PCLASS="para">the <EMCLASS="emphasis">parameter_name</EM>sdefine options and macros (see <ACLASS="xref"HREF="ch02_01.htm"TITLE="The sendmail.cf File">Chapter 2, <CITECLASS="chapter">The sendmail.cf File</CITE></A>).In some cases local parameters are declared using special macros;see the next section.&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">FEATURE</B></DT><DDCLASS="listitem"><PCLASS="para">Supplies simple solutions to special needs. The FEATUREdirective is described below.&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">MAILER</B></DT><DDCLASS="listitem"><PCLASS="para">Causes support for delivery agents to be included. It mustfollow local parameter declarations because some of themchange how a MAILER directive will be interpreted.MAILER is detailed following the features.&#13;</P></DD><DTCLASS="term"><EMCLASS="emphasis">local rule set declarations</EM></DT><DDCLASS="listitem"><PCLASS="para">Allow you to easily add rules and rule sets to your configurationfile.Each definition stands on a line by itself, and the lines following each are included in the appropriate placein the configuration file. For example:LOCAL_CONFIG to add general declarations (e.g., <BCLASS="emphasis.bold">K</B>configuration databases)that should go at the top of the configuration file(see &#167;19.6.30);LOCAL_RULE_0 to add rules to rule set 0(see &#167;19.6.32);LOCAL_RULE_1 to add rules to rule set 1(see &#167;19.6.33);LOCAL_RULE_2 to add rules to rule set 2(see &#167;19.6.34);LOCAL_RULE_3 to add rules to rule set 3(see &#167;19.6.35);and LOCAL_RULESETS to declare entirelynew rule sets, such as <BCLASS="emphasis.bold">check_relay</B>(see &#167;19.6.36).Also select from:LOCAL_NET_CONFIG (used in conjunction with LOCAL_RELAY)to add rules that tell what addressesshould <EMCLASS="emphasis">not</EM> be forwarded to the relay(see &#167;19.6.37);and MAILER_DEFINITIONS to define new delivery agents andthe rule sets associated with them(see &#167;19.6.40).&#13;</P></DD></DL><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="SMQR-CH-4-SECT-1">4.1 Special Local Parameters</A></H2><PCLASS="para">These lines should go in the DOMAIN file orbefore FEATURE declarations (becausethey precondition certain features).&#13;</P><DLCLASS="variablelist"><DTCLASS="term"><BCLASS="emphasis.bold">EXPOSED_USER(</B><EMCLASS="emphasis">user</EM><BCLASS="emphasis.bold">)</B></DT><DDCLASS="listitem"><PCLASS="para">&#13;(Used with MASQUERADE_AS) tells what users should not be masqueraded(see &#167;19.6.4).&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">GENERICS_DOMAIN(</B><EMCLASS="emphasis">domain</EM><BCLASS="emphasis.bold">)</B></DT><DDCLASS="listitem"><PCLASS="para">Lists the names of domains that will be looked up withthe <BCLASS="emphasis.bold">genericstable</B> feature. Declare one <EMCLASS="emphasis">domain</EM>per line. There may be several such lines.&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">GENERICS_DOMAIN_FILE(</B><EMCLASS="emphasis">file</EM><BCLASS="emphasis.bold">)</B></DT><DDCLASS="listitem"><PCLASS="para">Specifies the <EMCLASS="emphasis">file</EM> that contains the domainsthat will be looked up with the <BCLASS="emphasis.bold">generic\%stable</B> feature.&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">MASQUERADE_AS(</B><EMCLASS="emphasis">domain</EM><BCLASS="emphasis.bold">)</B></DT><DDCLASS="listitem"><PCLASS="para">Causes all outgoing addresses to be rewritten as thoughthey came from the indicated <EMCLASS="emphasis">domain</EM>(see &#167;19.6.42).&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">MASQUERADE_DOMAIN(</B><EMCLASS="emphasis">domain</EM><BCLASS="emphasis.bold">)</B></DT><DDCLASS="listitem"><PCLASS="para">Specifies additional <EMCLASS="emphasis">domain</EM>s that will be translatedinto the MASQUERADE_AS domain.See also the <BCLASS="emphasis.bold">limited_masquerade</B> feature(see &#167;19.6.43).&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">MASQUERADE_DOMAIN_FILE(</B><EMCLASS="emphasis">file</EM>)</DT><DDCLASS="listitem"><PCLASS="para">Specifies the name of the <EMCLASS="emphasis">file</EM>that contains a list of domains that will be masqueraded(see &#167;19.6.44).</P></DD></DL></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch03_10.htm"TITLE="3.10 Hints"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 3.10 Hints"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="sendmail Desktop Reference"><IMGSRC="../gifs/txthome.gif"ALT="sendmail Desktop Reference"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch04_02.htm"TITLE="4.2 FEATURE Declarations"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 4.2 FEATURE Declarations"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">3.10 Hints</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171">&nbsp;</TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">4.2 FEATURE Declarations</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="../tcpip/index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>