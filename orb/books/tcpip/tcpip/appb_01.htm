<HTML><HEAD><TITLE>[Appendix B] A gated Reference</TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:42:45Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="index.htm"TITLE="TCP/IP Network Administration"><LINKREL="prev"HREF="appa_03.htm"TITLE="A.3 chat"><LINKREL="next"HREF="appb_02.htm"TITLE="B.2 The gated Configuration Language"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appa_03.htm"TITLE="A.3 chat"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: A.3 chat"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Appendix B</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appb_02.htm"TITLE="B.2 The gated Configuration Language"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: B.2 The gated Configuration Language"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="APPENDIX"><H1CLASS="appendix"><ACLASS="title"NAME="TCP2-AP-2">B. A gated Reference</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="SECT1"HREF="#TCP2-AP-2-SECT-1"TITLE="B.1 The gated Command">The gated Command</A><BR><ACLASS="SECT1"HREF="appb_02.htm"TITLE="B.2 The gated Configuration Language">The gated Configuration Language</A><BR><ACLASS="SECT1"HREF="appb_03.htm"TITLE="B.3 Directive Statements">Directive Statements</A><BR><ACLASS="SECT1"HREF="appb_04.htm"TITLE="B.4 Trace Statements">Trace Statements</A><BR><ACLASS="SECT1"HREF="appb_05.htm"TITLE="B.5 Options Statements">Options Statements</A><BR><ACLASS="SECT1"HREF="appb_06.htm"TITLE="B.6 Interface Statements">Interface Statements</A><BR><ACLASS="SECT1"HREF="appb_07.htm"TITLE="B.7 Definition Statements">Definition Statements</A><BR><ACLASS="SECT1"HREF="appb_08.htm"TITLE="B.8 Protocol Statements">Protocol Statements</A><BR><ACLASS="SECT1"HREF="appb_09.htm"TITLE="B.9 static Statements">static Statements</A><BR><ACLASS="SECT1"HREF="appb_10.htm"TITLE="B.10 Control Statements">Control Statements</A><BR><ACLASS="SECT1"HREF="appb_11.htm"TITLE="B.11 The Aggregate Statements">The Aggregate Statements</A></P><P></P></DIV><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-AP-2-IX-GATEWAY-ROUTING-DAEMON-GATED-TOOLS-REFERENCE"></A>This appendix covers the syntax of the <BCLASS="emphasis.bold">gated</B> command and the<BCLASS="emphasis.bold">gated</B> configuration language.  As a reference to the <BCLASS="emphasis.bold">gated</B>configuration language, this appendix stands on its own.  But to fullyunderstand how to configure <BCLASS="emphasis.bold">gated</B>, use this reference inconjunction with the sample configuration files in <ACLASS="xref"HREF="ch07_01.htm"TITLE="Configuring Routing ">Chapter 7, <CITECLASS="chapter">Configuring Routing </CITE></A>.</P><PCLASS="para"><BCLASS="emphasis.bold">gated</B> is constantly being improved. As it is upgraded, thecommand language changes. Refer to the latest manpages for the mostrecent information about <BCLASS="emphasis.bold">gated</B>.</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-AP-2-SECT-1">B.1 The gated Command</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-AP-2-IX-GATEWAY-ROUTING-DAEMON-GATED-COMMAND"></A>The syntax of the <BCLASS="emphasis.bold">gated</B> command is:</P><PCLASS="para"><BCLASS="emphasis.bold">gated</B> [<BCLASS="emphasis.bold">-c</B>] [<BCLASS="emphasis.bold">-C</B>] [<BCLASS="emphasis.bold">-n</B>] [<BCLASS="emphasis.bold">-N</B>] [<BCLASS="emphasis.bold">-t</B><CODECLASS="replaceable"><I>trace_options</I></CODE>] [<BCLASS="emphasis.bold">-f</B><CODECLASS="replaceable"><I> config_file</I></CODE>] [<CODECLASS="replaceable"><I>trace_file</I></CODE>]</P><PCLASS="para">The <BCLASS="emphasis.bold">-c</B> and <BCLASS="emphasis.bold">-n</B> command-line options debug the routingconfiguration file without impacting the network or the kernel routingtable. Frequently, these debugging options are used with a test configurationidentified by the <BCLASS="emphasis.bold">-f</B> <CODECLASS="replaceable"><I>config_file</I></CODE> option:</P><DLCLASS="variablelist"><DTCLASS="term"><BCLASS="emphasis.bold">-c</B></DT><DDCLASS="listitem"><PCLASS="para">Tells <BCLASS="emphasis.bold">gated</B> to read the configuration file and check for syntaxerrors. When<BCLASS="emphasis.bold">gated</B> finishes reading the configuration file, it produces asnapshot of its status and then terminates. It writes the snapshot to<EMCLASS="emphasis">/usr/tmp/gated_dump</EM>. Running <BCLASS="emphasis.bold">gated</B> with the <BCLASS="emphasis.bold">-c</B>option does not require superuser privilege,<ACLASS="indexterm"NAME="AUTOID-20744"></A>andit is not necessary toterminate the active <BCLASS="emphasis.bold">gated</B> process.</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">-C</B></DT><DDCLASS="listitem"><PCLASS="para">Checks the configuration file for syntax errors. <BCLASS="emphasis.bold">gated</B> exitswith a status 1 if there are errors and 0 if there are none. Becausethis provides exit status, it is useful for script files.</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">-n</B></DT><DDCLASS="listitem"><PCLASS="para">Tells <BCLASS="emphasis.bold">gated</B> not to update the kernel routing table. This is usedto test the routing configuration with real routing data withoutinterfering with system operation.</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">-f</B> <CODECLASS="replaceable"><I>config_file</I></CODE></DT><DDCLASS="listitem"><PCLASS="para">Tells <BCLASS="emphasis.bold">gated</B> to read the configuration from<CODECLASS="replaceable"><I>config_file</I></CODE> instead of from the default configurationfile, <EMCLASS="emphasis">/etc/gated.conf</EM>.  Used in conjunction with the <BCLASS="emphasis.bold">-c</B>option, <BCLASS="emphasis.bold">-f</B> checks a new configuration without interfering withthe currently running <BCLASS="emphasis.bold">gated</B> configuration.</P></DD></DL><PCLASS="para">The <BCLASS="emphasis.bold">-N</B> command-line option prevents <BCLASS="emphasis.bold">gated</B> from running inbackground mode as a daemon. This option is used when <BCLASS="emphasis.bold">gated</B> isstarted from <EMCLASS="emphasis">inittab</EM>. By default, <BCLASS="emphasis.bold">gated</B> runs as a daemon.</P><PCLASS="para">The command-line arguments <CODECLASS="replaceable"><I>trace_options</I></CODE> and<CODECLASS="replaceable"><I>trace_file</I></CODE> are used for protocol tracing.<ACLASS="indexterm"NAME="AUTOID-20780"></A>The <CODECLASS="replaceable"><I>trace_file</I></CODE> argument names the file to which the traceoutput is written. If a file is not specified, the trace is written tothe standard output. Tracing usually produces a large amount ofoutput.</P><PCLASS="para">The command-line options used for tracing are:</P><DLCLASS="variablelist"><DTCLASS="term"><BCLASS="emphasis.bold">-t</B></DT><DDCLASS="listitem"><PCLASS="para">This option turns on tracing. If <BCLASS="emphasis.bold">-t</B> is specified with no<CODECLASS="replaceable"><I>trace_options</I></CODE>, <BCLASS="emphasis.bold">gated</B> defaults to <BCLASS="emphasis.bold">general</B> tracing,which traces normal protocol interactions and routing table changes.<BCLASS="emphasis.bold">gated</B> always logs protocol errors even if no tracing is specified.You can define several different <CODECLASS="replaceable"><I>trace_options</I></CODE>, all of whichare described later in this appendix. A few <CODECLASS="replaceable"><I>trace_options</I></CODE>(<BCLASS="emphasis.bold">detail</B>, <BCLASS="emphasis.bold">send</B>, <BCLASS="emphasis.bold">recv</B>) cannot be specifed on the<BCLASS="emphasis.bold">gated</B> command line. Two others are most useful when they aredefined on the command line:<DLCLASS="variablelist"><DTCLASS="term"><BCLASS="emphasis.bold">symbols</B></DT><DDCLASS="listitem"><PCLASS="para">Traces the symbols read from the kernel, which is primarily of interestto developers debugging the interaction of <BCLASS="emphasis.bold">gated</B> and the kernel.</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">iflist</B></DT><DDCLASS="listitem"><PCLASS="para">Traces the list of interfaces read from the kernel. Use this to determinewhat interfaces are detected by the kernel interface scan.</P></DD></DL>&#13;</P></DD></DL><PCLASS="para">The advantage of placing a trace option on the command line isthat it can trace activities that happen before the configurationfile is processed. For the two options listed above, this is anessential advantage. For other options it is not very important.Most trace options are specified in the configuration file. See the<BCLASS="emphasis.bold">traceoptions</B> command later in this appendix for more details.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-AP-2-SECT-1.1">B.1.1 Signal Processing</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-AP-2-IX-SIGNAL-PROCESSING-IN-GATED"></A><BCLASS="emphasis.bold">gated</B> processes the following signals:</P><DLCLASS="variablelist"><DTCLASS="term">SIGHUP</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-20828"></A>Tells <BCLASS="emphasis.bold">gated</B> to reread the configuration file. The newconfiguration replaces the one that <BCLASS="emphasis.bold">gated</B> is currently running.SIGHUP loads the new configuration file without interrupting<BCLASS="emphasis.bold">gated</B> service. SIGHUP is available for quick configurationchanges.At most sites, the routing configuration changes infrequently. The fewtimes you need to change to a new configuration, terminate <BCLASS="emphasis.bold">gated</B>and rerun it with the new configuration. This is a more accurate testof how things will run at the next boot.</P></DD><DTCLASS="term">SIGINT</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-20838"></A>Tells <BCLASS="emphasis.bold">gated</B> to snapshot its current state to the file<EMCLASS="emphasis">/usr/tmp/gated_dump</EM>.<ACLASS="indexterm"NAME="AUTOID-20842"></A><ACLASS="indexterm"NAME="AUTOID-20845"></A></P></DD><DTCLASS="term">SIGTERM</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-20851"></A>Tells <BCLASS="emphasis.bold">gated</B> to shut down gracefully. All protocols are shut downfollowing the rules of that protocol. For example, EGP sends a CEASEmessage and waits for it to be confirmed. SIGTERM removes from thekernel routing table all routes learned via the exterior routingprotocols. If you need to preserve those routes while <BCLASS="emphasis.bold">gated</B> isout of operation, use SIGKILL.</P></DD><DTCLASS="term">SIGKILL</DT><DDCLASS="listitem"><PCLASS="para">Tells <BCLASS="emphasis.bold">gated</B> to terminate immediately and dump core. Routes arenot removed from the routing table, and no graceful shutdown isattempted.</P></DD><DTCLASS="term">SIGUSR1</DT><DDCLASS="listitem"><PCLASS="para">Tells <BCLASS="emphasis.bold">gated</B> to toggle tracing. If no trace flags are set, SIGUSR1has no effect. But if tracing is enabled, the first SIGUSR1 causes<BCLASS="emphasis.bold">gated</B> to toggle off tracing and to close the trace file. The nextSIGUSR1 turns tracing back on and opens the trace file. When the tracefile is closed, it can be moved or removed without interfering with theoperation of <BCLASS="emphasis.bold">gated</B>. Use this to periodically empty out the tracefile to prevent it from becoming too large.</P></DD><DTCLASS="term">SIGUSR2</DT><DDCLASS="listitem"><PCLASS="para">Tell <BCLASS="emphasis.bold">gated</B> to check for changes in the status of the networkinterfaces.</P></DD></DL><PCLASS="para">The following is an example of <BCLASS="emphasis.bold">gated</B> signal handling. First, theSIGUSR1 signal is passed to the <BCLASS="emphasis.bold">gated</B> process using the processID obtained from the <EMCLASS="emphasis">gated.pid</EM> file (<EMCLASS="emphasis">/var/run/gated.pid</EM> inthis case).</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>kill -USR1 `cat /var/run/gated.pid`</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Next, the old trace file (<EMCLASS="emphasis">/usr/tmp/gated.log</EM> in this case) isremoved, and <BCLASS="emphasis.bold">gated</B> is passed another SIGUSR1 signal.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>rm /usr/tmp/gated.log</B></CODE># <CODECLASS="userinput"><B>kill -USR1 `cat /etc/gated.pid`</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">After receiving the second signal, <BCLASS="emphasis.bold">gated</B> opens a fresh trace file(still named <EMCLASS="emphasis">/usr/tmp/gated.log</EM>). An <BCLASS="emphasis.bold">ls</B> shows that the newfile has been created.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>ls -l /usr/tmp/gated.log</B></CODE>-rw-rw-r--  1 root          105 Jul  6 16:41 /usr/tmp/gated.log</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-20895"></A><ACLASS="indexterm"NAME="AUTOID-20896"></A><ACLASS="indexterm"NAME="AUTOID-20897"></A></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appa_03.htm"TITLE="A.3 chat"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: A.3 chat"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appb_02.htm"TITLE="B.2 The gated Configuration Language"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: B.2 The gated Configuration Language"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">A.3 chat</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">B.2 The gated Configuration Language</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>