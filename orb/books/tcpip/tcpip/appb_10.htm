<HTML><HEAD><TITLE>[Appendix B] B.10 Control Statements</TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:43:22Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="appb_01.htm"TITLE="B. A gated Reference"><LINKREL="prev"HREF="appb_09.htm"TITLE="B.9 static Statements"><LINKREL="next"HREF="appb_11.htm"TITLE="B.11 The Aggregate Statements"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appb_09.htm"TITLE="B.9 static Statements"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: B.9 static Statements"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Appendix B<BR>A gated Reference</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appb_11.htm"TITLE="B.11 The Aggregate Statements"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: B.11 The Aggregate Statements"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-AP-2-SECT-10">B.10 Control Statements</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-AP-2-IX-CONTROL-STATEMENTS-IN-GATED"></A>The control statements define your routing policy. Often whenadministrators hear the terms &quot;routing policy&quot; or &quot;policy-basedrouting,&quot; they assume that this is something done inside the routingprotocol.  </P><PCLASS="para">In reality, a routing policy<ACLASS="indexterm"NAME="AUTOID-23390"></A>is defined outside of the routing protocol in the configurationfile. The policy defines what routes are accepted and what routes areadvertsied. <BCLASS="emphasis.bold">gated</B> does this with two control statements:<BCLASS="emphasis.bold">import</B> and <BCLASS="emphasis.bold">export</B>. The <BCLASS="emphasis.bold">import</B> statement defineswhich routes are accepted and from what sources those routes areaccepted. The <BCLASS="emphasis.bold">export</B> statement defines which routes areadvertised based on the source of the routes and the protocol used toadvertise them.&#13;</P><PCLASS="para">The <BCLASS="emphasis.bold">import</B> and <BCLASS="emphasis.bold">export</B> statements use <BCLASS="emphasis.bold">gated</B> preference,routing metrics, routing filters, and AS paths to define routing policy. Preference and metrics are controlled by these keywords:</P><DLCLASS="variablelist"><DTCLASS="term"><BCLASS="emphasis.bold">restrict</B></DT><DDCLASS="listitem"><PCLASS="para">Says that the routes are not to be imported, in the case of the importcommand, or exported in the case of the export command. This keywordblocks the use of a specific route.</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">preference</B> <CODECLASS="replaceable"><I>preference</I></CODE></DT><DDCLASS="listitem"><PCLASS="para">Defines the preference value<ACLASS="indexterm"NAME="AUTOID-23414"></A>used when comparing this route to otherroutes. Preference is used when installing routes; not when advertisingroutes.</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE></DT><DDCLASS="listitem"><PCLASS="para">Specifies the metric used when advertising a route. </P></DD></DL><PCLASS="para">Route filters match routes by destination address. Among other places,route filters are used on martians and <BCLASS="emphasis.bold">import</B> and <BCLASS="emphasis.bold">export</B> statements. A routematches the most specific filter that applies. Specifying more than onefilter with the same destination, mask, and modifiers generates an error.Import and export route filters can be specified in the following ways:[2]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] Route filters may include additional parameters. On <BCLASS="emphasis.bold">import</B>statements they include a preference, and on <BCLASS="emphasis.bold">export</B> statements ametric. &quot;Preference&quot; and &quot;metric&quot; are described previously.</P></BLOCKQUOTE><DLCLASS="variablelist"><DTCLASS="term"><CODECLASS="replaceable"><I>address </I></CODE>[<BCLASS="emphasis.bold">mask</B> <CODECLASS="replaceable"><I>mask </I></CODE>| <BCLASS="emphasis.bold">masklen</B> <CODECLASS="replaceable"><I>number</I></CODE>] [<BCLASS="emphasis.bold">exact </B>| <BCLASS="emphasis.bold">refines</B>]</DT><DDCLASS="listitem"><PCLASS="para">Defines a range of addresses using an address and an address mask.The address mask can be defined with the keyword <BCLASS="emphasis.bold">mask</B> and a maskwritten in dotted decimal notation or with the keyword <BCLASS="emphasis.bold">masklen</B> anda numeric prefix length. If no mask is defined the natural mask of thenetwork is used. Two options can be used:<DLCLASS="variablelist"><DTCLASS="term"><BCLASS="emphasis.bold">exact</B></DT><DDCLASS="listitem"><PCLASS="para">Matches a network, but no subnets or hosts of that network. </P></DD><DTCLASS="term"><BCLASS="emphasis.bold">refines</B></DT><DDCLASS="listitem"><PCLASS="para">Matches subnets and/or hosts of a network, but not the network itself.</P></DD></DL>&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">all</B></DT><DDCLASS="listitem"><PCLASS="para">Matches every possible address.</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">default</B></DT><DDCLASS="listitem"><PCLASS="para">Matches only the default route.</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">host</B> <CODECLASS="replaceable"><I>address</I></CODE></DT><DDCLASS="listitem"><PCLASS="para">Matches an individual host address.&#13;</P></DD></DL><PCLASS="para">A routing filter that matches everything on network number 192.168.12.0 andthe individual host 10.104.19.12 contains:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">192.168.12.0 masklen 24 ;host 10.104.19.12 ;</PRE></BLOCKQUOTE></P><PCLASS="para">When no route filtering is specified in an <BCLASS="emphasis.bold">import</B> or <BCLASS="emphasis.bold">export</B> statement,all routes from the specfied source will match that statement. If anyfilters are specified, only routes that match the specified filters areimported or exported.</P><PCLASS="para">Border Gateway Protocol (BGP)<ACLASS="indexterm"NAME="AUTOID-23477"></A>is designed to support policy-based routing.A key feature of BGP is that it is a path-vector protocol. Import andexport statements allow you to use the AS path vector<ACLASS="indexterm"NAME="AUTOID-23480"></A>to enforce yourrouting policy.</P><PCLASS="para">An AS path lists the autonomous systems<ACLASS="indexterm"NAME="AUTOID-23484"></A>end-to-end for a route,<ACLASS="indexterm"NAME="AUTOID-23487"></A>and provides an indication of the completeness of the path. Eachautonomous system that a route passes through prepends its AS numberto the beginning of the AS path.</P><PCLASS="para">The &quot;origin&quot; of the path indicates its completeness. An origin of<BCLASS="emphasis.bold">igp</B> indicates the route was learned from an interior routingprotocol and is most likely complete. An origin of <BCLASS="emphasis.bold">egp</B> indicatesthe route was learned from an exterior routing protocol that does notsupport AS paths (EGP for example) and the path is most likely notcomplete.</P><PCLASS="para">When the path information is definitely not complete, an origin of<BCLASS="emphasis.bold">incomplete</B> is used. All of these origins can be specified in the<BCLASS="emphasis.bold">import</B> and <BCLASS="emphasis.bold">export</B> statements, and therefore used in yourrouting policy. The keyword <BCLASS="emphasis.bold">any</B> is used when the policy appliesto all origins.</P><PCLASS="para">The AS path can also be used in the control statements by defining anAS path regular expression.[3]The AS path regular expression provides a pattern-matching syntax usedto filter routes based on the autonomous system numbers in the AS pathsassociated with those routes.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] AS path regular expressions are defined in RFC 1164. </P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-AP-2-IX-AS-PATH-OPERATORS-LISTED"></A>An AS path regular expression is a regular expression composed ofautonomous system numbers and special operators. <ACLASS="xref"HREF="appa_01.htm#TCP2-AP-1-TAB-0"TITLE="dip Special Variables">Table 13.1</A>lists theAS path operators. The AS path operator operates on an AS path term, whichis an autonomous system number, a dot (.), which matches any autonomoussystem number, or a parentheses-enclosed subexpression.&#13;</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="TCP2-AP-2-TAB-0">Table B.1: AS Path Operators</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Symbol</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Meaning</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">{<CODECLASS="literal">m</CODE>,<CODECLASS="literal">n</CODE>}</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">At least <CODECLASS="literal">m</CODE> and at most <CODECLASS="literal">n</CODE> repetitions.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">{<CODECLASS="literal">m</CODE>}</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Exactly <CODECLASS="literal">m</CODE> repetitions.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">{<CODECLASS="literal">m</CODE>,}</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">m</CODE> or more repetitions.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">*</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">0 or more repetitions.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">+</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">1 or more repetitions.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">?</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">0 or 1 repetition.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">aspath_term</CODE> | <CODECLASS="literal">aspath_term</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Matches either the AS term on the left, or the AS term on the right. </TD></TR></TBODY></TABLE><PCLASS="para">A simple AS path regular expression might be:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">import proto bgp aspath 164+ origin any restrict ;</PRE></BLOCKQUOTE></P><PCLASS="para">This restricts all routes that have one or more occurrences of autonomoussystem number 164 in their path vector.<ACLASS="indexterm"NAME="AUTOID-23549"></A></P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-AP-2-SECT-10.1">B.10.1 The import Statement</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-AP-2-IX-IMPORT-STATEMENT-IN-GATED"></A>The format of an <BCLASS="emphasis.bold">import</B> statement varies depending on the sourceprotocol. The format of the <BCLASS="emphasis.bold">import</B> statements for the exterior gatewayprotocols is:</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">import proto bgp </B>| <BCLASS="emphasis.bold">egp autonomoussystem</B> <CODECLASS="replaceable"><I>as_number</I></CODE><BR>    [<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">preference</B> <CODECLASS="replaceable"><I>preference</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>route_filter </I></CODE>[<BCLASS="emphasis.bold">restrict </B>| (<BCLASS="emphasis.bold">preference</B> <CODECLASS="replaceable"><I>preference</I></CODE>)]] <BCLASS="emphasis.bold">;<BR>} ;</B></P></BLOCKQUOTE><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">import proto bgp aspath</B> <CODECLASS="replaceable"><I>aspath_regexp</I></CODE><BCLASS="emphasis.bold">    origin any </B>|<BCLASS="emphasis.bold"> igp </B>|<BCLASS="emphasis.bold"> egp </B>|<BCLASS="emphasis.bold"> incomplete</B><BR>    [<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">preference</B> <CODECLASS="replaceable"><I>preference</I></CODE>] <BCLASS="emphasis.bold">{<BR>    route_filter </B>[<BCLASS="emphasis.bold">restrict </B>| (<BCLASS="emphasis.bold">preference</B> <CODECLASS="replaceable"><I>preference</I></CODE>)]] <BCLASS="emphasis.bold">;<BR>} ;</B></P></BLOCKQUOTE><PCLASS="para">BGP and EGP importation may be controlled by autonomous system number. BGPalso can control importation using AS path regular expressions. Routesthat are rejected by the routing policy are stored in the routingtable with a negative preference. A negative preference<ACLASS="indexterm"NAME="AUTOID-23586"></A>prevents aroute from being installed in the forwarding table or exported to otherprotocols. Handling rejected routes<ACLASS="indexterm"NAME="AUTOID-23589"></A>in this manner alleviates the needto break and re-establish a session if routing policy changes duringa reconfiguration.&#13;</P><PCLASS="para">The format of the import statements for the RIP, HELLO, and redirectprotocols is:</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">import proto rip </B>|<BCLASS="emphasis.bold"> hello </B>|<BCLASS="emphasis.bold"> redirect</B><BR>    [<BCLASS="emphasis.bold">interface</B> <CODECLASS="replaceable"><I>interface_list</I></CODE> | <BCLASS="emphasis.bold">gateway</B> <CODECLASS="replaceable"><I>gateway_list</I></CODE>]<BR>    [<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">preference</B> <CODECLASS="replaceable"><I>preference</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>route_filter </I></CODE>[<BCLASS="emphasis.bold">restrict </B>| (<BCLASS="emphasis.bold">preference</B> <CODECLASS="replaceable"><I>preference</I></CODE>)]] <BCLASS="emphasis.bold">;<BR>} ;</B></P></BLOCKQUOTE><PCLASS="para">This statement controls what routes are imported based on the sourceprotocol, interface and gateway. The order of precedence is from the mostgeneral (protocol) to the most specific (gateway). Unlike BGP and EGP,these protocols do not save routes that were rejected because theseprotocols have short update intervals.</P><PCLASS="para">The <BCLASS="emphasis.bold">preference</B> option is not used with RIP or HELLO. RIP and HELLOdon't use preference to choose between routes of the same protocol. Theyuse the protocol metrics.</P><PCLASS="para">The format of the <BCLASS="emphasis.bold">import</B> statement for the OSPFprotocol is:</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">import proto ospfase </B>[<BCLASS="emphasis.bold">tag</B> <CODECLASS="replaceable"><I>ospf_tag</I></CODE>] [<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">preference</B> <CODECLASS="replaceable"><I>preference</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>route_filter </I></CODE>[<BCLASS="emphasis.bold">restrict </B>| (<BCLASS="emphasis.bold">preference</B> <CODECLASS="replaceable"><I>preference</I></CODE>)]] <BCLASS="emphasis.bold">;<BR>} ;</B></P></BLOCKQUOTE><PCLASS="para">Due to the nature of OSPF, only the importation of ASE routes<ACLASS="indexterm"NAME="AUTOID-23628"></A>can be controlled. Furthermore, it is only possible to restrict theimportation of OSPF ASE routes when functioning as an AS borderrouter.  This requires you to specify an <BCLASS="emphasis.bold">export ospfase</B>statement in addition to the <BCLASS="emphasis.bold">import ospfase</B> statement. Specifyan empty <BCLASS="emphasis.bold">export</B> statement to control importation of ASEs when noASEs are being exported. (See the following section, &quot;The exportStatement.&quot;) If a tag is specified, the <BCLASS="emphasis.bold">import</B> statement onlyapplies to routes with the tag. OSPF ASE routes that are rejected bypolicy are stored in the table with a negative preference.</P><PCLASS="para">OSPF routes are imported into the <BCLASS="emphasis.bold">gated</B>routing table with a preference of 10.Preference is not used to choose between OSPF ASE routes.OSPF costs are used for that purpose.<ACLASS="indexterm"NAME="AUTOID-23637"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-AP-2-SECT-10.2">B.10.2 The export Statement</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-AP-2-IX-EXPORT-STATEMENT-IN-GATED"></A>The syntax of the <BCLASS="emphasis.bold">export</B> statement is similar to the syntax of the<BCLASS="emphasis.bold">import</B>statement and the meaning of many of the parameters is identical. Animportant difference between the two statements is that while routeimportation is controlled by source information, route exportation iscontrolled by both source and destination. Thus <BCLASS="emphasis.bold">export</B> statements definewhere the routes will be sent and where they originated. The destinationof the route advertisement is defined by the <CODECLASS="literal">proto</CODE> clause<ACLASS="indexterm"NAME="AUTOID-23647"></A>at the beginning of the <BCLASS="emphasis.bold">export</B> statement.The source of the routes is defined in the export list.</P><PCLASS="para">Each export statement varies slightly for each protocol. To advertiseroutes via EGP and BGP, use this syntax:</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">export proto bgp </B>| <BCLASS="emphasis.bold">egp as </B><CODECLASS="replaceable"><I>as_number</I></CODE><BR>    [<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>export_list </I></CODE><BCLASS="emphasis.bold">;<BR>}</B>] <BCLASS="emphasis.bold">;</B></P></BLOCKQUOTE><PCLASS="para">Routes are exported via EGP and BGP to the specified autonomous system.<BCLASS="emphasis.bold">restrict</B> blocks exports to the AS. Valid BGP or EGP metrics canbe specified. If no export list is defined, only the direct routesof the attached interfaces are exported. If an export list is used,it must explicitly specify everything that should be exported.</P><PCLASS="para">To advertise routes via RIP and HELLO, use this syntax:</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">export proto rip </B>| <BCLASS="emphasis.bold">hello</B><BR>    [<BCLASS="emphasis.bold">interface</B> <CODECLASS="replaceable"><I>interface_list</I></CODE> | <BCLASS="emphasis.bold">gateway</B> <CODECLASS="replaceable"><I>gateway_list</I></CODE>]<BR>    [<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>export_list </I></CODE><BCLASS="emphasis.bold">;<BR>}</B>] <BCLASS="emphasis.bold">;</B></P></BLOCKQUOTE><PCLASS="para">Routes exported by RIP and HELLO are sent via the specified protocoland can be sent through a specifc interface or to a specific gateway.Set <CODECLASS="replaceable"><I>metric</I></CODE> if you plan to export static or internally generateddefault routes. The <BCLASS="emphasis.bold">metric</B> option is only used when exportingnon-RIP routes via RIP or non-HELLO routes via HELLO.</P><PCLASS="para">If no export list is specified, RIP exports direct routes and RIProutes, and HELLO exports direct routes and HELLO routes. If anexport list is used it must explicitly specify everything that shouldbe exported.</P><PCLASS="para">To advertise routes via OSPF, use this syntax:</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">export proto osfpase </B>[<BCLASS="emphasis.bold">type 1 </B>| <BCLASS="emphasis.bold">2</B>] [<BCLASS="emphasis.bold">tag</B> <CODECLASS="replaceable"><I>ospf_tag</I></CODE>]<BR>    [<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>export_list </I></CODE><BCLASS="emphasis.bold">;<BR>}</B>] <BCLASS="emphasis.bold">;</B></P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-23698"></A>Only OSPF ASE routes can be exported by <BCLASS="emphasis.bold">gated</B>. There are two typesof OSPF ASE routes, type 1 and type 2. They are described in <ACLASS="xref"HREF="ch07_01.htm"TITLE="Configuring Routing ">Chapter 7</A>and earlier in this appendix. The defaulttype is specified in the <BCLASS="emphasis.bold">ospf protocol</B> statement, but it can be overriddenhere. The <CODECLASS="replaceable"><I>ospf_tag</I></CODE> is an arbitrary 32-bitnumber used to filter routing information. The default tag valueis specified in the <BCLASS="emphasis.bold">ospf protocol</B> statement but it can be overridden here.</P><PCLASS="para">The source of the routes advertised by a protocol is defined by theexport list. Each of the commands listed above contains an export listoption. Just like those commands, the export list syntax variesdepending on the source protocol of the routes. The commands describedabove define the protocols that are used to advertise the routes. Theexport lists shown below describe the protocols from which the routesare obtained.  The biggest confusion caused by the export list syntaxis that it is almost identical to the syntax shown above. In bothcases we define protocols, autonomous systems, interfaces, gateways,and so on. In the first case we are defining the protocols,interfaces, etc., to which routes are sent, and in this case we definethe protocols, interfaces, etc., from which routes are recieved.</P><PCLASS="para">To export routes learned from BGP and EGP, use this export list syntax:</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">export proto bgp </B>| <BCLASS="emphasis.bold">egp autonomoussystem </B><CODECLASS="replaceable"><I>as_number</I></CODE><BR>    [<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>route_filter</I></CODE> [<BCLASS="emphasis.bold">restrict | </B><BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">;<BR>}</B>] <BCLASS="emphasis.bold">;</B></P></BLOCKQUOTE><PCLASS="para">This defines routes learned via BGP or EGP from a specific autonomoussystem. Routes can be restricted, or have a metric applied, based onmatching the source AS number or the route filter.</P><PCLASS="para">When BGP is configured, <BCLASS="emphasis.bold">gated</B> assigns all routes an AS path. Forinterior routes, the AS path specifies <BCLASS="emphasis.bold">igp</B> as the origin and no autonomoussystems in the AS path (the current AS is added when the route isexported). For EGP routes, the AS path specifies <BCLASS="emphasis.bold">egp</B> as the origin andthe source AS as the AS path. For BGP routes, the AS path learned fromBGP is used. If you run BGP, the export of all routes may be controlledby the AS path using this syntax:</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">proto</B> <CODECLASS="replaceable"><I>proto </I></CODE>| <BCLASS="emphasis.bold">all<BR>    aspath</B> <CODECLASS="replaceable"><I>aspath_regexp </I></CODE><BCLASS="emphasis.bold">origin any </B>| <BCLASS="emphasis.bold">igp </B>| <BCLASS="emphasis.bold">egp </B>| <BCLASS="emphasis.bold">incomplete</B><BR>    [<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>route_filter</I></CODE> [<BCLASS="emphasis.bold">restrict | </B><BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">;<BR>}</B>] <BCLASS="emphasis.bold">;</B></P></BLOCKQUOTE><PCLASS="para">The source of the routes can be any one protocol (<CODECLASS="replaceable"><I>proto</I></CODE>) or all(<BCLASS="emphasis.bold">all</B>) protocols. The importation of routes can be controlledby matching their AS paths against the AS path regular expression(<CODECLASS="replaceable"><I>aspath_regexp</I></CODE>) or by matching their addresses  against the<CODECLASS="replaceable"><I>route_filter</I></CODE>. Route filters and AS path regular expressions areexplained above.</P><PCLASS="para">To export routes learned from RIP and HELLO, use this export list syntax:</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">proto rip </B>| <BCLASS="emphasis.bold">hello</B><BR>    [<BCLASS="emphasis.bold">interface</B> <CODECLASS="replaceable"><I>interface_list</I></CODE> | <BCLASS="emphasis.bold">gateway</B> <CODECLASS="replaceable"><I>gateway_list</I></CODE>]<BR>    [<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>route_filter</I></CODE> [<BCLASS="emphasis.bold">restrict | </B><BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">;<BR>}</B>] <BCLASS="emphasis.bold">;</B></P></BLOCKQUOTE><PCLASS="para">The export of RIP and HELLO routes may be controlled by protocol, sourceinterface, source gateway, or route filter.</P><PCLASS="para">To export routes learned from OSPF, use this export list syntax:</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">proto ospf </B>| <BCLASS="emphasis.bold">ospfase<BR>    </B>[<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>route_filter</I></CODE> [<BCLASS="emphasis.bold">restrict | </B><BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">;<BR>}</B>] <BCLASS="emphasis.bold">;</B></P></BLOCKQUOTE><PCLASS="para">The export of OSPF and OSPF ASE routes may be controlled by protocol androute filter. Exporting OSPF routes can also be controlled by <CODECLASS="replaceable"><I>tag</I></CODE> usingthe syntax shown below:</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">proto proto </B>| <BCLASS="emphasis.bold">all tag</B> <CODECLASS="replaceable"><I>tag<BR>    </I></CODE>[<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>route_filter</I></CODE> [<BCLASS="emphasis.bold">restrict | </B><BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">;<BR>}</B>] <BCLASS="emphasis.bold">;</B></P></BLOCKQUOTE><PCLASS="para">OSPF and RIP version 2 provide a tag field. For all other protocols,the tag is always 0. Routes may be selected based on the contents ofthe tag field.</P><PCLASS="para">There are other sources of routes that are not true routing protocols,and export lists can be defined for these sources. The two export listsfor these sources are:</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">proto direct </B>| <BCLASS="emphasis.bold">static </B>| <BCLASS="emphasis.bold">kernel</B><BR>    [<BCLASS="emphasis.bold">interface</B> <CODECLASS="replaceable"><I>interface_list</I></CODE>]<BR>    [<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>route_filter</I></CODE> [<BCLASS="emphasis.bold">restrict | </B><BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">;<BR>}</B>] <BCLASS="emphasis.bold">;</B></P></BLOCKQUOTE><PCLASS="para">The export of these routes can be controlled based on the source&quot;protocol&quot; and the source interface. The &quot;protocols&quot; in this case areroutes to direct interfaces, static routes, or routes learnedfrom the kernel.</P><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><BCLASS="emphasis.bold">proto default </B>| <BCLASS="emphasis.bold">aggregate<BR>    </B>[<BCLASS="emphasis.bold">restrict</B>] |<BR>    [[<BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">{</B><BR>    <CODECLASS="replaceable"><I>route_filter</I></CODE> [<BCLASS="emphasis.bold">restrict | </B><BCLASS="emphasis.bold">metric</B> <CODECLASS="replaceable"><I>metric</I></CODE>] <BCLASS="emphasis.bold">;<BR>}</B>] <BCLASS="emphasis.bold">;</B></P></BLOCKQUOTE><PCLASS="para">The export of these routes may only be controlled based on source&quot;protocol.&quot;  <BCLASS="emphasis.bold">default</B> refers to routes created by the <BCLASS="emphasis.bold">gendefault</B>option. <BCLASS="emphasis.bold">aggregate</B> refers to routes created by the aggregatestatements, the topic of the next section.<ACLASS="indexterm"NAME="AUTOID-23837"></A><ACLASS="indexterm"NAME="AUTOID-23838"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appb_09.htm"TITLE="B.9 static Statements"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: B.9 static Statements"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appb_11.htm"TITLE="B.11 The Aggregate Statements"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: B.11 The Aggregate Statements"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">B.9 static Statements</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">B.11 The Aggregate Statements</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>