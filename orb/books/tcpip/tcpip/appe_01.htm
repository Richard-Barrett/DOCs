<HTML><HEAD><TITLE>[Appendix E] A sendmail Reference</TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:44:01Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="index.htm"TITLE="TCP/IP Network Administration"><LINKREL="prev"HREF="appd_03.htm"TITLE="D.3 The dhcpd.conf Configuration File"><LINKREL="next"HREF="appe_02.htm"TITLE="E.2 The sendmail Command"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appd_03.htm"TITLE="D.3 The dhcpd.conf Configuration File"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: D.3 The dhcpd.conf Configuration File"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Appendix E</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appe_02.htm"TITLE="E.2 The sendmail Command"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: E.2 The sendmail Command"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="APPENDIX"><H1CLASS="appendix"><ACLASS="title"NAME="TCP2-AP-5">E. A sendmail Reference</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="SECT1"HREF="#TCP2-AP-5-SECT-1"TITLE="E.1 Compiling sendmail">Compiling sendmail</A><BR><ACLASS="SECT1"HREF="appe_02.htm"TITLE="E.2 The sendmail Command">The sendmail Command</A><BR><ACLASS="SECT1"HREF="appe_03.htm"TITLE="E.3 m4 sendmail Macros">m4 sendmail Macros</A><BR><ACLASS="SECT1"HREF="appe_04.htm"TITLE="E.4 More sendmail.cf">More sendmail.cf</A><BR><ACLASS="SECT1"HREF="appe_05.htm"TITLE="E.5 Sample Configurations">Sample Configurations</A></P><P></P></DIV><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-AP-5-IX-SENDMAIL-TOOLS-REFERENCE"></A>This appendix provides details of the syntax of the <BCLASS="emphasis.bold">sendmail</B>command, of the <EMCLASS="emphasis">sendmail.cf</EM> file, and of the <BCLASS="emphasis.bold">m4</B> macrosthat can be used to build that file. It also contains excerpts of thesample <EMCLASS="emphasis">sendmail.cf</EM> file described in <ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10, <CITECLASS="chapter">sendmail </CITE></A>.  Itdescribes where to obtain the latest source code for sendmail and howto compile it. This appendix is a reference, not a tutorial.  Refer to<ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10</A> for a tutorial on sendmail configuration.</P><PCLASS="para">We start the appendix with information on locating, downloading, andcompiling the latest version of sendmail.</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-AP-5-SECT-1">E.1 Compiling sendmail</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-AP-5-IX-SENDMAIL-COMPILING"></A>The source code for sendmail is available via anonymous ftp from<EMCLASS="emphasis">ftp.sendmail.org</EM>, where it is stored in the <EMCLASS="emphasis">pub/sendmail</EM>directory. When you change to that directory, an information message tells you about the latest version of sendmail.sendmail is updated constantly.<ACLASS="indexterm"NAME="AUTOID-26016"></A>The following examples are based onsendmail V8.8.5. Remember that things will change for future releases.Always read the README files and installation documents that come withnew software before beginning an installation.</P><PCLASS="para">Download the compressed sendmail <BCLASS="emphasis.bold">tar</B> file as a binary file.Uncompress and untar it. Change to the <EMCLASS="emphasis">src</EM> directory in the sendmaildirectory created by the <BCLASS="emphasis.bold">tar</B> file and enter:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>sh makesendmail</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">According to the documentation, this is all you need to do on mostsystems.  This certainly works on BSD 4.4-based systems. However,it does not work on every system. The two systems used for examples inthis book, Solaris 2.5.1and Slackware 96 Linux, both have problems. The problem with Solarisis that it does not have a C compiler. Before even attempting toinstall sendmail you must download and install the GNU C compiler,<BCLASS="emphasis.bold">gcc</B>. The problem with Slackware is more subtle.  Differentversions of Linux place files in different locations in thefilesystem. Let's look at the details of installing sendmail V8.8.5 ona Slackware 96 system.</P><PCLASS="para">First we download the <BCLASS="emphasis.bold">tar</B> file and put the sendmail source filesinto the <EMCLASS="emphasis">/usr/src</EM> directory where Slackware 96 keeps varioussource files:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <BCLASS="emphasis.bold">ftp ftp.sendmail.org</B>Connected to kohler.CS.Berkeley.EDU.220 kohler.CS.Berkeley.EDU FTP server ready.Name (ftp.cs.berkeley.edu:craig): <BCLASS="emphasis.bold">anonymous</B>331 Guest login ok, send your complete email address as password.Password: <BCLASS="emphasis.bold">craig@nuts.com</B>230 Guest login ok, access restrictions apply.ftp&gt; <BCLASS="emphasis.bold">cd pub/sendmail</B>250 CWD command successful.ftp&gt; <BCLASS="emphasis.bold">binary</B>200 Type set to I.ftp&gt; <BCLASS="emphasis.bold">get sendmail.8.8.5.tar.gz</B>200 PORT command successful.150 Opening BINARY mode data connection.226 Transfer complete.992815 bytes received in 187 secs (5.2 Kbytes/sec)ftp&gt; <BCLASS="emphasis.bold">quit</B>221 Goodbye.# <BCLASS="emphasis.bold">gunzip sendmail.8.8.5.tar.gz</B># <BCLASS="emphasis.bold">cp sendmail.8.8.5.tar /usr/src</B># <BCLASS="emphasis.bold">cd /usr/src</B># <BCLASS="emphasis.bold">tar -xvf sendmail.8.8.5.tar</B></PRE></BLOCKQUOTE></P><PCLASS="para">Next we run <BCLASS="emphasis.bold">makesendmail</B>.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <BCLASS="emphasis.bold">cd sendmail-8.8.5/src</B># <BCLASS="emphasis.bold">./makesendmail</B>Configuration: os=Linux, rel=2.0.0, rbase=2, rroot=2.0, arch=i586, sfx=Creating obj.Linux.2.0.0.i586 using Makefile.LinuxMaking dependencies in obj.Linux.2.0.0.i586make: Nothing to be done for `depend'.Making in obj.Linux.2.0.0.i586cc -I. -O -I/usr/local/include -DNDBM -DNEWDB    -c alias.c -o alias.o.<BR>.<BR>.<BR>cc -I. -O -I/usr/local/include -DNDBM -DNEWDB    -c map.c -o map.omap.c:42: ndbm.h: No such file or directorymake: * [map.o] Error 1</PRE></BLOCKQUOTE></P><PCLASS="para"><BCLASS="emphasis.bold">makesendmail</B> recognizes this is a Linux system, but the Makefileit selects is obviously not correct for the Slackware 96 variantof Linux. All of the Makefiles that <BCLASS="emphasis.bold">makesendmail</B> uses arelocated in the <EMCLASS="emphasis">src/Makefiles</EM> subdirectory. Two of those files,<EMCLASS="emphasis">Makefile.Linux</EM> and <EMCLASS="emphasis">Makefile.Linux.ppc</EM>, are designed for Linux.The <EMCLASS="emphasis">Makefile.Linux.ppc</EM> is apossible solution to our problem.  Move it to <EMCLASS="emphasis">Makefile.Linux</EM> andrerun <BCLASS="emphasis.bold">makesendmail</B>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <BCLASS="emphasis.bold">cd Makefiles</B># <BCLASS="emphasis.bold">mv Makefile.Linux Makefile.Linux.orig</B># <BCLASS="emphasis.bold">cp Makefile.Linux.ppc Makefile.Linux</B># <BCLASS="emphasis.bold">cd ..</B># <BCLASS="emphasis.bold">touch *</B># <BCLASS="emphasis.bold">./makesendmail</B>Configuration: os=Linux, rel=2.0.0, rbase=2, rroot=2.0, arch=i586, sfx=Making in obj.Linux.2.0.0.i586cc -I. -O -I/usr/local/include -DNEWDB    -c alias.c -o alias.occ -I. -O -I/usr/local/include -DNEWDB    -c version.c -o version.occ -o sendmail alias.o ... version.o  -L/usr/local/lib -ldbgroff -Tascii -mandoc aliases.5 &gt; aliases.0groff -Tascii -mandoc sendmail.8 &gt; sendmail.0</PRE></BLOCKQUOTE></P><PCLASS="para">That's more like it! sendmail compiled and linked without problems.</P><PCLASS="para">A quick look at the differences in the two Makefiles shows that onlyfour lines have been changed. Of those four lines, only two, DBMDEFand LIBS, were actually needed to successfully compile sendmail.Possible values for the database definition (DBMDEF) are shown in <ACLASS="xref"HREF="appe_01.htm#TCP2-AP-5-TAB-0"TITLE="DBMDEF Database Arguments">Table 13.4</A></P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="TCP2-AP-5-TAB-0">Table E.1: DBMDEF Database Arguments</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Argument</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Function</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">NDBM</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The dbm format from BSD 4.3 accessed with ndbm(3).</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">NEWDB</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The new BSD 4.4 database format accessed with db(3).</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">NIS</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Sun NIS.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">NISPLUS</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Sun NIS+.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">NETINFO</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">NeXT's NetInfo.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">HESIOD</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">MIT's Hesiod server.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">LDAPMAP</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">X500 LDAP lookups.</TD></TR></TBODY></TABLE><PCLASS="para">The error displayed by the first <BCLASS="emphasis.bold">./makesendmail</B> run stated that<EMCLASS="emphasis">ndbm.h</EM> was not found. This indicates that the NDBM argumenton the DBMDEF line is the likely culprit. Further, the comments inthe <EMCLASS="emphasis">Makefile.Linux</EM> file recommend using DNEWDB and the ldb library.This suggests that a possible solution is to change DBMDEF to <BCLASS="emphasis.bold">DBMDEF=-DNEWDB</B> and LIBS to <BCLASS="emphasis.bold">LIBS= -ldb</B>. This is exactly what PaulDuBois did when he created the <EMCLASS="emphasis">Makefile.Linux.ppc</EM> file, and it is whatallows sendmail to compile on a Slackware 96 system.</P><PCLASS="para">He also changed two other lines, neither of which is criticalto the compile, but both of which are indicative of the type ofthings customized in a Makefile. Paul changed the STDIR variablethat defines where the <EMCLASS="emphasis">sendmail.st</EM> file is stored to <BCLASS="emphasis.bold">STDIR=${DESTDIR}/var/log</B>. The location of files is the most commonlymodified information in a makefile. He also changed BINGRP to <BCLASS="emphasis.bold">BINGRP=mail</B> to use the <EMCLASS="emphasis">mail</EM> group defined by the Slackware 96 systemas the group ID for the sendmail binary files.</P><PCLASS="para">Once sendmail compiles, it is installed with the following command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># ./makesendmail install</PRE></BLOCKQUOTE></P><PCLASS="para">One other thing that should be checked before declaring the installationcomplete is the <BCLASS="emphasis.bold">makemap</B> command.<ACLASS="indexterm"NAME="AUTOID-26116"></A>This is the command thatbuilds the databases read by sendmail. Given the fact thatsendmail encountered trouble while compiling certain types ofdatabase support, we are suspicious that compiling makemap willhave similar problems.</P><PCLASS="para">First change to the <EMCLASS="emphasis">sendmail-8.8.5/makemap</EM> directory and look atthe two makefiles located there. One of them, <EMCLASS="emphasis">Makefile.dist</EM>, is thetype of makefile supported by Slackware Linux. Copy <EMCLASS="emphasis">Makefile.dist</EM> toMakefile and attempt a compile of makemap:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <BCLASS="emphasis.bold">cd ../makemap</B># <BCLASS="emphasis.bold">mv Makefile Makefile.orig</B># <BCLASS="emphasis.bold">cp Makefile.dist Makefile</B>  # <BCLASS="emphasis.bold">make</B>cc -I. -O -I../src -I/usr/sww/include -DNDBM -DNEWDB    -c makemap.c   -o makemap.omakemap.c:53: ndbm.h: No such file or directorymake: *** [makemap.o] Error 1</PRE></BLOCKQUOTE></P><PCLASS="para">Just as we suspected! makemap has the same compile problem assendmail. Luckily, Paul DuBois's solution to the sendmailproblem shows us the changes needed for the DBMDEF and LIBS variables.Additionally, we check all of the directory paths in the Makefile toensure they are valid for a Slackware 96 system:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <BCLASS="emphasis.bold">grep -v '^#' Makefile | grep '/'</B>SRCDIR= ../srcINCDIRS=-I${SRCDIR} -I/usr/sww/includeLIBDIRS=-L/usr/sww/libBINDIR= ${DESTDIR}/usr/sbinLINKS=  ${DESTDIR}/usr/ucb/newaliases ${DESTDIR}/usr/ucb/mailq${OBJS}: ${SRCDIR}/conf.h# <BCLASS="emphasis.bold">ls /usr/sww</B>ls: /usr/sww: No such file or directory# <BCLASS="emphasis.bold">ls /usr/ucb</B>ls: /usr/ucb: No such file or directory# <BCLASS="emphasis.bold">whereis makemap</B>makemap: /usr/sbin/makemap# <BCLASS="emphasis.bold">whereis newaliases</B>newaliases: /usr/bin/newaliases# <BCLASS="emphasis.bold">whereis mailq</B>mailq: /usr/bin/mailq</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;These tests show that, in addition to Paul DuBois's corrections,we need to remove references to the non-existent <EMCLASS="emphasis">/usr/sww</EM> and<EMCLASS="emphasis">/usr/ucb</EM> directories and insert references to <EMCLASS="emphasis">/usr/bin</EM> where<BCLASS="emphasis.bold">mailq</B> and <BCLASS="emphasis.bold">newaliases</B> really reside. After we make thesechanges, a <BCLASS="emphasis.bold">diff</B> shows the new Makefile code and a rerun of <BCLASS="emphasis.bold">make</B>shows that we have fixed the problem:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <BCLASS="emphasis.bold">diff Makefile.dist Makefile</B>22c22&lt; DBMDEF=       -DNDBM -DNEWDB---&gt; DBMDEF=       -DNEWDB30c30&lt; INCDIRS=-I${SRCDIR} -I/usr/sww/include---&gt; INCDIRS=-I${SRCDIR}36c36&lt; LIBDIRS=-L/usr/sww/lib---&gt; LIBDIRS=39c39&lt; LIBS= -ldb -ldbm---&gt; LIBS= -ldb53c53&lt; LINKS=        ${DESTDIR}/usr/ucb/newaliases ${DESTDIR}/usr/ucb/mailq---&gt; LINKS=        ${DESTDIR}/usr/bin/newaliases ${DESTDIR}/usr/bin/mailq# <BCLASS="emphasis.bold">make</B>cc -I. -O -I../src -DNEWDB    -c makemap.c -o makemap.occ -o makemap  makemap.o   -ldb</PRE></BLOCKQUOTE></P><PCLASS="para">Run <BCLASS="emphasis.bold">make install</B> to install the new version of makemap.We're finished. Compiling sendmail wasn't as easy as thedocumentation implies, but wasn't impossible.</P><PCLASS="para">sendmail is now ready to run. The next section describes the syntax ofthe <BCLASS="emphasis.bold">sendmail</B> command.<ACLASS="indexterm"NAME="AUTOID-26153"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appd_03.htm"TITLE="D.3 The dhcpd.conf Configuration File"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: D.3 The dhcpd.conf Configuration File"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appe_02.htm"TITLE="E.2 The sendmail Command"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: E.2 The sendmail Command"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">D.3 The dhcpd.conf Configuration File</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">E.2 The sendmail Command</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>