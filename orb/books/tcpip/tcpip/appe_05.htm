<HTML><HEAD><TITLE>[Appendix E] E.5 Sample Configurations</TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:45:55Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="appe_01.htm"TITLE="E. A sendmail Reference"><LINKREL="prev"HREF="appe_04.htm"TITLE="E.4 More sendmail.cf"><LINKREL="next"HREF="appf_01.htm"TITLE="F. Selected TCP/IP Headers"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appe_04.htm"TITLE="E.4 More sendmail.cf"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: E.4 More sendmail.cf"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Appendix E<BR>A sendmail Reference</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="APPENDIX"HREF="appf_01.htm"TITLE="F. Selected TCP/IP Headers"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: F. Selected TCP/IP Headers"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-AP-5-SECT-5">E.5 Sample Configurations</A></H2><PCLASS="para">In <ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10</A> we develop a sendmail configuration. The configurationhas these characteristics:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">It runs on a Linux system.</P></LI><LICLASS="listitem"><PCLASS="para">The hostname of the sending system is rewritten to the domain name onall out-bound mail. The hostname is rewritten in the message headersand the envelope headers.</P></LI><LICLASS="listitem"><PCLASS="para">The sender's username on all outgoing mail is rewritten to theuser's first name and last name.</P></LI></UL><PCLASS="para">We use two approaches to produce this configuration. First, we use thesample <BCLASS="emphasis.bold">m4</B> source files that come with sendmail to create a custommacro configuration file. Next, we created the same configuration bydirectly modifying the sample <EMCLASS="emphasis">sendmail.cf</EM> file that comes withSlackware 96 Linux. In this section we recap both sample configurations.</P><PCLASS="para">To many system administrators, the simpliest way to create theconfiguration is to use the <BCLASS="emphasis.bold">m4</B> macro source files. The macrosource files are very short, and many people feel they are easier to readthan the <EMCLASS="emphasis">sendmail.cf</EM> file. If you download and compile sendmail,it is a good idea to use the macro files because the features in thosefiles will match the downloaded sendmail release.</P><PCLASS="para">We name the macro file we create in <ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10</A> <EMCLASS="emphasis">linux.mc</EM>.The file contains these macros:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">VERSIONID('@(#)tcpproto.mc	8.5 (Berkeley) 3/23/96')OSTYPE(linux)DOMAIN(nuts.com)FEATURE(nouucp)MAILER(local)MAILER(smtp)</PRE></BLOCKQUOTE></P><PCLASS="para">It is identical to the <EMCLASS="emphasis">tcpproto.mc</EM> file delivered with sendmail,with two modifications. First, we change the OSTYPE macro to defineLinux as the operating system. Next we add a <CODECLASS="literal">DOMAIN(nuts.com)</CODE>line to invoke a &quot;domain-specific&quot; macro file we create and name<EMCLASS="emphasis">nuts.com.m4</EM>. The <EMCLASS="emphasis">nuts.com.m4</EM> file contains the followinglines:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">MASQUERADE_AS(nuts.com)FEATURE(masquerade_envelope)FEATURE(genericstable)</PRE></BLOCKQUOTE></P><PCLASS="para">These three lines peform all of the functions we required of ourconfiguration. The <CODECLASS="literal">MASQUERADE_AS</CODE> statement rewrites the hostnameto the domain name. The <CODECLASS="literal">FEATURE(masquerade_envelope)</CODE> statementensures that the hostname is rewritten in the envelope headers as wellas the message headers. The <CODECLASS="literal">FEATURE(generictable)</CODE> statementcauses the username to be processed through the <BCLASS="emphasis.bold">genericstable</B>, which isthe database we use to convert it to the user's first and last name.</P><PCLASS="para">All of the functions we require of our configuration are accomplished infive lines. Modifying the <EMCLASS="emphasis">sendmail.cf</EM> file directly requires muchmore effort. However, the the <BCLASS="emphasis.bold">m4</B> source files can only be used ifthey match the version of sendmail. For this reason, <BCLASS="emphasis.bold">m4</B> is mostoften used by administrators who download and install sendmail themselves.Most administrators who use the sendmail that comes with theirsystem also use the <EMCLASS="emphasis">sendmail.cf</EM> file that comes with the system.In <ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10</A>, we use the <EMCLASS="emphasis">linux.smtp.cf</EM> file that comes with theSlackware 96 version of Linux 2.0. The detailed modifications of the fileare explained in <ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10</A>. Excerpts from the modified file are listedin this appendix and are heavily commented to make the modificationsmore understandable. A full listing of the <EMCLASS="emphasis">sendmail.cf</EM> file wouldconsume 15 pages. Compare that to the listing of the <BCLASS="emphasis.bold">m4</B> filesshown above.</P><PCLASS="para">The <EMCLASS="emphasis">linux.smtp.cf</EM> file is not identical to the configurationfile produced by <BCLASS="emphasis.bold">m4</B>, even when you follow the example in the&quot;Building a sendmail.cf with m4 Macros&quot; section of <ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10</A>.The configurations are similar but not identical. Use this text asa general guide to the structure and function of configuration file.Don't expect the details to match your file exactly.</P><PCLASS="para">This excerpt shows the entire local information section because it isdiscussed extensively in <ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10</A>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++# The V command defines the configuration syntax version level.# Level 6 was supported by sendmail-8.7.5, which was the release# of sendmail that came with Slackware 96 Linux 2.0.  The vendor# name Berkeley means that the standard syntax of the Berkeley# distribution is supported.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++# level 6 config file formatV6/Berkeley#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#Like most sendmail configuration files, the first sections of the file#contain the data that is most likely to require custom configuration.#In this file, the section is titled &quot;Local info&quot;.  Note that we moved#things around in this section to bring related items together.  They#don't really occur in this sequence in the linux.smtp.cf file.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++###################   local info   ####################++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#If your host is known by more than one hostname, the multiple host#names are defined in class &quot;w&quot;, which contains all of the names for#which your host will accept mail.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++Cwlocalhost#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++The j macro is correctly define by the system.  No need to set it here.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++# my official domain name# ... define this only if sendmail cannot automatically determine # your domain#Dj$w.Foo.COM#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#Class P is used to store pseudo domains.  It is only used in this#file to store a dot (.) used to identify canonical names.  The dot#(.) class, which is supposed to be used to identify canonical names,#is not referenced anywhere else in the file.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++CP.# a class with just dot (for identifying canonical names)C..#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#Several different mail relay servers can be defined.  We don't use any#in this sample configuration.  The L macro and the L class are only#significant if relay servers are defined for handling &quot;local&quot; mail.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++# &quot;Smart&quot; relay host (may be null)DS# who I send unqualified names to (null means deliver locally)DR# who gets all local email traffic ($R has precedence for unqualified names)DH# place to which unknown users should be forwarded#Kuser user -m -a&lt;&gt;#DLname_of_luser_relay# class L: names that should be delivered locally, even if we have a relay#CL root#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#Sample K commands are included in the linux.smtp.cf file.  Of these,#only the dequote database is active.  The others are commented out by#default.  The purpose of each of these databases is explained earlier#in this appendix.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++# Mailer table (overriding domains)#Kmailertable dbm /etc/mailertable# Domain table (adding domains)#Kdomaintable dbm /etc/domaintable# dequoting mapKdequote dequote#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#Several lines relate to address &quot;masquerading&quot;.  Macro M defines the#hostname that should be used in place of the system's real hostname#on outgoing mail.  The M class defines other hostnames that should be#converted to the macro M hostname.  Class E defines usernames for which#the hostname should not be converted to $M.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++# class E: names that should be exposed as from this host, even if # we masqueradeCE root# class M: domains that should be converted to $M#CM# who I masquerade as (null for no masquerading) (see also $=M)DMnuts.com#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#We added this K command to define a database that we created that converts#username to the user's real first and last names.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++# define a database to map login names to firstname.lastnameKrealnames dbm /tmp/realnames# operators that cannot be in local usernames (i.e., network indicators)CO @ % # my name for error messagesDnMAILER-DAEMON#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#Macro Z contains the configuration file's version number.  Modify it#every time the file is updated.  Keep a record of your modifications.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#  R1.0 - modified for peanut by Craig#       - cleaned up the comments in the local info section#  R1.1 - modified macro M to use nuts.com instead of the#         hostname in outgoing mail#  R2.0 - added rule a to S11 &amp; S31 to rewrite to first.last formatDZ8.7.3R2.0</PRE></BLOCKQUOTE></P><PCLASS="para">In <ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10</A> we modified ruleset 94 to enable masquerading forenvelope addresses.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">######################################################################  Ruleset 94 -- convert envelope names to masqueraded form   #######################################################################++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#To enable &quot;envelop&quot; address masquerading we &quot;uncommented&quot; the first line#in this ruleset so that it now calls ruleset 93.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++S94R$+			$@ $&gt;93 $1R$* &lt; @ *LOCAL* &gt; $*	$: $1 &lt; @ $j . &gt; $2</PRE></BLOCKQUOTE></P><PCLASS="para">The mailers do not usually require modification. However, in <ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10</A>,we made some changes to the S rulesets of the &quot;smtp&quot; mailer. We madechanges to both ruleset 11 and ruleset 31.<ACLASS="indexterm"NAME="AUTOID-29173"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#In <ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10</A> we added a single rule to the end of this ruleset to lookup#the username in the &quot;realnames&quot; database we created and return the#user's real first and last names.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++##  envelope sender rewriting#S11R$+			$: $&gt;51 $1			sender/recipient commonR$* :; &lt;@&gt;		$@				list:; special caseR$*			$: $&gt;61 $1			qualify unqual'ed namesR$+			$: $&gt;94 $1			do masquerading# when masquerading convert login name to firstname.lastnameR$- &lt; @ $M . &gt; $*	$: $(realnames $1 $) &lt; @ $M . &gt; $2  user=&gt;first.last##  envelope recipient rewriting --#  also header recipient if not masquerading recipients#S21R$+			$: $&gt;51 $1			sender/recipient commonR$+			$: $&gt;61 $1			qualify unqual'ed names#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#In <ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10</A> we added a single rule to the end of this ruleset to look up#the username name in the &quot;realnames&quot; database we created and return the#user's real first and last names.  This is the same modification made#above.  Often more than one ruleset is modified to add a single new #feature.#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++##  header sender and masquerading header recipient rewriting#S31R$+			$: $&gt;51 $1			sender/recipient commonR:; &lt;@&gt;			$@				list:; special case# do special header rewritingR$* &lt;@&gt; $*		$@ $1 &lt;@&gt; $2			pass null host throughR&lt; @ $* &gt; $*		$@ &lt; @ $1 &gt; $2			pass route-addr throughR$*			$: $&gt;61 $1			qualify unqual'ed namesR$+			$: $&gt;93 $1			do masquerading# when masquerading convert login name to firstname.lastnameR$- &lt; @ $M . &gt; $*	$: $(realnames $1 $) &lt; @ $M . &gt; $2	user=&gt;first.last</PRE></BLOCKQUOTE></P></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="appe_04.htm"TITLE="E.4 More sendmail.cf"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: E.4 More sendmail.cf"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="APPENDIX"HREF="appf_01.htm"TITLE="F. Selected TCP/IP Headers"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: F. Selected TCP/IP Headers"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">E.4 More sendmail.cf</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">F. Selected TCP/IP Headers</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>