<HTML><HEAD><TITLE>[Chapter 1] 1.5 Internet Layer</TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:30:54Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch01_01.htm"TITLE="1. Overview of TCP/IP"><LINKREL="prev"HREF="ch01_04.htm"TITLE="1.4 Network Access Layer"><LINKREL="next"HREF="ch01_06.htm"TITLE="1.6 Transport Layer"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch01_04.htm"TITLE="1.4 Network Access Layer"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 1.4 Network Access Layer"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 1<BR>Overview of TCP/IP</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch01_06.htm"TITLE="1.6 Transport Layer"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 1.6 Transport Layer"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-1-SECT-5">1.5 Internet Layer</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-1-IX-INTERNET-LAYER"></A>The layer above the Network Access Layer in the protocol hierarchy isthe <EMCLASS="emphasis">Internet Layer</EM>. The Internet Protocol, RFC 791, is theheart of TCP/IP and the most important protocol in the Internet Layer.IP provides the basic packet delivery service on which TCP/IP networks are built. All protocols, in the layers above and below IP,use the Internet Protocol to deliver data. All TCP/IP data flowsthrough IP, incoming and outgoing, regardless of its finaldestination.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-1-SECT-5.1">1.5.1 Internet Protocol</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-1-IX-INTERNET-PROTOCOL-IP"></A><ACLASS="indexterm"NAME="TCP2-CH-1-IX-INTERNET-PROTOCOL-IP2"></A>The Internet Protocol is the building block of the Internet. Itsfunctions include:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Defining the datagram, which is the basic unit of transmission in theInternet</P></LI><LICLASS="listitem"><PCLASS="para">Defining the Internet addressing scheme</P></LI><LICLASS="listitem"><PCLASS="para">Moving data between the Network Access Layer and the Host-to-HostTransport Layer</P></LI><LICLASS="listitem"><PCLASS="para">Routing datagrams to remote hosts</P></LI><LICLASS="listitem"><PCLASS="para">Performing fragmentation and re-assembly of datagrams</P></LI></UL><PCLASS="para">Before describing these functions in more detail, let's look at some ofIP's characteristics. First, IP is a <EMCLASS="emphasis">connectionless protocol</EM>.This means that IP does not exchange control information (called a&quot;handshake&quot;)<ACLASS="indexterm"NAME="AUTOID-585"></A>to establish an end-to-end connection before transmittingdata. In contrast, a <EMCLASS="emphasis">connection-oriented protocol</EM> exchangescontrol information with the remote system to verify that it is readyto receive data before any data is sent. When the handshaking issuccessful, the systems are said to have established a<EMCLASS="emphasis">connection</EM>. Internet Protocol relies on protocols in otherlayers to establish the connection if they require connection-orientedservice.</P><PCLASS="para">IP also relies on protocols in the other layers to provide error<ACLASS="indexterm"NAME="AUTOID-590"></A>detection and error<ACLASS="indexterm"NAME="AUTOID-593"></A>recovery. The Internet Protocol is sometimes calledan <EMCLASS="emphasis">unreliable protocol</EM> because it contains no error detection andrecovery code. This is not to say that the protocol cannot berelied on&nbsp;- quite the contrary. IP can be relied upon to accuratelydeliver your data to the connected network, but it doesn'tcheck whether that data was correctly received. Protocolsin other layers of the TCP/IP architecture provide this checking whenit is required.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="TCP2-CH-1-SECT-5.1.1">1.5.1.1 The datagram</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-1-IX-DATAGRAMS"></A>The TCP/IP protocols were built to transmit data over the ARPANET,<ACLASS="indexterm"NAME="AUTOID-602"></A>which was a <EMCLASS="emphasis">packet switching network</EM>.<ACLASS="indexterm"NAME="AUTOID-605"></A>A <EMCLASS="emphasis">packet</EM> is a block of data thatcarries with it the information necessary to deliver it&nbsp;- in a mannersimilar to a postal letter, which has an address written on itsenvelope. A packet switching network uses the addressing information inthe packets to switch packets from one physical network to another,moving them toward their final destination. Each packet travels thenetwork independently of any other packet.</P><PCLASS="para">The <EMCLASS="emphasis">datagram</EM> is the packet format defined by Internet Protocol.<ACLASS="xref"HREF="ch01_05.htm#TCP2-CH-1-FIG-4"TITLE="IP datagram format">Figure 1.5</A>is a pictorial representation of an IP datagram. The firstfive or six 32-bit words of the datagram are control informationcalled the <EMCLASS="emphasis">header</EM>.<ACLASS="indexterm"NAME="AUTOID-613"></A>By default, the header is five words long; thesixth word is optional. Because the header's length is variable, itincludes a field called <EMCLASS="emphasis">Internet Header Length (IHL)</EM><ACLASS="indexterm"NAME="AUTOID-616"></A><ACLASS="indexterm"NAME="AUTOID-618"></A>that indicates the header's length in words. The headercontains all the information necessary to deliver the packet.</P><H4CLASS="figure"><ACLASS="title"NAME="TCP2-CH-1-FIG-4">Figure 1.5: IP datagram format</A></H4><IMGCLASS="graphic"SRC="figs/tcp2_0105.gif"ALT="Figure 1.5"><PCLASS="para">The Internet Protocol delivers the datagram by checking the<EMCLASS="emphasis">Destination Address</EM><ACLASS="indexterm"NAME="AUTOID-625"></A>in word 5 of the header. The DestinationAddress is a standard 32-bit IP address that identifies the destinationnetwork and the specific host on that network. (The format of IPaddresses is explained in <ACLASS="xref"HREF="ch02_01.htm"TITLE="Delivering the Data">Chapter 2, <CITECLASS="chapter">Delivering the Data</CITE></A>.) If the Destination Address is theaddress of a host on the local network, the packet is delivereddirectly to the destination. If the Destination Address is not on thelocal network, the packet is passed to a gateway for delivery.<ACLASS="indexterm"NAME="AUTOID-628"></A><EMCLASS="emphasis">Gateways</EM> are devices that switch packets between thedifferent physical networks. Deciding which gateway to use iscalled <EMCLASS="emphasis">routing</EM>.<ACLASS="indexterm"NAME="AUTOID-632"></A>IP makes the routing decision for each individualpacket.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="TCP2-CH-1-SECT-5.1.2">1.5.1.2 Routing datagrams</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-638"></A>Internet gateways are commonly (and perhaps more accurately) referredto as <EMCLASS="emphasis">IP routers</EM> because they use Internet Protocol to routepackets between networks. In traditional TCP/IP jargon, there are onlytwo types of network devices&nbsp;- <EMCLASS="emphasis">gateways</EM> and <EMCLASS="emphasis">hosts</EM>. Gatewaysforward packets between networks, and hosts don't. However, if a hostis connected to more than one network (called a <EMCLASS="emphasis">multi-homed host</EM>),<ACLASS="indexterm"NAME="AUTOID-645"></A>it can forward packets between the networks. When a multi-homed hostforwards packets, it acts just like any other gateway and isconsidered to be a gateway. Current data communications terminologymakes a distinction between gateways and routers,[4]but we'll use the terms <EMCLASS="emphasis">gateway</EM> and <EMCLASS="emphasis">IP router</EM> interchangeably.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] In current terminology, a gateway moves data between differentprotocols and a router moves data between different networks. So a systemthat moves mail between TCP/IP and OSI is a gateway, but atraditional IP gateway is a router.</P></BLOCKQUOTE><PCLASS="para"><ACLASS="xref"HREF="ch01_05.htm#TCP2-CH-1-FIG-5"TITLE="Routing through gateways">Figure 1.6</A>shows the use of gateways to forward packets.The hosts (or <EMCLASS="emphasis">end systems</EM>) process packets through all four protocollayers, while the gateways (or <EMCLASS="emphasis">intermediate systems</EM>) process thepackets only up to the Internet Layer where the routing decisions aremade.</P><H4CLASS="figure"><ACLASS="title"NAME="TCP2-CH-1-FIG-5">Figure 1.6: Routing through gateways</A></H4><IMGCLASS="graphic"SRC="figs/tcp2_0106.gif"ALT="Figure 1.6"><PCLASS="para">Systems can only deliver packets to other devices attached to thesame physical network.<ACLASS="indexterm"NAME="AUTOID-660"></A>Packets from <EMCLASS="emphasis">A1</EM> destined for host <EMCLASS="emphasis">C1</EM>are forwarded through gateways <EMCLASS="emphasis">G1</EM> and <EMCLASS="emphasis">G2</EM>. Host <EMCLASS="emphasis">A1</EM>first delivers the packet to gateway <EMCLASS="emphasis">G1</EM>, with which it sharesnetwork <EMCLASS="emphasis">A</EM>. Gateway <EMCLASS="emphasis">G1</EM> delivers the packet to <EMCLASS="emphasis">G2</EM> overnetwork <EMCLASS="emphasis">B</EM>. Gateway <EMCLASS="emphasis">G2</EM> then delivers the packet directly tohost <EMCLASS="emphasis">C1</EM>, because they are both attached to network <EMCLASS="emphasis">C</EM>. Host<EMCLASS="emphasis">A1</EM> has no knowledge of any gateways beyond gateway <EMCLASS="emphasis">G1</EM>. Itsends packets destined for both networks <EMCLASS="emphasis">C</EM> and <EMCLASS="emphasis">B</EM> to thatlocal gateway, and then relies on that gateway to properly forward thepackets along the path to their destinations. Likewise, host <EMCLASS="emphasis">C1</EM>would send its packets to <EMCLASS="emphasis">G2</EM>, in order to reach a host on network<EMCLASS="emphasis">A</EM>, as well as any host on network <EMCLASS="emphasis">B</EM>.</P><PCLASS="para"><ACLASS="xref"HREF="ch01_05.htm#TCP2-CH-1-FIG-6"TITLE="Networks, gateways, and hosts">Figure 1.7</A>shows another view of routing. This figure emphasizesthat the underlying physical networks that a datagramtravels throughmay be different and even incompatible. Host <EMCLASS="emphasis">A1</EM> on the token<ACLASS="indexterm"NAME="AUTOID-687"></A>ring network routes the datagram through gateway <EMCLASS="emphasis">G1</EM>, to reachhost <EMCLASS="emphasis">C1</EM> on the Ethernet. Gateway <EMCLASS="emphasis">G1</EM> forwards the datathrough the X.25 network to gateway <EMCLASS="emphasis">G2</EM>, for delivery to <EMCLASS="emphasis">C1</EM>.The datagram traverses three physically different networks, buteventually arrives intact at <EMCLASS="emphasis">C1</EM>.</P><H4CLASS="figure"><ACLASS="title"NAME="TCP2-CH-1-FIG-6">Figure 1.7: Networks, gateways, and hosts</A></H4><IMGCLASS="graphic"SRC="figs/tcp2_0107.gif"ALT="Figure 1.7"></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="TCP2-CH-1-SECT-5.1.3">1.5.1.3 Fragmenting datagrams</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-702"></A>As a datagram is routed through different networks, it may be necessaryfor the IP module in a gateway to divide the datagram into smallerpieces. A datagram received from one network may be too large to betransmitted in a single packet on a different network. This conditionoccurs only when a gateway interconnects dissimilar physical networks.</P><PCLASS="para">Each type of network has a <EMCLASS="emphasis">maximum transmission unit</EM> (MTU),<ACLASS="indexterm"NAME="AUTOID-707"></A>which is the largest packet that it can transfer. If the datagram receivedfrom one network is longer than the other network's MTU, it isnecessary to divide the datagram into smaller <EMCLASS="emphasis">fragments</EM> fortransmission. This process is called <EMCLASS="emphasis">fragmentation</EM>.<ACLASS="indexterm"NAME="AUTOID-711"></A>Think of a train delivering a load of steel. Each railway car can carry moresteel than the trucks that will take it along the highway; soeach railway caris unloaded onto many different trucks. In the same way that arailroad is physically different from a highway, an Ethernet is<ACLASS="indexterm"NAME="AUTOID-713"></A>physically different from an X.25 network; IP must breakan Ethernet's relatively large packets into smallerpackets before it can transmit them over an X.25 network.<ACLASS="indexterm"NAME="AUTOID-715"></A></P><PCLASS="para">The format of each fragment is the same as the format of any normaldatagram. Header word 2 contains information that identifies eachdatagram fragment and provides information about how to re-assemble thefragments back into the original datagram. The Identification<ACLASS="indexterm"NAME="AUTOID-719"></A>field identifies what datagram the fragment belongs to, and theFragmentation Offset field<ACLASS="indexterm"NAME="AUTOID-721"></A>tells what piece of the datagram thisfragment is. The Flags field<ACLASS="indexterm"NAME="AUTOID-723"></A>has a &quot;More Fragments&quot; bit that tells IP if it has assembled all of the datagram fragments.<ACLASS="indexterm"NAME="AUTOID-725"></A></P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="TCP2-CH-1-SECT-5.1.4">1.5.1.4 Passing datagrams to the transport layer</A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-729"></A><ACLASS="indexterm"NAME="AUTOID-731"></A>When IP receives a datagram that is addressed to the local host, itmust pass the data portion of the datagram to the correct TransportLayer protocol. This is done by using the <EMCLASS="emphasis">protocol number</EM> from<ACLASS="indexterm"NAME="AUTOID-735"></A>word 3 of the datagram header. Each Transport Layer protocol has aunique protocol number that identifies it to IP.Protocol numbers are discussed in <ACLASS="xref"HREF="ch02_01.htm"TITLE="Delivering the Data">Chapter 2</A>.</P><PCLASS="para">You can see from this short overview that IP performs many importantfunctions. Don't expect to fully understand datagrams,gateways, routing, IP addresses, and all the other things that IP doesfrom this short description. Each chapter adds more details aboutthese topics. So let's continue on with the other protocol in theTCP/IP Internet Layer.<ACLASS="indexterm"NAME="AUTOID-740"></A><ACLASS="indexterm"NAME="AUTOID-741"></A></P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-1-SECT-5.2">1.5.2 Internet Control Message Protocol</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-745"></A>An integral part of IP is the <EMCLASS="emphasis">Internet Control Message Protocol</EM>(ICMP) defined in RFC 792. This protocol is part of the InternetLayer and uses the IP datagram delivery facility to send its messages.<ACLASS="indexterm"NAME="AUTOID-748"></A>ICMP sends messages that perform the following control, error reporting, andinformational functions for TCP/IP:</P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">Flow control</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-756"></A>When datagrams arrive too fast for processing, the destination host oran intermediate gateway sends an ICMP Source Quench Message back<ACLASS="indexterm"NAME="AUTOID-758"></A>to the sender. This tells the source to stop sendingdatagrams temporarily.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Detecting unreachable destinations</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-765"></A>When a destination is unreachable, the system detecting the problemsends a Destination Unreachable Message<ACLASS="indexterm"NAME="AUTOID-767"></A>to the datagram's source. Ifthe unreachable destination is a network or host, the message is sentby an intermediate gateway. But if the destination is an unreachableport, the destination host sends the message. (We discuss ports in<ACLASS="xref"HREF="ch02_01.htm"TITLE="Delivering the Data">Chapter 2</A>.)</P></DD><DTCLASS="term"><EMCLASS="emphasis">Redirecting routes</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-775"></A>A gateway sends the ICMP Redirect Message<ACLASS="indexterm"NAME="AUTOID-777"></A>to tell a host to useanother gateway, presumably because the other gateway is a betterchoice. This message can be used only when the source host is on thesame network as both gateways. To better understand this, refer to<ACLASS="xref"HREF="ch01_05.htm#TCP2-CH-1-FIG-6"TITLE="Networks, gateways, and hosts">Figure 1.7</A>If a host on the X.25 network sent a datagram to <EMCLASS="emphasis">G1</EM>,it would be possible for <EMCLASS="emphasis">G1</EM> to redirect that host to <EMCLASS="emphasis">G2</EM>becausethe host, <EMCLASS="emphasis">G1</EM>, and <EMCLASS="emphasis">G2</EM> are all attached to thesame network. On the other hand, if a host on the token ring networksent a datagram to <EMCLASS="emphasis">G1</EM>, the host could not be redirected to use<EMCLASS="emphasis">G2</EM>. This is because <EMCLASS="emphasis">G2</EM> is not attached to the token ring.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Checking remote hosts</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-793"></A>A host can send the ICMP Echo Message<ACLASS="indexterm"NAME="AUTOID-796"></A>to see if a remote system'sInternet Protocol is up and operational. When a system receives anecho message, it replies and sends the data from the packet back to thesource host. The <BCLASS="emphasis.bold">ping</B> command uses this message.<ACLASS="indexterm"NAME="AUTOID-799"></A></P></DD></DL></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch01_04.htm"TITLE="1.4 Network Access Layer"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 1.4 Network Access Layer"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch01_06.htm"TITLE="1.6 Transport Layer"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 1.6 Transport Layer"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">1.4 Network Access Layer</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">1.6 Transport Layer</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>