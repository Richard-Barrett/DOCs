<HTML><HEAD><TITLE>[Chapter 2] 2.5 The Routing Table</TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:31:18Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch02_01.htm"TITLE="2. Delivering the Data"><LINKREL="prev"HREF="ch02_04.htm"TITLE="2.4 Internet Routing Architecture"><LINKREL="next"HREF="ch02_06.htm"TITLE="2.6 Address Resolution"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_04.htm"TITLE="2.4 Internet Routing Architecture"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.4 Internet Routing Architecture"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 2<BR>Delivering the Data</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_06.htm"TITLE="2.6 Address Resolution"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.6 Address Resolution"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-2-SECT-5">2.5 The Routing Table</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-2-IX-ROUTING-TABLES"></A>Gateways route data between networks; but all network devices,hosts as well as gateways, must make routing decisions. For most hosts,the routing decisions are simple:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">If the destination host is on the local network, the data is deliveredto the destination host.<ACLASS="indexterm"NAME="AUTOID-1918"></A></P></LI><LICLASS="listitem"><PCLASS="para">If the destination host is on a remote network, the data is forwardedto a local gateway.<ACLASS="indexterm"NAME="AUTOID-1923"></A></P></LI></UL><PCLASS="para">Because routing is network-oriented, IP makes routing decisions based onthe network portion of the address. The IP module determines the networkpart of the destination's IP address by applying the network mask<ACLASS="indexterm"NAME="AUTOID-1927"></A>to the address. If the destination network is the local network, themask that is applied may be the local subnet mask. If no mask isprovided with the address, the address class determines the networkportion of the address.</P><PCLASS="para">After determining the destination network, the IP module looks up thenetwork in the local <EMCLASS="emphasis">routing table</EM>.  [7]Packets are routed toward their destination as directed by the routingtable. The routing table may be built by the system administrator or byrouting protocols, but the end result is the same; IP routing decisionsare simple table look-ups.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[7] This table is also called the <EMCLASS="emphasis">forwarding table</EM>.</P></BLOCKQUOTE><PCLASS="para">You can display the routing table's contents with the <BCLASS="emphasis.bold">netstat -nr</B> command.<ACLASS="indexterm"NAME="AUTOID-1937"></A>The <BCLASS="emphasis.bold">-r</B> option tells <BCLASS="emphasis.bold">netstat</B> to displaythe routing table, and the <BCLASS="emphasis.bold">-n</B> option tells <BCLASS="emphasis.bold">netstat</B> todisplay the table in numeric form. It's useful to display the routingtable in numeric form because the destination of most routes is anetwork, and networks are usually referred to by network numbers.</P><PCLASS="para">On a Solaris system,<ACLASS="indexterm"NAME="AUTOID-1945"></A>the <BCLASS="emphasis.bold">netstat</B> command displays the routing tablewith the following fields:</P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">Destination</EM></DT><DDCLASS="listitem"><PCLASS="para">The destination network (or host).</P></DD><DTCLASS="term"><EMCLASS="emphasis">Gateway</EM></DT><DDCLASS="listitem"><PCLASS="para">The gateway to use to reach the specified destination.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Flags</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-1964"></A>The flags describe certain characteristics of this route. The possibleflag values are:<DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">U</EM></DT><DDCLASS="listitem"><PCLASS="para">Indicates that the route is up and operational.</P></DD><DTCLASS="term"><EMCLASS="emphasis">H</EM></DT><DDCLASS="listitem"><PCLASS="para">Indicates this is a route to a specific host (most routesare to networks).</P></DD><DTCLASS="term"><EMCLASS="emphasis">G</EM></DT><DDCLASS="listitem"><PCLASS="para">Means the route uses a gateway. The system's network interfaces provideroutes to directly connected networks. All other routes use remotegateways. Directly connected networks do not have the G flag set; allother routes do.</P></DD><DTCLASS="term"><EMCLASS="emphasis">D</EM></DT><DDCLASS="listitem"><PCLASS="para">Means that this route was added because of an ICMP Redirect Message.<ACLASS="indexterm"NAME="AUTOID-1987"></A>When a system learns of a route via an ICMP Redirect, it adds the routeto its routing table, so that additional packets bound for thatdestination will not need to be redirected. The system uses the D flagto mark these routes.</P></DD></DL>&#13;</P></DD><DTCLASS="term"><EMCLASS="emphasis">Ref</EM></DT><DDCLASS="listitem"><PCLASS="para">The number of times the route has been referenced toestablish a connection.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Use</EM></DT><DDCLASS="listitem"><PCLASS="para">The number of packets transmitted via this route.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Interface</EM></DT><DDCLASS="listitem"><PCLASS="para">The name of the network interface[8]used by this route.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[8] The network interface is the network access hardware and software thatIP uses to communicate with the physical network. See <ACLASS="xref"HREF="ch06_01.htm"TITLE="Configuring the Interface ">Chapter 6, <CITECLASS="chapter">Configuring the Interface </CITE></A>, fordetails.</P></BLOCKQUOTE></DD></DL><PCLASS="para">The only two fields important for our current discussion are thedestination<ACLASS="indexterm"NAME="AUTOID-2008"></A>and gateway fields.<ACLASS="indexterm"NAME="AUTOID-2011"></A>The following is a samplerouting table:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>netstat -nr</B></CODE>Routing Table:Destination  Gateway        Flags  Ref    Use   Interface----------- -----------     -----  ----  -----  ---------127.0.0.1   127.0.0.1       UH      1      298       lo0 default     172.16.12.1     UG      2    50360         172.16.12.0 172.16.12.2     U      40   111379       le0 172.16.2.0  172.16.12.3     UG      4     1179         172.16.1.0  172.16.12.3     UG     10     1113        172.16.3.0  172.16.12.3     UG      2     1379        172.16.4.0  172.16.12.3     UG      4     1119</PRE></BLOCKQUOTE></P><PCLASS="para">The first table entry is the <EMCLASS="emphasis">loopback route</EM><ACLASS="indexterm"NAME="AUTOID-2018"></A>for the local host.This is the loopback address mentioned earlier as a reserved networknumber. Because every system uses the loopback route to send datagramsto itself, this entry is in every host's routing table. The H flag isset because it is a route to a specific host (127.0.0.1), not a route toan entire network (127.0.0.0). We'll see the loopback facility againwhen we discuss kernel configuration and the <BCLASS="emphasis.bold">ifconfig</B> command.For now, however, our real interest is in external routes.</P><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-2-IX-DEFAULT-GATEWAY"></A>Another unique entry in the routing table is the entry with the word&quot;default&quot; in the destination field. This entry is for the <EMCLASS="emphasis">defaultroute</EM>,<ACLASS="indexterm"NAME="AUTOID-2027"></A>and the gateway specified in this entry is the <EMCLASS="emphasis">defaultgateway</EM>. The default route is the other reserved network numbermentioned earlier: 0.0.0.0. The default gateway is used whenever thereis no specific route in the table for a destination network address.For example, this routing table has no entry for network 192.168.16.0.If IP receives any datagrams addressed to this network, it will sendthe datagram via the default gateway 172.16.12.1.<ACLASS="indexterm"NAME="AUTOID-2031"></A></P><PCLASS="para">You can tell from the sample routing table display that this host(<EMCLASS="emphasis">peanut</EM>) is directly connected to network 172.16.12.0. The routingtable entry for that network does not specify an external gateway; i.e.,the routing table entry for 172.16.12.0 does not have the G flag set.Therefore, <EMCLASS="emphasis">peanut</EM> must be directly connected to that network.</P><PCLASS="para">All of the gateways that appear in a routing table are on networksdirectly connected to the local system. In the sample shown above thismeans that, regardless of the destination address, the gatewayaddresses all begin with 172.16.12. This is the only network to which<EMCLASS="emphasis">peanut</EM> is directly attached, and therefore it is the only networkto which <EMCLASS="emphasis">peanut</EM> can directly deliver data. The gateways that<EMCLASS="emphasis">peanut</EM> uses to reach the rest of the Internet must be on<EMCLASS="emphasis">peanut</EM>'s subnet.</P><PCLASS="para">In <ACLASS="xref"HREF="ch02_05.htm#TCP2-CH-2-FIG-4"TITLE="Table-based routing">Figure 2.5</A>the IP layer of each host and gateway on our imaginarynetwork is replaced by a small piece of a routing table, showingdestination networks and the gateways used to reach thosedestinations. When the source host (172.16.12.2) sends data to thedestination host (172.16.1.2), it first determines that 172.16.1.2 isthe local network's official address and applies the subnet mask.(Network 172.16.0.0 is subnetted using the mask 255.255.255.0.) Afterapplying the subnet mask, IP knows that the destination's networkaddress is 172.16.1.0. The routing table in the source host shows thatdata bound for 172.16.1.0 should be sent to gateway 172.16.12.3.Gateway 172.16.12.3 makes direct delivery through its 172.16.1.5interface. Examining the routing tables shows that all systems listonly gateways on networks they are directly connected to. Note that172.16.12.1 is the default gateway for both 172.16.12.2 and172.16.12.3. But because 172.16.1.2 cannot reach network 172.16.12.0directly, it has a different default route.</P><H4CLASS="figure"><ACLASS="title"NAME="TCP2-CH-2-FIG-4">Figure 2.5: Table-based routing</A></H4><IMGCLASS="graphic"SRC="figs/tcp2_0205.gif"ALT="Figure 2.5"><PCLASS="para">A routing table does not contain end-to-end routes.<ACLASS="indexterm"NAME="AUTOID-2046"></A>A route points only to the next gateway, called the <EMCLASS="emphasis">next hop</EM>,<ACLASS="indexterm"NAME="AUTOID-2050"></A>along the path to the destination network.[9]The host relies on the local gateway to deliver the data, and thegateway relies on other gateways. As a datagram moves from one gatewayto another, it should eventually reach one that is directly connectedto its destination network. It is this last gateway that finallydelivers the data to the destination host.<ACLASS="indexterm"NAME="AUTOID-2056"></A></P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[9] As we'll see in <ACLASS="xref"HREF="ch07_01.htm"TITLE="Configuring Routing ">Chapter 7, <CITECLASS="chapter">Configuring Routing </CITE></A>, some routing protocols, such as OSPF andBGP, obtain end-to-end routing information. Nevertheless, the packetis still passed to the next-hop router.</P></BLOCKQUOTE></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_04.htm"TITLE="2.4 Internet Routing Architecture"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.4 Internet Routing Architecture"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_06.htm"TITLE="2.6 Address Resolution"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.6 Address Resolution"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">2.4 Internet Routing Architecture</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">2.6 Address Resolution</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>