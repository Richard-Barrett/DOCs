<HTML><HEAD><TITLE>[Chapter 2] 2.6 Address Resolution</TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:31:23Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch02_01.htm"TITLE="2. Delivering the Data"><LINKREL="prev"HREF="ch02_05.htm"TITLE="2.5 The Routing Table"><LINKREL="next"HREF="ch02_07.htm"TITLE="2.7 Protocols, Ports, and Sockets"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_05.htm"TITLE="2.5 The Routing Table"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.5 The Routing Table"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 2<BR>Delivering the Data</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_07.htm"TITLE="2.7 Protocols, Ports, and Sockets"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.7 Protocols, Ports, and Sockets"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-2-SECT-6">2.6 Address Resolution</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-2-IX-ADDRESSES-RESOLUTION-OF"></A>The IP address and the routing table direct a datagram to a specificphysical network, but when data travels across a network, it must obeythe physical layer protocols used by that network. The physicalnetworks<ACLASS="indexterm"NAME="AUTOID-2063"></A>that underlay the TCP/IP network do not understand IPaddressing. Physical networks have their own addressing schemes, andthere are as many different addressing schemes as there are differenttypes of physical networks. One task of the network access protocolsis to map IP addresses to physical network addresses.</P><PCLASS="para">The most common example of this network access layer function is thetranslation of IP addresses to Ethernet addresses. The protocol thatperforms this function is <EMCLASS="emphasis">Address Resolution Protocol</EM> (ARP),<ACLASS="indexterm"NAME="AUTOID-2068"></A>which is defined in RFC 826.</P><PCLASS="para">The ARP software maintains a table of translations between IP addressesand Ethernet addresses. This table is built dynamically. When ARPreceives a request to translate an IP address, it checks for theaddress in its table. If the address is found, it returns the Ethernetaddress to the requesting software. If the address is not found in thetable, ARP broadcasts a packet to every host on the Ethernet. Thepacket contains the IP address for which an Ethernet address is sought.If a receiving host identifies the IP address as its own, it respondsby sending its Ethernet address back to the requesting host. Theresponse is then cached in the ARP table.</P><PCLASS="para">The <BCLASS="emphasis.bold">arp</B> command displays the contents of the ARP table. To displaythe entire ARP table, use the <BCLASS="emphasis.bold">arp -a</B> command.<ACLASS="indexterm"NAME="AUTOID-2074"></A>Individual entriescan be displayed by specifying a hostname on the <BCLASS="emphasis.bold">arp</B> commandline. For example, to check the entry for <EMCLASS="emphasis">peanut</EM> in the ARP tableon <EMCLASS="emphasis">almond</EM>, enter:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>arp peanut</B></CODE>peanut (172.16.12.2) at 8:0:20:0:e:c8</PRE></BLOCKQUOTE></P><PCLASS="para">Checking all entries in the table with the <BCLASS="emphasis.bold">-a</B> option producesthe following output:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>arp -a</B></CODE>Net to Media TableDevice   IP Address                 Mask      Flags   Phys Addr ------ -----------------      --------------- ----- ---------------le0    peanut.nuts.com        255.255.255.255       08:00:20:00:0e:c8le0    acorn.nuts.com         255.255.255.255       08:00:02:05:21:33le0    almond.nuts.com        255.255.255.255 SP    08:00:20:22:fd:51le0    pecan.nuts.com         255.255.255.255       00:20:af:1e:7e:5fle0    BASE-ADDRESS.MCAST.NET 240.0.0.0       SM    01:00:5e:00:00:00</PRE></BLOCKQUOTE></P><PCLASS="para">This table tells you that when <EMCLASS="emphasis">almond</EM> forwards datagramsaddressed to <EMCLASS="emphasis">peanut</EM>, it puts those datagrams into Ethernetframes and sends them to Ethernet address 08:00:20:00:0e:c8.</P><PCLASS="para">Three of the entries in the sample table (<EMCLASS="emphasis">peanut</EM>, <EMCLASS="emphasis">acorn</EM>,and <EMCLASS="emphasis">pecan</EM>) were added dynamically as a result of queries by<EMCLASS="emphasis">almond</EM>. Two of the entries (<EMCLASS="emphasis">almond</EM> and<EMCLASS="emphasis">BASE-ADDRESS.MCAST.NET</EM>) are static entries added as a resultof the configuration of <EMCLASS="emphasis">almond</EM>. We know this because both ofthese entries have an S, for &quot;static,&quot; in the Flags field. The special<EMCLASS="emphasis">BASE-ADDRESS.MCAST.NET</EM> entry is for all multicast addresses.<ACLASS="indexterm"NAME="AUTOID-2100"></A>The M flag means &quot;mapping&quot; and is only used for the multicast entry.On a broadcast medium like Ethernet, the Ethernet broadcast address<ACLASS="indexterm"NAME="AUTOID-2103"></A>is used to make final delivery to a multicast group.</P><PCLASS="para">The P flag on the <EMCLASS="emphasis">almond</EM> entry means that this entry will be&quot;published.&quot;  The &quot;publish&quot; flag indicates that when an ARP query isreceived for the IP address of <EMCLASS="emphasis">almond</EM>, this system answers itwith the Ethernet address 08:00:20:22:fd:51. This is logical becausethis is the ARP table on <EMCLASS="emphasis">almond</EM>. However, it is also possible topublish Ethernet addresses for other hosts, not just for the local host.Answering ARP queries for other computers is called <EMCLASS="emphasis">proxy ARP</EM>.</P><PCLASS="para">For example: assume that <EMCLASS="emphasis">acorn</EM> is the server for a remotesystem named <EMCLASS="emphasis">hazel</EM> connected via a dial-up telephone line.Instead of setting up routing to the remote system, the administrator of<EMCLASS="emphasis">acorn</EM> could place a static, published entry in the ARP table withthe IP address of <EMCLASS="emphasis">hazel</EM> and the Ethernet address of <EMCLASS="emphasis">acorn</EM>.Now when <EMCLASS="emphasis">acorn</EM> hears an ARP query for the IP address of <EMCLASS="emphasis">hazel</EM>,it answers with its own Ethernet address. The other systems on thenetwork therefore send packets destined for <EMCLASS="emphasis">hazel</EM> to <EMCLASS="emphasis">acorn</EM>.<EMCLASS="emphasis">acorn</EM> then forwards the packets on to <EMCLASS="emphasis">hazel</EM> over thetelephone line. Proxy ARP is used to answer queries for systems thatcan't answer for themselves.</P><PCLASS="para">ARP tables normally don't require any attention because they are builtautomatically by the ARP protocol, which is very stable. However, ifthings go wrong, the ARP table can be manually adjusted.<ACLASS="indexterm"NAME="AUTOID-2124"></A>See <ACLASS="xref"HREF="ch11_01.htm"TITLE="Troubleshooting TCP/IP ">Chapter 11, <CITECLASS="chapter">Troubleshooting TCP/IP </CITE></A>, the section called &quot;Troubleshooting with thearp Command.&quot;<ACLASS="indexterm"NAME="AUTOID-2127"></A></P></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_05.htm"TITLE="2.5 The Routing Table"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.5 The Routing Table"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_07.htm"TITLE="2.7 Protocols, Ports, and Sockets"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.7 Protocols, Ports, and Sockets"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">2.5 The Routing Table</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">2.7 Protocols, Ports, and Sockets</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>