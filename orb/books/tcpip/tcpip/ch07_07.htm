<HTML><HEAD><TITLE>[Chapter 7] 7.7 Configuring gated </TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:35:56Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch07_01.htm"TITLE="7. Configuring Routing "><LINKREL="prev"HREF="ch07_06.htm"TITLE="7.6 Gateway Routing Daemon "><LINKREL="next"HREF="ch07_08.htm"TITLE="7.8 Summary "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_06.htm"TITLE="7.6 Gateway Routing Daemon "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.6 Gateway Routing Daemon "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 7<BR>Configuring Routing </FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_08.htm"TITLE="7.8 Summary "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.8 Summary "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-7-SECT-7">7.7 Configuring gated </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-7-IX-GATEWAY-ROUTING-DAEMON-GATED-CONFIGURING"></A><BCLASS="emphasis.bold">gated</B> is available from <ACLASS="systemitem.sitename"HREF="http://www.gated.org">http://www.gated.org</A>. <ACLASS="xref"HREF="appb_01.htm"TITLE="A gated Reference">Appendix B, <CITECLASS="appendix">A gated Reference</CITE></A>,provides information about downloading and compiling the software. Inthis section, we use <BCLASS="emphasis.bold">gated</B> release 3.5.5, the version of<BCLASS="emphasis.bold">gated</B> that is currently available without restrictions. Thereare other, newer versions of <BCLASS="emphasis.bold">gated</B> available to members of theGated Consortium. If you plan to build products based on <BCLASS="emphasis.bold">gated</B><ACLASS="indexterm"NAME="AUTOID-8667"></A>or you plan to do research on routing protocols using <BCLASS="emphasis.bold">gated</B>, youshould join the consortium. For the purposes of this book, release3.5.5 is fine.</P><PCLASS="para"><BCLASS="emphasis.bold">gated</B> reads its configuration from the <EMCLASS="emphasis">/etc/gated.conf</EM>file. The configuration commands in the file resemble C code. Allstatements end with a semicolon, and associated statements are groupedtogether by curly braces. This structure makes it simple to see whatparts of the configuration are associated with each other, which isimportant when multiple protocols are configured in the same file. Inaddition to structure in the language, the <EMCLASS="emphasis">/etc/gated.conf</EM> filealso has a structure.</P><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-7-IX-GATEWAY-ROUTING-DAEMON-GATED-COMMANDS-LISTED"></A>The different configuration statements, and the order in which thesestatements must appear, divide <EMCLASS="emphasis">gated.conf</EM> into sections:<EMCLASS="emphasis">option statements</EM>, <EMCLASS="emphasis">interface statements</EM>, <EMCLASS="emphasis">definitionstatements</EM>, <EMCLASS="emphasis">protocol statements</EM>, <EMCLASS="emphasis">static statements</EM>,<EMCLASS="emphasis">control statements</EM>, and <EMCLASS="emphasis">aggregate statements</EM>. Entering astatement out of order causes an error when parsing the file.</P><PCLASS="para">Two other types of statements do not fall into any of these categories.They are <EMCLASS="emphasis">directive statements</EM> and <EMCLASS="emphasis">trace statements</EM>. Thesecan occur anywhere in the <EMCLASS="emphasis">gated.conf</EM> file and do not directlyrelate to the configuration of any protocol. These statements provideinstructions to the parser, and instructions to control tracing fromwithin the configuration file.</P><PCLASS="para">The <BCLASS="emphasis.bold">gated</B> configuration commands are summarized in <ACLASS="xref"HREF="ch07_07.htm#TCP2-CH-7-TAB-1"TITLE="gated Configuration Statements">Table 7.2</A>The table lists each command by name, identifies the statement type,and provides a very short synopsis of each command's function. Theentire command language is covered in detail in <ACLASS="xref"HREF="appb_01.htm"TITLE="A gated Reference">Appendix B</A>.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="TCP2-CH-7-TAB-1">Table 7.2: gated Configuration Statements</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Statement</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Type</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Function</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">%directory</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">directive</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Sets the directory for include files</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">%include</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">directive</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Includes a file into <EMCLASS="emphasis">gated.conf</EM></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">traceoptions</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">trace</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Specifies which events are traced</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">options</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">option</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Defines gated options</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">interfaces</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">interface</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Defines interface options</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">autonomoussystem</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">definition</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Defines the AS number</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">routerid</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">definition</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Defines the originating router for BGP or OSPF</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">martians</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">definition</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Defines invalid destination addresses</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">snmp</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">protocol</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Enables reporting to SNMP</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">rip</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">protocol</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Enables RIP</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">hello</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">protocol</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Enables Hello protocol</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">isis</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">protocol</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Enables ISIS protocol </TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">kernel</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">protocol</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Configures kernel interface options</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">ospf</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">protocol</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Enables OSPF protocol</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">redirect</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">protocol</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Removes routes installed by ICMP</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">egp</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">protocol</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Enables EGP</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">bgp</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">protocol</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Enables BGP</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">icmp</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">protocol</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Configures the processing of general ICMP packets</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">static</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">static</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Defines static routes</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">import</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">control</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Defines what routes are accepted</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">export</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">control</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Defines what routes are advertised</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">aggregate</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">aggregate</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Controls route aggregation</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">generate</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">aggregate</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Controls creation of a default route</TD></TR></TBODY></TABLE><PCLASS="para">Just from this brief description, you can see that the <BCLASS="emphasis.bold">gated</B>configuration language has many commands. The language providesconfiguration control for several different protocols and additionalcommands to configure the added features of <BCLASS="emphasis.bold">gated</B> itself. All ofthis can be confusing.<ACLASS="indexterm"NAME="AUTOID-8799"></A></P><PCLASS="para">To avoid confusion, don't try to understand the details of everythingoffered by <BCLASS="emphasis.bold">gated</B>. Your routing environment will not use all ofthese protocols and features. Even if you are providing the gateway atthe border between two anonymous systems, you will probably only run tworouting protocols: one interior protocol and one exterior protocol.Only those commands that relate to your actual configuration need to beincluded in your configuration file. Asyou read this section, skip the things you don't need. For example, ifyou don't use the BGP protocol, don't study the <BCLASS="emphasis.bold">bgp</B> statement. Whenyou do need more details about a specific statement, look it up in<ACLASS="xref"HREF="appb_01.htm"TITLE="A gated Reference">Appendix B</A>. With this in mind, let's look at some sampleconfigurations.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-7-SECT-7.1">7.7.1 Sample gated.conf Configurations </A></H3><PCLASS="para">The details in <ACLASS="xref"HREF="appb_01.htm"TITLE="A gated Reference">Appendix B</A> may make <BCLASS="emphasis.bold">gated</B> configuration appearmore complex than it is. <BCLASS="emphasis.bold">gated</B>'s rich command language can be confusing, as can its support for multiple protocols and the fact that itoften provides a few ways to do the same thing. Butsome realistic examples will show that individual configurations do notneed to be complex.</P><PCLASS="para">The basis for the sample configurations is the network in <ACLASS="xref"HREF="ch07_07.htm#TCP2-CH-7-FIG-3"TITLE="Sample routing topology">Figure 7.4</A>We have installed a new router that provides our backbone with directaccess to the Internet, and we have decided to install new routingprotocols. We'll configure a host to listen to RIP-2 updates, aninterior gateway to run RIP-2 and OSPF, and an exterior gateway to runOSPF and BGP.</P><H4CLASS="figure"><ACLASS="title"NAME="TCP2-CH-7-FIG-3">Figure 7.4: Sample routing topology</A></H4><IMGCLASS="graphic"SRC="figs/tcp2_0704.gif"ALT="Figure 7.4"><PCLASS="para">Gateway <EMCLASS="emphasis">cashew</EM> interconnects subnet 172.16.9.0 and subnet 172.16.1.0.To hosts on subnet 9, it advertises itself as the default gateway,because it is the gateway to the outside world. It uses RIP-2 toadvertise routes on subnet 9. On subnet 1, gateway <EMCLASS="emphasis">cashew</EM> advertisesitself as the gateway to subnet 9 using OSPF.</P><PCLASS="para">Gateway <EMCLASS="emphasis">brazil</EM> provides subnet 1 with access to the Internet throughautonomous system 164. Because gateway <EMCLASS="emphasis">brazil</EM> provides access to theInternet, it announces itself as the default gateway to the othersystems on subnet 1 using OSPF. To the external autonomous system, ituses BGP to announce itself as the path to the internal networks itlearns about through OSPF.</P><PCLASS="para">Let's look at the routing configuration of host <EMCLASS="emphasis">macadamia</EM>, gateway<EMCLASS="emphasis">cashew</EM>, and gateway <EMCLASS="emphasis">brazil</EM>.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="TCP2-CH-7-SECT-7.1.1">7.7.1.1 A host configuration </A></H4><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-7-IX-GATEWAY-ROUTING-DAEMON-GATED-CONFIGURING-HOST-ROUTING"></A>The host routing configuration is very simple. The <BCLASS="emphasis.bold">rip yes</B>statement enables RIP, and that's all that is really required to run<ACLASS="indexterm"NAME="AUTOID-8833"></A>RIP. That basic configuration should work for any system that runsRIP. The additional clauses enclosed in curly braces modify the basic RIPconfiguration. We use a few clauses to create a more interestingexample. Here is the RIP-2 configuration for host <EMCLASS="emphasis">macadamia</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">##  enable rip, don't broadcast updates,#  listen for RIP-2 updates on the multicast address,#  check that the updates are authentic.#rip yes {        nobroadcast ;        interface 172.16.9.23             version 2              multicast              authentication simple &quot;REALstuff&quot; ;} ;</PRE></BLOCKQUOTE></P><PCLASS="para">This sample file shows the basic structure of <EMCLASS="emphasis">gated.conf</EM><ACLASS="indexterm"NAME="AUTOID-8841"></A>configuration statements. Lines beginning with a sharp sign (#) arecomments.<ACLASS="indexterm"NAME="AUTOID-8843"></A><ACLASS="indexterm"NAME="AUTOID-8845"></A><ACLASS="indexterm"NAME="AUTOID-8847"></A><ACLASS="indexterm"NAME="AUTOID-8849"></A>[12]<ACLASS="indexterm"NAME="AUTOID-8853"></A><ACLASS="indexterm"NAME="AUTOID-8856"></A>All statements end with semicolons. Clauses associated with aconfiguration statement can span multiple lines and are enclosed incurly braces (<CODECLASS="literal">{}</CODE>). In the example, the <CODECLASS="literal">nobroadcast</CODE> and<ACLASS="indexterm"NAME="AUTOID-8861"></A><ACLASS="indexterm"NAME="AUTOID-8864"></A><ACLASS="indexterm"NAME="AUTOID-8867"></A><CODECLASS="literal">interface</CODE> clauses apply directly to the rip statement. The<CODECLASS="literal">version</CODE>, <CODECLASS="literal">multicast</CODE>, and <CODECLASS="literal">authentication</CODE> keywordsare part of the interface clause.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[12] Comments can also be enclosed between a \* and a *\.</P></BLOCKQUOTE><PCLASS="para">The keyword <CODECLASS="literal">nobroadcast</CODE> prevents the host from broadcastingits own RIP updates. The default is <CODECLASS="literal">nobroadcast</CODE> when thesystem has one network interface and <CODECLASS="literal">broadcast</CODE> when it hasmore than one. The <CODECLASS="literal">nobroadcast</CODE> keyword performs the samefunction as the <BCLASS="emphasis.bold">-q</B> command-line option does for<BCLASS="emphasis.bold">routed</B>. However, <BCLASS="emphasis.bold">gated</B> can do much more than <BCLASS="emphasis.bold">routed</B>,as the next clause shows.</P><PCLASS="para">The <CODECLASS="literal">interface</CODE> clause defines interface parameters for RIP. Theparameters associated with this clause say that RIP-2 updates<ACLASS="indexterm"NAME="AUTOID-8885"></A>will be received via the RIP-2 multicast address on interface172.16.9.23, and that authentic updates will contain the password<CODECLASS="literal">REALstuff</CODE>. For RIP-2, <CODECLASS="literal">simple</CODE> authentication is a clear-textpassword up to 16 bytes long. This is not intended to protect thesystem from malicious actions; it is only intended to protect therouters from a configuration accident. If a user mistakenly sets hissystem up as a RIP supplier, he is very unlikely to accidently enterthe correct password into his configuration. Stronger authenticationwill soon be available in the form of a Message Digest 5 (MD5)<ACLASS="indexterm"NAME="AUTOID-8890"></A>cryptographic checksum by specifying <CODECLASS="literal">md5</CODE> in the authenticationclause.<ACLASS="indexterm"NAME="AUTOID-8893"></A></P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="TCP2-CH-7-SECT-7.1.2">7.7.1.2 Interior gateway configurations </A></H4><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-7-IX-GATEWAY-ROUTING-DAEMON-GATED-CONFIGURING-INTERIOR-GATEWAY"></A>Gateway configurations are more complicated than the simple hostconfiguration shown above. Gateways always have multiple interfacesand occasionally run multiple routing protocols. Our first sampleconfiguration is for the interior gateway between subnet 9 and thecentral backbone, subnet 1. It uses RIP-2 on subnet 9 to announceroutes to the UNIX hosts. It uses OSPF on subnet 1 to exchange routeswith the other gateways. Here's the configuration of gateway <EMCLASS="emphasis">cashew</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#  Don't time-out subnet 9interfaces {    interface 172.16.9.1 passive ;} ;# Define the OSPF router idrouterid 172.16.1.9 ;# Enable RIP-2; announce OSPF routes to# subnet 9 with a cost of 5.rip yes {    broadcast ;    defaultmetric 5 ;    interface 172.16.9.1         version 2         multicast         authentication simple &quot;REALstuff&quot; ;} ;# Enable OSPF; subnet 1 is the backbone area;# use password authentication.ospf yes {     backbone {         authtype simple ;         interface 172.16.1.9 {              priority 5 ;              authkey &quot;It'sREAL&quot; ;              } ;          } ;} ;</PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">interfaces</CODE> statement defines routing characteristics forthe network interfaces. The keyword <CODECLASS="literal">passive</CODE> in the interface<ACLASS="indexterm"NAME="AUTOID-8907"></A>clause is used here, just as we have seen it used before, to create apermanent static route that will not be removed from the routingtable. In this case, the permanent route is through a directlyattached network interface. Normally when <BCLASS="emphasis.bold">gated</B> thinks aninterface is malfunctioning, it increases the cost of the interface bygiving it a high-cost preference value (120) to reduce the probability<ACLASS="indexterm"NAME="AUTOID-8911"></A>of a gateway routing data through a non-operational interface.<BCLASS="emphasis.bold">gated</B> determines that an interface is malfunctioning when it doesnot receive routing updates on that interface. We don't want<BCLASS="emphasis.bold">gated</B> to downgrade the 172.16.9.1 interface, even if it doesthink the interface is malfunctioning, because our router is the onlypath to subnet 9. That's why this configuration includes the clause<CODECLASS="literal">interface 172.16.9.1 passive</CODE>.</P><PCLASS="para">The <CODECLASS="literal">routerid</CODE> statement defines the router identifier for OSPF.<ACLASS="indexterm"NAME="AUTOID-8919"></A>Unless it is explicitly defined in the configuration file, <BCLASS="emphasis.bold">gated</B>uses the address of the first interface it encounters as the defaultrouter identifier address. Here we specify the address of the interfacethat actually speaks OSPF as the OSPF router identifier.</P><PCLASS="para">In the previous example we discussed all the clauses on the <BCLASS="emphasis.bold">rip</B>statement except one&nbsp;- the <CODECLASS="literal">defaultmetric</CODE> clause.The <CODECLASS="literal">defaultmetric</CODE> clause defines the RIP metric usedto advertise routes learned from other routing protocols. This gateway runs both OSPF and RIP-2. We wish toadvertise the routes learned via OSPF to our RIP clients, and to do that, ametric is required. We choose a RIP cost of 5. If the<CODECLASS="literal">defaultmetric</CODE> clause is not used, routes learned from OSPF arenot advertised to the RIP clients.[13]This statement is required for our configuration.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[13] This is not strictly true. The routes are advertised with a cost of 16,meaning that the destinations are unreachable.</P></BLOCKQUOTE><PCLASS="para">The <CODECLASS="literal">ospf yes</CODE> statement enables OSPF. The first clause<ACLASS="indexterm"NAME="AUTOID-8931"></A><ACLASS="indexterm"NAME="AUTOID-8934"></A>associated with this statement is <CODECLASS="literal">backbone</CODE>. It states that the<ACLASS="indexterm"NAME="AUTOID-8938"></A>router is part of the OSPF backbone area. Every <CODECLASS="literal">ospf yes</CODE>statement must have at least one associated area clause. It can definea specific area, e.g., <CODECLASS="literal">area 2</CODE>, but at least one router must bein the backbone area. While the OSPF backbone is area 0, it cannot bespecified as <CODECLASS="literal">area 0</CODE>; it must be specified with the keyword<CODECLASS="literal">backbone</CODE>. In our sample configuration, subnet 1 is thebackbone and all routers attached to it are in the backbone area. Itis possible for a single router to attach to multiple areas with adifferent set of configuration parameters for each area. Notice howthe nested curly braces group the clauses together. The remainingclauses in the configuration file are directly associated with thebackbone area clause.</P><PCLASS="para">The <CODECLASS="literal">authtype simple ;</CODE> clause says that simple, password-based<ACLASS="indexterm"NAME="AUTOID-8946"></A>authentication is used in the backbone area. Two choices, <CODECLASS="literal">simple</CODE> and<CODECLASS="literal">none</CODE>, are available for authtype in GateD 3.5.5. <CODECLASS="literal">none</CODE> means noauthentication is used. <CODECLASS="literal">simple</CODE> means that the correcteight-character password must be used or the update will be rejected. Passwordauthentication is used only to protect against accidents. It is notintended to protect against malicious actions. Stronger authenticationbased on MD5 is being developed.</P><PCLASS="para">The interface that connects this router to the backbone area is definedby the interface clause. It has two associated subclauses. The<CODECLASS="literal">authkey &quot;It'sREAL&quot; ;</CODE> clause defines the password used forsimple authentication by this interface. The <CODECLASS="literal">priority 5 ;</CODE>clause defines the priority used by this router when the backbone iselecting a designated router. The higher the priority number, the lesslikely a router will be elected as the designated router. Use<CODECLASS="literal">priority</CODE> to steer the election toward the most capablerouters.<ACLASS="indexterm"NAME="AUTOID-8956"></A></P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="TCP2-CH-7-SECT-7.1.3">7.7.1.3 Exterior gateway configuration </A></H4><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-7-IX-GATEWAY-ROUTING-DAEMON-GATED-CONFIGURING-EXTERIOR-GATEWAY"></A>The configuration for gateway <EMCLASS="emphasis">brazil</EM> is the most complex because itruns both OSPF and BGP. The configuration file for gateway <EMCLASS="emphasis">brazil</EM> is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># Defines our AS number for BGPautonomoussystem 249;# Defines the OSPF router idrouterid 172.16.1.1;# Disable RIPrip no;# Enable BGPbgp yes {   preference 50 ;   group type external peeras 164 {        peer 10.6.0.103 ;        peer 10.20.0.72 ;        };};# Enable OSPF; subnet 1 is the backbone area;# use password authentication.ospf yes {     backbone {         authtype simple ;         interface 172.16.1.1 {              priority 10 ;              authkey &quot;It'sREAL&quot; ;              } ;          } ;};# Announce routes learned from OSPF and route# to directly connected network via BGP to AS 164export proto bgp as 164 {     proto direct ;     proto ospf ;};# Announce routes learned via BGP from # AS number 164 to our OSPF area.export proto ospfase type 2  {     proto bgp as 164  {          all ;             };};</PRE></BLOCKQUOTE></P><PCLASS="para">This configuration enables both BGP and OSPF, and sets certainprotocol-specific parameters. BGP needs to know the AS number, whichis 249 for <EMCLASS="emphasis">nuts-net</EM>. OSPF needs to know the router identifieraddress. We set it to the address of the router interface that runsOSPF. The AS number and the router identifier are defined early in theconfiguration because <CODECLASS="literal">autonomoussystem</CODE> and <CODECLASS="literal">routerid</CODE>are definition statements, and therefore must occur before the firstprotocol statement. Refer back to<ACLASS="xref"HREF="ch07_07.htm#TCP2-CH-7-TAB-1"TITLE="gated Configuration Statements">Table 7.2</A>for the various statement types.</P><PCLASS="para">The first protocol statement is the one that turns RIP off. We don'twant to run RIP and the default for <BCLASS="emphasis.bold">gated</B> is to turn RIP on.Therefore we explicitly disable RIP with the <CODECLASS="literal">rip no ;</CODE>statement.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8977"></A>BGP is enabled by the <CODECLASS="literal">egp yes</CODE> statement, which also defines afew additional BGP parameters. The <CODECLASS="literal">preference 50 ;</CODE> clausetells <BCLASS="emphasis.bold">gated</B> to set the preference for routes received via BGP to50.  The default for these routes is 170. By changing the preference to 50,we make the routes highly favored. Setting a preference value of 50allows BGP routes to override static routes, though they will notoverride routes learned from OSPF. This is solely for the purposeof illustration. You probably don't want to make an external routehighly preferred. See<ACLASS="xref"HREF="ch07_06.htm#TCP2-CH-7-TAB-0"TITLE="Default Preference Values">Table 7.1</A>for the list ofdefault preferences.</P><PCLASS="para">The <CODECLASS="literal">group</CODE> clause sets parameters for all of the BGP peers in thegroup. The clause defines the type of BGP connection being created. Theexample is a classic external routing protocol connection, and theexternal autonomous system we are connecting to is AS number 164.<BCLASS="emphasis.bold">gated</B> can create five different types of BGP sessions, but onlyone, <CODECLASS="literal">type external</CODE>, is used to directly communicate with anexternal autonomous system. The other four group types are used forinternal BGP (IBGP).<ACLASS="indexterm"NAME="AUTOID-8988"></A>[14]IBGP is simply an acronym used for BGP when it is used to move routinginformation around inside of an autonomous system. In our example weuse it to move routing information between autonomous systems.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[14] See <ACLASS="xref"HREF="appb_01.htm"TITLE="A gated Reference">Appendix B</A> for information on all group types.</P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-8995"></A>The BGP neighbors from which updates are accepted are indicated by the<ACLASS="indexterm"NAME="AUTOID-8998"></A>peer clauses. Each peer is a member ofthe group. Everything related to the group, such as the AS number,applies to every system in the group. To accept updates from any system, use<CODECLASS="literal">allow</CODE> in place of the list of peers.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9003"></A>The OSPF protocol is enabled by the <BCLASS="emphasis.bold">ospf yes</B> statement. Theconfiguration of OSPF on this router is the same as it is for otherrouters in the backbone area. The only parameter that has been changedfrom the previous example is the priority number. Because this routehas a particularly heavy load, we have decided to make it slightly lesspreferred for the designated router election.</P><PCLASS="para">The export statements control the routes that <BCLASS="emphasis.bold">gated</B> advertises toother routers. The first export statement directs <BCLASS="emphasis.bold">gated</B> to useBGP (<CODECLASS="literal">proto bgp</CODE>) to advertise to autonomous system 164 (<CODECLASS="literal">as164</CODE>) any directly connected networks (<CODECLASS="literal">proto direct</CODE>) and anyroutes learned from OSPF (<CODECLASS="literal">proto ospf</CODE>). Notice that the ASnumber specified in this statement is not the AS number of<EMCLASS="emphasis">nuts-net</EM>. It is the autonomous system number of the externalsystem. The first line of the export statement defines to whom we areadvertising. The proto clauses located within the curly braces define<ACLASS="indexterm"NAME="AUTOID-9015"></A>what we are advertising.</P><PCLASS="para">The second export statement announces the routes learned from theexternal autonomous system. The routes are received via BGP and areadvertised via OSPF. Because these are routes from an externalautonomous system, they are advertised as <EMCLASS="emphasis">autonomous systemexternal</EM> (ASE) routes. That's why the export statement specifies<ACLASS="indexterm"NAME="AUTOID-9019"></A><CODECLASS="literal">ospfase</CODE> as the protocol through which the routes are<ACLASS="indexterm"NAME="AUTOID-9023"></A>announced. The <CODECLASS="literal">type 2</CODE> parameter defines the type of externalroutes that are being advertised. There are two types supported by<BCLASS="emphasis.bold">gated</B>. Type 2 routes are those learned from an exterior gatewayprotocol that does not provide a routing metric comparable to the OSPFmetric. These routes are advertised with the cost of reaching theborder router. In this case, the routes are advertised with the OSPFcost of reaching gateway <EMCLASS="emphasis">brazil</EM>. Type 1 routes are those learned froman external protocol that does provide a metric directly comparable tothe OSPF metric. In that case, the metric from the external protocolis added to the cost of reaching the border router when routes areadvertised.</P><PCLASS="para">The source of the routes advertised in the second export statement isthe BGP connection (<CODECLASS="literal">proto bgp</CODE>) to autonomous system 164<ACLASS="indexterm"NAME="AUTOID-9030"></A>(<CODECLASS="literal">as 164</CODE>). The proto clause is qualified with an optional<EMCLASS="emphasis">route filter</EM>. A route filter is used to select the routes from aspecific source. The filter can listnetworks with associated netmasks to select an individual destination. Inthe example, the keyword <CODECLASS="literal">all</CODE> is used to select all routesreceived via BGP, which is, in fact, the default.</P><PCLASS="para">All of the routes received from an external autonomous system couldproduce a very large routing table. Individual routes are useful whenyou have multiple border routers that can reach the outside world.<ACLASS="indexterm"NAME="AUTOID-9037"></A>However, if you have only one border router, a default route may be allthat is needed. To export a default route, insert an <CODECLASS="literal">optionsgendefault ;</CODE> statement in the beginning of the configurationfile.[15]This tells <BCLASS="emphasis.bold">gated</B> to generate a default routewhen the system peers with a BGP neighbor. Next, replace the second export statement in the sample file with the following export statement:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[15] The <CODECLASS="literal">generate</CODE> statement is an alternative way to create adefault route. See <ACLASS="xref"HREF="appb_01.htm"TITLE="A gated Reference">Appendix B</A> for details.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># Announce a default route when peering # with a BGP neighbor. export proto ospfase type 2  {     proto default ;   };</PRE></BLOCKQUOTE></P><PCLASS="para">This export statement tells <BCLASS="emphasis.bold">gated</B> to advertise the border routeras the default gateway, but only when it has an active connection tothe external system.<ACLASS="indexterm"NAME="AUTOID-9049"></A></P><PCLASS="para">These few examples show that <EMCLASS="emphasis">gated.conf</EM> files are usually smalland easy to read. Use <BCLASS="emphasis.bold">gated</B> if you need to run a<ACLASS="indexterm"NAME="AUTOID-9053"></A><ACLASS="indexterm"NAME="AUTOID-9056"></A>routing protocol on your computer. It allows you to use the samesoftware and the same configuration language on all of your hosts,interior gateways, and exterior gateways.</P></DIV></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-7-SECT-7.2">7.7.2 Testing the Configuration </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-7-IX-GATEWAY-ROUTING-DAEMON-GATED-TESTING-THE-CONFIGURATION"></A>Test the configuration file before you try to use it. The <BCLASS="emphasis.bold">gated</B>configuration syntax is complex and it is easy to make a mistake.Create your new configuration in a test file; test the newconfiguration; then move the test configuration to<EMCLASS="emphasis">/etc/gated.conf</EM>. Here's how.</P><PCLASS="para">Assume that a configuration file called <EMCLASS="emphasis">test.conf</EM> has alreadybeen created. It is tested using <BCLASS="emphasis.bold">-f</B> and <BCLASS="emphasis.bold">-c</B> on the commandline:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>gated -c -f test.conf trace.test</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <BCLASS="emphasis.bold">-f</B> option tells <BCLASS="emphasis.bold">gated</B> to read the configuration fromthe named file instead of from <EMCLASS="emphasis">/etc/gated.conf</EM>. In the sample itreads the configuration from <EMCLASS="emphasis">test.conf</EM>. The <BCLASS="emphasis.bold">-c</B> optiontells <BCLASS="emphasis.bold">gated</B> to read the configuration file and check for syntaxerrors. When <BCLASS="emphasis.bold">gated</B> finishes reading the file, it terminates; itdoes not modify the routing table. The <BCLASS="emphasis.bold">-c</B> option turns ontracing, so specify a trace file or the trace data will be displayedon your terminal. In the sample we specified <EMCLASS="emphasis">trace.test</EM> as thetrace file. The <BCLASS="emphasis.bold">-c</B> option also produces a snapshot of thestate of <BCLASS="emphasis.bold">gated</B> after reading the configuration file and writes thesnapshot to <EMCLASS="emphasis">/usr/tmp/gated_dump</EM>. You don't need to be superuseror to terminate the active <BCLASS="emphasis.bold">gated</B> process to run <BCLASS="emphasis.bold">gated</B> whenthe <BCLASS="emphasis.bold">-c</B> option is used.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9092"></A><ACLASS="indexterm"NAME="AUTOID-9094"></A>The dump and the trace file (<EMCLASS="emphasis">trace.test</EM>) can then be examined forerrors and other information. When you're confident that theconfiguration is correct, become superuser and move your newconfiguration (<EMCLASS="emphasis">test.conf</EM>) to <EMCLASS="emphasis">/etc/gated.conf</EM>.</P><PCLASS="para">An alternative command for testing the configuration file is <BCLASS="emphasis.bold">gdc</B>,<ACLASS="indexterm"NAME="AUTOID-9102"></A>though it must be run by the root user. It includes features forchecking and installing a new configuration. <BCLASS="emphasis.bold">gdc</B> uses threedifferent configuration files. The current configuration is<EMCLASS="emphasis">/etc/gated.conf</EM>. The previous configuration is stored in<EMCLASS="emphasis">/etc/gated.conf-</EM>. The &quot;next&quot; configuration is stored in<EMCLASS="emphasis">/etc/gated.conf+</EM>, which is normally the configuration that needsto be tested. Here's how <BCLASS="emphasis.bold">gdc</B> tests a configuration:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>cp test.conf /etc/gated.conf+</B></CODE># <CODECLASS="userinput"><B>gdc checknew</B></CODE>configuration file /etc/gated.conf+ checks out okay# <CODECLASS="userinput"><B>gdc newconf</B></CODE># <CODECLASS="userinput"><B>gdc restart</B></CODE>gated not currently runninggdc: /etc/gated was started</PRE></BLOCKQUOTE></P><PCLASS="para">In this sample the test configuration was copied to<EMCLASS="emphasis">/etc/gated.conf+</EM> and tested with the <BCLASS="emphasis.bold">gdc checknew</B>command. If syntax problems are found in the file, a warning message isdisplayed and the detailed error messages are written to<EMCLASS="emphasis">/usr/tmp/gated_parse</EM>. There were no syntax errors in the exampleso we make the test file the current configuration with the <BCLASS="emphasis.bold">gdcnewconf</B> command. This command moves the current configuration to<EMCLASS="emphasis">gated.conf-</EM> and moves the new configuration (<EMCLASS="emphasis">gated.conf+</EM>) tothe current configuration. The <BCLASS="emphasis.bold">gdc restart</B> command terminates<BCLASS="emphasis.bold">gated</B> if it is currently running&nbsp;- it was not in theexample&nbsp;- and starts a new copy of <BCLASS="emphasis.bold">gated</B> using the newconfiguration.<ACLASS="indexterm"NAME="AUTOID-9125"></A><ACLASS="indexterm"NAME="AUTOID-9126"></A></P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="TCP2-CH-7-SECT-7.2.1">7.7.2.1 Running gated at startup </A></H4><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-7-IX-GATEWAY-ROUTING-DAEMON-GATED-RUNNING-AT-STARTUP"></A>As with any routing software, <BCLASS="emphasis.bold">gated</B> should be included in yourstartup file. Some systems come with the code to start <BCLASS="emphasis.bold">gated</B>included in the startup file. If your system doesn't, you'll need toadd it. If you already have code in your startup file that runs<BCLASS="emphasis.bold">routed</B>, replace it with code to run <BCLASS="emphasis.bold">gated</B>. <BCLASS="emphasis.bold">gated</B> and<BCLASS="emphasis.bold">routed</B> should not be running at the same time.&#13;</P><PCLASS="para">Our imaginary gateway, <EMCLASS="emphasis">almond</EM>, is a Solaris system with code inthe <EMCLASS="emphasis">/etc/init.d/inetinit</EM> file that starts <BCLASS="emphasis.bold">routed</B>. Wecomment out those lines, and add these lines:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">if [ -f /usr/sbin/gated -a -f /etc/gated.conf ]; then     /usr/sbin/gated;      echo -n 'gated' &gt; /dev/consolefi</PRE></BLOCKQUOTE></P><PCLASS="para">This code assumes that <BCLASS="emphasis.bold">gated</B> is installed in <EMCLASS="emphasis">/usr/sbin</EM> andthat the configuration file is named <EMCLASS="emphasis">/etc/gated.conf</EM>. The codechecks that <BCLASS="emphasis.bold">gated</B> is present, and that the configuration file<EMCLASS="emphasis">/etc/gated.conf</EM> exists. If both files are found, <BCLASS="emphasis.bold">gated</B> begins.</P><PCLASS="para">The code checks for a configuration file because <BCLASS="emphasis.bold">gated</B> usuallyruns with one. If <BCLASS="emphasis.bold">gated</B> is started without a configuration file,it checks the routing table for a default route. If it doesn't findone, it starts RIP; otherwise, it just uses the default route. Create an<ACLASS="indexterm"NAME="AUTOID-9155"></A><ACLASS="indexterm"NAME="AUTOID-9159"></A><EMCLASS="emphasis">/etc/gated.conf</EM> file even if you only want to run RIP. Theconfiguration file documents your routing configuration and protectsyou if the default configuration of <BCLASS="emphasis.bold">gated</B> changes in the future.<ACLASS="indexterm"NAME="AUTOID-9164"></A><ACLASS="indexterm"NAME="AUTOID-9165"></A></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_06.htm"TITLE="7.6 Gateway Routing Daemon "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.6 Gateway Routing Daemon "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_08.htm"TITLE="7.8 Summary "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.8 Summary "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">7.6 Gateway Routing Daemon </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">7.8 Summary </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>