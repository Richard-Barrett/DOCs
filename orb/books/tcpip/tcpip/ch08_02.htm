<HTML><HEAD><TITLE>[Chapter 8] 8.2 Configuring the Resolver </TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:36:32Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch08_01.htm"TITLE="8. Configuring DNS Name Service "><LINKREL="prev"HREF="ch08_01.htm"TITLE="8.1 BIND: UNIX Name Service "><LINKREL="next"HREF="ch08_03.htm"TITLE="8.3 Configuring named "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_01.htm"TITLE="8.1 BIND: UNIX Name Service "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.1 BIND: UNIX Name Service "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8<BR>Configuring DNS Name Service </FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_03.htm"TITLE="8.3 Configuring named "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.3 Configuring named "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-8-SECT-2">8.2 Configuring the Resolver </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-8-IX-RESOLVER-CONFIGURING"></A>The resolver is configured in the <EMCLASS="emphasis">/etc/resolv.conf</EM> file. The<ACLASS="indexterm"NAME="AUTOID-9311"></A><ACLASS="indexterm"NAME="AUTOID-9314"></A>resolver is not a separate and distinct process; it is a library ofroutines called by network processes. <ACLASS="indexterm"NAME="AUTOID-9316"></A>The <EMCLASS="emphasis">resolv.conf</EM> file is read when a process using the resolverstarts, and is cached for the life of that process. If theconfiguration file is not found, the resolver attempts to connect tothe <BCLASS="emphasis.bold">named</B> server running on the local host. While this may work,I don't recommend it. By allowing the resolver configuration todefault, you give up control over your system and become vunerable tovariations in the techniques used by different systems to determinethe default configuration. For these reasons, the resolverconfiguration file should be created on every system running BIND.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-8-SECT-2.1">8.2.1 The Resolver Configuration File </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-8-IX-RESOLV-CONF-FILE"></A>The configuration file clearly documents the resolver configuration.It allows you to identify up to three nameservers, two of whichprovide backup if the first server doesn't respond. It defines thedefault domain and various other processing options. The<EMCLASS="emphasis">resolv.conf</EM> file is an important part of configuring nameservice.</P><PCLASS="para"><EMCLASS="emphasis">resolv.conf</EM> is a simple, human-readable file. There aresystem-specific variations in the commands used in the file, but theentries supported by most systems are:</P><DLCLASS="variablelist"><DTCLASS="term"><BCLASS="emphasis.bold">nameserver </B><CODECLASS="replaceable"><I>address</I></CODE></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9336"></A>The <BCLASS="emphasis.bold">nameserver</B> entries identify, by IP address, the servers thatthe resolver is to query for domain information. The nameservers arequeried in the order that they appear in the file. If  no response isreceived from a server, the next server in the list is tried until themaximum number of servers are tried.[3]If no <BCLASS="emphasis.bold">nameserver</B> entries are contained in the <EMCLASS="emphasis">resolv.conf</EM>file or no <EMCLASS="emphasis">resolv.conf</EM> file exists, all nameserver queries aresent to the local host. However, if there is a <EMCLASS="emphasis">resolv.conf</EM> file andit contains <BCLASS="emphasis.bold">nameserver</B> entries, the local host is <EMCLASS="emphasis">not</EM> queriedunless one entry points to the local host. Specify the local host with itsofficial IP address, not with the loopback address and not with 0.0.0.0.The official address avoids problems seen on some versions of UNIX.A resolver-only configuration never contains a <BCLASS="emphasis.bold">nameserver</B> entrythat points to the local host.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] Three is the maximum number of servers tried by most BINDimplementations.</P></BLOCKQUOTE></DD><DTCLASS="term"><BCLASS="emphasis.bold">domain </B><CODECLASS="replaceable"><I>name</I></CODE></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9354"></A>The <BCLASS="emphasis.bold">domain</B> entry defines the default domain name. The resolver<ACLASS="indexterm"NAME="AUTOID-9358"></A>appends the default domain name to any hostname that does not containa dot.[4]It then uses the expanded hostname in the query it sends to the nameserver. For example, if the hostname <EMCLASS="emphasis">almond</EM> (which does notcontain a dot) is received by the resolver, the default domain name isappended to <EMCLASS="emphasis">almond</EM> to construct the query. If the value for<CODECLASS="replaceable"><I>name</I></CODE> in the <BCLASS="emphasis.bold">domain</B> entry is <CODECLASS="literal">nuts.com</CODE>, the resolverqueries for <EMCLASS="emphasis">almond.nuts.com</EM>. If the environment variable<ACLASS="indexterm"NAME="AUTOID-9370"></A>LOCALDOMAIN is set, it overrides the <BCLASS="emphasis.bold">domain</B> entry and the valueof LOCALDOMAIN is used to expand hostname.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] This is the most common way that default domain names are used, but itis not the only way. See the section &quot;Domain Names&quot; in <ACLASS="xref"HREF="ch03_01.htm"TITLE="Network Services">Chapter 3</A> formore details.</P></BLOCKQUOTE></DD><DTCLASS="term"><BCLASS="emphasis.bold">search </B><CODECLASS="replaceable"><I>domain</I></CODE> ...</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9379"></A>The <BCLASS="emphasis.bold">search</B> entry defines a series of domains that are searchedwhen a hostname does not contain a dot. Assume the entry <BCLASS="emphasis.bold">searchessex.nuts.com butler.nuts.com</B>. A query for the hostname<EMCLASS="emphasis">roaster</EM> is first tried as <EMCLASS="emphasis">roaster.essex.nuts.com</EM>. If thatfails to provide a successful match, the resolver queries for<EMCLASS="emphasis">roaster.butler.nuts.com</EM>. If that query fails, no other attemptsare made to resolve the hostname. This is different from the actionof the <BCLASS="emphasis.bold">domain</B> entry. Assume the entry <BCLASS="emphasis.bold">domainbutler.nuts.com</B>. Now a query for <EMCLASS="emphasis">roaster</EM> is first tried as<EMCLASS="emphasis">roaster.butler.nuts.com</EM> and then as <EMCLASS="emphasis">roaster.nuts.com</EM> if thefirst query fails. When a <BCLASS="emphasis.bold">search</B> statement is used, only thedomains explicitly mentioned on the command line are searched. When a<BCLASS="emphasis.bold">domain</B> statement is used, the default domain and its parents aresearched. A parent domain must be at least two fields long to besearched. The resolver would not search for <EMCLASS="emphasis">roaster.com</EM>. Useeither a <BCLASS="emphasis.bold">search</B> statement or a <BCLASS="emphasis.bold">domain</B> statement. Never useboth in the same configuration. If the environment variable LOCALDOMAINis set, it overrides the <BCLASS="emphasis.bold">search</B> entry.</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">sortlist </B><CODECLASS="replaceable"><I>network</I></CODE> ...</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9403"></A>Addresses from the networks listed on the <BCLASS="emphasis.bold">sortlist</B> commandare preferred over other addresses. If the resolver receives multiple<ACLASS="indexterm"NAME="AUTOID-9406"></A>addresses in response to a query about a multi-homed host or a router,<ACLASS="indexterm"NAME="AUTOID-9409"></A>it reorders the addresses so that an address from a network listed inthe <BCLASS="emphasis.bold">sortlist</B> statement is placed in front of the other addresses.Normally addresses are returned to the application by the resolver in theorder that they are received. The only exception to this is that, bydefault, addresses on a shared network are preferred over other addresses.So if the computer running the resolver is connected to network 172.16.0.0and one of the addresses returned in a multiple address response is fromthat network, the address from 172.16.0.0 is placed in front of theother addresses.</P><PCLASS="para">The <BCLASS="emphasis.bold">sortlist</B> command is rarely used. To be of any use, itrequires that a remote host has multiple addresses for the same name;that the path to one of those addresses is clearly superior to the others;and that you know enough about the remote configuration to know whichaddress is preferable.</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">options </B><CODECLASS="replaceable"><I>option</I></CODE> ...</DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9421"></A>The <BCLASS="emphasis.bold">options</B> entry is used to select optional settings for theresolver. At this writing there are two valid keywords for<CODECLASS="replaceable"><I>option</I></CODE>: <CODECLASS="literal">debug</CODE> <ACLASS="indexterm"NAME="AUTOID-9427"></A>to turn on debugging; and <CODECLASS="literal">ndots:</CODE><CODECLASS="replaceable"><I>n</I></CODE> to set the number ofdots in a hostname used to determine whether or not the default domainneeds to be applied. The default is 1.  Therefore a hostname with onedot in it does not have the default domain appended before it ispassed to the nameserver. If <CODECLASS="literal">options ndots:2</CODE> is specified, ahostname with one dot in it has the default domain added before thequery is sent out, but an address with two or more dots does not havethe default domain added.</P></DD></DL><PCLASS="para">The most common <EMCLASS="emphasis">resolv.conf</EM> configuration defines the defaultdomain name, the local host as the first nameserver, and two backupnameservers. An example of this configuration is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># Domain name resolver configuration file#domain nuts.com# try yourself firstnameserver 172.16.12.2# try almond nextnameserver 172.16.12.1# finally try filbertnameserver 172.16.1.2</PRE></BLOCKQUOTE></P><PCLASS="para">The example is based on our imaginary network, so the default domainname is <EMCLASS="emphasis">nuts.com</EM>. The configuration is for <EMCLASS="emphasis">peanut</EM> andit specifies itself as the first nameserver. The backup servers are<EMCLASS="emphasis">almond</EM> and <EMCLASS="emphasis">filbert</EM>. The configuration does not contain asort list or any options, as these are infrequently used. This is anexample of an average resolver configuration.<ACLASS="indexterm"NAME="AUTOID-9441"></A></P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="TCP2-CH-8-SECT-2.1.1">8.2.1.1 A resolver-only configuration </A></H4><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-9445"></A>The resolver-only configuration is very simple. It is identical tothe average configuration shown above except that it does not contain a<BCLASS="emphasis.bold">nameserver</B> entry for the local system. A sample<EMCLASS="emphasis">resolv.conf</EM> file for a resolver-only system is shown below:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># Domain name resolver configuration file#domain nuts.com# try almondnameserver 172.16.12.1# next try filbertnameserver 172.16.1.2</PRE></BLOCKQUOTE></P><PCLASS="para">The configuration tells the resolver to pass all queries to <EMCLASS="emphasis">almond</EM>;if that fails, try <EMCLASS="emphasis">filbert</EM>. Queries are never resolved locally. Thissimple <EMCLASS="emphasis">resolv.conf</EM> file is all that is required for a resolver-onlyconfiguration.<ACLASS="indexterm"NAME="AUTOID-9455"></A></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_01.htm"TITLE="8.1 BIND: UNIX Name Service "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.1 BIND: UNIX Name Service "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_03.htm"TITLE="8.3 Configuring named "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.3 Configuring named "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.1 BIND: UNIX Name Service </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.3 Configuring named </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>