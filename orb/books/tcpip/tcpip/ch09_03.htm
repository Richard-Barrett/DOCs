<HTML><HEAD><TITLE>[Chapter 9] 9.3 Network Information Service </TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:37:29Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch09_01.htm"TITLE="9. Configuring Network Servers "><LINKREL="prev"HREF="ch09_02.htm"TITLE="9.2 Line Printer Daemon "><LINKREL="next"HREF="ch09_04.htm"TITLE="9.4 A BOOTP Server "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_02.htm"TITLE="9.2 Line Printer Daemon "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.2 Line Printer Daemon "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 9<BR>Configuring Network Servers </FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_04.htm"TITLE="9.4 A BOOTP Server "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.4 A BOOTP Server "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-9-SECT-3">9.3 Network Information Service </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-9-IX-NETWORK-INFORMATION-SERVICE-NIS"></A>The <EMCLASS="emphasis">Network Information Service</EM> (NIS)[9]is an administrative database that provides central control andautomatic dissemination of important administrative files. NIS convertsseveral standard UNIX files into databases that can be queried over thenetwork. The databases are called <EMCLASS="emphasis">NIS maps</EM>. Some maps are createdfrom files that you're familiar with from system administration, suchas the password file (<EMCLASS="emphasis">/etc/passwd</EM>) and the groups file<ACLASS="indexterm"NAME="AUTOID-11509"></A><ACLASS="indexterm"NAME="AUTOID-11512"></A><ACLASS="indexterm"NAME="AUTOID-11514"></A><ACLASS="indexterm"NAME="AUTOID-11517"></A>(<EMCLASS="emphasis">/etc/group</EM>).  Others are derived from files related tonetwork administration:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[9] NIS was formerly called the &quot;Yellow Pages,&quot; or <EMCLASS="emphasis">yp</EM>. Although the namehas changed, the abbreviation <EMCLASS="emphasis">yp</EM> is still used.</P></BLOCKQUOTE><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">/etc/ethers</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-11526"></A><ACLASS="indexterm"NAME="AUTOID-11529"></A>Creates the NIS maps <EMCLASS="emphasis">ethers.byaddr</EM> and <EMCLASS="emphasis">ethers.byname</EM>. The<EMCLASS="emphasis">/etc/ethers</EM> file is used by RARP (see <ACLASS="xref"HREF="ch02_01.htm"TITLE="Delivering the Data">Chapter 2, <CITECLASS="chapter">Delivering the Data</CITE></A>).<ACLASS="indexterm"NAME="AUTOID-11535"></A></P></DD><DTCLASS="term"><EMCLASS="emphasis">/etc/hosts</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-11543"></A><ACLASS="indexterm"NAME="AUTOID-11546"></A>Produces the maps <EMCLASS="emphasis">hosts.byname</EM> and <EMCLASS="emphasis">hosts.byaddr</EM>(see <ACLASS="xref"HREF="ch03_01.htm"TITLE="Network Services">Chapter 3, <CITECLASS="chapter">Network Services</CITE></A>).</P></DD><DTCLASS="term"><EMCLASS="emphasis">/etc/networks</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-11556"></A><ACLASS="indexterm"NAME="AUTOID-11559"></A>Produces the maps <EMCLASS="emphasis">networks.byname</EM> and <EMCLASS="emphasis">networks.byaddr</EM>(see <ACLASS="xref"HREF="ch03_01.htm"TITLE="Network Services">Chapter 3</A>).</P></DD><DTCLASS="term"><EMCLASS="emphasis">/etc/protocols</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-11569"></A><ACLASS="indexterm"NAME="AUTOID-11572"></A>Creates the two maps <EMCLASS="emphasis">protocols.byname</EM> and <EMCLASS="emphasis">protocols.byaddr</EM>(see <ACLASS="xref"HREF="ch02_01.htm"TITLE="Delivering the Data">Chapter 2</A>).</P></DD><DTCLASS="term"><EMCLASS="emphasis">/etc/services</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-11582"></A><ACLASS="indexterm"NAME="AUTOID-11585"></A>Produces a single map called <EMCLASS="emphasis">services.byname</EM> (see <ACLASS="xref"HREF="ch02_01.htm"TITLE="Delivering the Data">Chapter 2</A>).</P></DD><DTCLASS="term"><EMCLASS="emphasis">/etc/aliases</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-11594"></A><ACLASS="indexterm"NAME="AUTOID-11597"></A>Defines electronic mail aliases and produces the maps<EMCLASS="emphasis">mail.aliases</EM> and <EMCLASS="emphasis">mail.byaddr</EM> (see <ACLASS="xref"HREF="ch10_01.htm"TITLE="sendmail ">Chapter 10</A>).</P></DD></DL><PCLASS="para">Check the maps available on your server with the <BCLASS="emphasis.bold">ypcat -x</B><ACLASS="indexterm"NAME="AUTOID-11604"></A>command. This command produced the same map list on both our Solaris andLinux sample systems. Your server may display a longer list. Here isthe list from my Solaris system:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>ypcat -x</B></CODE>Use &quot;passwd&quot;    for map &quot;passwd.byname&quot;Use &quot;group&quot;     for map &quot;group.byname&quot;Use &quot;networks&quot;  for map &quot;networks.byaddr&quot;Use &quot;hosts&quot;     for map &quot;hosts.byname&quot;Use &quot;protocols&quot; for map &quot;protocols.bynumber&quot;Use &quot;services&quot;  for map &quot;services.byname&quot;Use &quot;aliases&quot;   for map &quot;mail.aliases&quot;Use &quot;ethers&quot;    for map &quot;ethers.byname&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">The advantage of using NIS is that these important administrative filescan be maintained on a central server, and yet completely accessibleto every workstation on the network. All of the maps are stored on amaster server that runs the NIS server process <BCLASS="emphasis.bold">ypserv</B>. The maps<ACLASS="indexterm"NAME="AUTOID-11612"></A>are queried remotely by client systems. Clients run <BCLASS="emphasis.bold">ypbind</B> to<ACLASS="indexterm"NAME="AUTOID-11615"></A>locate the server.</P><PCLASS="para">The NIS server and its clients are a <EMCLASS="emphasis">NIS domain</EM>&nbsp;- a term NISshares with DNS. The NIS domain is identified by a NIS domain name.<ACLASS="indexterm"NAME="AUTOID-11619"></A>The only requirement for the name is that different NIS domains accessiblethrough the same local network must have different names. Although NISdomains and DNS domains are distinct entities, Sun recommends using theDNS domain name as the NIS domain name to simplify administration andreduce confusion.</P><PCLASS="para">NIS uses its domain name to create a directory within <EMCLASS="emphasis">/var/yp</EM> wherethe NIS maps are stored. For example, the DNS domain of our imaginarynetwork is <EMCLASS="emphasis">nuts.com</EM>, so we also use this as our NIS domain name.NIS creates a directory named <EMCLASS="emphasis">/var/yp/nuts.com</EM> and stores theNIS maps in it.</P><PCLASS="para">While the NIS protocols and commands were originally defined by Sun<ACLASS="indexterm"NAME="AUTOID-11628"></A>Microsystems, the service is now widely implemented. To illustratethis, the majority of examples in this section come from Linux&nbsp;- notfrom Solaris. The syntax of the commands is very similar from systemto system.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-11631"></A>The command <BCLASS="emphasis.bold">domainname</B> checks or sets the NIS domain name. The<ACLASS="indexterm"NAME="AUTOID-11634"></A>superuser can make <EMCLASS="emphasis">nuts.com</EM> the NIS domain name by entering:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>domainname nuts.com</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The NIS domain name is normally configured at startup by placingthe <BCLASS="emphasis.bold">domainname</B> command in one of the startup files. On Linuxand Solaris systems, the value for the NIS domain name is taken from<ACLASS="indexterm"NAME="AUTOID-11642"></A><ACLASS="indexterm"NAME="AUTOID-11645"></A>the <EMCLASS="emphasis">/etc/defaultdomain</EM> file. This file is used as input to a<BCLASS="emphasis.bold">domainname</B> command in one of the startup files. As shown below,<EMCLASS="emphasis">defaultdomain</EM> contains only the name of the NIS domain.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cat /etc/defaultdomain</B></CODE>nuts.com</PRE></BLOCKQUOTE></P><PCLASS="para">Initialize the NIS server and build the initial maps with <BCLASS="emphasis.bold">make</B>.The <EMCLASS="emphasis">/var/yp/Makefile</EM> contains the instructions needed to build<ACLASS="indexterm"NAME="AUTOID-11656"></A>the maps. As noted above, it creates a directory using the NIS domainname. The Makefile reads the files in the <EMCLASS="emphasis">/etc</EM> directory and placesmaps created from them in the new directory. To initialize a Linux systemas a NIS server:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>domainname nuts.com</B></CODE># <CODECLASS="userinput"><B>cd /var/yp</B></CODE> # <CODECLASS="userinput"><B>make</B></CODE>make[1]: Entering directory '/var/yp/nuts.com'Updating hosts.byname...Updating hosts.byaddr...Updating networks.byaddr...Updating networks.byname...Updating protocols.bynumber...Updating protocols.byname...Updating rpc.byname...Updating rpc.bynumber...Updating services.byname...Updating passwd.byname...Updating passwd.byuid...Updating group.byname...Updating group.bygid...Updating netid.byname...make[1]: Leaving directory '/var/yp/nuts.com'</PRE></BLOCKQUOTE></P><PCLASS="para">After initializing the maps, start the NIS server process<BCLASS="emphasis.bold">ypserv</B> and the NIS binder process <BCLASS="emphasis.bold">ypbind</B>.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>ypserv</B></CODE># <CODECLASS="userinput"><B>ypbind</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Our system is now running as both a NIS server and a NIS client. A quick<ACLASS="indexterm"NAME="AUTOID-11673"></A>test with <BCLASS="emphasis.bold">ypwhich</B> shows that we are bound to the correct server.<ACLASS="indexterm"NAME="AUTOID-11676"></A><ACLASS="indexterm"NAME="AUTOID-11678"></A><BCLASS="emphasis.bold">ypcat</B> or <BCLASS="emphasis.bold">ypmatch</B> test that we can retrieve data from theserver.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>ypwhich</B></CODE>localhost# <CODECLASS="userinput"><B>ypcat hosts</B></CODE>172.16.55.105            cow cow.nuts.com172.16.55.106            pig pig.nuts.com172.16.26.36             island.nuts.com island127.0.0.1                localhost</PRE></BLOCKQUOTE></P><PCLASS="para">The clients need only to define the correct domain name and to run thebinder software <BCLASS="emphasis.bold">ypbind</B>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>domainname nuts.com</B></CODE> # <CODECLASS="userinput"><B>ypbind</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Most NIS clients use <BCLASS="emphasis.bold">ypbind</B> to locate the server. Using theNIS domain name, <BCLASS="emphasis.bold">ypbind</B> broadcasts a request for a server forthat domain. The first  server that responds is the server to which theclient &quot;binds.&quot;  The theory is that the server that responds quickest isthe server with the least workload. Generally this works well. However,it is possible for the client to bind to an inappropriate system, e.g., asystem that was accidentally configured to run <BCLASS="emphasis.bold">ypserv</B> or one thatwas maliciously configured to be a false server. Because of thispossibility, some systems allow you to explicitly configure the serverto which the client will bind. Linux provides the<ACLASS="indexterm"NAME="AUTOID-11696"></A><ACLASS="indexterm"NAME="AUTOID-11699"></A><EMCLASS="emphasis">/etc/yp.conf</EM> file for this purpose. The syntax of the entries indifferent versions of this file varies, so see your system documentationbefore attempting to use it.</P><PCLASS="para">Place the NIS domain name in the <EMCLASS="emphasis">/etc/defaultdomain</EM> file and the<ACLASS="indexterm"NAME="AUTOID-11704"></A><ACLASS="indexterm"NAME="AUTOID-11707"></A><BCLASS="emphasis.bold">ypserv</B> and <BCLASS="emphasis.bold">ypbind</B> commands in a startup file so that theNIS setup will survive the boot. These commands may already be in yourstartup file. On our Linux client all we needed to do was uncomment theappropriate lines in <EMCLASS="emphasis">/etc/rc.d/rc.inet2</EM>. On the Linux NIS serverit was a little more complicated. In addition to uncommenting the linesfor <BCLASS="emphasis.bold">domainname</B> and <BCLASS="emphasis.bold">ypbind</B> we added lines to start <BCLASS="emphasis.bold">ypserv</B>.</P><PCLASS="para">NIS is a possible alternative to DNS but most systems use both NIS andDNS. Hostnames can be converted to IP addresses by DNS, NIS, and the hostfile. The order in which the various sources are queried is defined inthe <EMCLASS="emphasis">nsswitch.conf</EM> file.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-9-SECT-3.0.1">9.3.1 The nsswitch.conf file </A></H3><PCLASS="para">The Name Service Switch file (<EMCLASS="emphasis">nsswitch.conf</EM>) defines the order in<ACLASS="indexterm"NAME="AUTOID-11721"></A><ACLASS="indexterm"NAME="AUTOID-11723"></A>which the sources of information are searched. Despite its name, itapplies to more than just name service. All of the databases handled byNIS are covered by the <EMCLASS="emphasis">nsswitch.conf</EM> file, as shown in this example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">hosts:      dns  nis  filesnetworks:   nis  [NOTFOUND=return]  filesservices:   nis  filesprotocols:  nis  files</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;The first entry in the file says that a hostname lookup is firstpassed to DNS for resolution; if DNS fails to find a match, the lookupis then passed to NIS and finally looked up in the <EMCLASS="emphasis">hosts</EM> file.The second entry says that network names are looked up through NIS.The <CODECLASS="literal">[NOTFOUND=return]</CODE> string says to use the <EMCLASS="emphasis">networks</EM> file only ifNIS fails to respond, that is, if NIS is down. In this case, if NIS answersthat it cannot find the requested network name, terminate the search.The last two entries search for services port and protocol numbersthrough NIS and then in the files in the <EMCLASS="emphasis">/etc</EM> directory.<ACLASS="indexterm"NAME="AUTOID-11733"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-9-SECT-3.0.2">9.3.2 NIS+ </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-9-IX-NIS"></A>Before leaving the topic of NIS, we should say a word about NIS+.  Itis just a short discussion, because I do not use NIS+ and I do notknow much about it.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-11740"></A>NIS+ replaces NIS on Sun systems. It is not a new version of NIS, buta completely new software product that provides all of the functionalityof NIS and some new features. The new features are:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Improved security. NIS does not authenticate servers, as we noted in the<BCLASS="emphasis.bold">ypbind</B> discussion above, or clients. NIS+ provides authentication<ACLASS="indexterm"NAME="AUTOID-11747"></A><ACLASS="indexterm"NAME="AUTOID-11749"></A>of users with a secure DES-encrypted authentication scheme. NIS+<ACLASS="indexterm"NAME="AUTOID-11751"></A>also provides various levels of access so that different users haveauthority to look at different levels of data. NIS can only providethe same access to everyone in the NIS domain.</P></LI><LICLASS="listitem"><PCLASS="para">A hierarchical, decentralized architecture. NIS+, like DNS, is adistributed, hierarchical database system.<ACLASS="indexterm"NAME="AUTOID-11756"></A>This allows for a very largenamespace. It also allows distributed management of the informationstructure while maintaining consistent access to the data. NIS is aflat structure. All information about a NIS domain comes from a singlemaster server and NIS domains are not interrelated.</P></LI><LICLASS="listitem"><PCLASS="para">Enhanced data structures. NIS converts ASCII files into simple keyedfiles that the NIS+ documentation calls &quot;two-column maps.&quot;  NIS+ buildsmulticolumn database <EMCLASS="emphasis">tables</EM>. Tables can be searched in avariety of ways to retrieve information about an entry. Inaddition, NIS+ tables can be linked together to provide relatedinformation about an entry.</P></LI></UL><PCLASS="para">Clearly NIS+ has some excellent new features and advantages over NIS.So why don't I use it? Good question! The hierarchical architectureand enhanced data structures are important if you have a very largenetwork and lots of data in your namespace. However, many sitesevolved using NIS on local subnets and do not see the need to move theentire enterprise under NIS+.  Improved security seems like a realwinner, but sites with low security requirements don't see the need foradditional security and sites with high security requirements mayalready be behind a firewall<ACLASS="indexterm"NAME="AUTOID-11763"></A>that blocks external NIS queries.  Additionally, NIS+ is not availablefor as many operating systems as NIS.Taken together, these reasons have slowed the move to NIS+.</P><PCLASS="para">To learn more about NIS+ and how to install it on your system, read the<EMCLASS="emphasis">NIS+ Transition Guide</EM>, the <EMCLASS="emphasis">Name Service Configuration Guide</EM>,and the <EMCLASS="emphasis">Name Service Administration Guide</EM>. All of these areavailable from Sun as part of the Solaris System and NetworkAdministration manual set.<ACLASS="indexterm"NAME="AUTOID-11769"></A></P><PCLASS="para">NIS and NIS+ provide a wide range of system configuration informationto their clients. However, they cannot provide all of the informationneeded to configure a TCP/IP system. In the next two sections, we lookat configuration servers that can do the entire job.&#13;</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_02.htm"TITLE="9.2 Line Printer Daemon "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.2 Line Printer Daemon "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_04.htm"TITLE="9.4 A BOOTP Server "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.4 A BOOTP Server "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">9.2 Line Printer Daemon </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">9.4 A BOOTP Server </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>