<HTML><HEAD><TITLE>[Chapter 9] 9.5 DHCP </TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:38:00Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch09_01.htm"TITLE="9. Configuring Network Servers "><LINKREL="prev"HREF="ch09_04.htm"TITLE="9.4 A BOOTP Server "><LINKREL="next"HREF="ch09_06.htm"TITLE="9.6 Managing Distributed Servers "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_04.htm"TITLE="9.4 A BOOTP Server "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.4 A BOOTP Server "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 9<BR>Configuring Network Servers </FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_06.htm"TITLE="9.6 Managing Distributed Servers "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.6 Managing Distributed Servers "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-9-SECT-5">9.5 DHCP </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-9-IX-DYNAMIC-HOST-CONFIGURATION-PROTOCOL-DHCP-BENEFITS-OF"></A>Dynamic Host Configuration Protocol provides three important features:</P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">Backward compatibility with Bootstrap Protocol (BOOTP)</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-12323"></A>A DHCP server can support BOOTP clients. Properly configured, a DHCPserver can support all of your clients.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Full configurations</EM></DT><DDCLASS="listitem"><PCLASS="para">A DHCP server provides a complete set ofTCP/IP configuration parameters. (See <ACLASS="xref"HREF="appd_01.htm"TITLE="A dhcpd Reference">Appendix D, <CITECLASS="appendix">A dhcpd Reference</CITE></A>, for a full list.)The network administrator can handle the entire configuration for herusers.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Dynamic address assignments</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-12337"></A>A DHCP server can provide permanent addresses manually, permanentaddresses automatically, and temporary addresses dynamically. Thenetwork administrator can tailor the type of address to the needs ofthe network and the client system.</P></DD></DL><PCLASS="para">In this section we configure a DHCP server that supports BOOTP clients,performs dynamic address allocation, and provides a wide range ofconfiguration parameters for its clients.</P><PCLASS="para">Several implementations of DHCP are available for UNIX systems.Some are commercial packages and some run on a specific version ofUNIX. We use the Internet Software Consortium (ISC) Dynamic Host<ACLASS="indexterm"NAME="AUTOID-12343"></A><ACLASS="indexterm"NAME="AUTOID-12345"></A>Configuration Protocol Daemon (<BCLASS="emphasis.bold">dhcpd</B>). It is freely availableover the Internet and runs on a wide variety of UNIX systems, includingboth our Linux and Solaris sample systems. (See <ACLASS="xref"HREF="appd_01.htm"TITLE="A dhcpd Reference">Appendix D</A> forinformation on downloading and compiling <BCLASS="emphasis.bold">dhcpd</B>.) If you usedifferent DHCP server software, it will have different configurationcommands, but it probably performs the same basic functions.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-9-SECT-5.1">9.5.1 dhcpd.conf </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-9-IX-DYNAMIC-HOST-CONFIGURATION-PROTOCOL-DHCP-DAEMON-DHCPD"></A><ACLASS="indexterm"NAME="TCP2-CH-9-IX-ETC-DHCPD-CONF-FILE"></A><ACLASS="indexterm"NAME="AUTOID-12359"></A><ACLASS="indexterm"NAME="TCP2-CH-9-IX-DHCPD-CONF-FILE"></A><BCLASS="emphasis.bold">dhcpd</B> reads its configuration from the <EMCLASS="emphasis">/etc/dhcpd.conf</EM>file. The configuration file contains the instructions that tell theserver what subnets and hosts it services, and what configurationinformation it should provide them. <EMCLASS="emphasis">dhcpd.conf</EM> is an ASCII textfile that I find more readable than the <EMCLASS="emphasis">bootptab</EM> file. Theeasiest way to learn about the <EMCLASS="emphasis">dhcpd.conf</EM> file is to look at asample.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># Define global values that apply to all systems.default-lease-time 86400;max-lease-time 604800;get-lease-hostnames true;option subnet-mask 255.255.255.0;option domain &quot;nuts.com&quot;;option domain-name-servers 172.16.12.1, 172.16.3.5;option lpr-servers 172.16.12.1;option interface-mtu 1500;# Identify the subnet served, the options related# to the subnet, and the range of addresses that# are available for dynamic allocation.subnet 172.16.3.0 netmask 255.255.255.0 {    option routers 172.16.3.25;    option broadcast-address 172.16.3.255;    range 172.16.3.50 172.16.3.250;}subnet 172.16.12.0 netmask 255.255.255.0 {    option routers 172.16.12.1;    option broadcast-address 172.16.12.255;    range 172.16.12.64 172.16.12.192;    range 172.16.12.200 172.16.12.250;}# Identify each BOOTP client with a host statementgroup {    use-host-decl-names true;    host acorn {        hardware ethernet 00:80:c7:aa:a8:04;        fixed-address 172.16.3.4;    }    host peanut {        hardware ethernet 08:80:20:01:59:c3;        fixed-address 172.16.12.2;    }    host hickory {        hardware ethernet 00:00:c0:a1:5e:10;        fixed-address 172.16.3.16;    }}</PRE></BLOCKQUOTE></P><PCLASS="para">This sample configuration file is similar to the example used abovefor <EMCLASS="emphasis">bootptab</EM>. It defines a server that is connecting to, andserving, two separate subnets. It assigns IP addresses dynamically tothe DHCP clients on each subnet and supports a few BOOTP clients. Allof the lines that begin with a sharp sign (#) are comments. The firstreal configuration line defines a parameter for the server.</P><PCLASS="para">We begin the <EMCLASS="emphasis">dhcpd.conf</EM> file with a set of parameters and optionsthat apply to all of the subnets and clients served. The first threelines are parameters, which provide direction to the server. All threeof the sample parameters define some aspect of how <BCLASS="emphasis.bold">dhcpd</B> shouldhandle dynamic address assignments.</P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">default-lease-time</EM></DT><DDCLASS="listitem"><PCLASS="para">Tells the server how many seconds long a default address lease shouldbe. The client can request that the address be leased for a specificperiod of time. If it does, it is assigned the address for that periodof time, given some restrictions.  Frequently, clients do not request aspecific lifetime for an address lease.<ACLASS="indexterm"NAME="AUTOID-12381"></A>When that happens, thedefault-lease-time is used. In the example, the default lease is setto one day (86400 seconds).</P></DD><DTCLASS="term"><EMCLASS="emphasis">max-lease-time</EM></DT><DDCLASS="listitem"><PCLASS="para">Sets the upper limit for how long an address can be leased. Regardlessof the length of time requested by the client, this is the longestaddress lease that <BCLASS="emphasis.bold">dhcpd</B> will grant.  The life of the lease isspecified in seconds. In the example, it is one week.</P></DD><DTCLASS="term"><EMCLASS="emphasis">get-lease-hostname</EM></DT><DDCLASS="listitem"><PCLASS="para">Directs <BCLASS="emphasis.bold">dhcpd</B> to provide a hostname to each client that isassigned a dynamic address. Further, the hostname is to be obtainedfrom DNS. This parameter is a Boolean.<ACLASS="indexterm"NAME="AUTOID-12396"></A>If it is set to false, which isthe default, the client receives an address but no hostname. Lookingup the hostname for every possible dynamic address adds substantialtime to the startup.  Set this to &quot;false&quot;. Only set this to true ifthe server handles a very small number of dynamic addresses.</P></DD></DL><PCLASS="para">We will use a few more parameters in this configuration. All of theparameters are documented in <ACLASS="xref"HREF="appd_01.htm"TITLE="A dhcpd Reference">Appendix D</A>.</P><PCLASS="para">The next four lines are options. The options all start with thekeyword <CODECLASS="literal">option</CODE>. The keyword is followed by the name of theoption and the value assigned to the option. Options defineconfiguration values that are used by the client.</P><PCLASS="para">The meaning of the sample options is easy to deduce. The option namesare very descriptive. We are providing the clients with the subnetmask, domain name, domain server addresses, and print server address.These values parallel those in the <EMCLASS="emphasis">bootptab</EM> example shown earlierin this chapter.</P><PCLASS="para">DHCP, however, can do more than BOOTP. For sake of illustration we alsodefine the maximum transmission unit (MTU). The sample <CODECLASS="literal">interface-mtu</CODE>option tells the client that the MTU is 1500 bytes. In this case theoption is not needed because 1500 bytes is the default for Ethernet.However, it illustrates the point that DHCP can provide a very completeset of configuration information.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-12408"></A>The subnet statements define the networks that <BCLASS="emphasis.bold">dhcpd</B> will serve.The identity of each network is determined from the address and theaddress mask, both of which are required by the subnet statement.<BCLASS="emphasis.bold">dhcpd</B> provides configuration services only to clients that areattached to one of these networks. There must be a subnet statementfor every subnet to which the server physically connects&nbsp;- even if somesubnets do not contain any clients. <BCLASS="emphasis.bold">dhcpd</B> requires the subnetinformation to complete its startup.</P><PCLASS="para">The options and parameters defined in a subnet statement apply only tothe subnet and its clients. The meaning of the sample options isclear. They tell the clients what router to use and what broadcastaddress to use. The <BCLASS="emphasis.bold">range</B> parameter is more interesting, as it goes tothe heart of one of DHCP's key features.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-12417"></A>The <BCLASS="emphasis.bold">range</B> parameter defines the scope of addresses that are availablefor dynamic address allocation. It always occurs in association with asubnet statement, and the range of addresses must fall within theaddress space of the subnet. The scope of the <BCLASS="emphasis.bold">range</B> parameter isdefined by the two addresses it contains. The first address is thelowest address that can be automatically assigned and the secondaddress is the highest address that can be assigned. The first <BCLASS="emphasis.bold">range</B>parameter in the example identifies a contiguous group of addressesfrom 172.16.12.50 to 172.16.12.250 that are available for dynamicassignment. Notice that the second subnet statement has two <BCLASS="emphasis.bold">range</B>parameters. This creates two separate groups of dynamic addresses.The reason for this might be that some addresses were already manuallyassigned before the DHCP server was installed. Regardless of thereason, the point is that we define a noncontiguous dynamic addressspace with multiple <CODECLASS="literal">range</CODE> statements.</P><PCLASS="para">If a <BCLASS="emphasis.bold">range</B> parameter is defined in a subnet statement, any DHCP clienton the subnet that requests an address is granted one as long asaddresses are available. If a <BCLASS="emphasis.bold">range</B> parameter is not defined, dynamicaddressing is not enabled.</P><PCLASS="para">To provide automatic address assignment for BOOTP clients, add thedynamic-bootp argument to the <BCLASS="emphasis.bold">range</B> parameter. For example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">range dynamic-bootp 172.16.8.10 172.16.8.50;</PRE></BLOCKQUOTE></P><PCLASS="para">By default, BOOTP clients are assigned permanent addresses.It is possible to override this default behavior with either<ACLASS="indexterm"NAME="AUTOID-12432"></A>the <BCLASS="emphasis.bold">dynamic-bootp-lease-cutoff</B> or the <BCLASS="emphasis.bold">dynamic-bootp-lease-length</B><ACLASS="indexterm"NAME="AUTOID-12436"></A>parameter. However, BOOTP clients do not understand address leasesand they do not know that they should renew an address. Therefore the<BCLASS="emphasis.bold">dynamic-bootp-lease-cutoff</B> and the <BCLASS="emphasis.bold">dynamic-bootp-lease-length</B> parameters are only used in special circumstances. If you're interested in these parameters, see <ACLASS="xref"HREF="appd_01.htm"TITLE="A dhcpd Reference">Appendix D</A>.</P><PCLASS="para">Each BOOTP client should have an associated host statement that is usedto assign the client configuration parameters and options. It can beused to manually assign the client a permanent, fixed address. Thesample configuration file ends with three host statements: one for<EMCLASS="emphasis">acorn</EM>, one for <EMCLASS="emphasis">peanut</EM>, and one for <EMCLASS="emphasis">hickory</EM>. Each hoststatement contains a hardware parameter that defines the type ofnetwork hardware (<CODECLASS="literal">ethernet</CODE>) and the physical network address(e.g., <CODECLASS="literal">08:80:20:01:59:c3</CODE>) used by the client. The hardwareparameter is required in host statements for BOOTP clients. TheEthernet address is used by <BCLASS="emphasis.bold">dhcpd</B> to identify the BOOTP client.DHCP clients can also have associated host statements. For DHCPclients, the hardware parameter is optional because a DHCP client can beidentified by the <BCLASS="emphasis.bold">dhcp-client-identifier</B> option. However, it issimpler for a DHCP client connected via Ethernet to be identified byits Ethernet address.<ACLASS="indexterm"NAME="AUTOID-12449"></A></P><PCLASS="para">A wide variety of parameters and options can be defined in the hoststatement. For example, adding to each host statement an optionsimilar to the following one assigns each client a hostname:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">option host-name acorn;</PRE></BLOCKQUOTE></P><PCLASS="para">It is often easier, however, to define options and parameters at ahigher level. Global options<ACLASS="indexterm"NAME="AUTOID-12457"></A>apply to all systems. Subnet options apply to every client on thesubnet, but the options defined inside of a <BCLASS="emphasis.bold">host</B> statement onlyapply to a single host. The <BCLASS="emphasis.bold">host-name</B> option shown above wouldneed to be repeated with a different hostname in every hoststatement. An easier way to define a parameter or option for a groupof hosts is to use a <BCLASS="emphasis.bold">group</B> statement.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-12464"></A>A <BCLASS="emphasis.bold">group</B> statement groups together any other statements. The solepurpose of the <BCLASS="emphasis.bold">group</B> statement is to apply parameters and options toall members of the group. That is exactly what we do in the example.The <BCLASS="emphasis.bold">group</B> statement in the sample configuration groups all of the hoststatements together. The <BCLASS="emphasis.bold">use-host-decl-names</B> parameter in the <BCLASS="emphasis.bold">group</B>statement applies to every host in the group. This particularparameter tells <BCLASS="emphasis.bold">dhcpd</B> to assign each client the hostname that isdeclared on the host statement associated with that client, which makesthe hostname option unnecessary for this configuration.</P><PCLASS="para">Given the sample <EMCLASS="emphasis">dhcpd.conf</EM> file shown earlier, when <BCLASS="emphasis.bold">dhcpd</B><ACLASS="indexterm"NAME="AUTOID-12475"></A>receives a BOOTREQUEST packet from a client with the Ethernet address08:80:20:01:59:c3, it sends that client:&#13;</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">The address 172.16.12.2</P></LI><LICLASS="listitem"><PCLASS="para">The hostname <EMCLASS="emphasis">peanut</EM></P></LI><LICLASS="listitem"><PCLASS="para">The default router address 172.16.12.1</P></LI><LICLASS="listitem"><PCLASS="para">The broadcast address 172.16.12.255</P></LI><LICLASS="listitem"><PCLASS="para">The subnet mask 255.255.255.0</P></LI><LICLASS="listitem"><PCLASS="para">The domain name <EMCLASS="emphasis">nuts.com</EM></P></LI><LICLASS="listitem"><PCLASS="para">The domain name server addresses 172.16.12.1 and 172.16.3.5</P></LI><LICLASS="listitem"><PCLASS="para">The print server address 172.16.12.1</P></LI><LICLASS="listitem"><PCLASS="para">The MTU for an Ethernet interface</P></LI></UL><PCLASS="para">The client receives all global values, all subnet values and all hostvalues that are appropriate. Clearly DHCP can provide a completeconfiguration.</P><PCLASS="para">Your DHCP configuration, though larger in the number of systemssupported, probably is simpler than the example. Some commands appearin the sample primarily for the purpose of illustration. The biggestdifference is that most sites do not serve more than one subnet with asingle configuration server. Servers are normally placed on eachsubnet. This reduces the burden on the server, particularly the burdenthat can be caused by a network-wide power outage.<ACLASS="indexterm"NAME="AUTOID-12500"></A>It eliminates the need to move boot packets through routers. Also, thefact that addresses are assigned at the subnet level makes placing thesystem that does that assignment at the subnet level seem somehow morelogical. In the next section we look at how to keep distributedservers updated.<ACLASS="indexterm"NAME="AUTOID-12502"></A><ACLASS="indexterm"NAME="AUTOID-12503"></A><ACLASS="indexterm"NAME="AUTOID-12504"></A><ACLASS="indexterm"NAME="AUTOID-12505"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_04.htm"TITLE="9.4 A BOOTP Server "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.4 A BOOTP Server "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_06.htm"TITLE="9.6 Managing Distributed Servers "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.6 Managing Distributed Servers "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">9.4 A BOOTP Server </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">9.6 Managing Distributed Servers </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>