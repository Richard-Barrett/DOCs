<HTML><HEAD><TITLE>[Chapter 9] 9.6 Managing Distributed Servers </TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:38:17Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch09_01.htm"TITLE="9. Configuring Network Servers "><LINKREL="prev"HREF="ch09_05.htm"TITLE="9.5 DHCP "><LINKREL="next"HREF="ch09_07.htm"TITLE="9.7 Mail Servers "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_05.htm"TITLE="9.5 DHCP "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.5 DHCP "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 9<BR>Configuring Network Servers </FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_07.htm"TITLE="9.7 Mail Servers "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.7 Mail Servers "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-9-SECT-6">9.6 Managing Distributed Servers </A></H2><PCLASS="para">Large networks have multiple servers. As noted earlier,<ACLASS="indexterm"NAME="TCP2-CH-9-IX-DISTRIBUTED-SERVERS-MANAGING"></A>the serversare often distributed around the network with a server on everysubnet. This improves booting efficiency, but it conflicts with thegoal of central configuration control. The more servers, the moredispersed the control, and the more likely that a configuration errorwill occur. Implementing distributed servers requires a technique formaintaining central control and coordinating configuration informationamong the servers. TCP/IP offers several techniques for doing this.</P><PCLASS="para">Any file transfer protocol can be used to move configuration data, orany other kind of data, from a central system to a group of distributedsystems. Either FTP<ACLASS="indexterm"NAME="AUTOID-12513"></A><ACLASS="indexterm"NAME="AUTOID-12515"></A>or TFTP will work, but both of these protocols present difficultieswhen used in this way. FTP and TFTP are <EMCLASS="emphasis">interactive</EM> protocols;<ACLASS="indexterm"NAME="AUTOID-12518"></A>both require multiple commands to retrieve a file, making themdifficult to script. Additionally, FTP requires passwordauthentication before it grants access to a file and most securityexperts frown on storing passwords inside of scripts. For thesereasons we don't concentrate on using these protocols to distributethe configuration file. Besides, if you know how to use FTP (and youshould!), you know how to use it to send a configuration file.</P><PCLASS="para">Another possibility is to use <EMCLASS="emphasis">Network File System</EM> (NFS) to<ACLASS="indexterm"NAME="AUTOID-12523"></A>distribute the information. NFS allows files on the server to be usedby clients as if they are local files. It is a powerful tool, but itdoes have limitations when used to distribute configuration informationto boot servers. The same power outage that affects the distributedservers can cause the central server to crash. The distributed serversand their clients can be delayed in booting waiting for the central serverto come back online. Sharing a single copy of the configuration fileconflicts with the effort to distribute boot services because it puts toomuch reliance on the central server.</P><PCLASS="para">One way to avoid this problem is for the distributed servers toperiodically copy the configuration file from the mounted filesystemto a local disk. This is very simple to script, but it creates thepossibility that the servers will be &quot;out of sync&quot; at certain times&nbsp;- thedistributed servers copy the configuration file on aperiodic schedule without knowing if, in the interim, the master file hasbeen updated. Of course, it is possible for all of the remote serversto export filesystems that the central server mounts. It is thenpossible for the central server to copy the configuration file directlyto the remote filesystems whenever the master file is updated.However, there are easier ways to do this.</P><PCLASS="para">The UNIX <BCLASS="emphasis.bold">r</B>-commands <BCLASS="emphasis.bold">rcp</B> and <BCLASS="emphasis.bold">rdist</B> provide the most <ACLASS="indexterm"NAME="AUTOID-12530"></A>popular methods for distributing the configuration file. </P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-12534"></A>Remote copy (<BCLASS="emphasis.bold">rcp</B>) is simply a file transfer protocol. It has twoadvantages over FTP for this particular application: it is easy toscript and it does not require a password. <BCLASS="emphasis.bold">rcp</B> is easy to scriptbecause only a single line is needed to complete a transfer. Anexample of transferring the file <EMCLASS="emphasis">bootptab</EM> from the master serverto a remote server named <EMCLASS="emphasis">pistachio.nuts.com</EM> is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># rcp /etc/bootptab pistachio.nuts.com:/etc/bootptab</PRE></BLOCKQUOTE></P><PCLASS="para">For every remote server that the file is sent to, add a line like theone shown above to the procedure that updates the master configurationfile.</P><PCLASS="para"><BCLASS="emphasis.bold">rcp</B> is only one choice for distributing thecentral configuration file. <BCLASS="emphasis.bold">rdist</B>, while a little harder to use,is often a better choice because it has several features that make itparticularly well suited for this application.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-9-SECT-6.1">9.6.1 rdist </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-9-IX-REMOTE-FILE-DISTRIBUTION-RDIST-COMMAND"></A>The <EMCLASS="emphasis">Remote File Distribution Program</EM> (<BCLASS="emphasis.bold">rdist</B>) is designed tomaintain identical copies of files on multiple hosts. A single<BCLASS="emphasis.bold">rdist</B> command can distribute several different files to manydifferent hosts. It does this by following the instructions stored inan <BCLASS="emphasis.bold">rdist</B> configuration files called a <EMCLASS="emphasis">Distfile</EM>.<ACLASS="indexterm"NAME="AUTOID-12556"></A></P><PCLASS="para">The function of a <EMCLASS="emphasis">Distfile</EM> is similar to that of the Makefileused by the <BCLASS="emphasis.bold">make</B> command, and it has a similar syntax andstructure. Now, don't panic! It's not that bad. The initialconfiguration of an <BCLASS="emphasis.bold">rdist</B> command is more difficult than thestraightforward syntax of an <BCLASS="emphasis.bold">rcp</B> command, but the <BCLASS="emphasis.bold">rdist</B>command provides much more control and is much easier to maintain inthe long run.</P><PCLASS="para">A <EMCLASS="emphasis">Distfile</EM> is composed of <EMCLASS="emphasis">macros</EM> and <EMCLASS="emphasis">primitives</EM>.Macros can be assigned a single value or a list of values. If a listof values is used, the list is enclosed in parentheses, e.g., <EMCLASS="emphasis">macro= ( value value )</EM>. Once assigned a value, the macro is referencedusing the syntax <BCLASS="emphasis.bold">${</B><EMCLASS="emphasis">macro</EM><BCLASS="emphasis.bold">}</B>, where <EMCLASS="emphasis">macro</EM> is the nameof the macro. The other components of a <EMCLASS="emphasis">Distfile</EM>, theprimitives, are explained in<ACLASS="xref"HREF="ch09_06.htm#TCP2-CH-9-TAB-3"TITLE="rdist Primitives">Table 9.4</A>[11]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[11] For more details, see the <BCLASS="emphasis.bold">rdist</B> manpage.</P></BLOCKQUOTE><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="TCP2-CH-9-TAB-3">Table 9.4: rdist Primitives</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Primitive</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Description</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">install</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Recursively updates files and directories.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">notify <EMCLASS="emphasis">address</EM></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Sends error/status mail messages to <EMCLASS="emphasis">address</EM>.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">except <EMCLASS="emphasis">file</EM></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Omits <EMCLASS="emphasis">file</EM> from the update.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">except_pat <EMCLASS="emphasis">pattern</EM></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Omits filenames that match the pattern.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">special &quot;<EMCLASS="emphasis">command</EM>&quot;</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Executes <EMCLASS="emphasis">command</EM> after each file update.</TD></TR></TBODY></TABLE><PCLASS="para">The simplest way to understand how the primitives and macros arecombined to make a functioning <EMCLASS="emphasis">Distfile</EM> is to look at a sample.The following configuration file distributes the current version of<BCLASS="emphasis.bold">bootpd</B> and the latest <EMCLASS="emphasis">bootptab</EM> configuration file to theremote boot servers <EMCLASS="emphasis">pecan</EM>, <EMCLASS="emphasis">pistachio</EM>, and <EMCLASS="emphasis">cashew</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">HOSTS = ( pecan root@cashew pistachio )FILES = ( /usr/etc/bootpd /etc/bootptab )${FILES} -&gt; ${HOSTS}       install ;       notify craig@almond.nuts.com</PRE></BLOCKQUOTE></P><PCLASS="para">Let's look at each line of the file:</P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">HOSTS = ( pecan root@cashew pistachio )</EM></DT><DDCLASS="listitem"><PCLASS="para">This line defines HOSTS, a macro that contains the hostnameof each of the remote servers. Notice the entry for <EMCLASS="emphasis">cashew</EM>. Ittells <BCLASS="emphasis.bold">rdist</B> to login as <EMCLASS="emphasis">root</EM> on <EMCLASS="emphasis">cashew</EM> to perform theupdate. On <EMCLASS="emphasis">pecan</EM> and <EMCLASS="emphasis">pistachio</EM>, <BCLASS="emphasis.bold">rdist</B> will run under thesame username it has on the local host.</P></DD><DTCLASS="term"><EMCLASS="emphasis">FILES = ( /usr/etc/bootpd /etc/bootptab )</EM></DT><DDCLASS="listitem"><PCLASS="para">This macro, FILES, defines the two files that will be sent.</P></DD><DTCLASS="term"><EMCLASS="emphasis">${FILES} -&gt; ${HOSTS}</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-12641"></A><ACLASS="indexterm"NAME="AUTOID-12643"></A>The <EMCLASS="emphasis">-&gt;</EM> symbol has a special meaning to <BCLASS="emphasis.bold">rdist</B>. It tells<BCLASS="emphasis.bold">rdist</B> to copy the files named at the left of the symbol to thehosts named at the right. In this case FILES is a macro that containsthe file names <EMCLASS="emphasis">/usr/etc/bootpd</EM> and <EMCLASS="emphasis">/etc/bootptab</EM>, and<ACLASS="indexterm"NAME="AUTOID-12650"></A><ACLASS="indexterm"NAME="AUTOID-12653"></A><ACLASS="indexterm"NAME="AUTOID-12655"></A><ACLASS="indexterm"NAME="AUTOID-12658"></A>HOSTS is a macro that contains the hostnames <EMCLASS="emphasis">pecan</EM>,<EMCLASS="emphasis">cashew</EM>, and <EMCLASS="emphasis">pistachio</EM>. Therefore this command tells<EMCLASS="emphasis">rdist</EM> to copy two files to three different hosts. Any primitivesthat follow apply to this file-to-host mapping.</P></DD><DTCLASS="term"><EMCLASS="emphasis">install ;</EM></DT><DDCLASS="listitem"><PCLASS="para">The <EMCLASS="emphasis">install</EM> primitive explicitly tells <BCLASS="emphasis.bold">rdist</B> to copy thespecified files to the specified hosts if the corresponding file is<ACLASS="indexterm"NAME="AUTOID-12671"></A>out-of-date on the remote host. A file is considered &quot;out-of-date&quot; ifthe creation date or the size is not the same as the master file. Thesemicolon at the end of this line indicates that another primitivefollows.</P></DD><DTCLASS="term"><EMCLASS="emphasis">notify craig@almond.nuts.com</EM></DT><DDCLASS="listitem"><PCLASS="para">Status and error messages are to be mailed to<EMCLASS="emphasis">craig@almond.nuts.com</EM>.</P></DD></DL><PCLASS="para">Additional files and hosts can be easily added to this file. In thelong run most people find <BCLASS="emphasis.bold">rdist</B> the simplest way to distributemultiple files to multiple hosts.<ACLASS="indexterm"NAME="AUTOID-12681"></A><ACLASS="indexterm"NAME="AUTOID-12682"></A><ACLASS="indexterm"NAME="AUTOID-12683"></A></P><PCLASS="para">One final note: the configuration file does not have to be called<EMCLASS="emphasis">Distfile</EM>. Any file name can be specified on the <BCLASS="emphasis.bold">rdist</B>command line using the <BCLASS="emphasis.bold">-f</B> option. For example, the<EMCLASS="emphasis">Distfile</EM> shown above could be saved under the name<EMCLASS="emphasis">bootp.dist</EM> and invoked with the following command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% rdist -f bootp.dist</PRE></BLOCKQUOTE></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_05.htm"TITLE="9.5 DHCP "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.5 DHCP "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_07.htm"TITLE="9.7 Mail Servers "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.7 Mail Servers "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">9.5 DHCP </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">9.7 Mail Servers </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>