<HTML><HEAD><TITLE>[Chapter 9] 9.7 Mail Servers </TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:38:19Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch09_01.htm"TITLE="9. Configuring Network Servers "><LINKREL="prev"HREF="ch09_06.htm"TITLE="9.6 Managing Distributed Servers "><LINKREL="next"HREF="ch09_08.htm"TITLE="9.8 Summary "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_06.htm"TITLE="9.6 Managing Distributed Servers "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.6 Managing Distributed Servers "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 9<BR>Configuring Network Servers </FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_08.htm"TITLE="9.8 Summary "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.8 Summary "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-9-SECT-7">9.7 Mail Servers </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-9-IX-MAILBOX-SERVERS"></A>In this section we configure a system to act as a post office server.A post office server, or mailbox server, is a computer that holds mailfor a client computer until the client is ready to download it for themail reader. This service is essential to support mobile users and tosupport small systems that are frequently offline and thus not able toreceive mail in real time. We look at two techniques for creating amailbox server: <EMCLASS="emphasis">Post Office Protocol</EM> (POP), which is the mostpopular protocol for this purpose, and <EMCLASS="emphasis">Internet Message AccessProtocol</EM> (IMAP), which is growing in popularity. We start withPOP.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-9-SECT-7.1">9.7.1 POP Server </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-9-IX-POST-OFFICE-PROTOCOL-POP-MAIL-SERVER"></A>A UNIX host turns into a POP mail server when it runs a POP daemon.Check your system's documentation to see if a POP daemon is included inthe system software. If it isn't clear from the documentation, checkthe <EMCLASS="emphasis">inetd.conf</EM> file, or try the simple <BCLASS="emphasis.bold">telnet</B> test from<ACLASS="indexterm"NAME="AUTOID-12707"></A><ACLASS="xref"HREF="ch04_01.htm"TITLE="Getting Started ">Chapter 4</A>. If the server responds to the <BCLASS="emphasis.bold">telnet</B> test, not onlyis the daemon available on your system, it is installed and ready torun.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <BCLASS="emphasis.bold">telnet localhost 110</B>Trying 127.0.0.1 ...Connected to localhost.Escape character is ']'.+OK POP3 almond Server (Version 1.004) ready<BCLASS="emphasis.bold">quit</B>+OK POP3 almond Server (Version 1.001) shutdownConnection closed by foreign host.</PRE></BLOCKQUOTE></P><PCLASS="para">This example is from a Linux system, which comes with POP3 ready torun. The Solaris system, on the other hand, does not ship with POP2 orPOP3. Don't worry if your system doesn't include this software. POP3software is available from several sites on the Internet where it isstored in both the <EMCLASS="emphasis">popper17.tar</EM><ACLASS="indexterm"NAME="AUTOID-12718"></A><ACLASS="indexterm"NAME="AUTOID-12720"></A>and the <EMCLASS="emphasis">pop3d.tar</EM> files. I have used them both and they bothwork fine.</P><PCLASS="para">If you don't have POP3 on your system, download the source code.<ACLASS="indexterm"NAME="AUTOID-12724"></A>Extract it using the UNIX <BCLASS="emphasis.bold">tar</B> command. <EMCLASS="emphasis">pop3d.tar</EM> creates adirectory called <EMCLASS="emphasis">pop3d</EM> under the current directory, but<EMCLASS="emphasis">popper17.tar</EM> does not. If you decide to use popper, create a newdirectory before extracting it with <BCLASS="emphasis.bold">tar</B>. Edit the Makefile toconfigure it for your system and do a <BCLASS="emphasis.bold">make</B> to compile the POP3daemon. If it compiles without errors, install the daemon in a systemdirectory.</P><PCLASS="para">Most network daemons are started by the Internet daemon,<ACLASS="indexterm"NAME="AUTOID-12734"></A><BCLASS="emphasis.bold">inetd</B>. POP3 is no exception. Start POP3 from <BCLASS="emphasis.bold">inetd</B> byplacing the following in the <EMCLASS="emphasis">inetd.conf</EM> file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">pop3   stream  tcp     nowait  root    /etc/pop3d              pop3d</PRE></BLOCKQUOTE></P><PCLASS="para">This entry assumes you are using <BCLASS="emphasis.bold">pop3d</B>, that you placed theexecutable in the <EMCLASS="emphasis">/etc</EM> directory, and that the port for thisdaemon is identified in the <EMCLASS="emphasis">/etc/services</EM> file by the name<CODECLASS="literal">pop3</CODE>. If these things aren't true, adjust the entryaccordingly.</P><PCLASS="para">Make sure that POP3 is actually defined in <EMCLASS="emphasis">/etc/services</EM>.<ACLASS="indexterm"NAME="AUTOID-12749"></A><ACLASS="indexterm"NAME="AUTOID-12752"></A>If it isn't, add the following line to that file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">pop3         110/tcp              # Post Office Version 3</PRE></BLOCKQUOTE></P><PCLASS="para">Once the lines are added to the <EMCLASS="emphasis">services</EM> file and the<EMCLASS="emphasis">inetd.conf</EM> file, send a SIGHUP to <BCLASS="emphasis.bold">inetd</B> to force it to readthe new configuration, as in this example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <BCLASS="emphasis.bold">ps -ef | grep inetd</B>  root  109  1  0   Jun 09 ?   0:01 /usr/sbin/inetd -s# <BCLASS="emphasis.bold">kill -HUP 109</B></PRE></BLOCKQUOTE></P><PCLASS="para">Now that POP3 is installed, rerun the test using <BCLASS="emphasis.bold">telnet localhostpop-3</B>. If the POP3 daemon answers, you're in business. All userswho have a valid user account on the system are now able to downloadmail via POP3 or read the mail directly on the server.<ACLASS="indexterm"NAME="AUTOID-12766"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-9-SECT-7.2">9.7.2 IMAP Server </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-9-IX-INTERNET-MESSAGE-ACCESS-PROTOCOL-IMAP"></A><ACLASS="indexterm"NAME="TCP2-CH-9-IX-INTERNET-MESSAGE-ACCESS-PROTOCOL-IMAP2"></A><EMCLASS="emphasis">Internet Message Access Protocol</EM> (IMAP) is an alternative to POP.It provides the same basic service as POP and adds features to support<ACLASS="indexterm"NAME="AUTOID-12775"></A>mailbox synchronization. Mailbox synchronization is the ability to readmail on a client or directly on the server while keeping the mailboxes onboth systems completely up-to-date. On an average POP server, the entirecontents of the mailbox are moved to the client and either deleted fromthe server or retained as if never read. Deletion of individual messageson the client is not reflected on the server because all of the messagesare treated as a single unit that is either deleted or retained afterthe initial transfer of data to the client. IMAP provides the abilityto manipulate individual messages on either the client or the serverand to have those changes reflected in the mailboxes of both systems.</P><PCLASS="para">IMAP is not a new protocol&nbsp;- it is about as old as POP3. Nor is IMAPcompletely standardized. There have been four distinct versions of IMAP:IMAP, IMAP2, IMAP3, and the current version IMAP4. New RFCs about IMAPare still being issued. There are currently more than 10. The fearthat IMAP is still in flux and that it is difficult to implement hasdiscouraged some vendors, so it is not as widely implemented as POP.This is changing, however. The growing importance of email as a<ACLASS="indexterm"NAME="AUTOID-12779"></A>means of communicating, even when people are out of the office,increases the need for a mailbox that can be read and maintained fromanywhere. The number of IMAP implementations is rising. Sun sellsone for Solaris, another comes with Slackware 96 Linux in the<ACLASS="indexterm"NAME="AUTOID-12782"></A><ACLASS="indexterm"NAME="AUTOID-12785"></A><EMCLASS="emphasis">/usr/sbin/imapd</EM> file, and IMAP source code can be obtained viaanonymous FTP from <EMCLASS="emphasis">ftp.cac.washington.edu</EM>. We use the Universityof Washington source code to update IMAP on our Linux system for theexamples in this section.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-12790"></A>Download <EMCLASS="emphasis">/mail/imap.tar.Z</EM> from <EMCLASS="emphasis">ftp.cac.washington.edu</EM> asa binary image. Uncompress and untar<ACLASS="indexterm"NAME="AUTOID-12794"></A>the file. This creates a directory containing the source codeand Makefile needed to build IMAP.[12]Read the Makefile carefully. It supports many versions of UNIX.If you find yours listed in the Makefile, use the three-characteroperating system type listed there. For our Linux system we entered:&#13;</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[12] The name of the directory tells you the current release level of thesoftware. At this writing it is imap-4.1.BETA.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># make lnx</PRE></BLOCKQUOTE></P><PCLASS="para">If it compiles without error, as it does on our Linux system, it producesthree daemons: <BCLASS="emphasis.bold">ipop2d</B>, <BCLASS="emphasis.bold">ipop3d</B>, and <BCLASS="emphasis.bold">imapd</B>. We arefamiliar with installing POP2 and POP3. The new one is <BCLASS="emphasis.bold">imapd</B>.Install it in <EMCLASS="emphasis">/etc/services</EM>:<ACLASS="indexterm"NAME="AUTOID-12807"></A><ACLASS="indexterm"NAME="AUTOID-12810"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">imap      143/tcp       # IMAP version 4</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;Also add it to <EMCLASS="emphasis">/etc/inetd</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">imap  stream  tcp  nowait  root  /usr/sbin/imapd  imapd</PRE></BLOCKQUOTE></P><PCLASS="para">Now basic IMAP service is available to every user with an account onthe server.</P><PCLASS="para">A nice feature of the University of Washington package is that itprovides implementations of POP2 and POP3 as well as IMAP. This isimportant because most email clients run POP3.[13]The IMAP server can only be accessed by an IMAP client. Installing POP2and POP3 along with IMAP gives you the chance to evaluate IMAP and toprovide it for your adventurous users<ACLASS="indexterm"NAME="AUTOID-12822"></A>while still supporting the majority of users.<ACLASS="indexterm"NAME="AUTOID-12824"></A><ACLASS="indexterm"NAME="AUTOID-12825"></A></P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[13] The pine mail client supports IMAP.</P></BLOCKQUOTE><PCLASS="para">POP and IMAP are mail access servers. There is a great deal more toconfiguring a complete email system, as we will see in the next chapter.<ACLASS="indexterm"NAME="AUTOID-12827"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_06.htm"TITLE="9.6 Managing Distributed Servers "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.6 Managing Distributed Servers "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_08.htm"TITLE="9.8 Summary "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 9.8 Summary "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">9.6 Managing Distributed Servers </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">9.8 Summary </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>