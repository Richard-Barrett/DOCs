<HTML><HEAD><TITLE>[Chapter 11] 11.3 Testing Basic Connectivity </TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:40:31Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch11_01.htm"TITLE="11. Troubleshooting TCP/IP "><LINKREL="prev"HREF="ch11_02.htm"TITLE="11.2 Diagnostic Tools "><LINKREL="next"HREF="ch11_04.htm"TITLE="11.4 Troubleshooting Network Access "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_02.htm"TITLE="11.2 Diagnostic Tools "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 11.2 Diagnostic Tools "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 11<BR>Troubleshooting TCP/IP </FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_04.htm"TITLE="11.4 Troubleshooting Network Access "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 11.4 Troubleshooting Network Access "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-11-SECT-3">11.3 Testing Basic Connectivity </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-11-IX-TROUBLESHOOTING-BASIC-CONNECTIVITY"></A><ACLASS="indexterm"NAME="TCP2-CH-11-IX-CONNECTIVITY-TROUBLESHOOTING"></A><ACLASS="indexterm"NAME="TCP2-CH-11-IX-PING-COMMAND-IN-TROUBLESHOOTING-TROUBLESHOOTING"></A>The <BCLASS="emphasis.bold">ping</B> command tests whether a remote host can bereached from your computer. This simple function is extremely usefulfor testing the network connection, independent of the application inwhich the original problem was detected. <BCLASS="emphasis.bold">ping</B> allows you todetermine whether further testing should be directed towardthe network connection (the lower layers) or the application (the upperlayers). If <BCLASS="emphasis.bold">ping</B> shows that packets can travel to the remotesystem and back, the user's problem is probably in the upper layers.If packets can't make the round trip, lower protocol layers areprobably at fault.</P><PCLASS="para">Frequently a user reports a network problem by stating that he can't<BCLASS="emphasis.bold">telnet</B> (or <BCLASS="emphasis.bold">ftp</B>, or send email, or whatever) to some remote host. He then immediately qualifies thisstatement with the announcement that it worked before. In cases likethis, where the ability to connect to the remote host is in question,<BCLASS="emphasis.bold">ping</B> is a very useful tool.</P><PCLASS="para">Using the hostname provided by the user, <BCLASS="emphasis.bold">ping</B> the remote host.If your <BCLASS="emphasis.bold">ping</B> is successful, have the user <BCLASS="emphasis.bold">ping</B> the host.If the user's <BCLASS="emphasis.bold">ping</B> is also successful, concentrate your furtheranalysis on the specific application that the user is having troublewith. Perhaps the user is attempting to <BCLASS="emphasis.bold">telnet</B> to a host thatonly provides anonymous <BCLASS="emphasis.bold">ftp</B>. Perhaps the host was down when theuser tried his application. Have the user try it again, while youwatch or listen to every detail of what he is doing. If he is doingeverything right and the application still fails, detailed analysis of<ACLASS="indexterm"NAME="AUTOID-15431"></A><ACLASS="indexterm"NAME="AUTOID-15434"></A>the application with <BCLASS="emphasis.bold">snoop</B> and coordination with the remotesystem administrator may be needed.</P><PCLASS="para">If your <BCLASS="emphasis.bold">ping</B> is successful and the user's <BCLASS="emphasis.bold">ping</B> fails,concentrate testing on the user's system configuration, and onthose things that are different about the user's path to the remotehost, when compared to your path to the remote host.</P><PCLASS="para">If your <BCLASS="emphasis.bold">ping</B> fails, or the user's <BCLASS="emphasis.bold">ping</B> fails, pay close<ACLASS="indexterm"NAME="AUTOID-15445"></A>attention to any error messages. The error messages displayed by<BCLASS="emphasis.bold">ping</B> are helpful guides for planning further testing. Thedetails of the messages may vary from implementation to implementation,but there are only a few basic types of errors:</P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">Unknown host</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15456"></A>The remote host's name cannot be resolved by name service into an IP<ACLASS="indexterm"NAME="AUTOID-15458"></A>address. The name servers could be at fault (either your local serveror the remote system's server), the name could be incorrect, orsomething could be wrong with the network between your system and theremote server. If you know the remote host's IP address, try to<BCLASS="emphasis.bold">ping</B> that. If you can reach the host using its IP address, the<ACLASS="indexterm"NAME="AUTOID-15462"></A><ACLASS="indexterm"NAME="AUTOID-15465"></A>problem is with name service. Use <BCLASS="emphasis.bold">nslookup</B> or <BCLASS="emphasis.bold">dig</B> to testthe local and remote servers, and to check the accuracy of the hostname the user gave you.</P></DD><DTCLASS="term"><EMCLASS="emphasis">Network unreachable</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15474"></A>The local system does not have a route to the remote system. If thenumeric IP address was used on the <BCLASS="emphasis.bold">ping</B> command line, re-enterthe <BCLASS="emphasis.bold">ping</B> command using the hostname. This eliminates thepossibility that the IP address was entered incorrectly, or that youwere given the wrong address. If a routing protocol is being used,make sure it is running and check the routing table with<BCLASS="emphasis.bold">netstat</B>. If RIP is being used, <BCLASS="emphasis.bold">ripquery</B> will check thecontents of the RIP updates being received. If a static default routeis being used, re-install it. If everything seems fine on the host,check its default gateway for routing problems.</P></DD><DTCLASS="term"><EMCLASS="emphasis">No answer</EM></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15485"></A>The remote system did not respond. Most network utilitieshave some version of this message. Some <BCLASS="emphasis.bold">ping</B> implementationsprint the message &quot;100% packet loss.&quot; <BCLASS="emphasis.bold">telnet</B> prints the message&quot;Connection timed out&quot; and <BCLASS="emphasis.bold">sendmail</B> returns the error&quot;cannot connect.&quot; All of these errors mean the same thing. Thelocal system has a route to the remote system, but it receives noresponse from the remote system to any of the packets it sends.</P><PCLASS="para">There are many possible causes of this problem. The remote host may bedown. Either the local or the remote host may be configuredincorrectly. A gateway or circuit between the local host and theremote host may be down. The remote host may have routing problems.Only additional testing can isolate the cause of the problem.<ACLASS="indexterm"NAME="AUTOID-15491"></A><ACLASS="indexterm"NAME="AUTOID-15494"></A>Carefully check the local configuration using <BCLASS="emphasis.bold">netstat</B> and<BCLASS="emphasis.bold">ifconfig</B>. Check the route to the remote system with<ACLASS="indexterm"NAME="AUTOID-15499"></A><BCLASS="emphasis.bold">traceroute</B>. Contact the administrator of the remote system andreport the problem.</P></DD></DL><PCLASS="para">All of the tools mentioned here will be discussed later in this chapter.However, before leaving <BCLASS="emphasis.bold">ping</B>, let's look more closely at thecommand and the statistics it displays.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-11-SECT-3.1">11.3.1 The ping Command </A></H3><PCLASS="para">The basic format of the <BCLASS="emphasis.bold">ping</B> command on a Solaris system is:[2]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] Check your system's documentation. <BCLASS="emphasis.bold">ping</B> varies slightly fromsystem to system. On Linux, the format shown above would be:<BCLASS="emphasis.bold">ping</B> [<BCLASS="emphasis.bold">-c </B><CODECLASS="replaceable"><I>count</I></CODE>] [<BCLASS="emphasis.bold">-s </B><CODECLASS="replaceable"><I>packetsize</I></CODE>] <CODECLASS="replaceable"><I>host</I></CODE></P></BLOCKQUOTE><PCLASS="para"><BCLASS="emphasis.bold">ping </B><CODECLASS="replaceable"><I>host</I></CODE> [<CODECLASS="replaceable"><I>packetsize</I></CODE>] [<CODECLASS="replaceable"><I>count</I></CODE>]</P><DLCLASS="variablelist"><DTCLASS="term"><CODECLASS="replaceable"><I>host</I></CODE></DT><DDCLASS="listitem"><PCLASS="para">The hostname or IP address of the remote host beingtested. Use the hostname or address provided by the user in thetrouble report.</P></DD><DTCLASS="term"><CODECLASS="replaceable"><I>packetsize</I></CODE></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15533"></A>Defines the size in bytes of the test packets. Thisfield is required only if the <CODECLASS="replaceable"><I>count</I></CODE> field is going to be used.Use the default <CODECLASS="replaceable"><I>packetsize</I></CODE> of 56 bytes.</P></DD><DTCLASS="term"><CODECLASS="replaceable"><I>count</I></CODE></DT><DDCLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15542"></A>The number of packets to be sent in the test. Use the <CODECLASS="replaceable"><I>count</I></CODE>field, and set the value low. Otherwise, the <BCLASS="emphasis.bold">ping</B> command maycontinue to send test packets until you interrupt it, usually bypressing CTRL-C (^C). Sending excessive numbers of test packets isnot a good use of network bandwidth and system resources. Usually fivepackets are sufficient for a test.</P></DD></DL><PCLASS="para">To check that <EMCLASS="emphasis">ns.uu.net</EM> can be reached from <EMCLASS="emphasis">almond</EM>, we sendfive 56-byte packets with the following command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>ping -s ns.uu.net 56 5</B></CODE>PING ns.uu.net: 56 data bytes64 bytes from ns.uu.net (137.39.1.3): icmp_seq=0. time=32.8 ms64 bytes from ns.uu.net (137.39.1.3): icmp_seq=1. time=15.3 ms64 bytes from ns.uu.net (137.39.1.3): icmp_seq=2. time=13.1 ms64 bytes from ns.uu.net (137.39.1.3): icmp_seq=3. time=32.4 ms64 bytes from ns.uu.net (137.39.1.3): icmp_seq=4. time=28.1 ms----ns.uu.net PING Statistics----5 packets transmitted, 5 packets received, 0% packet lossround-trip (ms)  min/avg/max = 13.1/24.3/32.8</PRE></BLOCKQUOTE></P><PCLASS="para">The <BCLASS="emphasis.bold">-s</B> option is included because <EMCLASS="emphasis">almond</EM> is a Solarisworkstation, and we want packet-by-packet statistics. Without the<BCLASS="emphasis.bold">-s</B> option, Sun's <BCLASS="emphasis.bold">ping</B> command  only prints a summaryline saying &quot;ns.uu.net is alive.&quot; Other <BCLASS="emphasis.bold">ping</B> implementationsdo not require the <BCLASS="emphasis.bold">-s</B> option; they display the statistics bydefault.</P><PCLASS="para">This test shows an extremely good wide area network link to<EMCLASS="emphasis">ns.uu.net</EM> with no packet loss and a fast response. The round-tripbetween <EMCLASS="emphasis">peanut</EM> and <EMCLASS="emphasis">ns.uu.net</EM> took an average of only24.3 milliseconds. A small packet loss, and a round-trip time anorder of magnitude higher, would not be abnormal for a connection madeacross a wide area network.<ACLASS="indexterm"NAME="AUTOID-15563"></A>The statistics displayed by the <BCLASS="emphasis.bold">ping</B> command canindicate low-level network problems. The key statistics are:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">The sequence in which the packets are arriving, as shown by the ICMPsequence number (<CODECLASS="literal">icmp_seq</CODE>) displayed for each packet.</P></LI><LICLASS="listitem"><PCLASS="para">How long it takes a packet to make the round trip, displayedin milliseconds after the string <CODECLASS="literal">time=</CODE>.</P></LI><LICLASS="listitem"><PCLASS="para">The percentage of packets lost, displayed in a summary line atthe end of the <BCLASS="emphasis.bold">ping</B> output.</P></LI></UL><PCLASS="para">If the packet loss is high, the response time is very slow, or packetsare arriving out of order, there could be a network hardware problem.If you see these conditions when communicating over great distances on a<ACLASS="indexterm"NAME="AUTOID-15578"></A>wide area network, there is nothing to worry about. TCP/IP was<ACLASS="indexterm"NAME="AUTOID-15580"></A>designed to deal with unreliable networks, and some wide area networkssuffer a lot of packet loss. But if these problems are seen on alocal area network, they indicate trouble.</P><PCLASS="para">On a local network cable segment, the round-trip time should be near 0, there should be little or no packet loss, and the packets shouldarrive in order. If these things are not true, there is a problem with<ACLASS="indexterm"NAME="AUTOID-15584"></A>the network hardware. On an Ethernet the problem could be impropercable termination, a bad cable segment, or a bad piece of &quot;active&quot;hardware, such as a hub, switch, or transceiver. Check the cable with a<ACLASS="indexterm"NAME="AUTOID-15588"></A>cable tester as described earlier. Good hubs and switches often have<ACLASS="indexterm"NAME="AUTOID-15590"></A>built-in diagnostic software that can be checked. Cheap hubs andtransceivers may require the &quot;brute force&quot; method of disconnectingindividual pieces of hardware until the problem goes away.</P><PCLASS="para">The results of a simple <BCLASS="emphasis.bold">ping</B> test, even if the <BCLASS="emphasis.bold">ping</B> issuccessful, can help you direct further testing toward the most likelycauses of the problem. But other diagnostic tools are needed toexamine the problem more closely and find the underlyingcause.<ACLASS="indexterm"NAME="AUTOID-15597"></A><ACLASS="indexterm"NAME="AUTOID-15598"></A><ACLASS="indexterm"NAME="AUTOID-15599"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_02.htm"TITLE="11.2 Diagnostic Tools "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 11.2 Diagnostic Tools "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_04.htm"TITLE="11.4 Troubleshooting Network Access "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 11.4 Troubleshooting Network Access "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">11.2 Diagnostic Tools </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">11.4 Troubleshooting Network Access </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>