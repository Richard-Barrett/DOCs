<HTML><HEAD><TITLE>[Chapter 12] 12.5 Access Control </TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:41:53Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch12_01.htm"TITLE="12. Network Security "><LINKREL="prev"HREF="ch12_04.htm"TITLE="12.4 Security Monitoring "><LINKREL="next"HREF="ch12_06.htm"TITLE="12.6 Encryption "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch12_04.htm"TITLE="12.4 Security Monitoring "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 12.4 Security Monitoring "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 12<BR>Network Security </FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch12_06.htm"TITLE="12.6 Encryption "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 12.6 Encryption "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-12-SECT-5">12.5 Access Control </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-12-IX-ACCESS-CONTROL"></A><EMCLASS="emphasis">Access control</EM> is a technique for limiting access. Routers andhosts that use access control check the address of a host requesting aservice against an <EMCLASS="emphasis">access control list</EM>. If the list says thatthe remote host is permitted to use the requested service, the accessis granted. If the list says that the remote host is not permitted toaccess the service, the access is denied. Access control does notbypass any normal security checks. It adds a check to validate thesource of a service request, and retains all of the normal checks tovalidate the user.</P><PCLASS="para">Access control systems are common in terminal servers and routers.For example, Cisco routers<ACLASS="indexterm"NAME="AUTOID-18140"></A>have an access control facility. Access<ACLASS="indexterm"NAME="AUTOID-18142"></A>control software is also available for UNIX hosts. Two such packages<ACLASS="indexterm"NAME="AUTOID-18145"></A>are <BCLASS="emphasis.bold">xinetd</B> and the <EMCLASS="emphasis">TCP wrappers</EM> program. Clearly, thereare a variety of ways to implement access controls. In this section weuse TCP wrappers (&quot;wrapper&quot;).</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-12-SECT-5.1">12.5.1 wrapper </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-12-IX-WRAPPER"></A>The wrapper package performs two basic functions: it logs requests forInternet services, and provides an access control mechanism for UNIXsystems. Logging requests for specific network services is a usefulmonitoring function, especially if you are looking for possibleintruders. If this were all it did, wrapper would be a usefulpackage.But the real power of wrapper is its ability to control access tonetwork services.</P><PCLASS="para">The wrapper software is available through the<ACLASS="systemitem.sitename"HREF="http://csrc.nist.gov/tools/tools.htm">http://csrc.nist.gov/tools/tools.htm</A> Web page. The wrapper<EMCLASS="emphasis">tar</EM> file contains the C source code and Makefile necessary tobuild the wrapper daemon <BCLASS="emphasis.bold">tcpd</B>.<ACLASS="indexterm"NAME="AUTOID-18158"></A></P><PCLASS="para">Make <BCLASS="emphasis.bold">tcpd</B> and then install it in the same directory as the other networkdaemons. Edit <EMCLASS="emphasis">/etc/inetd.conf</EM><ACLASS="indexterm"NAME="AUTOID-18163"></A><ACLASS="indexterm"NAME="AUTOID-18166"></A>and replace the path to eachnetwork service daemon that you wish to place under access control withthe path to <BCLASS="emphasis.bold">tcpd</B>. The only field in the <EMCLASS="emphasis">/etc/inetd.conf</EM>entry affected by <BCLASS="emphasis.bold">tcpd</B> is the sixth field, which contains thepath to the network daemon.</P><PCLASS="para">For example, assume that the entry for the<BCLASS="emphasis.bold">finger</B> daemon in <EMCLASS="emphasis">/etc/inetd.conf</EM> on our Solaris system is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">finger  stream  tcp  nowait  nobody  /usr/etc/in.fingerd  in.fingerd</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;The value in the sixth field is <EMCLASS="emphasis">/usr/etc/in.fingerd</EM>. To monitoraccess to the <BCLASS="emphasis.bold">finger</B> daemon,<ACLASS="indexterm"NAME="AUTOID-18181"></A>replace this value with<EMCLASS="emphasis">/usr/etc/tcpd</EM>, as in the following entry:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">finger   stream  tcp  nowait  nobody  /usr/etc/tcpd   in.fingerd</PRE></BLOCKQUOTE></P><PCLASS="para">Now when <BCLASS="emphasis.bold">inetd</B> receives a request for <BCLASS="emphasis.bold">fingerd</B>, it starts<BCLASS="emphasis.bold">tcpd</B> instead. <BCLASS="emphasis.bold">tcpd</B> then logs the <BCLASS="emphasis.bold">fingerd</B> request,checks the access control information, and, if permitted, starts thereal <BCLASS="emphasis.bold">finger</B> daemon to handle the request.</P><PCLASS="para">Make a similar change for every service<ACLASS="indexterm"NAME="AUTOID-18195"></A>you want to place underaccess control. Good candidates for access control are <BCLASS="emphasis.bold">ftpd</B>,<BCLASS="emphasis.bold">tftpd</B>, <BCLASS="emphasis.bold">telnetd</B>, <BCLASS="emphasis.bold">rshd</B>, <BCLASS="emphasis.bold">rlogind</B>, <BCLASS="emphasis.bold">rexecd</B>, and<BCLASS="emphasis.bold">fingerd</B>. Obviously, <BCLASS="emphasis.bold">tcpd</B> cannot control access fordaemons that are not started by <BCLASS="emphasis.bold">inetd</B>, such as <BCLASS="emphasis.bold">sendmail</B> andNFS.</P><PCLASS="para">Using the wrapper on our Slackware 96 Linux system is even easier.There is no need to download and install the <BCLASS="emphasis.bold">tcpd</B> software. Itcomes as an integral part of the Linux release. You don't even have toedit the <EMCLASS="emphasis">/etc/inetd.conf</EM> file because the sixth field of theentries in that file already point to the <BCLASS="emphasis.bold">tcpd</B> program, as shownbelow:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">finger   stream  tcp  nowait  nobody  /usr/sbin/tcpd   in.fingerd -w</PRE></BLOCKQUOTE></P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="TCP2-CH-12-SECT-5.1.1">12.5.1.1 tcpd access control files </A></H4><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-12-IX-TCPD-WRAPPER-DAEMON-ACCESS-CONTROL-FILES"></A>The information <BCLASS="emphasis.bold">tcpd</B> uses to control access is in two files, <EMCLASS="emphasis">/etc/hosts.allow</EM><ACLASS="indexterm"NAME="AUTOID-18222"></A><ACLASS="indexterm"NAME="AUTOID-18224"></A><ACLASS="indexterm"NAME="AUTOID-18227"></A><ACLASS="indexterm"NAME="AUTOID-18229"></A>and <EMCLASS="emphasis">/etc/hosts.deny</EM>. Each file's function is obvious from its name. <EMCLASS="emphasis">hosts.allow</EM>contains the list of hoststhat are allowed to access the network's services, and <EMCLASS="emphasis">hosts.deny</EM>contains the list of hosts that are denied access. If thefiles are not found, <BCLASS="emphasis.bold">tcpd</B> permits every host to have access andsimplylogs the access request. Therefore, if you only want to monitoraccess, don't create these two files.</P><PCLASS="para">If the files are found, <BCLASS="emphasis.bold">tcpd</B> checks the <EMCLASS="emphasis">hosts.allow</EM> filefirst, followed by the <EMCLASS="emphasis">hosts.deny</EM> file. It stops as soon as itfinds a match for the host and the service in question. Therefore,access granted by <EMCLASS="emphasis">hosts.allow</EM> cannot be overridden by<EMCLASS="emphasis">hosts.deny</EM>.</P><PCLASS="para">The format of entries in both files is the same:</P><BLOCKQUOTECLASS="blockquote"><PCLASS="para"><EMCLASS="emphasis">service-list</EM><BCLASS="emphasis.bold"> : </B><EMCLASS="emphasis">host-list </EM>[<BCLASS="emphasis.bold">: </B><EMCLASS="emphasis">shell-command</EM>]</P></BLOCKQUOTE><PCLASS="para">The <EMCLASS="emphasis">service-list</EM><ACLASS="indexterm"NAME="AUTOID-18252"></A>is a list of network services, separated by commas.These are the services to which access is being granted(<EMCLASS="emphasis">hosts.allow</EM>) or denied (<EMCLASS="emphasis">hosts.deny</EM>). Each service isidentified by the process name used in the seventh field of the<EMCLASS="emphasis">/etc/inetd.conf</EM> entry. This is simply the name thatimmediately follows the path to <BCLASS="emphasis.bold">tcpd</B> in <EMCLASS="emphasis">inetd.conf</EM>.(See <ACLASS="xref"HREF="ch05_01.htm"TITLE="Basic Configuration ">Chapter 5, <CITECLASS="chapter">Basic Configuration </CITE></A>, for a description of thearguments field in the <EMCLASS="emphasis">/etc/inetd.conf</EM> entry.)&#13;</P><PCLASS="para">Again, let's use <BCLASS="emphasis.bold">finger</B> as an example. We changed its<EMCLASS="emphasis">inetd.conf</EM> entry to read:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">finger   stream  tcp  nowait  nobody  /usr/etc/tcpd   in.fingerd</PRE></BLOCKQUOTE></P><PCLASS="para">Therefore, we would use <BCLASS="emphasis.bold">in.fingerd</B> as the service name in a<EMCLASS="emphasis">hosts.allow</EM> or <EMCLASS="emphasis">hosts.deny</EM> file.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-18271"></A>The <EMCLASS="emphasis">host-list</EM> is a comma-separated list of hostnames, domainnames, Internet addresses, or network numbers.The systems listed in the host-list are granted access(<EMCLASS="emphasis">hosts.allow</EM>) or denied access (<EMCLASS="emphasis">hosts.deny</EM>) to the servicesspecified in the service-list. A hostname or an Internetaddress matches  an individual host. For example, <EMCLASS="emphasis">peanut</EM> is ahostname and 172.16.12.2  is an Internet address. Both match aparticular host. A domain name matches every host within that domain;e.g., <EMCLASS="emphasis">.nuts.com</EM> matches <EMCLASS="emphasis">almond.nuts.com</EM>,<EMCLASS="emphasis">peanut.nuts.com</EM>, <EMCLASS="emphasis">pecan.nuts.com</EM>, and any other hosts in thedomain. When specified in a<BCLASS="emphasis.bold">tcpd</B> access control list, domain names always start with a dot(<CODECLASS="literal">.</CODE>). A network number matches every IP address within that network'saddress space. For example, 172.16. matches 172.16.12.1, 172.16.12.2,172.16.5.1, and any other address that begins with 172.16. Networkaddresses in a <BCLASS="emphasis.bold">tcpd</B> access control list always end with a dot(<CODECLASS="literal">.</CODE>).</P><PCLASS="para">A completed <EMCLASS="emphasis">hosts.allow</EM> entry that grants FTP and telnet accessto all hosts in the <EMCLASS="emphasis">nuts.com</EM> domain is shown below:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">ftpd,telnetd : .nuts.com</PRE></BLOCKQUOTE></P><PCLASS="para">Two special keywords can be used in <EMCLASS="emphasis">hosts.allow</EM> and<EMCLASS="emphasis">hosts.deny</EM> entries. The keyword <CODECLASS="literal">ALL</CODE> can be used in theservice-list to match all network services, and in thehost-list to match all hostnames and addresses. The secondkeyword, <CODECLASS="literal">LOCAL</CODE>, can be used only in the host-list. It matchesall local hostnames. <BCLASS="emphasis.bold">tcpd</B> considers a hostname &quot;local&quot; if itcontains no embedded dots. Therefore, the hostname<EMCLASS="emphasis">peanut</EM> would match on <CODECLASS="literal">LOCAL</CODE>, but the hostname<EMCLASS="emphasis">peanut.nuts.com</EM> would not match. The followingentry affects all services and all local hosts:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">ALL : LOCAL</PRE></BLOCKQUOTE></P><PCLASS="para">The final field that can be used in these entries is the optionalshell-command field. The shell command specified in this field willexecute whenever a match occurs. The command is executed in additionto the normal functions of the access list match. In other words,if a match occurs for an entry that has an optional shell command,<BCLASS="emphasis.bold">tcpd</B> logs the access, grants or denies access to the service,and then passes the shell command to the shell for execution.</P><PCLASS="para">A more complete example of how <BCLASS="emphasis.bold">tcpd</B> is used will help youunderstand these entries. First, assume that you wish to allow everyhost in your local domain (<EMCLASS="emphasis">nuts.com</EM>) to have access to allservices on your system, but you want to deny access to every serviceto all other hosts.Make an entry in <EMCLASS="emphasis">/etc/hosts.allow</EM> to permitaccess to everything by everyone in the local domain:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">ALL : LOCAL, .nuts.com</PRE></BLOCKQUOTE></P><PCLASS="para">The keyword <CODECLASS="literal">ALL</CODE> in the services-list indicates that this rule appliesto all network services. The colon (:) separates the services-listfrom the host-list. The keyword <CODECLASS="literal">LOCAL</CODE> indicates that all localhostnames without a domain extension are acceptable, and that the<EMCLASS="emphasis">.nuts.com</EM> string indicates that all hostnames that have the<EMCLASS="emphasis">nuts.com</EM> domain name extensions are also acceptable. To preventaccess from everyone else, make an entry in the <EMCLASS="emphasis">/etc/hosts.deny</EM>file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">ALL : ALL</PRE></BLOCKQUOTE></P><PCLASS="para">Every system that does not match the entry in <EMCLASS="emphasis">/etc/hosts.allow</EM> ispassed on to <EMCLASS="emphasis">/etc/hosts.deny</EM>. Here the entry denies access toeveryone, regardless of what service they are asking for. Remember,even with <CODECLASS="literal">ALL</CODE> in the services-list field, only services started by<BCLASS="emphasis.bold">inetd</B>, and only those services whose entries in <EMCLASS="emphasis">inetd.conf</EM>have been edited to invoke <BCLASS="emphasis.bold">tcpd</B>, are affected. This does notprovide security for any other service.<ACLASS="indexterm"NAME="AUTOID-18325"></A><ACLASS="indexterm"NAME="AUTOID-18326"></A></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch12_04.htm"TITLE="12.4 Security Monitoring "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 12.4 Security Monitoring "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch12_06.htm"TITLE="12.6 Encryption "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 12.6 Encryption "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">12.4 Security Monitoring </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">12.6 Encryption </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>