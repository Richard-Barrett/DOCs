<HTML><HEAD><TITLE>[Chapter 12] 12.7 Firewalls </TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:42:00Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch12_01.htm"TITLE="12. Network Security "><LINKREL="prev"HREF="ch12_06.htm"TITLE="12.6 Encryption "><LINKREL="next"HREF="ch12_08.htm"TITLE="12.8 Words to the Wise "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch12_06.htm"TITLE="12.6 Encryption "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 12.6 Encryption "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 12<BR>Network Security </FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch12_08.htm"TITLE="12.8 Words to the Wise "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 12.8 Words to the Wise "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-12-SECT-7">12.7 Firewalls </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-12-IX-FIREWALLS"></A>A firewall system is a popular way to provide network security.  Theterm &quot;firewall&quot; implies protection from danger, and just as thefirewall in your car protects the passengers' compartment from thecar's engine, a firewall computer system protects your network fromthe outside world. A firewall computer provides strict access controlbetween your systems and the outside world.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-18389"></A>The concept of a firewall is quite simple. A firewall is a choke pointthrough which all traffic between a secured network and an unsecurednetwork must pass. In practice, it is usually a choke point between anenterprise network and the Internet. Creating a single point throughwhich all traffic must pass allows the traffic to be more easilymonitored and controlled and allows security expertise to beconcentrated on that single point.</P><PCLASS="para">Firewalls are implemented in many ways. In fact, there are so manydifferent types of firewalls, the term is almost meaningless.  Whensomeone tells you they have a firewall you really can't know exactlywhat they mean. Covering all of the different types of firewallarchitectures requires an entire book&nbsp;- see <EMCLASS="emphasis">Building InternetFirewalls</EM> (O'Reilly &amp; Associates). Here we cover the screenedsubnet architecture (probably the most popular firewall architecture),and the multi-homed host architecture, which is essentially afirewall-in-a-box.</P><PCLASS="para">The most common firewall architecture contains at least four hardwarecomponents: an exterior router, a secure server (called a Bastion Host),<ACLASS="indexterm"NAME="AUTOID-18395"></A>an exposed network (called a Perimeter Network),<ACLASS="indexterm"NAME="AUTOID-18397"></A>and an interior router.Each hardware component provides part of the complete security scheme.<ACLASS="xref"HREF="ch12_07.htm#TCP2-CH-12-FIG-3"TITLE="Screened subnet firewall">Figure 12.4</A>illustrates this architecture.</P><H4CLASS="figure"><ACLASS="title"NAME="TCP2-CH-12-FIG-3">Figure 12.4: Screened subnet firewall</A></H4><IMGCLASS="graphic"SRC="figs/tcp2_1204.gif"ALT="Figure 12.4"><PCLASS="para">The exterior router is the only connection between the enterprise networkand the outside world. This router is configured to do a minimal levelof access control. It checks to make sure that no packet coming from theexternal world has a source address that matches the internal network.If our network number is 172.16, the exterior router discards anypackets it receives on its exterior interface that contain the sourceaddress 172.16. That source address should only be received by therouter on its interior interface. Security people call this type ofaccess control <EMCLASS="emphasis">packet filtering</EM>.<ACLASS="indexterm"NAME="AUTOID-18405"></A>In some ways it is similar tothe packet filtering we did in <ACLASS="xref"HREF="ch11_01.htm"TITLE="Troubleshooting TCP/IP ">Chapter 11, <CITECLASS="chapter">Troubleshooting TCP/IP </CITE></A> because packets are &quot;filteredout&quot; based on IP header information.</P><PCLASS="para">The interior router<ACLASS="indexterm"NAME="AUTOID-18411"></A>does the bulk of the access control work. Itfilters packets not only on address but also on protocol and portnumbers to control the services that are accessible to and from theinterior network. What services are blocked by this router are up toyou. If you plan to use a firewall, the services that will be allowedand those that will be denied should be defined in your security policydocument. Almost every service can be a threat. These threatsmust be evaluated in light of your security needs. Services that areintended only for internal users (NIS, NFS, X-Windows, etc.) are almostalways blocked. Services that allow writing to internal systems (the <BCLASS="emphasis.bold">r</B>commands, telnet, FTP, SMTP, etc.) are usually blocked. Services thatprovide information about internal systems (DNS, fingerd, etc.) areusually blocked. This doesn't leave much running! That is where thebastion host and perimeter network come in.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-18416"></A>The bastion host is a secure server. It provides an interconnectionpoint between the enterprise network and the outside world for therestricted services. Some of the services that are restricted by theinterior gateway may be essential for a useful network. Those essentialservices are provided through the bastion host in a secure manner.The bastion host provides some services directly, such as DNS,SMTP mail services, and anonymous FTP. Other services are provided as<ACLASS="indexterm"NAME="AUTOID-18418"></A><EMCLASS="emphasis">proxy services</EM>. When the bastion host acts as a proxy server,internal clients connect to the outside through the bastion hosts andexternal systems respond back to the internal clients through the host.The bastion host can therefore control the traffic flowing into and outof the site to any extent desired.</P><PCLASS="para">There can be more than one secure server, and there often is.The perimeter network connects the servers together and connects theexterior router to the interior router. The systems on the perimeternetwork are much more exposed to security threats than are the systemson the interior network. This is as it must be. After all, the secureservers are needed to provide service to the outside world as well asto the internal network. Isolating the systems that must be exposedon a separate network lessens the chance that a compromise of one ofthose systems will lead directly to the compromise of an internal system.</P><PCLASS="para">The multi-homed host architecture<ACLASS="indexterm"NAME="AUTOID-18423"></A>attempts to duplicate all of thesefirewall functions in a single box. It works by replacing an IP routerwith a multi-homed host that does not forward packets at the IP layer.[8]The multi-homed host effectively severs the connection between theinterior and exterior networks. To provide the interior network withsome level of network connectivity, it performs similar functions tothe bastion hosts.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[8] The role that IP routers, also called gateways, play in gluing theInternet together is covered extensively in earlier chapters.</P></BLOCKQUOTE><PCLASS="para"><ACLASS="xref"HREF="ch12_07.htm#TCP2-CH-12-FIG-4"TITLE="Firewalls versus routers">Figure 12.5</A>shows a comparison between an IP router and a multi-homedhost firewall. A router handles packets up through the IP layer. Therouter forwards each packet based on the packet's destination address,and the route to that destination indicated in the routing table. Ahost, on the other hand, does not forward packets. The multi-homedhost processes packets through the Application Layer, which provides itwith complete control over how packets are handled.[9]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[9] See the GATEWAY option in <ACLASS="xref"HREF="ch05_01.htm"TITLE="Basic Configuration ">Chapter 5</A>, for information on how to prevent amulti-homed host from forwarding packets.</P></BLOCKQUOTE><H4CLASS="figure"><ACLASS="title"NAME="TCP2-CH-12-FIG-4">Figure 12.5: Firewalls versus routers</A></H4><IMGCLASS="graphic"SRC="figs/tcp2_1205.gif"ALT="Figure 12.5"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-18438"></A>This definition of a firewall&nbsp;- as a device completely distinct from anIP router&nbsp;- is not universally accepted. Some people refer to routerswith special security features as firewalls, but this is really justa matter of semantics. In this book, routers with special securityfeatures are called &quot;secure routers&quot; or &quot;secure gateways.&quot; Firewalls,while they may include routers, do more than just filter packets.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-12-SECT-7.0.1">12.7.1 Functions of the firewall </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-12-IX-FIREWALLS-FUNCTIONS-OF"></A>An intruder cannot mount a direct attack onany of the systems behind a firewall. Packets destined for hostsbehind the firewall are simply delivered to the firewall. The intrudermust instead mount an attack directly against the firewall machine.Because the firewall machine can be the target of break-in attacks,it employs very strict security guidelines. But because there is onlyone firewall versus many machines on the local network, it iseasier to enforce strict security on the firewall.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-18448"></A>The disadvantage of a firewall system is obvious. In the same mannerthat it restricts access from the outside into the local network, itrestricts access from the local network to the outside world. Tominimize the inconvenience caused by the firewall, the system must domany more things than a router does. Some firewalls provide:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">DNS name service for the outside world</P></LI><LICLASS="listitem"><PCLASS="para">Email forwarding</P></LI><LICLASS="listitem"><PCLASS="para">Proxy services</P></LI></UL><PCLASS="para">Only the minimal services truly needed to communicate with externalsystems should be provided on a firewall system. Other common networkservices (NIS, NFS, <BCLASS="emphasis.bold">rsh</B>, <BCLASS="emphasis.bold">rcp</B>, <BCLASS="emphasis.bold">finger</B>, etc.) shouldgenerally not be provided. Services are limited to decrease the numberof holes through which an intruder can gain access. On firewall systems,security is more important than service.</P><PCLASS="para">The biggest problems for the firewall machine are <BCLASS="emphasis.bold">ftp</B> <ACLASS="indexterm"NAME="AUTOID-18464"></A>service and remote terminal service.<ACLASS="indexterm"NAME="AUTOID-18467"></A>To maintain a high level of security, useraccounts are discouraged on the firewall machine; however,user data must pass through the firewall system for <BCLASS="emphasis.bold">ftp</B> andremote terminal services. This problem can be handled by creatingspecial user accounts for <BCLASS="emphasis.bold">ftp</B> and <BCLASS="emphasis.bold">telnet</B> that areshared by all internal users. But group accounts are generally viewedas security problems. A better solution is to provide proxy services<ACLASS="indexterm"NAME="AUTOID-18474"></A>on the firewall. To do this you need to run a proxy server on thefirewall and proxy clients on your internal system. Most commercialclient software includes support for proxy services. Many packages arecompatible with SOCKS,<ACLASS="indexterm"NAME="AUTOID-18477"></A>a freely available proxy service package thatcan be downloaded from the Internet.</P><PCLASS="para">Because to be effective a firewall must be constructed with great care,and because there are many configuration variables for setting up afirewall machine, vendors offer special firewall software. Some vendorssell special-purpose machines designed specifically for use as firewallsystems. Before setting up your own firewall, investigate the optionsavailable from your hardware vendor.</P><PCLASS="para">The details of setting up a firewall system are beyond the scope of thisbook. Before you proceed, I recommend you read <EMCLASS="emphasis">Building InternetFirewalls</EM> and <EMCLASS="emphasis">Firewalls and Internet Security</EM>, listed inthe bibliography at the end of this chapter. Unless you have skilledUNIX systems administrators with adequate free time, a do-it-yourselffirewall<ACLASS="indexterm"NAME="AUTOID-18483"></A>installation is a mistake. Hire a company that specializesin firewall design and installation. If your information is valuableenough to protect with a firewall, it must be valuable enough to protectwith a professionally installed firewall.</P><PCLASS="para">Firewall systems are useful to many sites, but for some others theyare not appropriate. The restrictions they place on individualusers are not acceptable to some organizations, and these restrictionscan drive independent-minded users to find other ways to handle theircommunications needs. Think seriously about your real security needsbefore selecting a solution.<ACLASS="indexterm"NAME="AUTOID-18487"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-12-SECT-7.0.2">12.7.2 Routing control </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-12-IX-FIREWALLS-ROUTING-CONTROL-WITHIN"></A>A firewall system works by controlling routing between the protectedsystem and the rest of the world. A carefully modified static routing<ACLASS="indexterm"NAME="AUTOID-18494"></A>table can be used to provide a similar type of protection betweeninternal systems on an enterprise network.</P><PCLASS="para">As we discussed in the chapters on routing and troubleshooting, it isnecessary for your system to have a routing table entry for everynetwork with which it will communicate. This can be either an explicitroute for an individual network, or a default route for all networks.Without the proper routes, your system cannot communicate with remotenetworks, and the remote networks cannot communicate with your system.Regardless of how the remote site sets up its routing, it cannotcommunicate with your host if your host does not have a route back tothe remote site. Because of this, you can control which remote sitesare able to communicate with your system by controlling the contents ofthe routing table.</P><PCLASS="para">For example, assume that the <EMCLASS="emphasis">nuts.com</EM> personnel department is on subnet172.16.9.0, and that the router for their subnet is 172.16.9.1. Theywant to talk only to other hosts on their subnet and to a managementsystem named <EMCLASS="emphasis">hickory.nuts.com</EM> (172.16.18.7).To implement this policywith the routing table, each host administrator on the personnelsubnet:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">Makes sure that no routing protocol is running, and that noneis started automatically at boot time.</P></LI><LICLASS="listitem"><PCLASS="para">Disables source routing.</P></LI><LICLASS="listitem"><PCLASS="para">Makes sure that there is no default route in the routing table, andthat a default route is not added automatically at boot time.</P></LI><LICLASS="listitem"><PCLASS="para">Adds a host-specific route to 172.16.18.7 (<EMCLASS="emphasis">hickory.nuts.com</EM>), and makessure that this static route is added each time the system boots.</P></LI></OL><PCLASS="para">Using <BCLASS="emphasis.bold">netstat</B> to display this limited routing table<ACLASS="indexterm"NAME="AUTOID-18513"></A>on host172.16.9.14 shows the following:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>netstat -nr</B></CODE>Routing tablesDestination    Gateway       Flags    Refcnt Use   Interface127.0.0.1      127.0.0.1     UH       2      7126   lo0172.16.18.7    172.16.9.1    UGH      1      1285   le0172.16.9.0     172.16.9.14   U        30     89456  le0</PRE></BLOCKQUOTE></P><PCLASS="para">The display shows the loopback route,<ACLASS="indexterm"NAME="AUTOID-18520"></A>a route to the local subnet(172.16.9.0), and a host route to <EMCLASS="emphasis">hickory.nuts.com</EM>(172.16.18.7). There are no other routes, so there are no otherlocations with which this host can communicate. Therefore, if anintruder launched an attack against this system, he would receive noresponse.</P><PCLASS="para">This security technique is less restrictive than an internal firewall,because it affects only the systems that contain the data or processesthat are being protected. This technique is easy to implement and doesnot require special equipment or software. However, it is also muchless secure than a firewall. If any of these systems is successfullyattacked, all of the systems could be compromised. Each system beingprotected this way must be properly configured, while one firewall canprotect a group of systems. This works only when there are a smallnumber of systems and they are all under the control of a singlenetwork administrator. In a few situations, this is a possiblealternative to an internal firewall..<ACLASS="indexterm"NAME="AUTOID-18525"></A><ACLASS="indexterm"NAME="AUTOID-18526"></A><ACLASS="indexterm"NAME="AUTOID-18527"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch12_06.htm"TITLE="12.6 Encryption "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 12.6 Encryption "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch12_08.htm"TITLE="12.8 Words to the Wise "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 12.8 Words to the Wise "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">12.6 Encryption </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">12.8 Words to the Wise </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>