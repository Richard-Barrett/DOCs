<HTML><HEAD><TITLE>[Chapter 13] 13.2 Anonymous FTP </TITLE><METANAME="DC.title"CONTENT="TCP/IP Network Administration"><METANAME="DC.creator"CONTENT="Craig Hunt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1999-02-04T01:42:14Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-322-7"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch13_01.htm"TITLE="13. Internet Information Resources "><LINKREL="prev"HREF="ch13_01.htm"TITLE="13.1 The World Wide Web "><LINKREL="next"HREF="ch13_03.htm"TITLE="13.3 Finding Files "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="TCP/IP Network Administration"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="TCP/IP Network Administration"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/tsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch13_01.htm"TITLE="13.1 The World Wide Web "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 13.1 The World Wide Web "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 13<BR>Internet Information Resources </FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch13_03.htm"TITLE="13.3 Finding Files "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 13.3 Finding Files "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="TCP2-CH-13-SECT-2">13.2 Anonymous FTP </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-13-IX-ANONYMOUS-FTP"></A><ACLASS="indexterm"NAME="TCP2-CH-13-IX-ANONYMOUS-FTP2"></A>Anonymous FTP is mentioned throughout this book as a technique forretrieving publicly available files and programs from the many FTPservers around the Internet. Anonymous FTP is simply an <BCLASS="emphasis.bold">ftp</B>session in which you log into the remote server using the username<EMCLASS="emphasis">anonymous</EM> and, by convention, your email address as thepassword.[1]The anonymous FTP example below should make this simple process clear:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] Some FTP servers request your real username as apassword.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <BCLASS="emphasis.bold">ftp ftp.ncsa.edu</B>Connected to ftp.ncsa.uiuc.edu.220 FTP server Wed May 21 1997 ready.Name (ftp.ncsa.edu:kathy): <BCLASS="emphasis.bold">anonymous</B>331 Guest login ok, use email address as password.Password:ftp&gt; <BCLASS="emphasis.bold">cd /Web/Mosaic/Unix/binaries/2.6</B>250 CWD command successful.ftp&gt; <BCLASS="emphasis.bold">binary</B>200 Type set to I.ftp&gt; <BCLASS="emphasis.bold">get Mosaic-hp-2.6.Z Mosaic.Z</B>200 PORT command successful.150 Opening BINARY mode data connection for Mosaic-hp-2.6.Z.226 Transfer complete.local: Mosaic.Z remote: Mosaic-hp-2.6.Z809343 bytes received in 3.5 seconds (2.3e+02 Kbytes/s)ftp&gt; <BCLASS="emphasis.bold">quit</B>221 Goodbye.</PRE></BLOCKQUOTE></P><PCLASS="para">In this example, the user logs into the server <EMCLASS="emphasis">ftp.ncsa.edu</EM> usingthe username <EMCLASS="emphasis">anonymous</EM> and the password <EMCLASS="emphasis">kathy@nuts.com</EM>,which is her email address. With anonymous FTP, she can log in eventhough she doesn't have an account on <EMCLASS="emphasis">ftp.ncsa.edu</EM>. Of coursewhat she can do is restricted, but she can retrieve certain files fromthe system, and that's just what she does. She changes to the<EMCLASS="emphasis">/Web/Mosaic/Unix/binaries/2.6</EM> directory and gets the compressedfile <EMCLASS="emphasis">Mosaic-hp-2.6.Z</EM>. The file is retrieved in binary mode.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="TCP2-CH-13-SECT-2.1">13.2.1 Creating an FTP Server </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="TCP2-CH-13-IX-FILE-TRANSFER-PROTOCOL-FTP-SERVER-CREATING"></A>Using the anonymous FTP service offered by a remote server isvery simple. However, setting up an anonymous FTP service onyour own system is a little more complicated. Here are the steps toset up an anonymous FTP server:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">Add user <EMCLASS="emphasis">ftp</EM> to the <EMCLASS="emphasis">/etc/passwd</EM> file.</P></LI><LICLASS="listitem"><PCLASS="para">Create an <EMCLASS="emphasis">ftp</EM> home directory owned by user <EMCLASS="emphasis">ftp</EM> that cannot bewritten to by anyone.</P></LI><LICLASS="listitem"><PCLASS="para">Create a <EMCLASS="emphasis">bin</EM> directory under the <EMCLASS="emphasis">ftp</EM> home directory that isowned by <EMCLASS="emphasis">root</EM>, and that cannot be written to by anyone. The<BCLASS="emphasis.bold">ls</B> program should be placed in this directory and changed to mode111 (execute-only).</P></LI><LICLASS="listitem"><PCLASS="para">Create an <EMCLASS="emphasis">etc</EM> directory in the <EMCLASS="emphasis">ftp</EM> home directory that isowned by <EMCLASS="emphasis">root</EM>, and that cannot be written to by anyone. Createspecial <EMCLASS="emphasis">passwd</EM> and <EMCLASS="emphasis">group</EM> files in this directory, andchange the mode of both files to 444 (read-only).</P></LI><LICLASS="listitem"><PCLASS="para">Create a <EMCLASS="emphasis">pub</EM> directory in the <EMCLASS="emphasis">ftp</EM> home directory that isowned by <EMCLASS="emphasis">root</EM> and is only writable by <EMCLASS="emphasis">root</EM>, i.e., mode 644.Don't allow remote users to store files on your server, unless it isabsolutely necessary and your system is on a private, non-connectednetwork. If you must allow users to store files on the server, changethe ownership of this directory to <EMCLASS="emphasis">ftp</EM> and the mode to 666 (readand write). This should be the only directory where anonymous FTPusers can store files.</P></LI></OL><PCLASS="para">The following examples show each of these steps. First, create the<EMCLASS="emphasis">ftp</EM> home directory and the required subdirectories. In ourexample, we create the <EMCLASS="emphasis">ftp</EM> directory under the <EMCLASS="emphasis">/usr</EM> directory.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>mkdir /usr/ftp</B></CODE># <CODECLASS="userinput"><B>cd /usr/ftp</B></CODE># <CODECLASS="userinput"><B>mkdir bin</B></CODE># <CODECLASS="userinput"><B>mkdir etc</B></CODE># <CODECLASS="userinput"><B>mkdir pub</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Then copy <BCLASS="emphasis.bold">ls</B> to <EMCLASS="emphasis">/usr/ftp/bin</EM>, and set the correct permissions.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>cp /bin/ls /usr/ftp/bin</B></CODE># <CODECLASS="userinput"><B>chmod 111 /usr/ftp/bin/ls</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Create a group that will be used only by anonymous FTP, a group thathas no other members. In our example we create a group called<EMCLASS="emphasis">anonymous</EM>. An entry for this new group is added to the<ACLASS="indexterm"NAME="AUTOID-18739"></A><ACLASS="indexterm"NAME="AUTOID-18741"></A><EMCLASS="emphasis">/etc/group</EM> file, and a file named <EMCLASS="emphasis">/usr/ftp/etc/group</EM>is created that contains only this single entry.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">anonymous:*:15:</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-18749"></A><ACLASS="indexterm"NAME="AUTOID-18751"></A>Create a user named <EMCLASS="emphasis">ftp</EM> by placing an entry for that user in thefile <EMCLASS="emphasis">/etc/passwd</EM>. Also create a file named<EMCLASS="emphasis">/usr/ftp/etc/passwd</EM> that contains only the <EMCLASS="emphasis">ftp</EM> entry.Here's the entry we used in both files:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">ftp:*:15:15:Anonymous ftp:/usr/ftp:</PRE></BLOCKQUOTE></P><PCLASS="para">These examples use a GID of 15 and a UID of 15. These are onlyexamples; pick a UID and GID that aren't used for anything else onyour system.</P><PCLASS="para">A <BCLASS="emphasis.bold">cat</B> of the newly created <EMCLASS="emphasis">/usr/ftp/etc/passwd</EM> and<EMCLASS="emphasis">/usr/ftp/etc/group</EM> files shows the following:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cat /usr/ftp/etc/passwd</B></CODE>ftp:*:15:15:Anonymous ftp:/usr/ftp:% <CODECLASS="userinput"><B>cat /usr/ftp/etc/group</B></CODE>anonymous:*:15:</PRE></BLOCKQUOTE></P><PCLASS="para">After the edits are complete, set both files to mode 444:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>chmod 444 /usr/ftp/etc/passwd</B></CODE># <CODECLASS="userinput"><B>chmod 444 /usr/ftp/etc/group</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Set the correct ownership and mode for each of the directories. Theownership of <EMCLASS="emphasis">/usr/ftp/pub</EM>, <EMCLASS="emphasis">/usr/ftp/bin</EM>, and<EMCLASS="emphasis">/usr/ftp/etc</EM> do not need to be changed because the directorieswere created by <EMCLASS="emphasis">root</EM>.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>cd /usr/ftp</B></CODE># <CODECLASS="userinput"><B>chmod 644 pub</B></CODE># <CODECLASS="userinput"><B>chmod 555 bin</B></CODE># <CODECLASS="userinput"><B>chmod 555 etc</B></CODE># <CODECLASS="userinput"><B>cd ..</B></CODE># <CODECLASS="userinput"><B>chown ftp ftp</B></CODE># <CODECLASS="userinput"><B>chmod 555 ftp</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">If you must allow users to write their own files in the <EMCLASS="emphasis">pub</EM>directory, make the following changes:[2]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] This opens a large security hole. Allow users to write their ownfiles to the anonymous FTP server only if you must.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>chown ftp pub</B></CODE># <CODECLASS="userinput"><B>chmod 666 pub</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">For most UNIX systems, the installation is complete. But if you have aSun OS 4.x system, a few more steps are necessary. The dynamic linkingused by Sun OS requires that the <EMCLASS="emphasis">ftp</EM> home directory contains:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">The runtime loader</P></LI><LICLASS="listitem"><PCLASS="para">The shared C library</P></LI><LICLASS="listitem"><PCLASS="para"><EMCLASS="emphasis">/dev/zero</EM></P></LI></OL><PCLASS="para">These Sun-specific steps are shown in the following examples. First,create the directory <EMCLASS="emphasis">/usr/ftp/usr/lib</EM>, then copy the files<EMCLASS="emphasis">ld.so</EM> and <EMCLASS="emphasis">libc.so.*</EM> into the new directory, and set thefile permissions:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>cd /usr/ftp</B></CODE># <CODECLASS="userinput"><B>mkdir usr</B></CODE># <CODECLASS="userinput"><B>mkdir usr/lib</B></CODE># <CODECLASS="userinput"><B>cp /usr/lib/ld.so usr/lib</B></CODE># <CODECLASS="userinput"><B>cp /usr/lib/libc.so.* usr/lib</B></CODE># <CODECLASS="userinput"><B>chmod 555 libc.so.*</B></CODE># <CODECLASS="userinput"><B>chmod 555 usr/lib</B></CODE># <CODECLASS="userinput"><B>chmod 555 usr</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Next, create the <EMCLASS="emphasis">ftp/dev</EM> directory, and run <BCLASS="emphasis.bold">mknod</B> tocreate <EMCLASS="emphasis">dev/zero</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="userinput"><B>cd /usr/ftp</B></CODE># <CODECLASS="userinput"><B>mkdir dev</B></CODE># <CODECLASS="userinput"><B>cd dev</B></CODE># <CODECLASS="userinput"><B>mknod zero c 3 12</B></CODE># <CODECLASS="userinput"><B>cd ..</B></CODE># <CODECLASS="userinput"><B>chmod 555 dev</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Now you can copy the files you wish to make publicly available into<EMCLASS="emphasis">/usr/ftp/pub</EM>. To prevent these files from being overwritten byremote users, set the mode to 644 and make sure the files are not owned byuser <EMCLASS="emphasis">ftp</EM>.</P><PCLASS="para">Once you complete the configuration steps necessary for your system,test it thoroughly before announcing the service. Make sure that yourserver provides the anonymous FTP service you want, withoutproviding additional &quot;services&quot; that you don't want (such as allowinganonymous users access to files outside of the <EMCLASS="emphasis">ftp</EM> home<ACLASS="indexterm"NAME="AUTOID-18837"></A>directory). Anonymous FTP is a potential security risk. If youoffer this service at all, limit the number of systems at your sitethat provide it (one is usually enough), and take care to ensure thatthe installation is done properly.<ACLASS="indexterm"NAME="AUTOID-18840"></A><ACLASS="indexterm"NAME="AUTOID-18841"></A><ACLASS="indexterm"NAME="AUTOID-18842"></A></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch13_01.htm"TITLE="13.1 The World Wide Web "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 13.1 The World Wide Web "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="TCP/IP Network Administration"><IMGSRC="../gifs/txthome.gif"ALT="TCP/IP Network Administration"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch13_03.htm"TITLE="13.3 Finding Files "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 13.3 Finding Files "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">13.1 The World Wide Web </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">13.3 Finding Files </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><PCLASS="nav"><FONTSIZE="-1">[ <AHREF="../index.htm"TITLE="The Networking CD Bookshelf">Library Home</A> | <AHREF="../dnsbind/index.htm"TITLE="DNS &amp; BIND">DNS &amp; BIND</A> | <AHREF="index.htm"TITLE="TCP/IP Network Administration">TCP/IP</A> | <AHREF="../sendmail/index.htm"TITLE="sendmail">sendmail</A> | <AHREF="../smdref/index.htm"TITLE="sendmail Desktop Reference">sendmail Reference</A> | <AHREF="../firewall/index.htm"TITLE="Building Internet Firewalls">Firewalls</A> | <AHREF="../puis/index.htm"TITLE="Practical UNIX &amp; Internet Security">Practical Security</A> ]</FONT></P></DIV></BODY></HTML>