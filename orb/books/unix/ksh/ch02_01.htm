<HTML><HEAD><TITLE>[Chapter 2] Command-line Editing</TITLE><METANAME="DC.title"CONTENT="Learning the Korn Shell"><METANAME="DC.creator"CONTENT="Bill Rosenblatt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-03T20:55:06Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-054-6"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="index.htm"TITLE="Learning the Korn Shell"><LINKREL="prev"HREF="ch01_09.htm"TITLE="1.9 Special Characters and Quoting"><LINKREL="next"HREF="ch02_02.htm"TITLE="2.2 The History File"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Learning the Korn Shell"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,66"HREF="index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ksrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch01_09.htm"TITLE="1.9 Special Characters and Quoting"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 1.9 Special Characters and Quoting"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 2</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_02.htm"TITLE="2.2 The History File"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.2 The History File"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="KSH-CH2-COMLINE">2. Command-line Editing</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#KSH-CH-2-SECT-0.1"TITLE="2.1 Enabling Command-line Editing">Enabling Command-line Editing</A><BR><ACLASS="sect1"HREF="ch02_02.htm"TITLE="2.2 The History File">The History File</A><BR><ACLASS="sect1"HREF="ch02_03.htm"TITLE="2.3 Emacs Editing Mode">Emacs Editing Mode</A><BR><ACLASS="sect1"HREF="ch02_04.htm"TITLE="2.4 Vi Editing Mode">Vi Editing Mode</A><BR><ACLASS="sect1"HREF="ch02_05.htm"TITLE="2.5 The fc Command">The fc Command</A><BR><ACLASS="sect1"HREF="ch02_06.htm"TITLE="2.6 Finger Habits">Finger Habits</A></P><P></P></DIV><PCLASS="para">It's always possible to make mistakes when you type at acomputer keyboard, but perhaps even more so when you are usinga UNIX shell. UNIX shell syntax is powerful,yet terse, full of odd characters, and not particularly mnemonic, making it possibleto construct command lines that are as cryptic as they arecomplex. The Bourne and C shells exacerbate this situation by givingyou extremely limited ways of editing your command lines.  </P><PCLASS="para">In particular,there is no way to recall a previous command line so that you canfix a mistake. For example, in <ACLASS="xref"HREF="ch07_01.htm"TITLE="Input/Output and Command-line Processing">Chapter 7, Input/Output and Command-line Processing</A> we'll see complex command lines like:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <BCLASS="emphasis.bold">eval cat $srcname | ccom | as | optimize &gt; $objname</B></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2044"></A>If you are an experienced Bourne shell user, undoubtedly youknow the frustration of having to retype lines like this.  You can use the backspace key to edit, but once you hit RETURN,it's gone forever!</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2047"></A>The C shell provided a small improvement via its <EMCLASS="emphasis">history</EM>mechanism, which provides a few very awkward ways of editing previous commands. But there are more than a few peoplewho have wondered, &quot;Why can't I edit my UNIX command lines in the sameway I can edit text with an editor?&quot;</P><PCLASS="para">This is exactly what the Korn shell allows you to do.It has editing modes that allow you to editcommand lines with editing commands similar to those of the two most popularUNIX editors, <EMCLASS="emphasis">vi</EM> and <EMCLASS="emphasis">emacs</EM>.[1]<ACLASS="indexterm"NAME="AUTOID-2057"></A><ACLASS="indexterm"NAME="AUTOID-2060"></A>It also provides amuch-extended analog to the C shell history mechanism called <BCLASS="emphasis.bold">fc</B> (for fix command) that, among other things,allows you to use your favorite editor directly for editingyour command lines.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] For some unknown reason, the documentation on emacs-mode has beenremoved from <EMCLASS="emphasis">ksh</EM>(1) manual pages on some UNIX systems.This does not mean, however,that the mode doesn't exist or doesn't work properly.</P></BLOCKQUOTE><PCLASS="para">In this chapter, we will discuss features common to all of the Korn shell'scommand-history facilities; then we will deal with each suchfacility in detail.If you use <EMCLASS="emphasis">vi</EM> or <EMCLASS="emphasis">emacs</EM>, you may wish to read only the sectionon the emulation mode for the one you use.<ACLASS="indexterm"NAME="AUTOID-2066"></A><ACLASS="indexterm"NAME="AUTOID-2068"></A>[2]If you use neither <EMCLASS="emphasis">vi</EM> or <EMCLASS="emphasis">emacs</EM>,but are interested in learning one of the editing modes anyway,we suggest emacs-mode, because it is more of a natural extensionof the minimal editing capability you get with the bare shell.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] You will get the most out of these sections if you arealready familiar with the editor(s) in question.Good sources for more complete information on the editors arethe O'Reilly &amp; Associates Nutshell Handbooks <EMCLASS="emphasis">Learning the vi Editor</EM>,by Linda Lamb, and <EMCLASS="emphasis">Learning GNU Emacs</EM>, by Debra Cameron andBill Rosenblatt.</P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2077"></A><ACLASS="indexterm"NAME="AUTOID-2080"></A>We should mention up front that both emacs- and vi-modes introduce the potential for clashes with control keys set up bythe UNIX terminal interface. Recall the control keys shown in <ACLASS="xref"HREF="ch01_01.htm"TITLE="Korn Shell Basics">Chapter 1, Korn Shell Basics</A> in <ACLASS="xref"HREF="ch01_09.htm#KSH-CH-1-TAB-6"TITLE="Control Keys">Table 1.7</A> and the sample <EMCLASS="emphasis">stty</EM> command output.The control keys shown there override their functions in the editing modes.  </P><PCLASS="para">During the rest of this chapter, we'll warn youwhen an editing command clashes with the <EMCLASS="emphasis">default setting</EM>of a terminal-interface control key. But if you (or your system administrator) choose to customize your terminal interface, aswe'll show in <ACLASS="xref"HREF="ch08_01.htm"TITLE="Process Handling">Chapter 8, Process Handling</A> you're on your own as far as the editingmodes are concerned.</P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="KSH-CH-2-SECT-0.1">2.1 Enabling Command-line Editing</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="KSH-CH-2-IX-EMACS-MODE-ENABL"></A><ACLASS="indexterm"NAME="KSH-CH-2-IX-VI-MODE-ENABLING"></A>There are two ways of entering either editing mode.<ACLASS="indexterm"NAME="KSH-CH-2-IX-VISUAL"></A><ACLASS="indexterm"NAME="KSH-CH-2-IX-ENV-VARIABLES-VISUAL"></A>First, you can set your editing mode by using the environment variableVISUAL. The Korn shell checks to see if this variable ends with <EMCLASS="emphasis">vi</EM>or <EMCLASS="emphasis">macs</EM>.[3]An excellent way to set VISUAL is to put a line like the following <ACLASS="indexterm"NAME="AUTOID-2109"></A>in your <EMCLASS="emphasis">.profile</EM> or environment file:<ACLASS="indexterm"NAME="AUTOID-2112"></A><ACLASS="indexterm"NAME="AUTOID-2114"></A></P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] GNU Emacs is often installed as <EMCLASS="emphasis">gmacs</EM> or <EMCLASS="emphasis">gnumacs</EM>. </P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">VISUAL=$(whence emacs)</PRE></BLOCKQUOTE></P><PCLASS="para">or</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">VISUAL=$(whence vi)</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2122"></A><ACLASS="indexterm"NAME="AUTOID-2123"></A>As you will find out in <ACLASS="xref"HREF="ch03_01.htm"TITLE="Customizing Your Environment">Chapter 3, Customizing Your Environment</A> and <ACLASS="xref"HREF="ch04_01.htm"TITLE="Basic Shell Programming">Chapter 4, Basic Shell Programming</A> the <BCLASS="emphasis.bold">whence</B>built-in command takes the name of another command as its argument andwrites the command's full pathname onthe standard output; the form <BCLASS="emphasis.bold">$(</B><EMCLASS="emphasis">command</EM><BCLASS="emphasis.bold">)</B>returns the standard output generated by <EMCLASS="emphasis">command</EM> as astring value. Thus, the line above finds outthe full pathname of your favorite editor and stores it in theenvironment variable VISUAL. The advantage ofthis code is that it is portable to other systems, which may havethe executables for editors stored in different directories. </P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2132"></A><ACLASS="indexterm"NAME="AUTOID-2135"></A>The second way of selecting an editing mode is toset the option explicitly with the <BCLASS="emphasis.bold">set -o</B> command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <BCLASS="emphasis.bold">set -o emacs</B></PRE></BLOCKQUOTE></P><PCLASS="para">or</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <BCLASS="emphasis.bold">set -o vi</B></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-2147"></A><ACLASS="indexterm"NAME="AUTOID-2148"></A></P><PCLASS="para">You will find that the vi- and emacs-editing modesare good at emulating the basic commands of these editorsbut not their advanced features; their main purpose is to let you transfer&quot;finger habits&quot; from your favorite editor to the shell.  <ACLASS="indexterm"NAME="AUTOID-2150"></A><ACLASS="indexterm"NAME="AUTOID-2152"></A><BCLASS="emphasis.bold">fc</B> is quite a powerfulfacility; it is mainly meant to supplant C shell history and as an&quot;escape hatch&quot; for users of editors other than <EMCLASS="emphasis">vi</EM> or <EMCLASS="emphasis">emacs</EM>.Therefore the section on <BCLASS="emphasis.bold">fc</B> is mainly recommended to C shellusers and those who don't use either standard editor.</P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch01_09.htm"TITLE="1.9 Special Characters and Quoting"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 1.9 Special Characters and Quoting"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Learning the Korn Shell"><IMGSRC="../gifs/txthome.gif"ALT="Learning the Korn Shell"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_02.htm"TITLE="2.2 The History File"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.2 The History File"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">1.9 Special Characters and Quoting</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">2.2 The History File</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="../upt/index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>