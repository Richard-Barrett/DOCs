<HTML><HEAD><TITLE>[Chapter 2] 2.5 The fc Command</TITLE><METANAME="DC.title"CONTENT="Learning the Korn Shell"><METANAME="DC.creator"CONTENT="Bill Rosenblatt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-03T20:57:36Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-054-6"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch02_01.htm"TITLE="2. Command-line Editing"><LINKREL="prev"HREF="ch02_04.htm"TITLE="2.4 Vi Editing Mode"><LINKREL="next"HREF="ch02_06.htm"TITLE="2.6 Finger Habits"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Learning the Korn Shell"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,66"HREF="index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ksrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_04.htm"TITLE="2.4 Vi Editing Mode"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.4 Vi Editing Mode"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 2<BR>Command-line Editing</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_06.htm"TITLE="2.6 Finger Habits"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.6 Finger Habits"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="KSH-CH-2-SECT-4">2.5 The fc Command</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="KSH-CH-2-IX-FC"></A><ACLASS="indexterm"NAME="AUTOID-3633"></A><BCLASS="emphasis.bold">fc</B> is a shell built-in command that providesa superset of the C shell history mechanism. You can use it to examine the most recent commands you entered, to editone or more commands with your favorite &quot;real&quot; editor, and torun old commands with changes without having to type the entirecommand in again. We'll look at each of these uses.</P><PCLASS="para"><ACLASS="indexterm"NAME="KSH-CH-2-IX-FC-LIST-PREV-CMNDS"></A>The <BCLASS="emphasis.bold">-l</B> option to <BCLASS="emphasis.bold">fc</B> lists previous commands. It takesarguments that refer to commands in the history file. Arguments can be numbers or alphanumeric strings; numbers refer to thecommands in the history file, while strings refer to the most recentcommand beginning with the string.<BCLASS="emphasis.bold">fc</B> treats arguments in a rather complex way:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">If you give two arguments, they serve as the first and lastcommands to be shown.</P></LI><LICLASS="listitem"><PCLASS="para">If you specify one number argument,only the command with that number is shown.  </P></LI><LICLASS="listitem"><PCLASS="para">With a single string argument, it searches for the most recent command startingwith that string and shows you everything from that command to themost recent command.  </P></LI><LICLASS="listitem"><PCLASS="para">If you specify no arguments, you will see the last 16commands you entered. Thus, <BCLASS="emphasis.bold">fc -l</B> by itself is equivalent to theC shell <BCLASS="emphasis.bold">history</B> command, and indeed the Korn shell defines abuilt-in alias <BCLASS="emphasis.bold">history</B> as:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">alias history=fc -l</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3659"></A>As you will find out in <ACLASS="xref"HREF="ch03_01.htm"TITLE="Customizing Your Environment">Chapter 3</A>,this means that you can type <BCLASS="emphasis.bold">history</B> and the Korn shell will run the command <BCLASS="emphasis.bold">fc -l</B>.</P></LI></UL><PCLASS="para">A few examples should make these options clearer. Let's say youlogged in and entered these commands:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">ls -lmore myfilevi myfilewc -l myfilepr myfile | lp -h</PRE></BLOCKQUOTE></P><PCLASS="para">If you type <BCLASS="emphasis.bold">fc -l</B> (or <BCLASS="emphasis.bold">history</B>)with no arguments, you will see the above list withcommand numbers, as in:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">1	ls -l2	more myfile3	vi myfile4	wc -l myfile5	pr myfile | lp -h</PRE></BLOCKQUOTE></P><PCLASS="para">The option <BCLASS="emphasis.bold">-n</B> suppresses the line numbers. If you want to see onlycommands 2 through 4, type <BCLASS="emphasis.bold">fc -l 2 4</B>. If you want to see only the<EMCLASS="emphasis">vi</EM> command, type <BCLASS="emphasis.bold">fc -l 3</B>. To see everything from the<EMCLASS="emphasis">vi</EM> command up to the present, type <BCLASS="emphasis.bold">fc -l v</B>. Finally,if you want to see commands between <EMCLASS="emphasis">more</EM> and <EMCLASS="emphasis">wc</EM>, you cantype <BCLASS="emphasis.bold">fc -l m w</B>, <BCLASS="emphasis.bold">fc -l m 4</B>, <BCLASS="emphasis.bold">fc -l 2 4</B>, etc.</P><PCLASS="para">The <BCLASS="emphasis.bold">-l</B> option to <BCLASS="emphasis.bold">fc</B> is not particularly useful, except as a quickway of remembering what commands you typed recently.  <ACLASS="indexterm"NAME="AUTOID-3687"></A>Use the <BCLASS="emphasis.bold">history</B> alias if you are an experienced C shell user.<ACLASS="indexterm"NAME="AUTOID-3690"></A></P><PCLASS="para"><ACLASS="indexterm"NAME="KSH-CH-2-IX-FC-E-EDIT"></A>The other important option to <BCLASS="emphasis.bold">fc</B> is <BCLASS="emphasis.bold">-e</B> for &quot;edit.&quot; This isuseful as an &quot;escape hatch&quot; from vi- and emacs-modes if youaren't used to either of those editors. You can specify thepathname of your favorite editor and edit commands from yourhistory file; then when you have made the changes, the shellwill actually execute the new lines.</P><PCLASS="para">Let's say your favorite editor is a little home-brew gem called<EMCLASS="emphasis">zed</EM>. You could edit your commands by typing:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <BCLASS="emphasis.bold">fc -e /usr/local/bin/zed</B></PRE></BLOCKQUOTE></P><PCLASS="para">This seems like a lot of work just to fix a typo in yourprevious command; fortunately, there is a better way.<ACLASS="indexterm"NAME="AUTOID-3703"></A><ACLASS="indexterm"NAME="AUTOID-3705"></A>You can set the environment variable FCEDIT to the pathname of theeditor you want <BCLASS="emphasis.bold">fc</B> to use.If you put a line in your <EMCLASS="emphasis">.profile</EM> or environment file saying:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">FCEDIT=/usr/local/bin/zed</PRE></BLOCKQUOTE></P><PCLASS="para">you will get <EMCLASS="emphasis">zed</EM> when you invoke <BCLASS="emphasis.bold">fc</B>. FCEDIT defaults tothe old line editor <EMCLASS="emphasis">ed</EM>, so that the overall default is also <EMCLASS="emphasis">ed</EM>.</P><PCLASS="para"><BCLASS="emphasis.bold">fc</B> is usually used to fix a recent command.Therefore it handles arguments a bit differently than it doesfor the <BCLASS="emphasis.bold">fc -l</B> variation above:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">With no arguments, <BCLASS="emphasis.bold">fc</B> loads the editor with the most recentcommand.  </P></LI><LICLASS="listitem"><PCLASS="para">With a numeric argument, <BCLASS="emphasis.bold">fc</B> loads the editor with the command with that number.  </P></LI><LICLASS="listitem"><PCLASS="para">With a string argument, <BCLASS="emphasis.bold">fc</B> loads the most recent command startingwith that string.</P></LI><LICLASS="listitem"><PCLASS="para">With two arguments to <BCLASS="emphasis.bold">fc</B>, the arguments specify the beginning and end ofa range of commands, as above.</P></LI></UL><PCLASS="para">Remember that <BCLASS="emphasis.bold">fc</B> actually runs the command(s) after youedit them. Therefore the last-named choice can be dangerous.  The Korn shell will attempt to execute all commands in the rangeyou specifywhen you exit your editor. If you have typed in any multilineconstructs (like those we will cover in <ACLASS="xref"HREF="ch05_01.htm"TITLE="Flow Control">Chapter 5, Flow Control</A>)the results could be even more dangerous.<ACLASS="indexterm"NAME="AUTOID-3736"></A>Although these might seem like valid ways of generating&quot;instant shell programs,&quot; a far better strategy would be to directthe output of <BCLASS="emphasis.bold">fc -l</B> with the same arguments to a file; then edit that file and execute the commands when you're satisfiedwith them:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <BCLASS="emphasis.bold">fc -l cp &gt; lastcommands</B>$ <BCLASS="emphasis.bold">vi lastcommands</B>$ <BCLASS="emphasis.bold">. lastcommands</B></PRE></BLOCKQUOTE></P><PCLASS="para">In this case, the shell will not tryto execute the file when you leave the editor!</P><PCLASS="para">There is one final use for <BCLASS="emphasis.bold">fc</B>. If you specify the editor <BCLASS="emphasis.bold">-</B> (i.e., type <BCLASS="emphasis.bold">fc -e -</B>), the Korn shell will skip the editing partand just run the command(s) specified by the argument(s).Why is this useful? For one thing, just typing <BCLASS="emphasis.bold">fc -e -</B>causes the previous command to repeat, just like the C shell<BCLASS="emphasis.bold">!!</B> command.  <ACLASS="indexterm"NAME="AUTOID-3752"></A>The Korn shell provides the built-in alias <BCLASS="emphasis.bold">r</B> for this,so that if you type <BCLASS="emphasis.bold">r</B> and hit <BCLASS="emphasis.bold">RETURN</B>, you will repeatthe last command.</P><PCLASS="para">This form of <BCLASS="emphasis.bold">fc</B> allows yet another type of argument, of theform <EMCLASS="emphasis">old<BCLASS="emphasis.bold">=</B>new</EM>, meaning &quot;change occurrences of <EMCLASS="emphasis">old</EM> in the specifiedprevious command to <EMCLASS="emphasis">new</EM> and then run it.&quot; For example, if you wantedto run a complex command like the following on two sets of files:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <BCLASS="emphasis.bold">tbl ch2.tbl | nroff -mS -Tepson &gt; ch2.out</B></PRE></BLOCKQUOTE></P><PCLASS="para">you can enter the command and then type <BCLASS="emphasis.bold">fc -e - 2=3</B>. (You could also use the alias, <BCLASS="emphasis.bold">r 2=3</B>.) This command would then run:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">tbl ch3.tbl | nroff -mS -Tepson &gt; ch3.out</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3772"></A><ACLASS="indexterm"NAME="AUTOID-3773"></A></P></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_04.htm"TITLE="2.4 Vi Editing Mode"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.4 Vi Editing Mode"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Learning the Korn Shell"><IMGSRC="../gifs/txthome.gif"ALT="Learning the Korn Shell"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_06.htm"TITLE="2.6 Finger Habits"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.6 Finger Habits"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">2.4 Vi Editing Mode</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">2.6 Finger Habits</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="../upt/index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>