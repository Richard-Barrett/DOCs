<HTML><HEAD><TITLE>[Chapter 8] 8.2 Job Control</TITLE><METANAME="DC.title"CONTENT="Learning the Korn Shell"><METANAME="DC.creator"CONTENT="Bill Rosenblatt"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-03T21:14:55Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-054-6"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch08_01.htm"TITLE="8. Process Handling"><LINKREL="prev"HREF="ch08_01.htm"TITLE="8.1 Process IDs and Job Numbers"><LINKREL="next"HREF="ch08_03.htm"TITLE="8.3 Signals"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Learning the Korn Shell"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,66"HREF="index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/ksrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_01.htm"TITLE="8.1 Process IDs and Job Numbers"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.1 Process IDs and Job Numbers"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 8<BR>Process Handling</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_03.htm"TITLE="8.3 Signals"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.3 Signals"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="KSH-CH-8-SECT-2">8.2 Job Control</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="KSH-CH-8-IX-JOB-CONTROL"></A>Why should you care about process IDs or job numbers? Actually, youcould probably get along fine through your UNIX life without everreferring to process IDs (unless you use a windowing workstation-aswe'll see soon). Job numbers are more important, however:you can use them with the shell commands for <EMCLASS="emphasis">job control</EM>.[2]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] <ACLASS="indexterm"NAME="AUTOID-13312"></A><ACLASS="indexterm"NAME="AUTOID-13316"></A><ACLASS="indexterm"NAME="AUTOID-13320"></A><ACLASS="indexterm"NAME="AUTOID-13324"></A><ACLASS="indexterm"NAME="AUTOID-13328"></A><ACLASS="indexterm"NAME="AUTOID-13331"></A><ACLASS="indexterm"NAME="AUTOID-13333"></A><ACLASS="indexterm"NAME="AUTOID-13335"></A><ACLASS="indexterm"NAME="AUTOID-13337"></A><ACLASS="indexterm"NAME="AUTOID-13340"></A><ACLASS="indexterm"NAME="AUTOID-13343"></A><ACLASS="indexterm"NAME="AUTOID-13345"></A><BCLASS="emphasis.bold">NOTE:</B> If you have an older version of UNIX, it is possible that your system does not support job control. This is particularly true for many systems derived from Xenix, System III, or early versions of System V. On such systems, the Korn shell does not have the <BCLASS="emphasis.bold">fg</B> and <BCLASS="emphasis.bold">bg</B> commands, you can't type <KBDCLASS="keycap">[CTRL-Z]</KBD> to suspend a job, and the TSTP signal doesn't exist. The shell does, however, support everything else discussed here, including job numbers and the <BCLASS="emphasis.bold">jobs</B> and <BCLASS="emphasis.bold">kill</B> commands, if monitor mode is on. To ensure this, put the line <BCLASS="emphasis.bold">set -o monitor</B> in your <EMCLASS="emphasis">.profile</EM> file.</P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13357"></A>You already know the most obvious way of controlling a job:you can create one in the background with <BCLASS="emphasis.bold">&amp;</B>.  <ACLASS="indexterm"NAME="AUTOID-13361"></A>Once a job is running in the background, you can let it run to completion, bring it into the <EMCLASS="emphasis">foreground</EM>, or sendit a message called a <EMCLASS="emphasis">signal</EM>.  </P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="KSH-CH-8-SECT-2.1">8.2.1 Foreground and Background</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13368"></A>The built-in command <BCLASS="emphasis.bold">fg</B> brings a background job into the foreground.Normally this means that the job will have control of your terminalor window and therefore will be able to accept your input. In other words,the job will begin to act as if you typed its command without the<BCLASS="emphasis.bold">&amp;</B>.</P><PCLASS="para">If you have only one background job running, you can use <BCLASS="emphasis.bold">fg</B> withoutarguments, and the shell will bring that job into the foreground.But if you have several running in the background, the shell will pickthe one that you put into the background most recently.  <ACLASS="indexterm"NAME="AUTOID-13374"></A><ACLASS="indexterm"NAME="AUTOID-13378"></A>If youwant some other job put into the foreground, you need to use the job'scommand name, preceded by a percent sign (%), or you can use itsjob number, also preceded by %, or its process ID without a percent sign.  <ACLASS="indexterm"NAME="AUTOID-13381"></A>If you don't remember which jobs are running, you can use the command <BCLASS="emphasis.bold">jobs</B> to list them.</P><PCLASS="para">A few examples should make this clearer. Let's say you created three background jobs as above. Then if you type <BCLASS="emphasis.bold">jobs</B>, you will see this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">[1]   Running                  fred &amp;[2] - Running                  bob &amp;[3] + Running                  dave &amp;</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13390"></A><BCLASS="emphasis.bold">jobs</B> has a few interesting options. <BCLASS="emphasis.bold">jobs -l</B> alsolists process IDs:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">[1]   2349      Running                  fred &amp;[2] - 2367      Running                  bob &amp;[3] + 2382      Running                  dave &amp;</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13399"></A><ACLASS="indexterm"NAME="AUTOID-13400"></A>The <BCLASS="emphasis.bold">-p</B> option tells <BCLASS="emphasis.bold">jobs</B> to list <EMCLASS="emphasis">only</EM> process IDs:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">234923672382</PRE></BLOCKQUOTE></P><PCLASS="para">This could be useful with command substitution; see Task 8-1 below.<ACLASS="indexterm"NAME="AUTOID-13410"></A>Finally, the <BCLASS="emphasis.bold">-n</B> option lists only those jobs whose status has changedsince the shell last reported it&nbsp;- whether with a <BCLASS="emphasis.bold">jobs</B> command or otherwise.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13417"></A>If you type <BCLASS="emphasis.bold">fg</B> without an argument, the shell will put <BCLASS="emphasis.bold">dave</B>in the foreground, because it was put in the background most recently.But if you type <BCLASS="emphasis.bold">fg %bob</B> (or <BCLASS="emphasis.bold">fg %2</B>),<BCLASS="emphasis.bold">bob</B> will go in the foreground.</P><PCLASS="para"><ACLASS="indexterm"NAME="KSH-CH-8-IX-PERCENT-SPECIFYING-JOBS"></A><ACLASS="indexterm"NAME="AUTOID-13428"></A><ACLASS="indexterm"NAME="AUTOID-13432"></A>You can also refer to the job most recently put in the backgroundby <BCLASS="emphasis.bold">%+</B>. Similarly, <BCLASS="emphasis.bold">%i-</B> refers to the backgroundjob invoked <EMCLASS="emphasis">next</EM>-most-recently (<BCLASS="emphasis.bold">bob</B>in this case).  <ACLASS="indexterm"NAME="AUTOID-13440"></A>That explains the plus and minus signs in the above:the plus sign shows the most recently invoked job; the minussign shows the next-most-recently invoked job.[3]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[3] <ACLASS="indexterm"NAME="AUTOID-13446"></A>This is analogous to <BCLASS="emphasis.bold">~+</B> and <BCLASS="emphasis.bold">~-</B> as references to thecurrently and previous directory; see the footnote in <ACLASS="xref"HREF="ch07_01.htm"TITLE="Input/Output and Command-line Processing">Chapter 7, Input/Output and Command-line Processing</A>. Also: <BCLASS="emphasis.bold">%%</B> is a synonym for <BCLASS="emphasis.bold">%+</B>.</P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13456"></A>If more than one background job has the same command, then<BCLASS="emphasis.bold">%</B><EMCLASS="emphasis">command</EM> will disambiguate by choosing the most recentlyinvokedjob (as you'd expect). If this isn't what you want, you need to usethe job number instead of the command name.  <ACLASS="indexterm"NAME="AUTOID-13462"></A>However, if the commandshave different <EMCLASS="emphasis">arguments</EM>, you can use <BCLASS="emphasis.bold">%</B><CODECLASS="literal">?</CODE><EMCLASS="emphasis">string</EM>instead of <BCLASS="emphasis.bold">%</B><EMCLASS="emphasis">command</EM>. <BCLASS="emphasis.bold">%</B><CODECLASS="literal">?</CODE><EMCLASS="emphasis">string</EM> refers to thejob whose command contains the string. For example, assume you started these background jobs:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <BCLASS="emphasis.bold">bob pete &amp;</B> [1]     189$ <BCLASS="emphasis.bold">bob ralph &amp;</B> [2]     190$</PRE></BLOCKQUOTE></P><PCLASS="para">Then you can use <BCLASS="emphasis.bold">%</B><CODECLASS="literal">?</CODE><BCLASS="emphasis.bold">pete</B>and <BCLASS="emphasis.bold">%</B><CODECLASS="literal">?</CODE><BCLASS="emphasis.bold">ralph</B> to refer to each of them, although actually <BCLASS="emphasis.bold">%</B><CODECLASS="literal">?</CODE><BCLASS="emphasis.bold">pe</B> and <BCLASS="emphasis.bold">%</B><CODECLASS="literal">?</CODE><BCLASS="emphasis.bold">ra</B> are sufficient to disambiguate.</P><PCLASS="para"><ACLASS="xref"HREF="ch08_02.htm#KSH-CH-8-TAB-0"TITLE="Ways to Refer to Background Jobs">Table 8.1</A>lists all of the ways to refer to background jobs.We have found that, given how infrequently people use job control commands, job numbers or command names are sufficient, and the other waysare superfluous.<ACLASS="indexterm"NAME="AUTOID-13494"></A><ACLASS="indexterm"NAME="AUTOID-13498"></A><ACLASS="indexterm"NAME="AUTOID-13502"></A><ACLASS="indexterm"NAME="AUTOID-13506"></A><ACLASS="indexterm"NAME="AUTOID-13510"></A><ACLASS="indexterm"NAME="AUTOID-13514"></A></P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="KSH-CH-8-TAB-0">Table 8.1: Ways to Refer to Background Jobs</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Reference</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Background job</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BCLASS="emphasis.bold">%</B><EMCLASS="emphasis">N</EM></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Job number <EMCLASS="emphasis">N</EM></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BCLASS="emphasis.bold">%</B><EMCLASS="emphasis">string</EM></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Job whose command begins with <EMCLASS="emphasis">string</EM></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BCLASS="emphasis.bold">%</B>?<EMCLASS="emphasis">string</EM></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Job whose command contains <EMCLASS="emphasis">string</EM></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BCLASS="emphasis.bold">%+</B></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Most recently invoked background job</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BCLASS="emphasis.bold">%%</B></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Same as above</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BCLASS="emphasis.bold">%</B>-</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Second-most recently invoked background job</TD></TR></TBODY></TABLE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13557"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="KSH-CH-8-SECT-2.2">8.2.2 Suspending a Job</A></H3><PCLASS="para"><ACLASS="indexterm"NAME="KSH-CH-8-IX-JOBS-SUSPENDING"></A><ACLASS="indexterm"NAME="AUTOID-13564"></A>Just as you can put background jobs into the foreground with <BCLASS="emphasis.bold">fg</B>,you can also put a foreground job into the background.This involves suspending a job, so that the shell regains controlof your terminal.</P><PCLASS="para"><ACLASS="indexterm"NAME="KSH-CH-8-IX-CTRL-Z"></A>To suspend a job, type <KBDCLASS="keycap">[CTRL-Z]</KBD>[4]while it is running.  <ACLASS="indexterm"NAME="AUTOID-13577"></A>This is analogous to typing <KBDCLASS="keycap">[CTRL-C]</KBD> (or whateveryour interrupt key is), except that you can resume the jobafter you have stopped it. When you type <KBDCLASS="keycap">[CTRL-Z]</KBD>, the shell responds witha message like this:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[4] <ACLASS="indexterm"NAME="AUTOID-13573"></A>This assumes that the <KBDCLASS="keycap">[CTRL-Z]</KBD> key is set up as your suspend key; just as with <KBDCLASS="keycap">[CTRL-C]</KBD> and interrupts, this isconventional but by no means required.  </P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">[1] + Stopped                   <CODECLASS="replaceable"><I>command</I></CODE> </PRE></BLOCKQUOTE></P><PCLASS="para">Then it gives you your prompt back.<ACLASS="indexterm"NAME="AUTOID-13585"></A></P><PCLASS="para"><ACLASS="indexterm"NAME="KSH-CH-8-IX-FG-TO-RESUME-SUSPENDED-JOBS"></A><ACLASS="indexterm"NAME="KSH-CH-8-IX-JOBS-RESUMING"></A>To resume a suspended job so that it continues to runin the foreground, just type <BCLASS="emphasis.bold">fg</B>. If, for some reason,you put other jobs in the background after you typed <BCLASS="emphasis.bold"><KBDCLASS="keycap">[CTRL-Z]</KBD></B>, use <BCLASS="emphasis.bold">fg</B>with a job name or number. For example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><EMCLASS="emphasis">fred is running...</EM> <BCLASS="emphasis.bold">CTRL-Z</B> [1] + Stopped                   fred$ <BCLASS="emphasis.bold">bob &amp;</B> [2]     bob &amp;$ <BCLASS="emphasis.bold">fg %fred</B> <EMCLASS="emphasis">fred resumes in the foreground...</EM> </PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13605"></A>The ability to suspend jobs and resume them in the foregroundcomes in very handy when you have a conventional terminal(as opposed to a windowing workstation) andyou are using a text editor like <EMCLASS="emphasis">vi</EM> on a file that needs to be processed.<ACLASS="indexterm"NAME="AUTOID-13608"></A>For example, if you are editing a file for the <EMCLASS="emphasis">troff</EM>text processor, you can do the following:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <BCLASS="emphasis.bold">vi myfile</B> <EMCLASS="emphasis">edit the file...</EM>  <BCLASS="emphasis.bold">CTRL-Z</B> Stopped [1] vi$ <BCLASS="emphasis.bold">troff myfile</B> <EMCLASS="emphasis">troff reports an error</EM> $ <BCLASS="emphasis.bold">fg</B> <EMCLASS="emphasis">vi comes back up in the same place in your file</EM> </PRE></BLOCKQUOTE></P><PCLASS="para">Programmers often use the same technique when debugging source code.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13622"></A><ACLASS="indexterm"NAME="AUTOID-13623"></A>You will probably also find it useful to suspend a job and resume itin the background instead of the foreground.<ACLASS="indexterm"NAME="AUTOID-13628"></A><ACLASS="indexterm"NAME="AUTOID-13630"></A>You may start a command in the foreground (i.e., normally) and find that it takesmuch longer than you expected-for example, a <EMCLASS="emphasis">grep</EM>, <EMCLASS="emphasis">sort</EM>, or database query.  <ACLASS="indexterm"NAME="AUTOID-13634"></A>You need the command to finish, but you wouldalso like control of your terminal back so that you can do other work.If you type <BCLASS="emphasis.bold"><KBDCLASS="keycap">[CTRL-Z]</KBD></B> followed by <BCLASS="emphasis.bold">bg</B>, you will move the job to thebackground.  <ACLASS="indexterm"NAME="AUTOID-13639"></A>[5]<ACLASS="indexterm"NAME="AUTOID-13646"></A><ACLASS="indexterm"NAME="AUTOID-13647"></A></P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[5] <ACLASS="indexterm"NAME="AUTOID-13642"></A>Be warned, however, that not all commands are &quot;well-behaved&quot;when you do this. Be especially careful with commands that run overa network on a remote machine; you may end up &quot;confusing&quot; the remoteprogram.</P></BLOCKQUOTE></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_01.htm"TITLE="8.1 Process IDs and Job Numbers"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 8.1 Process IDs and Job Numbers"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Learning the Korn Shell"><IMGSRC="../gifs/txthome.gif"ALT="Learning the Korn Shell"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch08_03.htm"TITLE="8.3 Signals"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 8.3 Signals"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">8.1 Process IDs and Job Numbers</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">8.3 Signals</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="../upt/index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>