<HTML><HEAD><TITLE>[Chapter 1] 1.4 Using Pipes to Create a New Tool </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:30:56Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch01_01.htm"TITLE="1. Introduction"><LINKREL="prev"HREF="ch01_03.htm"TITLE="1.3 Programs Are Designed to Work Together "><LINKREL="next"HREF="ch01_05.htm"TITLE="1.5 Anyone Can Program the Shell "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch01_03.htm"TITLE="1.3 Programs Are Designed to Work Together "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 1.3 Programs Are Designed to Work Together "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 1<BR>Introduction</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch01_05.htm"TITLE="1.5 Anyone Can Program the Shell "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 1.5 Anyone Can Program the Shell "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-1032">1.4 Using Pipes to Create a New Tool </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-797"></A>It's easy enough to imagine a trivial use of<SPANCLASS="link">pipes (<ACLASS="linkend"HREF="ch01_03.htm"TITLE="Programs Are Designed to Work Together ">1.3</A>)</SPAN>.Forexample, whenever the output of a command is longer than willfit on a single screen, you might want to pipe to a pagerprogram such as<ACLASS="indexterm"NAME="AUTOID-801"></A><SPANCLASS="link"><EMCLASS="emphasis">more</EM> (<ACLASS="linkend"HREF="ch25_03.htm"TITLE="Using more to Page Through Files ">25.3</A>)</SPAN>,which shows the output a screenful at a time,and waits for you to press a key before it shows the nextscreen.If you were a writer like me, and wanted to checkeach &quot;which&quot; that you wrote to find out if any of themshould have been &quot;that,&quot; you might use the search program<ACLASS="indexterm"NAME="AUTOID-806"></A><SPANCLASS="link"><EMCLASS="emphasis">grep</EM> (<ACLASS="linkend"HREF="ch27_01.htm#UPT-ART-7420"TITLE="Different Versions of grep ">27.1</A>)</SPAN>and type:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch26_04.htm"TITLE="26.4 Using Metacharacters in Regular Expressions ">[Ww]</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>grep '[Ww]hich' chapter1 | more</B></CODE></PRE></TD></TR></TABLE></P><PCLASS="para">(Article<ACLASS="xref"HREF="ch13_01.htm#UPT-ART-1023"TITLE="Using Standard Input and Output">13.1</A>has more about pipes.)<EMCLASS="emphasis">more</EM> lets you see the output a screenful at a time.</P><PCLASS="para">However, if you want to see how pipes can be really useful, youneed to be a little more ambitious, or maybe just have a morespecialized problem.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-820"></A><ACLASS="indexterm"NAME="AUTOID-823"></A>For example, the<SPANCLASS="link"><EMCLASS="emphasis">troff</EM> (<ACLASS="linkend"HREF="ch43_13.htm"TITLE="The Text Formatters nroff, troff, ditroff, ... ">43.13</A>)</SPAN>formatting package(used in our office for typesetting some of our books)includes an indexing feature that allows the user toenter indexing commands of the following form:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">.XX &quot;topic, subtopic&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">When the document is printed, the formattingpackage collects these entries, adds page numbers,and assembles the index.It is important that allentries be consistent.For example, if at one point the user makes the entry:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">.XX &quot;Indexing, introduction to&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">and at another point:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">.XX &quot;Index, introduction to&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">the program will generate two separate entriesrather than merging them into one entry with twopage references.</P><PCLASS="para">In order to check the consistency of indexentries, one could enter the following command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cat </B></CODE><CODECLASS="replaceable"><I>files</I></CODE><CODECLASS="userinput"><B> | grep .XX | sort -u | more</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-844"></A><ACLASS="indexterm"NAME="AUTOID-848"></A><ACLASS="indexterm"NAME="AUTOID-851"></A><ACLASS="indexterm"NAME="AUTOID-854"></A><ACLASS="indexterm"NAME="AUTOID-858"></A>In this command, <EMCLASS="emphasis">files</EM> is a list of the files to be checked.<EMCLASS="emphasis">grep</EM>searches through that text for a specified string or pattern.[1]<SPANCLASS="link"><EMCLASS="emphasis">sort -u</EM> (<ACLASS="linkend"HREF="ch36_06.htm"TITLE="Miscellaneous sort Hints ">36.6</A>)</SPAN>puts the lines selected by <EMCLASS="emphasis">grep</EM> in alphabetical order andremoves duplicate lines.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] The pattern is a<SPANCLASS="link">regular expression (<ACLASS="linkend"HREF="ch26_04.htm"TITLE="Using Metacharacters in Regular Expressions ">26.4</A>)</SPAN>in which a dot (<CODECLASS="literal">.</CODE>) stands for &quot;any character.&quot;To be precise, use the command <CODECLASS="literal">grep&nbsp;'^\.XX'</CODE> instead.</P></BLOCKQUOTE><PCLASS="para">The pipeline is started with the<SPANCLASS="link"><EMCLASS="emphasis">cat</EM> (<ACLASS="linkend"HREF="ch25_02.htm"TITLE="Four Ways to Skin a cat ">25.2</A>)</SPAN>command,which simply types the files' contents so that theinput to the pipeline will be a single, continuousstream of text.(Otherwise <EMCLASS="emphasis">grep</EM> will print the nameof the file in which the string is found, which willkeep the lines from being sorted correctly.In some versions of <EMCLASS="emphasis">grep</EM>, the <EMCLASS="emphasis">-h</EM> option can be used tosuppress filenames.To see if this works on your UNIX system, type<CODECLASS="literal">grep&nbsp;-h&nbsp;.XX&nbsp;</CODE><CODECLASS="replaceable"><I>files</I></CODE>,omitting <EMCLASS="emphasis">cat</EM> and the pipe.)</P><PCLASS="para">This is a very specific&nbsp;- and normally verytedious&nbsp;- job that needs to be done.And because UNIX provides general-purpose tools and an easyway of using them together in a kind of assemblyline, you are provided a relatively simple way to getthe job done.&#13;</P><PCLASS="para">But...</P><PCLASS="para">&quot;Ugh!&quot; you say, &quot;That's just what I hate about UNIX. Allthese long filenames and options I can't remember. Who wantsto type all that stuff!&quot;</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-884"></A>Precisely. That's why UNIX makes it so easy to create customcommands, in the form of<SPANCLASS="link">aliases (<ACLASS="linkend"HREF="ch10_02.htm"TITLE="Aliases for Common Commands ">10.2</A>)</SPAN>,<SPANCLASS="link">shell functions (<ACLASS="linkend"HREF="ch10_09.htm"TITLE="Shell Functions ">10.9</A>)</SPAN>,and<SPANCLASS="link">shell scripts (<ACLASS="linkend"HREF="ch01_05.htm"TITLE="Anyone Can Program the Shell ">1.5</A>)</SPAN>.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">TOR</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch01_03.htm"TITLE="1.3 Programs Are Designed to Work Together "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 1.3 Programs Are Designed to Work Together "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch01_05.htm"TITLE="1.5 Anyone Can Program the Shell "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 1.5 Anyone Can Program the Shell "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">1.3 Programs Are Designed to Work Together </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">1.5 Anyone Can Program the Shell </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>