<HTML><HEAD><TITLE>[Chapter 2] 2.7 C Shell Setup Files Aren't Read When You Want Them to Be? </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:32:04Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch02_01.htm"TITLE="2. Logging In"><LINKREL="prev"HREF="ch02_06.htm"TITLE="2.6 Use Absolute Pathnames in Shell Setup Files "><LINKREL="next"HREF="ch02_08.htm"TITLE="2.8 Identifying Login Shells "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_06.htm"TITLE="2.6 Use Absolute Pathnames in Shell Setup Files "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.6 Use Absolute Pathnames in Shell Setup Files "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 2<BR>Logging In</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_08.htm"TITLE="2.8 Identifying Login Shells "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.8 Identifying Login Shells "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-1080">2.7 C Shell Setup Files Aren't Read When You Want Them to Be? </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3161"></A><ACLASS="indexterm"NAME="AUTOID-3164"></A>The C shell reads its <EMCLASS="emphasis">.cshrc</EM>, <EMCLASS="emphasis">.login</EM>, and <EMCLASS="emphasis">.logout</EM> setupfiles<SPANCLASS="link">at particular times (<ACLASS="linkend"HREF="ch02_02.htm"TITLE="Shell Setup Files-Which, Where, and Why ">2.2</A>)</SPAN>.Only<SPANCLASS="link">&quot;login&quot; C shells (<ACLASS="linkend"HREF="ch02_08.htm"TITLE="Identifying Login Shells ">2.8</A>)</SPAN>will read the <EMCLASS="emphasis">.login</EM> and <EMCLASS="emphasis">.logout</EM> files.  Back when<EMCLASS="emphasis">csh</EM> was designed, this restriction worked fine.  The shell thatstarted as you logged in was flagged as a login shell, and it read allthree files.  You started other shells (shell escapes, shell scripts,etc.) from that login shell, and they would read only <EMCLASS="emphasis">.cshrc</EM>.</P><PCLASS="para">Now, UNIX has interactive shells started by window systems (like<SPANCLASS="link"><EMCLASS="emphasis">xterm</EM> (<ACLASS="linkend"HREF="ch01_31.htm"TITLE="The X Window System ">1.31</A>)</SPAN>),remote shells (like<SPANCLASS="link"><EMCLASS="emphasis">rsh</EM> (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>),and other shells that might need some things set from the<EMCLASS="emphasis">.login</EM> or <EMCLASS="emphasis">.logout</EM> files.  Depending on how theseshells are invoked, these might not be login shells&nbsp;- so they mightread only <EMCLASS="emphasis">.cshrc</EM>.  How can you handle that?  Putting<ACLASS="indexterm"NAME="AUTOID-3184"></A><ACLASS="indexterm"NAME="AUTOID-3186"></A>all your setup commands in <EMCLASS="emphasis">.cshrc</EM> isn't good because all<SPANCLASS="link">subshells (<ACLASS="linkend"HREF="ch38_04.htm"TITLE="Subshells ">38.4</A>)</SPAN>read it... you definitely don't want to run terminal-setting commandslike <EMCLASS="emphasis">tset</EM> during shell escapes!</P><PCLASS="para">To handle problems at login time, put almost all of your setupcommands in <EMCLASS="emphasis">.cshrc</EM> instead of <EMCLASS="emphasis">.login</EM>.  After the&quot;login-only&quot; commands have been read from <EMCLASS="emphasis">.cshrc</EM>, set the<EMCLASS="emphasis">ENV_SET</EM><SPANCLASS="link">environment variable (<ACLASS="linkend"HREF="ch06_01.htm#UPT-ART-1170"TITLE="What Environment Variables Are Good For ">6.1</A>)</SPAN>as a flag.(There's nothing special about this name.You can pick any name you want.)</P><PCLASS="para">The shell will copy the &quot;flag&quot; variable to subshells and the<EMCLASS="emphasis">.cshrc</EM> can test for it&nbsp;- if the variable exists, the login-onlycommands are skipped.  That'll keep the commands from being read againin a shell escape.</P><PCLASS="para">Here are parts of a <EMCLASS="emphasis">.cshrc</EM> that show the idea:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch47_03.htm"TITLE="47.3 Conditional Statements with if ">if</A> <ACLASS="co"HREF="ch47_04.htm"TITLE="47.4 C Shell Variable Operators and Expressions ">$?</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">...<EMCLASS="emphasis">Normal .cshrc stuff</EM>...if ($?prompt &amp;&amp; ! $?ENV_SET) then    # Do commands that used to go in .login file:    setenv EDITOR /usr/ucb/vi    tset        ...    setenv ENV_SET doneendif</PRE></TD></TR></TABLE></P><PCLASS="para"></P><PCLASS="para">You should put a comment in the <EMCLASS="emphasis">.login</EM> file to explainwhat you've done.</P><PCLASS="para">The <EMCLASS="emphasis">.logout</EM> file should probably be read only once&nbsp;- when your last(&quot;top-level&quot;) shell exits.If your top-level shell isn't a login shell, you can make it read <EMCLASS="emphasis">.logout</EM>anyway. Here's how.First, along with the previous fixes to your <EMCLASS="emphasis">.cshrc</EM> file, add an aliasthat will read your <EMCLASS="emphasis">.logout</EM> file when you use the <EMCLASS="emphasis">exit</EM> command.Also set the<SPANCLASS="link"><EMCLASS="emphasis">ignoreeof</EM> variable (<ACLASS="linkend"HREF="ch03_05.htm"TITLE="Stop Accidental C Shell Logouts ">3.5</A>)</SPAN>to force you to use the <EMCLASS="emphasis">exit</EM>command when you log out.Now the chunk of your <EMCLASS="emphasis">.cshrc</EM> will look like:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch10_06.htm"TITLE="10.6 Avoiding C Shell Alias Loops ">&quot;&quot;exit</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">if ($?prompt &amp;&amp; ! $?ENV_SET) then        ...    # Make all top-level interactive shells read .logout file:    set ignoreeof    alias exit 'source ~/.logout; &quot;&quot;exit'        ...endif</PRE></TD></TR></TABLE></P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_06.htm"TITLE="2.6 Use Absolute Pathnames in Shell Setup Files "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.6 Use Absolute Pathnames in Shell Setup Files "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_08.htm"TITLE="2.8 Identifying Login Shells "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.8 Identifying Login Shells "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">2.6 Use Absolute Pathnames in Shell Setup Files </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">2.8 Identifying Login Shells </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>