<HTML><HEAD><TITLE>[Chapter 2] 2.12 Automatic Setups for Different Terminals </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:32:12Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch02_01.htm"TITLE="2. Logging In"><LINKREL="prev"HREF="ch02_11.htm"TITLE="2.11 Faster ksh and bash Startup with $- Test "><LINKREL="next"HREF="ch02_13.htm"TITLE="2.13 A .cshrc.$HOST File for Per Host Setup "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_11.htm"TITLE="2.11 Faster ksh and bash Startup with $- Test "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.11 Faster ksh and bash Startup with $- Test "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 2<BR>Logging In</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_13.htm"TITLE="2.13 A .cshrc.$HOST File for Per Host Setup "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.13 A .cshrc.$HOST File for Per Host Setup "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0321">2.12 Automatic Setups for Different Terminals </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3442"></A>If you work at several kinds of terminals, terminal setup can be tough.For instance, my X terminal sends a backspace character when I push theupper-right key, but the same key on another terminal sends a delete character-Iwant<SPANCLASS="link"><EMCLASS="emphasis">stty&nbsp;erase</EM> (<ACLASS="linkend"HREF="ch05_09.htm"TITLE="Setting Your Erase, Kill, and Interrupt Characters ">5.9</A>)</SPAN>to set the right erase character automatically.Maybe you want a full set of calendar programs started when you log in tothe terminal at your desk, but not when you make<SPANCLASS="link">a quickie login (<ACLASS="linkend"HREF="ch02_05.htm"TITLE="Tips for Speeding up Slow Logins ">2.5</A>)</SPAN>from somewhere else.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3449"></A><ACLASS="indexterm"NAME="AUTOID-3452"></A><ACLASS="indexterm"NAME="AUTOID-3455"></A><ACLASS="indexterm"NAME="AUTOID-3457"></A>Here are some ideas for changing your login sequence automatically.Some examples are for the C shell and use that shell's<SPANCLASS="link"><EMCLASS="emphasis">switch</EM> (<ACLASS="linkend"HREF="ch47_06.htm"TITLE="Quick Reference: C Shell switch Statement ">47.6</A>)</SPAN>and<SPANCLASS="link"><EMCLASS="emphasis">if</EM> (<ACLASS="linkend"HREF="ch47_03.htm"TITLE="Conditional Statements with if ">47.3</A>)</SPAN>.Examples for Bourne-type shells use<SPANCLASS="link"><EMCLASS="emphasis">case</EM> (<ACLASS="linkend"HREF="ch44_05.htm"TITLE="Test String Values with Bourne Shell case ">44.5</A>)</SPAN>and<SPANCLASS="link"><EMCLASS="emphasis">if</EM> (<ACLASS="linkend"HREF="ch44_08.htm"TITLE="Test Exit Status with the if Statement ">44.8</A>)</SPAN>.If you use the other type of shell, the idea still applies; just switchthe syntax.</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3471"></A>If all you want to do is initialize your terminal (set the<SPANCLASS="link"><EMCLASS="emphasis">TERM</EM> variable (<ACLASS="linkend"HREF="ch05_10.htm"TITLE="Finding What Terminal Names You Can Use ">5.10</A>)</SPAN>,set your erase character, etc.),the<SPANCLASS="link"><EMCLASS="emphasis">tset</EM> (<ACLASS="linkend"HREF="ch05_03.htm"TITLE="Setting the Terminal Type When You Log In ">5.3</A>)</SPAN>command may be all you need.</P></LI><LICLASS="listitem"><PCLASS="para">If your <EMCLASS="emphasis">TERM</EM> environment variable is set differently on each terminal,you can add a test like this to your <EMCLASS="emphasis">.login</EM> file:<ACLASS="indexterm"NAME="AUTOID-3481"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">switch ($TERM)case vt100:   <ICLASS="lineannotation">...do commands for vt100</I>   breakswcase <CODECLASS="replaceable"><I>xxx</I></CODE>:   <ICLASS="lineannotation">...do commands for xxx</I>   breakswdefault:   <ICLASS="lineannotation">...do commands for other terminals</I>   breakswendsw</PRE></BLOCKQUOTE></P><PCLASS="para">and so on.</P></LI><LICLASS="listitem"><PCLASS="para">If you<SPANCLASS="link">log in from other hosts (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>or from hosts running the<ACLASS="indexterm"NAME="AUTOID-3493"></A><ACLASS="indexterm"NAME="AUTOID-3495"></A><SPANCLASS="link">X window system (<ACLASS="linkend"HREF="ch01_31.htm"TITLE="The X Window System ">1.31</A>)</SPAN>,the <EMCLASS="emphasis">who am i</EM> command will probably show a hostname and/or windowinformation in parentheses:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">bash$ <CODECLASS="userinput"><B>who am i</B></CODE>jpeek    pts/6        Jul 17 10:30   (www.jpeek.com:0.0)</PRE></BLOCKQUOTE></P><PCLASS="para">(Long hostnames may be truncated.Check yours before you write this test.)If the information in parentheses will help,add commands like these to your <EMCLASS="emphasis">.profile</EM> file:<ACLASS="indexterm"NAME="AUTOID-3504"></A></P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch44_05.htm"TITLE="44.5 Test String Values with Bourne Shell case ">case</A> <ACLASS="co"HREF="ch34_10.htm"TITLE="34.10 Referencing Portions of a Search String ">\(..\)  \1</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">case &quot;`who am i | sed -n 's/.*(\(.*\))/\1/p'`&quot; in*0.0)   <ICLASS="lineannotation">...do commands for X display 0</I> ;;mac2*)  <ICLASS="lineannotation">...do commands for the host mac2.foo.com</I> ;;&quot;&quot;)     <ICLASS="lineannotation">...no output (probably not a remote login)</I> ;;*)      <ICLASS="lineannotation">...do commands for other situations</I> ;;esac</PRE></TD></TR></TABLE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3515"></A>That uses <SPANCLASS="link"><EMCLASS="emphasis">sed</EM> (<ACLASS="linkend"HREF="ch34_24.htm"TITLE="Quick Reference: sed ">34.24</A>)</SPAN>to givethe text between the parentheses for that remote host to the <CODECLASS="literal">case</CODE>.This <CODECLASS="literal">*0.0</CODE> case matches lines ending with <CODECLASS="literal">0.0</CODE>, the<CODECLASS="literal">mac2</CODE> case matches lines that start with <CODECLASS="literal">mac2</CODE>,an empty string means <EMCLASS="emphasis">sed</EM> probably didn't find any parentheses,and the <CODECLASS="literal">*</CODE> case catches everything else.</P></LI><LICLASS="listitem"><PCLASS="para">If you know that certain port numbers are used for certain kinds oflogins, you can test that.For example, many systems use <EMCLASS="emphasis">ttyp0</EM>, <EMCLASS="emphasis">ttyq1</EM>, etc. as networkports for<ACLASS="indexterm"NAME="AUTOID-3530"></A><ACLASS="indexterm"NAME="AUTOID-3532"></A><SPANCLASS="link"><EMCLASS="emphasis">rlogin</EM> and <EMCLASS="emphasis">telnet</EM> (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>.This test will branch on the port name:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">case &quot;`tty`&quot; in/dev/tty[pqrs]?)   # rlogin, telnet:   .../dev/tty02)   # terminal on my desk:   ...&quot;not a tty&quot;) ;;  <ICLASS="lineannotation">...not a terminal login session; do nothing</I>esac</PRE></BLOCKQUOTE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3543"></A><ACLASS="indexterm"NAME="AUTOID-3545"></A><ACLASS="indexterm"NAME="AUTOID-3549"></A>Certain systems set certain environment variables.For example, the X Window System sets a <EMCLASS="emphasis">DISPLAY</EM> environment variable.(If you aren't sure about your system, use the<SPANCLASS="link"><EMCLASS="emphasis">env</EM> or <EMCLASS="emphasis">printenv</EM> command (<ACLASS="linkend"HREF="ch06_01.htm#UPT-ART-1170"TITLE="What Environment Variables Are Good For ">6.1</A>)</SPAN>to look for changes in your environment at different systems.)You can test that:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch47_03.htm"TITLE="47.3 Conditional Statements with if ">if</A> <ACLASS="co"HREF="ch47_04.htm"TITLE="47.4 C Shell Variable Operators and Expressions ">$?</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">if ($?DISPLAY) then   # on X window system   ...else if ($?WIN_PARENT) then   # on SunView system   ...else   ...endif</PRE></TD></TR></TABLE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3562"></A><ACLASS="indexterm"NAME="AUTOID-3564"></A><ACLASS="indexterm"NAME="AUTOID-3566"></A><ACLASS="indexterm"NAME="AUTOID-3568"></A>Your system may have a <EMCLASS="emphasis">/etc/ttytab</EM> or<EMCLASS="emphasis">/etc/ttys</EM> file that lists the type of each terminal port.Lines in the file look something like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">console &quot;/usr/etc/getty std.9600&quot;    vt100      on  local tty00   &quot;/usr/etc/getty std.9600&quot;    dialup     off localtty01   &quot;/usr/etc/getty std.9600&quot;    plugboard  off local   ...ttyp0   none                         network    off   ...</PRE></BLOCKQUOTE></P><PCLASS="para">(For example, port <EMCLASS="emphasis">ttyp0</EM> is <EMCLASS="emphasis">network</EM>, the type used by<SPANCLASS="link"><EMCLASS="emphasis">xterm</EM> (<ACLASS="linkend"HREF="ch01_31.htm"TITLE="The X Window System ">1.31</A>)</SPAN>,<SPANCLASS="link"><EMCLASS="emphasis">telnet</EM> (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>,and so on.)</P><PCLASS="para">You can match the output of the<SPANCLASS="link"><EMCLASS="emphasis">tty</EM> (<ACLASS="linkend"HREF="ch03_08.htm"TITLE="What tty Am I On? ">3.8</A>)</SPAN>command, which shows your current tty, to the first column of thatfile.The output of <EMCLASS="emphasis">tty</EM> starts with <EMCLASS="emphasis">/dev</EM> or <EMCLASS="emphasis">/dev/pts</EM>.So, to match your current tty to the file, you need to strip thename to its tail.For example, in <EMCLASS="emphasis">bash</EM> and <EMCLASS="emphasis">ksh</EM>, these three lines wouldput the terminal port type (<CODECLASS="literal">vt100</CODE>, <CODECLASS="literal">plugboard</CODE>, etc.)into the <EMCLASS="emphasis">ttykind</EM> shell variable:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch09_07.htm"TITLE="9.7 String Editing in ksh and bash ">${..#..}</A> <ACLASS="co"HREF="ch33_11.htm"TITLE="33.11 Quick Reference: awk ">awk</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">tty=`tty`ttytail=${tty#/dev/}ttykind=`awk '$1 == &quot;'$ttytail'&quot; {print $3}' /etc/ttys`</PRE></TD></TR></TABLE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para">You can also deal with many of these cases using the venerable butobscure <ACLASS="indexterm"NAME="AUTOID-3599"></A><SPANCLASS="link"><EMCLASS="emphasis">tset</EM> (<ACLASS="linkend"HREF="ch05_03.htm"TITLE="Setting the Terminal Type When You Log In ">5.3</A>)</SPAN>program to select and initialize the correct terminal type.Another program you can use to set the terminal type is <SPANCLASS="link"><EMCLASS="emphasis">qterm</EM> (<ACLASS="linkend"HREF="ch05_05.htm"TITLE="Querying Your Terminal Type: qterm ">5.5</A>)</SPAN>,available on the CD-ROM.</P></LI></UL><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_11.htm"TITLE="2.11 Faster ksh and bash Startup with $- Test "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.11 Faster ksh and bash Startup with $- Test "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_13.htm"TITLE="2.13 A .cshrc.$HOST File for Per Host Setup "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.13 A .cshrc.$HOST File for Per Host Setup "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">2.11 Faster ksh and bash Startup with $- Test </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">2.13 A .cshrc.$HOST File for Per Host Setup </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>