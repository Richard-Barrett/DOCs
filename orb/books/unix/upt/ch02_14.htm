<HTML><HEAD><TITLE>[Chapter 2] 2.14 motd.diff: Show New Lines in Login Messages</TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:32:18Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch02_01.htm"TITLE="2. Logging In"><LINKREL="prev"HREF="ch02_13.htm"TITLE="2.13 A .cshrc.$HOST File for Per Host Setup "><LINKREL="next"HREF="ch02_15.htm"TITLE="2.15 Unclutter Logins: Show Login Messages Just Once "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_13.htm"TITLE="2.13 A .cshrc.$HOST File for Per Host Setup "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.13 A .cshrc.$HOST File for Per Host Setup "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 2<BR>Logging In</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_15.htm"TITLE="2.15 Unclutter Logins: Show Login Messages Just Once "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.15 Unclutter Logins: Show Login Messages Just Once "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-4400">2.14 motd.diff: Show New Lines in Login Messages</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3666"></A><ACLASS="indexterm"NAME="AUTOID-3668"></A><ACLASS="indexterm"NAME="AUTOID-3670"></A>One UNIX system I worked on had a really lonnnnnnnng login messagethat scrolled across my screen.It had a lot of old stuff that I'd seen for the last three weeks.For a while, I started ignoring it.But I knew that some day the system manager would put a shutdownnotice in there that I wouldn't see...</P><PCLASS="para">This script solved the problem.I run it from my <EMCLASS="emphasis">.login</EM> file.Each time I log in,the script compares the current <EMCLASS="emphasis">/etc/motd</EM> file to the one on my previouslogin.If lines were added, I see them; the script pauses to give me time to read:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">login: <CODECLASS="userinput"><B>jpeek</B></CODE>Password:Additions to system message-of-the-day:===== 9/5/91 =====The system will be down for maintenance from 9 to 11 tonight.Hit RETURN to continue:</PRE></BLOCKQUOTE></P><PCLASS="para">If there are no new lines, my login is nice and quiet.</P><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="motd.diff">motd.diff</A><BR></TH><TDVALIGN="TOP">This works best on systems that look for a file named <EMCLASS="emphasis">.hushlogin</EM> in your home directory and don't print login messages if the file exists.[2]Install the program from the CD-ROM,then add the command <EMCLASS="emphasis">motd.diff</EM>on a line in your <EMCLASS="emphasis">.login</EM> or <EMCLASS="emphasis">.profile</EM>.</TD></TR></TABLE><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] That also shuts off the message <CODECLASS="literal">You have mail</CODE>.But I <EMCLASS="emphasis">always</EM> have mail, so I don't need that.&nbsp;<CODECLASS="literal">:-)</CODE>If you do, and you use a command like Berkeley <EMCLASS="emphasis">mail</EM> or <EMCLASS="emphasis">mailx</EM>,add this line to your <EMCLASS="emphasis">.login</EM> file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">if { mail -e } echo You have mail.</PRE></BLOCKQUOTE></P><PCLASS="para">Those <SPANCLASS="link">curly brace (<CODECLASS="literal">{}</CODE>) operators (<ACLASS="linkend"HREF="ch47_04.htm"TITLE="C Shell Variable Operators and Expressions ">47.4</A>)</SPAN>work with the<SPANCLASS="link"><EMCLASS="emphasis">if</EM> (<ACLASS="linkend"HREF="ch47_03.htm"TITLE="Conditional Statements with if ">47.3</A>)</SPAN>,to test the<SPANCLASS="link">exit status (<ACLASS="linkend"HREF="ch44_07.htm"TITLE="Exit Status of UNIX Processes ">44.7</A>)</SPAN>of<EMCLASS="emphasis">mail -e</EM>.If <EMCLASS="emphasis">mail -e</EM> returns zero (&quot;success&quot;),<SPANCLASS="link"><EMCLASS="emphasis">echo</EM> (<ACLASS="linkend"HREF="ch08_06.htm"TITLE="Output Command-Line Arguments ">8.6</A>)</SPAN>prints <CODECLASS="literal">You</CODE>&nbsp;<CODECLASS="literal">have</CODE>&nbsp;<CODECLASS="literal">mail.</CODE></P></BLOCKQUOTE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3710"></A><EMCLASS="emphasis">motd.diff</EM> uses<SPANCLASS="link"><EMCLASS="emphasis">diff</EM> (<ACLASS="linkend"HREF="ch28_01.htm#UPT-ART-2680"TITLE="Checking Differences with diff ">28.1</A>)</SPAN>to compare the system's current <EMCLASS="emphasis">motd</EM> to the <EMCLASS="emphasis">motd</EM> at your lastlogin on that host (stored in a file named <EMCLASS="emphasis">.last.motd.</EM><CODECLASS="userinput"><B>hostname</B></CODE>in your home directory).The script finds whether lines have been added by <EMCLASS="emphasis">grep</EM>ping for thecharacter <CODECLASS="literal">&gt;</CODE> at the start of each line of <EMCLASS="emphasis">diff</EM> output:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">diff $lastmotd /etc/motd &gt; $temp   ...if grep &quot;^&gt;&quot; $temp &gt;/dev/null    # diff USES &gt; TO MARK NEW LINESthen   <ICLASS="lineannotation">...show lines...</I></PRE></BLOCKQUOTE></P><PCLASS="para">The<ACLASS="indexterm"NAME="AUTOID-3726"></A><SPANCLASS="link"><EMCLASS="emphasis">comm</EM> (<ACLASS="linkend"HREF="ch28_12.htm"TITLE="Comparing Two Files with comm ">28.12</A>)</SPAN>command also shows lines that have been added to a file.  But<EMCLASS="emphasis">comm</EM> only handles sorted files; this trick works on unsortedfiles. The<SPANCLASS="link"><CODECLASS="literal">if</CODE> (<ACLASS="linkend"HREF="ch44_08.htm"TITLE="Test Exit Status with the if Statement ">44.8</A>)</SPAN>tests <EMCLASS="emphasis">grep</EM>'s<SPANCLASS="link">exit status (<ACLASS="linkend"HREF="ch44_07.htm"TITLE="Exit Status of UNIX Processes ">44.7</A>)</SPAN>(<EMCLASS="emphasis">grep</EM> returns a zero status when it finds matching lines).<EMCLASS="emphasis">grep</EM>'s output is &quot;thrown away&quot; into<SPANCLASS="link"><EMCLASS="emphasis">/dev/null</EM> (<ACLASS="linkend"HREF="ch13_14.htm"TITLE="What Can You Do with an Empty File? ">13.14</A>)</SPAN>-some versions of grep have a <EMCLASS="emphasis">-s</EM> (&quot;silent&quot;) option to do the samething.</P><PCLASS="para">This script is designed to work on networked filesystems where my samehome directory is mounted on more than one computer.If your home directory isn't shared between computers, or if all systemshave the same system messages, you can edit the script to delete the<EMCLASS="emphasis">hostname</EM> variable and command.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_13.htm"TITLE="2.13 A .cshrc.$HOST File for Per Host Setup "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.13 A .cshrc.$HOST File for Per Host Setup "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_15.htm"TITLE="2.15 Unclutter Logins: Show Login Messages Just Once "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 2.15 Unclutter Logins: Show Login Messages Just Once "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">2.13 A .cshrc.$HOST File for Per Host Setup </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">2.15 Unclutter Logins: Show Login Messages Just Once </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>