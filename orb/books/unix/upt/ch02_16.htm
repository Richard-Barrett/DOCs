<HTML><HEAD><TITLE>[Chapter 2] 2.16 Approved Shells: Using Unapproved Login Shell </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:32:22Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch02_01.htm"TITLE="2. Logging In"><LINKREL="prev"HREF="ch02_15.htm"TITLE="2.15 Unclutter Logins: Show Login Messages Just Once "><LINKREL="next"HREF="ch03_01.htm"TITLE="3. Logging Out"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_15.htm"TITLE="2.15 Unclutter Logins: Show Login Messages Just Once "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.15 Unclutter Logins: Show Login Messages Just Once "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 2<BR>Logging In</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch03_01.htm"TITLE="3. Logging Out"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 3. Logging Out"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-5400">2.16 Approved Shells: Using Unapproved Login Shell </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="UPT-ART-5400-IX-SHELLS-APPROVED"></A><ACLASS="indexterm"NAME="UPT-ART-5400-IX-LOGIN-SHELLS-UNAPPROVED"></A><ACLASS="indexterm"NAME="AUTOID-3802"></A><ACLASS="indexterm"NAME="AUTOID-3804"></A><ACLASS="indexterm"NAME="AUTOID-3806"></A>Since 4.2BSD, Berkeley UNIX systems have restricted<EMCLASS="emphasis">chsh</EM> (or a command like it) to change your login shellonly to a shell that's listed in the file <EMCLASS="emphasis">/etc/shells</EM>.That's partly a safety feature, like requiring you to type your old passwordbefore you can change to a new one: it keeps other people from giving you astrange login shell as a joke.It's also for security&nbsp;- a way for the system administrator to give a list of shells that are robust enough to run peoples' accounts.</P><PCLASS="para">The usual &quot;approved&quot; shells are the Bourne and C shells.If you want to use another shell as your login shell and your system has<EMCLASS="emphasis">/etc/shells</EM>, ask the system administrator to add your shell.The shell will need to be stored in a secure system directory to make itharder for system crackers to corrupt the shell.</P><PCLASS="para">If the system administrator won't approve your login shell, here's awork-around.It lets you log in with an approved shell, then automatically replace theshell with whatever you want.(For background, see article<ACLASS="xref"HREF="ch51_09.htm"TITLE='Making a "Login&quot; Shell'>51.9</A>.)</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">If your login shell isn't C shell, use<EMCLASS="emphasis">chsh</EM> or a command like itto change it to the C shell.</P></LI><LICLASS="listitem"><PCLASS="para">If your new shell will be <EMCLASS="emphasis">bash</EM>, you can skip this step.Otherwise:</P><PCLASS="para">In your home directory, make a<SPANCLASS="link">hard or symbolic link (<ACLASS="linkend"HREF="ch18_04.htm"TITLE="More About Links ">18.4</A>)</SPAN>directory,to your shell.Use a name starting with a minus sign (<CODECLASS="literal">-</CODE>);this makes the shell<SPANCLASS="link">act like a login shell (<ACLASS="linkend"HREF="ch51_09.htm"TITLE='Making a "Login&quot; Shell'>51.9</A>)</SPAN>.For example, to make a symbolic link in your home directory named<EMCLASS="emphasis">-ksh</EM> to the shell <EMCLASS="emphasis">/usr/local/bin/ksh</EM>, type this command:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch23_14.htm"TITLE="23.14 Handling a Filename Starting with a Dash (-) ">./</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>ln -s /usr/local/bin/ksh ./-ksh</B></CODE></PRE></TD></TR></TABLE></P></LI><LICLASS="listitem"><PCLASS="para">Add lines to the top of the<SPANCLASS="link"><EMCLASS="emphasis">.cshrc</EM> (<ACLASS="linkend"HREF="ch02_02.htm"TITLE="Shell Setup Files-Which, Where, and Why ">2.2</A>)</SPAN>file that replace the <EMCLASS="emphasis">csh</EM> process with your login shell.(The<SPANCLASS="link"><EMCLASS="emphasis">exec</EM> (<ACLASS="linkend"HREF="ch45_07.htm"TITLE="The exec Command ">45.7</A>)</SPAN>command replaces a process.)</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">If you use a Bourne-type shellthat reads the <EMCLASS="emphasis">.profile</EM> file at login time,use lines like these:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch05_10.htm"TITLE="5.10 Finding What Terminal Names You Can Use ">TERM</A> <ACLASS="co"HREF="ch22_22.htm"TITLE="22.22 The su Command Isn't Just for the Superuser ">su</A> <ACLASS="co"HREF="ch47_03.htm"TITLE="47.3 Conditional Statements with if ">if</A> <ACLASS="co"HREF="ch47_04.htm"TITLE="47.4 C Shell Variable Operators and Expressions ">$?</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen"># OVERRIDE DEFAULT LOGIN C SHELL TO USE ksh.setenv SHELL /usr/local/bin/ksh# IF $TERM SET (BY login OR rlogin), START LOGIN SHELL.# UNFORTUNATELY, THIS MAKES su USE A LOGIN SHELL TOO.if ($?TERM) then   cd   exec -ksh   # USE &quot;LOGIN SHELL&quot; SYMLINK IN $HOMEelse   exec $SHELLendifecho &quot;******** WARNING: exec ksh FAILED ********&quot;</PRE></TD></TR></TABLE></P><PCLASS="para">If your new login shell will be <EMCLASS="emphasis">bash</EM>, you can replace the line<CODECLASS="literal">exec&nbsp;-ksh</CODE> above with:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">exec $SHELL -login</PRE></BLOCKQUOTE></P><PCLASS="para">because <EMCLASS="emphasis">bash</EM> has a <EMCLASS="emphasis">-login</EM> option that tells it to actlike a login shell.Simple, eh?&#13;</P></LI><LICLASS="listitem"><PCLASS="para">If your new login shell is a <EMCLASS="emphasis">csh</EM>-type shell that also reads<EMCLASS="emphasis">.cshrc</EM>, you need to add a test to <EMCLASS="emphasis">.cshrc</EM> that prevents aninfinite loop.<ACLASS="indexterm"NAME="AUTOID-3861"></A>This test uses the <EMCLASS="emphasis">SH_EXECD</EM> <SPANCLASS="link">environment variable (<ACLASS="linkend"HREF="ch06_01.htm#UPT-ART-1170"TITLE="What Environment Variables Are Good For ">6.1</A>)</SPAN>as a flag:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># OVERRIDE DEFAULT LOGIN C SHELL TO USE tcsh.if (! $?SH_EXECD) then   setenv SH_EXECD yes   setenv SHELL /usr/local/bin/tcsh   # IF $TERM SET (BY login OR rlogin), START LOGIN SHELL.   # USE switch, NOT if, DUE TO csh BUG WITH IMBEDDED else.   # UNFORTUNATELY, THIS MAKES su USE A LOGIN SHELL TOO.   switch ($?TERM)   case 1:      cd       exec -tcsh    # USE &quot;LOGIN SHELL&quot; SYMLINK IN $HOME      breaksw   default:      exec $SHELL   # USE NON-LOGIN SHELL      breaksw   endsw   echo &quot;******** WARNING: exec tcsh FAILED ********&quot;endif</PRE></BLOCKQUOTE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para">The C shell may not find your new shell (<CODECLASS="literal">-ksh</CODE> or <CODECLASS="literal">-tcsh</CODE>)unless you have the current directory (<CODECLASS="literal">.</CODE>) in your<SPANCLASS="link">search path (<ACLASS="linkend"HREF="ch08_07.htm"TITLE="Setting Your Search Path ">8.7</A>)</SPAN>(put it at the end of your path!).You may also be able to use an<ACLASS="indexterm"NAME="AUTOID-3874"></A><ACLASS="indexterm"NAME="AUTOID-3876"></A><SPANCLASS="link">absolute pathname (<ACLASS="linkend"HREF="ch14_02.htm"TITLE="Using Relative and Absolute Pathnames ">14.2</A>)</SPAN>to the new shell, but that could hide the leadingminus sign (<CODECLASS="literal">-</CODE>) and the shell might not act like a login shell.<ACLASS="indexterm"NAME="AUTOID-3881"></A><ACLASS="indexterm"NAME="AUTOID-3884"></A></P></LI><LICLASS="listitem"><PCLASS="para">Is there a chance that your new shell might be missing some day?For instance, is it on a network filesystem that might be unavailable?Then it's a good idea to wrap the new code above with a test:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch47_04.htm"TITLE="47.4 C Shell Variable Operators and Expressions ">-e</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">if (-e <CODECLASS="replaceable"><I>my-new-shell</I></CODE>) then    <ICLASS="lineannotation">...code to start new shell...</I>else    echo &quot;*** WARNING: new shell failed.  Using csh. ***&quot;endif</PRE></TD></TR></TABLE></P></LI></UL></LI><LICLASS="listitem"><PCLASS="para">Test your new setup:<ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Try commands that start<SPANCLASS="link">subshells (<ACLASS="linkend"HREF="ch38_04.htm"TITLE="Subshells ">38.4</A>)</SPAN>,<ACLASS="indexterm"NAME="AUTOID-3900"></A>like<SPANCLASS="link"><EMCLASS="emphasis">su</EM>, <EMCLASS="emphasis">rsh</EM>, and so on (<ACLASS="linkend"HREF="ch02_07.htm"TITLE="C Shell Setup Files Aren't Read When You Want Them to Be? ">2.7</A>)</SPAN>,to be sure that they start your new shell.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3908"></A>Put the <EMCLASS="emphasis">csh</EM> command<SPANCLASS="link"><EMCLASS="emphasis">set&nbsp;echo</EM> (<ACLASS="linkend"HREF="ch08_17.htm"TITLE="verbose and echo Variables Show Quoting ">8.17</A>)</SPAN>at the top of your <EMCLASS="emphasis">.cshrc</EM>file to be sure your commands there are working.</P></LI><LICLASS="listitem"><PCLASS="para">Type a command that will work only in your new shell (not in a C shell).</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-3918"></A>Use the<SPANCLASS="link"><EMCLASS="emphasis">ps</EM> (<ACLASS="linkend"HREF="ch38_05.htm"TITLE="The ps Command ">38.5</A>)</SPAN>command<CODECLASS="literal">ps</CODE>&nbsp;<CODECLASS="literal">$$</CODE> (on System V, <CODECLASS="literal">ps</CODE>&nbsp;<CODECLASS="literal">-f</CODE>&nbsp;<CODECLASS="literal">-p</CODE>&nbsp;<CODECLASS="literal">$$</CODE>)to look at your new shell process (<CODECLASS="literal">$$</CODE> is your shell's<SPANCLASS="link">process ID number (<ACLASS="linkend"HREF="ch38_03.htm"TITLE="Managing Processes: Overall Concepts ">38.3</A>)</SPAN>).</P></LI><LICLASS="listitem"><PCLASS="para"><SPANCLASS="link"> Before you log out of this shell, try logging in from somewhere else  (<ACLASS="linkend"HREF="ch02_04.htm"TITLE="Tip for Changing Account Setup: Keep a Shell Ready ">2.4</A>)</SPAN>to be sure your new shell startup files work.</P></LI></UL>&#13;</P></LI><LICLASS="listitem"><PCLASS="para">You're set to go.</P></LI></OL><PCLASS="para">If your login shell isn't listed in <EMCLASS="emphasis">/etc/shells</EM>, the<SPANCLASS="link"><EMCLASS="emphasis">ftp</EM> (<ACLASS="linkend"HREF="ch52_07.htm"TITLE="Other Ways to Get the Software ">52.7</A>)</SPAN>program<ACLASS="indexterm"NAME="AUTOID-3939"></A><ACLASS="indexterm"NAME="AUTOID-3941"></A><ACLASS="indexterm"NAME="AUTOID-3943"></A>(actually, the <EMCLASS="emphasis">ftpd</EM><SPANCLASS="link">daemon (<ACLASS="linkend"HREF="ch01_14.htm"TITLE="The Kernel and Daemons ">1.14</A>)</SPAN>)may refuse to transfer files to your account.That's partly to stop <EMCLASS="emphasis">ftp</EM> access to your system through special accountsthat don't have passwords, like <EMCLASS="emphasis">sync</EM>, <EMCLASS="emphasis">who</EM>, <EMCLASS="emphasis">finger</EM>, and so on.If you use the workaround steps above, though, that shouldn't be a problem;you'll have an approved shell listed in <EMCLASS="emphasis">/etc/passwd</EM> and <EMCLASS="emphasis">ftp</EM>usually doesn't run your login shell, anyway.</P><ACLASS="indexterm"NAME="AUTOID-3954"></A><ACLASS="indexterm"NAME="AUTOID-3955"></A><ACLASS="indexterm"NAME="AUTOID-3956"></A><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch02_15.htm"TITLE="2.15 Unclutter Logins: Show Login Messages Just Once "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 2.15 Unclutter Logins: Show Login Messages Just Once "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch03_01.htm"TITLE="3. Logging Out"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 3. Logging Out"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">2.15 Unclutter Logins: Show Login Messages Just Once </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">3. Logging Out</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>