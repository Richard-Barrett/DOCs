<HTML><HEAD><TITLE>[Chapter 5] 5.5 Querying Your Terminal Type: qterm </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:33:03Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch05_01.htm"TITLE="5. Setting Up Your Terminal"><LINKREL="prev"HREF="ch05_04.htm"TITLE="5.4 Setting the TERMCAP Variable with tset "><LINKREL="next"HREF="ch05_06.htm"TITLE="5.6 Checklist: Terminal Hangs When I Log In "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_04.htm"TITLE="5.4 Setting the TERMCAP Variable with tset "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.4 Setting the TERMCAP Variable with tset "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 5<BR>Setting Up Your Terminal</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_06.htm"TITLE="5.6 Checklist: Terminal Hangs When I Log In "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.6 Checklist: Terminal Hangs When I Log In "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-9013">5.5 Querying Your Terminal Type: qterm </A></H2><PCLASS="para"><SPANCLASS="link"><EMCLASS="emphasis">tset</EM> (<ACLASS="linkend"HREF="ch05_03.htm"TITLE="Setting the Terminal Type When You Log In ">5.3</A>)</SPAN><ACLASS="indexterm"NAME="AUTOID-5062"></A>is a powerful tool to use if you often log in at different terminals.You can use <EMCLASS="emphasis">tset</EM> to prompt you with a default terminal type,giving you the opportunity to specify a new terminaltype when you log in:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">TERM = (vt100)</PRE></BLOCKQUOTE></P><PCLASS="para">A problem with <EMCLASS="emphasis">tset</EM>, however, is that it requires you to know your terminal type.You might log in at a new terminal and have noidea what to set the terminal type to.Or your terminal might beconfigured to emulate another terminal type, without your knowledge.New users in particular tend to be confused by the <EMCLASS="emphasis">tset</EM> prompt.</P><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="qterm">qterm</A><BR></TH><TDVALIGN="TOP"><ACLASS="indexterm"NAME="AUTOID-5071"></A>As an alternative, try Michael Cooper's <EMCLASS="emphasis">qterm</EM> program on our Power Toolsdisc.<EMCLASS="emphasis">qterm</EM> sends the terminal a test string and determines what sort of terminalyou're using based on how the terminal responds.Using <EMCLASS="emphasis">qterm</EM>, you can make sure you always use the correctterminal type by placing the following line in your <EMCLASS="emphasis">.login</EM>:</TD></TR></TABLE><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch09_16.htm"TITLE="9.16 Command Substitution ">`...`</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">setenv TERM `qterm`</PRE></TD></TR></TABLE></P><PCLASS="para">or in <EMCLASS="emphasis">.profile</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">TERM=`qterm`;export TERM</PRE></BLOCKQUOTE></P><PCLASS="para">The advantage of <EMCLASS="emphasis">qterm</EM> is that it sets the terminal typewithout your intervention.You don't need to know what yourterminal type is, it just gets set automatically.</P><PCLASS="para"><EMCLASS="emphasis">qterm</EM> works by sending the terminal a query string andreturning the terminal type depending on the terminal's response.<EMCLASS="emphasis">qterm</EM> is configured using a listing of responses and theterminals they correspond to.By default, <EMCLASS="emphasis">qterm</EM> looks for the listings in a systemwide location, such as <EMCLASS="emphasis">/usr/usc/lib/qtermtab</EM> or <EMCLASS="emphasis">/usr/local/lib/qtermtab</EM>.In addition, you can call <EMCLASS="emphasis">qterm</EM> with the <EMCLASS="emphasis">+usrtab</EM>option, so that it will look for a file called <EMCLASS="emphasis">.qtermtab</EM>in your home directory.  </P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5097"></A>The string used to query the terminal is usually ESC&nbsp;Z.The sample <EMCLASS="emphasis">qtermtab</EM> file distributed with <EMCLASS="emphasis">qterm</EM> defines the responses several different terminals give for that string:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">## QtermTab - Query terminal table for qterm.##SendStr ReceiveStr         TermName       FullTermName#^[Z     ^[[?1;0c            vt100          Base vt100^[Z     ^[[?1;1c            vt100          vt100 with STP^[Z     ^[[?1;2c            vt100          ANSI/VT100 Clone   ...^[Z     ^[/K                h29            Zenith z29 in zenith mode^[Z     ^[/Z                vt52           Generic vt52^[Z     ^[[0n               vt100          AT&amp;T UNIX PC 7300</PRE></BLOCKQUOTE></P><PCLASS="para">If your terminal isn't listed here, you can just add it.To findout your terminal's response to the query string, justecho ESC&nbsp;Zto your terminal and see what the response is.For example, I logged in from my Macintosh terminal emulator at home and found that<EMCLASS="emphasis">qterm</EM> didn't recognize my terminal type:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>qterm</B></CODE>Terminal NOT recognized - defaults to &quot;vt100&quot;.vt100</PRE></BLOCKQUOTE></P><PCLASS="para"><EMCLASS="emphasis">qterm</EM> defaults to the right terminal description, but I'd stillrather define my own entry.I find out my terminal's response to theESC&nbsp;Z string:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch08_06.htm"TITLE="8.6 Output Command-Line Arguments ">echo</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>echo &quot;^[Z&quot;</B></CODE>^[[E;Y|</PRE></TD></TR></TABLE></P><PCLASS="para">(Note that ESC prints as <CODECLASS="literal">^[</CODE>.)Then I add the entry to my<EMCLASS="emphasis">qterm</EM> description file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">^[Z         ^[[E;Y|         vt100       Macintosh terminal emulator</PRE></BLOCKQUOTE></P><PCLASS="para">Now when I run <EMCLASS="emphasis">qterm</EM>, the terminal is recognized:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>qterm</B></CODE>Terminal recognized as vt100 (Macintosh terminal emulator)vt100</PRE></BLOCKQUOTE></P><PCLASS="para">The string <CODECLASS="literal">Terminal</CODE> <CODECLASS="literal">recognized</CODE> <CODECLASS="literal">as</CODE> <CODECLASS="literal">...</CODE>is sent to<SPANCLASS="link">standard error (<ACLASS="linkend"HREF="ch13_01.htm#UPT-ART-1023"TITLE="Using Standard Input and Output">13.1</A>)</SPAN>;only the terminal type itself is sent to<SPANCLASS="link">standard output (<ACLASS="linkend"HREF="ch13_01.htm#UPT-ART-1023"TITLE="Using Standard Input and Output">13.1</A>)</SPAN>.So if youuse the following command line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>setenv TERM `qterm`</B></CODE>Terminal recognized as vt100 (Macintosh terminal emulator)</PRE></BLOCKQUOTE></P><PCLASS="para">the TERM variable is set correctly:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>echo $TERM</B></CODE>vt100</PRE></BLOCKQUOTE></P><PCLASS="para">Now for the caveat: <EMCLASS="emphasis">qterm</EM>'s results are only as accurate as the <EMCLASS="emphasis">qtermtab</EM> file. Not all terminals respond to the ESC&nbsp;Z string, and you may not beable to find a string that it does respond uniquely to.And someterminals do uncanny imitations of others.For example, I'm currently using an<SPANCLASS="link"><EMCLASS="emphasis">xterm</EM> (<ACLASS="linkend"HREF="ch01_31.htm"TITLE="The X Window System ">1.31</A>)</SPAN>window, but <EMCLASS="emphasis">qterm</EM>thinks I'm using a <EMCLASS="emphasis">vt100</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>echo $TERM</B></CODE>xterm% <CODECLASS="userinput"><B>qterm</B></CODE>Terminal recognized as vt100 (ANSI/VT100 Clone)vt100</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-5150"></A>As a hack, you can just edit your <EMCLASS="emphasis">.qtermtab</EM> file. For example, I could edit my <EMCLASS="emphasis">.qtermtab</EM> so the<CODECLASS="literal">^[[?1;2c</CODE> response is mapped to <EMCLASS="emphasis">xterm</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#^[Z     ^[[?1;2c            vt100          ANSI/VT100 Clone^[Z     ^[[?1;2c            xterm          xterm window</PRE></BLOCKQUOTE></P><PCLASS="para">And then call <EMCLASS="emphasis">qterm</EM> with the <EMCLASS="emphasis">+usrtab</EM> command-line option:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">setenv TERM `qterm +usrtab`</PRE></BLOCKQUOTE></P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">LM</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_04.htm"TITLE="5.4 Setting the TERMCAP Variable with tset "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 5.4 Setting the TERMCAP Variable with tset "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch05_06.htm"TITLE="5.6 Checklist: Terminal Hangs When I Log In "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 5.6 Checklist: Terminal Hangs When I Log In "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">5.4 Setting the TERMCAP Variable with tset </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">5.6 Checklist: Terminal Hangs When I Log In </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>