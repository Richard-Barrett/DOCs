<HTML><HEAD><TITLE>[Chapter 9] 9.22 xargs: Problems with Spaces and Newlines </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:35:29Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch09_01.htm"TITLE="9. Saving Time on the Command Line"><LINKREL="prev"HREF="ch09_21.htm"TITLE="9.21 Handle Too-Long Command Lines with xargs "><LINKREL="next"HREF="ch09_23.htm"TITLE='9.23 Workaround for "Arguments too long&quot; Error'></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_21.htm"TITLE="9.21 Handle Too-Long Command Lines with xargs "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.21 Handle Too-Long Command Lines with xargs "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 9<BR>Saving Time on the Command Line</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_23.htm"TITLE='9.23 Workaround for "Arguments too long&quot; Error'><IMGSRC="../gifs/txtnexta.gif"ALT='Next: 9.23 Workaround for "Arguments too long&quot; Error'BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0359">9.22 xargs: Problems with Spaces and Newlines </A></H2><PCLASS="para">The<ACLASS="indexterm"NAME="AUTOID-11147"></A><ACLASS="indexterm"NAME="AUTOID-11150"></A><SPANCLASS="link"><EMCLASS="emphasis">xargs</EM> (<ACLASS="linkend"HREF="ch09_21.htm"TITLE="Handle Too-Long Command Lines with xargs ">9.21</A>)</SPAN>command reads its input and splits the arguments at spaces or newlines.It's legal (though pretty unusual) for UNIX filenames to have spaces or newlinecharacters in them.Those filenames can cause <EMCLASS="emphasis">xargs</EM> trouble.</P><PCLASS="para">For example, I have a directory full of copies of<SPANCLASS="link">Usenet (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>articles.The filenames are the same as the subjects of the articles:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&#13;% <CODECLASS="userinput"><B>ls</B></CODE>A use for the &quot;yes&quot; commandBeware UNIX Security HolesCauses of 'test' errors   ...</PRE></BLOCKQUOTE></P><PCLASS="para">The problem comes when I run a command like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>find . -type f -mtime +7 -print | xargs rm</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">If <EMCLASS="emphasis">find</EM> outputs the pathname <EMCLASS="emphasis">./Beware&nbsp;UNIX&nbsp;Security&nbsp;Holes</EM>,the <EMCLASS="emphasis">xargs</EM> command would most likely tell <EMCLASS="emphasis">rm</EM> to remove four filenames:<EMCLASS="emphasis">./Beware</EM>, <EMCLASS="emphasis">UNIX</EM>, <EMCLASS="emphasis">Security</EM>, and <EMCLASS="emphasis">Holes</EM>.I'd probably get four error messages from <EMCLASS="emphasis">rm</EM> because no fileswith those names exist.If they <EMCLASS="emphasis">did</EM> exist, though, they'd be removed when they shouldn't!Newlines in filenames can cause the same problems.</P><PCLASS="para">Some versions of <EMCLASS="emphasis">xargs</EM> (see below) are better at handling this problem.Here's a simple test to see how well your system's version works.</P><PCLASS="para">Make an empty directory, a filename with spaces, and a filename with anewline.Try to remove the file:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch21_07.htm"TITLE="21.7 Setting File Modification Time with touch ">touch</A> <ACLASS="co"HREF="ch08_15.htm"TITLE="8.15 Differences Between Bourne and C Shell Quoting ">\</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>mkdir temp</B></CODE>% <CODECLASS="userinput"><B>cd temp</B></CODE>% <CODECLASS="userinput"><B>touch 'Just testing'</B></CODE>% <CODECLASS="userinput"><B>touch 'some\</B></CODE><CODECLASS="userinput"><B>file'</B></CODE>% <CODECLASS="userinput"><B>find . -print | xargs rm</B></CODE>./Just: No such file or directorytesting: No such file or directorysome: No such file or directoryfile: No such file or directory</PRE></TD></TR></TABLE></P><PCLASS="para">That <EMCLASS="emphasis">xargs</EM> broke the filenames at the space and newline.If it hadn't broken the filenames, the files would have been removed.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-11193"></A><ACLASS="indexterm"NAME="AUTOID-11196"></A>The GNU <EMCLASS="emphasis">xargs</EM> (on the CD-ROM)has a <EMCLASS="emphasis">-0</EM> (zero) option; this means thepathnames it reads are separated by NUL characters instead ofwhitespace.GNU's <EMCLASS="emphasis">find</EM> (also on this disc) has a <EMCLASS="emphasis">-print0</EM> operatorthat puts a NUL between pathnames instead of a newline.Use them together like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>find . -type f -mtime +7 -print0 | xargs -0 rm</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Because UNIX pathnames won't contain NULs, this combination should neverfail.(Try it!)<ACLASS="indexterm"NAME="AUTOID-11207"></A><ACLASS="indexterm"NAME="AUTOID-11208"></A><ACLASS="indexterm"NAME="AUTOID-11209"></A></P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_21.htm"TITLE="9.21 Handle Too-Long Command Lines with xargs "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 9.21 Handle Too-Long Command Lines with xargs "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch09_23.htm"TITLE='9.23 Workaround for "Arguments too long&quot; Error'><IMGSRC="../gifs/txtnexta.gif"ALT='Next: 9.23 Workaround for "Arguments too long&quot; Error'BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">9.21 Handle Too-Long Command Lines with xargs </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">9.23 Workaround for "Arguments too long&quot; Error</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>