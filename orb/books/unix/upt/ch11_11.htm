<HTML><HEAD><TITLE>[Chapter 11] 11.11 Picking Up Where You Left Off </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:36:12Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch11_01.htm"TITLE="11. The Lessons of History"><LINKREL="prev"HREF="ch11_10.htm"TITLE="11.10 Check Your History First with :p "><LINKREL="next"HREF="ch11_12.htm"TITLE="11.12 Pass History to Another Shell "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_10.htm"TITLE="11.10 Check Your History First with :p "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 11.10 Check Your History First with :p "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 11<BR>The Lessons of History</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_12.htm"TITLE="11.12 Pass History to Another Shell "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 11.12 Pass History to Another Shell "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-7671">11.11 Picking Up Where You Left Off </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-12958"></A><ACLASS="indexterm"NAME="AUTOID-12960"></A><ACLASS="indexterm"NAME="AUTOID-12962"></A>If you want your command history to be remembered even when you logout, set the C shell's <EMCLASS="emphasis">savehist</EM><SPANCLASS="link">shell variable (<ACLASS="linkend"HREF="ch06_08.htm"TITLE="Shell Variables ">6.8</A>)</SPAN>to the number of lines of history you want saved.The Korn shell and <EMCLASS="emphasis">bash</EM> save history automatically; you don't needto set a variable.(If you want to change the number of lines saved by <EMCLASS="emphasis">bash</EM>,set its <EMCLASS="emphasis">HISTFILESIZE</EM> environment variable.In the Korn shell, the <EMCLASS="emphasis">HISTSIZE</EM> variable sets the number of commandsavailable to be recalled in your current shell as well the number savedfor other shells.)</P><PCLASS="para">When you log out, the specified number of lines from the <EMCLASS="emphasis">csh</EM> history list will be saved in a file called<ACLASS="indexterm"NAME="AUTOID-12972"></A><EMCLASS="emphasis">.history</EM> in your home directory.<EMCLASS="emphasis">bash</EM> and <EMCLASS="emphasis">ksh</EM> use the filename given in the <EMCLASS="emphasis">HISTFILE</EM>environment variable; by default, <EMCLASS="emphasis">bash</EM> calls the file<EMCLASS="emphasis">.bash_history</EM> and <EMCLASS="emphasis">ksh</EM> uses <EMCLASS="emphasis">.sh_history</EM>.</P><PCLASS="para">On modern windowing systems, this isn't as trivial as it sounds. Onan old-style terminal, people usually started only one main shell, so they could set the history-saving variablein their <EMCLASS="emphasis">.login</EM> or <EMCLASS="emphasis">.profile</EM> fileand have it apply to their login shell.</P><PCLASS="para">However, under window systems like X or networked filesystems that shareyour home directory between several hosts, you have multiple shellssaving into the same history file.The sections below give some possible fixes.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-7671-SECT-1.1">11.11.1 bash and ksh </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-12989"></A><ACLASS="indexterm"NAME="AUTOID-12992"></A>Here's the basic way to give a separate history file to each Korn shell or<EMCLASS="emphasis">bash</EM>:Customize your<SPANCLASS="link">setup file (<ACLASS="linkend"HREF="ch02_02.htm"TITLE="Shell Setup Files-Which, Where, and Why ">2.2</A>)</SPAN>to set a different <EMCLASS="emphasis">HISTFILE</EM> on each host or each window.Use names like<EMCLASS="emphasis">$HOME/.sh_history.window</EM><CODECLASS="replaceable"><I>n</I></CODE> or<EMCLASS="emphasis">~/.bash_history.</EM><CODECLASS="replaceable"><I>hostname</I></CODE>to match each file to its window or host.If your setup is always the same each time you log in, that should giveeach window and/or host the same history it had on the last invocation.(There are related tips in articles<ACLASS="xref"HREF="ch02_12.htm"TITLE="Automatic Setups for Different Terminals ">2.12</A>and<ACLASS="xref"HREF="ch02_13.htm"TITLE="A .cshrc.$HOST File for Per Host Setup ">2.13</A>.)</P><PCLASS="para">If you open random windows, though, you'll have a harder timeautomatically matching a history file to a shell the next time youlog in.Cook up your own scheme.</P><PCLASS="para">The simplest fix is to use<SPANCLASS="link"><CODECLASS="literal">$$</CODE> (<ACLASS="linkend"HREF="ch08_19.htm"TITLE='"Special&quot; Characters and Operators '>8.19</A>)</SPAN>-whichwill probably expand differently in almost every shell you ever start&nbsp;- asa unique part of the filename.Here are two possibilities:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">HISTFILE=/tmp/sh_hist.$$HISTFILE=$HOME/.sh_hist.$$</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13011"></A>The first example uses the system's temporary-file directory; article<ACLASS="xref"HREF="ch21_03.htm"TITLE="Unique Names for Temporary Files ">21.3</A>explains and shows one way to clean up.If your system's <EMCLASS="emphasis">/tmp</EM> is cleaned out often, you may be able toleave your history files there and let the system remove them;ask the administrator.Note that the history file may be<SPANCLASS="link">world-readable (<ACLASS="linkend"HREF="ch22_02.htm"TITLE="Tutorial on File and Directory Permissions ">22.2</A>)</SPAN>if your<SPANCLASS="link">umask (<ACLASS="linkend"HREF="ch22_04.htm"TITLE="Setting an Exact umask ">22.4</A>)</SPAN>isn't set to protect your files.If that matters to you, you could make the temporary files in your homedirectory (or some protected directory), as in the second example shown earlier.Article<ACLASS="xref"HREF="ch03_04.htm"TITLE="Automatic File Cleanup ">3.4</A>shows a way to delete those files.</P><PCLASS="para">Two more bits of trivia:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">The Korn shell maintains the history file constantly, adding a new lineto it as soon as you run a command.This means you share history between all your current shells with thesame <EMCLASS="emphasis">HISTFILE</EM> name,which can be a benefit or a problem.</P></LI><LICLASS="listitem"><PCLASS="para">In <EMCLASS="emphasis">bash</EM>, each shell process keeps its own history listin memory. History isn't written to the history file (named bythe <EMCLASS="emphasis">HISTFILE</EM> variable in each shell) until the shell exits.</P><PCLASS="para">You can force a write with the command <EMCLASS="emphasis">history -w</EM>.In the same way, if you have an existing history file (or, actually, anyfile full of command lines), you can read it into your current<EMCLASS="emphasis">bash</EM> with <EMCLASS="emphasis">history -r</EM>. Article<ACLASS="xref"HREF="ch11_12.htm"TITLE="Pass History to Another Shell ">11.12</A> has another example.</P></LI></UL></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-7671-SECT-1.2">11.11.2 C Shell </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13035"></A><ACLASS="indexterm"NAME="AUTOID-13038"></A>The C shell has only one possible filename for its automatic historyfile: <EMCLASS="emphasis">.history</EM>.If you set the C shell variable<EMCLASS="emphasis">savehist</EM> in each of your windows (e.g., by setting it in your<EMCLASS="emphasis">.cshrc</EM>), they will all try to write <EMCLASS="emphasis">.history</EM> at once,leading to trouble.And even if that weren't true, you get thehistory from every window or host, which might not be what you want.</P><PCLASS="para">Of course, you could set <EMCLASS="emphasis">savehist</EM> manually in a single window when you thought you might be doing work you might want to pick uplater. But there is another way:use the C shell's command <EMCLASS="emphasis">history -h</EM> (which prints the history listwithout leading numbers, so it can be read back in later) and redirectthe output to a file. Then use <EMCLASS="emphasis">source -h</EM> to read it back intoyour history list when you log in.</P><PCLASS="para">Do you want to automate this?First, you'll need to choose a system of filenames, like<EMCLASS="emphasis">~/.history.window</EM><CODECLASS="replaceable"><I>n</I></CODE> or <EMCLASS="emphasis">~/.history.</EM><CODECLASS="replaceable"><I>hostname</I></CODE>,to match each file to its window or host.If each of your C shells is a<SPANCLASS="link">login shell\** (<ACLASS="linkend"HREF="ch02_08.htm"TITLE="Identifying Login Shells ">2.8</A>)</SPAN>,[1]you can run <EMCLASS="emphasis">history -h</EM> from your <EMCLASS="emphasis">.logout</EM> file and<EMCLASS="emphasis">source -h</EM> from your <EMCLASS="emphasis">.login</EM> file.For non-login shells, automation is tougher&nbsp;- try this:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] In the<SPANCLASS="link">X Window System (<ACLASS="linkend"HREF="ch01_31.htm"TITLE="The X Window System ">1.31</A>)</SPAN>,set the <EMCLASS="emphasis">xterm&nbsp;-ls</EM> optionto force a login shell.</P></BLOCKQUOTE><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Set the<SPANCLASS="link"><EMCLASS="emphasis">ignoreeof</EM> variable (<ACLASS="linkend"HREF="ch03_05.htm"TITLE="Stop Accidental C Shell Logouts ">3.5</A>)</SPAN>to force you to leave the shell with an<SPANCLASS="link"><EMCLASS="emphasis">exit</EM> (<ACLASS="linkend"HREF="ch38_04.htm"TITLE="Subshells ">38.4</A>)</SPAN>command.</P></LI><LICLASS="listitem"><PCLASS="para">Set an<SPANCLASS="link">alias for <EMCLASS="emphasis">exit</EM> (<ACLASS="linkend"HREF="ch10_06.htm"TITLE="Avoiding C Shell Alias Loops ">10.6</A>)</SPAN>that runs <EMCLASS="emphasis">history -h</EM> before exiting.&#13;</P></LI><LICLASS="listitem"><PCLASS="para">Run <EMCLASS="emphasis">source -h</EM> from your<EMCLASS="emphasis">.cshrc</EM> file.Use a<SPANCLASS="link"><CODECLASS="literal">$?prompt</CODE> test (<ACLASS="linkend"HREF="ch02_09.htm"TITLE="Speeding Up Your C Shell with set prompt Test ">2.9</A>)</SPAN>to be sure this only runs in interactive shells.</P></LI></UL><PCLASS="para">If you choose to run <EMCLASS="emphasis">history -h</EM> and <EMCLASS="emphasis">source -h</EM> by handoccasionally, they will allow you the kind of control you need to<SPANCLASS="link">write a script (<ACLASS="linkend"HREF="ch11_12.htm"TITLE="Pass History to Another Shell ">11.12</A>)</SPAN>that saves and restores only what you want.</P></DIV><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN>, <SPANCLASS="authorinitials">TOR</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_10.htm"TITLE="11.10 Check Your History First with :p "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 11.10 Check Your History First with :p "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_12.htm"TITLE="11.12 Pass History to Another Shell "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 11.12 Pass History to Another Shell "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">11.10 Check Your History First with :p </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">11.12 Pass History to Another Shell </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>