<HTML><HEAD><TITLE>[Chapter 11] 11.14 More Ways to Do Interactive History Editing </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:36:17Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch11_01.htm"TITLE="11. The Lessons of History"><LINKREL="prev"HREF="ch11_13.htm"TITLE="11.13 Shell Command-Line Editing "><LINKREL="next"HREF="ch11_15.htm"TITLE="11.15 Changing C Shell History Characters with histchars "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_13.htm"TITLE="11.13 Shell Command-Line Editing "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 11.13 Shell Command-Line Editing "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 11<BR>The Lessons of History</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_15.htm"TITLE="11.15 Changing C Shell History Characters with histchars "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 11.15 Changing C Shell History Characters with histchars "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-9010">11.14 More Ways to Do Interactive History Editing </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13273"></A><ACLASS="indexterm"NAME="AUTOID-13275"></A><SPANCLASS="link"><EMCLASS="emphasis">tcsh</EM> (<ACLASS="linkend"HREF="ch08_03.htm"TITLE="Introduction to tcsh">8.3</A>)</SPAN>is a version of <EMCLASS="emphasis">csh</EM> that provides history editing (among otherthings).If you don't want to switch to <EMCLASS="emphasis">tcsh</EM>, you can simulate history editing using <EMCLASS="emphasis">redo</EM>.If you're using <EMCLASS="emphasis">bash</EM> or <EMCLASS="emphasis">ksh</EM>, you probably already know aboutyour shell's editing&nbsp;- but you may not know about its <EMCLASS="emphasis">fc</EM> command.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-9010-SECT-1.1">11.14.1 In the C Shell: redo </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13289"></A><ACLASS="indexterm"NAME="AUTOID-13291"></A><EMCLASS="emphasis">redo</EM> is a C shell script that is run by being<SPANCLASS="link">sourced (<ACLASS="linkend"HREF="ch44_23.htm"TITLE="Reading Files with the . and source Commands ">44.23</A>)</SPAN>into the current shell using an alias.The original version was posted to Usenet in the 1980s, author unknown.The version shown here was reposted in 1987 by Dave Patterson.The alias puts you in an <EMCLASS="emphasis">ex</EM><SPANCLASS="link">open-mode (<ACLASS="linkend"HREF="ch30_36.htm"TITLE="The ex Open Mode Can Be Handy ">30.36</A>)</SPAN>editing buffer, a comfortable environment for <EMCLASS="emphasis">vi</EM> users.You can browse through theprevious 22 commands and press RETURN when you wantto execute the current line.Before executing, youcan edit the commands as you would in <EMCLASS="emphasis">vi</EM>.You can even search for strings using <CODECLASS="literal">/</CODE>; just remember to press ESC instead of RETURN after the search string.</P><PCLASS="para">To use <EMCLASS="emphasis">redo</EM>, first install it <SPANCLASS="link">read-only with <EMCLASS="emphasis">no</EM> execute permission (<ACLASS="linkend"HREF="ch22_02.htm"TITLE="Tutorial on File and Directory Permissions ">22.2</A>)</SPAN>,and then create an alias with the script's<SPANCLASS="link">absolute pathname (<ACLASS="linkend"HREF="ch14_02.htm"TITLE="Using Relative and Absolute Pathnames ">14.2</A>)</SPAN>to execute it:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">alias r source ~/.lib/redo</PRE></BLOCKQUOTE></P><PCLASS="para">When you run the alias, it reads a set of commands from the<SPANCLASS="link">sourceable script file (<ACLASS="linkend"HREF="ch10_05.htm"TITLE="Sourceable Scripts ">10.5</A>)</SPAN>.</P><PCLASS="para">Here's the <EMCLASS="emphasis">redo</EM> script:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch45_35.htm"TITLE="45.35 Using a Control Character in a Script ">echo...33'</A> <ACLASS="co"HREF="ch31_02.htm"TITLE="31.2 Save Time and Typing with the vi map Commands ">map</A> <ACLASS="co"HREF="ch25_14.htm"TITLE="25.14 How to Look at the End of a File: tail ">tail</A> <ACLASS="co"HREF="ch11_07.htm"TITLE="11.7 History Substitutions ">!...</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">&#13;history -h 22 &gt;! /tmp/redo.$$# Put CR in $c[1] and ESC in $c[2]:set c=(`echo &quot;m e&quot; | tr me '\015\033'`)# Make CR map to :wq! and start ex quietly at 2nd to last line in open mode.(setenv EXINIT &quot;map $c[1] :.wq\!$c[2]|map! $c[1] ${c[2]}:.wq\!$c[2]&quot;;\   ex '+$-1 open' /tmp/redo.$$)tail -1 /tmp/redo.$$ &gt;! /tmp/cmd.$$# Insert into history without executing.source -h /tmp/cmd.$$# Clear out temporaries./bin/rm -f /tmp/{cmd,redo}.$$unset c# If thing chosen to redo is the redo alias itself then DON'T redo it.if (!-2:0 != !!:0) !!</PRE></TD></TR></TABLE></P><PCLASS="para">Type <CODECLASS="literal">r</CODE> to invoke the alias.Then use cursor motion keys (<CODECLASS="literal">jk</CODE>) to get to the line you want to edit.Edit the line (remember that you're in the<SPANCLASS="link">open mode (<ACLASS="linkend"HREF="ch30_36.htm"TITLE="The ex Open Mode Can Be Handy ">30.36</A>)</SPAN>of <EMCLASS="emphasis">ex</EM>).When you're done,press RETURN. (Don't type <CODECLASS="literal">ZZ</CODE> or <CODECLASS="literal">q</CODE>.)</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-9010-SECT-1.2">11.14.2 In ksh and bash: fc </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-13328"></A><ACLASS="indexterm"NAME="AUTOID-13330"></A><ACLASS="indexterm"NAME="AUTOID-13333"></A><ACLASS="indexterm"NAME="AUTOID-13336"></A><EMCLASS="emphasis">ksh</EM> and <EMCLASS="emphasis">bash</EM> have a built-in command called <EMCLASS="emphasis">fc</EM>(for &quot;fix command&quot;).It's like <EMCLASS="emphasis">redo</EM>, but more powerful.We'll cover the basics here; check your shell's manpage or itsNutshell Handbook for details.</P><PCLASS="para">To see a list of your previous commands, use the option <CODECLASS="literal">-l</CODE> (lowercase L,for &quot;list&quot;):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <CODECLASS="userinput"><B>fc -l</B></CODE>   ...19      ls -F20      less expn.c21      vi $_22      make23      expn info@ora.com24      fc -l</PRE></BLOCKQUOTE></P><PCLASS="para">To get a shorter list, give <EMCLASS="emphasis">fc</EM> the first number or name you wantto list.For instance, <CODECLASS="literal">fc&nbsp;-l&nbsp;vi</CODE> or <CODECLASS="literal">fc&nbsp;-l 21</CODE> would give the lastfour lines above.</P><PCLASS="para"><EMCLASS="emphasis">fc</EM> can call a UNIX editor (<EMCLASS="emphasis">vi</EM>, <EMCLASS="emphasis">emacs</EM>, <EMCLASS="emphasis">pico</EM>, etc.)to edit one or more of the previous commands.You can name an editor with the <EMCLASS="emphasis">-e</EM> option each time you use <EMCLASS="emphasis">fc</EM>,but it's probably easier to store the editor in the <EMCLASS="emphasis">FCEDIT</EM> shellvariable (in your<SPANCLASS="link"><EMCLASS="emphasis">.profile</EM> or <EMCLASS="emphasis">.bashrc</EM> files (<ACLASS="linkend"HREF="ch02_02.htm"TITLE="Shell Setup Files-Which, Where, and Why ">2.2</A>)</SPAN>).</P><PCLASS="para">To edit the commands above, between <CODECLASS="literal">vi</CODE> and <CODECLASS="literal">expn</CODE>,you would type <CODECLASS="literal">fc&nbsp;v&nbsp;e</CODE> or <CODECLASS="literal">fc&nbsp;21&nbsp;23</CODE>.Your editor will start with the three command lines in it.You can make any changes you want: add commands, rearrange them,and so on.When you exit the editor, the commands you saved with your editorwill be executed.If you change your mind and don't want to execute anything, just deleteall lines in your editor before you save&nbsp;- or replace them with a dummycommand like <CODECLASS="literal">echo&nbsp;hi</CODE>.</P></DIV><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">LM</SPAN>, <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_13.htm"TITLE="11.13 Shell Command-Line Editing "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 11.13 Shell Command-Line Editing "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch11_15.htm"TITLE="11.15 Changing C Shell History Characters with histchars "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 11.15 Changing C Shell History Characters with histchars "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">11.13 Shell Command-Line Editing </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">11.15 Changing C Shell History Characters with histchars </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>