<HTML><HEAD><TITLE>[Chapter 14] 14.14 Automatic Setup When You Enter/Exit a Directory </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:37:14Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch14_01.htm"TITLE="14. Moving Around in a Hurry"><LINKREL="prev"HREF="ch14_13.htm"TITLE="14.13 Which Directory Am I in, Really? "><LINKREL="next"HREF="ch15_01.htm"TITLE="15. Wildcards"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch14_13.htm"TITLE="14.13 Which Directory Am I in, Really? "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 14.13 Which Directory Am I in, Really? "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 14<BR>Moving Around in a Hurry</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch15_01.htm"TITLE="15. Wildcards"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 15. Wildcards"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0243">14.14 Automatic Setup When You Enter/Exit a Directory </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15863"></A><ACLASS="indexterm"NAME="AUTOID-15866"></A>If you work in a lot of different directories, here's a way to make theshell do automatic setup when you enter a directory or cleanup as you leave.We've broken it onto two lines for printing; enter it as one line.On <EMCLASS="emphasis">bash</EM>, make a shell function instead; there's also a Korn shellversion on the disc:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&#13;alias cd 'if (-o .exit.csh) source .exit.csh; chdir \!*;    if (-o .enter.csh) source .enter.csh'cd() {   test -r .exit.sh &amp;&amp; . .exit.sh   builtin cd &quot;$1&quot;                  # builtin is a bash command   test -r .enter.sh &amp;&amp; . .enter.sh}</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-15875"></A><ACLASS="indexterm"NAME="AUTOID-15877"></A>Then create <EMCLASS="emphasis">.enter.csh</EM> and/or <EMCLASS="emphasis">.exit.csh</EM> filesin the directories whereyou want a custom setup.Bourne-type shell users, make <EMCLASS="emphasis">.enter.sh</EM> and/or <EMCLASS="emphasis">.exit.sh</EM>files instead.When you <EMCLASS="emphasis">cd</EM> to a new directory, an <EMCLASS="emphasis">.exit</EM> file is<SPANCLASS="link"><EMCLASS="emphasis">source</EM>d (<ACLASS="linkend"HREF="ch44_23.htm"TITLE="Reading Files with the . and source Commands ">44.23</A>)</SPAN>into your current shellbefore you leave the old directory.As you enter the new directory, an <EMCLASS="emphasis">.enter</EM> file will be read if it exists.If you use<ACLASS="indexterm"NAME="AUTOID-15888"></A><ACLASS="indexterm"NAME="AUTOID-15890"></A><SPANCLASS="link"><EMCLASS="emphasis">pushd</EM> and <EMCLASS="emphasis">popd</EM> (<ACLASS="linkend"HREF="ch14_06.htm"TITLE="The Shells' pushd and popd Commands ">14.6</A>)</SPAN>,you'll probably want to make the samekind of aliases or functions for them.</P><PCLASS="para">The C shell alias tests to be sure you own the files;this helps to stop other usersfrom leaving surprises for you!But if lots of users will be sharing the directory, they may all want toshare the same files&nbsp;- in that case, replace the <EMCLASS="emphasis">&nbsp;- o</EM> tests with<EMCLASS="emphasis">-r</EM> (true if the file is readable).Article<ACLASS="xref"HREF="ch47_04.htm"TITLE="C Shell Variable Operators and Expressions ">47.4</A>describes C shell tests like <EMCLASS="emphasis">-o</EM>;in <EMCLASS="emphasis">sh</EM>-like shells, use<SPANCLASS="link"><EMCLASS="emphasis">test</EM> (<ACLASS="linkend"HREF="ch44_20.htm"TITLE="test: Testing Files and Strings ">44.20</A>)</SPAN>(the <EMCLASS="emphasis">bash</EM> ownership <EMCLASS="emphasis">test</EM> operator is <CODECLASS="literal">-O</CODE>).</P><PCLASS="para">Here's a sample <EMCLASS="emphasis">.enter.csh</EM> file:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch22_04.htm"TITLE="22.4 Setting an Exact umask ">umask</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen"># Save previous umask; reset in .exit.csh:set prevumask=`umask`# Let everyone in the group edit my files here:umask 002echo &quot;.enter.csh: setting umask to 002&quot;# Prompt (with blank line before) to keep me awake:set prompt=&quot;\$cwd - PROJECT DEVELOPMENT DIRECTORY.  EDIT CAREFULLY...\% &quot;</PRE></TD></TR></TABLE></P><PCLASS="para">&#13;and the <EMCLASS="emphasis">.exit.csh</EM> to go with it:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch47_03.htm"TITLE="47.3 Conditional Statements with if ">if</A> <ACLASS="co"HREF="ch47_04.htm"TITLE="47.4 C Shell Variable Operators and Expressions ">$?</A> <ACLASS="co"HREF="ch07_05.htm"TITLE="7.5 Multiline Shell Prompts ">setprompt</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen"># .enter.csh file may put old umask in shell variable:if ($?prevumask) then   umask $prevumask   echo &quot;.exit.csh: setting umask to $prevumask&quot;   unset prevumaskendif# Reminder to come back here if need to:echo &quot;If you didn't check in the RCS files, type 'cd $cwd'.&quot;# Set generic prompt (setprompt alias comes from .cshrc file):setprompt</PRE></TD></TR></TABLE></P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> <ACLASS="indexterm"NAME="AUTOID-15924"></A><ACLASS="indexterm"NAME="AUTOID-15927"></A><ACLASS="indexterm"NAME="AUTOID-15929"></A><ACLASS="indexterm"NAME="AUTOID-15932"></A><ACLASS="indexterm"NAME="AUTOID-15935"></A>The <EMCLASS="emphasis">umask</EM> set in the <EMCLASS="emphasis">.enter</EM> file for some directory will also setthe permissions for files you create in other directories with commandsthat use pathnames&nbsp;- like<CODECLASS="literal">vi</CODE>&nbsp;<CODECLASS="literal">/</CODE><CODECLASS="replaceable"><I>somedir</I></CODE><CODECLASS="literal">/</CODE><CODECLASS="replaceable"><I>somefile</I></CODE>.</P></BLOCKQUOTE><PCLASS="para">Can more than one of your directories use the same <EMCLASS="emphasis">.enter</EM> or <EMCLASS="emphasis">.exit</EM>file?<ACLASS="indexterm"NAME="AUTOID-15948"></A><ACLASS="indexterm"NAME="AUTOID-15950"></A><ACLASS="indexterm"NAME="AUTOID-15953"></A>If they can, you'll save disk space and redundant editing by making<SPANCLASS="link">hard links (<ACLASS="linkend"HREF="ch18_04.htm"TITLE="More About Links ">18.4</A>)</SPAN>between the files.If the directories are on different filesystems, you'll have to use a<SPANCLASS="link">symbolic link (<ACLASS="linkend"HREF="ch18_04.htm"TITLE="More About Links ">18.4</A>)</SPAN>-though that probably won't save disk space.If you link the files, you should probably add a comment that remindsyou of the links when you make your next edit.When your <EMCLASS="emphasis">.enter</EM> files get really long, you might be able to put acommand like this in them:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch44_23.htm"TITLE="44.23 Reading Files with the . and source Commands ">source</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">source ~/.global_enter</PRE></TD></TR></TABLE></P><PCLASS="para">where the <EMCLASS="emphasis">.global_enter</EM> file in your home directory has aprocedure that you want to run from a lot of your <EMCLASS="emphasis">.enter</EM> files.(Same goes for <EMCLASS="emphasis">.exit</EM>, of course.)</P><PCLASS="para">One last idea: if a lot of users share the same directory, they can makefiles with names like <EMCLASS="emphasis">.enter.joanne</EM>, <EMCLASS="emphasis">.exit.allan</EM>, and so on.Your aliases can test for a file named<CODECLASS="literal">.enter.</CODE><SPANCLASS="link"><CODECLASS="literal">$user</CODE> (<ACLASS="linkend"HREF="ch06_09.htm"TITLE="Special C Shell Variables ">6.9</A>)</SPAN>(if your UNIX has a 14-character filenamelimit, you'll need a shorter name).</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch14_13.htm"TITLE="14.13 Which Directory Am I in, Really? "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 14.13 Which Directory Am I in, Really? "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch15_01.htm"TITLE="15. Wildcards"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 15. Wildcards"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">14.13 Which Directory Am I in, Really? </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">15. Wildcards</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>