<HTML><HEAD><TITLE>[Chapter 16] 16.25 Listing Files by Age and Size </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:38:02Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch16_01.htm"TITLE="16. Where Did I Put That?"><LINKREL="prev"HREF="ch16_24.htm"TITLE="16.24 Counting Files by Types "><LINKREL="next"HREF="ch16_26.htm"TITLE="16.26 Finding Text Files with findtext "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch16_24.htm"TITLE="16.24 Counting Files by Types "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 16.24 Counting Files by Types "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 16<BR>Where Did I Put That?</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch16_26.htm"TITLE="16.26 Finding Text Files with findtext "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 16.26 Finding Text Files with findtext "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0415">16.25 Listing Files by Age and Size </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-17815"></A><ACLASS="indexterm"NAME="AUTOID-17818"></A><ACLASS="indexterm"NAME="AUTOID-17820"></A><ACLASS="indexterm"NAME="AUTOID-17822"></A>If you find a large directory, and most of the files are new, thatdirectory may not be suitable for removal, as it is still being used.Here is a script that lists a summary of file sizes, broken down into the time of last modification.<ACLASS="indexterm"NAME="AUTOID-17825"></A>You may remember that <EMCLASS="emphasis">ls -l</EM> will list the month, day, hour, and minuteif the file is less than six months old, and show the month, day, andyear if the file is more than six months old. Using this, the scriptcreates a summary for each of the last six months, and each year forfiles older than that:<ACLASS="indexterm"NAME="AUTOID-17829"></A></P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch45_12.htm"TITLE="45.12 Parameter Substitution ">${*:-.}</A> <ACLASS="co"HREF="ch09_21.htm"TITLE="9.21 Handle Too-Long Command Lines with xargs ">xargs</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">&#13;#!/bin/sh# usage: age_files [directory ...]# lists size of files by age## pick which version of ls you use#   System V#LS=&quot;ls -ls&quot;#   BerkeleyLS=&quot;ls -lsg&quot;#find ${*:-.} -type f -print | xargs $LS | awk  '# argument 7 is the month; argument 9 is either hh:mm or yyyy# test if argument is hh:mm or yyyy format{   if ($9 !~ /:/) {      sz[$9]+=$1;   } else {      sz[$7]+=$1;   }}END {   for (i in sz) printf(&quot;%d\t%s\n&quot;, sz[i], i);}' | sort -nr</PRE></TD></TR></TABLE></P><PCLASS="para">The program might generate results like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">5715   19913434   19922929   19891738   Dec1495   19901227   Jan1119   Nov953   Oct61   Aug40   Sep</PRE></BLOCKQUOTE></P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">BB</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch16_24.htm"TITLE="16.24 Counting Files by Types "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 16.24 Counting Files by Types "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch16_26.htm"TITLE="16.26 Finding Text Files with findtext "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 16.26 Finding Text Files with findtext "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">16.24 Counting Files by Types </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">16.26 Finding Text Files with findtext </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>