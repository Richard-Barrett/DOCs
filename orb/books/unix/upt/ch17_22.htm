<HTML><HEAD><TITLE>[Chapter 17] 17.22 Finding the Links to a File </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:38:41Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch17_01.htm"TITLE="17. Finding Files with find"><LINKREL="prev"HREF="ch17_21.htm"TITLE="17.21 lookfor: Which File Has that Word? "><LINKREL="next"HREF="ch17_23.htm"TITLE="17.23 Finding Files with -prune "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_21.htm"TITLE="17.21 lookfor: Which File Has that Word? "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 17.21 lookfor: Which File Has that Word? "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 17<BR>Finding Files with find</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_23.htm"TITLE="17.23 Finding Files with -prune "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 17.23 Finding Files with -prune "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0366">17.22 Finding the Links to a File </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-19762"></A><ACLASS="indexterm"NAME="AUTOID-19765"></A><ACLASS="indexterm"NAME="AUTOID-19768"></A><ACLASS="indexterm"NAME="AUTOID-19772"></A><ACLASS="indexterm"NAME="AUTOID-19776"></A>Here is how to find links&nbsp;- anda brief look at the UNIX filesystem from the user's viewpoint.Suppose you are given the following:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>ls -li /usr/foo</B></CODE> 2076 -rw-r--r--  3 chris         326 Sep 16 03:23 /usr/foo</PRE></BLOCKQUOTE></P><PCLASS="para">In other words, there are three links, and <EMCLASS="emphasis">/usr/foo</EM> is one ofthree names for<SPANCLASS="link">inode (<ACLASS="linkend"HREF="ch01_22.htm"TITLE="How UNIX Keeps Track of Files: Inodes ">1.22</A>)</SPAN>2076.You can find the full names of the other two linksby using <EMCLASS="emphasis">/etc/ncheck</EM> and/or <EMCLASS="emphasis">find</EM>. However, just knowingthe inode number does not tell you everything.</P><PCLASS="para">The whole truth is that there is another number hiding away in<ACLASS="indexterm"NAME="AUTOID-19788"></A>there. This is the <EMCLASS="emphasis">device number</EM>, and it tells which<EMCLASS="emphasis">filesystem</EM> holds the file. There can be any number of inode2076s, as long as each one is on a different filesystem.<ACLASS="indexterm"NAME="AUTOID-19792"></A>(More recent UNIX systems use a <EMCLASS="emphasis">filesystem ID number</EM> in place ofa device number, so that they can represent filesystems on othermachines.<ACLASS="indexterm"NAME="AUTOID-19796"></A>They may also use a <EMCLASS="emphasis">vnode number</EM> rather than an inode number.The effect is the same, although you often cannot run <EMCLASS="emphasis">/etc/ncheck</EM>on anything but a local disk.)</P><PCLASS="para">You can find out which filesystem <EMCLASS="emphasis">/usr/foo</EM> is in by running<SPANCLASS="link"><EMCLASS="emphasis">df</EM> (<ACLASS="linkend"HREF="ch24_09.htm"TITLE="How Much Disk Space? ">24.9</A>)</SPAN><ACLASS="indexterm"NAME="AUTOID-19804"></A><ACLASS="indexterm"NAME="AUTOID-19806"></A>or <EMCLASS="emphasis">mount</EM>. Suppose it is on <EMCLASS="emphasis">/dev/sd0g</EM>. If <EMCLASS="emphasis">/dev/sd0g</EM>shows up as:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>df</B></CODE>Filesystem    kbytes    used   avail capacity  Mounted on/dev/sd0g     179423  152202    9278    94%    /usr% <CODECLASS="userinput"><B>ls -l /dev/sd0g</B></CODE>brw------  1 root       2,   6 Dec 27 07:17 /dev/sd0g</PRE></BLOCKQUOTE></P><PCLASS="para">then it is &quot;major device 2, minor device 6.&quot; These numbers aresmashed together with the <EMCLASS="emphasis">makedev</EM> macro in one of the kernelsource files. Typically this is just <EMCLASS="emphasis">major</EM>*256 + <EMCLASS="emphasis">minor</EM>;here we have 2*256+6, or 518. Another way to find this same numberis to use the <EMCLASS="emphasis">stat</EM>(2) system call on the original file <EMCLASS="emphasis">/usr/foo</EM>;the device number appears in the <CODECLASS="literal">st_dev</CODE> field.[The<SPANCLASS="link"><EMCLASS="emphasis">stat</EM> (<ACLASS="linkend"HREF="ch21_13.htm"TITLE="Read an Inode with stat ">21.13</A>)</SPAN>program does this for you. <EMCLASS="emphasis">-JP</EM>&nbsp;]</P><PCLASS="para">So if you do a <CODECLASS="literal">find&nbsp;/&nbsp;-inum&nbsp;2076&nbsp;-print</CODE> to find every file withinode number&nbsp;2076, you may find more than three files. Only threeof them will be on <EMCLASS="emphasis">sd0g</EM>, though.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">CT</SPAN> <SPANCLASS="bibliomisc">in <ACLASS="systemitem.newsgroup"HREF="news:net.unix">net.unix</A> on Usenet, 15 January 1985</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_21.htm"TITLE="17.21 lookfor: Which File Has that Word? "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 17.21 lookfor: Which File Has that Word? "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_23.htm"TITLE="17.23 Finding Files with -prune "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 17.23 Finding Files with -prune "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">17.21 lookfor: Which File Has that Word? </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">17.23 Finding Files with -prune </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>