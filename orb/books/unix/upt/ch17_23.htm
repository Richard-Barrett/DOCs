<HTML><HEAD><TITLE>[Chapter 17] 17.23 Finding Files with -prune </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:38:43Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch17_01.htm"TITLE="17. Finding Files with find"><LINKREL="prev"HREF="ch17_22.htm"TITLE="17.22 Finding the Links to a File "><LINKREL="next"HREF="ch17_24.htm"TITLE="17.24 Skipping Some Parts of a Tree in find (A More Selective -prune)"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_22.htm"TITLE="17.22 Finding the Links to a File "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 17.22 Finding the Links to a File "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 17<BR>Finding Files with find</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_24.htm"TITLE="17.24 Skipping Some Parts of a Tree in find (A More Selective -prune)"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 17.24 Skipping Some Parts of a Tree in find (A More Selective -prune)"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0473">17.23 Finding Files with -prune </A></H2><PCLASS="para"><EMCLASS="emphasis">find</EM> has lots of operators for finding some particular kinds of files.<ACLASS="indexterm"NAME="AUTOID-19834"></A>But <EMCLASS="emphasis">find</EM> won't stop at your current directory&nbsp;- if there aresubdirectories, it looks there too.How can you tell it &quot;only the current directory&quot;?Use <EMCLASS="emphasis">-prune</EM>.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> If your version of <EMCLASS="emphasis">find</EM> doesn't have <EMCLASS="emphasis">-prune</EM>, this won't work.Try GNU <EMCLASS="emphasis">find</EM> on the CD-ROM.</P></BLOCKQUOTE><PCLASS="para"><EMCLASS="emphasis">-prune</EM> prunes <EMCLASS="emphasis">find</EM>'s search tree at the current pathname.So, if the current pathname is a directory, <EMCLASS="emphasis">find</EM> won't descend into thatdirectory for any further searches.The command line looks kind of hairy.Here's one to find all files from the current directory modified in the last24 hours:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>find . \( -type d ! -name . -prune \) -o \( -mtime -1 -print \)</B></CODE>./afile./cfile</PRE></BLOCKQUOTE></P><PCLASS="para">I'll put that into an alias in a minute.First let's try to understand it&nbsp;- once you see the pattern, you'll understandsome<SPANCLASS="link">important things (<ACLASS="linkend"HREF="ch08_05.htm"TITLE="Command-Line Evaluation ">8.5</A>, <ACLASS="linkend"HREF="ch17_12.htm"TITLE="Finding Many Things with One Command ">17.12</A>)</SPAN>about <EMCLASS="emphasis">find</EM> that many people don't.Let's follow <EMCLASS="emphasis">find</EM> as it looks at a few pathnames.</P><PCLASS="para"><EMCLASS="emphasis">find</EM> looks at each entry, one by one, in the current directory(<CODECLASS="literal">.</CODE>).For each entry, <EMCLASS="emphasis">find</EM> tries to match the expression from left to right.As soon as some part matches, it ignores the rest (if any)of the expression.</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">When <EMCLASS="emphasis">find</EM> is looking at the file named <EMCLASS="emphasis">./afile</EM>:The first part of the expression, <CODECLASS="literal">\(&nbsp;-type&nbsp;d&nbsp;!&nbsp;-name&nbsp;.&nbsp;-prune&nbsp;\)</CODE>,doesn't match (<EMCLASS="emphasis">./afile</EM> isn't a directory).So <EMCLASS="emphasis">find</EM> tries the other part, after the <CODECLASS="literal">-o</CODE> (or).</P><PCLASS="para">Has <EMCLASS="emphasis">./afile</EM> been modified in the last day?In this case, it has&nbsp;- so the <CODECLASS="literal">-print</CODE> (which is always true) printsthe pathname.</P></LI><LICLASS="listitem"><PCLASS="para">Next, <EMCLASS="emphasis">./bfile</EM>:Like the previous step, the first part of the expression won't match.In the second part, <CODECLASS="literal">\(&nbsp;-mtime&nbsp;-1&nbsp;-print&nbsp;\)</CODE>, the file's modification time is more than one day ago.So this part of the expression is false; <EMCLASS="emphasis">find</EM> doesn't botherwith the <CODECLASS="literal">-print</CODE> operator.</P></LI><LICLASS="listitem"><PCLASS="para">Finally, let's look at <EMCLASS="emphasis">./adir</EM>, a directory:The first part of the expression, <CODECLASS="literal">\(&nbsp;-type&nbsp;d&nbsp;!&nbsp;-name&nbsp;.&nbsp;-prune&nbsp;\)</CODE>,matches.That's because <EMCLASS="emphasis">./adir</EM> is a directory (<CODECLASS="literal">-type&nbsp;d</CODE>),its name is not <CODECLASS="literal">.</CODE> (<CODECLASS="literal">!&nbsp;-name&nbsp;.</CODE>)-and so <CODECLASS="literal">-prune</CODE>,which is always true, makes this part of the expression true.<EMCLASS="emphasis">find</EM> skips <EMCLASS="emphasis">./adir</EM>.</P></LI></OL><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-19890"></A>Your <EMCLASS="emphasis">find</EM> may also have a <EMCLASS="emphasis">-maxdepth</EM> option that gives themaximum number of directory levels to descend.For example, <CODECLASS="literal">find&nbsp;. -maxdepth&nbsp;0</CODE> operates only on the currentdirectory.</P><PCLASS="para">Let's put the version with <EMCLASS="emphasis">-prune</EM> into a couple of aliases.The first one, named <EMCLASS="emphasis">find.</EM> (with a dot on the end of its name), justprints names with <EMCLASS="emphasis">-print</EM>.The second alias gives a listing like <EMCLASS="emphasis">ls -gilds</EM>.They work like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>find. -mtime -1</B></CODE>./afile./cfile% <CODECLASS="userinput"><B>find.ls -mtime -1</B></CODE>43073   0 -r----  1 jerry    ora        0 Mar 27 18:16 ./afile43139   2 -r-r-r-  1 jerry    ora     1025 Mar 24 02:33 ./cfile</PRE></BLOCKQUOTE></P><PCLASS="para">The <EMCLASS="emphasis">find.</EM> alias is handy inside<SPANCLASS="link">backquotes (<ACLASS="linkend"HREF="ch09_16.htm"TITLE="Command Substitution ">9.16</A>)</SPAN>,feeding a pipe, and other places you need a list of filenames.Here are the aliases.The second one, <EMCLASS="emphasis">find.ls</EM>, uses <EMCLASS="emphasis">-ls</EM> instead of <EMCLASS="emphasis">-print</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&#13;alias find. 'find . \( -type d ! -name . -prune \) -o \( \!* -print \)'alias find.ls 'find . \( -type d ! -name . -prune \) -o \( \!* -ls \)'</PRE></BLOCKQUOTE></P><PCLASS="para">(The Bourne shell versions on the CD-ROMare named <EMCLASS="emphasis">Find</EM> and <EMCLASS="emphasis">Findls</EM> because a dot isn't legal in afunction name.)</P><PCLASS="para">If you don't want the <CODECLASS="literal">./</CODE> at the start of each name, add a pipethrough<SPANCLASS="link"><CODECLASS="literal">colrm&nbsp;1&nbsp;2</CODE> (<ACLASS="linkend"HREF="ch35_15.htm"TITLE="Cutting Columns with colrm ">35.15</A>)</SPAN>or<SPANCLASS="link"><CODECLASS="literal">cut&nbsp;-c3-</CODE> (<ACLASS="linkend"HREF="ch35_14.htm"TITLE="Cutting Columns or Fields with cut ">35.14</A>)</SPAN>to the end of the alias definition.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_22.htm"TITLE="17.22 Finding the Links to a File "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 17.22 Finding the Links to a File "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch17_24.htm"TITLE="17.24 Skipping Some Parts of a Tree in find (A More Selective -prune)"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 17.24 Skipping Some Parts of a Tree in find (A More Selective -prune)"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">17.22 Finding the Links to a File </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">17.24 Skipping Some Parts of a Tree in find (A More Selective -prune)</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>