<HTML><HEAD><TITLE>[Chapter 18] 18.2 What's Really in a Directory </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:38:51Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch18_01.htm"TITLE="18. Linking, Renaming, and Copying Files"><LINKREL="prev"HREF="ch18_01.htm"TITLE="18.1 What's So Complicated About Copying Files? "><LINKREL="next"HREF="ch18_03.htm"TITLE="18.3 Files with Two or More Names"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_01.htm"TITLE="18.1 What's So Complicated About Copying Files? "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 18.1 What's So Complicated About Copying Files? "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 18<BR>Linking, Renaming, and Copying Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_03.htm"TITLE="18.3 Files with Two or More Names"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 18.3 Files with Two or More Names"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-1450">18.2 What's Really in a Directory </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-20082"></A>Before you can understand moving and copying files, you need to knowa bit more about how files are represented in directories.What does it mean to say that a file is really &quot;in&quot; a directory?It's easy to imagine that files are actually inside of something(some special chunk of the disk that's called a directory).But that's precisely wrong, and it's one place where the<SPANCLASS="link">filing cabinet model (<ACLASS="linkend"HREF="ch01_19.htm"TITLE="The Tree Structure of the Filesystem ">1.19</A>)</SPAN>of a filesystem doesn't apply.</P><PCLASS="para">A directory really is just another file, and really isn't differentfrom any other data file.If you want to prove this, try the command<ACLASS="indexterm"NAME="AUTOID-20087"></A><CODECLASS="literal">od&nbsp;-c&nbsp;.</CODE>; on many UNIX systems,it dumps the current directory to the screen in raw form.It will certainly look ugly (it's not a text file&nbsp;- it has lotsof binary characters).But, if your system allows it,<SPANCLASS="link"><EMCLASS="emphasis">od&nbsp;-c</EM> (<ACLASS="linkend"HREF="ch25_07.htm"TITLE="Show Non-Printing Characters with cat -v or od -c ">25.7</A>)</SPAN>should let you see the names of the files that are inthe current directory[and, probably, some names of files that have been deleted!Sorry, they're only the old directory entries;<SPANCLASS="link">you can't get the files back (<ACLASS="linkend"HREF="ch23_02.htm"TITLE="rm and Its Dangers ">23.2</A>)</SPAN>.<EMCLASS="emphasis">-JP</EM>].If <EMCLASS="emphasis">od&nbsp;-c</EM> doesn't work, use <CODECLASS="literal">ls&nbsp;-if</CODE> instead.</P><PCLASS="para">So a directory is really just a list of files. It contains filenamesand<SPANCLASS="link">inode numbers (<ACLASS="linkend"HREF="ch01_22.htm"TITLE="How UNIX Keeps Track of Files: Inodes ">1.22</A>)</SPAN>.That is, we can visualize a directory like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">The file named    .          is inode 34346The file named    ..         is inode 987The file named    mr.ed      is inode 10674The file named    joe.txt    is inode 8767The file named    grok       is inode 67871The file named    otherdir   is inode 2345</PRE></BLOCKQUOTE></P><PCLASS="para">So when you give a filename like <EMCLASS="emphasis">grok</EM>, the kernel looks up<EMCLASS="emphasis">grok</EM> in the current directory and finds out that this file has inode67871; it looks up this inode to find out who owns the file,where the data blocks are, and so on.</P><PCLASS="para">What's more, some of these &quot;files&quot; may be directories in their ownright. In particular, that's true of the first two entries:<CODECLASS="literal">.</CODE>and <CODECLASS="literal">..</CODE>. These entries are in <EMCLASS="emphasis">every</EM> directory.Single <CODECLASS="literal">.</CODE> just refers to the current directory, while double <CODECLASS="literal">..</CODE>refers to the &quot;parent&quot; of the current directory (i.e., the directorythat &quot;contains&quot; the current directory). The file <EMCLASS="emphasis">otherdir</EM> isyet another directory that happens to be &quot;within&quot; the current directory.But there's no way you can tell that from its directory entry-UNIXdoesn't know it's different until it looks up its inode.</P><PCLASS="para">Now that you know what a directory is, let's think about some basicoperations. What does it mean to move, or rename, a file? If the<ACLASS="indexterm"NAME="AUTOID-20112"></A><ACLASS="indexterm"NAME="AUTOID-20114"></A><ACLASS="indexterm"NAME="AUTOID-20117"></A><ACLASS="indexterm"NAME="AUTOID-20119"></A><ACLASS="indexterm"NAME="AUTOID-20123"></A><ACLASS="indexterm"NAME="AUTOID-20126"></A><ACLASS="indexterm"NAME="AUTOID-20129"></A><ACLASS="indexterm"NAME="AUTOID-20131"></A>file is staying in the same directory, the <EMCLASS="emphasis">mv</EM> command just changes the file's name in the directory; it doesn't touch the data at all.</P><PCLASS="para">Moving a file into another directory takes a little more work, but notmuch. A command like <EMCLASS="emphasis">mv&nbsp;dir1/foo&nbsp;dir2/foo</EM> means &quot;delete <EMCLASS="emphasis">foo</EM>'sentry in <EMCLASS="emphasis">dir1</EM>, and create a new entry for <EMCLASS="emphasis">foo</EM> in <EMCLASS="emphasis">dir2</EM>.&quot; Again, UNIX doesn't have to touch the data blocks or the inode at all.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-20142"></A>The only time you actually need to copy data is if you're moving afile into another filesystem. In that case, you have to copy thefile to the new filesystem; delete its old directory entry; return thefile's data blocks to the &quot;free list,&quot; which means that they can be re-used; and so on.It's a fairly complicated operation, but (still) relatively rare.(On some old versions of UNIX, <EMCLASS="emphasis">mv</EM> won't let you move filesbetween filesystems.)</P><PCLASS="para">Now let's see if you've understood. How does UNIX find out the name ofthe current directory? In our &quot;current directory,&quot; there's an entryfor <CODECLASS="literal">.</CODE>, which tells us that the current directory has inode34346. Is the directory's name part of the inode? Sorry&nbsp;- it isn't.The directory's name is included in the parent directory. Theparent directory is <CODECLASS="literal">..</CODE>, which is inode 987. So UNIX looks upinode 987, finds out where the data is, and starts reading every entryin the parent directory. Sooner or later, it will find one thatcorresponds to inode 34346. When it does that, it knows that it has found thedirectory entry for the current directory, and can read its name.Article<ACLASS="xref"HREF="ch14_04.htm"TITLE="How Does UNIX Find Your Current Directory? ">14.4</A>has a diagram and more explanation.</P><PCLASS="para">Complicated? Yes, but if you understand this, you have a pretty goodidea of how UNIX directories work.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">ML</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_01.htm"TITLE="18.1 What's So Complicated About Copying Files? "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 18.1 What's So Complicated About Copying Files? "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_03.htm"TITLE="18.3 Files with Two or More Names"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 18.3 Files with Two or More Names"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">18.1 What's So Complicated About Copying Files? </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">18.3 Files with Two or More Names</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>