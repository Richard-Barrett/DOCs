<HTML><HEAD><TITLE>[Chapter 18] 18.6 Stale Symbolic Links </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:39:01Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch18_01.htm"TITLE="18. Linking, Renaming, and Copying Files"><LINKREL="prev"HREF="ch18_05.htm"TITLE="18.5 Creating and Removing Links "><LINKREL="next"HREF="ch18_07.htm"TITLE="18.7 Linking Directories "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_05.htm"TITLE="18.5 Creating and Removing Links "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 18.5 Creating and Removing Links "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 18<BR>Linking, Renaming, and Copying Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_07.htm"TITLE="18.7 Linking Directories "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 18.7 Linking Directories "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-5751">18.6 Stale Symbolic Links </A></H2><PCLASS="para">Symbolic links have one problem. Like good bread, they become &quot;stale&quot;fairly easily. What does that mean?</P><PCLASS="para">Consider the following commands:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>ln -s foo bar</B></CODE>% <CODECLASS="userinput"><B>rm foo</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">What happens when you do this?Remember that the link <EMCLASS="emphasis">bar</EM> is a pointer: it doesn't have anyreal data of its own. Its data is the name of the file <EMCLASS="emphasis">foo</EM>.After deleting <EMCLASS="emphasis">foo</EM>, the link <EMCLASS="emphasis">bar</EM> still exists, but itpoints to a nonexistent file. Commands that refer to <EMCLASS="emphasis">bar</EM> willget a confusing error message:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cat bar</B></CODE>cat: bar: No such file or directory</PRE></BLOCKQUOTE></P><PCLASS="para">This will drive you crazy if you're not careful. An <EMCLASS="emphasis">ls</EM> willshow you that <EMCLASS="emphasis">bar</EM> still exists. You won't understand what'sgoing on until you realize that <EMCLASS="emphasis">bar</EM> is only a pointer to a filethat no longer exists.<ACLASS="indexterm"NAME="AUTOID-20481"></A><ACLASS="indexterm"NAME="AUTOID-20484"></A>[The command <EMCLASS="emphasis">ls -Ll</EM> or <EMCLASS="emphasis">ls -LF</EM> will show an unconnectedsymbolic link.The <EMCLASS="emphasis">-L</EM> option means &quot;list the file that this link points toinstead of the link itself.&quot;If the link points nowhere, <EMCLASS="emphasis">ls -L</EM> will still list the link. <EMCLASS="emphasis">-JP</EM>&nbsp;]</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-20493"></A><ACLASS="indexterm"NAME="AUTOID-20496"></A><ACLASS="indexterm"NAME="AUTOID-20498"></A>There are many innocuous ways of creating invalid symbolic links. Forexample, you could simply <EMCLASS="emphasis">mv</EM> the data file <EMCLASS="emphasis">foo</EM>. Or youcould move <EMCLASS="emphasis">foo</EM>, <EMCLASS="emphasis">bar</EM>, or both to some other part of thefilesystem where the pointer wouldn't be valid anymore.</P><PCLASS="para">One way to avoid problems with invalid links is to use<SPANCLASS="link">relative pathnames (<ACLASS="linkend"HREF="ch01_21.htm"TITLE="Making Pathnames ">1.21</A>)</SPAN>when it is appropriate.For example, using relativepathnames will let you move entire directory trees around withoutinvalidating links (providing that both the file and the link are inthe same tree). Here's an example. Assume that you have the file <EMCLASS="emphasis">/home/mars/john/project/datastash/input123.txt</EM>. Assume thatyou want to link this file to <EMCLASS="emphasis">/home/mars/john/test/input.txt</EM>.You create a link by giving the command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cd /home/mars/john/test</B></CODE>% <CODECLASS="userinput"><B>ln -s ../project/datastash/input123.txt input.txt</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">At some later date, you hand the project over to <EMCLASS="emphasis">mary</EM>, who<SPANCLASS="link">copies (<ACLASS="linkend"HREF="ch18_16.htm"TITLE="Copying Directory Trees with (tar | tar) ">18.16</A>)</SPAN>the entire <EMCLASS="emphasis">project</EM> and <EMCLASS="emphasis">test</EM> data trees intoher home directory. The link between <EMCLASS="emphasis">input.txt</EM> and the realfile, <EMCLASS="emphasis">input123.txt</EM>, will still be valid. Although both files'names have changed, the relationship between the two (i.e., therelative path from one directory to the other) is still the same.Alternatively, assume that you are assigned to a different computernamed <EMCLASS="emphasis">jupiter</EM> and that you copy your entire home directorywhen you move. Again, the link remains valid: the relative path fromyour <EMCLASS="emphasis">test</EM> directory to your <EMCLASS="emphasis">datastash</EM> directory hasn'tchanged, even though the absolute paths of both directories aredifferent.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-20524"></A>On the other hand, there is certainly room for<SPANCLASS="link">absolute pathnames (<ACLASS="linkend"HREF="ch14_02.htm"TITLE="Using Relative and Absolute Pathnames ">14.2</A>)</SPAN>.They're useful if you're more likely to move the link than theoriginal file.Assume that you are creating a link from your working directory to afile in a master directory (let's say<EMCLASS="emphasis">/corp/masterdata/input345.txt</EM>). It is much more likely that you will rearrange your working directory than that someone will move themaster set of files. In this case, you would link as follows:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>ln -s /corp/masterdata/input345.txt input.txt</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Now you can move the link <EMCLASS="emphasis">input.txt</EM> anywhere in the filesystem:it will still be valid, provided that <EMCLASS="emphasis">input345.txt</EM> never moves.</P><PCLASS="para">In article<ACLASS="xref"HREF="ch16_28.htm"TITLE="oldlinks: Find Unconnected Symbolic Links ">16.28</A>,we give a script for detecting stale symbolic links.</P><PCLASS="para">Note that<SPANCLASS="link">hard links (<ACLASS="linkend"HREF="ch18_04.htm"TITLE="More About Links ">18.4</A>)</SPAN>never have this problem. With a hard link,there is no difference at all between the link and theoriginal&nbsp;- in fact, it's unfair to call one file the link and theother the original.<ACLASS="indexterm"NAME="AUTOID-20538"></A><ACLASS="indexterm"NAME="AUTOID-20539"></A></P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">ML</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_05.htm"TITLE="18.5 Creating and Removing Links "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 18.5 Creating and Removing Links "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_07.htm"TITLE="18.7 Linking Directories "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 18.7 Linking Directories "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">18.5 Creating and Removing Links </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">18.7 Linking Directories </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>