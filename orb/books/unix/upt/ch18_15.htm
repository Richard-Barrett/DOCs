<HTML><HEAD><TITLE>[Chapter 18] 18.15 Copying Directory Trees with cp -r </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:39:12Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch18_01.htm"TITLE="18. Linking, Renaming, and Copying Files"><LINKREL="prev"HREF="ch18_14.htm"TITLE="18.14 Relinking Multiple Symbolic Links "><LINKREL="next"HREF="ch18_16.htm"TITLE="18.16 Copying Directory Trees with (tar | tar) "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_14.htm"TITLE="18.14 Relinking Multiple Symbolic Links "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 18.14 Relinking Multiple Symbolic Links "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 18<BR>Linking, Renaming, and Copying Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_16.htm"TITLE="18.16 Copying Directory Trees with (tar | tar) "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 18.16 Copying Directory Trees with (tar | tar) "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-5480">18.15 Copying Directory Trees with cp -r </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="UPT-ART-5480-IX-CP-COMMAND-R-OPTION"></A><ACLASS="indexterm"NAME="UPT-ART-5480-IX-TREES-DIRECTORY-COPYING"></A><ACLASS="indexterm"NAME="UPT-ART-5480-IX-COPYING-DIRECTORY-TREES"></A><ACLASS="indexterm"NAME="AUTOID-20951"></A>Some versions of <EMCLASS="emphasis">cp</EM> have a <EMCLASS="emphasis">-r</EM> (recursive) flag.It copies all the files in a directorytree&nbsp;- that is, all the files in a directory and its subdirectories.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> One of our UNIX systems has a <EMCLASS="emphasis">cp</EM> without a <EMCLASS="emphasis">-r</EM> option.But it also has an<ACLASS="indexterm"NAME="AUTOID-20960"></A><SPANCLASS="link"><EMCLASS="emphasis">rcp</EM> (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>command that <EMCLASS="emphasis">does</EM> have <EMCLASS="emphasis">-r</EM>.<EMCLASS="emphasis">rcp</EM> can copy to any machine, not just remote machines.When I need <EMCLASS="emphasis">cp -r</EM> on that host, I use <EMCLASS="emphasis">rcp -r</EM>.</P></BLOCKQUOTE><PCLASS="para">The first argument(s) to <EMCLASS="emphasis">cp -r</EM> can be directory(s)-or, if you name anyfile(s), they'll be copied just the way they would without the <EMCLASS="emphasis">-r</EM>.The last argument should be a directory.So, you can use <EMCLASS="emphasis">cp -r</EM> in two ways:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Give <EMCLASS="emphasis">cp -r</EM> directory(s) to copy.They'll be created as subdirectories of the directory named at the end.</P></LI><LICLASS="listitem"><PCLASS="para">Give <EMCLASS="emphasis">cp -r</EM> file(s) to copy.They'll be copied to the directory named at the end.</P></LI></UL><PCLASS="para">Those two methods are really doing the same thing.They're both copying the tail of the first pathname(s) to the end of the lastpathname.</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Here's how to do the copy shown in<ACLASS="xref"HREF="ch18_15.htm#UPT-ART-5480-FIG-0"TITLE="Copying /home/jane to Current Directory (/work/bkup) with cp">Figure 18.1</A>.This copies the directory <EMCLASS="emphasis">/home/jane</EM>, with all its files andsubdirectories, and creates a subdirectory named <EMCLASS="emphasis">jane</EM> in the<SPANCLASS="link">current directory <CODECLASS="literal">.</CODE> (<ACLASS="linkend"HREF="ch01_21.htm"TITLE="Making Pathnames ">1.21</A>)</SPAN>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cd /work/bkup</B></CODE>% <CODECLASS="userinput"><B>cp -r /home/jane .</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para">How can you copy the contents of the subdirectory called <EMCLASS="emphasis">data</EM> and allits files (but not the subdirectory itself) into aduplicate directory named <EMCLASS="emphasis">data.bak</EM>?First create the destinationdirectory.That's because the last argument to <EMCLASS="emphasis">cp -r</EM> must be a directory thatalready exists:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cd /home/jane</B></CODE>% <CODECLASS="userinput"><B>mkdir data.bak</B></CODE>% <CODECLASS="userinput"><B>cp -r data/* data.bak</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">That doesn't copy any files in <EMCLASS="emphasis">data</EM> whose names start with a dot(<CODECLASS="literal">.</CODE>).There's<SPANCLASS="link">a way (<ACLASS="linkend"HREF="ch15_05.htm"TITLE='Matching All "Dot Files&quot; with Wildcards'>15.5</A>)</SPAN>to do that though.</P><H4CLASS="figure"><ACLASS="title"NAME="UPT-ART-5480-FIG-0">Figure 18.1: Copying /home/jane to Current Directory (/work/bkup) with cp</A></H4><IMGCLASS="graphic"SRC="figs/5480.gif"ALT="Figure 18.1"></LI><LICLASS="listitem"><PCLASS="para">To copy the subdirectories <EMCLASS="emphasis">Sep</EM> and<EMCLASS="emphasis">Oct</EM> and their files, as well as the file <EMCLASS="emphasis">Output</EM>, fromthe directory <EMCLASS="emphasis">/home/jim/calendar</EM> into the current directory (<CODECLASS="literal">.</CODE>):</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch15_02.htm"TITLE="15.2 Filename Wildcards in a Nutshell ">[..]*</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>cp -r /home/jim/calendar/[SO]* .</B></CODE></PRE></TD></TR></TABLE></P><PCLASS="para">If you use the C shell or <EMCLASS="emphasis">bash</EM>, you can copy just the directories by using thehandy<SPANCLASS="link">curly brace operators (<ACLASS="linkend"HREF="ch09_05.htm"TITLE="Build Strings with {&nbsp;} ">9.5</A>)</SPAN>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cp -r /home/jim/calendar/{Sep,Oct} .</B></CODE></PRE></BLOCKQUOTE></P></LI></UL><PCLASS="para">Some gotchas:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para"><SPANCLASS="link">Symbolic and hard links (<ACLASS="linkend"HREF="ch18_04.htm"TITLE="More About Links ">18.4</A>)</SPAN><ACLASS="indexterm"NAME="AUTOID-21034"></A><ACLASS="indexterm"NAME="AUTOID-21037"></A><ACLASS="indexterm"NAME="AUTOID-21040"></A><ACLASS="indexterm"NAME="AUTOID-21043"></A>are copied as files.That can be good because, at the destination, a symbolic link mightpoint to the wrong place.It can be bad if the link pointed to a really big file;the copy can take a lot of disk space.(In<ACLASS="xref"HREF="ch18_15.htm#UPT-ART-5480-FIG-0"TITLE="Copying /home/jane to Current Directory (/work/bkup) with cp">Figure 18.1</A>notice that the symbolic link in <EMCLASS="emphasis">jane</EM>'s homedirectory was converted to a file named <EMCLASS="emphasis">.setup</EM> with a copy of thecontents of <EMCLASS="emphasis">generic</EM>.)&#13;</P></LI><LICLASS="listitem"><PCLASS="para">On many UNIXes, the copy will be dated at the time you made the copy andmay have its permissions set by your<SPANCLASS="link"><EMCLASS="emphasis">umask</EM> (<ACLASS="linkend"HREF="ch22_04.htm"TITLE="Setting an Exact umask ">22.4</A>)</SPAN>.If you want the copy to have the originalmodification time and permissions,add the <EMCLASS="emphasis">-p</EM> option.</P></LI><LICLASS="listitem"><PCLASS="para"><EMCLASS="emphasis">cp -r</EM> will go into an endless loop if you name a directory inthe list to copy from and also as the destination directory.For example, let's say you're copying everything from the current directoryinto an existing subdirectory named <EMCLASS="emphasis">backup</EM>, like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cp -r * backup</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Unless your <EMCLASS="emphasis">cp -r</EM> works differently from the ones I've tried, itwill create <EMCLASS="emphasis">backup/backup</EM>, and <EMCLASS="emphasis">backup/backup/backup</EM>, and so on.To avoid that, replace the <CODECLASS="literal">*</CODE> wildcard with other less-&quot;wild&quot;wildcards.You can also match everything except the destination directory name byusing<SPANCLASS="link">the <EMCLASS="emphasis">ksh</EM> <CODECLASS="literal">!</CODE> operator, the <EMCLASS="emphasis">tcsh</EM> <CODECLASS="literal">^</CODE> operator (<ACLASS="linkend"HREF="ch15_02.htm"TITLE="Filename Wildcards in a Nutshell ">15.2</A>)</SPAN>,or<SPANCLASS="link">the <EMCLASS="emphasis">nom</EM> script (<ACLASS="linkend"HREF="ch15_09.htm"TITLE="nom: List Files that Don't Match a Wildcard ">15.9</A>)</SPAN>.</P></LI></UL><ACLASS="indexterm"NAME="AUTOID-21074"></A><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_14.htm"TITLE="18.14 Relinking Multiple Symbolic Links "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 18.14 Relinking Multiple Symbolic Links "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_16.htm"TITLE="18.16 Copying Directory Trees with (tar | tar) "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 18.16 Copying Directory Trees with (tar | tar) "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">18.14 Relinking Multiple Symbolic Links </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">18.16 Copying Directory Trees with (tar | tar) </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>