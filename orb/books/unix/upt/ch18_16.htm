<HTML><HEAD><TITLE>[Chapter 18] 18.16 Copying Directory Trees with (tar | tar) </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:39:14Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch18_01.htm"TITLE="18. Linking, Renaming, and Copying Files"><LINKREL="prev"HREF="ch18_15.htm"TITLE="18.15 Copying Directory Trees with cp -r "><LINKREL="next"HREF="ch19_01.htm"TITLE="19. Creating and Reading Archives"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_15.htm"TITLE="18.15 Copying Directory Trees with cp -r "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 18.15 Copying Directory Trees with cp -r "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 18<BR>Linking, Renaming, and Copying Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch19_01.htm"TITLE="19. Creating and Reading Archives"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 19. Creating and Reading Archives"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-6890">18.16 Copying Directory Trees with (tar | tar) </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21080"></A>The<SPANCLASS="link"><EMCLASS="emphasis">tar</EM> (<ACLASS="linkend"HREF="ch19_05.htm"TITLE="Using tar to Create and Unpack Archives ">19.5</A>)</SPAN>command isn't just for tape archives.It can copy files from disk to disk, too.And even if your computer has<SPANCLASS="link"><EMCLASS="emphasis">cp -r</EM> (<ACLASS="linkend"HREF="ch18_15.htm"TITLE="Copying Directory Trees with cp -r ">18.15</A>)</SPAN>,there are advantages to using <EMCLASS="emphasis">tar</EM>.</P><PCLASS="para">The obvious way to copy directories with <EMCLASS="emphasis">tar</EM> is to write them ontoa tape archive with relative pathnames&nbsp;- then read back the tape andwrite it somewhere else on the disk.But <EMCLASS="emphasis">tar</EM> can also write to a UNIX pipe&nbsp;- and read from a pipe.This looks like:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="replaceable"><I>reading-tar</I></CODE> <CODECLASS="userinput"><B>|</B></CODE> <CODECLASS="replaceable"><I>writing-tar</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">with one trick:the <CODECLASS="replaceable"><I>writing-tar</I></CODE> process<SPANCLASS="link">has a different current directory (<ACLASS="linkend"HREF="ch38_03.htm"TITLE="Managing Processes: Overall Concepts ">38.3</A>, <ACLASS="linkend"HREF="ch38_04.htm"TITLE="Subshells ">38.4</A>)</SPAN>(the place where you want the copy made) than the <CODECLASS="replaceable"><I>reading-tar</I></CODE>.To do that, run the <CODECLASS="replaceable"><I>writing-tar</I></CODE> in a<SPANCLASS="link">subshell (<ACLASS="linkend"HREF="ch13_07.htm"TITLE="The () Subshell Operators ">13.7</A>)</SPAN>.</P><PCLASS="para">The argument(s) to the <CODECLASS="replaceable"><I>reading-tar</I></CODE> can be directory(s) or file(s).Just be sure to use<SPANCLASS="link">relative pathnames (<ACLASS="linkend"HREF="ch14_02.htm"TITLE="Using Relative and Absolute Pathnames ">14.2</A>)</SPAN>that don't start with a slash&nbsp;- otherwise, the <CODECLASS="replaceable"><I>writing-tar</I></CODE> will write thecopies in the same place the originals came from!</P><PCLASS="para">&quot;How about an example,&quot; you ask?<ACLASS="xref"HREF="ch18_16.htm#UPT-ART-6890-FIG-0"TITLE="Copying /home/jane to /work/bkup with tar">Figure 18.2</A>has one.It copies from the directory <EMCLASS="emphasis">/home/jane</EM>, with all its files andsubdirectories.The copy is made in the directory <EMCLASS="emphasis">/work/bkup/jane</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>mkdir /work/bkup/jane</B></CODE>% <CODECLASS="userinput"><B>cd /home/jane</B></CODE>% <CODECLASS="userinput"><B>tar cf - . | (cd /work/bkup/jane &amp;&amp; tar xBf -)</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The<SPANCLASS="link"><CODECLASS="userinput"><B>&amp;&amp;</B></CODE> operator (<ACLASS="linkend"HREF="ch44_09.htm"TITLE="Testing Your Success ">44.9</A>)</SPAN>tells the shell to start <CODECLASS="literal">tar xBf</CODE> only if the previous command(the <CODECLASS="literal">cd</CODE>) succeeded.That prevents <EMCLASS="emphasis">tar</EM> writing files into the same directory it's readingfrom&nbsp;- if the destination directory isn't accessible or you flub its pathname.<ACLASS="indexterm"NAME="AUTOID-21121"></A>If your <EMCLASS="emphasis">tar</EM> has a <EMCLASS="emphasis">B</EM> (reblocking) option, use it to help be surethat the copy is made correctly.If your <EMCLASS="emphasis">tar</EM> doesn't have a reblocking option, you can use thistrick suggested by Chris Torek:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tar cf - . | cat | (cd /work/backup/jane &amp;&amp; tar xbf 1 -)</B></CODE></PRE></BLOCKQUOTE></P><BLOCKQUOTECLASS="caution"><PCLASS="para"><STRONG>CAUTION:</STRONG> <ACLASS="indexterm"NAME="AUTOID-21132"></A>At least one <EMCLASS="emphasis">tar</EM> version has a <EMCLASS="emphasis">v</EM> (verbose) option that<SPANCLASS="link"> writes the verbose text to standard output instead of standard error ! (<ACLASS="linkend"HREF="ch19_08.htm"TITLE="Problems with Verbose tar ">19.8</A>)</SPAN>If your <EMCLASS="emphasis">tar</EM> does that, don't use <EMCLASS="emphasis">v</EM> on the <CODECLASS="replaceable"><I>reading-tar</I></CODE>(the <EMCLASS="emphasis">tar</EM> that feeds the pipe)-use <EMCLASS="emphasis">v</EM> on the <CODECLASS="replaceable"><I>writing-tar</I></CODE>.</P></BLOCKQUOTE><PCLASS="para">You can use other options that your <EMCLASS="emphasis">tar</EM> might have-like<SPANCLASS="link">excluding files or directories (<ACLASS="linkend"HREF="ch20_08.htm"TITLE="Telling tar Which Files to Exclude or Include ">20.8</A>)</SPAN>-on the <CODECLASS="replaceable"><I>reading-tar</I></CODE>, too.Some gotchas:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para"><SPANCLASS="link">Symbolic links (<ACLASS="linkend"HREF="ch18_04.htm"TITLE="More About Links ">18.4</A>)</SPAN>will be copied exactly.If they point to relative pathnames, the copied links might pointto locations that don't exist.You can search for these symbolic links with<SPANCLASS="link"><EMCLASS="emphasis">find -type l</EM> (<ACLASS="linkend"HREF="ch17_13.htm"TITLE="Searching for Files by Type ">17.13</A>)</SPAN>or<SPANCLASS="link"><EMCLASS="emphasis">oldlinks</EM> (<ACLASS="linkend"HREF="ch16_28.htm"TITLE="oldlinks: Find Unconnected Symbolic Links ">16.28</A>)</SPAN>.</P></LI><LICLASS="listitem"><PCLASS="para">A<SPANCLASS="link">hard link (<ACLASS="linkend"HREF="ch18_04.htm"TITLE="More About Links ">18.4</A>)</SPAN>will be copied as a file.If there are more hard links to that file in the files you're copying,they will be linked to the copy of the first link.That can be good because the destination might be on a differentfilesystem (a hard link to the original file can't work then).It can be bad if the link pointed to a really big file;the copy can take a lot of disk space.You can search for these hard links by:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Searching the directory from which you're copying with<SPANCLASS="link"><EMCLASS="emphasis">find -links +1 -type f</EM> (<ACLASS="linkend"HREF="ch17_05.htm"TITLE="Searching for Old Files ">17.5</A>)</SPAN>to find all files that have more than one link, and</P></LI><LICLASS="listitem"><PCLASS="para">Running the <CODECLASS="replaceable"><I>reading-tar</I></CODE> with its <EMCLASS="emphasis">l</EM> (lowercase letter L) option to complain if it didn't copy all links to a file.</P></LI></UL></LI></UL><H4CLASS="figure"><ACLASS="title"NAME="UPT-ART-6890-FIG-0">Figure 18.2: Copying /home/jane to /work/bkup with tar</A></H4><IMGCLASS="graphic"SRC="figs/6890.gif"ALT="Figure 18.2"><PCLASS="para">If your system has<SPANCLASS="link"><EMCLASS="emphasis">rsh</EM> (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>,you can run the <CODECLASS="replaceable"><I>writing-tar</I></CODE> on a remote system.For example, to copy a directory to the computer named <EMCLASS="emphasis">kumquat</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>rsh kumquat mkdir /work/bkup/jane</B></CODE>% <CODECLASS="userinput"><B>tar cf - . | rsh kumquat 'cd /work/bkup/jane &amp;&amp; tar xBf -'</B></CODE></PRE></BLOCKQUOTE></P><ACLASS="indexterm"NAME="AUTOID-21180"></A><ACLASS="indexterm"NAME="AUTOID-21181"></A><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch18_15.htm"TITLE="18.15 Copying Directory Trees with cp -r "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 18.15 Copying Directory Trees with cp -r "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch19_01.htm"TITLE="19. Creating and Reading Archives"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 19. Creating and Reading Archives"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">18.15 Copying Directory Trees with cp -r </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">19. Creating and Reading Archives</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>