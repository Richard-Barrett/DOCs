<HTML><HEAD><TITLE>[Chapter 19] 19.2 Introduction to Shell Archives </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:39:22Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch19_01.htm"TITLE="19. Creating and Reading Archives"><LINKREL="prev"HREF="ch19_01.htm"TITLE="19.1 Packing Up and Moving "><LINKREL="next"HREF="ch19_03.htm"TITLE="19.3 unshar: Unarchive a Shell Archive "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch19_01.htm"TITLE="19.1 Packing Up and Moving "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 19.1 Packing Up and Moving "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 19<BR>Creating and Reading Archives</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch19_03.htm"TITLE="19.3 unshar: Unarchive a Shell Archive "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 19.3 unshar: Unarchive a Shell Archive "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-3680">19.2 Introduction to Shell Archives </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="UPT-ART-3680-IX-SHELL-ARCHIVES"></A><ACLASS="indexterm"NAME="AUTOID-21215"></A>A shell archive or <EMCLASS="emphasis">shar</EM> file is a single file that contains one ormore other files.Files are extracted from the archive with the standard UNIX<SPANCLASS="link">Bourne shell (<ACLASS="linkend"HREF="ch44_03.htm"TITLE="What's a Shell, Anyway? ">44.3</A>)</SPAN>.A shell archive usually doesn't let you save and restore complete directoryhierarchies like<SPANCLASS="link"><EMCLASS="emphasis">cpio</EM> (<ACLASS="linkend"HREF="ch19_09.htm"TITLE="A System V Tape Archiver: cpio ">19.9</A>)</SPAN>and<SPANCLASS="link"><EMCLASS="emphasis">tar</EM> (<ACLASS="linkend"HREF="ch19_05.htm"TITLE="Using tar to Create and Unpack Archives ">19.5</A>)</SPAN>do, butit is completely portable and, as a result, is usedextensively on Usenet,an international network with many UNIX systems.</P><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="shar">shar</A><BR></TH><TDVALIGN="TOP">In the Bourne shell,<ACLASS="indexterm"NAME="AUTOID-21224"></A><SPANCLASS="link">the operator <CODECLASS="literal">&lt;&lt;</CODE> (<ACLASS="linkend"HREF="ch08_18.htm"TITLE="Here Documents ">8.18</A>)</SPAN>meansto take the following lines, up to a specified string,as input to a command.<ACLASS="indexterm"NAME="AUTOID-21229"></A>(This is often called a <EMCLASS="emphasis">here document</EM>.)Using this syntax and the<SPANCLASS="link"><EMCLASS="emphasis">cat</EM> (<ACLASS="linkend"HREF="ch25_02.htm"TITLE="Four Ways to Skin a cat ">25.2</A>)</SPAN>and<SPANCLASS="link"><EMCLASS="emphasis">echo</EM> (<ACLASS="linkend"HREF="ch08_06.htm"TITLE="Output Command-Line Arguments ">8.6</A>)</SPAN>commands, you can write a simple shell archiver (<EMCLASS="emphasis">shar</EM>)like the one below.<ACLASS="indexterm"NAME="AUTOID-21237"></A>Incidentally, manysystems already have<EMCLASS="emphasis">shar</EM> programsin place; thereare severalfreely available versions,including the one on the CD-ROM.Just about any of them are likely to be more sophisticated than theversion shown here&nbsp;- but this version shows the essence of how they work:</TD></TR></TABLE><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch44_16.htm"TITLE="44.16 Handling Command-Line Arguments with a for Loop ">for</A> <ACLASS="co"HREF="ch08_18.htm"TITLE="8.18 Here Documents ">&lt;&lt;</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">#!/bin/shfor filedo    echo &quot;echo restoring $file&quot;    echo &quot;cat &gt; $file &lt;&lt; 'XxXxXxXxXx-EOF-XxXxXxXxXx'&quot;    cat $file    echo &quot;XxXxXxXxXx-EOF-XxXxXxXxXx&quot;done</PRE></TD></TR></TABLE></P><PCLASS="para">The string <CODECLASS="literal">XxXxXxXxXx-EOF-XxXxXxXxXx</CODE> isentirely arbitrary&nbsp;- it just needs to be a string thatwon't otherwise appear in the input and can be usedby the shell to recognize when the here document isfinished.</P><PCLASS="para">When you give <EMCLASS="emphasis">shar</EM> a list of filenames, it willstring those files together on standard output, separating them with thatarbitrary string and the commands to split them up again.Simply redirect thisoutput stream to a file to create the archive.Forexample, the command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <CODECLASS="userinput"><B>shar file1 file2 &gt; archive.shar</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">will produce a file called <EMCLASS="emphasis">archive.shar</EM> that containsthe following data:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch45_26.htm"TITLE="45.26 Quoted hereis Document Terminators: sh vs. csh ">'...'</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">echo restoring file1cat &gt; file1 &lt;&lt; 'XxXxXxXxXx-EOF-XxXxXxXxXx'   ...<EMCLASS="emphasis">Text of file1 will be stored here</EM>   ...XxXxXxXxXx-EOF-XxXxXxXxXxecho restoring file2cat &gt; file2 &lt;&lt; 'XxXxXxXxXx-EOF-XxXxXxXxXx'   ...<EMCLASS="emphasis">Text of file2 will be stored here</EM>   ...XxXxXxXxXx-EOF-XxXxXxXxXx</PRE></TD></TR></TABLE></P><PCLASS="para">When this archive is run through <EMCLASS="emphasis">sh</EM>, the commandsit contains will be executed.Each here document(the lines from each <CODECLASS="literal">cat</CODE> up to the next<CODECLASS="literal">XxXxXxXxXx-EOF-XxXxXxXxXx</CODE>) will be outputto a file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <CODECLASS="userinput"><B>sh archive.shar</B></CODE>restoring file1restoring file2$ <CODECLASS="userinput"><B>ls</B></CODE>archive.sharfile1file2</PRE></BLOCKQUOTE></P><PCLASS="para">The<SPANCLASS="link"><EMCLASS="emphasis">unshar</EM> (<ACLASS="linkend"HREF="ch19_03.htm"TITLE="unshar: Unarchive a Shell Archive ">19.3</A>)</SPAN>program does essentially the same thing.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> You should never blindly runa shell archive supplied by someone you don't knowpersonally.<ACLASS="indexterm"NAME="AUTOID-21272"></A>An unscrupulous prankster could easilyinclude a &quot;Trojan horse&quot; command (like <CODECLASS="literal">rm&nbsp;*</CODE>) inthe middle of a seemingly innocuous archive, andcause you a lot of trouble.An easy way to do this is by browsing through the archive with the searchcommand in a program like<SPANCLASS="link"><EMCLASS="emphasis">more</EM> (<ACLASS="linkend"HREF="ch25_03.htm"TITLE="Using more to Page Through Files ">25.3</A>)</SPAN>.Use the search command (in <EMCLASS="emphasis">more</EM>, the command is <CODECLASS="literal">/</CODE>)to find each end-of-file string (like <CODECLASS="literal">XxXxXxXxXx</CODE>);look carefully at the commands between it and the <CODECLASS="literal">cat</CODE> that starts the next file.Of course, if the files in the shell archive are programs themselves,you should also check them before they're executed.<ACLASS="indexterm"NAME="AUTOID-21281"></A></P></BLOCKQUOTE><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">TOR</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch19_01.htm"TITLE="19.1 Packing Up and Moving "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 19.1 Packing Up and Moving "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch19_03.htm"TITLE="19.3 unshar: Unarchive a Shell Archive "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 19.3 unshar: Unarchive a Shell Archive "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">19.1 Packing Up and Moving </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">19.3 unshar: Unarchive a Shell Archive </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>