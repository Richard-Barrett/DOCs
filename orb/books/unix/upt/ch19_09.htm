<HTML><HEAD><TITLE>[Chapter 19] 19.9 A System V Tape Archiver: cpio </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:39:31Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch19_01.htm"TITLE="19. Creating and Reading Archives"><LINKREL="prev"HREF="ch19_08.htm"TITLE="19.8 Problems with Verbose tar "><LINKREL="next"HREF="ch20_01.htm"TITLE="20. Backing Up Files"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch19_08.htm"TITLE="19.8 Problems with Verbose tar "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 19.8 Problems with Verbose tar "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 19<BR>Creating and Reading Archives</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch20_01.htm"TITLE="20. Backing Up Files"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 20. Backing Up Files"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-3700">19.9 A System V Tape Archiver: cpio </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21611"></A><ACLASS="indexterm"NAME="AUTOID-21614"></A><ACLASS="indexterm"NAME="AUTOID-21617"></A><ACLASS="indexterm"NAME="AUTOID-21619"></A>There was a time when people used to debate whether the BSD <SPANCLASS="link"><EMCLASS="emphasis">tar</EM> (<ACLASS="linkend"HREF="ch20_01.htm#UPT-ART-8024"TITLE="tar in a Nutshell ">20.1</A>, <ACLASS="linkend"HREF="ch19_05.htm"TITLE="Using tar to Create and Unpack Archives ">19.5</A>)</SPAN>(tape archiver)or the System V <EMCLASS="emphasis">cpio</EM> (copy in/out) was the better file archive andbackup program.At this point, there's no question.No one shipsout <EMCLASS="emphasis">cpio</EM> archives over <SPANCLASS="link">the Net (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>.<EMCLASS="emphasis">tar</EM> is widespread, and because there are free versionsavailable, including<SPANCLASS="link">GNU <EMCLASS="emphasis">tar</EM> (<ACLASS="linkend"HREF="ch19_06.htm"TITLE="GNU tar Sampler ">19.6</A>)</SPAN>,there's no reason why you should have to read a <EMCLASS="emphasis">cpio</EM> archivefrom someone else.</P><PCLASS="para">Still, if you're on an older System V machine, you might use <EMCLASS="emphasis">cpio</EM>.Though we don't give it much air time in this book, hereare a few basics:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21636"></A>To write out an archive, use the <EMCLASS="emphasis">-o</EM> option and redirect outputeither to a tape device or to an archive file.The list of files tobe archived is often specified with <SPANCLASS="link"><EMCLASS="emphasis">find</EM> (<ACLASS="linkend"HREF="ch17_01.htm#UPT-ART-7410"TITLE="The find Command Is Great; The Problem Is Finding How to Use It">17.1</A>)</SPAN>,but can be generated in other ways-<EMCLASS="emphasis">cpio</EM> expects a list offilenames on its standard input.For example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>find . -name &quot;*.old&quot; -print | cpio -ocBv &gt; /dev/rst8</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">or:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>find . -print | cpio -ocBv &gt; mydir.cpio</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21653"></A><ACLASS="indexterm"NAME="AUTOID-21656"></A>To read an archive in, use the <EMCLASS="emphasis">-i</EM> option and redirect inputfrom the file or tape drive containing the archive. The <EMCLASS="emphasis">-d</EM> option isoften important; it tells <EMCLASS="emphasis">cpio</EM> to create directories as neededwhen copying files in.You can restore all files from the archiveor specify a filename pattern (with wildcards quoted to protect themfrom the shell) to selectonly some of the files.For example, thefollowing command willrestore from a tape drive all C source files:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cpio -icdv &quot;*.c&quot; &lt; /dev/rst8</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21666"></A>Subdirectories are created if needed (<EMCLASS="emphasis">-d</EM>), and <EMCLASS="emphasis">cpio</EM> willbe verbose (<EMCLASS="emphasis">-v</EM>), announcing the name of each file that itsuccessfully reads in.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21674"></A><ACLASS="indexterm"NAME="AUTOID-21677"></A>To copy an archive to another directory, use the <EMCLASS="emphasis">-o</EM> option,followed by the name of the destination directory.(This is one ofthe nicer features of <EMCLASS="emphasis">cpio</EM>.)  For example, you could use thefollowing command to copy the contentsof the current directory (including all subdirectories) to anotherdirectory:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>find . -depth -print | cpio -pd newdir</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para">There are lots of other options for things like resetting file accesstimes or ownership or changing the blocking factor on the tape.  Seeyour friendly neighborhood manual page for details.  Notice thatoptions are typically &quot;squashed together&quot; into an option string ratherthan written out as separate options.</P></LI></UL><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">TOR</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch19_08.htm"TITLE="19.8 Problems with Verbose tar "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 19.8 Problems with Verbose tar "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch20_01.htm"TITLE="20. Backing Up Files"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 20. Backing Up Files"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">19.8 Problems with Verbose tar </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">20. Backing Up Files</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>