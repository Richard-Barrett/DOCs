<HTML><HEAD><TITLE>[Chapter 20] 20.3 How to Make Backups with a Local Tape Drive </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-10-23T15:44:50Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch20_01.htm"TITLE="20. Backing Up Files"><LINKREL="prev"HREF="ch20_02.htm"TITLE="20.2 Make Your Own Backups "><LINKREL="next"HREF="ch20_04.htm"TITLE="20.4 Restoring Files from Tape with tar "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch20_02.htm"TITLE="20.2 Make Your Own Backups "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 20.2 Make Your Own Backups "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 20<BR>Backing Up Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch20_04.htm"TITLE="20.4 Restoring Files from Tape with tar "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 20.4 Restoring Files from Tape with tar "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0422">20.3 How to Make Backups with a Local Tape Drive </A></H2><PCLASS="para">As we said in article<ACLASS="xref"HREF="ch20_02.htm"TITLE="Make Your Own Backups ">20.2</A>,making a backup is easy:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cd</B></CODE>% <CODECLASS="userinput"><B>tar c .</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The<EMCLASS="emphasis">cd</EM>command moves you to your home directory.You could back up any directory the same way.</P><PCLASS="para">The<SPANCLASS="link"><EMCLASS="emphasis">tar</EM> (<ACLASS="linkend"HREF="ch20_01.htm#UPT-ART-8024"TITLE="tar in a Nutshell ">20.1</A>)</SPAN>command, which is an abbreviation of <EMCLASS="emphasis">t</EM>ape <EMCLASS="emphasis">ar</EM>chive,copies the current directory (specified by the <CODECLASS="literal">.</CODE>)to the default tape drive. The <CODECLASS="literal">c</CODE>argument specifies the<EMCLASS="emphasis">create</EM>mode of <EMCLASS="emphasis">tar</EM>.</P><PCLASS="para">You might get an error. Something about device<EMCLASS="emphasis">rmt8</EM>off line. Don't worry. I exaggerated slightly whenI said <EMCLASS="emphasis">tar</EM>was easy to use.The tape devicethat SunOS <EMCLASS="emphasis">tar</EM>uses by default is<EMCLASS="emphasis">/dev/rmt8</EM> (yours may be different).There are several types of tape units, and not allcan be referred to using that name.Some system administrators will link that name to the actualdevice, which makes <EMCLASS="emphasis">tar</EM>easier to use. But if that doesn't work, you need to specifyadditional arguments to <EMCLASS="emphasis">tar</EM>.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-422-SECT-1.1">20.3.1 Syntax of the tar Command </A></H3><PCLASS="para">Most UNIX commands follow a certain style when arguments are specified.<EMCLASS="emphasis">tar</EM>does not follow this convention, so you must be careful touse <EMCLASS="emphasis">tar</EM>properly.If the standard was followed, then the following might be an exampleof dumping the current directory to the 1/2-inch tape cartridge,verbose mode, block size of 20:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tapedump -c -v -b 20 -f /dev/rmt8 .</B></CODE>   <EMCLASS="emphasis">Wrong!</EM></PRE></BLOCKQUOTE></P><PCLASS="para">Instead, all the flags are in the first argument, and the parameters to those flags follow the first argument, in order of theflags specified:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tar cvbf 20 /dev/rmt8 .</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The same command can be specified in a different way by changing the order of the letters in the first argument:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tar cvfb /dev/rmt8 20 .</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">(Article<ACLASS="xref"HREF="ch20_11.htm"TITLE="Getting tar's Arguments in the Right Order ">20.11</A>has diagrams and more information about the order of arguments.)The only key letter that has a fixed location is the firstone, which must specify if you are reading or writing an archive.The most common key letters, and the functions they perform are listed in<ACLASS="indexterm"NAME="AUTOID-21849"></A><ACLASS="indexterm"NAME="AUTOID-21852"></A><ACLASS="indexterm"NAME="AUTOID-21855"></A><ACLASS="xref"HREF="ch20_03.htm#UPT-ART-422-TAB-0"TITLE="Common tar Key Letters">Table 20.1</A>.</P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="UPT-ART-422-TAB-0">Table 20.1: Common tar Key Letters</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Key Letter</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Function</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">c</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Create an archive.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">x</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Extract files from an archive.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">t</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Table of contents.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">v</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Give verbose information.</TD></TR></TBODY></TABLE><PCLASS="para">Some versions of <EMCLASS="emphasis">tar</EM> require a hyphen (<CODECLASS="literal">-</CODE>) before the letter.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-422-SECT-1.2">20.3.2 What Is the Name of the Tape Drive? </A></H3><PCLASS="para">Part of the difficulty in using <EMCLASS="emphasis">tar</EM>is figuring out which filename to use for which device.The best way to find out is by asking your system administrator.If you can't, here are some ideas for Sun computers.If you have a 1/2-inch tape drive, try:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tar cf /dev/rmt8 .</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">If you have a 1/4-inch tape cartridge[or any drive connected by SCSI<EMCLASS="emphasis">-JP</EM>&nbsp;], try:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tar cf /dev/rst8 .</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">If this doesn't work, then try changing the <CODECLASS="literal">8</CODE>to a<CODECLASS="literal">0</CODE>.You can also list the devices in the <EMCLASS="emphasis">/dev</EM>directory and look for one that has the most recent usage:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch16_02.htm"TITLE="16.2 Finding Oldest or Newest Files with ls -t and ls -u ">ut</A> <ACLASS="co"HREF="ch15_02.htm"TITLE="15.2 Filename Wildcards in a Nutshell ">[ ]</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>ls -lut /dev/r[ms]t*</B></CODE></PRE></TD></TR></TABLE></P><PCLASS="para"><ACLASS="indexterm"NAME="UPT-ART-422-IX-NAMING-MAGNETIC-TAPES"></A><ACLASS="indexterm"NAME="UPT-ART-422-IX-MAGNETIC-TAPES-NAMING"></A>Some UNIX systems use different standards for naming magnetic tapes.There might be an<EMCLASS="emphasis">h</EM>at the end of a name for <EMCLASS="emphasis">high density</EM>.When in doubt, examine the<SPANCLASS="link">major and minor numbers (<ACLASS="linkend"HREF="ch17_22.htm"TITLE="Finding the Links to a File ">17.22</A>)</SPAN>(using the<EMCLASS="emphasis">ls -l</EM>command) and read the appropriate manual page, whichcan be found by searching through the possible entries using<SPANCLASS="link"><EMCLASS="emphasis">man -k</EM> or <EMCLASS="emphasis">apropos</EM> (<ACLASS="linkend"HREF="ch50_02.htm"TITLE="The apropos Command ">50.2</A>)</SPAN>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>man -k mt</B></CODE>% <CODECLASS="userinput"><B>man -k tape</B></CODE></PRE></BLOCKQUOTE></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-422-SECT-1.3">20.3.3 More on Tape Names </A></H3><PCLASS="para">The names of tape devices typically start with an <EMCLASS="emphasis">r</EM>,which suggests they are<EMCLASS="emphasis">raw</EM>devices that do not support a filesystem.If the first two letters are<EMCLASS="emphasis">nr</EM>,then this suggests a<EMCLASS="emphasis">no-rewind</EM>operation.Normally the tape is automatically rewound when you are done.If you repeat the <EMCLASS="emphasis">tar</EM>command, it will overwrite the first dump.[1]As this can waste large amounts of tape if the dumps are small, use the<EMCLASS="emphasis">nr</EM>name of the tape to put several dumps on one tape.As an example, if you wanted to dump three separate directoriesto a 1/4-inch tape cartridge, you can type:&#13;</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] This is probably not what you want.You could use a new tape for each dump.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cd dir1</B></CODE>% <CODECLASS="userinput"><B>tar cf /dev/nrst8 .</B></CODE>% <CODECLASS="userinput"><B>cd dir2</B></CODE>% <CODECLASS="userinput"><B>tar cf /dev/nrst8 .</B></CODE>% <CODECLASS="userinput"><B>cd dir3</B></CODE>% <CODECLASS="userinput"><B>tar cf /dev/rst8 .</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Note that the third dump does not use theno-rewindname of the device, so that it will rewind when done.</P><PCLASS="para">To examine a tape without extracting any files, get a table of contents and use the key letter<CODECLASS="literal">t</CODE>or<CODECLASS="literal">tv</CODE>instead of the<CODECLASS="literal">c</CODE> .Adding the<CODECLASS="literal">v</CODE> flag gives a more verbose listing.</P><PCLASS="para">If you want to examine the third dump file, you can either use<EMCLASS="emphasis">tar</EM>twice with the no-rewindnames or skip forward one or more dump filesby using the<EMCLASS="emphasis">mt</EM>(magnetic tape)command to skip forward two.Be sure to use the no-rewind name:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>mt -f /dev/nrst8 fsf 2</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">In some versions of <EMCLASS="emphasis">tar</EM>,if you defined an environment variable<EMCLASS="emphasis">TAPE</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">setenv TAPE /dev/rst8</PRE></BLOCKQUOTE></P><PCLASS="para">then you don't have to specify it for the<EMCLASS="emphasis">mt</EM>or<EMCLASS="emphasis">tar</EM>commands.</P><ACLASS="indexterm"NAME="AUTOID-21959"></A><ACLASS="indexterm"NAME="AUTOID-21960"></A></DIV><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">BB</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch20_02.htm"TITLE="20.2 Make Your Own Backups "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 20.2 Make Your Own Backups "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch20_04.htm"TITLE="20.4 Restoring Files from Tape with tar "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 20.4 Restoring Files from Tape with tar "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">20.2 Make Your Own Backups </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">20.4 Restoring Files from Tape with tar </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>