<HTML><HEAD><TITLE>[Chapter 20] 20.4 Restoring Files from Tape with tar </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-10-23T15:44:52Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch20_01.htm"TITLE="20. Backing Up Files"><LINKREL="prev"HREF="ch20_03.htm"TITLE="20.3 How to Make Backups with a Local Tape Drive "><LINKREL="next"HREF="ch20_05.htm"TITLE="20.5 Using tar to a Remote Tape Drive "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch20_03.htm"TITLE="20.3 How to Make Backups with a Local Tape Drive "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 20.3 How to Make Backups with a Local Tape Drive "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 20<BR>Backing Up Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch20_05.htm"TITLE="20.5 Using tar to a Remote Tape Drive "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 20.5 Using tar to a Remote Tape Drive "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0425">20.4 Restoring Files from Tape with tar </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-21966"></A><ACLASS="indexterm"NAME="AUTOID-21969"></A>When you create an archive, there are several ways to specify the directory.If the directory is under the current directory,you could type:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tar c project</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">A similar way to specify the same directory is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tar c ./project</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">&#13;If you are currently in the directory you want archived, youcan type:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tar c .</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Another way to archive the current directory isto type:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tar c *</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Here, the shell expands the<CODECLASS="literal">*</CODE> (asterisk) to the files in the current directory.However, it does not match files starting with a <CODECLASS="literal">.</CODE> (dot),which is why the previous technique is preferred.</P><PCLASS="para">This causes a problem when restoring a directory from a<EMCLASS="emphasis">tar</EM>archive.You may not know if an archive was created using <CODECLASS="literal">.</CODE> or the directory name.</P><PCLASS="para">I always check the names of the files before restoring an archive:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tar t</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">If the archive loads the files into the current directory,I create a new directory, change to it, and extract the files.</P><PCLASS="para">If the archive restores the directory by name, thenI restore the files into the current directory.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-425-SECT-1.1">20.4.1 Restoring a Few Files </A></H3><PCLASS="para">If you want to restore a single file, get the pathnameof the file as<EMCLASS="emphasis">tar</EM>knows it, using the<ACLASS="indexterm"NAME="AUTOID-22003"></A><EMCLASS="emphasis">t</EM> flag.<ACLASS="indexterm"NAME="AUTOID-22007"></A>You must specify the exact filename, because<CODECLASS="replaceable"><I>filename</I></CODE>and <CODECLASS="literal">./</CODE><CODECLASS="replaceable"><I>filename</I></CODE>are not the same.You can combine these two steps into one commandby using [this may run very slowly<EMCLASS="emphasis">-JP</EM>&nbsp;]:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tar xvf /dev/rst0 `tar tf /dev/rst0 | grep <CODECLASS="replaceable"><I>filename</I></CODE>`</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Whenever you use<EMCLASS="emphasis">tar</EM>to restore a directory, you must alwaysspecify <EMCLASS="emphasis">some</EM>filename.If none is specified, no files are restored.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22022"></A><ACLASS="indexterm"NAME="AUTOID-22025"></A>There is still the problem of restoring a directory whose pathnamestarts with <EMCLASS="emphasis">/</EM>&nbsp;(slash).Because<EMCLASS="emphasis">tar</EM>restores a file to the pathname specified in the archive,you cannot change <EMCLASS="emphasis">where</EM>the file will be restored.The danger is that either you may overwrite some existing files oryou will not be able to restore the files because you don'thave permission.</P><PCLASS="para">You can ask the system administrator to rename a directory andtemporarily create a symbolic link pointing to a directory where you can restore the files.Other solutions exist, including editing the<EMCLASS="emphasis">tar</EM>archive and creating a new directory structure with aC program executing the<EMCLASS="emphasis">chroot</EM>(2)system call.Another solution is to use the version from the<SPANCLASS="link">Free Software Foundation (<ACLASS="linkend"HREF="glossary.htm#UPT-ART-1010"TITLE="Glossary">52.9</A>)</SPAN>that allows you to remap pathnames starting with <EMCLASS="emphasis">/</EM> (slash).It also allows you to create archives that are too large for a single tape,incremental archives, and a dozen other advantages.This freely available version of <EMCLASS="emphasis">tar</EM> is also called<SPANCLASS="link">GNU <EMCLASS="emphasis">tar</EM> (<ACLASS="linkend"HREF="ch19_06.htm"TITLE="GNU tar Sampler ">19.6</A>)</SPAN>.(It's on the disc.)</P><PCLASS="para">But the best solution is to never create an archiveof a directory that starts with <CODECLASS="literal">/</CODE>&nbsp;(slash)<EMCLASS="emphasis">or</EM><SPANCLASS="link"><CODECLASS="literal">~</CODE> (tilde) (<ACLASS="linkend"HREF="ch14_11.htm"TITLE="Finding (Anyone's) Home Directory, Quickly ">14.11</A>)</SPAN>.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-425-SECT-1.2">20.4.2 Remote Restoring </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22047"></A>To restore a directory from a remote host, use the following command:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch01_33.htm"TITLE="1.33 UNIX Networking and Communications ">rsh</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">%<CODECLASS="userinput"><B> rsh -n host dd if=/dev/rst0 bs=20b | tar xvBfb - 20 </B></CODE><CODECLASS="replaceable"><I>files</I></CODE></PRE></TD></TR></TABLE></P><PCLASS="para">Because of its nature, it is difficult to readfixed-size blocks over a network.This is why<EMCLASS="emphasis">tar</EM>uses the<EMCLASS="emphasis">B</EM>flag to force it to read from the pipeuntil a block is completely filled.[Some versions of <EMCLASS="emphasis">tar</EM>, like the one from<SPANCLASS="link">GNU (<ACLASS="linkend"HREF="glossary.htm#UPT-ART-1010"TITLE="Glossary">52.9</A>)</SPAN>on the CD-ROM,handle remote drives automatically. <EMCLASS="emphasis">-JIK</EM>&nbsp;]</P></DIV><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">BB</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch20_03.htm"TITLE="20.3 How to Make Backups with a Local Tape Drive "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 20.3 How to Make Backups with a Local Tape Drive "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch20_05.htm"TITLE="20.5 Using tar to a Remote Tape Drive "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 20.5 Using tar to a Remote Tape Drive "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">20.3 How to Make Backups with a Local Tape Drive </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">20.5 Using tar to a Remote Tape Drive </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>