<HTML><HEAD><TITLE>[Chapter 20] 20.15 List RCS Revision Numbers with rcsrevs </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-10-23T15:45:07Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch20_01.htm"TITLE="20. Backing Up Files"><LINKREL="prev"HREF="ch20_14.htm"TITLE="20.14 RCS Basics "><LINKREL="next"HREF="ch21_01.htm"TITLE="21. More About Managing Files"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch20_14.htm"TITLE="20.14 RCS Basics "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 20.14 RCS Basics "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 20<BR>Backing Up Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch21_01.htm"TITLE="21. More About Managing Files"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 21. More About Managing Files"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-9906">20.15 List RCS Revision Numbers with rcsrevs </A></H2><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="rcsrevs">rcsrevs</A><BR></TH><TDVALIGN="TOP"><ACLASS="indexterm"NAME="AUTOID-22859"></A>The <EMCLASS="emphasis">rcsrevs</EM> script tells you all the revision numbers that arestored in an<SPANCLASS="link">RCS (<ACLASS="linkend"HREF="ch20_14.htm"TITLE="RCS Basics ">20.14</A>)</SPAN>file.For instance:</TD></TR></TABLE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>rcsrevs myprog</B></CODE>1.3 1.21.11.2.1.1</PRE></BLOCKQUOTE></P><PCLASS="para">What good is that?Here are two examples.</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para"><SPANCLASS="link"><EMCLASS="emphasis">rcsgrep&nbsp;-a</EM> (<ACLASS="linkend"HREF="ch27_10.htm"TITLE="Search RCS Files with rcsgrep ">27.10</A>)</SPAN>uses <EMCLASS="emphasis">rcsrevs</EM> when it's searching all revisions of an RCS file.If you want to print all revisions, run a program across all revisionsto do some kind of check, and so on, <EMCLASS="emphasis">rcsrevs</EM> can give you therevision numbers to use in a<SPANCLASS="link">loop (<ACLASS="linkend"HREF="ch09_12.htm"TITLE="The Bourne Shell for Loop ">9.12</A>, <ACLASS="linkend"HREF="ch09_11.htm"TITLE="Repeating a Command with a foreach Loop ">9.11</A>)</SPAN>.The shell loop below gets all the revision numbers and stores them inthe <EMCLASS="emphasis">revnum</EM> shell variable one by one; it runs<SPANCLASS="link"><EMCLASS="emphasis">co -p</EM> (<ACLASS="linkend"HREF="ch20_14.htm"TITLE="RCS Basics ">20.14</A>)</SPAN>to send each revision to the<SPANCLASS="link"><EMCLASS="emphasis">pr -h</EM> (<ACLASS="linkend"HREF="ch43_07.htm"TITLE="Quick-and-Dirty Formatting Before Printing ">43.7</A>)</SPAN>command for formatting with a custom header;the output of the commands in the loop goes to the printer.</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch09_16.htm"TITLE="9.16 Command Substitution ">`...`</A> <ACLASS="co"HREF="ch09_13.htm"TITLE="9.13 Multiline Commands, Secondary Prompts ">&gt;</A> <ACLASS="co"HREF="ch45_23.htm"TITLE="45.23 The Ins and Outs of Redirected I/O Loops ">done|lpr</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">$ <CODECLASS="userinput"><B>for revnum in `rcsrevs </B></CODE><CODECLASS="replaceable"><I>somefile</I></CODE><CODECLASS="userinput"><B>`</B></CODE>&gt; <CODECLASS="userinput"><B>do</B></CODE> &gt;   <CODECLASS="userinput"><B>co -p -r$revnum </B></CODE><CODECLASS="replaceable"><I>somefile</I></CODE><CODECLASS="userinput"><B> | pr -h &quot;</B></CODE><CODECLASS="replaceable"><I>somefile</I></CODE><CODECLASS="userinput"><B> revision #$revnum&quot;</B></CODE>&gt; <CODECLASS="userinput"><B>done | lpr</B></CODE></PRE></TD></TR></TABLE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para">You'd like to compare the two most recent revisions of several RCS filesto see what the last change was.But the revision numbers in each file are different.(One file's latest revision might be 2.4, another file could be at 1.7,etc.)Use<SPANCLASS="link"><EMCLASS="emphasis">head</EM> (<ACLASS="linkend"HREF="ch25_20.htm"TITLE="Printing the Top of a File ">25.20</A>)</SPAN>to grab the two highest revision numbers from the <EMCLASS="emphasis">rcsrevs</EM> output,<SPANCLASS="link"><EMCLASS="emphasis">tail -r</EM> (<ACLASS="linkend"HREF="ch25_15.htm"TITLE="Finer Control on tail ">25.15</A>)</SPAN>to reverse the order (put the older revision number first),use <EMCLASS="emphasis">sed</EM> to make the revision numbers into a pair of <EMCLASS="emphasis">-r</EM> options(like <CODECLASS="literal">-r1.6 -r1.7</CODE>),then run <EMCLASS="emphasis">rcsdiff</EM> to do the comparisons and<SPANCLASS="link">email (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>them to <EMCLASS="emphasis">bigboss</EM>:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch09_13.htm"TITLE="9.13 Multiline Commands, Secondary Prompts ">?</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>foreach file (*.cc *.h Makefile)</B></CODE>? <CODECLASS="userinput"><B>set revs=`rcsrevs $f | head -2 | tail -r | sed 's/^/-r/'`</B></CODE>? <CODECLASS="userinput"><B>rcsdiff $revs $f | mail -s &quot;changes to $file&quot; bigboss</B></CODE>? <CODECLASS="userinput"><B>end</B></CODE></PRE></TD></TR></TABLE></P></LI></OL><PCLASS="para"><EMCLASS="emphasis">rcsrevs</EM> accepts <EMCLASS="emphasis">rlog</EM> options to control what revisions areshown.So <EMCLASS="emphasis">rcsrevs&nbsp;-r2 somefile</EM> would list only revisions 2.0 and above,<EMCLASS="emphasis">rcsrevs&nbsp;-sbeta</EM> would list the revisions in <EMCLASS="emphasis">beta</EM> state,and so on.<ACLASS="indexterm"NAME="AUTOID-22922"></A><ACLASS="indexterm"NAME="AUTOID-22923"></A><ACLASS="indexterm"NAME="AUTOID-22924"></A><ACLASS="indexterm"NAME="AUTOID-22925"></A></P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch20_14.htm"TITLE="20.14 RCS Basics "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 20.14 RCS Basics "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch21_01.htm"TITLE="21. More About Managing Files"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 21. More About Managing Files"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">20.14 RCS Basics </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">21. More About Managing Files</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>