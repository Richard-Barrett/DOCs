<HTML><HEAD><TITLE>[Chapter 21] 21.3 Unique Names for Temporary Files </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:40:00Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch21_01.htm"TITLE="21. More About Managing Files"><LINKREL="prev"HREF="ch21_02.htm"TITLE="21.2 A Better Place for Temporary Files: /tmp "><LINKREL="next"HREF="ch21_04.htm"TITLE="21.4 Why Both /tmp and /usr/tmp? "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch21_02.htm"TITLE="21.2 A Better Place for Temporary Files: /tmp "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 21.2 A Better Place for Temporary Files: /tmp "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 21<BR>More About Managing Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch21_04.htm"TITLE="21.4 Why Both /tmp and /usr/tmp? "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 21.4 Why Both /tmp and /usr/tmp? "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-5180">21.3 Unique Names for Temporary Files </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-22965"></A><ACLASS="indexterm"NAME="AUTOID-22968"></A><ACLASS="indexterm"NAME="AUTOID-22972"></A>All users share <SPANCLASS="link"><EMCLASS="emphasis">/tmp</EM> (<ACLASS="linkend"HREF="ch21_02.htm"TITLE="A Better Place for Temporary Files: /tmp ">21.2</A>)</SPAN>,so you should make unique filenames there.The best way to do this is by putting <CODECLASS="literal">$$</CODE> in the filename.For example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>vi /tmp/jerry.$$</B></CODE>&quot;/tmp/jerry.12345&quot; [New file]% <CODECLASS="userinput"><B>lpr /tmp/jerry.$$</B></CODE>% <CODECLASS="userinput"><B>rm /tmp/jerry.$$</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The shell replaces <CODECLASS="literal">$$</CODE> with the shell's<SPANCLASS="link">PID number (<ACLASS="linkend"HREF="ch38_03.htm"TITLE="Managing Processes: Overall Concepts ">38.3</A>)</SPAN>(in this case, <CODECLASS="literal">12345</CODE>).</P><PCLASS="para">If you use a<SPANCLASS="link">subshell (<ACLASS="linkend"HREF="ch38_04.htm"TITLE="Subshells ">38.4</A>)</SPAN>,or have more than one login session or window,and want to share the same temp file, <CODECLASS="literal">$$</CODE> won't work for you.In that case, just pick a unique name.You could use today's date instead.</P><PCLASS="para">To give yourself both options with a minimum of work,here are lines for your<SPANCLASS="link">shell setup files (<ACLASS="linkend"HREF="ch02_02.htm"TITLE="Shell Setup Files-Which, Where, and Why ">2.2</A>)</SPAN>.The left column has lines for <EMCLASS="emphasis">csh</EM>-like shells, and theright is for <EMCLASS="emphasis">sh</EM>-like shells.&#13;</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch09_16.htm"TITLE="9.16 Command Substitution ">`...`</A> <ACLASS="co"HREF="ch47_05.htm"TITLE="47.5 Using C Shell Arrays ">[n]</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen"><EMCLASS="emphasis">.cshrc:</EM>		<EMCLASS="emphasis">.profile</EM>:set tf=/tmp/jp$$	tf=/tmp/jp$$<EMCLASS="emphasis">.login:</EM>		export TFset date = (`date`)	set `date`setenv TF /tmp/jp$date[4]	TF=/tmp/jp$4</PRE></TD></TR></TABLE></P><PCLASS="para">&#13;(The last two lines grab the fourth word&nbsp;- the current time&nbsp;- from theoutput of the<SPANCLASS="link"><EMCLASS="emphasis">date</EM> (<ACLASS="linkend"HREF="ch51_10.htm"TITLE="The date Command ">51.10</A>)</SPAN>command.)When I want a temporary file in my current shell, I type:&#13;</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch15_02.htm"TITLE="15.2 Filename Wildcards in a Nutshell ">*</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>grep foo bar &gt; $tf-1</B></CODE>% <CODECLASS="userinput"><B>grep wheeze bar &gt; $tf-2</B></CODE>% <CODECLASS="userinput"><B>more $tf-*</B></CODE></PRE></TD></TR></TABLE></P><PCLASS="para">&#13;The shell expands the<SPANCLASS="link">shell variable (<ACLASS="linkend"HREF="ch06_08.htm"TITLE="Shell Variables ">6.8</A>)</SPAN><CODECLASS="literal">$tf-1</CODE> into a filename like <CODECLASS="literal">/tmp/jp2345-1</CODE>, and<CODECLASS="literal">$tf-*</CODE> expands into all my temporary files in this shell.Usually, that's great.  But if I go to a subshell, do a shell escape,and so on, the temporary files I make with <CODECLASS="literal">$tf</CODE> won't be thesame as the ones I make in my login shell because the PIDs aredifferent.  If I need them to be the same, I use <CODECLASS="literal">$TF</CODE>, the<SPANCLASS="link">environment variable (<ACLASS="linkend"HREF="ch06_01.htm#UPT-ART-1170"TITLE="What Environment Variables Are Good For ">6.1</A>)</SPAN>.It's set to the time I logged in.And because environment variables are passed to child shells, the name(like <EMCLASS="emphasis">/tmp/jp09:34:56</EM>) will be the same in subshells:&#13;</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch15_02.htm"TITLE="15.2 Filename Wildcards in a Nutshell ">[..]</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>someprog &gt; $TF-1</B></CODE>...% <CODECLASS="userinput"><B>otherprog &gt; $TF-6</B></CODE>% <CODECLASS="userinput"><B>sh</B></CODE>$ <CODECLASS="userinput"><B>head $TF-[16]</B></CODE></PRE></TD></TR></TABLE></P><PCLASS="para">&#13;If I'll be using a file for more than a minute or two, I might forgetwhat's in which file.So I leave myself a note in shell variables named <CODECLASS="literal">xf</CODE><CODECLASS="replaceable"><I>n</I></CODE>and environment variables named <CODECLASS="literal">XF</CODE><CODECLASS="replaceable"><I>n</I></CODE>-where &quot;xf&quot; means&quot;explain file&quot; and <CODECLASS="replaceable"><I>n</I></CODE> is<EMCLASS="emphasis">1</EM>, <EMCLASS="emphasis">2</EM>, etc. to correspond to the variable.If I don't remember which have what, I get a list by piping the output of<EMCLASS="emphasis">set</EM> (for shell variables) or<SPANCLASS="link"><EMCLASS="emphasis">printenv</EM> or <EMCLASS="emphasis">env</EM> (<ACLASS="linkend"HREF="ch06_01.htm#UPT-ART-1170"TITLE="What Environment Variables Are Good For ">6.1</A>)</SPAN>(for environment variables) through <EMCLASS="emphasis">grep</EM>.For example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>sort -t: +2 $tf-2 &gt; $tf-3</B></CODE>% <CODECLASS="userinput"><B>set xf3='sorted list of chapter 21 files'</B></CODE>   <ICLASS="lineannotation">...later...</I>% <CODECLASS="userinput"><B>set | grep xf</B></CODE>xf1     sorted list of chapter 20 filesxf3     sorted list of chapter 21 files% <CODECLASS="userinput"><B>lpr $tf-3</B></CODE></PRE></BLOCKQUOTE></P><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="csh_logout">csh_logout</A><BR><ACLASS="programreference"HREF="examples/index.htm"TITLE="sh_logout">sh_logout</A><BR></TH><TDVALIGN="TOP">&#13;To clean up when I log out, I added the lines that follow to the C shell<EMCLASS="emphasis">.logout</EM> file.The Bourne shell version is similar, but it needs a couple of tricksto work on some shells; it's on the CD-ROM.</TD></TR></TABLE><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch15_04.htm"TITLE="15.4 What if a Wildcard Doesn't Match? ">nonomatch</A> <ACLASS="co"HREF="ch16_08.htm"TITLE="16.8 The ls -d Option ">-d</A> <ACLASS="co"HREF="ch13_05.htm"TITLE="13.5 Redirection in C Shell: Capture Errors, Too? ">|&amp;</A> <ACLASS="co"HREF="ch09_11.htm"TITLE="9.11 Repeating a Command with a foreach Loop ">$&lt;</A> <ACLASS="co"HREF="ch47_04.htm"TITLE="47.4 C Shell Variable Operators and Expressions ">=~</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen"># CLEAN FILES (IF ANY) OUT OF /tmp:set nonomatchset tmpf=&quot;\`ls -d $tf-* $TF-* |&amp; grep -v ' not found'\`&quot;if ( &quot;$tmpf&quot; =~ ?* ) then    echo; echo &quot;Your files in /tmp:&quot;    ls -d $tmpf    echo -n &quot;'rm -rf' them? [ny](n) &quot;    if ( &quot;$&lt;&quot; =~ y* ) rm -rf $tmpfendif</PRE></TD></TR></TABLE></P><PCLASS="para">If I made any temporary files from my login shell or any subshells,I get this message when I log out:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>logout</B></CODE>Your files in /tmp:/tmp/jp2345-1   /tmp/jp2345-2  /tmp/jp2748-1  /tmp/09:23:45-1'rm -rf' them? <CODECLASS="userinput"><B>y</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Another way to do this is with a script like<SPANCLASS="link"><EMCLASS="emphasis">del</EM> (<ACLASS="linkend"HREF="ch23_06.htm"TITLE="A Faster Way to Remove Files Interactively ">23.6</A>)</SPAN>.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch21_02.htm"TITLE="21.2 A Better Place for Temporary Files: /tmp "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 21.2 A Better Place for Temporary Files: /tmp "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch21_04.htm"TITLE="21.4 Why Both /tmp and /usr/tmp? "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 21.4 Why Both /tmp and /usr/tmp? "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">21.2 A Better Place for Temporary Files: /tmp </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">21.4 Why Both /tmp and /usr/tmp? </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>