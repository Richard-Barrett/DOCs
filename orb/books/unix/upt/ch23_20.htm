<HTML><HEAD><TITLE>[Chapter 23] 23.20 Deleting Stale Files </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:41:18Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch23_01.htm"TITLE="23. Removing Files"><LINKREL="prev"HREF="ch23_19.htm"TITLE="23.19 Deleting (BSD) Manual Pages that Aren't Read "><LINKREL="next"HREF="ch23_21.htm"TITLE="23.21 Removing Every File but One "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch23_19.htm"TITLE="23.19 Deleting (BSD) Manual Pages that Aren't Read "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 23.19 Deleting (BSD) Manual Pages that Aren't Read "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 23<BR>Removing Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch23_21.htm"TITLE="23.21 Removing Every File but One "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 23.21 Removing Every File but One "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-1770">23.20 Deleting Stale Files </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-25988"></A><ACLASS="indexterm"NAME="AUTOID-25992"></A>Sooner or later, a lot of junk collects in your directories: filesthat you don't really care about and never use. It's possible towrite <SPANCLASS="link"><EMCLASS="emphasis">find</EM> (<ACLASS="linkend"HREF="ch17_01.htm#UPT-ART-7410"TITLE="The find Command Is Great; The Problem Is Finding How to Use It">17.1</A>)</SPAN>commands that will automatically clean these up. Ifyou want to clean up regularly, you can add some <EMCLASS="emphasis">find</EM> commandsto your <SPANCLASS="link"><EMCLASS="emphasis">crontab</EM> file (<ACLASS="linkend"HREF="ch40_12.htm"TITLE="Periodic Program Execution: The cron Facility ">40.12</A>)</SPAN>.</P><PCLASS="para">Basically, all you need to do is write a <EMCLASS="emphasis">find</EM> command thatlocates files based on their last access time(<SPANCLASS="link"><EMCLASS="emphasis">-atime</EM> (<ACLASS="linkend"HREF="ch17_05.htm"TITLE="Searching for Old Files ">17.5</A>)</SPAN>),and use<SPANCLASS="link"><EMCLASS="emphasis">-ok</EM> or <EMCLASS="emphasis">-exec</EM> (<ACLASS="linkend"HREF="ch17_10.htm"TITLE="Running Commands on What You Find ">17.10</A>)</SPAN>to delete them. Such a command might looklike this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>find . -atime +60 -ok rm -f {} \;</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">This locates files that haven't been accessed in the last 60 days,asks if you want to delete the file, and then deletes the file.(If you run it from <EMCLASS="emphasis">cron</EM>, make sure you use <EMCLASS="emphasis">-exec</EM> insteadof <EMCLASS="emphasis">-ok</EM>; and make <EMCLASS="emphasis">absolutely sure</EM> that the <EMCLASS="emphasis">find</EM> won'tdelete files that you think are important.)</P><PCLASS="para">Of course, you can modify this <EMCLASS="emphasis">find</EM> command to exclude (orselect) files with particular names; for example, the command belowdeletes old core dumps and GNU Emacs backup files (whose names end in<CODECLASS="literal">~</CODE>), but leaves all others alone:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>find . \( -name core -o -name &quot;*~&quot; \) -atime +60 -ok rm -f {} \;</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">If you take an automated approach to deleting stale files, here aresome things to watch out for:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">There are plenty of files (for example, UNIX utilities and log files)that should <EMCLASS="emphasis">never</EM> be removed. Never run any &quot;automaticdeletion&quot; script on <EMCLASS="emphasis">/usr</EM> or <CODECLASS="literal">/</CODE> or any other &quot;system&quot;directory.&#13;</P></LI><LICLASS="listitem"><PCLASS="para">On some systems, executing a binary executable doesn't update thelast access time. Since there's no reason to read these files, you can expect them to get pretty stale, even if they're used often.You don't want to delete them. If you cook up a complicated enough<EMCLASS="emphasis">find</EM> command, you should be able to handle this automatically.Something like this should (at least partially) do the trick:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch17_06.htm"TITLE="17.6 Be an Expert on find Search Operators ">!</A> <ACLASS="co"HREF="ch17_15.htm"TITLE="17.15 Searching for Files by Permission ">-perm</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>find . -atime +30 ! -perm -111 ... -exec rm {} \;</B></CODE></PRE></TD></TR></TABLE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para">Along the same lines, you'd probably never want to delete C sourcecode, so you might modify your <EMCLASS="emphasis">find</EM> command to look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>find . -atime +30 ! -perm -111 ! -name &quot;*.c&quot; ... -exec rm {} \;</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para">I personally find that automatically deleting files is an extremeand bizarre solution. I can't imagine deleting files without knowingexactly what I've deleted or without (somehow) saving the &quot;trash&quot;somewhere just in case I accidentally removed something important.You can use the <EMCLASS="emphasis">find</EM><EMCLASS="emphasis">-cpio</EM>operator (if your system has it) to<SPANCLASS="link">archive (<ACLASS="linkend"HREF="ch19_09.htm"TITLE="A System V Tape Archiver: cpio ">19.9</A>)</SPAN>the deleted files on tape.</P></LI></UL><PCLASS="para">OK, I've said that I don't really think that automated deletion scriptsare a good idea. What's my solution, then?</P><PCLASS="para">I don't have a good comprehensive solution. I spend a reasonableamount of time (maybe an hour a month) going through directories anddeleting stale files by hand. I also have a <EMCLASS="emphasis">clean</EM> alias that Itype whenever I think about it. It looks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">alias clean &quot;rm *~ junk *.BAK core #*&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;That is, this alias deletes all of my<SPANCLASS="link">Emacs (<ACLASS="linkend"HREF="ch32_01.htm#UPT-ART-5540"TITLE="Emacs: The Other Editor ">32.1</A>)</SPAN>backup files, Emacsautosave files (I admit, that's risky), files named <EMCLASS="emphasis">junk</EM>, someother backup files, and<SPANCLASS="link">core dumps (<ACLASS="linkend"HREF="glossary.htm#UPT-ART-1010"TITLE="Glossary">52.9</A>)</SPAN>.I'll admit that since I <EMCLASS="emphasis">never</EM>want to save these files, I could probably live with something like:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>find ~ \( -name &quot;*~&quot; -o -name core \) -atime +1 -exec rm {} \;</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">But still: automated deletion commands make me really nervous, andI'd prefer to live without them.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">ML</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch23_19.htm"TITLE="23.19 Deleting (BSD) Manual Pages that Aren't Read "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 23.19 Deleting (BSD) Manual Pages that Aren't Read "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch23_21.htm"TITLE="23.21 Removing Every File but One "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 23.21 Removing Every File but One "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">23.19 Deleting (BSD) Manual Pages that Aren't Read </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">23.21 Removing Every File but One </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>