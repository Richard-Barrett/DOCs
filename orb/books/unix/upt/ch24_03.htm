<HTML><HEAD><TITLE>[Chapter 24] 24.3 Unlinking Open Files Isn't a Good Idea </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:41:28Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch24_01.htm"TITLE="24. Other Ways to Get Disk Space"><LINKREL="prev"HREF="ch24_02.htm"TITLE="24.2 Save Space with Bit Bucket Log Files and Mailboxes"><LINKREL="next"HREF="ch24_04.htm"TITLE="24.4 Save Space with a Link "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_02.htm"TITLE="24.2 Save Space with Bit Bucket Log Files and Mailboxes"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.2 Save Space with Bit Bucket Log Files and Mailboxes"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 24<BR>Other Ways to Get Disk Space</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_04.htm"TITLE="24.4 Save Space with a Link "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.4 Save Space with a Link "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0371">24.3 Unlinking Open Files Isn't a Good Idea </A></H2><PCLASS="para">[Some programmers write programs that<SPANCLASS="link"> make temporary files, open them, then unlink (remove) each file before they're done reading it . (<ACLASS="linkend"HREF="ch45_10.htm"TITLE="Removing a File Once It's Opened&nbsp;- for Security and Easy Cleanup">45.10</A>)</SPAN><ACLASS="indexterm"NAME="AUTOID-26261"></A><ACLASS="indexterm"NAME="AUTOID-26264"></A><ACLASS="indexterm"NAME="AUTOID-26267"></A>This keeps other people from deleting, reading, or overwriting a file.Because the file is opened by a process, UNIX removes the file's directory entry(its link) but doesn't actually free the disk space until theprocess is done with the file.Here's why you shouldn't do that.(By the way, the point Chris makes about system administrators cleaning upfull filesystems by emptying open files is a good one.)-JP]</P><PCLASS="para">To give people another reason not to unlink open files (besidesthat it does, er, &quot;interesting&quot; things under<SPANCLASS="link">NFS (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>),consider the following:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">multi 1000 &lt;/usr/dict/words &gt;/tmp/file1</PRE></BLOCKQUOTE></P><PCLASS="para">(<EMCLASS="emphasis">multi</EM> is a program that makes <EMCLASS="emphasis">n</EM> copies of its input; here <EMCLASS="emphasis">n</EM>is 1000.)Now suppose<SPANCLASS="link"><EMCLASS="emphasis">/tmp</EM> (<ACLASS="linkend"HREF="ch21_02.htm"TITLE="A Better Place for Temporary Files: /tmp ">21.2</A>)</SPAN>runs out of space.You can:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">rm /tmp/file1           # oops, file didn't actually go awayps ax                   # find the &quot;multi&quot; processkill <CODECLASS="replaceable"><I>pid</I></CODE>                # get rid of it</PRE></BLOCKQUOTE></P><PCLASS="para">or you can:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch13_14.htm"TITLE="13.14 What Can You Do with an Empty File? ">/dev/null</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">cp /dev/null /tmp/file1 # now have some time to fix things up</PRE></TD></TR></TABLE></P><PCLASS="para">Bending the example a bit, suppose that <EMCLASS="emphasis">/tmp</EM> runs out of file spaceand there are a bunch of unlinked but<SPANCLASS="link">open (<ACLASS="linkend"HREF="ch45_20.htm"TITLE="Overview: Open Files and File Descriptors ">45.20</A>)</SPAN>files.To get rid ofthe space these occupy, you must kill the processes holding themopen. However, if they are ordinary files, you can just trim themdown to zero bytes.</P><PCLASS="para">There is one good reason to unlink open temporary files:if anything goes wrong, the temporary files will vanish.There is no other way to guarantee this absolutely.You must balance this advantage against the disadvantages.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">CT</SPAN> <SPANCLASS="bibliomisc">in <ACLASS="systemitem.newsgroup"HREF="news:net.unix-wizards">net.unix-wizards</A> on Usenet, 9 September 1985</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_02.htm"TITLE="24.2 Save Space with Bit Bucket Log Files and Mailboxes"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.2 Save Space with Bit Bucket Log Files and Mailboxes"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_04.htm"TITLE="24.4 Save Space with a Link "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.4 Save Space with a Link "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">24.2 Save Space with Bit Bucket Log Files and Mailboxes</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">24.4 Save Space with a Link </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>