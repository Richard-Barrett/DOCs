<HTML><HEAD><TITLE>[Chapter 24] 24.11 Edit Compressed Files with zvi, zex, and zed </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:41:39Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch24_01.htm"TITLE="24. Other Ways to Get Disk Space"><LINKREL="prev"HREF="ch24_10.htm"TITLE="24.10 zloop: Run a Command on Compressed Files "><LINKREL="next"HREF="ch24_12.htm"TITLE="24.12 Compressing a Directory Tree: Fine-Tuning "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_10.htm"TITLE="24.10 zloop: Run a Command on Compressed Files "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.10 zloop: Run a Command on Compressed Files "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 24<BR>Other Ways to Get Disk Space</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_12.htm"TITLE="24.12 Compressing a Directory Tree: Fine-Tuning "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.12 Compressing a Directory Tree: Fine-Tuning "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-7180">24.11 Edit Compressed Files with zvi, zex, and zed </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-26720"></A><ACLASS="indexterm"NAME="AUTOID-26722"></A><ACLASS="indexterm"NAME="AUTOID-26724"></A><ACLASS="indexterm"NAME="AUTOID-26726"></A><ACLASS="indexterm"NAME="AUTOID-26729"></A><SPANCLASS="link">Compressed files (<ACLASS="linkend"HREF="ch24_07.htm"TITLE="Compressing Files to Save Space ">24.7</A>)</SPAN>save disk space.But compressed files aren't as convenient to work with: you have touncompress them before you can read or edit them.This script makes editing easier.It uncompresses files that were compressed with the GNU <EMCLASS="emphasis">gzip</EM> utility.Then it starts a text editor: <EMCLASS="emphasis">vi</EM>, <EMCLASS="emphasis">ex</EM>, or <EMCLASS="emphasis">ed</EM>.(It's easy to modify this to use other editors.)The <EMCLASS="emphasis">vi</EM> and <EMCLASS="emphasis">ex</EM> editors can<SPANCLASS="link">edit several files (<ACLASS="linkend"HREF="ch30_04.htm"TITLE="Editing Multiple Files with vi ">30.4</A>)</SPAN>;this script handles that.After you edit all the files, the script recompresses them in thebackground so that you don't have to wait.There's one more bit of trickery here: instead of uncompressing all filesyou specify before it starts the editor, the script uncompresses just thefirst file&nbsp;- itdoes the rest in the background while you're editing the first file.(It figures out what all the uncompressed files will be named.By the time the editor gets to them, they should have been uncompressed.)</P><PCLASS="para">This makes it easy to save a lot of disk space by keeping your files<EMCLASS="emphasis">gzip</EM>ped most of the time.The response is almost as fast as editing an uncompressed file,especially if the first file on the command line is a small one.Here's an example.I'll edit the files <EMCLASS="emphasis">qlog.gz</EM> and <EMCLASS="emphasis">/usr/central/data.gz</EM>with <EMCLASS="emphasis">vi</EM>.Next, I'll run <EMCLASS="emphasis">zed</EM> <SPANCLASS="link">editing script (<ACLASS="linkend"HREF="ch28_09.htm"TITLE="ex Scripts Built by diff ">28.9</A>)</SPAN>on <EMCLASS="emphasis">bigfile.gz</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>zvi qlog.gz /usr/central/data</B></CODE>   <EMCLASS="emphasis">The .gz isn't required</EM>    ...<EMCLASS="emphasis">Edit the two files like a normal vi multiple-file session</EM>...zvi: re-gzipping qlog /usr/central/data in the background...% <CODECLASS="userinput"><B>zed bigfile &lt; edscr</B></CODE>173571   <EMCLASS="emphasis">ed's file size counts</EM>183079zed: re-gzipping bigfile in the background...</PRE></BLOCKQUOTE></P><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="zvi">zvi</A><BR></TH><TDVALIGN="TOP">If there are any errors, the program prompts you when it can&nbsp;- otherwiseyou'll get<SPANCLASS="link">email (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>with a copy of the error messages.Please test this script carefully on your system before you use it.All this trickery could need a little tweaking to work right.&#13;</TD></TR></TABLE><PCLASS="para">Most of the script is pretty straightforward.Unfortunately, the script won't work with editors like<SPANCLASS="link"><EMCLASS="emphasis">Emacs</EM> (<ACLASS="linkend"HREF="ch32_01.htm#UPT-ART-5540"TITLE="Emacs: The Other Editor ">32.1</A>)</SPAN>that try to open all files from the command line immediately.You could change that by making the script uncompress all filesbefore starting Emacs.</P><PCLASS="para">The section that follows is interesting.It's the part that uncompresses background files.If there's an error in the background, how does the script catch it?</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">test -n &quot;$bgfiles&quot; &amp;&amp; $uncompress $bgfiles &gt;$t 2&gt;&amp;1 &amp;$prog $filesif [ -s $t ]then    echo &quot;$myname: 'gunzip $bgfiles' bombed:&quot; 1&gt;&amp;2    cat $t 1&gt;&amp;2    $echo &quot;Should I try to gzip all files [ny](n)? $nnl&quot;    read ans</PRE></BLOCKQUOTE></P><PCLASS="para">The standard output and standard error of the background job goes to atemporary file, <CODECLASS="literal">$t</CODE>.The editor (<CODECLASS="literal">$prog</CODE>) runs.After you quit the editor, the<SPANCLASS="link"><EMCLASS="emphasis">test</EM> (<CODECLASS="literal">[</CODE>) (<ACLASS="linkend"HREF="ch44_20.htm"TITLE="test: Testing Files and Strings ">44.20</A>)</SPAN><EMCLASS="emphasis">-s</EM> optionchecks the temporary file.If the file isn't empty, the script shows you the errors from it(the file) and asks you whether the files should be re<EMCLASS="emphasis">gzip</EM>ped.</P><PCLASS="para">The script is written to have two other<SPANCLASS="link">links (<ACLASS="linkend"HREF="ch18_03.htm"TITLE="Files with Two or More Names">18.3</A>)</SPAN>.You may want to make more or fewer links though, depending on the editors your system has.If you install the script from the CD-ROM, the links will bemade for you.If you type in the script, put it in an executable file named <EMCLASS="emphasis">zvi</EM>.Then make the links:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>chmod 755 zvi</B></CODE>% <CODECLASS="userinput"><B>ln zvi zex</B></CODE>% <CODECLASS="userinput"><B>ln zvi zed</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The script tests the name it was called with, from <CODECLASS="literal">$0</CODE>, to decidewhich editor to use.This trick saves disk space.You can change the editors it uses by modifying the script and adding orremoving links.</P><PCLASS="para">The absolute pathnames at the start of the script may need to be changedfor your system.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_10.htm"TITLE="24.10 zloop: Run a Command on Compressed Files "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.10 zloop: Run a Command on Compressed Files "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_12.htm"TITLE="24.12 Compressing a Directory Tree: Fine-Tuning "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 24.12 Compressing a Directory Tree: Fine-Tuning "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">24.10 zloop: Run a Command on Compressed Files </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">24.12 Compressing a Directory Tree: Fine-Tuning </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>