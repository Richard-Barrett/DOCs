<HTML><HEAD><TITLE>[Chapter 24] 24.18 Huge Files Might Not Take a Lot of Disk Space </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:41:48Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch24_01.htm"TITLE="24. Other Ways to Get Disk Space"><LINKREL="prev"HREF="ch24_17.htm"TITLE="24.17 Disk Quotas "><LINKREL="next"HREF="part04.htm"TITLE="IV. Looking Inside Files "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_17.htm"TITLE="24.17 Disk Quotas "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.17 Disk Quotas "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 24<BR>Other Ways to Get Disk Space</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="PART"HREF="part04.htm"TITLE="IV. Looking Inside Files "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: IV. Looking Inside Files "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0392">24.18 Huge Files Might Not Take a Lot of Disk Space </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-27058"></A><ACLASS="indexterm"NAME="AUTOID-27060"></A><ACLASS="indexterm"NAME="AUTOID-27063"></A>If you're doing filesystem cleanup, you use <EMCLASS="emphasis">ls -l</EM>, and see afile with ten million bytes...&quot;Yipes!&quot; you say, &quot;That must be eating a lot of disk space!&quot;But if you remove the file,<SPANCLASS="link"><EMCLASS="emphasis">df</EM> (<ACLASS="linkend"HREF="ch24_09.htm"TITLE="How Much Disk Space? ">24.9</A>)</SPAN>shows almost no difference in disk space.Why?</P><PCLASS="para">It could be a <EMCLASS="emphasis">sparse file</EM>,a file with a lot more NUL characters in it than anythingelse (that's a general definition, but it's basically correct).The command<SPANCLASS="link"><EMCLASS="emphasis">ls -ls</EM> (<ACLASS="linkend"HREF="ch17_14.htm"TITLE="Searching for Files by Size ">17.14</A>)</SPAN>will show you sparse files; the disk usage in the first column will berelatively much smaller than the character count:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>ls -ls</B></CODE>total 128  64 -rw-r--r--  1 jerry     8413616 Nov  9 16:49 core  64 -rw-r--r--  1 jerry       64251 Nov  7 18:22 dns.tar</PRE></BLOCKQUOTE></P><PCLASS="para">Programs that use <EMCLASS="emphasis">dbm</EM> (<EMCLASS="emphasis">d</EM>ata<EMCLASS="emphasis">b</EM>ase <EMCLASS="emphasis">m</EM>anagement subroutines) often createsparse files because <EMCLASS="emphasis">dbm</EM> usesfile location as part of its hashing and tries to spread out entriesin the database file so there is lots of blank space between them.</P><PCLASS="para">ManyUNIX filesystems (although not all&nbsp;- the Andrew File System, for example doesnot) support the ability to greatly reduce theamount of space taken up by a file that is mostly NULs by not reallystoring the file blocks that are filled with NULs.Instead, the OS keeps track of how many blocks of NULs there arebetween each block that has something other than NULs in it, andfeeds NULs to anybody who tries to read the file, even thoughthey're not really being read off a disk.</P><PCLASS="para">You can create a sparse file in C by using <EMCLASS="emphasis">fopen</EM>(3) to open a file and<EMCLASS="emphasis">fseek</EM>(3) to move the file pointer farpast the end of the file without writing anything.The file up to where you <EMCLASS="emphasis">fseek</EM> will contain NULs, and the kernel(probably)won't save all of those NULs to disk.</P><PCLASS="para">By the way, sparse files can be a problem to copy.The kernel isn't smart enough to figure out you're feeding it a sparsefile if you actually feed it the NULs. Therefore, standard file copyingprogramslike <EMCLASS="emphasis">cp</EM> that just read the file in and write it out in a differentlocation lose, because they end up creating a file that really doestake up as much as space physically as there are NULs in the abstractfile object.Then your disk space might really be in trouble.[Some operating systems have a <EMCLASS="emphasis">cp -z</EM> option to solve this problem. <EMCLASS="emphasis">-TC</EM>&nbsp;]</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JIK</SPAN>, <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch24_17.htm"TITLE="24.17 Disk Quotas "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 24.17 Disk Quotas "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="PART"HREF="part04.htm"TITLE="IV. Looking Inside Files "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: IV. Looking Inside Files "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">24.17 Disk Quotas </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">IV. Looking Inside Files </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>