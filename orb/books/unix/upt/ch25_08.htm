<HTML><HEAD><TITLE>[Chapter 25] 25.8 Finding File Types </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:43:15Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch25_01.htm"TITLE="25. Showing What's in a File"><LINKREL="prev"HREF="ch25_07.htm"TITLE="25.7 Show Non-Printing Characters with cat -v or od -c "><LINKREL="next"HREF="ch25_09.htm"TITLE="25.9 Adding and Deleting White Space "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch25_07.htm"TITLE="25.7 Show Non-Printing Characters with cat -v or od -c "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 25.7 Show Non-Printing Characters with cat -v or od -c "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 25<BR>Showing What's in a File</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch25_09.htm"TITLE="25.9 Adding and Deleting White Space "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 25.9 Adding and Deleting White Space "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-2650">25.8 Finding File Types </A></H2><PCLASS="para">Many different kinds of files live on the typical UNIX system:database files, executable files, regular text files, files for fancyeditors like Interleaf, <EMCLASS="emphasis">tar</EM> files, mail messages,directories, font files, and so on.<ACLASS="indexterm"NAME="AUTOID-27642"></A><ACLASS="indexterm"NAME="AUTOID-27645"></A></P><PCLASS="para">You often want to check to make sure you have the right &quot;kind&quot; of filebefore doing something. For example, you'd like to read the file<EMCLASS="emphasis">tar</EM>. But before typing <CODECLASS="literal">more&nbsp;tar</CODE>, you'd like to knowwhether this file is your set of notes on carbon-based sludge, or the <EMCLASS="emphasis">tar</EM> executable. If you're wrong,the consequences might be unpleasant. Sending the <EMCLASS="emphasis">tar</EM> executable toyour screen might <SPANCLASS="link">screw up your terminal settings (<ACLASS="linkend"HREF="ch42_04.htm"TITLE="Checklist for Resetting a Messed Up Terminal ">42.4</A>)</SPAN>,log you off, or do any number of hostile things.</P><PCLASS="para">The <EMCLASS="emphasis">file</EM> utility tells you what sort of file something is.[2]It's fairly self-explanatory:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] Another solution to this problem is <SPANCLASS="link"><EMCLASS="emphasis">findtext</EM> (<ACLASS="linkend"HREF="ch16_26.htm"TITLE="Finding Text Files with findtext ">16.26</A>)</SPAN>.</P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>file /bin/sh</B></CODE>/bin/sh:       sparc demand paged executable% <CODECLASS="userinput"><B>file 2650</B></CODE>2650:          [nt]roff, tbl, or eqn input text% <CODECLASS="userinput"><B>file 0001,v</B></CODE>0001,v:        ascii text% <CODECLASS="userinput"><B>file foo.sh</B></CODE>foo.sh:          shell commands</PRE></BLOCKQUOTE></P><PCLASS="para"><EMCLASS="emphasis">file</EM> is actually quite clever [though it isn't alwayscorrect&nbsp;- some versions are better than others<EMCLASS="emphasis">&nbsp;- JP</EM>&nbsp;].It doesn't just tell you ifsomething's binary or text; it looks at the beginning of the file andtries to figure out what it's doing. So, for example, you see thatfile <EMCLASS="emphasis">2650</EM> is an<SPANCLASS="link"><EMCLASS="emphasis">nroff</EM> (<ACLASS="linkend"HREF="ch43_13.htm"TITLE="The Text Formatters nroff, troff, ditroff, ... ">43.13</A>)</SPAN>file and <EMCLASS="emphasis">foo.sh</EM> is a shellscript. It isn't quite clever enough to figure out that <EMCLASS="emphasis">0001,v</EM>is an<SPANCLASS="link">RCS (<ACLASS="linkend"HREF="ch20_14.htm"TITLE="RCS Basics ">20.14</A>)</SPAN>archive, but it does know that it's a plain<SPANCLASS="link">ASCII (<ACLASS="linkend"HREF="ch51_03.htm"TITLE="ASCII Characters: Listing and Getting Values ">51.3</A>)</SPAN>text file.</P><PCLASS="para">System V and SunOS let you customize the <EMCLASS="emphasis">file</EM> command so that itwill recognize additional file types. The file <EMCLASS="emphasis">/etc/magic</EM> tells<EMCLASS="emphasis">file</EM> how to recognize different kinds of files.  It's capable ofa lot (and should be capable of even more), but we'll satisfyourselves with an introductory explanation. Our goal will be to teach<EMCLASS="emphasis">file</EM> to recognize RCS archives.</P><PCLASS="para"><EMCLASS="emphasis">/etc/magic</EM> has four fields:</P><BLOCKQUOTECLASS="blockquote"><PCLASS="para"><CODECLASS="replaceable"><I>offset     data-type    value     file-type</I></CODE></P></BLOCKQUOTE><PCLASS="para">These are:</P><DLCLASS="variablelist"><DTCLASS="term"><CODECLASS="replaceable"><I>offset</I></CODE></DT><DDCLASS="listitem"><PCLASS="para">The offset into the file at which <EMCLASS="emphasis">magic</EM> will try to findsomething.  If you're looking for something right at the beginning ofthe file, the offset should be <CODECLASS="literal">0</CODE>. (This is usually what youwant.)</P></DD><DTCLASS="term"><CODECLASS="replaceable"><I>data-type</I></CODE></DT><DDCLASS="listitem"><PCLASS="para">The type of test to make. Use <CODECLASS="literal">string</CODE> for text comparisons,<CODECLASS="literal">byte</CODE> for byte comparisons, <CODECLASS="literal">short</CODE> for two-bytecomparisons, and <CODECLASS="literal">long</CODE> for four-byte comparisons.</P></DD><DTCLASS="term"><CODECLASS="replaceable"><I>value</I></CODE></DT><DDCLASS="listitem"><PCLASS="para">The value you want to find. For string comparisons, any text stringwill do; you can use the standard UNIX escape sequences (like<CODECLASS="literal">\n</CODE> for newline). For numeric comparisons (byte, short, long),this field should be a number, expressed as a C constant (e.g.,<CODECLASS="literal">0x77</CODE> for the hexadecimal byte 77).</P></DD><DTCLASS="term"><CODECLASS="replaceable"><I>file-type</I></CODE></DT><DDCLASS="listitem"><PCLASS="para">The string that <EMCLASS="emphasis">file</EM> will print if this test succeeds.</P></DD></DL><PCLASS="para">So, we know that RCS archives begin with the word <CODECLASS="literal">head</CODE>.This word is right at the beginning of the file (offset 0). And weobviously want a string comparison. So we make the the followingaddition to <EMCLASS="emphasis">/etc/magic</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">0     string     head     RCS archive</PRE></BLOCKQUOTE></P><PCLASS="para">This says, &quot;The file is an RCS archive if you find the string<CODECLASS="literal">head</CODE> at an offset of 0&nbsp;bytes from the beginning of the file.&quot;Does it work?</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>file RCS/0002,v</B></CODE>RCS/0002,v:        RCS archive</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;As I said, the tests can be much more complicated, particularly ifyou're working with binary files. To recognize simple text files, this is all you need to know.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">ML</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch25_07.htm"TITLE="25.7 Show Non-Printing Characters with cat -v or od -c "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 25.7 Show Non-Printing Characters with cat -v or od -c "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch25_09.htm"TITLE="25.9 Adding and Deleting White Space "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 25.9 Adding and Deleting White Space "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">25.7 Show Non-Printing Characters with cat -v or od -c </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">25.9 Adding and Deleting White Space </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>