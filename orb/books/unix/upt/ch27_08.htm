<HTML><HEAD><TITLE>[Chapter 27] 27.8 glimpse and agrep </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:44:23Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch27_01.htm"TITLE="27. Searching Through Files"><LINKREL="prev"HREF="ch27_07.htm"TITLE="27.7 grepping for a List of Patterns "><LINKREL="next"HREF="ch27_09.htm"TITLE="27.9 New greps Are Much Faster "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch27_07.htm"TITLE="27.7 grepping for a List of Patterns "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 27.7 grepping for a List of Patterns "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 27<BR>Searching Through Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch27_09.htm"TITLE="27.9 New greps Are Much Faster "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 27.9 New greps Are Much Faster "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-7350">27.8 glimpse and agrep </A></H2><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="glimpse">glimpse</A><BR></TH><TDVALIGN="TOP"><ACLASS="indexterm"NAME="AUTOID-30228"></A><ACLASS="indexterm"NAME="AUTOID-30230"></A><EMCLASS="emphasis">Glimpse</EM> is an indexing and query system that lets you search hugeamounts of text (for example, all of your files) very quickly.For example, if you're looking for the word <EMCLASS="emphasis">something</EM>, just type<CODECLASS="literal">glimpse something</CODE>; all matching lines will appear with thefilename at the start.</TD></TR></TABLE><PCLASS="para">Before you use <EMCLASS="emphasis">glimpse</EM>, you need to index your files by running<EMCLASS="emphasis">glimpseindex</EM>.You'll probably want to run it every night from<SPANCLASS="link"><EMCLASS="emphasis">cron</EM> (<ACLASS="linkend"HREF="ch40_12.htm"TITLE="Periodic Program Execution: The cron Facility ">40.12</A>)</SPAN>.So, your searches will miss files that have been added since the last<EMCLASS="emphasis">glimpseindex</EM> run.But, other than that problem (which can't be avoided in an indexed systemlike this), <EMCLASS="emphasis">glimpse</EM> is fantastic&nbsp;- especially because it's(usually) so fast.</P><PCLASS="para">The speed depends on the size of the index file you build: a biggerindex makes the searches faster.But even with the smallest index file, I can search my entire 70-Megabyteemail archive, on a fairly slow workstation, in less than 30 seconds.With faster CPUs and disks, the search could be much quicker.One weakness is in search patterns that could match many files, whichcan take a lot of time to do:<EMCLASS="emphasis">glimpse</EM> will print a warning and ask if you want to continue the search.(After <EMCLASS="emphasis">glimpse</EM> checks its index for possible matches, it runs<EMCLASS="emphasis">agrep</EM> on the possibly matching files to check and get theexactly matching records.)</P><PCLASS="para"><EMCLASS="emphasis">agrep</EM> is oneof the nicer additions to the <EMCLASS="emphasis">grep</EM> family.It's not only one of the faster greps around, it has the unique feature thatit will look for approximate matches.It's also record-orientedrather than line-oriented.<EMCLASS="emphasis">Glimpse</EM> calls <EMCLASS="emphasis">agrep</EM>, but you can also use <EMCLASS="emphasis">agrep</EM>without using <EMCLASS="emphasis">glimpse</EM>.The three most significant features of <EMCLASS="emphasis">agrep</EM> that are not supported bythe <EMCLASS="emphasis">grep</EM> family are:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">The ability to search for approximate patterns, with a user-definablelevel of accuracy.For example, </P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>agrep -2 homogenos foo</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">will find &quot;homogeneous&quot; as well as any other word that can be obtained from &quot;homogenos&quot; with at most 2 substitutions, insertions, or deletions.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>agrep -B homogenos foo</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">&#13;will generate a message of the form:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">best match has 2 errors, there are 5 matches, output them? (y/n)</PRE></BLOCKQUOTE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-30274"></A><ACLASS="indexterm"NAME="AUTOID-30278"></A><ACLASS="indexterm"NAME="AUTOID-30280"></A><EMCLASS="emphasis">agrep</EM> is record-oriented rather than just line-oriented;  a recordis by default a line, but it can be user-defined with the <EMCLASS="emphasis">-d</EM>option specifying a pattern that will be used as a record delimiter.For example, </P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>agrep -d '^From ' 'pizza' mbox</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">outputs all<SPANCLASS="link">mail messages (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>(delimited by a line beginning with <EMCLASS="emphasis">From</EM> and a space)in the file <EMCLASS="emphasis">mbox</EM>that contain the keyword <EMCLASS="emphasis">pizza</EM>.Another example: </P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>agrep -d '$$' </B></CODE><CODECLASS="replaceable"><I>pattern</I></CODE><CODECLASS="userinput"><B> foo</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">will output allparagraphs (separated by an empty line) that contain <EMCLASS="emphasis">pattern</EM>.</P></LI><LICLASS="listitem"><PCLASS="para"><EMCLASS="emphasis">agrep</EM> allowsmultiple patterns with AND (or OR) logic queries.For example, </P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>agrep -d '^From ' 'burger,pizza' mbox</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">outputs all mail messages containing at least one of the two keywords (<CODECLASS="literal">,</CODE> stands for OR).</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>agrep -d '^From ' 'good;pizza' mbox</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">outputs all mail messagescontaining both keywords.</P></LI></OL><PCLASS="para">Putting these options together one can write queries like:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>agrep -d '$$' -2 '&lt;CACM&gt;;</B></CODE><CODECLASS="replaceable"><I>TheAuthor</I></CODE><CODECLASS="userinput"><B>;Curriculum;&lt;198[5-9]&gt;' bib</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">which outputs all paragraphs referencing articles in CACM between 1985 and 1989 by <EMCLASS="emphasis">TheAuthor</EM> dealing with Curriculum.Two errors are allowed, but they cannot be in either CACM or the year.(The &lt;&gt; brackets forbid errors in the pattern between them.)</P><PCLASS="para">Other <EMCLASS="emphasis">agrep</EM> features include searching for regular expressions (with orwithout errors), unlimited wildcards, limiting the errors to only insertions or only substitutions or any combination, allowing each deletion, for example, to be counted as, say, 2 substitutions or 3 insertions, restricting parts of the query to be exact and parts to be approximate, and many more.</P><PCLASS="para">Email <EMCLASS="emphasis">glimpse-request@cs.arizona.edu</EM> to be added to the<EMCLASS="emphasis">glimpse</EM> mailing list.Email <EMCLASS="emphasis">glimpse@cs.arizona.edu</EM> to report bugs, ask questions,discuss tricks for using glimpse, etc.(This is a moderated mailing list with very little traffic,mostly announcements.)</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN>, <SPANCLASS="authorinitials">SW,&nbsp;UM</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch27_07.htm"TITLE="27.7 grepping for a List of Patterns "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 27.7 grepping for a List of Patterns "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch27_09.htm"TITLE="27.9 New greps Are Much Faster "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 27.9 New greps Are Much Faster "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">27.7 grepping for a List of Patterns </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">27.9 New greps Are Much Faster </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>