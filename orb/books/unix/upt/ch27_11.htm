<HTML><HEAD><TITLE>[Chapter 27] 27.11 A Multiline Context grep Using sed </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:44:28Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch27_01.htm"TITLE="27. Searching Through Files"><LINKREL="prev"HREF="ch27_10.htm"TITLE="27.10 Search RCS Files with rcsgrep "><LINKREL="next"HREF="ch27_12.htm"TITLE="27.12 Make Custom grep Commands (etc.) with perl "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch27_10.htm"TITLE="27.10 Search RCS Files with rcsgrep "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 27.10 Search RCS Files with rcsgrep "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 27<BR>Searching Through Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch27_12.htm"TITLE="27.12 Make Custom grep Commands (etc.) with perl "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 27.12 Make Custom grep Commands (etc.) with perl "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-7955">27.11 A Multiline Context grep Using sed </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-30482"></A><ACLASS="indexterm"NAME="AUTOID-30485"></A><ACLASS="indexterm"NAME="AUTOID-30489"></A><ACLASS="indexterm"NAME="AUTOID-30491"></A><ACLASS="indexterm"NAME="AUTOID-30495"></A>[One weakness of the <EMCLASS="emphasis">grep</EM> family of programs is that they areline-oriented.They read only one line at a time, and so they can'tfind patterns (such as phrases) that are split across two lines.<SPANCLASS="link">agrep (<ACLASS="linkend"HREF="ch27_08.htm"TITLE="glimpse and agrep ">27.8</A>)</SPAN>can do multiline searches.One advantage of the <ICLASS="filename">cgrep.sed</I> script is that it showshow to handle multiple-line patterns in <ICLASS="filename">sed</I>-and can be adaptedfor work other than searches. -JP&nbsp;]</P><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="cgrep.sed">cgrep.sed</A><BR></TH><TDVALIGN="TOP">&#13;It may surprise you to learn that a fairly decent context <EMCLASS="emphasis">grep</EM>program can be built using<SPANCLASS="link"><EMCLASS="emphasis">sed</EM> (<ACLASS="linkend"HREF="ch34_01.htm#UPT-ART-7996"TITLE="Two Things You Must Know About sed ">34.1</A>)</SPAN>.This <EMCLASS="emphasis">sed</EM> version of <EMCLASS="emphasis">cgrep</EM> is used the same way as the Perl versionin article<ACLASS="xref"HREF="ch27_13.htm"TITLE="More grep-like Programs Written in Perl ">27.13</A>:</TD></TR></TABLE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <CODECLASS="userinput"><B>cgrep -10 system main.c</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">will find all lines containing the word <EMCLASS="emphasis">system</EM> in the file <EMCLASS="emphasis">main.c</EM>,and show 10 additional lines of context above and below each match.(The -<CODECLASS="replaceable"><I>context</I></CODE> option must be at least 1, and defaults to 2 lines.)It differs from the Perl version in that, if several matches occurwithin the same context, the lines are printed as one large &quot;hunk&quot;rather than repeated smaller hunks.Each new block of context ispreceded by the line number of the first occurrence in that hunk.This script can also search for patterns that span lines:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">cgrep -3 &quot;awk.*perl&quot;</PRE></BLOCKQUOTE></P><PCLASS="para">will find all occurrences of the word &quot;awk&quot; where it is followed bythe word &quot;perl&quot; somewhere within the next 3 lines.The pattern canbe any<SPANCLASS="link">simple regular expression (<ACLASS="linkend"HREF="ch26_04.htm"TITLE="Using Metacharacters in Regular Expressions ">26.4</A>)</SPAN>,with one notable exception:because you can match across lines, you should use <CODECLASS="literal">\n</CODE>in place of the <CODECLASS="literal">^</CODE> and <CODECLASS="literal">$</CODE> metacharacters.</P><PCLASS="para">Article<ACLASS="xref"HREF="ch34_17.htm"TITLE="Searching for Patterns Split Across Lines ">34.17</A>explains how the script works.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">GU</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch27_10.htm"TITLE="27.10 Search RCS Files with rcsgrep "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 27.10 Search RCS Files with rcsgrep "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch27_12.htm"TITLE="27.12 Make Custom grep Commands (etc.) with perl "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 27.12 Make Custom grep Commands (etc.) with perl "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">27.10 Search RCS Files with rcsgrep </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">27.12 Make Custom grep Commands (etc.) with perl </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>