<HTML><HEAD><TITLE>[Chapter 27] 27.12 Make Custom grep Commands (etc.) with perl </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:44:29Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch27_01.htm"TITLE="27. Searching Through Files"><LINKREL="prev"HREF="ch27_11.htm"TITLE="27.11 A Multiline Context grep Using sed "><LINKREL="next"HREF="ch27_13.htm"TITLE="27.13 More grep-like Programs Written in Perl "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch27_11.htm"TITLE="27.11 A Multiline Context grep Using sed "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 27.11 A Multiline Context grep Using sed "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 27<BR>Searching Through Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch27_13.htm"TITLE="27.13 More grep-like Programs Written in Perl "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 27.13 More grep-like Programs Written in Perl "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-5530">27.12 Make Custom grep Commands (etc.) with perl </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="UPT-ART-5530-IX-GREP-COMMAND-CUSTOMIZING-WITH-PERL"></A><ACLASS="indexterm"NAME="UPT-ART-5530-IX-PERL-CUSTOMIZING-GREP-WITH"></A><ACLASS="indexterm"NAME="UPT-ART-5530-IX-CUSTOMIZING-GREP-COMMANDS"></A><ACLASS="indexterm"NAME="UPT-ART-5530-IX-FILES-SEARCHING-GREP-COMMAND"></A>All of the various <EMCLASS="emphasis">grep</EM>-like utilities perform pretty much thesame function, with minor differences&nbsp;- they search for a specifiedpattern in some or all of a file, and then display that pattern withvarying amounts of surrounding context.</P><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="perl">perl</A><BR></TH><TDVALIGN="TOP">As you use UNIX more and more, you will find yourself wanting to do anincreasing number of <EMCLASS="emphasis">grep</EM>-like tasks, but no particular UNIXutility will quite suit them all (hence the need for the various<EMCLASS="emphasis">grep</EM> utilities discussed earlier in this section). You'll startaccumulating C programs, <EMCLASS="emphasis">awk</EM> scripts, and shell scripts to do thesedifferent tasks, and you'll be craving one utility that can easilyencompass them all so you don't have to waste the disk space for allof those binaries. That utility is <SPANCLASS="link">Perl (<ACLASS="linkend"HREF="ch37_01.htm#UPT-ART-5560"TITLE="What We Do and Don't Tell You About Perl ">37.1</A>)</SPAN>,the &quot;PracticalExtraction and Report Language&quot; developed by Larry Wall. According to thedocumentation accompanying Perl, it is &quot;an interpreted languageoptimized for scanning arbitrary text files, extracting informationfrom those text files, and printing reports based on thatinformation.&quot;  If you don't already have <EMCLASS="emphasis">perl</EM> installedon your system, you can get it from the CD-ROM.  &#13;</TD></TR></TABLE><PCLASS="para">For example, to search for a pattern in the header of a Usenet message:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">perl -ne 'exit if (/^$/); print if (/<CODECLASS="replaceable"><I>pattern</I></CODE>/);' <CODECLASS="replaceable"><I>filename</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">[This works because<SPANCLASS="link">mail and Usenet (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>messages always use a blankline&nbsp;- indicated by <CODECLASS="literal">^$</CODE> in regular expression syntax&nbsp;- to separate theheader from the body of the message. -<EMCLASS="emphasis">TOR</EM>&nbsp;]</P><PCLASS="para">To do a search for a pattern and print the paragraphs in which itappears:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">perl -ne '$/ = &quot;\n\n&quot;; print if (/<CODECLASS="replaceable"><I>pattern</I></CODE>/);' <CODECLASS="replaceable"><I>filename</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">[This assumes that paragraphs are delimited by a double linefeed&nbsp;- thatis, a blank line.You'd have toadjust this script for a <EMCLASS="emphasis">troff</EM> or TeX document whereparagraphs are separated by special codes. -<EMCLASS="emphasis">TOR</EM>&nbsp;]</P><PCLASS="para">Searching through files is one of Perl's strengths, but certainlynot its only strength. Perl encompasses all of the functionality of<EMCLASS="emphasis">sed</EM>, <EMCLASS="emphasis">awk</EM>, <EMCLASS="emphasis">grep</EM>, <EMCLASS="emphasis">find</EM>, and other UNIX utilities.Furthermore, a Perl program to do something originally done withone or more of these utilities is usually faster and easier to readthan the non-Perl solution.[I agree that Perl is usually faster than a bunch of separate UNIXutilities strung together by pipes and temporary files.It also beats many utilities running standalone.But, in my experience, <EMCLASS="emphasis">sed</EM> beats Perl's running speed almostevery time.That could be partly because I have a slow disk, and the 40-kbtye<EMCLASS="emphasis">sed</EM> binary takes less time to load than the 700-kbtye Perl 5binary.Make your own tests, and I'll make room for Jonathan's rebuttal inthe third edition of this book. <CODECLASS="literal">;-)</CODE> <EMCLASS="emphasis">-JP</EM>]</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JIK</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch27_11.htm"TITLE="27.11 A Multiline Context grep Using sed "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 27.11 A Multiline Context grep Using sed "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch27_13.htm"TITLE="27.13 More grep-like Programs Written in Perl "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 27.13 More grep-like Programs Written in Perl "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">27.11 A Multiline Context grep Using sed </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">27.13 More grep-like Programs Written in Perl </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>