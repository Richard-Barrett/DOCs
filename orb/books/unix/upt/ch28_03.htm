<HTML><HEAD><TITLE>[Chapter 28] 28.3 Context diffs </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:44:42Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch28_01.htm"TITLE="28. Comparing Files"><LINKREL="prev"HREF="ch28_02.htm"TITLE="28.2 Comparing Three Different Versions with diff3 "><LINKREL="next"HREF="ch28_04.htm"TITLE="28.4 Side-by-Side diffs: sdiff "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch28_02.htm"TITLE="28.2 Comparing Three Different Versions with diff3 "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 28.2 Comparing Three Different Versions with diff3 "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 28<BR>Comparing Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch28_04.htm"TITLE="28.4 Side-by-Side diffs: sdiff "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 28.4 Side-by-Side diffs: sdiff "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-9917">28.3 Context diffs </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-31137"></A><ACLASS="indexterm"NAME="AUTOID-31141"></A>The <EMCLASS="emphasis">diff</EM> examples in articles<ACLASS="xref"HREF="ch28_01.htm#UPT-ART-2680"TITLE="Checking Differences with diff ">28.1</A>and<ACLASS="xref"HREF="ch28_02.htm"TITLE="Comparing Three Different Versions with diff3 ">28.2</A>show compact formats with just the differences between the two files.But, in many cases, context <EMCLASS="emphasis">diff</EM> listings are more useful.Context <EMCLASS="emphasis">diff</EM>s show the changed lines and the lines around them.(This can be a headache if you're trying to read the listing on aterminal and there are many changed lines fairly close to one another:the context will make a huge &quot;before&quot; section, with the &quot;after&quot; sectionseveral screenfuls ahead.In that case, the more compact <EMCLASS="emphasis">diff</EM> formats can be useful.)</P><PCLASS="para">On many versions of <EMCLASS="emphasis">diff</EM> (including the GNU version on theCD-ROM), the <EMCLASS="emphasis">-c</EM> option shows context around each change.By itself, <EMCLASS="emphasis">-c</EM> shows three lines above and below each change.Here's an example of a C++ file before and after some edits; the <CODECLASS="literal">-c2</CODE>option shows two lines of context:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>diff -c2 include.h.orig include.h</B></CODE>*** include.h.orig      Fri Aug 23 22:17:00 1996-- include.h   Fri Aug 23 23:31:30 1996****************** 45,52 ****  private:      Node    *head;                  // first member in list!     Node    *last;                  // last member in list    public:!     void    load(void);             // insert data into list      void    figure_tax(Taxer tax_obj);      void    summarize(void);        // do calculations-- 45,52 --  private:      Node    *head;                  // first member in list!     Node    *tail;                  // last member in list    public:!     void    load(char *infile);     // read data, insert into list      void    figure_tax(Taxer tax_obj);      void    summarize(void);        // do calculations****************** 77,84 ****          int tax;          int percent;-         int boundary;      } tax_array[TAX_TABLE_RECORDS];    public:      double  give_tax(double gross_pay);     // search array, get tax  };-- 77,85 --          int tax;          int percent;      } tax_array[TAX_TABLE_RECORDS];    public:+             Taxer(void);                    // constructor+             ~Taxer(void);                   // destructor      double  give_tax(double gross_pay);     // search array, get tax  };</PRE></BLOCKQUOTE></P><PCLASS="para">The listing starts with the two filenames and their last-modified dates(&quot;timestamps&quot;).The first filename (here, <EMCLASS="emphasis">include.h.orig</EM>) has three asterisks(<CODECLASS="literal">***</CODE>) before it; the second name has three dashes (<CODECLASS="literal">---</CODE>).These markers identify the two files in the difference listings below.</P><PCLASS="para">Each changed section starts with a long row of asterisks.Next comes a range of lines from the first file and the line numbers shownin that section (marked with a pair of triple asterisks around the linenumbers).After the first file's section, a similar section shows the changed versionin the second file, marked with a pair of triple dashes around the linenumbers.</P><PCLASS="para">Changed lines that exist in both files are marked with an <CODECLASS="literal">!</CODE> (exclamation point)character in the left margin.So, two of the lines between lines 45-52 were changed.<EMCLASS="emphasis">include.h.orig</EM> had the line <CODECLASS="literal">Node&nbsp;*last;</CODE>;in <EMCLASS="emphasis">include.h</EM>, part of that line was changed to read <CODECLASS="literal">Node&nbsp;*tail;</CODE>.The pair of lines starting with <CODECLASS="literal">void&nbsp;load</CODE> were also changed.Other lines in the section weren't changed.</P><PCLASS="para">The next changed section shows lines 77-84 in <EMCLASS="emphasis">include.h.orig</EM> and77-85 in <EMCLASS="emphasis">include.h</EM>.The minus sign (<CODECLASS="literal">-</CODE>) in the left margin shows that the<CODECLASS="literal">int&nbsp;boundary</CODE> line of <EMCLASS="emphasis">include.h.orig</EM> was deleted; itdoesn't appear in the second file.In the second file, <EMCLASS="emphasis">include.h</EM>, there are two new lines&nbsp;- marked with aplus sign (<CODECLASS="literal">+</CODE>) in the margin.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-31179"></A>Context <EMCLASS="emphasis">diff</EM>s aren't just nice for reading.The<SPANCLASS="link"><EMCLASS="emphasis">patch</EM> (<ACLASS="linkend"HREF="ch33_09.htm"TITLE="patch: Generalized Updating of Files that Differ ">33.9</A>)</SPAN>program reads context <EMCLASS="emphasis">diff</EM> listings and uses them to update filesautomatically.For example, if I had <EMCLASS="emphasis">include.h.orig</EM>, someone could send me the<EMCLASS="emphasis">diff</EM> listing above (called a &quot;patch&quot;).From the original and the patch, <EMCLASS="emphasis">patch</EM> could create <EMCLASS="emphasis">include.h</EM>.The advantage of a context <EMCLASS="emphasis">diff</EM> over the formats in articles<ACLASS="xref"HREF="ch28_01.htm#UPT-ART-2680"TITLE="Checking Differences with diff ">28.1</A>and<ACLASS="xref"HREF="ch28_02.htm"TITLE="Comparing Three Different Versions with diff3 ">28.2</A>is that context <EMCLASS="emphasis">diff</EM>s let <EMCLASS="emphasis">patch</EM> locate the changed sectionseven if they've been moved somewhat.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch28_02.htm"TITLE="28.2 Comparing Three Different Versions with diff3 "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 28.2 Comparing Three Different Versions with diff3 "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch28_04.htm"TITLE="28.4 Side-by-Side diffs: sdiff "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 28.4 Side-by-Side diffs: sdiff "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">28.2 Comparing Three Different Versions with diff3 </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">28.4 Side-by-Side diffs: sdiff </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>