<HTML><HEAD><TITLE>[Chapter 28] 28.13 make Isn't Just for Programmers! </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:44:51Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch28_01.htm"TITLE="28. Comparing Files"><LINKREL="prev"HREF="ch28_12.htm"TITLE="28.12 Comparing Two Files with comm "><LINKREL="next"HREF="ch28_14.htm"TITLE="28.14 Even More Uses for make "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch28_12.htm"TITLE="28.12 Comparing Two Files with comm "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 28.12 Comparing Two Files with comm "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 28<BR>Comparing Files</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch28_14.htm"TITLE="28.14 Even More Uses for make "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 28.14 Even More Uses for make "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-5380">28.13 make Isn't Just for Programmers! </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="UPT-ART-5380-IX-COMPARING-FILES-MAKE-UTILITY-FOR"></A><ACLASS="indexterm"NAME="UPT-ART-5380-IX-MAKE-PROGRAM"></A>The <EMCLASS="emphasis">make</EM> program is a UNIX facility for describing dependenciesamong a group of related files, usually ones that are part of the same project.This facility has enjoyed widespread use in software development projects.Programmers use <EMCLASS="emphasis">make</EM> to describe how to &quot;make&quot; a program&nbsp;- whatsource files need to be compiled, what libraries must be included,and which object files need to be linked.By keeping track of these relationships in a single place,individual members of a software development team canmake changes to a single module, run <EMCLASS="emphasis">make</EM>, and be assured that theprogram reflects the latest changes made by others on the team.</P><PCLASS="para">We group <EMCLASS="emphasis">make</EM> with the other commands for keeping track of differencesbetween files only by a leap of the imagination.However, although it does not compare two versions of the samesource file, it can be used to compare versions such as asource file and the formatted output.</P><PCLASS="para">Part of what makes UNIX a productive environment for text processingis discovering other uses for standard programs.The <EMCLASS="emphasis">make</EM> utility has many possible applications for a documentationproject.One such use is to maintain up-to-date copies of formatted filesthat make up a single manual and provide users with a way of obtaining aprinted copy of the entire manual without having to know whichpreprocessors or<SPANCLASS="link"><EMCLASS="emphasis">nroff</EM>/<EMCLASS="emphasis">troff</EM> (<ACLASS="linkend"HREF="ch43_13.htm"TITLE="The Text Formatters nroff, troff, ditroff, ... ">43.13</A>)</SPAN>options need to be invoked.</P><PCLASS="para">The basic operation that <EMCLASS="emphasis">make</EM> performs is to compare two sets offiles, for example, formatted and unformatted files, anddetermine if any members of one set, the unformatted files, are morerecent than their counterpart in the other set, the formatted files.This is accomplished by simply comparing the<SPANCLASS="link">last-modification date (<ACLASS="linkend"HREF="ch16_05.htm"TITLE="The Three UNIX File Times ">16.5</A>)</SPAN>(&quot;timestamp&quot;) of pairs of files.If the unformatted source file has been modified since the formattedfile was made, <EMCLASS="emphasis">make</EM> executes the specified command to &quot;remake&quot; theformatted file.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-31633"></A>To use <EMCLASS="emphasis">make</EM>, you have to write a description file, usually named<EMCLASS="emphasis">makefile</EM> (or <EMCLASS="emphasis">Makefile</EM>), that resides in the working directory forthe project.The <EMCLASS="emphasis">makefile</EM> specifies a hierarchy of dependencies among individualfiles, called components.At the top of this hierarchy is a target.For our purposes, you can think of the target as a printed copy of abook; the components are formatted files generated by processing anunformatted file with <EMCLASS="emphasis">nroff</EM>.</P><PCLASS="para">Here's the <EMCLASS="emphasis">makefile</EM> that reflects these dependencies:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch43_02.htm"TITLE="43.2 Introduction to Printing on UNIX ">lp</A> <ACLASS="co"HREF="ch43_15.htm"TITLE="43.15 From a Source File to the Printer ">tbl</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">manual: ch01.fmt ch02.fmt ch03.fmt        lp ch0[1-3].fmtch01.fmt: ch01        nroff -mm ch01 &gt; ch01.fmtch02.fmt: ch02        tbl ch02 | nroff -mm &gt; ch02.fmtch03.fmt: ch03a ch03b ch03c        nroff -mm ch03[abc] &gt; ch03.fmt</PRE></TD></TR></TABLE></P><PCLASS="para">This hierarchy is represented in<ACLASS="xref"HREF="ch28_13.htm#UPT-ART-5380-FIG-0"TITLE="What makefile Describes: Files and Commands to Make Manual">Figure 28.1</A>.</P><H4CLASS="figure"><ACLASS="title"NAME="UPT-ART-5380-FIG-0">Figure 28.1: What makefile Describes: Files and Commands to Make Manual</A></H4><IMGCLASS="graphic"SRC="figs/5380.gif"ALT="Figure 28.1"><PCLASS="para">The target is <EMCLASS="emphasis">manual</EM>, which is made up of three formatted fileswhose names appear after the colon.Each of these components has its own dependency line.For instance, <EMCLASS="emphasis">ch01.fmt</EM> is dependent upon a coded filenamed <EMCLASS="emphasis">ch01</EM>. Underneath the dependency line is the commandthat generates <EMCLASS="emphasis">ch01.fmt</EM>. Each command line must begin with a TAB.</P><PCLASS="para">When you enter the command <CODECLASS="literal">make</CODE>, the end result is that the threeformatted files are spooled to the printer.However, a sequence of operations is performed before this final action.The dependency line for each component is evaluated, determining ifthe coded file has been modified since the last time the formattedfile was made.The formatting command will be executed only if the coded file ismore recent.After all the components are made, the<SPANCLASS="link"><EMCLASS="emphasis">lp</EM> (<ACLASS="linkend"HREF="ch43_02.htm"TITLE="Introduction to Printing on UNIX ">43.2</A>)</SPAN>command is executed.</P><PCLASS="para">As an example of this process, we'll assume that all the formattedfiles are up-to-date.Then by editing the source file <EMCLASS="emphasis">ch03a</EM>, we change the modification time.When you execute the <EMCLASS="emphasis">make</EM> command, any output files dependent on<EMCLASS="emphasis">ch03a</EM> are reformatted:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <CODECLASS="userinput"><B>make</B></CODE>nroff -mm ch03[abc] &gt; ch03.fmtlp ch0[1-3].fmt</PRE></BLOCKQUOTE></P><PCLASS="para">Only <EMCLASS="emphasis">ch03.fmt</EM> needs to be remade.As soon as that formatting command finishes, the command underneaththe target <EMCLASS="emphasis">manual</EM> is executed, spooling the files to the printer.</P><PCLASS="para">Although this example has actually made only limited use of <EMCLASS="emphasis">make</EM>'sfacilities, we hope it suggests more ways to use <EMCLASS="emphasis">make</EM> in adocumention project.You can keep your <EMCLASS="emphasis">makefiles</EM> just this simple, or you can go on tolearn additional notation, such as internal macros and suffixes, inan effort to generalize the description file for increased usefulness.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">TOR</SPAN> <SPANCLASS="bibliomisc">from <CITECLASS="citetitle">UNIX Text Processing</CITE>, Hayden Books, 1987</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch28_12.htm"TITLE="28.12 Comparing Two Files with comm "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 28.12 Comparing Two Files with comm "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch28_14.htm"TITLE="28.14 Even More Uses for make "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 28.14 Even More Uses for make "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">28.12 Comparing Two Files with comm </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">28.14 Even More Uses for make </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>