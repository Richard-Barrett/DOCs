<HTML><HEAD><TITLE>[Chapter 29] 29.4 Inside spell </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:45:02Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch29_01.htm"TITLE="29. Spell Checking, Word Counting, and Textual Analysis"><LINKREL="prev"HREF="ch29_03.htm"TITLE="29.3 How Do I Spell That Word? "><LINKREL="next"HREF="ch29_05.htm"TITLE="29.5 Adding Words to ispell's Dictionary "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_03.htm"TITLE="29.3 How Do I Spell That Word? "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 29.3 How Do I Spell That Word? "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 29<BR>Spell Checking, Word Counting, and Textual Analysis</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_05.htm"TITLE="29.5 Adding Words to ispell's Dictionary "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 29.5 Adding Words to ispell's Dictionary "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-7963">29.4 Inside spell </A></H2><PCLASS="para">[If you have <SPANCLASS="link"><EMCLASS="emphasis">ispell</EM> (<ACLASS="linkend"HREF="ch29_02.htm"TITLE="Check Spelling Interactively with ispell ">29.2</A>)</SPAN>,there's not a whole lot of reason for using <ICLASS="filename">spell</I> any more.Not only is <ICLASS="filename">ispell</I> more powerful, it's a heck of a lot easier to updateits spelling dictionaries.Nonetheless, we decided to include thisarticle, because it makes clear the kinds of rules that spellingcheckers go through to expand on the words in their dictionaries. -TOR\]</P><PCLASS="para">On many UNIX systems,the directory <EMCLASS="emphasis">/usr/lib/spell</EM> contains the main program invoked by the<EMCLASS="emphasis">spell</EM> command along with auxiliary programs and data files.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>ls -l /usr/lib/spell</B></CODE>total 888-rwxr-xr-x   1 bin          545 Dec  9  1988 compress-rwxr-xr-x   1 bin        16324 Dec  9  1988 hashcheck-rwxr-xr-x   1 bin        14828 Dec  9  1988 hashmake-rw-r--r--   1 bin        53872 Dec  9  1988 hlista-rw-r--r--   1 bin        53840 Dec  9  1988 hlistb-rw-r--r--   1 bin         6336 Dec  9  1988 hstop-rw-rw-rw-   1 root      252312 Nov 27 16:24 spellhist-rwxr-xr-x   1 bin        21634 Dec  9  1988 spellin-rwxr-xr-x   1 bin        23428 Dec  9  1988 spellprog</PRE></BLOCKQUOTE></P><PCLASS="para">On some systems, the <EMCLASS="emphasis">spell</EM> command is a shell script that pipes its input through<SPANCLASS="link"><EMCLASS="emphasis">deroff -w</EM> (<ACLASS="linkend"HREF="ch29_10.htm"TITLE="Just the Words, Please ">29.10</A>)</SPAN>and<SPANCLASS="link"><EMCLASS="emphasis">sort -u</EM> (<ACLASS="linkend"HREF="ch36_06.htm"TITLE="Miscellaneous sort Hints ">36.6</A>)</SPAN>to remove formatting codes and prepare a sorted word list, one word per line.On other systems, it is a stand-alone program that does these stepsinternally.Two separate spelling lists are maintained, one for American usageand one for British usage (invoked with the <EMCLASS="emphasis">-b</EM> option to <EMCLASS="emphasis">spell</EM>).These lists, <EMCLASS="emphasis">hlista</EM> and <EMCLASS="emphasis">hlistb</EM>, cannot be read or updated directly.They are compressed files, compiled from a list of wordsrepresented as nine-digit hash codes.(Hash coding is a special technique used to quickly search for information.)</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-32021"></A>The main program invoked by <EMCLASS="emphasis">spell</EM> is <EMCLASS="emphasis">spellprog</EM>.It loads the list of hash codes from either <EMCLASS="emphasis">hlista</EM> or <EMCLASS="emphasis">hlistb</EM> into atable, and looks for the hash code corresponding to each word on thesorted word list.This eliminates all words (or hash codes) actually found in thespelling list.For the remaining words, <EMCLASS="emphasis">spellprog</EM> tries to see if it can derive arecognizable word by performing various operations on the word stem,based on suffix and prefix rules.<ACLASS="indexterm"NAME="AUTOID-32028"></A>A few of these manipulations follow:</P><BLOCKQUOTECLASS="blockquote"><PCLASS="para">-y+iness+ness-y+i+less+less-y+ies-t+ce-t+cy</P></BLOCKQUOTE><PCLASS="para">The new words created as a result of these manipulations will bechecked once more against the spell table.However, before the stem-derivative rules are applied, the remainingwords are checked against a table of hash codes built from the file <EMCLASS="emphasis">hstop</EM>.<ACLASS="indexterm"NAME="AUTOID-32034"></A>The stop list contains typical misspellings that stem-derivativeoperations might allow to pass.For instance, the misspelled word <EMCLASS="emphasis">thier</EM> would be converted into <EMCLASS="emphasis">thy</EM>using the suffix rule -y+ier.The <EMCLASS="emphasis">hstop</EM> file accounts for as many cases of this typeof error as possible.</P><PCLASS="para">The final output consists of words not found in the spell list, evenafter the program tried to search for their stems, and words thatwere found in the stop list.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-32041"></A>You can get a better sense of these rules in action by using the <EMCLASS="emphasis">-v</EM>or <EMCLASS="emphasis">-x</EM> option.The <EMCLASS="emphasis">-v</EM> option eliminates the last lookup in the table, and producesa list of words that are not actually in the spelling list alongwith possible derivatives.It allows you to see which words were found as a result ofstem-derivative operations, and prints the rule used.(Refer to the <EMCLASS="emphasis">sample</EM> file in article<ACLASS="xref"HREF="ch29_01.htm#UPT-ART-4080"TITLE="The UNIX spell Command ">29.1</A>.)</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>spell -v sample</B></CODE>AlcuinditroffLaserWriterPostScriptprinterrTranScript+out  output+s    uses</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-32053"></A>The <EMCLASS="emphasis">-x</EM> option makes <EMCLASS="emphasis">spell</EM> begin at the stem-derivative stage, andprints the various attempts it makes to find the word stem of each word.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>spell -x sample</B></CODE>...=into=LaserWriter=LaserWrite=LaserWrit=laserWriter=laserWrite=laserWrit=output=put...LaserWriter...</PRE></BLOCKQUOTE></P><PCLASS="para">The stem is preceded by an equal sign (<CODECLASS="literal">=</CODE>).At the end of the output are the words whosestem does not appear in the spell list.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-32064"></A>One other file you should know about is <EMCLASS="emphasis">spellhist</EM>.On some systems,each time you run <EMCLASS="emphasis">spell</EM>, the output is appended through<SPANCLASS="link"><EMCLASS="emphasis">tee</EM> (<ACLASS="linkend"HREF="ch13_09.htm"TITLE="Send Output Two or More Places with tee ">13.9</A>)</SPAN>into <EMCLASS="emphasis">spellhist</EM>, in effect creating a list of all themisspelled or unrecognized words for your site.The <EMCLASS="emphasis">spellhist</EM> file is something of a &quot;garbage&quot; file that keeps ongrowing.You will want to reduce it or remove it periodically.To extract useful information from this <EMCLASS="emphasis">spellhist</EM>, you might use the<EMCLASS="emphasis">sort</EM>and<SPANCLASS="link"><EMCLASS="emphasis">uniq&nbsp;-c</EM> (<ACLASS="linkend"HREF="ch35_20.htm"TITLE="Quick Reference: uniq ">35.20</A>)</SPAN>commands to compile alist of misspelled words or special terms that occur most frequently(see article<ACLASS="xref"HREF="ch29_07.htm"TITLE="Count How Many Times Each Word Is Used ">29.7</A>for a similar example).It is possible to add these words back into the basic spellingdictionary, but this is too complex a process to describe here.It's probably easier just to use a <SPANCLASS="link">local spelling dictionary (<ACLASS="linkend"HREF="ch29_01.htm#UPT-ART-4080"TITLE="The UNIX spell Command ">29.1</A>)</SPAN>.Even better, use <EMCLASS="emphasis">ispell</EM>; not only is it a more powerfulspelling program, it is much easier to<SPANCLASS="link">update the word lists it uses (<ACLASS="linkend"HREF="ch29_05.htm"TITLE="Adding Words to ispell's Dictionary ">29.5</A>)</SPAN>.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">DD</SPAN> <SPANCLASS="bibliomisc">from <CITECLASS="citetitle">UNIX Text Processing</CITE>, Hayden Books, 1987</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_03.htm"TITLE="29.3 How Do I Spell That Word? "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 29.3 How Do I Spell That Word? "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch29_05.htm"TITLE="29.5 Adding Words to ispell's Dictionary "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 29.5 Adding Words to ispell's Dictionary "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">29.3 How Do I Spell That Word? </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">29.5 Adding Words to ispell's Dictionary </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>