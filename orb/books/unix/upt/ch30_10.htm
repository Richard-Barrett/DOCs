<HTML><HEAD><TITLE>[Chapter 30] 30.10 Confirming Substitutions in ex and vi</TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:45:25Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch30_01.htm"TITLE="30. vi Tips and Tricks"><LINKREL="prev"HREF="ch30_09.htm"TITLE="30.9 Using Search Patterns and Global Commands"><LINKREL="next"HREF="ch30_11.htm"TITLE="30.11 Keep Your Original File, Write to a New File "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch30_09.htm"TITLE="30.9 Using Search Patterns and Global Commands"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 30.9 Using Search Patterns and Global Commands"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 30<BR>vi Tips and Tricks</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch30_11.htm"TITLE="30.11 Keep Your Original File, Write to a New File "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 30.11 Keep Your Original File, Write to a New File "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-6330">30.10 Confirming Substitutions in ex and vi</A></H2><PCLASS="para">It makes sense to be overly careful when using a search and replace command.<ACLASS="indexterm"NAME="AUTOID-33126"></A><ACLASS="indexterm"NAME="AUTOID-33129"></A><ACLASS="indexterm"NAME="AUTOID-33132"></A><ACLASS="indexterm"NAME="AUTOID-33134"></A><ACLASS="indexterm"NAME="AUTOID-33137"></A>It sometimes happens that what you get is not what you expect.You can undo any search and replacement command byentering <CODECLASS="literal">u</CODE>, provided that the command was intended for the most recentedit you made.But you don't always catch undesired changes until it is too lateto undo them.Another way to protect your edited file is to save the file with<CODECLASS="literal">:w</CODE> before performing a global replacement.Then at least you can quit the file without saving your edits andgo back to where you were before the change was made.You can also read theprevious version of the buffer back in with<SPANCLASS="link"><CODECLASS="literal">:e!</CODE> (<ACLASS="linkend"HREF="ch30_04.htm"TITLE="Editing Multiple Files with vi ">30.4</A>)</SPAN>.</P><PCLASS="para">It's wise to be cautious and know exactly what is going to bechanged in your file.If you'd like to see what the search turns up  and confirm each replacement before it is made, add the <CODECLASS="literal">c</CODE> option (for confirm)at the end of the substitute command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>:1,30s/his/the/gc</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">This command will display the entire line where the string has been located, and the string will be marked by a seriesof carets (<CODECLASS="literal">^^^^</CODE>).</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">copyists at his school              ^^^_</PRE></BLOCKQUOTE></P><PCLASS="para">If you want to make the replacement, you must enter <CODECLASS="literal">y</CODE> (for yes)'vs 12and press RETURN.If you don't want to make a change, simply pressRETURN.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">this can be used for invitations, signs, and menus.   ^^^_</PRE></BLOCKQUOTE></P><PCLASS="para">The combination of the <EMCLASS="emphasis">vi</EM> commands, <CODECLASS="literal">n</CODE> (repeat last search) and dot (<CODECLASS="literal">.</CODE>)(repeat last command), is also an extraordinarily useful andquick way to page through a file and make repetitive changes thatyou may not want to make globally. So, for example, if your editor has told you that you're using <EMCLASS="emphasis">which</EM> when you should be using <EMCLASS="emphasis">that</EM>, you can spot-checkevery occurrence of <EMCLASS="emphasis">which</EM>, changing only those that are incorrect:<TABLECLASS="informaltable"><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">/which</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Search for <EMCLASS="emphasis">which</EM>.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">cwthat</CODE> <KBDCLASS="keycap">[ESC]</KBD></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Change to <EMCLASS="emphasis">that</EM>.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">n</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Repeat search.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">.</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Repeat change (if appropriate).</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">.</TD></TR></TBODY></TABLE>This often turns out to be faster than using a globalsubstitution with confirmation.[It also lets you see other lines near the text you're checking. -<EMCLASS="emphasis">JP</EM>&nbsp;]</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">DD, TOR</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch30_09.htm"TITLE="30.9 Using Search Patterns and Global Commands"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 30.9 Using Search Patterns and Global Commands"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch30_11.htm"TITLE="30.11 Keep Your Original File, Write to a New File "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 30.11 Keep Your Original File, Write to a New File "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">30.9 Using Search Patterns and Global Commands</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">30.11 Keep Your Original File, Write to a New File </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>