<HTML><HEAD><TITLE>[Chapter 30] 30.15 Useful Global Commands (with Pattern Matches) </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:45:27Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch30_01.htm"TITLE="30. vi Tips and Tricks"><LINKREL="prev"HREF="ch30_14.htm"TITLE="30.14 Moving Blocks of Text by Patterns "><LINKREL="next"HREF="ch30_16.htm"TITLE="30.16 Counting Occurrences; Stopping Search Wraps "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch30_14.htm"TITLE="30.14 Moving Blocks of Text by Patterns "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 30.14 Moving Blocks of Text by Patterns "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 30<BR>vi Tips and Tricks</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch30_16.htm"TITLE="30.16 Counting Occurrences; Stopping Search Wraps "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 30.16 Counting Occurrences; Stopping Search Wraps "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-6350">30.15 Useful Global Commands (with Pattern Matches) </A></H2><PCLASS="para">The best way to learn pattern matching is by example, so here's a short list of pattern-matching examples, with explanations.(Article<ACLASS="xref"HREF="ch26_10.htm"TITLE="Pattern Matching Quick Reference with Examples ">26.10</A>has a list of these patterns.)Study the syntax carefully so you understand the principles at work.You should then be able to adapt these examples to your own situation.</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">Change all occurrences of the word <EMCLASS="emphasis">help</EM>(or <EMCLASS="emphasis">Help</EM>) to <EMCLASS="emphasis">HELP</EM>:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch33_03.htm"TITLE="33.3 Line Addressing ">%</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen"><CODECLASS="userinput"><B>:%s/[Hh]elp/HELP/g</B></CODE></PRE></TD></TR></TABLE></P><PCLASS="para">or:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>:%s/[Hh]elp/\U&amp;/g</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The <CODECLASS="literal">\U</CODE> changes the pattern that follows to all uppercase. Thepattern that follows is the repeated search pattern, which iseither <EMCLASS="emphasis">help</EM> or <EMCLASS="emphasis">Help</EM>.&#13;</P></LI><LICLASS="listitem"><PCLASS="para">Replace one or more spaces following a colon (<CODECLASS="literal">:</CODE>) or a period(<CODECLASS="literal">.</CODE>) with two spaces (here a space is marked by a \h'1p'<IMGSRC="../chars/squ.gif"ALT=" ">\h'1p'):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>:%s/\([:.]\\)\h'1p'<IMGSRC="../chars/squ.gif"ALT=" ">\h'1p'\h'1p'<IMGSRC="../chars/squ.gif"ALT=" ">\h'1p'*/\\1\h'1p'<IMGSRC="../chars/squ.gif"ALT=" ">\h'1p'\h'1p'<IMGSRC="../chars/squ.gif"ALT=" ">\h'1p'/g</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Either of the two characters within brackets can be matched.This character is saved into a<SPANCLASS="link">hold buffer, using <CODECLASS="literal">\(</CODE> and <CODECLASS="literal">\)</CODE> (<ACLASS="linkend"HREF="ch34_10.htm"TITLE="Referencing Portions of a Search String ">34.10</A>)</SPAN>,and restored on the right-hand side by the <CODECLASS="literal">\1</CODE>.Note that within brackets a special character such as a dot does not need to be escaped with a backslash (<CODECLASS="literal">\</CODE>).</P></LI><LICLASS="listitem"><PCLASS="para">Delete all blank lines:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch33_04.htm"TITLE="33.4 Useful ex Commands ">g</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen"><CODECLASS="userinput"><B>:g/^$/d</B></CODE></PRE></TD></TR></TABLE></P><PCLASS="para">What you are actually matching here is the beginning of the line (<CODECLASS="literal">^</CODE>)followed by the end of the line (<CODECLASS="literal">$</CODE>), with nothing in between.</P></LI><LICLASS="listitem"><PCLASS="para">Delete all blank lines, plus any lines that contain only white space:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>:g/^[<IMGSRC="../chars/squ.gif"ALT=" "></B></CODE><CODECLASS="replaceable"><I>tab</I></CODE><CODECLASS="userinput"><B>]*$/d</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">(In the line above, a tab is shown as <CODECLASS="replaceable"><I>tab</I></CODE>.)A line may appear to be blank but may in fact contain spaces or tabs.The previous example will not delete such a line.This example, like the one above it, searches for the beginning and endof the line. But instead of having nothing in between, thepattern tries to find any number of spaces or tabs.If no spaces or tabs are matched, the line is blank.To delete lines that contain white space but that <EMCLASS="emphasis">aren't</EM> blank,you would have to match lines with <EMCLASS="emphasis">at least</EM> one space or tab:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>:g/^[<IMGSRC="../chars/squ.gif"ALT=" "></B></CODE><CODECLASS="replaceable"><I>tab</I></CODE><CODECLASS="userinput"><B>][<IMGSRC="../chars/squ.gif"ALT=" "></B></CODE><CODECLASS="replaceable"><I>tab</I></CODE><CODECLASS="userinput"><B>]*$/d</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para">Match the first quoted argument of all section header (<CODECLASS="literal">.Ah</CODE>)<SPANCLASS="link">macros (<ACLASS="linkend"HREF="ch43_13.htm"TITLE="The Text Formatters nroff, troff, ditroff, ... ">43.13</A>)</SPAN>andreplace each line with this argument:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>:%s/^\.Ah &quot;\([^&quot;]*\)&quot; .*/\1/</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The substitution assumes that the <CODECLASS="literal">.Ah</CODE> macro can have more thanone argument surrounded by quotes. You want to match everythingbetween quotes, but only up to the <EMCLASS="emphasis">first</EM> closing quote.  Using<CODECLASS="literal">&quot;.*&quot;</CODE> would be wrong because it would match all argumentson the line.  What you do is match a series of characters that<EMCLASS="emphasis">aren't</EM> quotes, <CODECLASS="literal">[^&quot;]*</CODE>.  The pattern<CODECLASS="literal">&quot;[^&quot;]*&quot;</CODE> matches a quote, followed by any number ofnon-quote characters, followed by a quote. Enclose the first argumentin <CODECLASS="literal">\(</CODE> and <CODECLASS="literal">\)</CODE> so that it can be replayed using<CODECLASS="literal">\1</CODE>.</P></LI><LICLASS="listitem"><PCLASS="para">Same as previous, except preserve the original lines by copying them:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>:g/^\.Ah/t$ | s/\.Ah &quot;\([^&quot;]*\)&quot; .*/\1/</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">In <EMCLASS="emphasis">ex</EM>, the vertical bar (<CODECLASS="literal">|</CODE>) is a command separatorthat works like a<SPANCLASS="link">semicolon (<CODECLASS="literal">;</CODE>) (<ACLASS="linkend"HREF="ch08_05.htm"TITLE="Command-Line Evaluation ">8.5</A>)</SPAN>on a UNIX command line.  The first part, <CODECLASS="literal">:g/^\.Ah/t$</CODE>,matches all lines that begin with a <CODECLASS="literal">.Ah</CODE> macro, uses the<CODECLASS="literal">t</CODE> command to copy these lines, and places them after the lastline (<CODECLASS="literal">$</CODE>) of the file. The second part is the same as inthe previous example, except that the substitutions are performed oncopies at the end of the file. The original lines are unchanged.<ACLASS="indexterm"NAME="AUTOID-33441"></A><ACLASS="indexterm"NAME="AUTOID-33442"></A><ACLASS="indexterm"NAME="AUTOID-33443"></A><ACLASS="indexterm"NAME="AUTOID-33444"></A></P></LI></OL><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">TOR</SPAN>, <SPANCLASS="authorinitials">DG</SPAN> <SPANCLASS="bibliomisc">from O'Reilly &amp; Associates' <CITECLASS="citetitle">Learning the vi Editor</CITE>, Chapter 6</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch30_14.htm"TITLE="30.14 Moving Blocks of Text by Patterns "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 30.14 Moving Blocks of Text by Patterns "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch30_16.htm"TITLE="30.16 Counting Occurrences; Stopping Search Wraps "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 30.16 Counting Occurrences; Stopping Search Wraps "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">30.14 Moving Blocks of Text by Patterns </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">30.16 Counting Occurrences; Stopping Search Wraps </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>