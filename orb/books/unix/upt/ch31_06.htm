<HTML><HEAD><TITLE>[Chapter 31] 31.6 Protecting Keys from Interpretation by ex </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:46:15Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch31_01.htm"TITLE="31. Creating Custom Commands in vi"><LINKREL="prev"HREF="ch31_05.htm"TITLE="31.5 Keymaps for Pasting into a Window Running vi "><LINKREL="next"HREF="ch31_07.htm"TITLE="31.7 Maps for Repeated Edits "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch31_05.htm"TITLE="31.5 Keymaps for Pasting into a Window Running vi "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 31.5 Keymaps for Pasting into a Window Running vi "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 31<BR>Creating Custom Commands in vi</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch31_07.htm"TITLE="31.7 Maps for Repeated Edits "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 31.7 Maps for Repeated Edits "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-6370">31.6 Protecting Keys from Interpretation by ex </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="UPT-ART-6370-IX-CONTROL-CHARACTERS-EX-AND-VI-EDITORS-AND"></A>Note that when defining a map, you cannot simply type certain keys,such asRETURN,ESC,BACKSPACE,andDELETEas part of the command to be mapped, because these keys already have meaning within <EMCLASS="emphasis">ex</EM>.If you want to include one of these keys as part of the commandsequence, you must escape the normal meaning by preceding the key with <CODECLASS="literal">^V</CODE> ( CTRL-v).A carriage return after CTRL-v appears as <CODECLASS="literal">^M</CODE>, escape as <CODECLASS="literal">^[</CODE>, backspace as<CODECLASS="literal">^H</CODE>, and so on.</P><PCLASS="para">On the other hand, if you want to use a control character as thecharacter to be mapped,in most cases all you have to do is hold down theCTRLkey and press the letter key at the same time.So, for example, all you need to do in order to map <CODECLASS="literal">^A</CODE>(CTRL-a) is to type:<ACLASS="indexterm"NAME="AUTOID-35254"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:map <KBDCLASS="keycap">[CTRL-a]</KBD> <CODECLASS="replaceable"><I>sequence</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">There are, however, a few other control characters that must be escaped with a <CODECLASS="literal">^V</CODE>.One is <CODECLASS="literal">^T</CODE>.The others are:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">The characters that your account uses for erasing parts of theinput you type at a command line,<CODECLASS="literal">^W</CODE> for erasing wordsand <CODECLASS="literal">^U</CODE> for erasing lines(see article<ACLASS="xref"HREF="ch09_02.htm"TITLE="Fix a Line Faster with Line-Kill and Word-Erase ">9.2</A>).</P></LI><LICLASS="listitem"><PCLASS="para">The characters for<SPANCLASS="link">interrupting jobs (<ACLASS="linkend"HREF="ch38_09.htm"TITLE="Killing Foreground Jobs ">38.9</A>)</SPAN>and<SPANCLASS="link">stopping jobs (<ACLASS="linkend"HREF="ch12_08.htm"TITLE="Job Control in a Nutshell ">12.8</A>)</SPAN>.</P></LI></UL><PCLASS="para"><ACLASS="indexterm"NAME="UPT-ART-6370-IX-VI-EDITOR-MAP-COMMANDS"></A><ACLASS="indexterm"NAME="UPT-ART-6370-IX-VI-EDITOR-QUOTING-CONTROL-CHARACTERS"></A><ACLASS="indexterm"NAME="UPT-ART-6370-IX-KEYBOARD-SHORTCUTS-VI-MAP-COMMANDS"></A><ACLASS="indexterm"NAME="AUTOID-35284"></A>So, for example, if you want to map <CODECLASS="literal">^T</CODE>, you must type:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:map <KBDCLASS="keycap">[CTRL-v]</KBD> <KBDCLASS="keycap">[CTRL-t]</KBD> <CODECLASS="replaceable"><I>sequence</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The use of CTRL-vapplies to any <EMCLASS="emphasis">ex</EM> command, not just a map command.This means that you can type a carriage return in an<SPANCLASS="link">abbreviation (<ACLASS="linkend"HREF="ch30_31.htm"TITLE="vi Word Abbreviation ">30.31</A>)</SPAN>or a substitution command. For example, the abbreviation:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>:ab 123 one^Mtwo^Mthree</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">expands to this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">onetwothree</PRE></BLOCKQUOTE></P><PCLASS="para">(The sequence <KBDCLASS="keycap">[CTRL-v]</KBD> <KBDCLASS="keycap">[RETURN]</KBD>is shown as it appears on your screen, <CODECLASS="literal">^M</CODE>.)</P><PCLASS="para">You can also add lines globally at certain locations.The command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>:g/^Section/s//As you recall, in^M&amp;/</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">inserts a phrase on a separate line before any line beginning with the word <EMCLASS="emphasis">Section</EM>. The <CODECLASS="literal">&amp;</CODE> restores the search pattern.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-35313"></A>The vertical bar (<CODECLASS="literal">|</CODE>) is used as a separator of multiple <EMCLASS="emphasis">ex</EM>commands; it's especially difficult to quote.Because a map is interpreted when it's stored and again when it's used,you need enough CTRL-v characters to protect the vertical barfrom each interpretation.You also need to protect stored CTRL-v characters by adding aCTRL-v before each one!The worst case is a text-input mode map(<SPANCLASS="link"><CODECLASS="literal">map!</CODE> (<ACLASS="linkend"HREF="ch31_02.htm"TITLE="Save Time and Typing with the vi map Commands ">31.2</A>)</SPAN>)-it needs threeCTRL-v characters, which means you need to type <EMCLASS="emphasis">six</EM>CTRL-v characters before you type the vertical bar.For example, the following map will make your<SPANCLASS="link">function key F1 (<ACLASS="linkend"HREF="ch31_02.htm"TITLE="Save Time and Typing with the vi map Commands ">31.2</A>)</SPAN>insert the string <CODECLASS="literal">{x|y}</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>map! #1 {x^V^V^V|y}</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">If you ask for a list of text-input mode maps,you should see a single stored CTRL-v:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>:map!</B></CODE>f1  ^[OP   {x^V|y}</PRE></BLOCKQUOTE></P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">LL</SPAN>, <SPANCLASS="authorinitials">DG</SPAN>, <SPANCLASS="authorinitials">JP</SPAN> <SPANCLASS="bibliomisc">from O'Reilly &amp; Associates' <CITECLASS="citetitle">Learning the vi Editor</CITE>, Chapter 7</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch31_05.htm"TITLE="31.5 Keymaps for Pasting into a Window Running vi "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 31.5 Keymaps for Pasting into a Window Running vi "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch31_07.htm"TITLE="31.7 Maps for Repeated Edits "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 31.7 Maps for Repeated Edits "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">31.5 Keymaps for Pasting into a Window Running vi </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">31.7 Maps for Repeated Edits </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>