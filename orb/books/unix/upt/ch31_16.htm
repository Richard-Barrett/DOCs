<HTML><HEAD><TITLE>[Chapter 31] 31.16 vi Macro for Splitting Long Lines </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:46:29Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch31_01.htm"TITLE="31. Creating Custom Commands in vi"><LINKREL="prev"HREF="ch31_15.htm"TITLE="31.15 Fooling vi into Allowing Complex Macros "><LINKREL="next"HREF="ch32_01.htm"TITLE="32. GNU Emacs"></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch31_15.htm"TITLE="31.15 Fooling vi into Allowing Complex Macros "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 31.15 Fooling vi into Allowing Complex Macros "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 31<BR>Creating Custom Commands in vi</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch32_01.htm"TITLE="32. GNU Emacs"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 32. GNU Emacs"BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0436">31.16 vi Macro for Splitting Long Lines </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-35758"></A>When you add text to the start of a line and make the line longer than yourscreen's width, <EMCLASS="emphasis">vi</EM> won't break (&quot;wrap&quot;) the line unless yourcursor crosses the <EMCLASS="emphasis">wrapmargin</EM> point near the right-hand edge ofthe screen.You can get lines that are too long.</P><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="exrc">exrc</A><BR></TH><TDVALIGN="TOP">Here are two macros that cut (Kut) the current line:&#13;</TD></TR></TABLE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">map K 78^V|lBhr^Mmap K 078lF r^M</PRE></BLOCKQUOTE></P><PCLASS="para">The first macro doesn't seem to work on some versions of <EMCLASS="emphasis">vi</EM>.It's the better one though, because it uses the <CODECLASS="literal">|</CODE> (vertical bar)command to move to column 78, even if there are TABs in the line.Then it moves one more character to the right (if it can), moves back to the start of the word, moves back one more character onto the blank or tabbefore the word, and replaces that character with a RETURN.</P><PCLASS="para">The second macro counts TABs as single characters, but it works on everyversion of <EMCLASS="emphasis">vi</EM> I've tried.It moves to the left edge, then to the 79th character, then back to theprevious space.Finally, it replaces that space with a carriage return.</P><PCLASS="para">You might try adding a <CODECLASS="literal">J</CODE> to the start of either macro.That'll join the next line to the current one before cutting; it might make anicer &quot;wrap.&quot;Another way to do this is with a <SPANCLASS="link">filter-through (<ACLASS="linkend"HREF="ch30_22.htm"TITLE="Filtering Text Through a UNIX Command ">30.22</A>)</SPAN>and the<SPANCLASS="link"><EMCLASS="emphasis">fmt</EM> (<ACLASS="linkend"HREF="ch30_37.htm"TITLE="Neatening Lines ">30.37</A>)</SPAN>command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"><CODECLASS="userinput"><B>!!fmt</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">That will break the current line at the 72nd column or before, though it alsomight change the spacing after periods (<CODECLASS="literal">.</CODE>) or replace leading TABs with spaces.<ACLASS="indexterm"NAME="AUTOID-35782"></A><ACLASS="indexterm"NAME="AUTOID-35783"></A><ACLASS="indexterm"NAME="AUTOID-35784"></A><ACLASS="indexterm"NAME="AUTOID-35785"></A></P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch31_15.htm"TITLE="31.15 Fooling vi into Allowing Complex Macros "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 31.15 Fooling vi into Allowing Complex Macros "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="CHAPTER"HREF="ch32_01.htm"TITLE="32. GNU Emacs"><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 32. GNU Emacs"BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">31.15 Fooling vi into Allowing Complex Macros </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">32. GNU Emacs</TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>