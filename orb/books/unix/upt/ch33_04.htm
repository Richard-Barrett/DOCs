<HTML><HEAD><TITLE>[Chapter 33] 33.4 Useful ex Commands </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:46:48Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch33_01.htm"TITLE="33. Batch Editing"><LINKREL="prev"HREF="ch33_03.htm"TITLE="33.3 Line Addressing "><LINKREL="next"HREF="ch33_05.htm"TITLE="33.5 Running Editing Scripts Within vi "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch33_03.htm"TITLE="33.3 Line Addressing "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 33.3 Line Addressing "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 33<BR>Batch Editing</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch33_05.htm"TITLE="33.5 Running Editing Scripts Within vi "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 33.5 Running Editing Scripts Within vi "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-7997">33.4 Useful ex Commands </A></H2><PCLASS="para">Many line editor commands are not particularly useful in scripts.<ACLASS="indexterm"NAME="UPT-ART-7997-IX-EX-EDITOR-COMMAND-DESCRIPTIONS"></A><ACLASS="indexterm"NAME="UPT-ART-7997-IX-COMMANDS-EX-EDITOR"></A>The two commands that you will use far and away the most often are<BCLASS="emphasis.bold">s</B> (substitute), to replace one pattern with another, and<BCLASS="emphasis.bold">d</B> (delete) to delete one or more lines. On occasion, though,you'll want to insert text from a script. (<SPANCLASS="link">Editing scripts builtby <EMCLASS="emphasis">diff</EM> (<ACLASS="linkend"HREF="ch28_09.htm"TITLE="ex Scripts Built by diff ">28.9</A>)</SPAN>make heavy use of insert,append, delete, and change commands.)  And of course, you needcommands to write and quit the editor.</P><PCLASS="para">Here's the syntax of most of the commands you may encounter in<EMCLASS="emphasis">ex</EM> editing scripts.(The <EMCLASS="emphasis">ed</EM> editor understands the abbreviated versions of some,but not all of, these commands.)Elements in [brackets] are optional; don't type the <CODECLASS="literal">[</CODE> or <CODECLASS="literal">]</CODE>.(The leading colon is the <EMCLASS="emphasis">ex</EM> command characterused to issue an <EMCLASS="emphasis">ex</EM> commandfrom <EMCLASS="emphasis">vi</EM>; in a script, the colon would be omitted.)</P><DLCLASS="variablelist"><DTCLASS="term"><BCLASS="emphasis.bold">append</B></DT><DDCLASS="listitem"><PCLASS="para">[address] <BCLASS="emphasis.bold">a</B>[<BCLASS="emphasis.bold">!</B>]<EMCLASS="emphasis">text</EM><CODECLASS="userinput"><B>\.</B></CODE><ACLASS="indexterm"NAME="AUTOID-36495"></A>Append <EMCLASS="emphasis">text</EM> at specified <EMCLASS="emphasis">address</EM>, or at present address ifnone is specified. Add a <BCLASS="emphasis.bold">!</B> to switch the <BCLASS="emphasis.bold">autoindent</B>setting that will be used during input. For example, if <BCLASS="emphasis.bold">autoindent</B>was enabled, <BCLASS="emphasis.bold">!</B> disables it.</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">change</B></DT><DDCLASS="listitem"><PCLASS="para">[address]  <BCLASS="emphasis.bold">c</B>[<BCLASS="emphasis.bold">!</B>]<EMCLASS="emphasis">text</EM><CODECLASS="userinput"><B>\.</B></CODE>Replace the specified lines with <EMCLASS="emphasis">text</EM>. Add a <BCLASS="emphasis.bold">!</B> to switch<ACLASS="indexterm"NAME="AUTOID-36514"></A>the <BCLASS="emphasis.bold">autoindent</B> setting during input of <EMCLASS="emphasis">text</EM>.</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">copy</B></DT><DDCLASS="listitem"><PCLASS="para">[address] <BCLASS="emphasis.bold">co</B> destination[address] <BCLASS="emphasis.bold">t</B> destinationCopy the lines included in <EMCLASS="emphasis">address</EM> to the specified<EMCLASS="emphasis">destination</EM> address.<ACLASS="indexterm"NAME="AUTOID-36527"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:1,10 co 50:1,10t50</PRE></BLOCKQUOTE></P><PCLASS="para"></P></DD><DTCLASS="term"><BCLASS="emphasis.bold">delete</B></DT><DDCLASS="listitem"><PCLASS="para">[address] <BCLASS="emphasis.bold">d</B> [buffer]Delete the lines included in <EMCLASS="emphasis">address</EM>.<ACLASS="indexterm"NAME="AUTOID-36539"></A>If <EMCLASS="emphasis">buffer</EM> is specified, save or append the text to the named buffer.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:/Part I/,/Part II/-1d   <EMCLASS="emphasis">Delete to line above &quot;Part II&quot;</EM>:/main/+d   <EMCLASS="emphasis">Delete line below &quot;main&quot;</EM>:.,$/d   <EMCLASS="emphasis">Delete from this line to last line</EM></PRE></BLOCKQUOTE>&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">global</B></DT><DDCLASS="listitem"><PCLASS="para">[address] <BCLASS="emphasis.bold">g</B>[<BCLASS="emphasis.bold">!</B>]<BCLASS="emphasis.bold">/</B><EMCLASS="emphasis">pattern</EM><BCLASS="emphasis.bold">/</B>[<EMCLASS="emphasis">commands</EM>]Execute <EMCLASS="emphasis">commands</EM> on all lines that contain <EMCLASS="emphasis">pattern</EM> or, if<ACLASS="indexterm"NAME="AUTOID-36560"></A><EMCLASS="emphasis">address</EM> is specified, on all lines within that range.If <EMCLASS="emphasis">commands</EM> are not specified, print all such lines.(Exception: doesn't print when you use it from <EMCLASS="emphasis">vi</EM> by typing<CODECLASS="literal">:</CODE> first. You'll need to add a <EMCLASS="emphasis">p</EM>, as in the second example below).If <BCLASS="emphasis.bold">!</B> is used, execute <EMCLASS="emphasis">commands</EM> on all lines that <EMCLASS="emphasis">don't</EM>contain <EMCLASS="emphasis">pattern</EM>.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:g/Unix/:g/Unix/p:g/Name:/s/tom/Tom/</PRE></BLOCKQUOTE></P><PCLASS="para"></P></DD><DTCLASS="term"><BCLASS="emphasis.bold">insert</B></DT><DDCLASS="listitem"><PCLASS="para">[address] <BCLASS="emphasis.bold">i</B>[<BCLASS="emphasis.bold">!</B>]<EMCLASS="emphasis">text</EM><CODECLASS="userinput"><B>\.</B></CODE>Insert <EMCLASS="emphasis">text</EM> at line before the specified <EMCLASS="emphasis">address</EM>, or at present<ACLASS="indexterm"NAME="AUTOID-36585"></A>address if none is specified. Add a <BCLASS="emphasis.bold">!</B> to switch the<BCLASS="emphasis.bold">autoindent</B> setting during input of <EMCLASS="emphasis">text</EM>.&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">move</B></DT><DDCLASS="listitem"><PCLASS="para">[address] <BCLASS="emphasis.bold">m</B> destinationMove the lines specified by <EMCLASS="emphasis">address</EM> to the <EMCLASS="emphasis">destination</EM> address.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:.,/Note/m /END/          <EMCLASS="emphasis">Move block after line containing &quot;END&quot;</EM></PRE></BLOCKQUOTE></P><PCLASS="para"></P></DD><DTCLASS="term"><BCLASS="emphasis.bold">print</B></DT><DDCLASS="listitem"><PCLASS="para">[address] <BCLASS="emphasis.bold">p</B> [count]Print the lines specified by <EMCLASS="emphasis">address</EM>.<ACLASS="indexterm"NAME="AUTOID-36609"></A><EMCLASS="emphasis">count</EM> specifies the number of lines to print, starting with <EMCLASS="emphasis">address</EM>.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:100;+5p                  <EMCLASS="emphasis">Show line 100 and the next five lines</EM></PRE></BLOCKQUOTE></P><PCLASS="para"></P></DD><DTCLASS="term"><BCLASS="emphasis.bold">quit</B></DT><DDCLASS="listitem"><PCLASS="para"><BCLASS="emphasis.bold">q</B>[<BCLASS="emphasis.bold">!</B>]Terminate current editing session. Use <BCLASS="emphasis.bold">!</B> to discard changes made<ACLASS="indexterm"NAME="AUTOID-36625"></A>since the last save. If the editing session includes additional filesin the argument list that were never accessed, quit by typing<BCLASS="emphasis.bold">q!</B> or by typing <BCLASS="emphasis.bold">q</B> twice.&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">read</B></DT><DDCLASS="listitem"><PCLASS="para">[address] <BCLASS="emphasis.bold">r</B> <EMCLASS="emphasis">file</EM>Copy in the text from <EMCLASS="emphasis">file</EM> on the line below the specified<ACLASS="indexterm"NAME="AUTOID-36637"></A><EMCLASS="emphasis">address</EM>. If <EMCLASS="emphasis">file</EM> is not specified, the current filenameis used.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:0r $HOME/data   <EMCLASS="emphasis">Read file in at top of current file</EM></PRE></BLOCKQUOTE></P><PCLASS="para"></P></DD><DTCLASS="term"><BCLASS="emphasis.bold">read</B></DT><DDCLASS="listitem"><PCLASS="para">[address] <BCLASS="emphasis.bold">r</B>  <BCLASS="emphasis.bold">!</B><EMCLASS="emphasis">command</EM>Read the output of UNIX <EMCLASS="emphasis">command</EM> into the text after the linespecified by <EMCLASS="emphasis">address</EM>.</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch48_06.htm"TITLE="48.6 Get Calendar for Any Month or Year: cal ">cal</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">:$r !cal   <EMCLASS="emphasis">Place a calendar at end of file</EM></PRE></TD></TR></TABLE>&#13;</P></DD><DTCLASS="term"><BCLASS="emphasis.bold">source</B></DT><DDCLASS="listitem"><PCLASS="para"><BCLASS="emphasis.bold">so</B> fileRead and execute <EMCLASS="emphasis">ex</EM> commands from <EMCLASS="emphasis">file</EM>.<ACLASS="indexterm"NAME="AUTOID-36667"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:so $HOME/.exrc</PRE></BLOCKQUOTE></P></DD><DTCLASS="term"><BCLASS="emphasis.bold">substitute</B></DT><DDCLASS="listitem"><PCLASS="para">[address] <BCLASS="emphasis.bold">s</B> [<BCLASS="emphasis.bold">/</B><EMCLASS="emphasis">pattern</EM><BCLASS="emphasis.bold">/</B><EMCLASS="emphasis">replacement</EM><BCLASS="emphasis.bold">/</B>] [<EMCLASS="emphasis">options</EM>] [<EMCLASS="emphasis">count</EM>]Replace first instance of <EMCLASS="emphasis">pattern</EM> on each of the specified lines with<ACLASS="indexterm"NAME="AUTOID-36685"></A><EMCLASS="emphasis">replacement</EM>.If <EMCLASS="emphasis">pattern</EM> and <EMCLASS="emphasis">replacement</EM> are omitted, repeat last substitution.<EMCLASS="emphasis">count</EM> specifies the number of lines on which to substitute, startingwith <EMCLASS="emphasis">address</EM>.<EMCLASS="emphasis">Options</EM></P></DD><DTCLASS="term">&nbsp;&nbsp;&nbsp;<BCLASS="emphasis.bold">c</B></DT><DDCLASS="listitem"><PCLASS="para">Prompt for confirmation before each change.</P></DD><DTCLASS="term">&nbsp;&nbsp;&nbsp;<BCLASS="emphasis.bold">g</B></DT><DDCLASS="listitem"><PCLASS="para">Substitute all instances of <EMCLASS="emphasis">pattern</EM> on each line.</P></DD><DTCLASS="term">&nbsp;&nbsp;&nbsp;<BCLASS="emphasis.bold">p</B></DT><DDCLASS="listitem"><PCLASS="para">Print the last line on which a substitution was made.</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch30_10.htm"TITLE="30.10 Confirming Substitutions in ex and vi">c</A> <ACLASS="co"HREF="ch30_15.htm"TITLE="30.15 Useful Global Commands (with Pattern Matches) ">\U</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">:1,10s/yes/no/g      <EMCLASS="emphasis">Substitute on first 10 lines</EM>:%s/[Hh]ello/Hi/gc   <EMCLASS="emphasis">Confirm global substitutions</EM>:s/Fortran/\U&amp;/ 3    <EMCLASS="emphasis">Uppercase &quot;Fortran&quot; on next 3 lines</EM></PRE></TD></TR></TABLE></P></DD><DTCLASS="term"><BCLASS="emphasis.bold">write</B></DT><DDCLASS="listitem"><PCLASS="para">[address] <BCLASS="emphasis.bold">w</B>[<BCLASS="emphasis.bold">!</B>] [[<BCLASS="emphasis.bold">&gt;&gt;</B>] <EMCLASS="emphasis">file</EM>]Write lines specified by <EMCLASS="emphasis">address</EM> to <EMCLASS="emphasis">file</EM>,<ACLASS="indexterm"NAME="AUTOID-36727"></A>or write full contents of buffer if <EMCLASS="emphasis">address</EM> is not specified.If <EMCLASS="emphasis">file</EM> is also omitted, save the contents of the bufferto the current filename.If <BCLASS="emphasis.bold">&gt;&gt; </B><EMCLASS="emphasis">file</EM> is used, write contents to the end of an existing<EMCLASS="emphasis">file</EM>. The <BCLASS="emphasis.bold">!</B> flag forces the editor to write over any currentcontents of <EMCLASS="emphasis">file</EM>.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:1,10w name_list   <EMCLASS="emphasis">Copy first 10 lines to</EM> name_list:50w &gt;&gt; name_list   <EMCLASS="emphasis">Now append line 50</EM></PRE></BLOCKQUOTE></P></DD><DTCLASS="term"><BCLASS="emphasis.bold">write</B></DT><DDCLASS="listitem"><PCLASS="para">[address] <BCLASS="emphasis.bold">w</B>  <BCLASS="emphasis.bold">!</B><EMCLASS="emphasis">command</EM>Write lines specified by <EMCLASS="emphasis">address</EM>, or write full contents of bufferif <EMCLASS="emphasis">address</EM> is not specified, to the<SPANCLASS="link">standard input (<ACLASS="linkend"HREF="ch13_01.htm#UPT-ART-1023"TITLE="Using Standard Input and Output">13.1</A>)</SPAN>of <EMCLASS="emphasis">command</EM>.</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:1,10w !spell   <EMCLASS="emphasis">Send first 10 lines to the </EM>spell<EMCLASS="emphasis"> command</EM>:w !lpr   <EMCLASS="emphasis">Print entire buffer with </EM>lpr<EMCLASS="emphasis"> command</EM></PRE></BLOCKQUOTE></P></DD></DL><ACLASS="indexterm"NAME="AUTOID-36758"></A><ACLASS="indexterm"NAME="AUTOID-36759"></A><ACLASS="indexterm"NAME="AUTOID-36760"></A><ACLASS="indexterm"NAME="AUTOID-36761"></A><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">TOR</SPAN>, <SPANCLASS="authorinitials">DG</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch33_03.htm"TITLE="33.3 Line Addressing "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 33.3 Line Addressing "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch33_05.htm"TITLE="33.5 Running Editing Scripts Within vi "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 33.5 Running Editing Scripts Within vi "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">33.3 Line Addressing </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">33.5 Running Editing Scripts Within vi </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>