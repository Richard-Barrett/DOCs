<HTML><HEAD><TITLE>[Chapter 34] 34.3 Testing and Using a sed Script: checksed, runsed </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:47:10Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch34_01.htm"TITLE="34. The sed Stream Editor"><LINKREL="prev"HREF="ch34_02.htm"TITLE="34.2 Invoking sed "><LINKREL="next"HREF="ch34_04.htm"TITLE="34.4 sed Addressing Basics "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_02.htm"TITLE="34.2 Invoking sed "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 34.2 Invoking sed "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 34<BR>The sed Stream Editor</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_04.htm"TITLE="34.4 sed Addressing Basics "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 34.4 sed Addressing Basics "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0083">34.3 Testing and Using a sed Script: checksed, runsed </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-38332"></A>All but the simplest <EMCLASS="emphasis">sed</EM> scripts are often invoked from a &quot;shell wrapper,&quot; a<SPANCLASS="link">shell script (<ACLASS="linkend"HREF="ch44_01.htm#UPT-ART-0065"TITLE="Everyone Should Learn Some Shell Programming ">44.1</A>)</SPAN>that invokes <EMCLASS="emphasis">sed</EM> and also contains the editing commands that <EMCLASS="emphasis">sed</EM> executes.A shell wrapper is an easy way to turn what could be a complexcommand line into a single-word command.The fact that <EMCLASS="emphasis">sed</EM> is being used might be transparent tousers of the command.</P><PCLASS="para">Two shell scripts that you should immediately arm yourself withare described here.Both use a shell<SPANCLASS="link"><EMCLASS="emphasis">for</EM> loop (<ACLASS="linkend"HREF="ch44_16.htm"TITLE="Handling Command-Line Arguments with a for Loop ">44.16</A>)</SPAN>to apply thesame edits to any number of files.But the first just shows the changes,so you can make sure that your edits were made correctly.The second writes the edits back into the original file,making them permanent.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-83-SECT-1.1">34.3.1 checksed </A></H3><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="checksed">checksed</A><BR></TH><TDVALIGN="TOP"><ACLASS="indexterm"NAME="AUTOID-38345"></A><ACLASS="indexterm"NAME="AUTOID-38347"></A>The shell script <EMCLASS="emphasis">checksed</EM> automates the processof checking the edits that <EMCLASS="emphasis">sed</EM> makes.It expects to find the script file, <EMCLASS="emphasis">sedscr</EM>, in the current directoryand applies these instructions to the input files named onthe command line.The output is shown by a pager program; the default pager is <EMCLASS="emphasis">more</EM>.</TD></TR></TABLE><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch13_13.htm"TITLE='13.13 The "Filename&quot; - '>-</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">#! /bin/shscript=sedscrfor filedo        echo &quot;********** &lt; = $file    &gt; = sed output **********&quot;        sed -f $script &quot;$file&quot; | diff &quot;$file&quot; -done | ${PAGER-more}</PRE></TD></TR></TABLE></P><PCLASS="para">For example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <CODECLASS="userinput"><B>cat sedscr</B></CODE>s/jerry@ora\.com/jpeek@jpeek.com/g$ <CODECLASS="userinput"><B>checksed home.html new.html</B></CODE>********** &lt; = home.html    &gt; = sed output **********102c102&lt; &lt;a href=&quot;mailto:jerry@ora.com&quot;&gt;Email it&lt;/A&gt; or use this form:--&gt; &lt;a href=&quot;mailto:jpeek@jpeek.com&quot;&gt;Email it&lt;/A&gt; or use this form:124c124&lt; Page created by: &lt;a href=&quot;mailto:jerry@ora.com&quot;&gt;jerry@ora.com&lt;/a&gt;--&gt; Page created by: &lt;a href=&quot;mailto:jpeek@jpeek.com&quot;&gt;jpeek@jpeek.com&lt;/a&gt;********** &lt; = new.html    &gt; = sed output **********22c22&lt; &lt;a href=&quot;mailto:jerry@ora.com&quot;&gt;Send comments&lt;/A&gt; to me!---&gt; &lt;a href=&quot;mailto:jpeek@jpeek.com&quot;&gt;Send comments&lt;/A&gt; to me!</PRE></BLOCKQUOTE></P><PCLASS="para">If you find that your script did not produce the resultsyou expected, perfect the editing script and run <EMCLASS="emphasis">checksed</EM> again.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-83-SECT-1.2">34.3.2 runsed </A></H3><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="runsed">runsed</A><BR></TH><TDVALIGN="TOP"><ACLASS="indexterm"NAME="AUTOID-38368"></A><ACLASS="indexterm"NAME="AUTOID-38370"></A>The shell script <EMCLASS="emphasis">runsed</EM> was developed to make changes to a file permanently.It applies your <EMCLASS="emphasis">sedscr</EM> to an input file,creates a temporary file, then copies that file over the original.<EMCLASS="emphasis">runsed</EM> has several safety checks:</TD></TR></TABLE><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">It won't edit the <EMCLASS="emphasis">sed</EM> script file (if you accidentally include<EMCLASS="emphasis">sedscr</EM> on the command line),</P></LI><LICLASS="listitem"><PCLASS="para">It complains if you try to edit an empty file or something that isn'ta file (like a directory),</P></LI><LICLASS="listitem"><PCLASS="para">If the <EMCLASS="emphasis">sed</EM> script doesn't produce any output, <EMCLASS="emphasis">runsed</EM>aborts instead of emptying your original file.</P></LI></UL><PCLASS="para"><EMCLASS="emphasis">runsed</EM> only modifies a file if your <EMCLASS="emphasis">sedscr</EM> made edits.So, the file's<SPANCLASS="link">timestamp (<ACLASS="linkend"HREF="ch16_05.htm"TITLE="The Three UNIX File Times ">16.5</A>)</SPAN>won't change if the file's contents weren't changed.</P><PCLASS="para">Like <EMCLASS="emphasis">checksed</EM>, <EMCLASS="emphasis">runsed</EM> expects to find a <EMCLASS="emphasis">sed</EM> scriptnamed <EMCLASS="emphasis">sedscr</EM> in the directory where you want to make the edits.(Article<ACLASS="xref"HREF="ch04_03.htm"TITLE="Organizing Nonexecutable Scripts ">4.3</A>describes a way to keep many <EMCLASS="emphasis">sed</EM> scripts.)Supply the name or names of the files to edit on the command line. <SPANCLASS="link">Shell metacharacters (<ACLASS="linkend"HREF="ch15_02.htm"TITLE="Filename Wildcards in a Nutshell ">15.2</A>)</SPAN>can be used to specify a set of files:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <CODECLASS="userinput"><B>runsed *.html</B></CODE>runsed: editing home.html: runsed: done with home.htmlrunsed: editing new.html: runsed: done with new.htmlrunsed: all done</PRE></BLOCKQUOTE></P><PCLASS="para"><EMCLASS="emphasis">runsed</EM> does not protect you from imperfect editing scripts.You should use <EMCLASS="emphasis">checksed</EM> first to verify your changes beforeactually making them permanent with <EMCLASS="emphasis">runsed</EM>. (You could also modify <EMCLASS="emphasis">runsed</EM> to keep backup copies of theoriginal versions.)</P></DIV><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">DD</SPAN>, <SPANCLASS="authorinitials">JP</SPAN>, <SPANCLASS="authorinitials">TOR</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_02.htm"TITLE="34.2 Invoking sed "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 34.2 Invoking sed "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_04.htm"TITLE="34.4 sed Addressing Basics "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 34.4 sed Addressing Basics "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">34.2 Invoking sed </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">34.4 sed Addressing Basics </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>