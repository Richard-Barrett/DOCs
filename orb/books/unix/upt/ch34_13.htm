<HTML><HEAD><TITLE>[Chapter 34] 34.13 Hold Space: The Set-Aside Buffer </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:47:20Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch34_01.htm"TITLE="34. The sed Stream Editor"><LINKREL="prev"HREF="ch34_12.htm"TITLE="34.12 Transformations on Text "><LINKREL="next"HREF="ch34_14.htm"TITLE="34.14 Transforming Part of a Line "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_12.htm"TITLE="34.12 Transformations on Text "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 34.12 Transformations on Text "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 34<BR>The sed Stream Editor</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_14.htm"TITLE="34.14 Transforming Part of a Line "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 34.14 Transforming Part of a Line "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-7981">34.13 Hold Space: The Set-Aside Buffer </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-38733"></A><ACLASS="indexterm"NAME="UPT-ART-7981-IX-SED-EDITOR-HOLD-SPACE"></A>The <EMCLASS="emphasis">pattern space</EM> is a<SPANCLASS="link">buffer (<ACLASS="linkend"HREF="glossary.htm#UPT-ART-1010"TITLE="Glossary">52.9</A>)</SPAN>that contains thecurrent input line.There is also a set-aside buffer calledthe <EMCLASS="emphasis">hold space</EM>.The contents of the pattern spacecan be copied to the hold space, and the contents of the holdspace can be copied to the pattern space.A group of commands allows you to move databetween the hold space and the pattern space.The hold space is used for temporary storage, and that'sit.Individual commands can't address the hold spaceor alter its contents.</P><PCLASS="para">The most frequent use of the hold space is to haveit retain a duplicate of the current input line whileyou change the original in the pattern space.[It's also used as a way to do the &quot;move&quot; and &quot;copy&quot; commands that mosteditors have&nbsp;- but which <EMCLASS="emphasis">sed</EM> can't do directly because it'sdesigned for editing a stream of input text line-by-line. <EMCLASS="emphasis">-GU</EM>&nbsp;]The commands that affect the hold space are:</P><TABLECLASS="informaltable"><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BCLASS="emphasis.bold">Hold</B></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><EMCLASS="emphasis">h</EM> or <EMCLASS="emphasis">H</EM></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Copy or append contents of pattern space to hold space.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BCLASS="emphasis.bold">Get</B></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><EMCLASS="emphasis">g </EM>or<EMCLASS="emphasis"> G</EM></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Copy or append contents of hold space to pattern space.</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BCLASS="emphasis.bold">Exchange</B></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">x</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Swap contents of hold space and pattern space.</TD></TR></TBODY></TABLE><PCLASS="para">Each of these commands can take an address thatspecifies a single line or a range of lines.The hold commands (<EMCLASS="emphasis">h</EM>,<EMCLASS="emphasis">H</EM>&nbsp;) move data into the hold spaceand the get commands (<EMCLASS="emphasis">g</EM>,<EMCLASS="emphasis">G</EM>&nbsp;) move data from the holdspace back into the pattern space.The difference between the lowercase and uppercaseversions of the same command is that the lowercasecommand overwrites the contents of the target buffer,while the uppercase command appends to the existing contents.The hold command replaces the contents of the hold space withthe contents of the pattern space.The get command replacesthe contents of the pattern space with the contents of thehold space.</P><PCLASS="para">The Hold command puts a newline followed by the contents ofthe pattern space after the contents of the hold space.(The newline is appended to the hold space even if the holdspace is empty.)The Get command puts a newline followed by thecontents of the hold space after the contents of thepattern space.</P><PCLASS="para">The exchange command (<EMCLASS="emphasis">x</EM>) swaps the contents of the two buffers.It has no side effects on either buffer.</P><PCLASS="para">Here's an example to illustrate puttinglines into the hold space and retrieving them later.We are going to write a script that reads a particular HTML file andcopies all headings to the end of the file for a summary.The headings we want start with <CODECLASS="literal">&lt;H1&gt;</CODE> or <CODECLASS="literal">&lt;H2&gt;</CODE>.For example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">...&lt;BODY&gt;&lt;H1&gt;Introduction&lt;/H1&gt;The blah blah blah&lt;H1&gt;Background of the Project&lt;/H1&gt;   ...&lt;H2&gt;The First Year&lt;/H2&gt;   ...&lt;H2&gt;The Second Year&lt;/H2&gt;   ...&lt;/BODY&gt;</PRE></BLOCKQUOTE></P><PCLASS="para">The object is to copy those headings into the hold space as <EMCLASS="emphasis">sed</EM>reads them.When <EMCLASS="emphasis">sed</EM> reaches the end of the body (at the <CODECLASS="literal">&lt;/BODY&gt;</CODE> tag),output <CODECLASS="literal">Summary:</CODE>;then output the saved tags, without the heading tags(<CODECLASS="literal">&lt;H1&gt;</CODE> or <CODECLASS="literal">&lt;H2&gt;</CODE>).</P><PCLASS="para">Look at the script:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">/^&lt;H[12]&gt;/H/^&lt;\/BODY&gt;/ {    i\&lt;STRONG&gt;Summary:&lt;/STRONG&gt;    x    G    s/&lt;\/*H[12]&gt;//g}</PRE></BLOCKQUOTE></P><PCLASS="para">Any line matching <CODECLASS="literal">&lt;H1&gt;</CODE> or <CODECLASS="literal">&lt;H2&gt;</CODE> is added to the holdspace.(All those lines are also printed; that's the default in <EMCLASS="emphasis">sed</EM> unlesslines have been deleted.)The last part of the script watches for the <CODECLASS="literal">&lt;/BODY&gt;</CODE> tag.When it's reached, sed inserts the <CODECLASS="literal">Summary:</CODE> heading.Then the script uses <CODECLASS="literal">x</CODE> to exchange the pattern space (which hasthe <CODECLASS="literal">&lt;/BODY&gt;</CODE> tag) with the saved headers from the hold space.Now the pattern space has the saved headers.Next, a <CODECLASS="literal">G</CODE> adds the <CODECLASS="literal">&lt;/BODY&gt;</CODE> tag to the end of the headersin the pattern space.Finally, a substitute command strips the <CODECLASS="literal">&lt;H1&gt;</CODE>, <CODECLASS="literal">&lt;/H1&gt;</CODE>,<CODECLASS="literal">&lt;H2&gt;</CODE>, and <CODECLASS="literal">&lt;/H2&gt;</CODE> tags.At the end of the script, the pattern space is printed by default.</P><PCLASS="para">The sequence of <EMCLASS="emphasis">x</EM> followed by <EMCLASS="emphasis">G</EM> is a way to find a matchingline&nbsp;- in this case, <CODECLASS="literal">&lt;/BODY&gt;</CODE>-and insert the contents of the holdspace before the matched line.In other words, it's like an <EMCLASS="emphasis">i</EM> command that inserts the hold spaceat the current line.</P><PCLASS="para">The script could do more cleanup and formatting.For instance, it could make the saved headings into a list with <CODECLASS="literal">&lt;UL&gt;</CODE>and <CODECLASS="literal">&lt;LI&gt;</CODE>.But this example is mostly about the hold space.</P><PCLASS="para">Here's the result of running the script on the sample file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>sed -f sedscr report.html</B></CODE>   ...&lt;BODY&gt;&lt;H1&gt;Introduction&lt;/H1&gt;The blah blah blah&lt;H1&gt;Background of the Project&lt;/H1&gt;   ...&lt;H2&gt;The First Year&lt;/H2&gt;   ...&lt;H2&gt;The Second Year&lt;/H2&gt;   ...&lt;STRONG&gt;Summary:&lt;/STRONG&gt;IntroductionBackground of the ProjectThe First YearThe Second Year&lt;/BODY&gt;</PRE></BLOCKQUOTE></P><PCLASS="para">For other scripts that use the hold space, see articles<ACLASS="xref"HREF="ch34_17.htm"TITLE="Searching for Patterns Split Across Lines ">34.17</A>and<ACLASS="xref"HREF="ch25_12.htm"TITLE="Double Space, Triple Space ... ">25.12</A>.For a fanciful analogy that makes clear how it works, see article<ACLASS="xref"HREF="ch34_16.htm"TITLE="The Deliberate Scrivener ">34.16</A>.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">DD</SPAN>, <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_12.htm"TITLE="34.12 Transformations on Text "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 34.12 Transformations on Text "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_14.htm"TITLE="34.14 Transforming Part of a Line "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 34.14 Transforming Part of a Line "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">34.12 Transformations on Text </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">34.14 Transforming Part of a Line </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>