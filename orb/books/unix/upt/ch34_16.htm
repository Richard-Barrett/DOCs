<HTML><HEAD><TITLE>[Chapter 34] 34.16 The Deliberate Scrivener </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:47:26Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch34_01.htm"TITLE="34. The sed Stream Editor"><LINKREL="prev"HREF="ch34_15.htm"TITLE="34.15 Making Edits Across Line Boundaries "><LINKREL="next"HREF="ch34_17.htm"TITLE="34.17 Searching for Patterns Split Across Lines "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_15.htm"TITLE="34.15 Making Edits Across Line Boundaries "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 34.15 Making Edits Across Line Boundaries "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 34<BR>The sed Stream Editor</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_17.htm"TITLE="34.17 Searching for Patterns Split Across Lines "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 34.17 Searching for Patterns Split Across Lines "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-7833">34.16 The Deliberate Scrivener </A></H2><PCLASS="para">The operations of <EMCLASS="emphasis">sed</EM>'s most difficult commands&nbsp;- hold (<EMCLASS="emphasis">h</EM>or <EMCLASS="emphasis">H</EM>), get (<EMCLASS="emphasis">g</EM> or <EMCLASS="emphasis">G</EM>), and exchange(<EMCLASS="emphasis">x</EM>)-can be explained, somewhat fancifully, in terms of anextremely deliberate medieval scrivener or amanuensis toiling to makea copy of a manuscript. His work is bound by several spatialrestrictions: the original manuscript is displayed in one room; theset of instructions for copying the manuscript are stored in a middleroom; and the quill, ink, and folio are set up in yet anotherroom. The original manuscript as well as the set of instructions arewritten in stone and cannot be moved about.  The dutiful scrivener,being sounder of body than mind, is able to make a copy by going fromroom to room, working on only one line at a time.  Entering the roomwhere the original manuscript is, he removes from his robes a scrap ofpaper to take down the first line of the manuscript.  Then he moves tothe room containing the list of editing instructions.  He reads eachinstruction to see if it applies to the single line he has scribbleddown.</P><PCLASS="para">Each instruction, written in special notation, consists of two parts:a <EMCLASS="emphasis">pattern</EM> and a <EMCLASS="emphasis">procedure</EM>.  The scrivener reads the firstinstruction and checks the pattern against his line.  If there is nomatch, he doesn't have to worry about the procedure, so he goes to thenext instruction. If he finds a match, then the scrivener follows theaction or actions specified in the procedure.</P><PCLASS="para">He makes the edit on his piece of paper before trying to match thepattern in the next instruction.  Remember, the scrivener has to readthrough a series of instructions, and he reads all of them, not justthe first instruction that matches the pattern.  Because he makes hisedits as he goes, he is always trying to match the latest versionagainst the next pattern; he doesn't remember the original line.</P><PCLASS="para">When he gets to the bottom of the list of instructions, and has madeany edits that were necessary on his piece of paper, he goes into thenext room to copy out the line.  (He doesn't need to be told to printout the line.) After that is done, he returns to the first room andtakes down the next line on a new scrap of paper.  When he goes to thesecond room, once again he reads every instruction from first to lastbefore leaving.</P><PCLASS="para">This is what he normally does, that is, unless he is told otherwise.For instance, before he starts, he can be told <EMCLASS="emphasis">not</EM> to write outevery line (the <EMCLASS="emphasis">-n</EM> option). In this case, he must wait for aninstruction that tells him to print (<EMCLASS="emphasis">p</EM>).  If he does not getthat instruction, he throws away his piece of paper and startsover. By the way, regardless of whether or not he is told to write outthe line, he always gets to the last instruction on the list.</P><PCLASS="para">Let's look at other kinds of instructions the scrivener has tointerpret. First of all, an instruction can have zero, one, or twopatterns specified:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">If no pattern is specified, then the same procedure is followed foreach line.</P></LI><LICLASS="listitem"><PCLASS="para">If there is only one pattern, he will follow the procedure for anyline matching the pattern.</P></LI><LICLASS="listitem"><PCLASS="para">If a pattern is followed by a <CODECLASS="literal">!</CODE>, then the procedure isfollowed for all lines that do <EMCLASS="emphasis">not</EM> match the pattern.</P></LI><LICLASS="listitem"><PCLASS="para">If two patterns are specified, the actions described in the procedureare performed on the first matching line and all succeeding linesuntil a line matches the second pattern.</P></LI></UL><PCLASS="para">The scrivener can work on only one line at a time, so you might wonderhow he handles a range of lines. Each time he goes through theinstructions, he tries to match only the first of two patterns.  Now,after he has found a line that matches the first pattern, each timethrough with a new line he tries to match the second pattern.  Heinterprets the second pattern as <CODECLASS="replaceable"><I>pattern</I></CODE><CODECLASS="literal">!</CODE>,so that the procedure is followed only if there is no match.  When the secondpattern is matched, he starts looking again for the first pattern.</P><PCLASS="para">Each procedure contains one or more commands or <EMCLASS="emphasis">actions</EM>.Remember, if a pattern is specified with a procedure, the pattern mustbe matched before the procedure is executed.  We have already shownmany of the usual commands that are similar to other editing commands.However, there are several highly unusual commands.</P><PCLASS="para">For instance, the <EMCLASS="emphasis">N</EM> command tells the scrivener to go, rightnow, and get another line, adding it to the same piece of paper.  Thescrivener can be instructed to &quot;hold&quot; on to a single piece of scrappaper.  The <EMCLASS="emphasis">h</EM> command tells him to make a copy of the line onanother piece of paper and put it in his pocket.  The <EMCLASS="emphasis">x</EM> commandtells him to exchange the extra piece of paper in his pocket with theone in his hand. The <EMCLASS="emphasis">g</EM> command tells him to throw out the paperin his hand and replace it with the one in his pocket.  The <EMCLASS="emphasis">G</EM>command tells him to append the line he is holding to the paper infront of him.  If he encounters a <EMCLASS="emphasis">d</EM> command, he throws out thescrap of paper and begins again at the top of the list ofinstructions.  A <EMCLASS="emphasis">D</EM> command has effect when he has beeninstructed to append two lines on his piece of paper.  The <EMCLASS="emphasis">D</EM>command tells him to delete the first of those lines.</P><PCLASS="para">If you want the analogy converted back to computers, the first andlast rooms in this medieval manor are standard input and standardoutput. Thus, the original file is never changed. The line on thescrivener's piece of scrap paper is in the <EMCLASS="emphasis">pattern space</EM>; theline on the piece of paper that he holds in his pocket is in the<EMCLASS="emphasis">hold space</EM>. The hold space allows you to retain a duplicate of aline while you change the original in the pattern space.</P><PCLASS="para">Article<ACLASS="xref"HREF="ch34_17.htm"TITLE="Searching for Patterns Split Across Lines ">34.17</A>shows a practical application of the scrivener's work, a <EMCLASS="emphasis">sed</EM>program that searches for a particular phrase that might be splitacross two lines.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">DD</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_15.htm"TITLE="34.15 Making Edits Across Line Boundaries "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 34.15 Making Edits Across Line Boundaries "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_17.htm"TITLE="34.17 Searching for Patterns Split Across Lines "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 34.17 Searching for Patterns Split Across Lines "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">34.15 Making Edits Across Line Boundaries </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">34.17 Searching for Patterns Split Across Lines </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>