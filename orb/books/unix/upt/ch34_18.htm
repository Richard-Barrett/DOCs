<HTML><HEAD><TITLE>[Chapter 34] 34.18 Multiline Delete </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:47:30Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch34_01.htm"TITLE="34. The sed Stream Editor"><LINKREL="prev"HREF="ch34_17.htm"TITLE="34.17 Searching for Patterns Split Across Lines "><LINKREL="next"HREF="ch34_19.htm"TITLE="34.19 Making Edits Everywhere Except... "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_17.htm"TITLE="34.17 Searching for Patterns Split Across Lines "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 34.17 Searching for Patterns Split Across Lines "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 34<BR>The sed Stream Editor</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_19.htm"TITLE="34.19 Making Edits Everywhere Except... "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 34.19 Making Edits Everywhere Except... "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-5760">34.18 Multiline Delete </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-39168"></A>The <EMCLASS="emphasis">sed</EM> delete command, <EMCLASS="emphasis">d</EM>,deletes the contents of the<SPANCLASS="link">pattern space (<ACLASS="linkend"HREF="ch34_13.htm"TITLE="Hold Space: The Set-Aside Buffer ">34.13</A>)</SPAN>and causes a new lineof input to be read, with editing resuming at the top of the script. The Delete command, <EMCLASS="emphasis">D</EM>, works slightly differently: it deletes a portionof the pattern space, up to the first embedded newline. It doesnot cause a new line of input to be read; instead, it returnsto the top of the script, applying these instructions to whatremains in the pattern space.We can see the difference by writinga script that looksfor a series of blank lines and outputs a single blank line.The version below uses the delete command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># reduce multiple blank lines to one; version using d command/^$/{   N   /^\n$/d}</PRE></BLOCKQUOTE></P><PCLASS="para">When a blank line is encountered, the next line is appendedto the pattern space. Then we try to match the embeddednewline. Note that the positional metacharacters, <CODECLASS="literal">^</CODE> and <CODECLASS="literal">$</CODE>,match the beginning and the end of the pattern space,respectively. Here's a test file: </P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">This line is followed by 1 blank line.This line is followed by 2 blank lines.This line is followed by 3 blank lines.This line is followed by 4 blank lines.This is the end.</PRE></BLOCKQUOTE></P><PCLASS="para">Running the script on the test file produces the following result:&#13;</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>sed -f sed.blank test.blank</B></CODE>This line is followed by 1 blank line.This line is followed by 2 blank lines.This line is followed by 3 blank lines.This line is followed by 4 blank lines.This is the end.</PRE></BLOCKQUOTE></P><PCLASS="para">Where there was an even numberof blank lines, all the blank lines were removed. Onlywhen there was an odd number was a single blank line preserved. That is becausethe delete command clears the entire pattern space. Once the firstblank line is encountered, the next line is read in, and both are deleted. If a third blank line isencountered, and the next line is not blank, the delete commandis not applied, and thus a blank line is output.If we use the multiline Delete command, we get a different result,and the one that we wanted:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">/^\n$/D</PRE></BLOCKQUOTE></P><PCLASS="para">The reason the multiline Delete command gets the job done is that whenwe encounter two blank lines, the Delete command removes only thefirst of the two.  The next time through the script, the blank linewill cause another line to be read into the pattern space. If thatline is not blank, then both lines are output, thus ensuring that asingle blank line will be output.  In other words, when there are twoblank lines in the pattern space, only the first is deleted. Whena blank line is followed by text, the pattern space is outputnormally.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">DD</SPAN> <SPANCLASS="bibliomisc">from O'Reilly &amp; Associates' <CITECLASS="citetitle">sed &amp; awk</CITE>, Chapter 6</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_17.htm"TITLE="34.17 Searching for Patterns Split Across Lines "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 34.17 Searching for Patterns Split Across Lines "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_19.htm"TITLE="34.19 Making Edits Everywhere Except... "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 34.19 Making Edits Everywhere Except... "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">34.17 Searching for Patterns Split Across Lines </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">34.19 Making Edits Everywhere Except... </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>