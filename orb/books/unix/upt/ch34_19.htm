<HTML><HEAD><TITLE>[Chapter 34] 34.19 Making Edits Everywhere Except... </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:47:31Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch34_01.htm"TITLE="34. The sed Stream Editor"><LINKREL="prev"HREF="ch34_18.htm"TITLE="34.18 Multiline Delete "><LINKREL="next"HREF="ch34_20.htm"TITLE="34.20 The sed Test Command "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_18.htm"TITLE="34.18 Multiline Delete "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 34.18 Multiline Delete "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 34<BR>The sed Stream Editor</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_20.htm"TITLE="34.20 The sed Test Command "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 34.20 The sed Test Command "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-7778">34.19 Making Edits Everywhere Except... </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-39195"></A>There are two ways in <EMCLASS="emphasis">sed</EM> to avoid specified portions of a documentwhile making the edits everywhere else.You can use the <EMCLASS="emphasis">!</EM> command to specify that the edit appliesonly to lines that <EMCLASS="emphasis">do not</EM> match the pattern. Anotherapproach is to use the<EMCLASS="emphasis">b</EM> (branch) command to skip over portions of the editing script.Let's look at an example. </P><PCLASS="para">As described in article<ACLASS="xref"HREF="ch43_21.htm"TITLE="Preprocessing troff Input with sed ">43.21</A>,we use <EMCLASS="emphasis">sed</EM> to preprocess the input to <EMCLASS="emphasis">troff</EM> so that double dashes (<CODECLASS="literal">--</CODE>)are converted automatically to em-dashes (&nbsp;- ) and straight quotes (<CODECLASS="literal">&quot;&quot;</CODE>) are converted to curly quotes (&quot;&quot;).However, program examples in technical books are usually shownin a constant-width font that clearly shows each character as it appears on the computer screen.When typesetting a document, we don't want <EMCLASS="emphasis">sed</EM> to apply the sameediting rules within these examples as it doesto the rest of the document. For instance,straight quotes should not be replaced by curly quotes.</P><PCLASS="para">Because program examplesare set off by a pair of macros (something like .ESand .EE, for&quot;Example Start&quot; and&quot;Example End&quot;), we can use those as thebasis for exclusion.</P><PCLASS="para">So you can say:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">/^\.ES/,/^\.EE/!{   s/^&quot;/``/       ...   s/\\(em&quot;/\\(em``/g}<ACLASS="indexterm"NAME="AUTOID-39213"></A></PRE></BLOCKQUOTE></P><PCLASS="para">All of the commands enclosed in braces (<CODECLASS="literal">{}</CODE>) willbe subject to the initial pattern address.</P><PCLASS="para">There is another way to accomplish the same thing.The <EMCLASS="emphasis">b</EM> command allows you to transfer control to another line inthe script that is marked with an optional label.Using this feature, you could write the above script like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">/^\.ES/,/^\.EE/bends/^&quot;/``/   ...s/\\(em&quot;/\\(em``/g:end</PRE></BLOCKQUOTE></P><PCLASS="para">A label consists of a colon (<CODECLASS="literal">:</CODE>), followed by up toseven characters.If the label is missing, the <EMCLASS="emphasis">b</EM> command branches to the end of the script.(In the example above, the label <CODECLASS="literal">end</CODE> was included just toshow how to use one, but a label is not really necessaryhere.)</P><PCLASS="para">The <EMCLASS="emphasis">b</EM> command is designed for flow controlwithin the script.It allows you to create subscriptsthat will only be applied to lines matching certainpatterns and will not be applied elsewhere.However, as in this case, it also provides a powerful wayto exempt part of the text from the action of asingle-level script.</P><PCLASS="para">The advantage of <EMCLASS="emphasis">b</EM> over <EMCLASS="emphasis">!</EM>&nbsp; for this applicationis that you can more easily specify multiple conditions to avoid.The <EMCLASS="emphasis">!</EM> command can be applied to asingle command or to the set of commands, enclosed inbraces, that immediately follows.On the otherhand, <EMCLASS="emphasis">b</EM> gives you almost unlimited control overmovement around the script.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">TOR</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_18.htm"TITLE="34.18 Multiline Delete "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 34.18 Multiline Delete "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch34_20.htm"TITLE="34.20 The sed Test Command "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 34.20 The sed Test Command "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">34.18 Multiline Delete </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">34.20 The sed Test Command </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>