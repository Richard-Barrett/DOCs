<HTML><HEAD><TITLE>[Chapter 35] 35.4 recomment: Clean Up Program Comment Blocks </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:48:00Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch35_01.htm"TITLE="35. You Can't Quite Call This Editing"><LINKREL="prev"HREF="ch35_03.htm"TITLE="35.3 Alternatives to fmt "><LINKREL="next"HREF="ch35_05.htm"TITLE="35.5 Remove Mail/News Headers with behead "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch35_03.htm"TITLE="35.3 Alternatives to fmt "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 35.3 Alternatives to fmt "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 35<BR>You Can't Quite Call This Editing</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch35_05.htm"TITLE="35.5 Remove Mail/News Headers with behead "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 35.5 Remove Mail/News Headers with behead "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-4530">35.4 recomment: Clean Up Program Comment Blocks </A></H2><PCLASS="para">Lines in a program's comment block usually start with one or morespecial characters, like:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># <CODECLASS="replaceable"><I>line 1 of the comment</I></CODE># <CODECLASS="replaceable"><I>line 2 of the comment</I></CODE># <CODECLASS="replaceable"><I>line 3 of the comment</I></CODE>    ...</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;It can be a hassle to add more text to one of the comment lines in a blockbecause the line can get too long, which requires you to fold thatline onto the next line, which means you have to work around theleading comment character(s).<ACLASS="indexterm"NAME="AUTOID-40227"></A></P><PCLASS="para">The<SPANCLASS="link"><EMCLASS="emphasis">fmt</EM> (<ACLASS="linkend"HREF="ch35_02.htm"TITLE="Neatening Text with fmt ">35.2</A>)</SPAN>program neatens lines of a text file.But the standard <EMCLASS="emphasis">fmt</EM> won't help you&quot;neaten&quot; blocks of comments in a program:it mixes the comment characters from the starts of lines with the words.(If your <EMCLASS="emphasis">fmt</EM> has the <EMCLASS="emphasis">-p</EM> option, it handles this problem;there's an example below.)The <EMCLASS="emphasis">recomment</EM> script is <EMCLASS="emphasis">fmt</EM> for comment blocks.It's for people who write shell, <EMCLASS="emphasis">awk</EM>, C, or almost anyother kind of program with comment blocks several lines long.</P><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="recomment">recomment</A><BR></TH><TDVALIGN="TOP">&#13;<EMCLASS="emphasis">recomment</EM> reads the lines that you feed its standard input.It looks at the first line and figures out what characters you're usingto comment the line (see the <CODECLASS="literal">$cchars</CODE> variable for a list&nbsp;- typicallySPACEs, TABs, <CODECLASS="literal">#</CODE>, or <CODECLASS="literal">*</CODE>).Then, <EMCLASS="emphasis">recomment</EM> strips those comment charactersoff each line, feeds the remaining block of text to the <EMCLASS="emphasis">fmt</EM>utility, and uses<SPANCLASS="link"><EMCLASS="emphasis">sed</EM> (<ACLASS="linkend"HREF="ch34_24.htm"TITLE="Quick Reference: sed ">34.24</A>)</SPAN>to add the comment characters again.<ACLASS="indexterm"NAME="AUTOID-40249"></A></TD></TR></TABLE><PCLASS="para">I usually use <EMCLASS="emphasis">recomment</EM> from inside <EMCLASS="emphasis">vi</EM>, with<SPANCLASS="link">filter-through (<ACLASS="linkend"HREF="ch30_22.htm"TITLE="Filtering Text Through a UNIX Command ">30.22</A>)</SPAN>commands like:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">!}recomment <ICLASS="lineannotation">reformat to the next blank line</I>5!!recomment <ICLASS="lineannotation">reformat this line and the next 4</I></PRE></BLOCKQUOTE></P><PCLASS="para">Normally, <EMCLASS="emphasis">recomment</EM> lets <EMCLASS="emphasis">fmt</EM> choose the width of the comment block(72 characters, typically).To get another width, you can either:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Give the width on the command line, like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">recomment -50</PRE></BLOCKQUOTE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para">Set an environment variable named <EMCLASS="emphasis">CBLKWID</EM>.Give the maximum width, in characters, for the comment text.For example, in the C shell, use:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>setenv CBLKWID 50</B></CODE></PRE></BLOCKQUOTE></P></LI></UL><PCLASS="para"><EMCLASS="emphasis">recomment</EM> isn't perfect, but it's usually much better than nothing!Here's the part of the script that does the work.The first two commands get the comment character(s) and count theirlength.The next three commands strip the comment characters,clean up the remaining comment text, and add the same comment charactersto the start of all reformatted lines:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch45_29.htm"TITLE="45.29 Testing Characters in a String with expr ">expr</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen"># GET COMMENT CHARACTERS USED ON FIRST LINE; STORE IN $comment:comment=&quot;`sed -n \&quot;1s/^\([$cchars]*\).*/\1/p\&quot; $temp`&quot;# GET NUMBER OF CHARACTERS IN COMMENT CHARACTER STRING:cwidth=`expr &quot;$comment&quot; : '.*'`# RE-FORMAT THE COMMENT BLOCK.  IF $widopt SET, USE IT:colrm 1 $cwidth &lt; $temp |       # STRIP OFF COMMENT LEADER FROM LINESfmt $widopt |                   # RE-FORMAT THE TEXT, ANDsed &quot;s/^/$comment/&quot;             # PUT THE COMMENT CHARACTERS BACK</PRE></TD></TR></TABLE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-40280"></A>If your system doesn't have the<SPANCLASS="link"><EMCLASS="emphasis">colrm</EM> (<ACLASS="linkend"HREF="ch35_15.htm"TITLE="Cutting Columns with colrm ">35.15</A>)</SPAN>utility,change thethird-to-last line to use<SPANCLASS="link"><EMCLASS="emphasis">cut</EM> (<ACLASS="linkend"HREF="ch35_14.htm"TITLE="Cutting Columns or Fields with cut ">35.14</A>)</SPAN>instead:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">cut -c`expr $cwidth + 1`- &lt; $temp |  # STRIP OFF COMMENT LEADER</PRE></BLOCKQUOTE></P><PCLASS="para">That makes a command like <CODECLASS="literal">cut&nbsp;-c4-</CODE> instead of <CODECLASS="literal">colrm&nbsp;1&nbsp;3</CODE>.</P><PCLASS="para">Some versions of <EMCLASS="emphasis">fmt</EM> (like the one on the CD-ROM) havea <EMCLASS="emphasis">-p</EM> option that does the same thing.Unlike the automatic system in <EMCLASS="emphasis">recomment</EM>, you have to tell<EMCLASS="emphasis">fmt&nbsp;-p</EM> what the prefix characters are.For example, here's the start of a C program.The prefix character is <CODECLASS="literal">*</CODE>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>cat prog.c</B></CODE>/* * This file, load.cc, reads an input  * data file.  * Each input line is added to a new node * of type struct Node. */% <CODECLASS="userinput"><B>fmt -p '*' prog.c</B></CODE>/* * This file, load.cc, reads an input data file.  Each input line is * added to a new node of type struct Node. */</PRE></BLOCKQUOTE></P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch35_03.htm"TITLE="35.3 Alternatives to fmt "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 35.3 Alternatives to fmt "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch35_05.htm"TITLE="35.5 Remove Mail/News Headers with behead "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 35.5 Remove Mail/News Headers with behead "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">35.3 Alternatives to fmt </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">35.5 Remove Mail/News Headers with behead </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>