<HTML><HEAD><TITLE>[Chapter 36] 36.4 Confusion with White Space Field Delimiters </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:48:39Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch36_01.htm"TITLE="36. Sorting"><LINKREL="prev"HREF="ch36_03.htm"TITLE="36.3 Changing the Field Delimiter "><LINKREL="next"HREF="ch36_05.htm"TITLE="36.5 Alphabetic and Numeric Sorting "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch36_03.htm"TITLE="36.3 Changing the Field Delimiter "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 36.3 Changing the Field Delimiter "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 36<BR>Sorting</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch36_05.htm"TITLE="36.5 Alphabetic and Numeric Sorting "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 36.5 Alphabetic and Numeric Sorting "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-2924">36.4 Confusion with White Space Field Delimiters </A></H2><PCLASS="para">One would hope that a simple task like sorting would be relativelyunambiguous. Unfortunately, it isn't. The behavior of <EMCLASS="emphasis">sort</EM> canbe very puzzling. I'll try to straighten out some of theconfusion&nbsp;- at the same time, I'll be leaving myself open to abuse bythe real <EMCLASS="emphasis">sort</EM> experts. I hope you appreciate this! Seriously,though: if we find any new wrinkles to the story, we'll add them inthe next edition.</P><PCLASS="para">The trouble with <EMCLASS="emphasis">sort</EM> is figuring out where one field ends andanother begins. It's simplest if you can<SPANCLASS="link">specify an explicit field delimiter (<ACLASS="linkend"HREF="ch36_03.htm"TITLE="Changing the Field Delimiter ">36.3</A>)</SPAN>.This makes it easyto tell where fields end and begin. But by default, <EMCLASS="emphasis">sort</EM> uses whitespace characters (tabs and spaces) to separate fields, and the rulesfor interpreting white space field delimitersare unfortunately complicated. As I see them, they are:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">The first white space character you encounter is a &quot;field delimiter&quot;;it marks the end of the old field and the beginning of the next field.</P></LI><LICLASS="listitem"><PCLASS="para">Any white space character following a field delimiter is <EMCLASS="emphasis">part of</EM>the new field. That is&nbsp;- if you have two or more white spacecharacters in a row, the first one is used as a field delimiter, andisn't sorted. The remainder <EMCLASS="emphasis">are </EM> sorted, as part of the nextfield.</P></LI><LICLASS="listitem"><PCLASS="para">Every field has at least one non-whitespace character, unless you'reat the end of the line. (That is: null fields only occur when you'vereached the end of a line.)</P></LI><LICLASS="listitem"><PCLASS="para">All white space is not equal.Sorting is done according to the<SPANCLASS="link">ASCII (<ACLASS="linkend"HREF="ch51_03.htm"TITLE="ASCII Characters: Listing and Getting Values ">51.3</A>)</SPAN>collating sequence.Therefore, TABs are sorted before spaces.</P></LI></UL><PCLASS="para">Here is a silly but instructive example that demonstrates most of thehard cases. We'll sort the file <EMCLASS="emphasis">sortme</EM>, which is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">apple   Fruit shipment20      beta    beta test sites  5              Something or other</PRE></BLOCKQUOTE></P><PCLASS="para">All is not as it seems-<SPANCLASS="link"><EMCLASS="emphasis">cat -t -v</EM> (<ACLASS="linkend"HREF="ch25_06.htm"TITLE="What's in That White Space? ">25.6</A>, <ACLASS="linkend"HREF="ch25_07.htm"TITLE="Show Non-Printing Characters with cat -v or od -c ">25.7</A>)</SPAN>shows that the file reallylooks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">^Iapple^IFruit shipment20^Ibeta^Ibeta test sites  5^I^ISomething or other</PRE></BLOCKQUOTE></P><PCLASS="para"><CODECLASS="literal">^I</CODE> indicates a tab character. Before showing you what<EMCLASS="emphasis">sort</EM> does with this file, let's break it intofields, being very careful to apply the rules above. In the table, weuse quotes to show exactly where each field begins and ends:</P><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Field</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">0</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">1</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">2</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">3</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">Line</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">1</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;^Iapple&quot;</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;Fruit&quot;</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;shipment&quot;</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">null (no more data)</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">2</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;20&quot;</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;beta&quot;</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;beta&quot;</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;test&quot;</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">3</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;5&quot;</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;^Isomething&quot;</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;or&quot;</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">&quot;other&quot;</TD></TR></TBODY></TABLE><PCLASS="para">OK, now let's try some <EMCLASS="emphasis">sort</EM> commands; I've added annotations on theright, showing what character the &quot;sort&quot; was based on. First, we'llsort on field zero&nbsp;- that is, the first field in each line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&#13;% <CODECLASS="userinput"><B>sort sortme</B></CODE> <ICLASS="lineannotation">sort on field zero</I>        apple   Fruit shipments <ICLASS="lineannotation">field 0, first character: TAB</I> 5              Something or other <ICLASS="lineannotation">field 0, first character: SPACE</I>20      beta    beta test sites <ICLASS="lineannotation">field 0, first character: 2</I></PRE></BLOCKQUOTE></P><PCLASS="para">As I noted earlier, a TAB precedes a space in the collating sequence.Everything is as expected. Now let's try another, this time sortingon field 1 (the second field):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&#13;% <CODECLASS="userinput"><B>sort +1 sortme</B></CODE> <ICLASS="lineannotation">sort on field 1</I> 5              Something or other <ICLASS="lineannotation">field 1, first character: TAB</I>        apple   Fruit shipments <ICLASS="lineannotation">field 1, first character: F</I>20      beta    beta test sites <ICLASS="lineannotation">field 1, first character: b</I></PRE></BLOCKQUOTE></P><PCLASS="para">Again, the initial TAB causes &quot;something or other&quot; to appear first.&quot;Fruit shipments&quot; preceded &quot;beta&quot; because in the ASCII table,uppercase letters precede lowercase letters. Now, let's sort on thenext field:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&#13;% <CODECLASS="userinput"><B>sort +2 sortme</B></CODE> <ICLASS="lineannotation">sort on field 2</I>20      beta    beta test sites <ICLASS="lineannotation">field 2, first character: b</I> 5              Something or other <ICLASS="lineannotation">field 2, first character: o</I>        apple   Fruit shipments <ICLASS="lineannotation">field 2, first character: s</I></PRE></BLOCKQUOTE></P><PCLASS="para">&#13;No surprises here. And finally, sort on field 3 (the &quot;fourth&quot; field):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&#13;% <CODECLASS="userinput"><B>sort +3 sortme</B></CODE> <ICLASS="lineannotation">sort on field 3</I>        apple   Fruit shipments <ICLASS="lineannotation">field 3,  NULL</I> 5              Something or other <ICLASS="lineannotation">field 3, first character: o</I>20      beta    beta test sites <ICLASS="lineannotation">field 3, first character: t</I></PRE></BLOCKQUOTE></P><PCLASS="para">The only surprise here is that the NULL field gets sorted first.That's really no surprise, though: NULL has the ASCII value zero, sowe should expect it to come first.</P><PCLASS="para">OK, this was a silly example. But it was a difficult one; a casualunderstanding of what sort &quot;ought to do&quot; won't explain any of thesecases. Which leads to another point. If someone tells you to sortsome terrible mess of a data file, you could be heading for anightmare. But often, you're not just sorting; you're also<EMCLASS="emphasis">designing</EM> the data file you want to sort. If you get to designthe format for the input data, a little bit of care will save you lotsof headaches. If you have a choice, <EMCLASS="emphasis">never</EM> allow TABs in thefile. And be careful of leading spaces; a word with an extra spacebefore it will be sorted <EMCLASS="emphasis">before</EM> other words. Therefore, use anexplicit delimiter between fields (like a colon), or use the <EMCLASS="emphasis">-b</EM>option (and an explicit sort field), which tells <EMCLASS="emphasis">sort</EM> to ignoreinitial white space.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">ML</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch36_03.htm"TITLE="36.3 Changing the Field Delimiter "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 36.3 Changing the Field Delimiter "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch36_05.htm"TITLE="36.5 Alphabetic and Numeric Sorting "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 36.5 Alphabetic and Numeric Sorting "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">36.3 Changing the Field Delimiter </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">36.5 Alphabetic and Numeric Sorting </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>