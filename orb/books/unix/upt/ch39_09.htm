<HTML><HEAD><TITLE>[Chapter 39] 39.9 Know When to Be "nice&quot; to OTher Users...and WhenNot to</TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:50:20Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch39_01.htm"TITLE="39. Time and Performance"><LINKREL="prev"HREF="ch39_08.htm"TITLE="39.8 A Big Environment Can Slow You Down "><LINKREL="next"HREF="ch39_10.htm"TITLE="39.10 A nice Gotcha "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch39_08.htm"TITLE="39.8 A Big Environment Can Slow You Down "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 39.8 A Big Environment Can Slow You Down "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 39<BR>Time and Performance</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch39_10.htm"TITLE="39.10 A nice Gotcha "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 39.10 A nice Gotcha "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0068">39.9 Know When to Be &quot;nice&quot; to OTher Users...and WhenNot to</A></H2><TABLECLASS="para.programreference"BORDER="1"><TR><THVALIGN="TOP"><ACLASS="programreference"HREF="examples/index.htm"TITLE="nice">nice</A><BR></TH><TDVALIGN="TOP"><ACLASS="indexterm"NAME="AUTOID-44001"></A><ACLASS="indexterm"NAME="AUTOID-44003"></A><ACLASS="indexterm"NAME="AUTOID-44006"></A>The <EMCLASS="emphasis">nice</EM> command modifies the scheduling priority of time-sharingprocesses (for BSD and pre-V.4 releases of System V, all processes).The GNU version is on the CD-ROM (the disc's installsystem will only install <EMCLASS="emphasis">nice</EM> if your system has the appropriatefacilities).</TD></TR></TABLE><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44013"></A><ACLASS="indexterm"NAME="AUTOID-44016"></A><ACLASS="indexterm"NAME="AUTOID-44019"></A><ACLASS="indexterm"NAME="AUTOID-44021"></A>If you're not familiar with UNIX, you will find its definition ofpriority confusing&nbsp;- it's the opposite of what you would expect. A process with ahigh <EMCLASS="emphasis">nice</EM> number runs at low priority, getting relatively little ofthe processor's attention; similarly, jobs with a low <EMCLASS="emphasis">nice</EM> numberrun at high priority. This is why the <EMCLASS="emphasis">nice</EM> number isusually called <EMCLASS="emphasis">niceness</EM>: a job with a lot of niceness is very kindto the other users of your system (i.e., it runs at low priority), whilea job with little niceness will hog the CPU. The term &quot;niceness&quot; isawkward, like the priority system itself. Unfortunately, it's the onlyterm that is both accurate (<EMCLASS="emphasis">nice</EM> numbers are used to computepriorities but are not the priorities themselves) and avoids horrible circumlocutions (&quot;increasing the priority means lowering the priority...&quot;).</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44029"></A>Many supposedly experienced users claim that<EMCLASS="emphasis">nice</EM> has virtually no effect. Don't listen to them. As ageneral rule, reducing the priority of an I/O-bound job (a job that's waitingfor I/O a lot of the time) won't change things very much. The system rewards jobs that spend most oftheir time waiting for I/O by increasing their priority. But reducingthe priority of a CPU-bound process can have a significant effect.Compilations, batch typesetting programs (<EMCLASS="emphasis">troff</EM>, TeX, etc.),applications that do a lot of math, and similar programs are good candidates for <EMCLASS="emphasis">nice</EM>. On a moderately loaded system, I havefound that <EMCLASS="emphasis">nice</EM> typically makes a CPU-intensive job roughly 30percent slower and consequently frees that much time for higherpriority jobs. You can often significantly improve keyboard response by running CPU-intensive jobs at low priority.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44037"></A><ACLASS="indexterm"NAME="AUTOID-44039"></A>Note that System V Release 4 has a much more complex priority system, includingreal-time priorities. Priorities are managed with the <EMCLASS="emphasis">priocntl</EM> command. The older <EMCLASS="emphasis">nice</EM> command is available for compatibility.Other UNIX implementations (including HP and Concurrent) support real-time scheduling. These implementations have their own tools for managing the scheduler.</P><PCLASS="para">The <EMCLASS="emphasis">nice</EM> command sets a job's niceness, which is used to computeits priority. It may be one of the most non-uniform commands in theuniverse. There are four versions, each slightly different from the others.BSD UNIX has one <EMCLASS="emphasis">nice</EM> that is built into the C shell,and another standalone version can be used by other shells.System V also has one <EMCLASS="emphasis">nice</EM> that is built into the C shelland a separate standalone version.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44048"></A>Under BSD UNIX, you must also know about <SPANCLASS="link">the <EMCLASS="emphasis">renice</EM>(8) command (<ACLASS="linkend"HREF="ch39_11.htm"TITLE="Changing a Job's Priority Under BSD UNIX ">39.11</A>)</SPAN>;this lets you change the niceness of a job after it isrunning. Under System V, you can't modify a job's niceness once ithas started, so there is no equivalent.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> Think carefully before you <EMCLASS="emphasis">nice</EM> an interactive job like a texteditor.See article<ACLASS="xref"HREF="ch39_10.htm"TITLE="A nice Gotcha ">39.10</A>.</P></BLOCKQUOTE><PCLASS="para">We'll tackle the different variations of <EMCLASS="emphasis">nice</EM> in order.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-68-SECT-1.0.1">39.9.1 BSD C Shell nice </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44061"></A>Under BSD UNIX, <EMCLASS="emphasis">nice</EM> numbers run from -20 to 20. The -20 designationcorresponds to the highest priority; 20 corresponds to the lowest.By default, UNIX assigns the <EMCLASS="emphasis">nice</EM> number 0 to user-executed jobs.The lowest <EMCLASS="emphasis">nice</EM> numbers (-20 to -17) are unofficially reserved forsystem processes. Assigning a user's job to these <EMCLASS="emphasis">nice</EM> numbers cancause problems. Users can always request a higher <EMCLASS="emphasis">nice</EM> number (i.e., a lower priority) for their jobs.Only the<SPANCLASS="link">superuser (<ACLASS="linkend"HREF="ch01_24.htm"TITLE="The Superuser (Root) ">1.24</A>)</SPAN>can raise ajob's priority.</P><PCLASS="para">To submit a job at a greater niceness, precede it with the modifier<EMCLASS="emphasis">nice</EM>. For example, the command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nice awk -f proc.awk datafile &gt; awk.out</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">runs an <EMCLASS="emphasis">awk</EM> command at low priority. By default, <EMCLASS="emphasis">csh</EM> versionof <EMCLASS="emphasis">nice</EM> willsubmit this job with a <EMCLASS="emphasis">nice</EM> level of 4. To submit a job with anarbitrary <EMCLASS="emphasis">nice</EM> number, use <EMCLASS="emphasis">nice</EM> one of these ways:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nice +</B></CODE><CODECLASS="replaceable"><I>n</I></CODE><CODECLASS="userinput"><B> command</B></CODE>% <CODECLASS="userinput"><B>nice -</B></CODE><CODECLASS="replaceable"><I>n</I></CODE><CODECLASS="userinput"><B> command</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">where <EMCLASS="emphasis">n</EM> is an integer between 0 and 20. The <EMCLASS="emphasis">+n</EM> designationrequests a positive <EMCLASS="emphasis">nice</EM> number (low priority); <EMCLASS="emphasis">-n</EM> request anegative <EMCLASS="emphasis">nice</EM> number. Only a superuser may request a negative<EMCLASS="emphasis">nice</EM> number.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-68-SECT-1.0.2">39.9.2 BSD Standalone nice </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44099"></A>The standalone version of <EMCLASS="emphasis">nice</EM> differs from C shell <EMCLASS="emphasis">nice</EM> in that it is a separate program, not a command built in to the C shell.You can therefore use the standalone version in any situation: within <SPANCLASS="link">makefiles (<ACLASS="linkend"HREF="ch28_13.htm"TITLE="make Isn't Just for Programmers! ">28.13</A>)</SPAN>,when you are running the Bourne shell, etc. The principles are the same. <EMCLASS="emphasis">nice</EM> numbers run from -20 to 20, with the default being zero. Only the syntax has been changed to confuse you. For the standalone version, <CODECLASS="literal">-</CODE><EMCLASS="emphasis">n</EM> requestsa positive <EMCLASS="emphasis">nice</EM> number (lower priority) and <CODECLASS="literal">--</CODE><EMCLASS="emphasis">n</EM>requests a negative <EMCLASS="emphasis">nice</EM> number (higher priority-superuser only). Consider these commands:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <CODECLASS="userinput"><B>nice -6 awk -f proc.awk datafile &gt; awk.out</B></CODE># <CODECLASS="userinput"><B>nice --6 awk -f proc.awk datafile &gt; awk.out</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The first command runs <EMCLASS="emphasis">awk</EM> with a high <EMCLASS="emphasis">nice</EM> number (i.e.,6). The second command, which can be issued only by a superuser, runs<EMCLASS="emphasis">awk</EM> with a low <EMCLASS="emphasis">nice</EM> number (i.e., -6).  If no level isspecified, the default argument is -10.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-68-SECT-1.0.3">39.9.3 System V C Shell nice </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44123"></A><ACLASS="indexterm"NAME="AUTOID-44126"></A>System V takes a slightly different view of <EMCLASS="emphasis">nice</EM>numbers. <EMCLASS="emphasis">nice</EM> levels run from 0 to 39; the default is 20. Thenumbers are different but their meanings are the same: 39 correspondsto the lowest possible priority, and 0 is the highest. A few System Vimplementations support real-time submission via <EMCLASS="emphasis">nice</EM>. Jobssubmitted by root with extremely low <EMCLASS="emphasis">nice</EM> numbers (-20 orbelow) allegedly get all of the CPU's time.  Systems on whichthis works properly are very rare and usually advertise support forreal-time processing. In any case, running jobs this way will destroymultiuser performance. This feature is completely different fromreal-time priorities in System V Release 4.</P><PCLASS="para">With these exceptions, the C shell version of <EMCLASS="emphasis">nice</EM> is the same asits BSD cousin. To submit a job at a low priority, use the command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nice <CODECLASS="replaceable"><I>command</I></CODE></B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">This increases the command's niceness by the default amount (4, the same as BSD UNIX); <EMCLASS="emphasis">command</EM> will run at <EMCLASS="emphasis">nice</EM> level 24. To run a job at an arbitrary priority, use one of thefollowing commands:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nice +</B></CODE><CODECLASS="replaceable"><I>n</I></CODE><CODECLASS="userinput"><B> command</B></CODE>% <CODECLASS="userinput"><B>nice -</B></CODE><CODECLASS="replaceable"><I>n</I></CODE><CODECLASS="userinput"><B> command</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">where <EMCLASS="emphasis">n</EM> is an integer between 0 and 19. The <EMCLASS="emphasis">+n</EM> entryrequests a higher <EMCLASS="emphasis">nice</EM> level (a decreased priority), while <EMCLASS="emphasis">-n</EM>requests a lower <EMCLASS="emphasis">nice</EM> level (a higher priority). Again, this issimilar to BSD UNIX, with one important difference: <EMCLASS="emphasis">n</EM> is nowrelative to the default <EMCLASS="emphasis">nice</EM> level. That is, the command: </P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>nice +6 awk -f proc.awk datafile &gt; awk.out</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">runs <EMCLASS="emphasis">awk</EM> at <EMCLASS="emphasis">nice</EM> level 26.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-68-SECT-1.0.4">39.9.4 System V Standalone nice </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44166"></A>Once again, the standalone version of <EMCLASS="emphasis">nice</EM> is useful if you arewriting makefiles or shell scripts or if you use the Bourne shell asyour interactive shell. It is similar to the C shell version, withthese differences:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">With no arguments, standalone <EMCLASS="emphasis">nice</EM> increases the <EMCLASS="emphasis">nice</EM> number by 10 instead of by 4; this is a significantly greater reduction in the program's priority.</P></LI><LICLASS="listitem"><PCLASS="para">With the argument <EMCLASS="emphasis">-n</EM>, <EMCLASS="emphasis">nice</EM> increases the <EMCLASS="emphasis">nice</EM> number by <EMCLASS="emphasis">n</EM> (reducing priority).</P></LI><LICLASS="listitem"><PCLASS="para">With the argument <EMCLASS="emphasis">-&nbsp;-n</EM>, <EMCLASS="emphasis">nice</EM> decreases the <EMCLASS="emphasis">nice</EM> number by <EMCLASS="emphasis">n</EM> (increasing priority; superuser only).</P></LI></UL><PCLASS="para">Consider these commands:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <CODECLASS="userinput"><B>nice -6 awk -f proc.awk datafile &gt; awk.out</B></CODE># <CODECLASS="userinput"><B>nice --6 awk -f proc.awk datafile &gt; awk.out</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">The first command runs <EMCLASS="emphasis">awk</EM> at a higher <EMCLASS="emphasis">nice</EM> level (i.e., 26, which corresponds to a lower priority). The second command, which can be given only by the superuser, runs<EMCLASS="emphasis">awk</EM> at a lower <EMCLASS="emphasis">nice</EM> level (i.e., 14).</P></DIV><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">ML</SPAN> <SPANCLASS="bibliomisc">from O'Reilly &amp; Associates' <CITECLASS="citetitle">System Performance Tuning</CITE>, Chapter 3</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch39_08.htm"TITLE="39.8 A Big Environment Can Slow You Down "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 39.8 A Big Environment Can Slow You Down "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch39_10.htm"TITLE="39.10 A nice Gotcha "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 39.10 A nice Gotcha "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">39.8 A Big Environment Can Slow You Down </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">39.10 A nice Gotcha </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>