<HTML><HEAD><TITLE>[Chapter 40] 40.4 Choosing the Shell Run (We Hope) by at </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:50:34Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch40_01.htm"TITLE="40. Delayed Execution"><LINKREL="prev"HREF="ch40_03.htm"TITLE="40.3 The at Command "><LINKREL="next"HREF="ch40_05.htm"TITLE="40.5 Avoiding Other at and cron Jobs "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch40_03.htm"TITLE="40.3 The at Command "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 40.3 The at Command "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 40<BR>Delayed Execution</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch40_05.htm"TITLE="40.5 Avoiding Other at and cron Jobs "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 40.5 Avoiding Other at and cron Jobs "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-2314">40.4 Choosing the Shell Run (We Hope) by at </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44556"></A><ACLASS="indexterm"NAME="AUTOID-44559"></A><ACLASS="indexterm"NAME="AUTOID-44562"></A><ACLASS="indexterm"NAME="AUTOID-44565"></A>If you are using BSD UNIX, the <EMCLASS="emphasis">-c</EM> option tells<SPANCLASS="link"><EMCLASS="emphasis">at</EM> (<ACLASS="linkend"HREF="ch40_03.htm"TITLE="The at Command ">40.3</A>)</SPAN>toexecute your script via the C&nbsp;shell; the <EMCLASS="emphasis">-s</EM> option tells <EMCLASS="emphasis">at</EM>to use the Bourne shell.<EMCLASS="emphasis">at</EM> defaults to the shell you log in with.If you're lucky (and many users are), this will work the first time.But I've seen a fair number of users run into sticky problems whenthey first use <EMCLASS="emphasis">at</EM> on a new system.If you're one of those unlucky users, here's some help.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44576"></A><EMCLASS="emphasis">at</EM> jobs are run in an environment that'sdifferent from your normal login sessions.Be careful about using command aliases, shell functions, and variables,and other things that may not be set for you by the system.The easiest way to find out what's happening is by having your jobwrite its environment into some temporary files, then read them afterthe job runs:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch06_08.htm"TITLE="6.8 Shell Variables ">set</A> <ACLASS="co"HREF="ch06_01.htm"TITLE="6.1 What Environment Variables Are Good For ">printenv</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>at 1234</B></CODE>set<CODECLASS="userinput"><B> &gt; $HOME/at.set</B></CODE>printenv<CODECLASS="userinput"><B> &gt; $HOME/at.env</B></CODE><KBDCLASS="keycap">[CTRL-d]</KBD></PRE></TD></TR></TABLE></P><PCLASS="para">(On some systems you'll need <CODECLASS="literal">$LOGDIR</CODE> instead of <CODECLASS="literal">$HOME</CODE>and <EMCLASS="emphasis">env</EM> instead of <EMCLASS="emphasis">printenv</EM>.)</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44594"></A><ACLASS="indexterm"NAME="AUTOID-44597"></A>If you use a shell like <EMCLASS="emphasis">csh</EM> or <EMCLASS="emphasis">bash</EM> that reads a setupfile when every shell (not just a<SPANCLASS="link">login shell (<ACLASS="linkend"HREF="ch02_08.htm"TITLE="Identifying Login Shells ">2.8</A>)</SPAN>)starts, the shell will read your per-shell file (like <EMCLASS="emphasis">.cshrc</EM>or <EMCLASS="emphasis">.bashrc</EM>) when the job starts running.This is good news and bad news.The good news is that you can set shell parameters to be used by your <EMCLASS="emphasis">at</EM>job.If you have interactive commands in your <EMCLASS="emphasis">.cshrc</EM>, though, your <EMCLASS="emphasis">at</EM>job might ignore them or might hang forever, waiting for an answer.For instance, the<SPANCLASS="link"><EMCLASS="emphasis">tty</EM> (<ACLASS="linkend"HREF="ch03_08.htm"TITLE="What tty Am I On? ">3.8</A>)</SPAN>command will print the error <CODECLASS="literal">not a tty</CODE>;if you try to use <EMCLASS="emphasis">tty</EM> to set a shell variable, it can cause &quot;unsetvariable&quot; errors, which can abort your <EMCLASS="emphasis">.cshrc</EM> file... and so on.That's the bad news.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44613"></A>You can use a <SPANCLASS="link"><EMCLASS="emphasis">set prompt</EM> test (<ACLASS="linkend"HREF="ch02_09.htm"TITLE="Speeding Up Your C Shell with set prompt Test ">2.9</A>)</SPAN>in your <EMCLASS="emphasis">.cshrc</EM> file, or test <CODECLASS="literal"> $-</CODE> in <EMCLASS="emphasis">ksh</EM> or<EMCLASS="emphasis">bash</EM>, to make sure that there are no interactive commandsrun by <EMCLASS="emphasis">at</EM>.But unless I need shell features, I usually just use <EMCLASS="emphasis">at s</EM> to run the job under the Bourne shell. (Note that some systems use<EMCLASS="emphasis">ksh</EM> or <EMCLASS="emphasis">bash</EM> as their &quot;Bourne&quot; shell.)</P><PCLASS="para">Our SunOS 4.1.3 system has a problem:It sets the<EMCLASS="emphasis">prompt</EM> variablein the C shell that runs <EMCLASS="emphasis">at</EM> jobs; this makes the shell readmy <EMCLASS="emphasis">.cshrc</EM> file as if I were doing an interactive login!My <EMCLASS="emphasis">at</EM> jobs were all failing with a complaint about an unset<EMCLASS="emphasis">TERM</EM> variable.There's a workaround for this in article<ACLASS="xref"HREF="ch02_10.htm"TITLE="Gotchas in set prompt Test ">2.10</A>.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44634"></A>Here's a way to track down problems like that.Temporarily add the command<CODECLASS="literal">set&nbsp;verbose&nbsp;echo</CODE> to the first line of your <EMCLASS="emphasis">.cshrc</EM> file,or add<SPANCLASS="link"><CODECLASS="literal">set&nbsp;-xv</CODE> (<ACLASS="linkend"HREF="ch46_01.htm#UPT-ART-7160"TITLE="Tips for Debugging Shell Scripts ">46.1</A>)</SPAN>to the first line of your Korn Shell <EMCLASS="emphasis">ENV</EM> file or <EMCLASS="emphasis">bash</EM><EMCLASS="emphasis">.bashrc</EM> file.When the <EMCLASS="emphasis">at</EM> job starts your shell, you'll see verbose messages thatshow commands running and variables being set in the shell startupfile.You'll probably also see your shell execute the commands from the<EMCLASS="emphasis">at</EM> job itself.All of this information will be emailed to you (on versions of <EMCLASS="emphasis">at</EM>I've seen, at least) with a subject like &quot;Output from your at job.&quot;This is a great way to track down tricky <EMCLASS="emphasis">at</EM> problems in your shellsetup files.Another tip for spotting problems: sprinkle commands like thesethrough your shell startup file:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch13_01.htm"TITLE="13.1 Using Standard Input and Output">&gt;&gt;</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">echo &quot;got to <CODECLASS="replaceable"><I>here</I></CODE>&quot; | mail <CODECLASS="replaceable"><I>yourname</I></CODE>echo &quot;got to <CODECLASS="replaceable"><I>here</I></CODE>&quot; &gt;&gt; $HOME/at.log</PRE></TD></TR></TABLE></P><PCLASS="para">After an <EMCLASS="emphasis">at</EM> job runs, that lets you find out how far it got beforeyour shell ran into trouble.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN>, <SPANCLASS="authorinitials">ML</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch40_03.htm"TITLE="40.3 The at Command "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 40.3 The at Command "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch40_05.htm"TITLE="40.5 Avoiding Other at and cron Jobs "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 40.5 Avoiding Other at and cron Jobs "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">40.3 The at Command </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">40.5 Avoiding Other at and cron Jobs </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>