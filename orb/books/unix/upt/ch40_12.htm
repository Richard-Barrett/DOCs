<HTML><HEAD><TITLE>[Chapter 40] 40.12 Periodic Program Execution: The cron Facility </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:50:42Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch40_01.htm"TITLE="40. Delayed Execution"><LINKREL="prev"HREF="ch40_11.htm"TITLE="40.11 Send Yourself Reminder Mail "><LINKREL="next"HREF="ch40_13.htm"TITLE="40.13 Adding crontab Entries "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch40_11.htm"TITLE="40.11 Send Yourself Reminder Mail "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 40.11 Send Yourself Reminder Mail "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 40<BR>Delayed Execution</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch40_13.htm"TITLE="40.13 Adding crontab Entries "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 40.13 Adding crontab Entries "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-5410">40.12 Periodic Program Execution: The cron Facility </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-44979"></A><ACLASS="indexterm"NAME="AUTOID-44982"></A><EMCLASS="emphasis">cron</EM> allows you to schedule programs forperiodic execution. For example, you can use <EMCLASS="emphasis">cron</EM> to call aparticular<SPANCLASS="link">UUCP (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>site every hour, to clean up editor backup files everynight, or to perform any number of other tasks.However, <EMCLASS="emphasis">cron</EM> is not a general facility forscheduling program execution off-hours; use the<SPANCLASS="link"><EMCLASS="emphasis">at</EM> command (<ACLASS="linkend"HREF="ch40_03.htm"TITLE="The at Command ">40.3</A>)</SPAN>.</P><PCLASS="para">With<SPANCLASS="link">redirection (<ACLASS="linkend"HREF="ch13_01.htm#UPT-ART-1023"TITLE="Using Standard Input and Output">13.1</A>)</SPAN>,<EMCLASS="emphasis">cron</EM> can send program output toa log file or to any username via the<SPANCLASS="link">mail system (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> <ACLASS="indexterm"NAME="AUTOID-44997"></A><EMCLASS="emphasis">cron</EM> jobs are run by a system program in an environment that's muchdifferent from your normal login sessions.The <SPANCLASS="link">search path (<ACLASS="linkend"HREF="ch08_07.htm"TITLE="Setting Your Search Path ">8.7</A>)</SPAN>is usually shorter;you may need to use absolute pathnames for programs that aren'tin standard system directories.Be careful about using command aliases, shell functions and variables,and other things that may not be set for you by the system.</P></BLOCKQUOTE><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-5410-SECT-1.1">40.12.1 Execution Scheduling </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-45005"></A><ACLASS="indexterm"NAME="AUTOID-45007"></A><ACLASS="indexterm"NAME="AUTOID-45009"></A><ACLASS="indexterm"NAME="AUTOID-45011"></A><ACLASS="indexterm"NAME="AUTOID-45014"></A><ACLASS="indexterm"NAME="AUTOID-45017"></A>The <EMCLASS="emphasis">cron</EM> system is serviced by the <EMCLASS="emphasis">cron</EM><SPANCLASS="link">daemon (<ACLASS="linkend"HREF="ch01_14.htm"TITLE="The Kernel and Daemons ">1.14</A>)</SPAN>.What to run andwhen to run it are specified to <EMCLASS="emphasis">cron</EM> by <EMCLASS="emphasis">crontab</EM> entries, whichare stored in the system's <EMCLASS="emphasis">cron</EM> schedule. Under BSD, this consistsof the files <EMCLASS="emphasis">/usr/lib/crontab</EM> and <EMCLASS="emphasis">/usr/lib/crontab.local</EM>; eitherfile may be used to store <EMCLASS="emphasis">crontab</EM> entries. Both are ASCII files and may bemodified with any text editor. Since usually only <EMCLASS="emphasis">root</EM> has access tothese files, all <EMCLASS="emphasis">cron</EM> scheduling must go through the systemadministrator. This can be either an advantage or a disadvantage, dependingon the needs and personality of your site.</P><PCLASS="para">Under System V (and many other versions of UNIX),any user may add entries to the<EMCLASS="emphasis">cron</EM> schedule. <EMCLASS="emphasis">crontab</EM> entries are stored in separate files for eachuser.The <EMCLASS="emphasis">crontab</EM> files are not editeddirectly by ordinary users, but are placed there with the <EMCLASS="emphasis">crontab</EM>command (described later in this section).[In my experience, the <EMCLASS="emphasis">cron</EM> jobs are run from your home directory.If you read a file or redirect output to a file with a<SPANCLASS="link">relative pathname (<ACLASS="linkend"HREF="ch14_02.htm"TITLE="Using Relative and Absolute Pathnames ">14.2</A>)</SPAN>,that'll probably be in your home directory.Check your system to be sure. <EMCLASS="emphasis">-JP</EM>&nbsp;]</P><PCLASS="para"><EMCLASS="emphasis">crontab</EM> entries direct <EMCLASS="emphasis">cron</EM> to run commands at regular intervals.Each one-line entry in the <EMCLASS="emphasis">crontab</EM> file has the following format:</P><PCLASS="para"><BLOCKQUOTECLASS="literallayout"><PCLASS="literallayout"><EMCLASS="emphasis">mins hrs day-of-month month weekday username cmd     (BSD)</EM><BR><EMCLASS="emphasis">mins hrs day-of-month month weekday cmd               (System V)</EM></P></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-45048"></A><ACLASS="indexterm"NAME="AUTOID-45051"></A>Spaces separate the fields. However, the final field, <EMCLASS="emphasis">cmd</EM>, can contain spaces within it (i.e., the <EMCLASS="emphasis">cmd</EM> field consists ofeverything after the space following <EMCLASS="emphasis">weekday</EM>); the otherfields must not contain spaces. The <EMCLASS="emphasis">username</EM> field is used in theBSD version only and specifies the username under which to run thecommand. Under System V, commands are run by the user who owns the <EMCLASS="emphasis">crontab</EM> inwhich they appear (and for whom it is named).</P><PCLASS="para">The first five fields specify the times at which <EMCLASS="emphasis">cron</EM> should execute<EMCLASS="emphasis">cmd</EM>. Their meanings are described in<ACLASS="xref"HREF="ch40_12.htm#UPT-ART-5410-TAB-0"TITLE="crontab Entry Time Fields">Table 40.1</A>.<ACLASS="indexterm"NAME="AUTOID-45062"></A><ACLASS="indexterm"NAME="AUTOID-45064"></A><ACLASS="indexterm"NAME="AUTOID-45066"></A><ACLASS="indexterm"NAME="AUTOID-45068"></A><ACLASS="indexterm"NAME="AUTOID-45070"></A></P><TABLECLASS="table"><CAPTIONCLASS="table"><ACLASS="title"NAME="UPT-ART-5410-TAB-0">Table 40.1: crontab Entry Time Fields</A></CAPTION><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Field</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Meaning</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Range</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">mins</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The minutes after the hour.</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">0-59</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">hrs</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The hours of the day.</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">0-23  (0 = midnight)</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">day-of-month</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The day within a month.</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">1-31</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">month</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The month of the year.</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">1-12</TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">weekday</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">The day of the week.</TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">1-7  (1 = Monday) <EMCLASS="emphasis">BSD</EM></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1">0-6  (0=Sunday) <EMCLASS="emphasis">System V</EM></TD></TR></TBODY></TABLE><PCLASS="para">These fields can contain a single number, a pair of numbersseparated by a dash (indicating a range of numbers), a comma-separated listof numbers and ranges, or an asterisk (a wildcard that represents all validvalues for that field).</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-45109"></A>If the first character in an entry is a hash mark (#), <EMCLASS="emphasis">cron</EM> willtreat the entry as a comment and ignore it. This is an easy way totemporarily disable an entry without permanently deleting it.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-45114"></A>Here are some example <EMCLASS="emphasis">crontab</EM> entries (shown in System V format):</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch45_21.htm"TITLE="45.21 n&gt;&amp;m: Swap Standard Output and Standard Error ">2&gt;&amp;1</A> <ACLASS="co"HREF="ch40_14.htm"TITLE="40.14 Including Standard Input Within a cron Entry ">\%</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">0,15,30,45 * * * *  (echo -n '   '; date; echo &quot;&quot;) &gt;/dev/console0,10,20,30,40,50 7-18 * * * /usr/lib/atrun7 0 * * *  find / -name &quot;*.bak&quot; -type f -atime +7 -exec rm {} \;12 4 * * *  /bin/sh /usr/adm/ckdsk &gt;/usr/adm/disk.log 2&gt;&amp;122 2 * * *  /bin/sh /usr/adm/ckpwd 2&gt;&amp;1 | mail root30 3 * * 1 /bin/csh -f /usr/lib/uucp/uu.weekly &gt;/dev/null 2&gt;&amp;112 5 15-21 * * test `date +\%a` = Mon &amp;&amp; /usr/local/etc/mtg-notice#30 2 * * 0,6  /usr/lib/newsbin/news.weekend</PRE></TD></TR></TABLE></P><PCLASS="para">The first entry displays the date on the console terminal every fifteenminutes (on the quarter hour); notice that multiple commands are enclosed inparentheses in order to redirect their output as a group. (Technically, thissays to run the commands together in a<SPANCLASS="link">subshell (<ACLASS="linkend"HREF="ch13_07.htm"TITLE="The () Subshell Operators ">13.7</A>)</SPAN>.)The second entry runs<EMCLASS="emphasis">/usr/lib/atrun</EM> every ten minutes from 7:00 a.m. to 6:00 p.m. daily.The third entry runs a <EMCLASS="emphasis">find</EM> command at seven minutes after midnightto remove all <EMCLASS="emphasis">.bak</EM> filesnot accessed in seven days.[To cut wear and tear and load on your disk, try to<SPANCLASS="link">combine <EMCLASS="emphasis">find</EM> jobs (<ACLASS="linkend"HREF="ch23_22.htm"TITLE="Using find to Clear Out Unneeded Files ">23.22</A>)</SPAN>.Also, as article<ACLASS="xref"HREF="ch40_05.htm"TITLE="Avoiding Other at and cron Jobs ">40.5</A>explains, try not to schedule your jobs at often-chosen times like 1:00a.m., 2:00 a.m., and so on; pick oddball times like 4:12 a.m. <EMCLASS="emphasis">-JP</EM>&nbsp;]</P><PCLASS="para">The fourth and fifth lines run a shell script every day, at 4:12 a.m. and2:22 a.m., respectively. The shell to execute the script is specifiedexplicitly on the command line in both cases; the system default shell,usually the Bourne shell, is used if none is explicitly specified. Bothlines' entries redirect standard output and standard error, sending it to afile in one case and mailing it to <EMCLASS="emphasis">root</EM> in the other.</P><PCLASS="para">The sixth entry executes a C shell script named <EMCLASS="emphasis">uu.weekly</EM>, stored in<EMCLASS="emphasis">/usr/lib/uucp</EM>, at 3:30 a.m. on Monday mornings. Notice that the commandformat&nbsp;- specifically the output redirection&nbsp;- is for the Bourne shell eventhough the script itself will be run under the C shell.The seventh entry runs on the third Monday of every month; there's moreexplanation below.The final entrywould run the command <EMCLASS="emphasis">/usr/lib/newsbin/news.weekend</EM> at 2:30 a.m. onSaturday and Sunday mornings if it were not disabled with a <CODECLASS="literal">#</CODE>.(<CODECLASS="literal">#</CODE> can also be used to add comments to your <EMCLASS="emphasis">crontab</EM>.)</P><PCLASS="para">The fourth through sixth entries illustrate three output-handlingalternatives: redirecting it to a file, piping it through mail, anddiscarding it to<SPANCLASS="link"><EMCLASS="emphasis">/dev/null</EM> (<ACLASS="linkend"HREF="ch13_14.htm"TITLE="What Can You Do with an Empty File? ">13.14</A>)</SPAN>.If no output redirection is performed, theoutput is sent via mail to the user who ran the command.</P><PCLASS="para">The <EMCLASS="emphasis">cmd</EM> field can be any UNIX command or group of commands (properlyseparated with semicolons). The entire <EMCLASS="emphasis">crontab</EM> entry can be arbitrarilylong, but it must be a single physical line in the file.</P><PCLASS="para">One problem with the <EMCLASS="emphasis">crontab</EM> syntax is that it lets you specifyany day of the month, and any day of the week; but it doesn't let youconstruct cases like &quot;the third Monday of every month.&quot;You might think that the <EMCLASS="emphasis">crontab</EM> entry:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">12 5 15-21 * 1 <CODECLASS="replaceable"><I>your-command</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">would do the trick, but it won't; this <EMCLASS="emphasis">crontab</EM> entry runs yourcommand on every Monday, plus the 15th through the 21st of each month.[1]An answer from Greg Ubben is shown in the seventh entry.He uses the<SPANCLASS="link"><EMCLASS="emphasis">test</EM> (<ACLASS="linkend"HREF="ch44_20.htm"TITLE="test: Testing Files and Strings ">44.20</A>)</SPAN>and<SPANCLASS="link"><EMCLASS="emphasis">date</EM> (<ACLASS="linkend"HREF="ch51_10.htm"TITLE="The date Command ">51.10</A>)</SPAN>commands to compare the name of today (like <EMCLASS="emphasis">Tue</EM>)to the day we want the entry to be executed (here, <CODECLASS="literal">Mon</CODE>).This entry will be run between the 15th and 21st of each month, butthe <EMCLASS="emphasis">mtg-notice</EM> command will only run on the Monday during thatperiod.The shell's<SPANCLASS="link"><CODECLASS="literal">&amp;&amp;</CODE> operator (<ACLASS="linkend"HREF="ch44_09.htm"TITLE="Testing Your Success ">44.9</A>)</SPAN>runs the <EMCLASS="emphasis">mtg-notice</EM> command only when the previous test succeeds.Greg actually writes the entry as shown here, testing for failure of the<EMCLASS="emphasis">test</EM> command:</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] This strange behavior seems to be a System V peculiarity that somehowinfected the rest of the world.&quot;True&quot; BSD systems behave the way we explained earlier.However, SunOS 4.X systems have incorporated System V's behavior; and, with the advent of Solaris, there are relatively few true commercialBSD systems left in the world. </P></BLOCKQUOTE><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">12 5 15-21 * * test `date +\%a` != Mon || /usr/local/etc/mtg-notice</PRE></BLOCKQUOTE></P><PCLASS="para">He did it in that &quot;backwards&quot; way so the <EMCLASS="emphasis">cron</EM> job's exit status wouldbe 0 (success) in the case when it doesn't execute <EMCLASS="emphasis">mtg-notice</EM>.You may need that technique, too.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-45173"></A>The <EMCLASS="emphasis">cron</EM> command starts the <EMCLASS="emphasis">cron</EM> program. It has no options.Once started, <EMCLASS="emphasis">cron</EM> never terminates. It is normally startedautomatically by one of the system initialization scripts.<EMCLASS="emphasis">cron</EM> reads the <EMCLASS="emphasis">crontab</EM> file(s) every minute to see whether there have been changes. Therefore, any change to its schedule will takeeffect within one minute.</P></DIV><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">AF</SPAN>, <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch40_11.htm"TITLE="40.11 Send Yourself Reminder Mail "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 40.11 Send Yourself Reminder Mail "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch40_13.htm"TITLE="40.13 Adding crontab Entries "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 40.13 Adding crontab Entries "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">40.11 Send Yourself Reminder Mail </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">40.13 Adding crontab Entries </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>