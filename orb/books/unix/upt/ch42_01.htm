<HTML><HEAD><TITLE>[Chapter 42] Problems with Terminals</TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:52:19Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part07.htm"TITLE="VII. Terminals and Printers "><LINKREL="prev"HREF="ch41_12.htm"TITLE="41.12 Finding Out What Characters Your Terminal's Special Keys Send"><LINKREL="next"HREF="ch42_02.htm"TITLE="42.2 Fixing a Hung Terminal or Job "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch41_12.htm"TITLE="41.12 Finding Out What Characters Your Terminal's Special Keys Send"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 41.12 Finding Out What Characters Your Terminal's Special Keys Send"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 42</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch42_02.htm"TITLE="42.2 Fixing a Hung Terminal or Job "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 42.2 Fixing a Hung Terminal or Job "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="UPT-CHP-42">42. Problems with Terminals</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#UPT-ART-1142"TITLE="42.1 Making Sense Out of the Terminal Mess ">Making Sense Out of the Terminal Mess </A><BR><ACLASS="sect1"HREF="ch42_02.htm"TITLE="42.2 Fixing a Hung Terminal or Job ">Fixing a Hung Terminal or Job </A><BR><ACLASS="sect1"HREF="ch42_03.htm"TITLE="42.3 Why Changing TERM Sometimes Doesn't Work ">Why Changing TERM Sometimes Doesn't Work </A><BR><ACLASS="sect1"HREF="ch42_04.htm"TITLE="42.4 Checklist for Resetting a Messed Up Terminal ">Checklist for Resetting a Messed Up Terminal </A><BR><ACLASS="sect1"HREF="ch42_05.htm"TITLE="42.5 Checklist: Screen Size Messed Up? ">Checklist: Screen Size Messed Up? </A><BR><ACLASS="sect1"HREF="ch42_06.htm"TITLE="42.6 Screen Size Testing Files ">Screen Size Testing Files </A><BR><ACLASS="sect1"HREF="ch42_07.htm"TITLE="42.7 termtest: Send Repeated Characters to Terminal ">termtest: Send Repeated Characters to Terminal </A><BR><ACLASS="sect1"HREF="ch42_08.htm"TITLE="42.8 Errors Erased Too Soon? Try These Workarounds ">Errors Erased Too Soon? Try These Workarounds </A></P><P></P></DIV><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-1142">42.1 Making Sense Out of the Terminal Mess </A></H2><PCLASS="para">When you're sitting in front of a terminal, it's sometimes hard torealize that you're face to face with about twenty-five years ofaccumulated history, with hack piled upon hack to deal withevolutions in hardware.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46486"></A>When you type at a terminal, you are really dealing with fourthings: </P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">The shell, utility, or applicationthat interprets and responds to what you type.</P></LI><LICLASS="listitem"><PCLASS="para">The UNIX kernel, or more specifically, the serial line driver, which may perform some low-level conversions on what you typebefore it's even passed to the program you think you're talking to.</P></LI><LICLASS="listitem"><PCLASS="para">The terminal, which has behavior of its own&nbsp;- and may locally interpretor respond to some of what you type instead of, or as well as,passing it through to the system.</P></LI><LICLASS="listitem"><PCLASS="para">The communication link between the terminal and the system.</P></LI></OL><PCLASS="para">Some of the confusion about UNIX terminal handling comes from thefact that there are mechanisms for dealing with each of theselayers.Let's take the list in the reverse order this time:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46502"></A><ACLASS="indexterm"NAME="AUTOID-46504"></A><ACLASS="indexterm"NAME="AUTOID-46506"></A>Most ASCII terminals, or <EMCLASS="emphasis">tty</EM>s, are connected to the system by a<EMCLASS="emphasis">serial line</EM>-a set of up to 24 wires defined by the RS-232 standard.Aremote terminal may be connected to a modem by a serial line; if thisis the case, the computer too must be connected to a modem, and thetwo modems talk to each other over the telephone.Some serial lineconfiguration happens at the hardware level.For example, not everycable includes every wire called for in the RS-232 standard, and boththe terminal and the system or modem have to agree to such things as whichone will talk over which wire.(Actually, both computer systems andterminals are quite stubborn about this; they have fixed ideas aboutwhich wire to talk on, and which to listen on, and if both want touse the same one, it's up to the system administrator to trick themby crossing the wires.)</P><PCLASS="para">There's more to the communications link than just the wires, though.For example, both the terminal and the system or modem have to be configured to agree on such things as how many data bits make up acharacter (a byte is made up of eight bits, but ASCII characters onlyrequire seven), whether or not to use parity (a simple form of errorchecking), how to &quot;frame&quot; each character with &quot;start&quot; and &quot;stop&quot;bits, and how fast to communicate (the baud rate).</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46512"></A><ACLASS="indexterm"NAME="AUTOID-46514"></A>All of these things are usually configured in advance&nbsp;- if theyweren't, the system and terminal couldn't talk to each other.However, the <SPANCLASS="link"><EMCLASS="emphasis">stty</EM> command (<ACLASS="linkend"HREF="ch41_02.htm"TITLE="stty and All That Stuff ">41.2</A>, <ACLASS="linkend"HREF="ch41_03.htm"TITLE="Find Out Terminal Settings with stty ">41.3</A>)</SPAN>does let you change these parameters on the fly (at least on the system side&nbsp;- your terminal may have a setup key and a built-in setup menu).You'd better know what you're doing, though, or you may render your terminal and computer unable to communicate.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46521"></A><ACLASS="indexterm"NAME="AUTOID-46523"></A><ACLASS="indexterm"NAME="AUTOID-46525"></A><ACLASS="indexterm"NAME="AUTOID-46527"></A>At least when UNIX started out, there were no standards for howterminals worked.A screen size of 24 lines and 80 columns became a(fairly) common denominator, but the special keys on terminal keyboards generate different characters, and each terminal might respondto different<SPANCLASS="link">escape sequences (<ACLASS="linkend"HREF="ch05_08.htm"TITLE="Terminal Escape Sequences ">5.8</A>)</SPAN>for moving the cursor around the screen, highlighting text in inversevideo, underlining, and so on.The <SPANCLASS="link"><EMCLASS="emphasis">termcap</EM> and <EMCLASS="emphasis">terminfo</EM> databases (<ACLASS="linkend"HREF="ch05_02.htm"TITLE="The Idea of a Terminal Database ">5.2</A>)</SPAN>were developed to make sense out of this babel.Once a terminal'scharacteristics are described in the database, a screen-orientedprogram like <EMCLASS="emphasis">vi</EM> can look up the information it needs to clearthe screen, move around, and so on.Programs like<SPANCLASS="link"><EMCLASS="emphasis">tset</EM> (<ACLASS="linkend"HREF="ch05_11.htm"TITLE="Initializing the Terminal with tset ">5.11</A>)</SPAN>and <SPANCLASS="link"><EMCLASS="emphasis">tput</EM> (<ACLASS="linkend"HREF="ch05_12.htm"TITLE="Initializing the Terminal with tput ">5.12</A>, <ACLASS="linkend"HREF="ch41_10.htm"TITLE="Using terminfo Capabilities in Shell Programs ">41.10</A>)</SPAN>were created to read the terminal database and use the information itcontains to issue commands (in the form of escape sequences) to the terminal.If you always use the same kind of terminal, you can configure your terminal by<SPANCLASS="link">issuing the escape sequences directly (<ACLASS="linkend"HREF="ch41_09.htm"TITLE="Commands to Adjust Your Terminal ">41.9</A>)</SPAN>.You don't need to look them up in the terminal database.(That's only important if you want a program or script to work with a varietyof terminals.)</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46541"></A>The serial line driver does various things to the characters it getsfrom the terminal.For example, in normal use, it changes the carriage return(ASCII character \015) generated by the RETURN key on your keyboardinto a linefeed (ASCII character \012).Chris Torek talks aboutsome of these conversions in article<ACLASS="xref"HREF="ch41_02.htm"TITLE="stty and All That Stuff ">41.2</A>.For the most part, unless you are a programmer or a systemadministrator, you don't need to know a whole lot about all of thepossibilities&nbsp;- but you do need to know that they are configurable,and that <SPANCLASS="link"><EMCLASS="emphasis">stty</EM> (<ACLASS="linkend"HREF="ch41_03.htm"TITLE="Find Out Terminal Settings with stty ">41.3</A>)</SPAN>is the program that reports (and<SPANCLASS="link">changes (<ACLASS="linkend"HREF="ch05_09.htm"TITLE="Setting Your Erase, Kill, and Interrupt Characters ">5.9</A>)</SPAN>)the settings.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46548"></A>Not all of the terminal driver settings are obscure.Some of themyou use every day, and must be sure to set in your<SPANCLASS="link"><EMCLASS="emphasis">.login</EM> or <EMCLASS="emphasis">.profile</EM> file (<ACLASS="linkend"HREF="ch02_03.htm"TITLE="What Goes in Shell Setup Files? ">2.3</A>)</SPAN>.For example, how does the system know thatyou want to use CTRL-c to interrupt a program or CTRL-s to stopoutput, or CTRL-z to suspend execution?This happens at a levelbelow even the shell&nbsp;- the shell never even sees these characters,because they are interpreted and acted on by the serial line driver.However, there are times when they <EMCLASS="emphasis">aren't</EM> interpreted.Haveyou ever typed CTRL-z when you're in <EMCLASS="emphasis">vi</EM>'s insert mode?Instead of<EMCLASS="emphasis">vi</EM> being suspended, the character is input.That's because<EMCLASS="emphasis">vi</EM> needs to<SPANCLASS="link">reset the serial driver to a different mode (<ACLASS="linkend"HREF="ch41_02.htm"TITLE="stty and All That Stuff ">41.2</A>)</SPAN>so that it has control over which characters are echoed and which areinterpreted as commands.</P><PCLASS="para">All of this is by way of saying that there's an awful lot ofcomplexity under the skin.</P></LI><LICLASS="listitem"><PCLASS="para">And, of course, as we've talked about at length in the discussionof wildcards and<SPANCLASS="link">quoting (<ACLASS="linkend"HREF="ch08_14.htm"TITLE="Bourne Shell Quoting ">8.14</A>)</SPAN>,the shell may intercept and act on various characters before passingthem on to another program.</P></LI></UL><PCLASS="para">The point of this long excursion is to suggest that when you aretrying to figure out problems with terminals, you owe it toyourself to know about all the levels where the problems can occur.(For example, article<ACLASS="xref"HREF="ch08_20.htm"TITLE="How Many Backslashes?">8.20</A>is about backslash handling.)</P><PCLASS="para">Are the terminal and computer system properly configured?Has the cable come loose?Is theterminal type set correctly so that programs know how to make thatparticular terminal do their bidding?Has an interrupted programsent out unfinished commands that left the terminal in aninconsistent or unusual state?Is it really a terminal problem, oris it just that things aren't working quite the way you expect?</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">TOR</SPAN></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch41_12.htm"TITLE="41.12 Finding Out What Characters Your Terminal's Special Keys Send"><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 41.12 Finding Out What Characters Your Terminal's Special Keys Send"BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch42_02.htm"TITLE="42.2 Fixing a Hung Terminal or Job "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 42.2 Fixing a Hung Terminal or Job "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">41.12 Finding Out What Characters Your Terminal's Special Keys Send</TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">42.2 Fixing a Hung Terminal or Job </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>