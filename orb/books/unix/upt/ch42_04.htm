<HTML><HEAD><TITLE>[Chapter 42] 42.4 Checklist for Resetting a Messed Up Terminal </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:52:26Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch42_01.htm"TITLE="42. Problems with Terminals"><LINKREL="prev"HREF="ch42_03.htm"TITLE="42.3 Why Changing TERM Sometimes Doesn't Work "><LINKREL="next"HREF="ch42_05.htm"TITLE="42.5 Checklist: Screen Size Messed Up? "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch42_03.htm"TITLE="42.3 Why Changing TERM Sometimes Doesn't Work "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 42.3 Why Changing TERM Sometimes Doesn't Work "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 42<BR>Problems with Terminals</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch42_05.htm"TITLE="42.5 Checklist: Screen Size Messed Up? "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 42.5 Checklist: Screen Size Messed Up? "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0059">42.4 Checklist for Resetting a Messed Up Terminal </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46778"></A><ACLASS="indexterm"NAME="AUTOID-46781"></A>Gremlins (like line noise on a modem, a bug in a program, a really long lineof output, non-printable characters in a file you <EMCLASS="emphasis">cat</EM> to yourscreen, etc.) can sneak into your system somewhere and mess up yourterminal screen or window.The screen could have a bunch of flashing junk, the character set couldturn into hieroglyphics, words could start coming out underlined or ininverse video, the line could lock up... well, there are lots of possibilities.</P><PCLASS="para">Here's a rough list of things to try.This might be worth reading through right now.Some things in here need to be ready <EMCLASS="emphasis">before</EM> your terminal locks up.</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46789"></A><ACLASS="indexterm"NAME="AUTOID-46791"></A>If you can get to a shell prompt (<CODECLASS="literal">%</CODE> or <CODECLASS="literal">$</CODE>),the first command you should try is probably:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch22_18.htm"TITLE="22.18 Clear Your Terminal for Security, to Stop Burn-in ">clear</A> <ACLASS="co"HREF="ch41_10.htm"TITLE="41.10 Using terminfo Capabilities in Shell Programs ">tput</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>clear</B></CODE>   <ICLASS="lineannotation">systems with termcap</I>% <CODECLASS="userinput"><B>tput clear</B></CODE>   <ICLASS="lineannotation">systems with terminfo</I></PRE></TD></TR></TABLE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46804"></A>That will try to erase the screen and may also cancel other problems likeinverse video.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46808"></A><ACLASS="indexterm"NAME="AUTOID-46810"></A>If running <EMCLASS="emphasis">clear</EM> doesn't clear up your screen completely and yourterminal has a setupmenu, look for a &quot;clear screen&quot; function and try it.(If you don't know how your terminal's setup mode works, find themanual or find an expert.Write down the steps and keep them close to your terminal.)</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46816"></A><ACLASS="indexterm"NAME="AUTOID-46818"></A>If you have a shell prompt and you're on a system using <EMCLASS="emphasis">terminfo</EM>, trythese commands.Don't use <EMCLASS="emphasis">tput init</EM> unless <EMCLASS="emphasis">tput reset</EM> doesn't fix things:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>tput reset</B></CODE>% <CODECLASS="userinput"><B>tput init</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">If you're using a <EMCLASS="emphasis">termcap</EM> system, there's no command quite likethose two.You can simulate them by making an<SPANCLASS="link">alias (<ACLASS="linkend"HREF="ch10_02.htm"TITLE="Aliases for Common Commands ">10.2</A>)</SPAN>that runs the<SPANCLASS="link"><EMCLASS="emphasis">tset</EM> (<ACLASS="linkend"HREF="ch05_04.htm"TITLE="Setting the TERMCAP Variable with tset ">5.4</A>)</SPAN>command from your login setup files.(Why not do it now, for the next time you get into this mess?)Here's a simple alias:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">alias newterm 'set noglob; eval `tset -srQ \!*`; unset noglob'</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46835"></A>The <EMCLASS="emphasis">tset</EM> command usually sends resetting or initialization commandsto your terminal.</P></LI><LICLASS="listitem"><PCLASS="para">If every character you type shows up on a different line,characters don't appear as you type them,a RETURNdoes nothing or prints a <CODECLASS="literal">^M</CODE> on your screen,the backspace, interrupt, and kill keys don't work, or lines</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">jump down          the screen                     like this</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46844"></A>you've probably got trouble with the settings of your port(UNIX terminal device).One of the following commands can make your terminal usable.It might not be set up the way you're used to, but at least you'll be able to log out and log in again:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>reset</B></CODE>% <CODECLASS="userinput"><B><KBDCLASS="keycap">[CTRL-j]</KBD> reset <KBDCLASS="keycap">[CTRL-j]</KBD></B></CODE>% <CODECLASS="userinput"><B>stty sane</B></CODE>% <CODECLASS="userinput"><B> <KBDCLASS="keycap">[CTRL-j]</KBD> stty sane <KBDCLASS="keycap">[CTRL-j]</KBD></B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46858"></A>(If your terminal has a <KBDCLASS="keycap">[LINEFEED]</KBD> key, you can use it instead of<KBDCLASS="keycap">[CTRL-j]</KBD>.)</P><PCLASS="para">If the system says that those commands don't exist or are an &quot;unknown mode,&quot;you should make yourself an<SPANCLASS="link">alias (<ACLASS="linkend"HREF="ch10_02.htm"TITLE="Aliases for Common Commands ">10.2</A>)</SPAN>,<SPANCLASS="link">shell function (<ACLASS="linkend"HREF="ch10_09.htm"TITLE="Shell Functions ">10.9</A>)</SPAN>,or<SPANCLASS="link">shell script (<ACLASS="linkend"HREF="ch44_02.htm"TITLE="Writing a Simple Shell Program ">44.2</A>)</SPAN>that executes an <EMCLASS="emphasis">stty</EM> command similar to the one below.The exact parameters you use will depend on your normal UNIX setup:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">stty echo -nl -cbreak</PRE></BLOCKQUOTE></P><PCLASS="para">Call it something like <EMCLASS="emphasis">sane</EM>.You may need to execute it by typingLINEFEEDorCTRL-jbefore andafter.</P><PCLASS="para">If that doesn't work perfectly, here's what to do.The next time you log in and your screen works just right,typing <EMCLASS="emphasis">stty&nbsp;everything</EM> or <EMCLASS="emphasis">stty -g</EM> (see below) shouldhelp you decide exactly what parameters to use in your <EMCLASS="emphasis">sane</EM>command.</P></LI><LICLASS="listitem"><PCLASS="para">If the system seems to treat every character youtype as a separate command (and you may not be able to see thecharacters you type):</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>reset</B></CODE>r: Command not found.: No previous regular expression: No current filename: No lines in the buffer<CODECLASS="userinput"><B>q</B></CODE>%</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46882"></A>(It actually doesn't look quite like that, but the first <CODECLASS="userinput"><B>e</B></CODE> startedthe editor named <EMCLASS="emphasis">e</EM>.The <CODECLASS="userinput"><B>s</B></CODE>, <CODECLASS="userinput"><B>e</B></CODE>, and <CODECLASS="userinput"><B>t</B></CODE> are all read as commands by<EMCLASS="emphasis">e</EM>.You have to quit <EMCLASS="emphasis">e</EM> by typing its <CODECLASS="literal">q</CODE> command.Sheesh!)</P><PCLASS="para">You should make a shell function or alias&nbsp;- or, put a<SPANCLASS="link">symbolic link (<ACLASS="linkend"HREF="ch18_04.htm"TITLE="More About Links ">18.4</A>)</SPAN>orshell script in your<SPANCLASS="link"><EMCLASS="emphasis">bin</EM> directory (<ACLASS="linkend"HREF="ch04_02.htm"TITLE="A bin Directory for Your Programs and Scripts ">4.2</A>)</SPAN>-thatlets you run the command fromthe previous step (<EMCLASS="emphasis">reset</EM>, <EMCLASS="emphasis">stty&nbsp;sane</EM>, etc.) by typing a singlecharacter.I picked <CODECLASS="literal">]</CODE> (right square bracket) as the name of mine.To make mine, I made a symlink in my <EMCLASS="emphasis">bin</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>ln -s /usr/ucb/reset ]</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">(Your system's <EMCLASS="emphasis">reset</EM> command may have a different pathname.)Now, to fix a goofed-up terminal, I just type a <CODECLASS="literal">]</CODE> at a shell prompt(it may need aLINEFEEDorCTRL-jbefore and after).</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46909"></A><ACLASS="indexterm"NAME="AUTOID-46912"></A>Best of all, if your system has the command <EMCLASS="emphasis">stty -g</EM>, you can use it tosave your favorite terminal settings in a file.Then, when your terminal is goofed up, read those settings in again fromthe file.Here's how.First, when your terminal is working just the way you want it, type:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>stty -g &gt;$HOME/.stty</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Then make your alias, shell script, or shell function named <EMCLASS="emphasis">sane</EM>,<CODECLASS="replaceable"><I>]</I></CODE>, etc. (previously explained) that runs the command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>stty `cat $HOME/.stty`</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">This should restore your terminal the way it was when you firstran the <EMCLASS="emphasis">stty -g</EM> command.</P><PCLASS="para">If your system doesn't have <EMCLASS="emphasis">stty -g</EM>, you can fake it.Run the command <EMCLASS="emphasis">stty&nbsp;everything</EM>or <EMCLASS="emphasis">stty -a</EM> and look at the settings:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>stty everything</B></CODE>speed 38400 baud, 0 rows, 0 columnsparenb -parodd cs7 -cstopb -hupcl cread -clocal -crtscts-ignbrk brkint ignpar -parmrk -inpck istrip -inlcr -igncr icrnl -iuclcixon -ixany -ixoff imaxbelisig iexten icanon -xcase echo echoe echok -echonl -noflsh -tostopechoctl -echoprt echokeopost -olcuc onlcr -ocrnl -onocr -onlret -ofill -ofdel -tabserase  kill  werase rprnt  flush  lnext   susp   intr   quit  stop   eof^?     ^U     ^W     ^R     ^O     ^V     ^Z/^Y  ^C     ^\   ^S/^Q  ^D</PRE></BLOCKQUOTE></P><PCLASS="para">Then check your <EMCLASS="emphasis">stty</EM> manual page and read about those settings(some of them, like the parity settings, might not be appropriate for allyour login sessions).Put the settings in your <EMCLASS="emphasis">sane</EM> or <CODECLASS="replaceable"><I>]</I></CODE> command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">stty icanon echo erase '^?' kill '^u' ...</PRE></BLOCKQUOTE></P><PCLASS="para">Note that if you use several different terminals, each may have differentsettings.Make yourself several <EMCLASS="emphasis">sane</EM> commands; you might<SPANCLASS="link">select one automatically as you log in (<ACLASS="linkend"HREF="ch02_12.htm"TITLE="Automatic Setups for Different Terminals ">2.12</A>)</SPAN>.</P></LI></UL><PCLASS="para">If worse comes to worst, try the steps from article<ACLASS="xref"HREF="ch42_02.htm"TITLE="Fixing a Hung Terminal or Job ">42.2</A>.Find another place to log in to your account.Run <EMCLASS="emphasis">ps</EM> to find your processes on the hung-up terminal or windowand kill them.Then turn off the terminal or close the window and log in again.(If you didn't have a way to kill the processes before you logged inagain, be sure to kill your old processes right away after you log in.)</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch42_03.htm"TITLE="42.3 Why Changing TERM Sometimes Doesn't Work "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 42.3 Why Changing TERM Sometimes Doesn't Work "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch42_05.htm"TITLE="42.5 Checklist: Screen Size Messed Up? "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 42.5 Checklist: Screen Size Messed Up? "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">42.3 Why Changing TERM Sometimes Doesn't Work </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">42.5 Checklist: Screen Size Messed Up? </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>