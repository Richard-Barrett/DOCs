<HTML><HEAD><TITLE>[Chapter 42] 42.5 Checklist: Screen Size Messed Up? </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:52:29Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch42_01.htm"TITLE="42. Problems with Terminals"><LINKREL="prev"HREF="ch42_04.htm"TITLE="42.4 Checklist for Resetting a Messed Up Terminal "><LINKREL="next"HREF="ch42_06.htm"TITLE="42.6 Screen Size Testing Files "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch42_04.htm"TITLE="42.4 Checklist for Resetting a Messed Up Terminal "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 42.4 Checklist for Resetting a Messed Up Terminal "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 42<BR>Problems with Terminals</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch42_06.htm"TITLE="42.6 Screen Size Testing Files "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 42.6 Screen Size Testing Files "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0092">42.5 Checklist: Screen Size Messed Up? </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46951"></A>The<SPANCLASS="link">termcap and terminfo (<ACLASS="linkend"HREF="ch05_02.htm"TITLE="The Idea of a Terminal Database ">5.2</A>)</SPAN>systems used to be the only place where the size of your terminal screen(number of lines and characters) was set.These days, screen-oriented commands like <EMCLASS="emphasis">vi</EM> and <EMCLASS="emphasis">more</EM>on most UNIXes need to work with window systems.Users can shrink or stretchtheir windows without changing the <EMCLASS="emphasis">termcap</EM> or <EMCLASS="emphasis">terminfo</EM> definition.Depending on the command and version of UNIX you're using, you can runinto window-size problems even if you aren't using a window system.</P><PCLASS="para">Window systems don't cause all the problems though.&quot;Classic&quot; problems, such as files with lines that are longer than theterminal is wide, were around before UNIX did windows.</P><PCLASS="para">Here's a checklist of things to try.Once you figure out what's wrong and how to fix it on your terminal andversion of UNIX, you'll probably be able to fix problems with other programsyou run.</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46964"></A>Displaying or editing a file with lines longer than the screen is widecan cause strange problems if everything isn't set up right.There are two places that may try to split a line into pieces when it thinksthat the line is too long.The problem, of course, is when these don't work together or one of themhas a wrong idea about the line length:</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">Your terminal or window may be set to autowrap lines that would crossthe right edge: The line is broken and the rest is shown beginning at theleft margin on the next line below.</P></LI><LICLASS="listitem"><PCLASS="para">If you use a screen-oriented program like <EMCLASS="emphasis">vi</EM> or <EMCLASS="emphasis">more</EM>, theymay wrap long lines.The <EMCLASS="emphasis">termcap</EM> and <EMCLASS="emphasis">terminfo</EM> definitions tell screen-oriented programswhether to wrap lines.(For more information, see O'Reilly &amp; Associates' <EMCLASS="emphasis">termcap &amp; terminfo</EM>.)</P></LI></UL><PCLASS="para">To find out what your terminal is doing, display a file with long lines like<SPANCLASS="link"><EMCLASS="emphasis">longlines</EM> (<ACLASS="linkend"HREF="ch42_06.htm"TITLE="Screen Size Testing Files ">42.6</A>)</SPAN>.The<SPANCLASS="link"><EMCLASS="emphasis">cat</EM> (<ACLASS="linkend"HREF="ch25_02.htm"TITLE="Four Ways to Skin a cat ">25.2</A>)</SPAN>and<SPANCLASS="link"><EMCLASS="emphasis">head</EM> (<ACLASS="linkend"HREF="ch25_20.htm"TITLE="Printing the Top of a File ">25.20</A>)</SPAN>programs don't use <EMCLASS="emphasis">termcap</EM> or <EMCLASS="emphasis">terminfo</EM>-they spit thefile directly to your screen.So, for example, a single 200-character line from <EMCLASS="emphasis">longlines</EM> should beshown as three lines on an 80-column screen.You shouldn't lose any of the characters at either side.Two lines would look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>head -2 longlines</B></CODE>1  456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678902  45678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-46991"></A><ACLASS="indexterm"NAME="AUTOID-46993"></A>If you see only two &quot;chopped&quot; lines, your terminal isn't wrapping lines.You may want to go into its setup mode and enable line-wrapping.If you do though, be sure that your termcap/terminfo definition liststhe terminal as autowrapping.If your terminal autowraps but the <EMCLASS="emphasis">termcap/terminfo</EM> definition doesn'tsay that, screen-oriented applications may try to wrap lines for you.Exactly what happens depends on the application you're using and yourterminal.One common problem is that the screen may look double-spaced&nbsp;- each part of asingle long line that's &quot;wrapped&quot; has a blank line after it.For instance, the <EMCLASS="emphasis">longlines</EM> file might look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">1  456789012345678901234567890123456789012345678901234567890123456789012312345678901234567890123456789012345678901234567890123456789012345678901231234567890123456789012345678901234567890   ...</PRE></BLOCKQUOTE></P><PCLASS="para">In that case, both the terminal and the application are probably tryingto wrap the lines for you.Usually, then, the application won't know exactly how many lines yourterminal is displaying and will send twice as many lines as your screencan show.What a mess!Try to use another value of the<SPANCLASS="link"><EMCLASS="emphasis">TERM</EM> (<ACLASS="linkend"HREF="ch05_10.htm"TITLE="Finding What Terminal Names You Can Use ">5.10</A>)</SPAN>environment variable that defines your terminal as autowrapping.These can have names that end with <EMCLASS="emphasis">am</EM> or <EMCLASS="emphasis">aw</EM>, like <EMCLASS="emphasis">vt100aw</EM>.Or, if you want to dig in, it's not too hard to adapt your own<EMCLASS="emphasis">termcap</EM> or <EMCLASS="emphasis">terminfo</EM> definition from the standard system file.For more information, see article<ACLASS="xref"HREF="ch41_11.htm"TITLE="How termcap and terminfo Describe Terminals ">41.11</A>or O'Reilly &amp; Associates' <EMCLASS="emphasis">termcap &amp; terminfo</EM>.</P></LI><LICLASS="listitem"><PCLASS="para">Your screen can be mixed up when a full-screen application-a pager like<EMCLASS="emphasis">pg</EM>, for example&nbsp;- is displaying the standard output of some program.The program writes some messages to its standard error.These extra lines aren't counted by the application, but they show onyour screen.<ACLASS="indexterm"NAME="AUTOID-47012"></A><ACLASS="indexterm"NAME="AUTOID-47014"></A>If the application has a redraw screen command like CTRL-lyou may be able to get a fresh copy of the lines fromstandard output.Or, you can<SPANCLASS="link">pipe both <EMCLASS="emphasis">stdout</EM> and <EMCLASS="emphasis">stderr</EM> to the pager (<ACLASS="linkend"HREF="ch13_04.htm"TITLE="Problems Piping to a Pager ">13.4</A>)</SPAN>.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-47021"></A><ACLASS="indexterm"NAME="AUTOID-47025"></A><ACLASS="indexterm"NAME="AUTOID-47027"></A>Some applications let you set their screen size in a configuration fileor environment variable.For example, Berkeley<SPANCLASS="link"><EMCLASS="emphasis">mail</EM> (<EMCLASS="emphasis">mailx</EM> (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>on System V) has a <EMCLASS="emphasis">screen</EM>variable that might be set in its<EMCLASS="emphasis">.mailrc</EM>file or in a system file like <EMCLASS="emphasis">/usr/lib/Mail.rc</EM>.The <EMCLASS="emphasis">vi</EM> editor has a <EMCLASS="emphasis">window</EM> variable that might be set in your<SPANCLASS="link"><EMCLASS="emphasis">.exrc</EM> (<ACLASS="linkend"HREF="ch04_09.htm"TITLE="Setting Up vi with the .exrc File ">4.9</A>)</SPAN>file.</P><PCLASS="para">Unless you set those variables correctly for all the terminals you use,you'll usually be better off to let the application set its own window size.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-47043"></A>Your version of UNIX may keep the screen size as part of the devicesettings.To find out, type the command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>stty size</B></CODE>24 80</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-47049"></A>(If that doesn't work, try <EMCLASS="emphasis">stty&nbsp;-a</EM>; look for <CODECLASS="literal">rows</CODE>&nbsp;<CODECLASS="literal">=</CODE>and <CODECLASS="literal">columns</CODE>&nbsp;<CODECLASS="literal">=</CODE> in the output.)The command shows that UNIXthinks your screen has 24 lines and 80 columns.Or, the screen size may be stored in environment variables called <EMCLASS="emphasis">COLUMNS</EM>and <EMCLASS="emphasis">LINES</EM>:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch06_01.htm"TITLE="6.1 What Environment Variables Are Good For ">env</A> <ACLASS="co"HREF="ch27_05.htm"TITLE="27.5 Extended Searching for Text with egrep ">egrep</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>env</B></CODE><CODECLASS="userinput"><B> | </B></CODE><CODECLASS="userinput"><B>egrep</B></CODE><CODECLASS="userinput"><B> '(COLUMNS|LINES)='</B></CODE>COLUMNS=80LINES=24</PRE></TD></TR></TABLE></P><PCLASS="para">If the current settings don't match your<SPANCLASS="link">screen size (<ACLASS="linkend"HREF="ch42_06.htm"TITLE="Screen Size Testing Files ">42.6</A>)</SPAN>you can change the screen size settings.See the suggestions below.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-47071"></A><ACLASS="indexterm"NAME="AUTOID-47074"></A>If UNIX doesn't know your screen size and your system has the <EMCLASS="emphasis">stty size</EM>command, you can use <EMCLASS="emphasis">stty</EM> to change the settings.For example, if your window has 43 rows and 80 columns, type:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>stty rows 43 columns 80</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">If applications are using the <EMCLASS="emphasis">COLUMNS</EM> and <EMCLASS="emphasis">LINES</EM> environmentvariables, just<SPANCLASS="link">reset them (<ACLASS="linkend"HREF="ch06_01.htm#UPT-ART-1170"TITLE="What Environment Variables Are Good For ">6.1</A>)</SPAN>.</P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> Any jobs that are stopped or in the background when you change the screen sizemay not work anymore because they'll still have the old window size.If that's a problem, quit and restart the applications or send them a<EMCLASS="emphasis">SIGWINCH</EM> signal (below).</P></BLOCKQUOTE><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-47093"></A>If you're running <EMCLASS="emphasis">xterm</EM> in the<SPANCLASS="link">X Window System (<ACLASS="linkend"HREF="ch01_31.htm"TITLE="The X Window System ">1.31</A>)</SPAN>,use <EMCLASS="emphasis">resize</EM>.It asks your <EMCLASS="emphasis">xterm</EM> to report (silently) on how big the window is now,then it resets the <EMCLASS="emphasis">stty</EM> parameters or environment variables,depending on which your system needs.When it sets environment variables, <EMCLASS="emphasis">resize</EM> needs to give commandsto the shell.In the C shell, type:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch08_10.htm"TITLE="8.10 eval: When You Need Another Chance ">eval</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>set noglob; </B></CODE><CODECLASS="userinput"><B>eval</B></CODE><CODECLASS="userinput"><B> `resize`</B></CODE></PRE></TD></TR></TABLE></P><PCLASS="para">(You don't need to use<SPANCLASS="link"><CODECLASS="literal">unset noglob</CODE> (<ACLASS="linkend"HREF="ch06_09.htm"TITLE="Special C Shell Variables ">6.9</A>)</SPAN>because <EMCLASS="emphasis">resize</EM> outputs that command.)In the Bourne shell, </P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <CODECLASS="userinput"><B>eval `resize`</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">Both of these are easier to use if you define an<SPANCLASS="link">alias (<ACLASS="linkend"HREF="ch10_02.htm"TITLE="Aliases for Common Commands ">10.2</A>)</SPAN>or a<SPANCLASS="link">shell function (<ACLASS="linkend"HREF="ch10_09.htm"TITLE="Shell Functions ">10.9</A>)</SPAN>named something like <EMCLASS="emphasis">rs</EM>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">alias rs 'set noglob; eval `resize`'rs() { eval `/usr/bin/X11/resize`; }</PRE></BLOCKQUOTE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-47123"></A>In UNIXes that store the window size as part of the device settings (notin environment variables), here's another thing you can do.First, use <EMCLASS="emphasis">stty</EM> to set the right sizes (see above).Then send a <EMCLASS="emphasis">SIGWINCH</EM> (window changed) signal to the shell and/or jobthat has a wrong idea of the window size:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>kill -WINCH $$</B></CODE>    <ICLASS="lineannotation">Send signal to the shell</I>% <CODECLASS="userinput"><B>kill -WINCH %1</B></CODE>    <ICLASS="lineannotation">Send signal to job 1</I></PRE></BLOCKQUOTE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para">In some window systems, you can make your window a little taller or shorter.That will reset things.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-47138"></A>You're using the<SPANCLASS="link"><EMCLASS="emphasis">telnet</EM> (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>command to log in to a remote machine.You didn't have trouble with the window size on your localmachine&nbsp;- what's wrong?<EMCLASS="emphasis">telnet</EM> probably didn't pass your correct window size to theremote host.If both the local and remote machines support<SPANCLASS="link"><EMCLASS="emphasis">rlogin</EM> (<ACLASS="linkend"HREF="ch01_33.htm"TITLE="UNIX Networking and Communications ">1.33</A>)</SPAN>,use it instead.Otherwise, use one of the tips above to set the window size on theremote system.</P></LI></UL><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch42_04.htm"TITLE="42.4 Checklist for Resetting a Messed Up Terminal "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 42.4 Checklist for Resetting a Messed Up Terminal "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch42_06.htm"TITLE="42.6 Screen Size Testing Files "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 42.6 Screen Size Testing Files "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">42.4 Checklist for Resetting a Messed Up Terminal </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">42.6 Screen Size Testing Files </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>