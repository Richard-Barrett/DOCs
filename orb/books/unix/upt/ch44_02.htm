<HTML><HEAD><TITLE>[Chapter 44] 44.2 Writing a Simple Shell Program </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:53:26Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch44_01.htm"TITLE="44. Shell Programming for the Uninitiated"><LINKREL="prev"HREF="ch44_01.htm"TITLE="44.1 Everyone Should Learn Some Shell Programming "><LINKREL="next"HREF="ch44_03.htm"TITLE="44.3 What's a Shell, Anyway? "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch44_01.htm"TITLE="44.1 Everyone Should Learn Some Shell Programming "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 44.1 Everyone Should Learn Some Shell Programming "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 44<BR>Shell Programming for the Uninitiated</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch44_03.htm"TITLE="44.3 What's a Shell, Anyway? "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 44.3 What's a Shell, Anyway? "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-7050">44.2 Writing a Simple Shell Program </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-50029"></A><ACLASS="indexterm"NAME="AUTOID-50032"></A><ACLASS="indexterm"NAME="AUTOID-50035"></A><ACLASS="indexterm"NAME="AUTOID-50038"></A><ACLASS="indexterm"NAME="AUTOID-50041"></A>A shell script need be no more than a complex command line saved in afile. For example, let's assume that you'd like a compact list ofall the users who are currently logged in on the system.</P><PCLASS="para">A command like this might do the trick:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>who | cut -c1-8 | sort -u | pr -l1 -8 -w78 -t</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">A list of logged-in users should come out in columns, lookingsomething like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">abraham  appleton biscuit  charlie  charlott fizzie   howard   howiehstern   jerry    kosmo    linda    ocshner  peterson root     rosssutton   yuppie</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-50052"></A>We used four UNIX commands joined with pipes:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para"><SPANCLASS="link"><CODECLASS="literal">who</CODE> (<ACLASS="linkend"HREF="ch51_04.htm"TITLE="Who's On? ">51.4</A>)</SPAN>gives a list of all users.</P></LI><LICLASS="listitem"><PCLASS="para"><SPANCLASS="link"><CODECLASS="literal">cut -c1-8</CODE> (<ACLASS="linkend"HREF="ch35_14.htm"TITLE="Cutting Columns or Fields with cut ">35.14</A>)</SPAN>outputs columns 1-8 of the <EMCLASS="emphasis">who</EM> output&nbsp;- theusernames.If your system doesn't have <EMCLASS="emphasis">cut</EM>, use the command<SPANCLASS="link"><CODECLASS="literal">colrm&nbsp;9</CODE> (<ACLASS="linkend"HREF="ch35_15.htm"TITLE="Cutting Columns with colrm ">35.15</A>)</SPAN>.</P></LI><LICLASS="listitem"><PCLASS="para">The<SPANCLASS="link"><CODECLASS="literal">sort -u</CODE> (<ACLASS="linkend"HREF="ch36_06.htm"TITLE="Miscellaneous sort Hints ">36.6</A>)</SPAN>puts names in order and takes out names of userswho are logged on more than once.</P></LI><LICLASS="listitem"><PCLASS="para">The<SPANCLASS="link"><CODECLASS="literal">pr -l1 -8 -w78 -t</CODE> (<ACLASS="linkend"HREF="ch35_17.htm"TITLE="Making Text in Columns with pr ">35.17</A>, <ACLASS="linkend"HREF="ch43_07.htm"TITLE="Quick-and-Dirty Formatting Before Printing ">43.7</A>)</SPAN>takes the list of usernames, one perline, and makes it into 8 columns on 78-character-wide lines.(The <CODECLASS="literal">-l1</CODE> is the lowercase letter <EMCLASS="emphasis">L</EM>followed by the digit <EMCLASS="emphasis">1</EM>.)</P></LI></OL><PCLASS="para">If you wanted to do this frequently, wouldn't it be better if all youhad to do was type something like:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>loggedin</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">to get the same result?  Here's how:</P><OLCLASS="orderedlist"><LICLASS="listitem"><PCLASS="para">Start your favorite text editor (Emacs, <EMCLASS="emphasis">vi</EM>, whatever)on a new file named <EMCLASS="emphasis">loggedin</EM>.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-50091"></A>If your system supports the<SPANCLASS="link">special <CODECLASS="literal">#!</CODE> notation (<ACLASS="linkend"HREF="ch44_04.htm"TITLE="Testing How Your System Executes Files ">44.4</A>)</SPAN>,the first line of the script file should be:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#!/bin/sh</PRE></BLOCKQUOTE></P><PCLASS="para">Otherwise, leave the first line blank.(When the first line of a script is blank, most shells will start aBourne shell to read it.Articles<ACLASS="xref"HREF="ch45_02.htm"TITLE="The Story of  : #  #! ">45.2</A>and<ACLASS="xref"HREF="ch45_06.htm"TITLE="Making Sure Your Script Runs with Bourne Shell, Without #! ">45.6</A>have more information.)</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-50103"></A><ACLASS="indexterm"NAME="AUTOID-50106"></A>I think that the second line of a shell script should always be a commentto explain what the script does.(Use more than one line, if you want.)A comment starts with a hash mark (<CODECLASS="literal">#</CODE>); all characters after iton the line are ignored:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen"># loggedin - list logged-in users, once per user, in 8 columns</PRE></BLOCKQUOTE></P><PCLASS="para">Put this on the third line, just like you did on the command line:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">who | cut -c1-8 | sort -u | pr -l1 -8 -w78 -t</PRE></BLOCKQUOTE></P><PCLASS="para">(As I explained earlier,you might need <EMCLASS="emphasis">colrm</EM> instead of <EMCLASS="emphasis">cut</EM>.)</P></LI><LICLASS="listitem"><PCLASS="para">Save the file and leave the editor. You've just written a shellscript.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-50122"></A><ACLASS="indexterm"NAME="AUTOID-50125"></A><ACLASS="indexterm"NAME="AUTOID-50128"></A>Next, you need to make the shell script executable.The<SPANCLASS="link"><EMCLASS="emphasis">chmod</EM> (<ACLASS="linkend"HREF="ch22_07.htm"TITLE="Using chmod to Change File Permission ">22.7</A>)</SPAN>(change mode) command is used to change permissions on a file.The plus sign followed by an x (<CODECLASS="literal">+x</CODE>) makes the file executable:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>chmod +x loggedin</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-50140"></A><ACLASS="indexterm"NAME="AUTOID-50143"></A><ACLASS="indexterm"NAME="AUTOID-50146"></A><ACLASS="indexterm"NAME="AUTOID-50149"></A>If your account uses the C shell, you'll need to reset its command searchtable.To do that, type:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist"><ACLASS="co"HREF="ch04_02.htm"TITLE="4.2 A bin Directory for Your Programs and Scripts ">rehash</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen">% <CODECLASS="userinput"><B>rehash</B></CODE></PRE></TD></TR></TABLE></P><PCLASS="para"></P></LI><LICLASS="listitem"><PCLASS="para">Finally, try the script.Just type its name and it should run:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>loggedin</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">If that doesn't run, your current directory may not be in your shell'scommand search path.In that case, try this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>./loggedin</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para">If it still doesn't work, and you started the first line of your scriptwith <CODECLASS="literal">#!</CODE>, be sure that the Bourne shell's pathname on that line (like<CODECLASS="literal">/bin/sh</CODE>) is correct.</P></LI><LICLASS="listitem"><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-50171"></A>If you want to run the script from somewhere other than the currentdirectory, or if you want other programs and scripts you write to beable to use it, you need to put it in a directory that's in your <SPANCLASS="link">search path (<ACLASS="linkend"HREF="ch08_07.htm"TITLE="Setting Your Search Path ">8.7</A>)</SPAN>.If you're the only person who plans to use the script, you should put it inyour personal<SPANCLASS="link"><EMCLASS="emphasis">bin</EM> directory (<ACLASS="linkend"HREF="ch04_02.htm"TITLE="A bin Directory for Your Programs and Scripts ">4.2</A>)</SPAN>.Otherwise, you might ask your system administrator if there's asystemwide directory for local commands.</P></LI></OL><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch44_01.htm"TITLE="44.1 Everyone Should Learn Some Shell Programming "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 44.1 Everyone Should Learn Some Shell Programming "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch44_03.htm"TITLE="44.3 What's a Shell, Anyway? "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 44.3 What's a Shell, Anyway? "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">44.1 Everyone Should Learn Some Shell Programming </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">44.3 What's a Shell, Anyway? </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>