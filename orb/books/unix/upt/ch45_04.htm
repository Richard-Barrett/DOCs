<HTML><HEAD><TITLE>[Chapter 45] 45.4 Fun with #! </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:54:22Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch45_01.htm"TITLE="45. Shell Programming for the Initiated"><LINKREL="prev"HREF="ch45_03.htm"TITLE="45.3 Don't Need a Shell for Your Script?  Don't Use One "><LINKREL="next"HREF="ch45_05.htm"TITLE="45.5 A File That Shows Itself... and What #! Does "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch45_03.htm"TITLE="45.3 Don't Need a Shell for Your Script?  Don't Use One "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 45.3 Don't Need a Shell for Your Script?  Don't Use One "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 45<BR>Shell Programming for the Initiated</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch45_05.htm"TITLE="45.5 A File That Shows Itself... and What #! Does "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 45.5 A File That Shows Itself... and What #! Does "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-7880">45.4 Fun with #! </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-52359"></A><ACLASS="indexterm"NAME="AUTOID-52363"></A><ACLASS="indexterm"NAME="AUTOID-52367"></A><ACLASS="indexterm"NAME="AUTOID-52370"></A><ACLASS="indexterm"NAME="AUTOID-52373"></A>[You might think that the &quot;magic&quot; characters <CODECLASS="literal">#!</CODE> are onlyfor shell scripts.<SPANCLASS="link">Not true (<ACLASS="linkend"HREF="ch45_05.htm"TITLE="A File That Shows Itself... and What #! Does ">45.5</A>, <ACLASS="linkend"HREF="ch45_03.htm"TITLE="Don't Need a Shell for Your Script?  Don't Use One ">45.3</A>)</SPAN>!Here are some fun examples.Study them and (if your UNIX system understands <CODECLASS="literal">#!</CODE>) try them; I hopethey'll help you see what <CODECLASS="literal">#!</CODE> really does. -JP]</P><DIVCLASS="msgset"><DIVCLASS="msgentry"><DIVCLASS="msg"><DIVCLASS="msgtext"><PCLASS="para"><BCLASS="msgentry.role">Q:</B> Why begin a shell scriptwith <CODECLASS="literal">#!/bin/sh</CODE> or <CODECLASS="literal">#!/bin/csh</CODE>?</P></DIV></DIV></DIV><DIVCLASS="msgentry"><DIVCLASS="msg"><DIVCLASS="msgtext"><PCLASS="para"><BCLASS="msgentry.role">A:</B> Under some systems&nbsp;- principallythose with Berkeley influence&nbsp;- thismakes the program directly executable. That is, the kernel canstart this program, even though it's not machine code; the kernel willinvoke the named program after fiddling arguments a bit.</P></DIV></DIV></DIV></DIV><PCLASS="para">In fact, the script:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#! /bin/mv</PRE></BLOCKQUOTE></P><PCLASS="para">will rename itself. Place it in a file called <EMCLASS="emphasis">zap</EM>,and type <CODECLASS="literal">zap&nbsp;zup</CODE>, and now you have a shell scriptcalled <EMCLASS="emphasis">zup</EM>. Your shell tried to <EMCLASS="emphasis">exec</EM> theprogram with the argument <CODECLASS="literal">zup</CODE>. This succeeded, but actuallyran <EMCLASS="emphasis">/bin/mv</EM> with the arguments <CODECLASS="literal">zap&nbsp;zup</CODE>.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-52405"></A><ACLASS="indexterm"NAME="AUTOID-52408"></A><ACLASS="indexterm"NAME="AUTOID-52411"></A><ACLASS="indexterm"NAME="AUTOID-52414"></A><ACLASS="indexterm"NAME="AUTOID-52417"></A><ACLASS="indexterm"NAME="AUTOID-52420"></A><ACLASS="indexterm"NAME="AUTOID-52423"></A><ACLASS="indexterm"NAME="AUTOID-52426"></A>You can make self-removing scripts:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#! /bin/rm</PRE></BLOCKQUOTE></P><PCLASS="para">Or self-printing scripts:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#! /bin/awk NR&gt;1{print}text...</PRE></BLOCKQUOTE></P><PCLASS="para">This last one works because the kernel is willing to do more thaninsert the filename in the argument list: it will insertan optional argument.Some systems allow only one such argument(which can then contain blanks),while others allow multiple blank (space or TAB) separated arguments.Note that, in the latter case,there is probably no way to embed blanks(the kernel is unlikely to provide shell-like quoting mechanisms);the safest course is to avoid them entirely.</P><PCLASS="para">Normally, this is used for things like the<EMCLASS="emphasis">-f</EM> option to the C shell (&quot;fast&quot;, don't read <EMCLASS="emphasis">.cshrc</EM>s), but itworks well enough for <EMCLASS="emphasis">awk</EM> too.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-52440"></A><ACLASS="indexterm"NAME="AUTOID-52442"></A><CODECLASS="literal">#!</CODE> is described, though not completely, in the <EMCLASS="emphasis">execve</EM>(2) manual page.Note that there may be a small limit on the number of characters in the<CODECLASS="literal">#!</CODE> line, typically 32.(32 is &quot;magic&quot; because it equals <CODECLASS="literal">sizeof(struct exec)</CODE>.)</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">CT</SPAN> <SPANCLASS="bibliomisc">in <ACLASS="systemitem.newsgroup"HREF="news:net.unix">net.unix</A> on Usenet, 29 December 1984</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch45_03.htm"TITLE="45.3 Don't Need a Shell for Your Script?  Don't Use One "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 45.3 Don't Need a Shell for Your Script?  Don't Use One "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch45_05.htm"TITLE="45.5 A File That Shows Itself... and What #! Does "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 45.5 A File That Shows Itself... and What #! Does "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">45.3 Don't Need a Shell for Your Script?  Don't Use One </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">45.5 A File That Shows Itself... and What #! Does </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>