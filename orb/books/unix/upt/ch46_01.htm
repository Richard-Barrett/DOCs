<HTML><HEAD><TITLE>[Chapter 46] Shell Script Debugging and Gotchas</TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:55:33Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="part08.htm"TITLE="VIII. Shell Programming "><LINKREL="prev"HREF="ch45_36.htm"TITLE="45.36 Shell Lockfile "><LINKREL="next"HREF="ch46_02.htm"TITLE="46.2 Quoting Trouble?  Think, Then Use echo "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch45_36.htm"TITLE="45.36 Shell Lockfile "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 45.36 Shell Lockfile "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 46</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch46_02.htm"TITLE="46.2 Quoting Trouble?  Think, Then Use echo "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 46.2 Quoting Trouble?  Think, Then Use echo "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="UPT-CHP-46">46. Shell Script Debugging and Gotchas</A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#UPT-ART-7160"TITLE="46.1 Tips for Debugging Shell Scripts ">Tips for Debugging Shell Scripts </A><BR><ACLASS="sect1"HREF="ch46_02.htm"TITLE="46.2 Quoting Trouble?  Think, Then Use echo ">Quoting Trouble?  Think, Then Use echo </A><BR><ACLASS="sect1"HREF="ch46_03.htm"TITLE="46.3 Bourne Shell Debugger Shows a Shell Variable ">Bourne Shell Debugger Shows a Shell Variable </A><BR><ACLASS="sect1"HREF="ch46_04.htm"TITLE="46.4 Stop Syntax Errors in Numeric Tests ">Stop Syntax Errors in Numeric Tests </A><BR><ACLASS="sect1"HREF="ch46_05.htm"TITLE="46.5 Stop Syntax Errors in String Tests ">Stop Syntax Errors in String Tests </A><BR><ACLASS="sect1"HREF="ch46_06.htm"TITLE="46.6 Watch Out for Bourne Shell -e Bug ">Watch Out for Bourne Shell -e Bug </A><BR><ACLASS="sect1"HREF="ch46_07.htm"TITLE="46.7 Quoting and Command-Line Parameters ">Quoting and Command-Line Parameters </A><BR><ACLASS="sect1"HREF="ch46_08.htm"TITLE="46.8 Test Built-In Commands for Failure ">Test Built-In Commands for Failure </A><BR><ACLASS="sect1"HREF="ch46_09.htm"TITLE="46.9 If Command Doesn't Return a Status, Test the Error Messages">If Command Doesn't Return a Status, Test the Error Messages</A><BR><ACLASS="sect1"HREF="ch46_10.htm"TITLE="46.10 A Portable echo Command ">A Portable echo Command </A></P><P></P></DIV><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-7160">46.1 Tips for Debugging Shell Scripts </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="UPT-ART-7160-IX-BOURNE-SHELL-SCRIPTS-DEBUGGING"></A><ACLASS="indexterm"NAME="UPT-ART-7160-IX-DEBUGGING-BOURNE-SHELL-SCRIPTS"></A><ACLASS="indexterm"NAME="AUTOID-55327"></A>Depending on the Bourne shell version you have, the error messagesit gives can be downright useless.For instance, it can just say <CODECLASS="literal">End</CODE> <CODECLASS="literal">of</CODE> <CODECLASS="literal">file</CODE><CODECLASS="literal">unexpected</CODE>.Here are a few tricks to use to get a little more information aboutwhat's going on.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-7160-SECT-1.1">46.1.1 Use -xv </A></H3><PCLASS="para">Start your script like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">#!/bin/sh -xv</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-55340"></A><ACLASS="indexterm"NAME="AUTOID-55343"></A>(or, if your UNIX can't handle <CODECLASS="literal">#!</CODE>, use the command<SPANCLASS="link"><CODECLASS="literal">set&nbsp;-xv</CODE> (<ACLASS="linkend"HREF="ch44_19.htm"TITLE="The Bourne Shell set Command ">44.19</A>)</SPAN>).The <CODECLASS="literal">-xv</CODE> shows you what's happening as the shell reads your script.The lines of the script will be shown as the shell reads them.The shell shows each command it executes with a plus sign (<CODECLASS="literal">+</CODE>) before the command.</P><PCLASS="para">Note that the shell reads an entire loop (<EMCLASS="emphasis">for</EM>, <EMCLASS="emphasis">while</EM>, etc.)before it executes any commands in the loop.</P><PCLASS="para">If you want to run a script with debugging but you don't want to editthe script file, you can also start the shell explicitly from the commandline and give the options there:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>sh -xv </B></CODE><CODECLASS="replaceable"><I>scrfile</I></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-55360"></A><ACLASS="indexterm"NAME="AUTOID-55363"></A><ACLASS="indexterm"NAME="AUTOID-55366"></A><ACLASS="indexterm"NAME="AUTOID-55369"></A><ACLASS="indexterm"NAME="AUTOID-55372"></A><ACLASS="indexterm"NAME="AUTOID-55375"></A><ACLASS="indexterm"NAME="AUTOID-55378"></A><ACLASS="indexterm"NAME="AUTOID-55381"></A><ACLASS="indexterm"NAME="AUTOID-55384"></A><ACLASS="indexterm"NAME="AUTOID-55388"></A>Debugging output is usually pretty long, more than a screenful.So I pipe it to a pager like <EMCLASS="emphasis">pg</EM>.But the shell sends its debugging output to <EMCLASS="emphasis">stderr</EM>, so I<SPANCLASS="link">pipe both <EMCLASS="emphasis">stdout</EM> and <EMCLASS="emphasis">stderr</EM> (<ACLASS="linkend"HREF="ch13_04.htm"TITLE="Problems Piping to a Pager ">13.4</A>)</SPAN>.Using a pager has another advantage: if you want to kill the scriptbefore it finishes, just use the pager's &quot;quit&quot; command (like <EMCLASS="emphasis">q</EM>).<ACLASS="indexterm"NAME="AUTOID-55397"></A>When the pager quits, UNIX may even killthe shell script (you may seethe message<SPANCLASS="link"><CODECLASS="literal">Broken pipe</CODE> (<ACLASS="linkend"HREF="ch50_12.htm"TITLE="Common UNIX Error Messages ">50.12</A>)</SPAN>).</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-55402"></A><ACLASS="indexterm"NAME="AUTOID-55404"></A>Do you want to save the debugging output in a file and see it on yourscreen, too?Use<SPANCLASS="link"><EMCLASS="emphasis">tee</EM> (<ACLASS="linkend"HREF="ch13_09.htm"TITLE="Send Output Two or More Places with tee ">13.9</A>)</SPAN>to snag the <EMCLASS="emphasis">scrfile</EM> stdout and stderr; add <EMCLASS="emphasis">tee</EM> to thepipeline before the pager.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-55412"></A>If the script is slow, you can run it in the background.<SPANCLASS="link">Redirect the shell's output and errors (<ACLASS="linkend"HREF="ch13_05.htm"TITLE="Redirection in C Shell: Capture Errors, Too? ">13.5</A>, <ACLASS="linkend"HREF="ch08_13.htm"TITLE='Is It "2&gt;&amp;1 file&quot; or "&gt; file 2&gt;&amp;1&quot;? Why?'>8.13</A>)</SPAN>into a<SPANCLASS="link">temporary file (<ACLASS="linkend"HREF="ch21_03.htm"TITLE="Unique Names for Temporary Files ">21.3</A>)</SPAN>.Use<SPANCLASS="link"><EMCLASS="emphasis">tail -f</EM> (<ACLASS="linkend"HREF="ch25_16.htm"TITLE="How to Look at a File as It Grows ">25.16</A>)</SPAN>to &quot;watch&quot; the log file.If you want to do something else while the script runs, just kill the<EMCLASS="emphasis">tail</EM> command (with CTRL-cor your interrupt key), do something else,then start another <EMCLASS="emphasis">tail -f</EM> when you want to watch again.</P><PCLASS="para">Finally, if the script normally writes something to its standardoutput, you can<SPANCLASS="link">split the normal and debugging outputs into two files (<ACLASS="linkend"HREF="ch13_01.htm#UPT-ART-1023"TITLE="Using Standard Input and Output">13.1</A>)</SPAN>.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-7160-SECT-1.2">46.1.2 Unmatched Operators </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-55426"></A><ACLASS="indexterm"NAME="AUTOID-55429"></A>If the shell says <CODECLASS="literal">End</CODE> <CODECLASS="literal">of</CODE> <CODECLASS="literal">file</CODE> <CODECLASS="literal">unexpected</CODE>,look for a line in your scriptthat has an opening quote but no closing quote.The shell is probably searching for but never finding the matching quote.The same goes for missing parentheses and braces (<CODECLASS="literal">{}</CODE>).</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-7160-SECT-1.3">46.1.3 Exit Early </A></H3><PCLASS="para">If you're getting an <CODECLASS="literal">End</CODE> <CODECLASS="literal">of</CODE> <CODECLASS="literal">file</CODE> <CODECLASS="literal">unexpected</CODE>error, put these two lines near the middle of the script:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">echo &quot;DEBUG: quitting early...&quot; 1&gt;&amp;2exit</PRE></BLOCKQUOTE></P><PCLASS="para">Then run your script.Those lines will print a message and stop the shell where you put them.If you don't get the <CODECLASS="literal">End</CODE> <CODECLASS="literal">of</CODE> <CODECLASS="literal">file</CODE> <CODECLASS="literal">unexpected</CODE>error anymore, you know thatthe problem is somewhere after the <CODECLASS="literal">exit</CODE> line.Move those two lines farther down and try again.(Otherwise, move them up...)</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-7160-SECT-1.4">46.1.4 Missing or Extra esac, ;;, fi, etc. </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-55455"></A><ACLASS="indexterm"NAME="AUTOID-55458"></A><ACLASS="indexterm"NAME="AUTOID-55461"></A><ACLASS="indexterm"NAME="AUTOID-55464"></A>A message like <CODECLASS="literal">line</CODE> <CODECLASS="literal">23:</CODE> <CODECLASS="literal">;;</CODE> <CODECLASS="literal">unexpected</CODE> meansthat you have anunmatched piece of code somewhere before line 23.You'll also see <CODECLASS="literal">fi unexpected</CODE>.Look at all nested <EMCLASS="emphasis">if</EM> and <EMCLASS="emphasis">case</EM> statements, and statements likethem, to be sure that they end in the right places.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="UPT-ART-7160-SECT-1.5">46.1.5 Line Numbers Reset Inside Redirected Loops </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-55477"></A>The shell may give you an error that mentions &quot;line 1&quot; or another line numberthat seems way too small, when there's no error close to the top of yourscript.Look at any loops or other structures with<SPANCLASS="link">redirected inputs or outputs (<ACLASS="linkend"HREF="ch45_22.htm"TITLE="Handling Files Line-by-Line ">45.22</A>)</SPAN>.Some Bourne shells start a separate shell to run these loops and lose trackof the line numbers.&#13;</P></DIV><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch45_36.htm"TITLE="45.36 Shell Lockfile "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 45.36 Shell Lockfile "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch46_02.htm"TITLE="46.2 Quoting Trouble?  Think, Then Use echo "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 46.2 Quoting Trouble?  Think, Then Use echo "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">45.36 Shell Lockfile </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">46.2 Quoting Trouble?  Think, Then Use echo </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>