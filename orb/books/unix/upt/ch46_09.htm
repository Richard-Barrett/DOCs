<HTML><HEAD><TITLE>[Chapter 46] 46.9 If Command Doesn't Return a Status, Test the Error Messages</TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:55:43Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch46_01.htm"TITLE="46. Shell Script Debugging and Gotchas"><LINKREL="prev"HREF="ch46_08.htm"TITLE="46.8 Test Built-In Commands for Failure "><LINKREL="next"HREF="ch46_10.htm"TITLE="46.10 A Portable echo Command "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch46_08.htm"TITLE="46.8 Test Built-In Commands for Failure "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 46.8 Test Built-In Commands for Failure "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 46<BR>Shell Script Debugging and Gotchas</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch46_10.htm"TITLE="46.10 A Portable echo Command "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 46.10 A Portable echo Command "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-0353">46.9 If Command Doesn't Return a Status, Test the Error Messages</A></H2><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-55870"></A><ACLASS="indexterm"NAME="AUTOID-55873"></A><ACLASS="indexterm"NAME="AUTOID-55876"></A>UNIX commands should return a zero<SPANCLASS="link">exit status (<ACLASS="linkend"HREF="ch44_07.htm"TITLE="Exit Status of UNIX Processes ">44.7</A>)</SPAN>if they succeedor a non-zero status if they fail.Not all commands do.For example, here's a log I found of a test I did back in 1985 to the4.3BSD version of<SPANCLASS="link"><EMCLASS="emphasis">touch</EM> (<ACLASS="linkend"HREF="ch21_07.htm"TITLE="Setting File Modification Time with touch ">21.7</A>)</SPAN>:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">$ <CODECLASS="userinput"><B>touch /tmp</B></CODE>touch: /tmp: can only touch regular files$ <CODECLASS="userinput"><B>echo $?</B></CODE>$ <CODECLASS="userinput"><B>touch -f /usr/src/usr.bin/touch.c</B></CODE>touch: /usr/src/usr.bin/touch.c: couldn't chmod: Not owner$ <CODECLASS="userinput"><B>echo $?</B></CODE>$ <CODECLASS="userinput"><B>touch -z</B></CODE>touch: bad option -z$ <CODECLASS="userinput"><B>echo $?</B></CODE></PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-55891"></A><ACLASS="indexterm"NAME="AUTOID-55894"></A>Because the status was always zero, as if the command had succeeded,my shell scripts couldn't test the exit status for failure.A workaround is to make your own shell script version of <EMCLASS="emphasis">touch</EM>(maybe call it <EMCLASS="emphasis">mytouch</EM>)-or to put code like this into a shellscript where you need to run <EMCLASS="emphasis">touch</EM>:[1]</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[1] Thanks to Richard Doty for this idea and the section of the shell scriptI've shown here.</P></BLOCKQUOTE><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch45_21.htm"TITLE="45.21 n&gt;&amp;m: Swap Standard Output and Standard Error ">2&gt;&amp;1</A> &#13;</PRE></TH><TDVALIGN="TOP"><PRECLASS="screen"># RUN touch ON THE COMMAND LINE ARGUMENTS (INCLUDING ANY OPTIONS).# MERGE stderr ONTO stdout AND TEST FOR ERROR MESSAGES:<ACLASS="indexterm"NAME="AUTOID-55904"></A>out=`/bin/touch &quot;$@&quot; 2&gt;&amp;1`case &quot;$out&quot; in&quot;&quot;)                                   exitstat=0;;*bad\ option)                         exitstat=l ; echo &quot;$out&quot; 1&gt;&amp;2;;*does\ not\ exist)                    exitstat=3 ; echo &quot;$out&quot; 1&gt;&amp;2;;*can\ only\ touch\ regular\ files*)   exitstat=4 ; echo &quot;$out&quot; 1&gt;&amp;2;;*couldn\'t\ chmod)                    exitstat=5 ; echo &quot;$out&quot; 1&gt;&amp;2;;*couldn\'t\ chmod\ back)              exitstat=6 ; echo &quot;$out&quot; 1&gt;&amp;2;;*cannot\ touch)                       exitstat=7 ; echo &quot;$out&quot; 1&gt;&amp;2;;*)                                    exitstat=10; echo &quot;$out&quot; 1&gt;&amp;2;;esacexit $exitstat</PRE></TD></TR></TABLE></P><PCLASS="para">That code handles many of the error exits; other errors get an exit statusof 10.You could simplify the code to return a status of 1 on <EMCLASS="emphasis">any</EM> error.On the other hand, it would be easy to expand that code to cover anypossible (or interesting) error output.Article<ACLASS="xref"HREF="ch27_19.htm"TITLE="Finding Words Inside Binary Files ">27.19</A>shows how to get a list of many of the possible error messages;you can also see the errors by making some typical mistakes likeunreadable or unwritable filenames.</P><PCLASS="para">That code won't work everywhere.The command you're running might write text to standard output that youdon't want mixed together with error messages (on the standard error).Or, worse, some vendors' versions of some commands write errors to thestandard output!Still, this technique should give you a good start on working aroundbadly behaved UNIX commands.</P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">JP</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch46_08.htm"TITLE="46.8 Test Built-In Commands for Failure "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 46.8 Test Built-In Commands for Failure "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch46_10.htm"TITLE="46.10 A Portable echo Command "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 46.10 A Portable echo Command "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">46.8 Test Built-In Commands for Failure </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">46.10 A Portable echo Command </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>