<HTML><HEAD><TITLE>[Chapter 50] 50.3 apropos on Systems Without apropos </TITLE><METANAME="DC.title"CONTENT="UNIX Power Tools"><METANAME="DC.creator"CONTENT="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-04T21:56:50Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="1-56592-260-3"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch50_01.htm"TITLE="50. Help--Online Documentation, etc."><LINKREL="prev"HREF="ch50_02.htm"TITLE="50.2 The apropos Command "><LINKREL="next"HREF="ch50_04.htm"TITLE="50.4 whatis: One-Line Command Summaries "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="UNIX Power Tools"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,58"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/psrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch50_02.htm"TITLE="50.2 The apropos Command "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 50.2 The apropos Command "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 50<BR>Help--Online Documentation, etc.</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch50_04.htm"TITLE="50.4 whatis: One-Line Command Summaries "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 50.4 whatis: One-Line Command Summaries "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="UPT-ART-2101">50.3 apropos on Systems Without apropos </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="UPT-ART-2101-IX-APROPOS-COMMAND-ALTERNATIVES-TO"></A><ACLASS="indexterm"NAME="UPT-ART-2101-IX-APROPOS-COMMAND-SUPPORT-FOR"></A><ACLASS="indexterm"NAME="UPT-ART-2101-IX-MANUAL-PAGES-SEARCHING"></A><ACLASS="indexterm"NAME="UPT-ART-2101-IX-SEARCHING-MANUAL-PAGES"></A><ACLASS="indexterm"NAME="AUTOID-59058"></A><ACLASS="indexterm"NAME="AUTOID-59061"></A>I was just asked to write an article about how to simulate<EMCLASS="emphasis">apropos</EM> on systems that don't have it.I have to confess thatI've never faced this problem.But I was able to come up with asolution.Your mileage may vary&nbsp;- particularly since different UNIXimplementations have different ways of storing their manual pages.</P><PCLASS="para">The solution has two parts.First, you need a script that builds anindex; that's better than <EMCLASS="emphasis">grep</EM>ping through every manual page in theworld.[<SPANCLASS="link">Not always (<ACLASS="linkend"HREF="ch50_06.htm"TITLE="Searching Online Manual Pages ">50.6</A>)</SPAN>.<CODECLASS="literal">;-)</CODE> -<EMCLASS="emphasis">JP</EM>&nbsp;]Then you need an <EMCLASS="emphasis">apropos</EM> alias that automatically searchesyour index file.Here's the script to build the index file:</P><PCLASS="para"><TABLECLASS="screen.co"BORDER="1"><TR><THVALIGN="TOP"><PRECLASS="calloutlist">&#13;<ACLASS="co"HREF="ch09_12.htm"TITLE="9.12 The Bourne Shell for Loop ">for</A> <ACLASS="co"HREF="ch34_24.htm"TITLE="34.24 Quick Reference: sed ">sed</A> <ACLASS="co"HREF="ch09_16.htm"TITLE="9.16 Command Substitution ">`...`</A> <ACLASS="co"HREF="ch43_18.htm"TITLE="43.18 How nroff Makes Bold and Underline; How to Remove It">col</A> <ACLASS="co"HREF="ch27_05.htm"TITLE="27.5 Extended Searching for Text with egrep ">egrep</A> <ACLASS="co"HREF="ch35_20.htm"TITLE="35.20 Quick Reference: uniq ">uniq</A> <ACLASS="co"HREF="ch45_23.htm"TITLE="45.23 The Ins and Outs of Redirected I/O Loops ">done &gt;</A> </PRE></TH><TDVALIGN="TOP"><PRECLASS="screen"><ACLASS="indexterm"NAME="AUTOID-59073"></A>#!/bin/sh# manindex: Generate a list of topic lines that you can grep through.# Then create 'apropos' and other aliases to search the list.# Run this periodically-once a month should sufficemandir=/usr/share/man     # where the manual pages are storedmanlist=&quot;cat1 cat2 cat3&quot;  # list particular directories you care aboutindexfile=&quot;/home/mike/manindex.txt&quot;rm -f $indexfile<ACLASS="indexterm"NAME="AUTOID-59076"></A><ACLASS="indexterm"NAME="AUTOID-59079"></A><ACLASS="indexterm"NAME="AUTOID-59082"></A><ACLASS="indexterm"NAME="AUTOID-59085"></A><ACLASS="indexterm"NAME="AUTOID-59087"></A><ACLASS="indexterm"NAME="AUTOID-59090"></A><ACLASS="indexterm"NAME="AUTOID-59092"></A>for directory in $manlistdo        cd $mandir/$directory        # the sed command turns filenames into &quot;manual page&quot; names        # e.g., converts sed.1.z to sed.          # BUG:  won't handle names like a.out.4.Z correctly        for manpage in `ls | sed -e 's/\..*$//g'`        do                # use man to unpack the manual page; it might be compressed                # use col to strip garbage characters                # egrep looks for spaces, manual page name, and dash                man $manpage | col -b -x | egrep &quot;^ +$manpage.* - &quot; | uniq        donedone &gt; $indexfile</PRE></TD></TR></TABLE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-59102"></A><ACLASS="indexterm"NAME="AUTOID-59104"></A>This script goes through every directory in which manual pages arestored.It strips all suffixes from the filenames, and then uses<EMCLASS="emphasis">man</EM> to print the actual manual page.This is better than tryingto look at the raw manual pages themselves because some vendors don'tprovide the raw manual pages.If you let <EMCLASS="emphasis">man</EM> give you the page youwant, you'll always find it.[2]The <EMCLASS="emphasis">col</EM>command strips out boldfacing, underlining, and other monstrositiesthat will confuse <EMCLASS="emphasis">grep</EM>.Finally, <EMCLASS="emphasis">egrep</EM> looks for linesto put in the index.It's not as fussy as the BSD <EMCLASS="emphasis">catman</EM>program (which <EMCLASS="emphasis">mkindex</EM> is emulating), so it will find a fairnumber of lines that don't belong; but we think this is only a mildflaw.</P><BLOCKQUOTECLASS="footnote"><PCLASS="para">[2] If you have the source files for the manual page online, rather thanpre-formatted files, you might want to rewrite the script to searchthem directly.It will be a lot faster.</P></BLOCKQUOTE><PCLASS="para">Before you can use this scriptyou'll have to substitute definitions for three variables:</P><DLCLASS="variablelist"><DTCLASS="term"><EMCLASS="emphasis">mandir</EM></DT><DDCLASS="listitem"><PCLASS="para">The top-level directory in which manual pages are stored.Often<EMCLASS="emphasis">/usr/man</EM>, but it may be different on your system.</P></DD><DTCLASS="term"><EMCLASS="emphasis">manlist</EM></DT><DDCLASS="listitem"><PCLASS="para">Subdirectories containing the manual pages you care about.You'llprobably want the directory in which user-level commands are stored,as a minimum.This level of directory naming may be radicallydifferent on different systems.I think this script is flexibleenough to handle all the variations I can remember; if it can't,you'll have to hack it up a bit.</P></DD><DTCLASS="term"><EMCLASS="emphasis">indexfile</EM></DT><DDCLASS="listitem"><PCLASS="para">The file in which you want to keep your index (the output of this script).</P></DD></DL><PCLASS="para">Expect <EMCLASS="emphasis">manindex</EM> to run for a long time; several minutes ormore, depending on how thorough you want to be.Fortunately, you don't need to do this veryoften: once to get started, and then once a month (or so) to pick upany &quot;stray&quot; manual pages that someone else may have added.If you wantto speed the task up, remember that you can skip any sections of themanual that you're not interested in by defining <EMCLASS="emphasis">manlist</EM>appropriately.For example, if you're not interested in section 2 ofthe manual, just leave <EMCLASS="emphasis">cat2</EM> out of the list.</P><PCLASS="para">Once you've created the index, the rest of the problem is easy.Justmake yourself an <EMCLASS="emphasis">apropos</EM><SPANCLASS="link">alias (<ACLASS="linkend"HREF="ch10_02.htm"TITLE="Aliases for Common Commands ">10.2</A>)</SPAN>and add it to your <EMCLASS="emphasis">.cshrc</EM>file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">alias apropos &quot;grep -i \!$ /home/mike/manindex.txt&quot;</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-59145"></A>Here's what its output looks like:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">% <CODECLASS="userinput"><B>apropos search</B></CODE>acctcom - search and print process accounting file(s)egrep - search a file for a pattern using full regular expressionsfgrep - search a file for a character stringfmlgrep - search a file for a patterngrep - search a file for a patternpathconv - search FMLI criteria for filename</PRE></BLOCKQUOTE></P><PCLASS="para">As I pointed out, this isn't perfect.But I think it's a reasonablesubstitute.<ACLASS="indexterm"NAME="AUTOID-59152"></A><ACLASS="indexterm"NAME="AUTOID-59153"></A><ACLASS="indexterm"NAME="AUTOID-59154"></A><ACLASS="indexterm"NAME="AUTOID-59155"></A></P><DIVCLASS="sect1info"><PCLASS="SECT1INFO">- <SPANCLASS="authorinitials">ML</SPAN></P></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch50_02.htm"TITLE="50.2 The apropos Command "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 50.2 The apropos Command "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="UNIX Power Tools"><IMGSRC="../gifs/txthome.gif"ALT="UNIX Power Tools"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch50_04.htm"TITLE="50.4 whatis: One-Line Command Summaries "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 50.4 whatis: One-Line Command Summaries "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">50.2 The apropos Command </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_0.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">50.4 whatis: One-Line Command Summaries </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="../vi/index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>