<HTML><HEAD><TITLE>[Chapter 7] Advanced Editing </TITLE><METANAME="DC.title"CONTENT="Learning the vi Editor"><METANAME="DC.creator"CONTENT="Linda Lamb"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-03T20:52:47Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="0-937175-67-6"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="index.htm"TITLE="Learning the vi Editor"><LINKREL="prev"HREF="ch06_04.htm"TITLE="6.4 Pattern-matching Examples "><LINKREL="next"HREF="ch07_02.htm"TITLE="7.2 Executing UNIX Commands "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Learning the vi Editor"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/vsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_04.htm"TITLE="6.4 Pattern-matching Examples "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 6.4 Pattern-matching Examples "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 7</FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 Executing UNIX Commands "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.2 Executing UNIX Commands "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="CHAPTER"><H1CLASS="chapter"><ACLASS="title"NAME="VI6-CH-7">7. Advanced Editing </A></H1><DIVCLASS="htmltoc"><P><B>Contents:</B><BR><ACLASS="sect1"HREF="#VI6-CH-7-SECT-1"TITLE="7.1 Customizing vi ">Customizing vi </A><BR><ACLASS="sect1"HREF="ch07_02.htm"TITLE="7.2 Executing UNIX Commands ">Executing UNIX Commands </A><BR><ACLASS="sect1"HREF="ch07_03.htm"TITLE="7.3 Saving Commands ">Saving Commands </A><BR><ACLASS="sect1"HREF="ch07_04.htm"TITLE="7.4 Using ex Scripts ">Using ex Scripts </A><BR><ACLASS="sect1"HREF="ch07_05.htm"TITLE="7.5 Editing Program Source Code ">Editing Program Source Code </A></P><P></P></DIV><PCLASS="para">This chapter introduces you to some of the more advanced capabilitiesof the <EMCLASS="emphasis">vi</EM> and <EMCLASS="emphasis">ex</EM> editors.You should be reasonably familiar with the material presented inthe earlier chapters of this book before you start working with theconcepts presented in this chapter.</P><PCLASS="para">This chapter is divided into five parts.The first part discusses a number of ways toset options that allow you to customize your editing environment.You'll learn how to use the <CODECLASS="literal">set</CODE> command and how to createa number of different editing environments using <EMCLASS="emphasis">.exrc</EM> files.</P><PCLASS="para">The second part discusses how you can execute UNIX commands fromwithin <EMCLASS="emphasis">vi</EM>, and how you can use <EMCLASS="emphasis">vi</EM> to filter text throughUNIX commands.</P><PCLASS="para">The third part discusses various ways to save long sequencesof commands by reducing them to abbreviations, or even to commandsthat use only one keystroke (this is called <EMCLASS="emphasis">mapping</EM> keys).It also includes a section on @-functions, which allow you tostore command sequences in a buffer.</P><PCLASS="para">The fourth part discusses the use of <EMCLASS="emphasis">ex</EM> scripts fromthe UNIX command line or from within shell scripts.Scripting provides a powerful way to make repetitive edits.</P><PCLASS="para">The fifth part discusses some features of <EMCLASS="emphasis">vi</EM> that areespecially useful to programmers.  <EMCLASS="emphasis">vi</EM> has options thatcontrol line indentation and an option to display invisible characters (specifically tabs and newlines).  There are search commands that are useful with program code blocks orwith C functions. </P><DIVCLASS="sect1"><H2CLASS="sect1"><ACLASS="title"NAME="VI6-CH-7-SECT-1">7.1 Customizing vi </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="VI6-CH-7-IX-EDITOR-CUSTOMIZING"></A>You have seen that <EMCLASS="emphasis">vi</EM> operates differently on various terminals.(For instance, on &quot;dumb&quot; terminals, <EMCLASS="emphasis">vi</EM> inserts @ symbolsin place of deleted lines;  on intelligent terminals, <EMCLASS="emphasis">vi</EM> redrawsthe screen with each edit.)<EMCLASS="emphasis">vi</EM> gets operating instructionsabout your terminal type from a file called <EMCLASS="emphasis">/etc/termcap</EM>.(In System V, <EMCLASS="emphasis">termcap</EM> has been replaced with an alternateterminal database called <EMCLASS="emphasis">terminfo</EM>.)<ACLASS="indexterm"NAME="AUTOID-6594"></A><ACLASS="indexterm"NAME="AUTOID-6596"></A></P><PCLASS="para"><ACLASS="indexterm"NAME="VI6-CH-7-IX-EX-CMNDS-VI-SETOPTS"></A><ACLASS="indexterm"NAME="VI6-CH-7-IX-SET-CMND-OPTS"></A>There are also a number of options that you can set from within<EMCLASS="emphasis">vi</EM> that affect how it operates.  For example, you can set a right margin that will cause <EMCLASS="emphasis">vi</EM> to wraplines automatically, so you don't need to insert carriage returns.</P><PCLASS="para">You can change options from within <EMCLASS="emphasis">vi</EM> by using the <EMCLASS="emphasis">ex</EM> command<CODECLASS="literal">:set</CODE>.  <ACLASS="indexterm"NAME="AUTOID-6613"></A><ACLASS="indexterm"NAME="AUTOID-6615"></A>In addition, whenever <EMCLASS="emphasis">vi</EM> is started up, it reads a file in your home directory called <EMCLASS="emphasis">.exrc</EM> for further operating instructions.  By placing <CODECLASS="literal">:set</CODE> commands in this file, you can modify the way <EMCLASS="emphasis">vi</EM> acts whenever you use it.</P><PCLASS="para">You can also set up <EMCLASS="emphasis">.exrc</EM> files in local directories toinitialize various options that you want to use in differentenvironments.  For example, you might define one set of options forediting English text, but another set for editing source programs.  The <EMCLASS="emphasis">.exrc</EM> file in your home directory will be executed first, thenthe one in your current directory.</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-6626"></A><ACLASS="indexterm"NAME="AUTOID-6628"></A>Finally, any commands stored in the shell variable <EMCLASS="emphasis">EXINIT</EM> willbe executed by <EMCLASS="emphasis">vi</EM> on startup.  If there is a conflict betweensettings made in <EMCLASS="emphasis">.exrc</EM> and <EMCLASS="emphasis">EXINIT</EM>, those in <EMCLASS="emphasis">.exrc</EM>take precedence.</P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="VI6-CH-7-SECT-1.1">7.1.1 The :set Command </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-6639"></A><ACLASS="indexterm"NAME="AUTOID-6642"></A>There are two types of options that can be changed with the <CODECLASS="literal">:set</CODE>command:  toggle options, which are either on or off, andoptions that take a numeric or string value (such as the location of a margin or the name of a file).</P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-6647"></A><ACLASS="indexterm"NAME="AUTOID-6650"></A>Toggle options may be on or off by default.  To turn a toggle option on, the command is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:set <EMCLASS="emphasis">option</EM></PRE></BLOCKQUOTE></P><PCLASS="para">To turn a toggle option off, the command is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:set no<EMCLASS="emphasis">option</EM></PRE></BLOCKQUOTE></P><PCLASS="para">For example, to specify that pattern searches should ignore case, type:<ACLASS="indexterm"NAME="AUTOID-6661"></A><ACLASS="indexterm"NAME="AUTOID-6664"></A><ACLASS="indexterm"NAME="AUTOID-6667"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:set ic</PRE></BLOCKQUOTE></P><PCLASS="para">If you want <EMCLASS="emphasis">vi</EM> to return to being case-sensitive insearches, give the command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:set noic</PRE></BLOCKQUOTE></P><PCLASS="para">Some options have a value assigned to them.  For example, the <CODECLASS="literal">window</CODE> option sets the number of lines shownin the screen's &quot;window.&quot;  You set values for these options with an equal sign (=):<ACLASS="indexterm"NAME="AUTOID-6678"></A><ACLASS="indexterm"NAME="AUTOID-6680"></A><ACLASS="indexterm"NAME="AUTOID-6683"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:set window=20</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="VI6-CH-7-IX-SET-CMND-INQU-OPTS"></A>During a <EMCLASS="emphasis">vi</EM> session, you can check which options <EMCLASS="emphasis">vi</EM> isusing.  The command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:set all</PRE></BLOCKQUOTE></P><PCLASS="para">displays the complete list of options, including options that youhave set and defaults that <EMCLASS="emphasis">vi</EM> has &quot;chosen.&quot;  The display should look something like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">noautoindent      nooptimize          tabstop=8autoprint         open                taglength=0noautowrite       prompt              term=wy50nobeautify        noreadonly          notersedirectory=/tmp    redraw              timeoutnoedcompatible    remap               ttytype=wy50noerrorbells      report=5            warnhardtabs=8        scroll=11           window=20noignorecase      sections=AhBhChDh   wrapscannolisp            shell=/bin/csh      wrapmargin=10nolist            noshowmatch         nowriteanymagic             noslowopen   mesg              paragraphs=IPLPPPQP LIpp1pipbb   number            tags=tags /usr/lib/tags</PRE></BLOCKQUOTE></P><PCLASS="para">You can find out the current value of any individual option by name,using the command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:set <EMCLASS="emphasis">option</EM>?</PRE></BLOCKQUOTE></P><PCLASS="para">The command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:set</PRE></BLOCKQUOTE></P><PCLASS="para">shows options that you have specifically changed, or set, either inyour <EMCLASS="emphasis">.exrc</EM> file or during the current session.  For example, the display might look like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">number sect=AhBhChDh window=20 wrapmargin=10</PRE></BLOCKQUOTE></P><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-6712"></A></P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="VI6-CH-7-SECT-1.2">7.1.2 The .exrc File </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-6716"></A><ACLASS="indexterm"NAME="AUTOID-6718"></A>The <EMCLASS="emphasis">.exrc</EM> file that controls your own <EMCLASS="emphasis">vi</EM> environment isin your home directory (the directory you are in when you firstlog on).  You can modify the <EMCLASS="emphasis">.exrc</EM> file with the <EMCLASS="emphasis">vi</EM> editor, just asyou can any other text file.</P><PCLASS="para">If you don't yet have an <EMCLASS="emphasis">.exrc</EM> file, simply use <EMCLASS="emphasis">vi</EM> tocreate one.Enter into this file the <CODECLASS="literal">set</CODE>, <CODECLASS="literal">ab</CODE>, and <CODECLASS="literal">map</CODE> commandsthat you want to have in effect whenever you use <EMCLASS="emphasis">vi</EM> or <EMCLASS="emphasis">ex</EM>.(<CODECLASS="literal">ab</CODE> and <CODECLASS="literal">map</CODE> are discussed later in this chapter.)A sample <EMCLASS="emphasis">.exrc</EM> file looks like this:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">set nowrapscan wrapmargin=7set sections=SeAhBhChDh nomesgmap q :w^M:n^Mmap v dwElpab ORA O'Reilly &amp; Associates, Inc.</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;Since the file is actually read by <EMCLASS="emphasis">ex</EM> before it enters visualmode (<EMCLASS="emphasis">vi</EM>), commands in <EMCLASS="emphasis">.exrc</EM> should not have a precedingcolon.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="VI6-CH-7-SECT-1.3">7.1.3 Alternate Environments </A></H3><PCLASS="para">In addition to reading the <EMCLASS="emphasis">.exrc</EM> file in your home directory,<EMCLASS="emphasis">vi</EM> will read a filecalled <EMCLASS="emphasis">.exrc</EM> in the current directory.  This allowsyou to set options that are appropriateto a particular project.</P><PCLASS="para">For example, you might want to have one set of options in adirectory mainly used for programming:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">set number lisp autoindent sw=4 terseset tags=/usr/lib/tags</PRE></BLOCKQUOTE></P><PCLASS="para">and another set of options in a directory used for text editing:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">set wrapmargin=15 ignorecase</PRE></BLOCKQUOTE></P><PCLASS="para">Note that you can set certain options in the <EMCLASS="emphasis">.exrc</EM>file in your home directory and unset them in a localdirectory.<ACLASS="indexterm"NAME="AUTOID-6756"></A><ACLASS="indexterm"NAME="AUTOID-6759"></A></P><BLOCKQUOTECLASS="note"><PCLASS="para"><STRONG>NOTE:</STRONG> In System V, Release 3.2 and later, <EMCLASS="emphasis">vi</EM> doesn't read<ICLASS="filename">.exrc</I> files in the current directory unless you firstset the <CODECLASS="literal">exrc</CODE> option in yourhome directory's <EMCLASS="emphasis">.exrc</EM> file:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">set exrc</PRE></BLOCKQUOTE></P><PCLASS="para">This mechanism prevents other people from placing, in yourworking directory, an <EMCLASS="emphasis">.exrc</EM> file whose commands might jeopardize the security of your system.</P></BLOCKQUOTE><PCLASS="para">You can also define alternate <EMCLASS="emphasis">vi</EM> environments by saving optionsettings in a file other than <EMCLASS="emphasis">.exrc</EM> and reading in that filewith the <CODECLASS="literal">:so</CODE> command.  For example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:so .progoptions</PRE></BLOCKQUOTE></P><PCLASS="para">Local <EMCLASS="emphasis">.exrc</EM> files are also useful for definingabbreviations and key mappings (described later in thischapter).  When we write a book or manual, we save allabbreviations to be used in that book in an <EMCLASS="emphasis">.exrc</EM> filein the directory in which the book is being created.</P></DIV><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="VI6-CH-7-SECT-1.4">7.1.4 Some Useful Options </A></H3><PCLASS="para">As you can see when you type <CODECLASS="literal">:set</CODE> <CODECLASS="literal">all</CODE>, there are an awful lot of options that can be set.  Many of them are used internally by <EMCLASS="emphasis">vi</EM> and aren't usually changed.  Others are important in certain cases,but not in others  (for example, <CODECLASS="literal">noredraw</CODE> and <CODECLASS="literal">window</CODE> canbe useful on a dialup line at a low baud rate).  The table in <ACLASS="xref"HREF="appb_01.htm"TITLE="Setting Environment Options ">Appendix B, Setting Environment Options </A>, contains a brief description of each option.  We recommend that you takesome time to play with setting options&nbsp;- if an option looks interesting,try setting it (or unsetting it) and watch what happens while you edit.  You may find some surprisingly useful tools.</P><PCLASS="para">As discussed earlier in this book,one option,<CODECLASS="literal">wrapmargin</CODE>,is essential for editing nonprogramtext.  <CODECLASS="literal">wrapmargin</CODE> specifies the size of the right margin thatwill be used to autowrap text as you type.(This saves manually typing carriage returns.)A typical value is 7 to 15:<ACLASS="indexterm"NAME="AUTOID-6793"></A><ACLASS="indexterm"NAME="AUTOID-6795"></A><ACLASS="indexterm"NAME="AUTOID-6798"></A></P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:set wrapmargin=10</PRE></BLOCKQUOTE></P><PCLASS="para">Three other options control how <EMCLASS="emphasis">vi</EM> acts when conducting a search.  Normally, a search differentiates between uppercase andlowercase (<EMCLASS="emphasis">foo</EM> does not match <EMCLASS="emphasis">Foo</EM>), wraps around to the beginningof the file  (meaning that you can begin your search anywhere in thefile and still find all occurrences), and recognizes wildcardcharacters when pattern matching.  The default settings that controlthese options are <CODECLASS="literal">noignorecase</CODE>, <CODECLASS="literal">wrapscan</CODE>,and <CODECLASS="literal">magic</CODE>, respectively.<ACLASS="indexterm"NAME="AUTOID-6810"></A><ACLASS="indexterm"NAME="AUTOID-6813"></A><ACLASS="indexterm"NAME="AUTOID-6816"></A><ACLASS="indexterm"NAME="AUTOID-6819"></A><ACLASS="indexterm"NAME="AUTOID-6822"></A><ACLASS="indexterm"NAME="AUTOID-6825"></A><ACLASS="indexterm"NAME="AUTOID-6828"></A><ACLASS="indexterm"NAME="AUTOID-6831"></A><ACLASS="indexterm"NAME="AUTOID-6834"></A>To change any of these defaults, you would set the opposite toggle options:<CODECLASS="literal">ignorecase</CODE>, <CODECLASS="literal">nowrapscan</CODE>, and <CODECLASS="literal">nomagic</CODE>.</P><PCLASS="para">Options that may be of particular interest to programmers include:<CODECLASS="literal">lisp</CODE>, <CODECLASS="literal">autoindent</CODE>, <CODECLASS="literal">showmatch</CODE>, <CODECLASS="literal">tabstop</CODE>,<CODECLASS="literal">shiftwidth</CODE>, <CODECLASS="literal">number</CODE>, and<CODECLASS="literal">list</CODE>, as well as their opposite toggle options.<ACLASS="indexterm"NAME="AUTOID-6848"></A><ACLASS="indexterm"NAME="AUTOID-6849"></A><ACLASS="indexterm"NAME="AUTOID-6850"></A></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch06_04.htm"TITLE="6.4 Pattern-matching Examples "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 6.4 Pattern-matching Examples "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Learning the vi Editor"><IMGSRC="../gifs/txthome.gif"ALT="Learning the vi Editor"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_02.htm"TITLE="7.2 Executing UNIX Commands "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.2 Executing UNIX Commands "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">6.4 Pattern-matching Examples </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">7.2 Executing UNIX Commands </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="../upt/index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>