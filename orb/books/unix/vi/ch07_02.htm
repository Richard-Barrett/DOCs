<HTML><HEAD><TITLE>[Chapter 7] 7.2 Executing UNIX Commands </TITLE><METANAME="DC.title"CONTENT="Learning the vi Editor"><METANAME="DC.creator"CONTENT="Linda Lamb"><METANAME="DC.publisher"CONTENT="O'Reilly &amp; Associates, Inc."><METANAME="DC.date"CONTENT="1998-08-03T20:53:14Z"><METANAME="DC.type"CONTENT="Text.Monograph"><METANAME="DC.format"CONTENT="text/html"SCHEME="MIME"><METANAME="DC.source"CONTENT="0-937175-67-6"SCHEME="ISBN"><METANAME="DC.language"CONTENT="en-US"><METANAME="generator"CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINKREV="made"HREF="mailto:online-books@oreilly.com"TITLE="Online Books Comments"><LINKREL="up"HREF="ch07_01.htm"TITLE="7. Advanced Editing "><LINKREL="prev"HREF="ch07_01.htm"TITLE="7.1 Customizing vi "><LINKREL="next"HREF="ch07_03.htm"TITLE="7.3 Saving Commands "></HEAD><BODYBGCOLOR="#FFFFFF"TEXT="#000000"><DIVCLASS="htmlnav"><H1><IMGSRC="gifs/smbanner.gif"ALT="Learning the vi Editor"USEMAP="#srchmap"BORDER="0"></H1><MAPNAME="srchmap"><AREASHAPE="RECT"COORDS="0,0,466,65"HREF="index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="467,0,514,18"HREF="../search/vsrch.htm"ALT="Search this book"></MAP><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_01.htm"TITLE="7.1 Customizing vi "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.1 Customizing vi "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><B><FONTFACE="ARIEL,HELVETICA,HELV,SANSERIF"SIZE="-1">Chapter 7<BR>Advanced Editing </FONT></B></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_03.htm"TITLE="7.3 Saving Commands "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.3 Saving Commands "BORDER="0"></A></TD></TR></TABLE>&nbsp;<HRALIGN="LEFT"WIDTH="515"TITLE="footer"></DIV><DIVCLASS="SECT1"><H2CLASS="sect1"><ACLASS="title"NAME="VI6-CH-7-SECT-2">7.2 Executing UNIX Commands </A></H2><PCLASS="para"><ACLASS="indexterm"NAME="VI6-CH-7-IX-EDITOR-EXCTE-UX-CMNDS"></A><ACLASS="indexterm"NAME="VI6-CH-7-IX-EX-CMNDS-EXCTE-UX-CMNDS"></A><ACLASS="indexterm"NAME="VI6-CH-7-IX-UX-CMNDS-XCUTE-VI"></A><ACLASS="indexterm"NAME="VI6-CH-7-IX-SHELL-CMNDS-FROM-VI"></A>You can display or read in the results of any UNIX command while you are editing in <EMCLASS="emphasis">vi</EM>.An exclamation mark (<CODECLASS="literal">!</CODE>) tells<EMCLASS="emphasis">ex</EM> to create a shell and to regard what follows as a UNIX command:  </P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:!<EMCLASS="emphasis">command</EM></PRE></BLOCKQUOTE></P><PCLASS="para">So if you are editing and you want to check the time or datewithout exiting <EMCLASS="emphasis">vi</EM>, you can enter:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:!date</PRE></BLOCKQUOTE></P><PCLASS="para">The time and date will appear on your screen;  press <KBDCLASS="keycap">[RETURN]</KBD>to continue editing at the same place in your file.  </P><PCLASS="para">If you want to give several UNIX commands in a row without returning to<EMCLASS="emphasis">vi</EM> editing in between, you can create a shell with the <EMCLASS="emphasis">ex</EM> command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:sh</PRE></BLOCKQUOTE></P><PCLASS="para">&#13;When you want to exit the shell and return to <EMCLASS="emphasis">vi</EM>, press<KBDCLASS="keycap">[CTRL-D]</KBD>.</P><PCLASS="para">You can combine <CODECLASS="literal">:read</CODE> with a call to UNIX, to read the results of a UNIX command into your file.  As a very simple example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:r !date</PRE></BLOCKQUOTE></P><PCLASS="para">will read in the system's date information into the text of your file.  By preceding the <CODECLASS="literal">:r</CODE> command with a line address, you can readthe result of the command in at any desired point in your file.  Bydefault, it will appear after the current line.</P><PCLASS="para">Suppose you are editing a file and want to read in four phonenumbers from a file called <EMCLASS="emphasis">phone</EM>, but in alphabeticalorder.<EMCLASS="emphasis">phone</EM> reads:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Willing, Sue  333-4444Walsh, Linda  555-6666Quercia, Valerie  777-8888 Dougherty, Nancy  999-0000</PRE></BLOCKQUOTE></P><PCLASS="para">The command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:r !sort phone</PRE></BLOCKQUOTE></P><PCLASS="para">reads in the contents of <EMCLASS="emphasis">phone</EM> after they have been passedthrough the sort filter:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">Dougherty, Nancy  999-0000Quercia, Valerie  777-8888 Walsh, Linda  555-6666Willing, Sue  333-4444</PRE></BLOCKQUOTE></P><PCLASS="para">Suppose you are editing a file and want to insert text fromanother file in the directory, but you can't remember the new file's name.  You <EMCLASS="emphasis">could</EM> perform this task the long way:  exit yourfile, give the <CODECLASS="literal">ls</CODE> command, note the correct filename,reenter your file, and search for your place.</P><PCLASS="para">Or you could do the task in fewer steps:  </P><PCLASS="para"><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Keystrokes</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Results</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">:!ls</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">file1        file2         letternewfile      practice   </PRE></BLOCKQUOTE></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Display list of files in directory.  Note correct filename.  Press RETURN to continue editing.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">:r newfile</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">&quot;newfile 35 lines, 949 characters </PRE></BLOCKQUOTE></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Read in the new file.</P></TD></TR></TBODY></TABLE></P><DIVCLASS="sect2"><H3CLASS="sect2"><ACLASS="title"NAME="VI6-CH-7-SECT-2.1">7.2.1 Filtering Text Through a Command </A></H3><PCLASS="para"><ACLASS="indexterm"NAME="AUTOID-6940"></A><ACLASS="indexterm"NAME="VI6-CH-7-IX-FLTR-TXT-UX-CMND"></A><ACLASS="indexterm"NAME="VI6-CH-7-IX-CMNDS-FILTER-UX-CMND"></A><ACLASS="indexterm"NAME="VI6-CH-7-IX-EX-CMNDS-FLTR-UX-CMND"></A><ACLASS="indexterm"NAME="VI6-CH-7-IX-UX-CMNDS-FLTR-TEXT"></A>You can also send a block of text as standard input to a UNIX command.The output from this command replaces the block of text in the buffer.  You can filter text through a command from either <EMCLASS="emphasis">ex</EM> or <EMCLASS="emphasis">vi</EM>.  The main difference between the two methods is that you indicate the block of text with line addresses in <EMCLASS="emphasis">ex</EM> andwith text objects (movement commands) in <EMCLASS="emphasis">vi</EM>.</P><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="VI6-CH-7-SECT-2.1.1">7.2.1.1 Filtering Text with ex </A></H4><PCLASS="para">The first example demonstrates how to filter text with <EMCLASS="emphasis">ex</EM>.  Assume that the list of names in the preceding example,instead of being contained in a separate file called <EMCLASS="emphasis">phone</EM>,is already contained in the current file on lines 96 through 99.You simply type the addresses of the lines you want to filter, followedby an exclamation mark and the UNIX command to be executed.For example, the command:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">:96,99!sort</PRE></BLOCKQUOTE></P><PCLASS="para">will pass lines 96 through 99 through the <EMCLASS="emphasis">sort</EM> filter and replacethose lines with the output of <EMCLASS="emphasis">sort</EM>.</P></DIV><DIVCLASS="sect3"><H4CLASS="sect3"><ACLASS="title"NAME="VI6-CH-7-SECT-2.1.2">7.2.1.2 Filtering Text with vi </A></H4><PCLASS="para">In <EMCLASS="emphasis">vi</EM> text is filtered through a UNIX command by typing an exclamation mark followed by any of <EMCLASS="emphasis">vi</EM>'s movement keystrokesthat indicate a block of text,and then by the UNIX command line to be executed.  For example:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">!)<EMCLASS="emphasis">command</EM></PRE></BLOCKQUOTE></P><PCLASS="para">will pass the next sentence through <EMCLASS="emphasis">command</EM>.  </P><PCLASS="para">There are a couple of unusual features about how <EMCLASS="emphasis">vi</EM> acts whenyou use this feature.</P><ULCLASS="itemizedlist"><LICLASS="listitem"><PCLASS="para">First, the exclamation mark doesn't appear on yourscreen right away.When you type the keystroke(s)for the text object you want to filter, theexclamation mark appears at the bottom of the screen, <EMCLASS="emphasis">but thecharacter you type to reference the object does not.</EM>  </P></LI><LICLASS="listitem"><PCLASS="para">Second, text blocks must be more than one line, soyou can use only the keystrokes that would move more than one line ( <CODECLASS="literal">G</CODE>, <CODECLASS="literal">{ }</CODE>, <CODECLASS="literal">( )</CODE>, <CODECLASS="literal">[[ ]]</CODE>, <CODECLASS="literal">+</CODE>, <CODECLASS="literal">-</CODE> ).To repeat the effect,a number may precede either the exclamation mark or the text object.(For example, both <CODECLASS="literal">!10+</CODE> and <CODECLASS="literal">10!+</CODE> would indicate the next ten lines.)Objects such as <CODECLASS="literal">w</CODE> do not work unless enough of them are specified so as to exceed a single line.  You can also use a slash (<CODECLASS="literal">/</CODE>) followed by a <EMCLASS="emphasis">pattern</EM> anda carriage return to specify the object.This takes the text up to the pattern as input to the command.</P></LI><LICLASS="listitem"><PCLASS="para">Third, there is a special text object that can be used only withthis command syntax:  you can specify the current lineby entering a second exclamation mark:  </P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">!!<EMCLASS="emphasis">command</EM></PRE></BLOCKQUOTE></P><PCLASS="para">Remember that either the entire sequence or the text object can be preceded by a number to repeat the effect.  For instance, to change lines 96 through 99 as in the above example,you could position the cursor on line 96 and enter either:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">4!!sort</PRE></BLOCKQUOTE></P><PCLASS="para">or:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">!4!sort</PRE></BLOCKQUOTE></P></LI></UL><PCLASS="para">As another example, assume you have a portion of text in a filethat you want to change from lowercase to uppercase letters.  You could process that portion with the <CODECLASS="literal">tr</CODE> command to change the case.In this example, the second sentence is the block of text that will be filtered to the command.</P><TABLECLASS="informaltable"><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">One sentence before.<UCLASS="cursor">W</U>ith a screen editor you can scroll the pagemove the cursor, delete lines, insert characters, and more, while seeing the results of your edits as you make them.One sentence after.</PRE></BLOCKQUOTE></TD></TR></TBODY></TABLE><TABLECLASS="informaltable"><THEADCLASS="thead"><TRCLASS="row"VALIGN="TOP"><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Keystrokes</TH><THCLASS="entry"ALIGN="LEFT"ROWSPAN="1"COLSPAN="1">Results</TH></TR></THEAD><TBODYCLASS="tbody"><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">!)</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">One sentence after.~~~!_</PRE></BLOCKQUOTE></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">An exclamation mark appears on the last line to prompt youfor the UNIX command.</P></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><CODECLASS="literal">tr `[a-z]` `[A-Z]`</CODE></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">One sentence before.  <UCLASS="cursor">W</U>ITH A SCREEN EDITOR YOU CAN SCROLL THE PAGEMOVE THE CURSOR, DELETE LINES, INSERT CHARACTERS, AND MORE, WHILE SEEING THE RESULTS OF YOUR EDITS AS YOU MAKE THEM.One sentence after.</PRE></BLOCKQUOTE></TD></TR><TRCLASS="row"VALIGN="TOP"><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"></TD><TDCLASS="entry"ROWSPAN="1"COLSPAN="1"><PCLASS="para">Enter the UNIX command and press RETURN.  The input is replaced by the output.</P></TD></TR></TBODY></TABLE><PCLASS="para">To repeat the previous command, the syntax is:</P><PCLASS="para"><BLOCKQUOTECLASS="screen"><PRECLASS="screen">! <EMCLASS="emphasis">object</EM> !</PRE></BLOCKQUOTE></P><PCLASS="para">It is sometimes useful to send sections of a coded document to<EMCLASS="emphasis">nroff</EM> to be replaced by formatted output.  Remember that the &quot;original&quot; input is replaced by the output.  Fortunately, if there is a mistake, such as an error message being sent instead of the expected output, you can undo the command and restore the lines.<ACLASS="indexterm"NAME="AUTOID-7054"></A><ACLASS="indexterm"NAME="AUTOID-7055"></A><ACLASS="indexterm"NAME="AUTOID-7056"></A><ACLASS="indexterm"NAME="AUTOID-7057"></A><ACLASS="indexterm"NAME="AUTOID-7058"></A><ACLASS="indexterm"NAME="AUTOID-7059"></A><ACLASS="indexterm"NAME="AUTOID-7060"></A><ACLASS="indexterm"NAME="AUTOID-7061"></A></P></DIV></DIV></DIV><DIVCLASS="htmlnav"><P></P><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><TABLEWIDTH="515"BORDER="0"CELLSPACING="0"CELLPADDING="0"><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_01.htm"TITLE="7.1 Customizing vi "><IMGSRC="../gifs/txtpreva.gif"ALT="Previous: 7.1 Customizing vi "BORDER="0"></A></TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="book"HREF="index.htm"TITLE="Learning the vi Editor"><IMGSRC="../gifs/txthome.gif"ALT="Learning the vi Editor"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172"><ACLASS="SECT1"HREF="ch07_03.htm"TITLE="7.3 Saving Commands "><IMGSRC="../gifs/txtnexta.gif"ALT="Next: 7.3 Saving Commands "BORDER="0"></A></TD></TR><TR><TDALIGN="LEFT"VALIGN="TOP"WIDTH="172">7.1 Customizing vi </TD><TDALIGN="CENTER"VALIGN="TOP"WIDTH="171"><ACLASS="index"HREF="index/idx_a.htm"TITLE="Book Index"><IMGSRC="../gifs/index.gif"ALT="Book Index"BORDER="0"></A></TD><TDALIGN="RIGHT"VALIGN="TOP"WIDTH="172">7.3 Saving Commands </TD></TR></TABLE><HRALIGN="LEFT"WIDTH="515"TITLE="footer"><IMGSRC="../gifs/smnavbar.gif"USEMAP="#map"BORDER="0"ALT="The UNIX CD Bookshelf Navigation"><MAPNAME="map"><AREASHAPE="RECT"COORDS="0,0,73,21"HREF="../index.htm"ALT="The UNIX CD Bookshelf"><AREASHAPE="RECT"COORDS="74,0,163,21"HREF="../upt/index.htm"ALT="UNIX Power Tools"><AREASHAPE="RECT"COORDS="164,0,257,21"HREF="../unixnut/index.htm"ALT="UNIX in a Nutshell"><AREASHAPE="RECT"COORDS="258,0,321,21"HREF="index.htm"ALT="Learning the vi Editor"><AREASHAPE="RECT"COORDS="322,0,378,21"HREF="../sedawk/index.htm"ALT="sed &amp; awk"><AREASHAPE="RECT"COORDS="379,0,438,21"HREF="../ksh/index.htm"ALT="Learning the Korn Shell"><AREASHAPE="RECT"COORDS="439,0,514,21"HREF="../lrnunix/index.htm"ALT="Learning the UNIX Operating System"></MAP></DIV></BODY></HTML>