<!DOCTYPE HTML PUBLIC "-//ORA//DTD CD HTML 3.2//EN"><HTML><HEAD><TITLE>[Chapter 14] Windows CGI</TITLE><META NAME="author" CONTENT="Stephen Spainhour and Valerie Quercia"><META NAME="date" CONTENT="Mon Mar 17 14:30:00 1997"><META NAME="form" CONTENT="html"><META NAME="metadata" CONTENT="dublincore.0.1"><META NAME="objecttype" CONTENT="book part"><META NAME="otheragent" CONTENT="gmat dbtohtml"><META NAME="publisher" CONTENT="O'Reilly &amp; Associates, Inc."><META NAME="source" CONTENT="SGML"><META NAME="subject" CONTENT="Webmaster in a Nutshell"><META NAME="title" CONTENT="Webmaster in a Nutshell"><!-- JavaScript: pathcont.js --></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><DIV CLASS=htmlnav><H1><IMG SRC="gifs/smbanner.gif" ALT="Webmaster in a Nutshell"></H1><table width=515 border=0 cellpadding=0 cellspacing=0><tr><td width=172 align=left valign=top><A HREF="ch13_05.htm"><IMG SRC="gifs/txtpreva.gif" ALT="Previous" border=0></A></td><td width=171 align=center valign=top><b>Chapter 14</b></td><td width=172 align=right valign=top><A HREF="ch14_02.htm"><IMG SRC="gifs/txtnexta.gif" ALT="Next" border=0></A></td></tr></table><!-- JavaScript: prev.js -->&nbsp;<!-- JavaScript: next.js --><hr align=left width=515></DIV><H1 CLASS=chapter><A CLASS="TITLE" NAME="WEB-CH-14">Windows CGI</A></H1><DIV CLASS=htmltoc><p><b>Contents:</b><br>The Windows CGI Framework for Visual Basic<br><A HREF="ch14_02.htm">The CGI Data File</A><BR><A HREF="ch14_03.htm">Results Processing</A><BR></DIV><P CLASS=para>Many Windows-based Web servers use a modified CGI interfacethat allows users to write CGI programs in native Windows programmingenvironments, such as Visual Basic, Delphi, or Visual C++. While many of the CGI basics still apply, WinCGI has its own implementation, covered in this chapter.See <A HREF="ch09_01.htm">Chapter 9, <i>CGI Overview</i></A>, for basic CGI information.  <P CLASS=para>Since the UNIX concepts of standard input and environment variablesare foreign to Microsoft Windows,WinCGI-compliant servers transfer data to the program usingexternal temporary files. CGI programs can then retrieve CGI information directly from thesefiles, or they can use a framework such as theCGI.BAS module supplied for Visual Basic programmers using theWebSite server. <P CLASS=para>This chapter covers the generic WinCGI interface as well as thevariables and functions defined on the WebSite server for Visual Basicprogramming. <DIV CLASS=sect1><h2 CLASS=sect1><A CLASS="TITLE" NAME="WEB-CH-14-SECT-1">14.1 The Windows CGI Framework for Visual Basic</A></h2><P CLASS=para> The WebSite server is distributed with CGI.BAS and CGI32.BASmodules, to facilitate CGI programming under (respectively)Visual Basic Version 3 and Visual Basic Version 4. The frameworkmodule defines the <tt CLASS=literal>Main()</tt> routine of the program, CGIvariables for use by the program, and several functions forsimplifying CGI programming and error handling.<DIV CLASS=sect2><h3 CLASS=sect2><A CLASS="TITLE" NAME="WEB-CH-14-SECT-1.1">The Main(\^) Routine</A></h3><P CLASS=para>Projects you create for CGI programs that use the frameworkshould be set to start in <tt CLASS=literal>Sub Main()</tt> (rather thanin a form). When the CGI program starts, it enters at <tt CLASS=literal>Main()</tt>in the framework. The framework extracts all of the variables,special request headers, and form content, if any, and stores themin global variables. It also establishes a global exception handler(<tt CLASS=literal>On Error</tt>) so that runtime errors in your CGI program aretrapped, preventing the CGI program from exiting without producinga response.<P CLASS=para>Once the CGI environment has been set up, the framework calls aroutine called <tt CLASS=literal>CGI_Main()</tt> that you must write. This is whereyour code starts. <I CLASS=emphasis>Always return from CGI_Main(&nbsp;). Never do anabort or exit within a CGI program using the framework.</I><P CLASS=para>If the CGI executable is double-clicked, it will not have the correctinformation on its command line (no INI file). If this happens,the <tt CLASS=literal>Main()</tt> routine calls a routine <tt CLASS=literal>Inter_Main()</tt>,which you must also write. For most applications, simply displaya message box telling the user that this is a CGI program, then exit.</DIV><DIV CLASS=sect2><h3 CLASS=sect2><A CLASS="TITLE" NAME="WEB-CH-14-SECT-1.2">CGI Variables</A></h3><P CLASS=para> The CGI32.BAS module defines variables for use within the CGI program.<DIV CLASS=sect3><h4 CLASS=sect3><A CLASS="TITLE" NAME="WEB-CH-14-SECT-1.2.1">Information About the Server</A></h4><DIV CLASS=informaltable><P><A NAME="WEB-CH-14-TAB-1"></A><TABLE CLASS=INFORMALTABLE><TR CLASS=row><TH ALIGN="left">Variable name</TH><TH ALIGN="left">Description</TH><TH ALIGN="left">Data type</TH></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_ServerSoftware</tt></TD><TD ALIGN="left"><P CLASS=para>The name and version of the server software(e.g., WebSite/1.1)</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_ServerAdmin</tt></TD><TD ALIGN="left"><P CLASS=para>The email address of the server's administrator</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_Version</tt></TD><TD ALIGN="left"><P CLASS=para>The CGI version to which this server complies (e.g., CGI/1.2)</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_GMTOffset</tt></TD><TD ALIGN="left"><P CLASS=para>The number of seconds from GMT</TD><TD ALIGN="left">Variant</TD></TR></TABLE><P></DIV></DIV><DIV CLASS=sect3><h4 CLASS=sect3><A CLASS="TITLE" NAME="WEB-CH-14-SECT-1.2.2">Information About the Browser or User</A></h4><DIV CLASS=informaltable><P><A NAME="WEB-CH-14-TAB-2"></A><TABLE CLASS=INFORMALTABLE><TR CLASS=row><TH ALIGN="left">Variable name</TH><TH ALIGN="left">Description</TH><TH ALIGN="left">Data type</TH></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_RequestProtocol</tt></TD><TD ALIGN="left"><P CLASS=para>The name and revision of the information protocol (e.g., HTTP/1.0)</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_Referer</tt></TD><TD ALIGN="left"><P CLASS=para>The URL that referred to the CGI script</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_From</tt></TD><TD ALIGN="left"><P CLASS=para>The email address of the user (rarely supplied by the browser)</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_RemoteHost</tt></TD><TD ALIGN="left"><P CLASS=para>The hostname of the remote host running the browser</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_RemoteAddr</tt></TD><TD ALIGN="left"><P CLASS=para>The IP address of the remote host running the browser</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_AcceptTypes</tt></TD><TD ALIGN="left"><P CLASS=para>The CGI accept types</TD><TD ALIGN="left">Tuple</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_NumAcceptTypes</tt></TD><TD ALIGN="left"><P CLASS=para>The number of CGI accept types</TD><TD ALIGN="left">Integer</TD></TR></TABLE><P></DIV></DIV><DIV CLASS=sect3><h4 CLASS=sect3><A CLASS="TITLE" NAME="WEB-CH-14-SECT-1.2.3">Executable, Logical, and Physical Paths</A></h4><DIV CLASS=informaltable><P><A NAME="WEB-CH-14-TAB-3"></A><TABLE CLASS=INFORMALTABLE><TR CLASS=row><TH ALIGN="left">Variable name</TH><TH ALIGN="left">Description</TH><TH ALIGN="left">Data type</TH></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_ExecutablePath</tt></TD><TD ALIGN="left"><P CLASS=para>The path of the CGI program being executed</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_LogicalPath</tt></TD><TD ALIGN="left"><P CLASS=para>The logical path or extra path information</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_PhysicalPath</tt></TD><TD ALIGN="left"><P CLASS=para>The physical path (i.e., translated version of the logical path)</TD><TD ALIGN="left">String</TD></TR></TABLE><P></DIV></DIV><DIV CLASS=sect3><h4 CLASS=sect3><A CLASS="TITLE" NAME="WEB-CH-14-SECT-1.2.4">Information About the Request</A></h4><DIV CLASS=informaltable><P><A NAME="WEB-CH-14-TAB-4"></A><TABLE CLASS=INFORMALTABLE><TR CLASS=row><TH ALIGN="left">Variable name</TH><TH ALIGN="left">Description</TH><TH ALIGN="left">Data type</TH></TR><TR CLASS=row><TH ALIGN="left">&nbsp;</TH><td>&nbsp;</td><td>&nbsp;</td></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_RequestMethod</tt></TD><TD ALIGN="left"><P CLASS=para>The method with which the request was made (GET, POST, or HEAD)</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_ServerPort</tt></TD><TD ALIGN="left"><P CLASS=para>The port number associated with the request</TD><TD ALIGN="left">Integer</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_ServerName</tt></TD><TD ALIGN="left"><P CLASS=para>The server hostname for this request (varies in multi-homedconfiguration)</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_QueryString</tt></TD><TD ALIGN="left"><P CLASS=para>The encoded portion of the URL after the ?, containing GET data orquery string (if any)</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_ContentFile</tt></TD><TD ALIGN="left"><P CLASS=para>The full pathname of the file containing any attached data (i.e., POSTdata)</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_ContentType</tt></TD><TD ALIGN="left"><P CLASS=para>The MIME content type of requests with attached data (i.e., POST data)</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_ContentLength</tt></TD><TD ALIGN="left"><P CLASS=para>The length of the attached data (content file) in bytes</TD><TD ALIGN="left">Long</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_FormTuples</tt></TD><TD ALIGN="left"><P CLASS=para>The name=value pairs supplied in form data, if any</TD><TD ALIGN="left">Tuple</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_NumFormTuples</tt></TD><TD ALIGN="left"><P CLASS=para>The number of name=value pairs</TD><TD ALIGN="left">Integer</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_HugeTuples</tt></TD><TD ALIGN="left"><P CLASS=para>Large name=value pairs</TD><TD ALIGN="left">HugeTuple</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_NumHugeTuples</tt></TD><TD ALIGN="left"><P CLASS=para>The number of huge tuples</TD><TD ALIGN="left">Integer</TD></TR></TABLE><P></DIV></DIV><DIV CLASS=sect3><h4 CLASS=sect3><A CLASS="TITLE" NAME="WEB-CH-14-SECT-1.2.5">Security</A></h4><DIV CLASS=informaltable><P><A NAME="WEB-CH-14-TAB-5"></A><TABLE CLASS=INFORMALTABLE><TR CLASS=row><TH ALIGN="left">Variable name</TH><TH ALIGN="left">Description</TH><TH ALIGN="left">Data type</TH></TR><TR CLASS=row><TH ALIGN="left">&nbsp;</TH><td>&nbsp;</td><td>&nbsp;</td></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_AuthUser</tt></TD><TD ALIGN="left"><P CLASS=para>The name of the authorized user</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_AuthPass</tt></TD><TD ALIGN="left"><P CLASS=para>The password of the authorized user (only if enabled)</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_AuthType</tt></TD><TD ALIGN="left"><P CLASS=para>The authorization method</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_AuthRealm</tt></TD><TD ALIGN="left"><P CLASS=para>The realm of the authorized user</TD><TD ALIGN="left">String</TD></TR></TABLE><P></DIV></DIV><DIV CLASS=sect3><h4 CLASS=sect3><A CLASS="TITLE" NAME="WEB-CH-14-SECT-1.2.6">Miscellaneous</A></h4><DIV CLASS=informaltable><P><A NAME="WEB-CH-14-TAB-6"></A><TABLE CLASS=INFORMALTABLE><TR CLASS=row><TH ALIGN="left">Variable name</TH><TH ALIGN="left">Description</TH><TH ALIGN="left">Data type</TH></TR><TR CLASS=row><TH ALIGN="left">&nbsp;</TH><td>&nbsp;</td><td>&nbsp;</td></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_ExtraHeaders</tt></TD><TD ALIGN="left"><P CLASS=para>The "extra" headers supplied by the browser</TD><TD ALIGN="left">Tuple</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_NumExtraHeaders</tt></TD><TD ALIGN="left"><P CLASS=para>The number of extra headers</TD><TD ALIGN="left">Integer</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_OutputFile</tt></TD><TD ALIGN="left"><P CLASS=para>The full pathname of the file in which the server expects the CGIprogram's response</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left"><tt CLASS=literal>CGI_DebugMode</tt></TD><TD ALIGN="left"><P CLASS=para>CGI Tracing flag from server</TD><TD ALIGN="left">Integer</TD></TR></TABLE><P></DIV></DIV></DIV><DIV CLASS=sect2><h3 CLASS=sect2><A CLASS="TITLE" NAME="WEB-CH-14-SECT-1.3">Utility Functions</A></h3><P CLASS=para>The CGI32.BAS module defines these functions for facilitatingCGI programming, which give information about the server:<DIV CLASS=informaltable><P><A NAME="WEB-CH-14-TAB-7"></A><TABLE CLASS=INFORMALTABLE><TR CLASS=row><TH ALIGN="left">Routine names</TH><TH ALIGN="left">Descriptions</TH><TH ALIGN="left">Returns</TH></TR><TR CLASS=row><TD ALIGN="left">ErrorHandler()</TD><TD ALIGN="left"><P CLASS=para>Global exception handler</TD><TD ALIGN="left">n/a</TD></TR><TR CLASS=row><TD ALIGN="left">FieldPresent()</TD><TD ALIGN="left"><P CLASS=para>Test for the presence of a named form field</TD><TD ALIGN="left">T/F</TD></TR><TR CLASS=row><TD ALIGN="left">GetSmallField()</TD><TD ALIGN="left"><P CLASS=para>Retrieve the contents of a named form field</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left">PlusToSpace()</TD><TD ALIGN="left"><P CLASS=para>Remove "+" delimiters from a string, converting to spaces</TD><TD ALIGN="left">n/a</TD></TR><TR CLASS=row><TD ALIGN="left">Send()</TD><TD ALIGN="left"><P CLASS=para>Write a string into the output spool file</TD><TD ALIGN="left">n/a</TD></TR><TR CLASS=row><TD ALIGN="left">SendNoOp()</TD><TD ALIGN="left"><P CLASS=para>Send a complete response causing the browser to do nothing, staying onits current page</TD><TD ALIGN="left">n/a</TD></TR><TR CLASS=row><TD ALIGN="left">Unescape()</TD><TD ALIGN="left"><P CLASS=para>Remove URL-escaping from a string, return modified string</TD><TD ALIGN="left">String</TD></TR><TR CLASS=row><TD ALIGN="left">WebDate()</TD><TD ALIGN="left"><P CLASS=para>Return a Web-compliant date/time string (GMT)</TD><TD ALIGN="left">String</TD></TR></TABLE><P></DIV><P CLASS=para></DIV></DIV><DIV CLASS=htmlnav><P><HR align=left width=515><table width=515 border=0 cellpadding=0 cellspacing=0><tr><td width=172 align=left valign=top><A HREF="ch13_05.htm"><IMG SRC="gifs/txtpreva.gif" ALT="Previous" border=0></A></td><td width=171 align=center valign=top><a href="index.htm"><IMG SRC="gifs/txthome.gif" ALT="Home" border=0></a></td><td width=172 align=right valign=top><A HREF="ch14_02.htm"><IMG SRC="gifs/txtnexta.gif" ALT="Next" border=0></A></td></tr><tr><td width=172 align=left valign=top>Table -: SSI Time Formats</td><td width=171 align=center valign=top><a href="index/idx_0.htm">Book Index</a></td><td width=172 align=right valign=top>The CGI Data File</td></tr></table><!-- JavaScript: prev.js -->&nbsp;<!-- JavaScript: next.js --></DIV></BODY></HTML>